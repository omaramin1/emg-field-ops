function nF(n,r){for(var c=0;c<r.length;c++){const p=r[c];if(typeof p!="string"&&!Array.isArray(p)){for(const v in p)if(v!=="default"&&!(v in n)){const w=Object.getOwnPropertyDescriptor(p,v);w&&Object.defineProperty(n,v,w.get?w:{enumerable:!0,get:()=>p[v]})}}}return Object.freeze(Object.defineProperty(n,Symbol.toStringTag,{value:"Module"}))}(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const v of document.querySelectorAll('link[rel="modulepreload"]'))p(v);new MutationObserver(v=>{for(const w of v)if(w.type==="childList")for(const A of w.addedNodes)A.tagName==="LINK"&&A.rel==="modulepreload"&&p(A)}).observe(document,{childList:!0,subtree:!0});function c(v){const w={};return v.integrity&&(w.integrity=v.integrity),v.referrerPolicy&&(w.referrerPolicy=v.referrerPolicy),v.crossOrigin==="use-credentials"?w.credentials="include":v.crossOrigin==="anonymous"?w.credentials="omit":w.credentials="same-origin",w}function p(v){if(v.ep)return;v.ep=!0;const w=c(v);fetch(v.href,w)}})();var sF=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function _T(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var WP={exports:{}},Ox={},qP={exports:{}},yr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var B_=Symbol.for("react.element"),oF=Symbol.for("react.portal"),aF=Symbol.for("react.fragment"),lF=Symbol.for("react.strict_mode"),cF=Symbol.for("react.profiler"),uF=Symbol.for("react.provider"),hF=Symbol.for("react.context"),dF=Symbol.for("react.forward_ref"),fF=Symbol.for("react.suspense"),pF=Symbol.for("react.memo"),mF=Symbol.for("react.lazy"),NC=Symbol.iterator;function gF(n){return n===null||typeof n!="object"?null:(n=NC&&n[NC]||n["@@iterator"],typeof n=="function"?n:null)}var ZP={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},XP=Object.assign,KP={};function pp(n,r,c){this.props=n,this.context=r,this.refs=KP,this.updater=c||ZP}pp.prototype.isReactComponent={};pp.prototype.setState=function(n,r){if(typeof n!="object"&&typeof n!="function"&&n!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,n,r,"setState")};pp.prototype.forceUpdate=function(n){this.updater.enqueueForceUpdate(this,n,"forceUpdate")};function YP(){}YP.prototype=pp.prototype;function yT(n,r,c){this.props=n,this.context=r,this.refs=KP,this.updater=c||ZP}var vT=yT.prototype=new YP;vT.constructor=yT;XP(vT,pp.prototype);vT.isPureReactComponent=!0;var UC=Array.isArray,JP=Object.prototype.hasOwnProperty,xT={current:null},QP={key:!0,ref:!0,__self:!0,__source:!0};function eM(n,r,c){var p,v={},w=null,A=null;if(r!=null)for(p in r.ref!==void 0&&(A=r.ref),r.key!==void 0&&(w=""+r.key),r)JP.call(r,p)&&!QP.hasOwnProperty(p)&&(v[p]=r[p]);var o=arguments.length-2;if(o===1)v.children=c;else if(1<o){for(var D=Array(o),j=0;j<o;j++)D[j]=arguments[j+2];v.children=D}if(n&&n.defaultProps)for(p in o=n.defaultProps,o)v[p]===void 0&&(v[p]=o[p]);return{$$typeof:B_,type:n,key:w,ref:A,props:v,_owner:xT.current}}function _F(n,r){return{$$typeof:B_,type:n.type,key:r,ref:n.ref,props:n.props,_owner:n._owner}}function bT(n){return typeof n=="object"&&n!==null&&n.$$typeof===B_}function yF(n){var r={"=":"=0",":":"=2"};return"$"+n.replace(/[=:]/g,function(c){return r[c]})}var VC=/\/+/g;function mw(n,r){return typeof n=="object"&&n!==null&&n.key!=null?yF(""+n.key):r.toString(36)}function F0(n,r,c,p,v){var w=typeof n;(w==="undefined"||w==="boolean")&&(n=null);var A=!1;if(n===null)A=!0;else switch(w){case"string":case"number":A=!0;break;case"object":switch(n.$$typeof){case B_:case oF:A=!0}}if(A)return A=n,v=v(A),n=p===""?"."+mw(A,0):p,UC(v)?(c="",n!=null&&(c=n.replace(VC,"$&/")+"/"),F0(v,r,c,"",function(j){return j})):v!=null&&(bT(v)&&(v=_F(v,c+(!v.key||A&&A.key===v.key?"":(""+v.key).replace(VC,"$&/")+"/")+n)),r.push(v)),1;if(A=0,p=p===""?".":p+":",UC(n))for(var o=0;o<n.length;o++){w=n[o];var D=p+mw(w,o);A+=F0(w,r,c,D,v)}else if(D=gF(n),typeof D=="function")for(n=D.call(n),o=0;!(w=n.next()).done;)w=w.value,D=p+mw(w,o++),A+=F0(w,r,c,D,v);else if(w==="object")throw r=String(n),Error("Objects are not valid as a React child (found: "+(r==="[object Object]"?"object with keys {"+Object.keys(n).join(", ")+"}":r)+"). If you meant to render a collection of children, use an array instead.");return A}function d0(n,r,c){if(n==null)return n;var p=[],v=0;return F0(n,p,"","",function(w){return r.call(c,w,v++)}),p}function vF(n){if(n._status===-1){var r=n._result;r=r(),r.then(function(c){(n._status===0||n._status===-1)&&(n._status=1,n._result=c)},function(c){(n._status===0||n._status===-1)&&(n._status=2,n._result=c)}),n._status===-1&&(n._status=0,n._result=r)}if(n._status===1)return n._result.default;throw n._result}var ho={current:null},j0={transition:null},xF={ReactCurrentDispatcher:ho,ReactCurrentBatchConfig:j0,ReactCurrentOwner:xT};function tM(){throw Error("act(...) is not supported in production builds of React.")}yr.Children={map:d0,forEach:function(n,r,c){d0(n,function(){r.apply(this,arguments)},c)},count:function(n){var r=0;return d0(n,function(){r++}),r},toArray:function(n){return d0(n,function(r){return r})||[]},only:function(n){if(!bT(n))throw Error("React.Children.only expected to receive a single React element child.");return n}};yr.Component=pp;yr.Fragment=aF;yr.Profiler=cF;yr.PureComponent=yT;yr.StrictMode=lF;yr.Suspense=fF;yr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=xF;yr.act=tM;yr.cloneElement=function(n,r,c){if(n==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+n+".");var p=XP({},n.props),v=n.key,w=n.ref,A=n._owner;if(r!=null){if(r.ref!==void 0&&(w=r.ref,A=xT.current),r.key!==void 0&&(v=""+r.key),n.type&&n.type.defaultProps)var o=n.type.defaultProps;for(D in r)JP.call(r,D)&&!QP.hasOwnProperty(D)&&(p[D]=r[D]===void 0&&o!==void 0?o[D]:r[D])}var D=arguments.length-2;if(D===1)p.children=c;else if(1<D){o=Array(D);for(var j=0;j<D;j++)o[j]=arguments[j+2];p.children=o}return{$$typeof:B_,type:n.type,key:v,ref:w,props:p,_owner:A}};yr.createContext=function(n){return n={$$typeof:hF,_currentValue:n,_currentValue2:n,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},n.Provider={$$typeof:uF,_context:n},n.Consumer=n};yr.createElement=eM;yr.createFactory=function(n){var r=eM.bind(null,n);return r.type=n,r};yr.createRef=function(){return{current:null}};yr.forwardRef=function(n){return{$$typeof:dF,render:n}};yr.isValidElement=bT;yr.lazy=function(n){return{$$typeof:mF,_payload:{_status:-1,_result:n},_init:vF}};yr.memo=function(n,r){return{$$typeof:pF,type:n,compare:r===void 0?null:r}};yr.startTransition=function(n){var r=j0.transition;j0.transition={};try{n()}finally{j0.transition=r}};yr.unstable_act=tM;yr.useCallback=function(n,r){return ho.current.useCallback(n,r)};yr.useContext=function(n){return ho.current.useContext(n)};yr.useDebugValue=function(){};yr.useDeferredValue=function(n){return ho.current.useDeferredValue(n)};yr.useEffect=function(n,r){return ho.current.useEffect(n,r)};yr.useId=function(){return ho.current.useId()};yr.useImperativeHandle=function(n,r,c){return ho.current.useImperativeHandle(n,r,c)};yr.useInsertionEffect=function(n,r){return ho.current.useInsertionEffect(n,r)};yr.useLayoutEffect=function(n,r){return ho.current.useLayoutEffect(n,r)};yr.useMemo=function(n,r){return ho.current.useMemo(n,r)};yr.useReducer=function(n,r,c){return ho.current.useReducer(n,r,c)};yr.useRef=function(n){return ho.current.useRef(n)};yr.useState=function(n){return ho.current.useState(n)};yr.useSyncExternalStore=function(n,r,c){return ho.current.useSyncExternalStore(n,r,c)};yr.useTransition=function(){return ho.current.useTransition()};yr.version="18.3.1";qP.exports=yr;var Z=qP.exports;const wT=_T(Z),bF=nF({__proto__:null,default:wT},[Z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wF=Z,SF=Symbol.for("react.element"),TF=Symbol.for("react.fragment"),EF=Object.prototype.hasOwnProperty,IF=wF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,AF={key:!0,ref:!0,__self:!0,__source:!0};function iM(n,r,c){var p,v={},w=null,A=null;c!==void 0&&(w=""+c),r.key!==void 0&&(w=""+r.key),r.ref!==void 0&&(A=r.ref);for(p in r)EF.call(r,p)&&!AF.hasOwnProperty(p)&&(v[p]=r[p]);if(n&&n.defaultProps)for(p in r=n.defaultProps,r)v[p]===void 0&&(v[p]=r[p]);return{$$typeof:SF,type:n,key:w,ref:A,props:v,_owner:IF.current}}Ox.Fragment=TF;Ox.jsx=iM;Ox.jsxs=iM;WP.exports=Ox;var N=WP.exports,oS={},rM={exports:{}},Yo={},nM={exports:{}},sM={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(n){function r(Tt,Ht){var Gt=Tt.length;Tt.push(Ht);e:for(;0<Gt;){var hi=Gt-1>>>1,Ft=Tt[hi];if(0<v(Ft,Ht))Tt[hi]=Ht,Tt[Gt]=Ft,Gt=hi;else break e}}function c(Tt){return Tt.length===0?null:Tt[0]}function p(Tt){if(Tt.length===0)return null;var Ht=Tt[0],Gt=Tt.pop();if(Gt!==Ht){Tt[0]=Gt;e:for(var hi=0,Ft=Tt.length,Ot=Ft>>>1;hi<Ot;){var di=2*(hi+1)-1,wt=Tt[di],sr=di+1,pr=Tt[sr];if(0>v(wt,Gt))sr<Ft&&0>v(pr,wt)?(Tt[hi]=pr,Tt[sr]=Gt,hi=sr):(Tt[hi]=wt,Tt[di]=Gt,hi=di);else if(sr<Ft&&0>v(pr,Gt))Tt[hi]=pr,Tt[sr]=Gt,hi=sr;else break e}}return Ht}function v(Tt,Ht){var Gt=Tt.sortIndex-Ht.sortIndex;return Gt!==0?Gt:Tt.id-Ht.id}if(typeof performance=="object"&&typeof performance.now=="function"){var w=performance;n.unstable_now=function(){return w.now()}}else{var A=Date,o=A.now();n.unstable_now=function(){return A.now()-o}}var D=[],j=[],J=1,ie=null,re=3,he=!1,ce=!1,xe=!1,Ee=typeof setTimeout=="function"?setTimeout:null,ve=typeof clearTimeout=="function"?clearTimeout:null,K=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function fe(Tt){for(var Ht=c(j);Ht!==null;){if(Ht.callback===null)p(j);else if(Ht.startTime<=Tt)p(j),Ht.sortIndex=Ht.expirationTime,r(D,Ht);else break;Ht=c(j)}}function ke(Tt){if(xe=!1,fe(Tt),!ce)if(c(D)!==null)ce=!0,ei(Be);else{var Ht=c(j);Ht!==null&&si(ke,Ht.startTime-Tt)}}function Be(Tt,Ht){ce=!1,xe&&(xe=!1,ve(ct),ct=-1),he=!0;var Gt=re;try{for(fe(Ht),ie=c(D);ie!==null&&(!(ie.expirationTime>Ht)||Tt&&!zt());){var hi=ie.callback;if(typeof hi=="function"){ie.callback=null,re=ie.priorityLevel;var Ft=hi(ie.expirationTime<=Ht);Ht=n.unstable_now(),typeof Ft=="function"?ie.callback=Ft:ie===c(D)&&p(D),fe(Ht)}else p(D);ie=c(D)}if(ie!==null)var Ot=!0;else{var di=c(j);di!==null&&si(ke,di.startTime-Ht),Ot=!1}return Ot}finally{ie=null,re=Gt,he=!1}}var Le=!1,We=null,ct=-1,lt=5,Pt=-1;function zt(){return!(n.unstable_now()-Pt<lt)}function _i(){if(We!==null){var Tt=n.unstable_now();Pt=Tt;var Ht=!0;try{Ht=We(!0,Tt)}finally{Ht?Ut():(Le=!1,We=null)}}else Le=!1}var Ut;if(typeof K=="function")Ut=function(){K(_i)};else if(typeof MessageChannel<"u"){var bi=new MessageChannel,vi=bi.port2;bi.port1.onmessage=_i,Ut=function(){vi.postMessage(null)}}else Ut=function(){Ee(_i,0)};function ei(Tt){We=Tt,Le||(Le=!0,Ut())}function si(Tt,Ht){ct=Ee(function(){Tt(n.unstable_now())},Ht)}n.unstable_IdlePriority=5,n.unstable_ImmediatePriority=1,n.unstable_LowPriority=4,n.unstable_NormalPriority=3,n.unstable_Profiling=null,n.unstable_UserBlockingPriority=2,n.unstable_cancelCallback=function(Tt){Tt.callback=null},n.unstable_continueExecution=function(){ce||he||(ce=!0,ei(Be))},n.unstable_forceFrameRate=function(Tt){0>Tt||125<Tt?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):lt=0<Tt?Math.floor(1e3/Tt):5},n.unstable_getCurrentPriorityLevel=function(){return re},n.unstable_getFirstCallbackNode=function(){return c(D)},n.unstable_next=function(Tt){switch(re){case 1:case 2:case 3:var Ht=3;break;default:Ht=re}var Gt=re;re=Ht;try{return Tt()}finally{re=Gt}},n.unstable_pauseExecution=function(){},n.unstable_requestPaint=function(){},n.unstable_runWithPriority=function(Tt,Ht){switch(Tt){case 1:case 2:case 3:case 4:case 5:break;default:Tt=3}var Gt=re;re=Tt;try{return Ht()}finally{re=Gt}},n.unstable_scheduleCallback=function(Tt,Ht,Gt){var hi=n.unstable_now();switch(typeof Gt=="object"&&Gt!==null?(Gt=Gt.delay,Gt=typeof Gt=="number"&&0<Gt?hi+Gt:hi):Gt=hi,Tt){case 1:var Ft=-1;break;case 2:Ft=250;break;case 5:Ft=1073741823;break;case 4:Ft=1e4;break;default:Ft=5e3}return Ft=Gt+Ft,Tt={id:J++,callback:Ht,priorityLevel:Tt,startTime:Gt,expirationTime:Ft,sortIndex:-1},Gt>hi?(Tt.sortIndex=Gt,r(j,Tt),c(D)===null&&Tt===c(j)&&(xe?(ve(ct),ct=-1):xe=!0,si(ke,Gt-hi))):(Tt.sortIndex=Ft,r(D,Tt),ce||he||(ce=!0,ei(Be))),Tt},n.unstable_shouldYield=zt,n.unstable_wrapCallback=function(Tt){var Ht=re;return function(){var Gt=re;re=Ht;try{return Tt.apply(this,arguments)}finally{re=Gt}}}})(sM);nM.exports=sM;var CF=nM.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var kF=Z,Ko=CF;function $t(n){for(var r="https://reactjs.org/docs/error-decoder.html?invariant="+n,c=1;c<arguments.length;c++)r+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+n+"; visit "+r+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var oM=new Set,c_={};function Jh(n,r){sp(n,r),sp(n+"Capture",r)}function sp(n,r){for(c_[n]=r,n=0;n<r.length;n++)oM.add(r[n])}var ac=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),aS=Object.prototype.hasOwnProperty,LF=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,$C={},GC={};function PF(n){return aS.call(GC,n)?!0:aS.call($C,n)?!1:LF.test(n)?GC[n]=!0:($C[n]=!0,!1)}function MF(n,r,c,p){if(c!==null&&c.type===0)return!1;switch(typeof r){case"function":case"symbol":return!0;case"boolean":return p?!1:c!==null?!c.acceptsBooleans:(n=n.toLowerCase().slice(0,5),n!=="data-"&&n!=="aria-");default:return!1}}function RF(n,r,c,p){if(r===null||typeof r>"u"||MF(n,r,c,p))return!0;if(p)return!1;if(c!==null)switch(c.type){case 3:return!r;case 4:return r===!1;case 5:return isNaN(r);case 6:return isNaN(r)||1>r}return!1}function fo(n,r,c,p,v,w,A){this.acceptsBooleans=r===2||r===3||r===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=c,this.propertyName=n,this.type=r,this.sanitizeURL=w,this.removeEmptyString=A}var ks={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(n){ks[n]=new fo(n,0,!1,n,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(n){var r=n[0];ks[r]=new fo(r,1,!1,n[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(n){ks[n]=new fo(n,2,!1,n.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(n){ks[n]=new fo(n,2,!1,n,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(n){ks[n]=new fo(n,3,!1,n.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(n){ks[n]=new fo(n,3,!0,n,null,!1,!1)});["capture","download"].forEach(function(n){ks[n]=new fo(n,4,!1,n,null,!1,!1)});["cols","rows","size","span"].forEach(function(n){ks[n]=new fo(n,6,!1,n,null,!1,!1)});["rowSpan","start"].forEach(function(n){ks[n]=new fo(n,5,!1,n.toLowerCase(),null,!1,!1)});var ST=/[\-:]([a-z])/g;function TT(n){return n[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(n){var r=n.replace(ST,TT);ks[r]=new fo(r,1,!1,n,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(n){var r=n.replace(ST,TT);ks[r]=new fo(r,1,!1,n,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(n){var r=n.replace(ST,TT);ks[r]=new fo(r,1,!1,n,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(n){ks[n]=new fo(n,1,!1,n.toLowerCase(),null,!1,!1)});ks.xlinkHref=new fo("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(n){ks[n]=new fo(n,1,!1,n.toLowerCase(),null,!0,!0)});function ET(n,r,c,p){var v=ks.hasOwnProperty(r)?ks[r]:null;(v!==null?v.type!==0:p||!(2<r.length)||r[0]!=="o"&&r[0]!=="O"||r[1]!=="n"&&r[1]!=="N")&&(RF(r,c,v,p)&&(c=null),p||v===null?PF(r)&&(c===null?n.removeAttribute(r):n.setAttribute(r,""+c)):v.mustUseProperty?n[v.propertyName]=c===null?v.type===3?!1:"":c:(r=v.attributeName,p=v.attributeNamespace,c===null?n.removeAttribute(r):(v=v.type,c=v===3||v===4&&c===!0?"":""+c,p?n.setAttributeNS(p,r,c):n.setAttribute(r,c))))}var dc=kF.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,f0=Symbol.for("react.element"),Bf=Symbol.for("react.portal"),Ff=Symbol.for("react.fragment"),IT=Symbol.for("react.strict_mode"),lS=Symbol.for("react.profiler"),aM=Symbol.for("react.provider"),lM=Symbol.for("react.context"),AT=Symbol.for("react.forward_ref"),cS=Symbol.for("react.suspense"),uS=Symbol.for("react.suspense_list"),CT=Symbol.for("react.memo"),ou=Symbol.for("react.lazy"),cM=Symbol.for("react.offscreen"),HC=Symbol.iterator;function Rg(n){return n===null||typeof n!="object"?null:(n=HC&&n[HC]||n["@@iterator"],typeof n=="function"?n:null)}var bn=Object.assign,gw;function Hg(n){if(gw===void 0)try{throw Error()}catch(c){var r=c.stack.trim().match(/\n( *(at )?)/);gw=r&&r[1]||""}return`
`+gw+n}var _w=!1;function yw(n,r){if(!n||_w)return"";_w=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(r)if(r=function(){throw Error()},Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(r,[])}catch(j){var p=j}Reflect.construct(n,[],r)}else{try{r.call()}catch(j){p=j}n.call(r.prototype)}else{try{throw Error()}catch(j){p=j}n()}}catch(j){if(j&&p&&typeof j.stack=="string"){for(var v=j.stack.split(`
`),w=p.stack.split(`
`),A=v.length-1,o=w.length-1;1<=A&&0<=o&&v[A]!==w[o];)o--;for(;1<=A&&0<=o;A--,o--)if(v[A]!==w[o]){if(A!==1||o!==1)do if(A--,o--,0>o||v[A]!==w[o]){var D=`
`+v[A].replace(" at new "," at ");return n.displayName&&D.includes("<anonymous>")&&(D=D.replace("<anonymous>",n.displayName)),D}while(1<=A&&0<=o);break}}}finally{_w=!1,Error.prepareStackTrace=c}return(n=n?n.displayName||n.name:"")?Hg(n):""}function DF(n){switch(n.tag){case 5:return Hg(n.type);case 16:return Hg("Lazy");case 13:return Hg("Suspense");case 19:return Hg("SuspenseList");case 0:case 2:case 15:return n=yw(n.type,!1),n;case 11:return n=yw(n.type.render,!1),n;case 1:return n=yw(n.type,!0),n;default:return""}}function hS(n){if(n==null)return null;if(typeof n=="function")return n.displayName||n.name||null;if(typeof n=="string")return n;switch(n){case Ff:return"Fragment";case Bf:return"Portal";case lS:return"Profiler";case IT:return"StrictMode";case cS:return"Suspense";case uS:return"SuspenseList"}if(typeof n=="object")switch(n.$$typeof){case lM:return(n.displayName||"Context")+".Consumer";case aM:return(n._context.displayName||"Context")+".Provider";case AT:var r=n.render;return n=n.displayName,n||(n=r.displayName||r.name||"",n=n!==""?"ForwardRef("+n+")":"ForwardRef"),n;case CT:return r=n.displayName||null,r!==null?r:hS(n.type)||"Memo";case ou:r=n._payload,n=n._init;try{return hS(n(r))}catch{}}return null}function OF(n){var r=n.type;switch(n.tag){case 24:return"Cache";case 9:return(r.displayName||"Context")+".Consumer";case 10:return(r._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return n=r.render,n=n.displayName||n.name||"",r.displayName||(n!==""?"ForwardRef("+n+")":"ForwardRef");case 7:return"Fragment";case 5:return r;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return hS(r);case 8:return r===IT?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof r=="function")return r.displayName||r.name||null;if(typeof r=="string")return r}return null}function Iu(n){switch(typeof n){case"boolean":case"number":case"string":case"undefined":return n;case"object":return n;default:return""}}function uM(n){var r=n.type;return(n=n.nodeName)&&n.toLowerCase()==="input"&&(r==="checkbox"||r==="radio")}function zF(n){var r=uM(n)?"checked":"value",c=Object.getOwnPropertyDescriptor(n.constructor.prototype,r),p=""+n[r];if(!n.hasOwnProperty(r)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var v=c.get,w=c.set;return Object.defineProperty(n,r,{configurable:!0,get:function(){return v.call(this)},set:function(A){p=""+A,w.call(this,A)}}),Object.defineProperty(n,r,{enumerable:c.enumerable}),{getValue:function(){return p},setValue:function(A){p=""+A},stopTracking:function(){n._valueTracker=null,delete n[r]}}}}function p0(n){n._valueTracker||(n._valueTracker=zF(n))}function hM(n){if(!n)return!1;var r=n._valueTracker;if(!r)return!0;var c=r.getValue(),p="";return n&&(p=uM(n)?n.checked?"true":"false":n.value),n=p,n!==c?(r.setValue(n),!0):!1}function K0(n){if(n=n||(typeof document<"u"?document:void 0),typeof n>"u")return null;try{return n.activeElement||n.body}catch{return n.body}}function dS(n,r){var c=r.checked;return bn({},r,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??n._wrapperState.initialChecked})}function WC(n,r){var c=r.defaultValue==null?"":r.defaultValue,p=r.checked!=null?r.checked:r.defaultChecked;c=Iu(r.value!=null?r.value:c),n._wrapperState={initialChecked:p,initialValue:c,controlled:r.type==="checkbox"||r.type==="radio"?r.checked!=null:r.value!=null}}function dM(n,r){r=r.checked,r!=null&&ET(n,"checked",r,!1)}function fS(n,r){dM(n,r);var c=Iu(r.value),p=r.type;if(c!=null)p==="number"?(c===0&&n.value===""||n.value!=c)&&(n.value=""+c):n.value!==""+c&&(n.value=""+c);else if(p==="submit"||p==="reset"){n.removeAttribute("value");return}r.hasOwnProperty("value")?pS(n,r.type,c):r.hasOwnProperty("defaultValue")&&pS(n,r.type,Iu(r.defaultValue)),r.checked==null&&r.defaultChecked!=null&&(n.defaultChecked=!!r.defaultChecked)}function qC(n,r,c){if(r.hasOwnProperty("value")||r.hasOwnProperty("defaultValue")){var p=r.type;if(!(p!=="submit"&&p!=="reset"||r.value!==void 0&&r.value!==null))return;r=""+n._wrapperState.initialValue,c||r===n.value||(n.value=r),n.defaultValue=r}c=n.name,c!==""&&(n.name=""),n.defaultChecked=!!n._wrapperState.initialChecked,c!==""&&(n.name=c)}function pS(n,r,c){(r!=="number"||K0(n.ownerDocument)!==n)&&(c==null?n.defaultValue=""+n._wrapperState.initialValue:n.defaultValue!==""+c&&(n.defaultValue=""+c))}var Wg=Array.isArray;function Yf(n,r,c,p){if(n=n.options,r){r={};for(var v=0;v<c.length;v++)r["$"+c[v]]=!0;for(c=0;c<n.length;c++)v=r.hasOwnProperty("$"+n[c].value),n[c].selected!==v&&(n[c].selected=v),v&&p&&(n[c].defaultSelected=!0)}else{for(c=""+Iu(c),r=null,v=0;v<n.length;v++){if(n[v].value===c){n[v].selected=!0,p&&(n[v].defaultSelected=!0);return}r!==null||n[v].disabled||(r=n[v])}r!==null&&(r.selected=!0)}}function mS(n,r){if(r.dangerouslySetInnerHTML!=null)throw Error($t(91));return bn({},r,{value:void 0,defaultValue:void 0,children:""+n._wrapperState.initialValue})}function ZC(n,r){var c=r.value;if(c==null){if(c=r.children,r=r.defaultValue,c!=null){if(r!=null)throw Error($t(92));if(Wg(c)){if(1<c.length)throw Error($t(93));c=c[0]}r=c}r==null&&(r=""),c=r}n._wrapperState={initialValue:Iu(c)}}function fM(n,r){var c=Iu(r.value),p=Iu(r.defaultValue);c!=null&&(c=""+c,c!==n.value&&(n.value=c),r.defaultValue==null&&n.defaultValue!==c&&(n.defaultValue=c)),p!=null&&(n.defaultValue=""+p)}function XC(n){var r=n.textContent;r===n._wrapperState.initialValue&&r!==""&&r!==null&&(n.value=r)}function pM(n){switch(n){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function gS(n,r){return n==null||n==="http://www.w3.org/1999/xhtml"?pM(r):n==="http://www.w3.org/2000/svg"&&r==="foreignObject"?"http://www.w3.org/1999/xhtml":n}var m0,mM=function(n){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(r,c,p,v){MSApp.execUnsafeLocalFunction(function(){return n(r,c,p,v)})}:n}(function(n,r){if(n.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in n)n.innerHTML=r;else{for(m0=m0||document.createElement("div"),m0.innerHTML="<svg>"+r.valueOf().toString()+"</svg>",r=m0.firstChild;n.firstChild;)n.removeChild(n.firstChild);for(;r.firstChild;)n.appendChild(r.firstChild)}});function u_(n,r){if(r){var c=n.firstChild;if(c&&c===n.lastChild&&c.nodeType===3){c.nodeValue=r;return}}n.textContent=r}var Yg={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},BF=["Webkit","ms","Moz","O"];Object.keys(Yg).forEach(function(n){BF.forEach(function(r){r=r+n.charAt(0).toUpperCase()+n.substring(1),Yg[r]=Yg[n]})});function gM(n,r,c){return r==null||typeof r=="boolean"||r===""?"":c||typeof r!="number"||r===0||Yg.hasOwnProperty(n)&&Yg[n]?(""+r).trim():r+"px"}function _M(n,r){n=n.style;for(var c in r)if(r.hasOwnProperty(c)){var p=c.indexOf("--")===0,v=gM(c,r[c],p);c==="float"&&(c="cssFloat"),p?n.setProperty(c,v):n[c]=v}}var FF=bn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function _S(n,r){if(r){if(FF[n]&&(r.children!=null||r.dangerouslySetInnerHTML!=null))throw Error($t(137,n));if(r.dangerouslySetInnerHTML!=null){if(r.children!=null)throw Error($t(60));if(typeof r.dangerouslySetInnerHTML!="object"||!("__html"in r.dangerouslySetInnerHTML))throw Error($t(61))}if(r.style!=null&&typeof r.style!="object")throw Error($t(62))}}function yS(n,r){if(n.indexOf("-")===-1)return typeof r.is=="string";switch(n){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var vS=null;function kT(n){return n=n.target||n.srcElement||window,n.correspondingUseElement&&(n=n.correspondingUseElement),n.nodeType===3?n.parentNode:n}var xS=null,Jf=null,Qf=null;function KC(n){if(n=N_(n)){if(typeof xS!="function")throw Error($t(280));var r=n.stateNode;r&&(r=Nx(r),xS(n.stateNode,n.type,r))}}function yM(n){Jf?Qf?Qf.push(n):Qf=[n]:Jf=n}function vM(){if(Jf){var n=Jf,r=Qf;if(Qf=Jf=null,KC(n),r)for(n=0;n<r.length;n++)KC(r[n])}}function xM(n,r){return n(r)}function bM(){}var vw=!1;function wM(n,r,c){if(vw)return n(r,c);vw=!0;try{return xM(n,r,c)}finally{vw=!1,(Jf!==null||Qf!==null)&&(bM(),vM())}}function h_(n,r){var c=n.stateNode;if(c===null)return null;var p=Nx(c);if(p===null)return null;c=p[r];e:switch(r){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(n=n.type,p=!(n==="button"||n==="input"||n==="select"||n==="textarea")),n=!p;break e;default:n=!1}if(n)return null;if(c&&typeof c!="function")throw Error($t(231,r,typeof c));return c}var bS=!1;if(ac)try{var Dg={};Object.defineProperty(Dg,"passive",{get:function(){bS=!0}}),window.addEventListener("test",Dg,Dg),window.removeEventListener("test",Dg,Dg)}catch{bS=!1}function jF(n,r,c,p,v,w,A,o,D){var j=Array.prototype.slice.call(arguments,3);try{r.apply(c,j)}catch(J){this.onError(J)}}var Jg=!1,Y0=null,J0=!1,wS=null,NF={onError:function(n){Jg=!0,Y0=n}};function UF(n,r,c,p,v,w,A,o,D){Jg=!1,Y0=null,jF.apply(NF,arguments)}function VF(n,r,c,p,v,w,A,o,D){if(UF.apply(this,arguments),Jg){if(Jg){var j=Y0;Jg=!1,Y0=null}else throw Error($t(198));J0||(J0=!0,wS=j)}}function Qh(n){var r=n,c=n;if(n.alternate)for(;r.return;)r=r.return;else{n=r;do r=n,r.flags&4098&&(c=r.return),n=r.return;while(n)}return r.tag===3?c:null}function SM(n){if(n.tag===13){var r=n.memoizedState;if(r===null&&(n=n.alternate,n!==null&&(r=n.memoizedState)),r!==null)return r.dehydrated}return null}function YC(n){if(Qh(n)!==n)throw Error($t(188))}function $F(n){var r=n.alternate;if(!r){if(r=Qh(n),r===null)throw Error($t(188));return r!==n?null:n}for(var c=n,p=r;;){var v=c.return;if(v===null)break;var w=v.alternate;if(w===null){if(p=v.return,p!==null){c=p;continue}break}if(v.child===w.child){for(w=v.child;w;){if(w===c)return YC(v),n;if(w===p)return YC(v),r;w=w.sibling}throw Error($t(188))}if(c.return!==p.return)c=v,p=w;else{for(var A=!1,o=v.child;o;){if(o===c){A=!0,c=v,p=w;break}if(o===p){A=!0,p=v,c=w;break}o=o.sibling}if(!A){for(o=w.child;o;){if(o===c){A=!0,c=w,p=v;break}if(o===p){A=!0,p=w,c=v;break}o=o.sibling}if(!A)throw Error($t(189))}}if(c.alternate!==p)throw Error($t(190))}if(c.tag!==3)throw Error($t(188));return c.stateNode.current===c?n:r}function TM(n){return n=$F(n),n!==null?EM(n):null}function EM(n){if(n.tag===5||n.tag===6)return n;for(n=n.child;n!==null;){var r=EM(n);if(r!==null)return r;n=n.sibling}return null}var IM=Ko.unstable_scheduleCallback,JC=Ko.unstable_cancelCallback,GF=Ko.unstable_shouldYield,HF=Ko.unstable_requestPaint,On=Ko.unstable_now,WF=Ko.unstable_getCurrentPriorityLevel,LT=Ko.unstable_ImmediatePriority,AM=Ko.unstable_UserBlockingPriority,Q0=Ko.unstable_NormalPriority,qF=Ko.unstable_LowPriority,CM=Ko.unstable_IdlePriority,zx=null,Ll=null;function ZF(n){if(Ll&&typeof Ll.onCommitFiberRoot=="function")try{Ll.onCommitFiberRoot(zx,n,void 0,(n.current.flags&128)===128)}catch{}}var Ka=Math.clz32?Math.clz32:YF,XF=Math.log,KF=Math.LN2;function YF(n){return n>>>=0,n===0?32:31-(XF(n)/KF|0)|0}var g0=64,_0=4194304;function qg(n){switch(n&-n){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return n&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return n&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return n}}function ex(n,r){var c=n.pendingLanes;if(c===0)return 0;var p=0,v=n.suspendedLanes,w=n.pingedLanes,A=c&268435455;if(A!==0){var o=A&~v;o!==0?p=qg(o):(w&=A,w!==0&&(p=qg(w)))}else A=c&~v,A!==0?p=qg(A):w!==0&&(p=qg(w));if(p===0)return 0;if(r!==0&&r!==p&&!(r&v)&&(v=p&-p,w=r&-r,v>=w||v===16&&(w&4194240)!==0))return r;if(p&4&&(p|=c&16),r=n.entangledLanes,r!==0)for(n=n.entanglements,r&=p;0<r;)c=31-Ka(r),v=1<<c,p|=n[c],r&=~v;return p}function JF(n,r){switch(n){case 1:case 2:case 4:return r+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return r+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function QF(n,r){for(var c=n.suspendedLanes,p=n.pingedLanes,v=n.expirationTimes,w=n.pendingLanes;0<w;){var A=31-Ka(w),o=1<<A,D=v[A];D===-1?(!(o&c)||o&p)&&(v[A]=JF(o,r)):D<=r&&(n.expiredLanes|=o),w&=~o}}function SS(n){return n=n.pendingLanes&-1073741825,n!==0?n:n&1073741824?1073741824:0}function kM(){var n=g0;return g0<<=1,!(g0&4194240)&&(g0=64),n}function xw(n){for(var r=[],c=0;31>c;c++)r.push(n);return r}function F_(n,r,c){n.pendingLanes|=r,r!==536870912&&(n.suspendedLanes=0,n.pingedLanes=0),n=n.eventTimes,r=31-Ka(r),n[r]=c}function e5(n,r){var c=n.pendingLanes&~r;n.pendingLanes=r,n.suspendedLanes=0,n.pingedLanes=0,n.expiredLanes&=r,n.mutableReadLanes&=r,n.entangledLanes&=r,r=n.entanglements;var p=n.eventTimes;for(n=n.expirationTimes;0<c;){var v=31-Ka(c),w=1<<v;r[v]=0,p[v]=-1,n[v]=-1,c&=~w}}function PT(n,r){var c=n.entangledLanes|=r;for(n=n.entanglements;c;){var p=31-Ka(c),v=1<<p;v&r|n[p]&r&&(n[p]|=r),c&=~v}}var $r=0;function LM(n){return n&=-n,1<n?4<n?n&268435455?16:536870912:4:1}var PM,MT,MM,RM,DM,TS=!1,y0=[],_u=null,yu=null,vu=null,d_=new Map,f_=new Map,uu=[],t5="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function QC(n,r){switch(n){case"focusin":case"focusout":_u=null;break;case"dragenter":case"dragleave":yu=null;break;case"mouseover":case"mouseout":vu=null;break;case"pointerover":case"pointerout":d_.delete(r.pointerId);break;case"gotpointercapture":case"lostpointercapture":f_.delete(r.pointerId)}}function Og(n,r,c,p,v,w){return n===null||n.nativeEvent!==w?(n={blockedOn:r,domEventName:c,eventSystemFlags:p,nativeEvent:w,targetContainers:[v]},r!==null&&(r=N_(r),r!==null&&MT(r)),n):(n.eventSystemFlags|=p,r=n.targetContainers,v!==null&&r.indexOf(v)===-1&&r.push(v),n)}function i5(n,r,c,p,v){switch(r){case"focusin":return _u=Og(_u,n,r,c,p,v),!0;case"dragenter":return yu=Og(yu,n,r,c,p,v),!0;case"mouseover":return vu=Og(vu,n,r,c,p,v),!0;case"pointerover":var w=v.pointerId;return d_.set(w,Og(d_.get(w)||null,n,r,c,p,v)),!0;case"gotpointercapture":return w=v.pointerId,f_.set(w,Og(f_.get(w)||null,n,r,c,p,v)),!0}return!1}function OM(n){var r=Uh(n.target);if(r!==null){var c=Qh(r);if(c!==null){if(r=c.tag,r===13){if(r=SM(c),r!==null){n.blockedOn=r,DM(n.priority,function(){MM(c)});return}}else if(r===3&&c.stateNode.current.memoizedState.isDehydrated){n.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}n.blockedOn=null}function N0(n){if(n.blockedOn!==null)return!1;for(var r=n.targetContainers;0<r.length;){var c=ES(n.domEventName,n.eventSystemFlags,r[0],n.nativeEvent);if(c===null){c=n.nativeEvent;var p=new c.constructor(c.type,c);vS=p,c.target.dispatchEvent(p),vS=null}else return r=N_(c),r!==null&&MT(r),n.blockedOn=c,!1;r.shift()}return!0}function ek(n,r,c){N0(n)&&c.delete(r)}function r5(){TS=!1,_u!==null&&N0(_u)&&(_u=null),yu!==null&&N0(yu)&&(yu=null),vu!==null&&N0(vu)&&(vu=null),d_.forEach(ek),f_.forEach(ek)}function zg(n,r){n.blockedOn===r&&(n.blockedOn=null,TS||(TS=!0,Ko.unstable_scheduleCallback(Ko.unstable_NormalPriority,r5)))}function p_(n){function r(v){return zg(v,n)}if(0<y0.length){zg(y0[0],n);for(var c=1;c<y0.length;c++){var p=y0[c];p.blockedOn===n&&(p.blockedOn=null)}}for(_u!==null&&zg(_u,n),yu!==null&&zg(yu,n),vu!==null&&zg(vu,n),d_.forEach(r),f_.forEach(r),c=0;c<uu.length;c++)p=uu[c],p.blockedOn===n&&(p.blockedOn=null);for(;0<uu.length&&(c=uu[0],c.blockedOn===null);)OM(c),c.blockedOn===null&&uu.shift()}var ep=dc.ReactCurrentBatchConfig,tx=!0;function n5(n,r,c,p){var v=$r,w=ep.transition;ep.transition=null;try{$r=1,RT(n,r,c,p)}finally{$r=v,ep.transition=w}}function s5(n,r,c,p){var v=$r,w=ep.transition;ep.transition=null;try{$r=4,RT(n,r,c,p)}finally{$r=v,ep.transition=w}}function RT(n,r,c,p){if(tx){var v=ES(n,r,c,p);if(v===null)Lw(n,r,p,ix,c),QC(n,p);else if(i5(v,n,r,c,p))p.stopPropagation();else if(QC(n,p),r&4&&-1<t5.indexOf(n)){for(;v!==null;){var w=N_(v);if(w!==null&&PM(w),w=ES(n,r,c,p),w===null&&Lw(n,r,p,ix,c),w===v)break;v=w}v!==null&&p.stopPropagation()}else Lw(n,r,p,null,c)}}var ix=null;function ES(n,r,c,p){if(ix=null,n=kT(p),n=Uh(n),n!==null)if(r=Qh(n),r===null)n=null;else if(c=r.tag,c===13){if(n=SM(r),n!==null)return n;n=null}else if(c===3){if(r.stateNode.current.memoizedState.isDehydrated)return r.tag===3?r.stateNode.containerInfo:null;n=null}else r!==n&&(n=null);return ix=n,null}function zM(n){switch(n){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(WF()){case LT:return 1;case AM:return 4;case Q0:case qF:return 16;case CM:return 536870912;default:return 16}default:return 16}}var fu=null,DT=null,U0=null;function BM(){if(U0)return U0;var n,r=DT,c=r.length,p,v="value"in fu?fu.value:fu.textContent,w=v.length;for(n=0;n<c&&r[n]===v[n];n++);var A=c-n;for(p=1;p<=A&&r[c-p]===v[w-p];p++);return U0=v.slice(n,1<p?1-p:void 0)}function V0(n){var r=n.keyCode;return"charCode"in n?(n=n.charCode,n===0&&r===13&&(n=13)):n=r,n===10&&(n=13),32<=n||n===13?n:0}function v0(){return!0}function tk(){return!1}function Jo(n){function r(c,p,v,w,A){this._reactName=c,this._targetInst=v,this.type=p,this.nativeEvent=w,this.target=A,this.currentTarget=null;for(var o in n)n.hasOwnProperty(o)&&(c=n[o],this[o]=c?c(w):w[o]);return this.isDefaultPrevented=(w.defaultPrevented!=null?w.defaultPrevented:w.returnValue===!1)?v0:tk,this.isPropagationStopped=tk,this}return bn(r.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=v0)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=v0)},persist:function(){},isPersistent:v0}),r}var mp={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(n){return n.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},OT=Jo(mp),j_=bn({},mp,{view:0,detail:0}),o5=Jo(j_),bw,ww,Bg,Bx=bn({},j_,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zT,button:0,buttons:0,relatedTarget:function(n){return n.relatedTarget===void 0?n.fromElement===n.srcElement?n.toElement:n.fromElement:n.relatedTarget},movementX:function(n){return"movementX"in n?n.movementX:(n!==Bg&&(Bg&&n.type==="mousemove"?(bw=n.screenX-Bg.screenX,ww=n.screenY-Bg.screenY):ww=bw=0,Bg=n),bw)},movementY:function(n){return"movementY"in n?n.movementY:ww}}),ik=Jo(Bx),a5=bn({},Bx,{dataTransfer:0}),l5=Jo(a5),c5=bn({},j_,{relatedTarget:0}),Sw=Jo(c5),u5=bn({},mp,{animationName:0,elapsedTime:0,pseudoElement:0}),h5=Jo(u5),d5=bn({},mp,{clipboardData:function(n){return"clipboardData"in n?n.clipboardData:window.clipboardData}}),f5=Jo(d5),p5=bn({},mp,{data:0}),rk=Jo(p5),m5={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},g5={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_5={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function y5(n){var r=this.nativeEvent;return r.getModifierState?r.getModifierState(n):(n=_5[n])?!!r[n]:!1}function zT(){return y5}var v5=bn({},j_,{key:function(n){if(n.key){var r=m5[n.key]||n.key;if(r!=="Unidentified")return r}return n.type==="keypress"?(n=V0(n),n===13?"Enter":String.fromCharCode(n)):n.type==="keydown"||n.type==="keyup"?g5[n.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zT,charCode:function(n){return n.type==="keypress"?V0(n):0},keyCode:function(n){return n.type==="keydown"||n.type==="keyup"?n.keyCode:0},which:function(n){return n.type==="keypress"?V0(n):n.type==="keydown"||n.type==="keyup"?n.keyCode:0}}),x5=Jo(v5),b5=bn({},Bx,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nk=Jo(b5),w5=bn({},j_,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zT}),S5=Jo(w5),T5=bn({},mp,{propertyName:0,elapsedTime:0,pseudoElement:0}),E5=Jo(T5),I5=bn({},Bx,{deltaX:function(n){return"deltaX"in n?n.deltaX:"wheelDeltaX"in n?-n.wheelDeltaX:0},deltaY:function(n){return"deltaY"in n?n.deltaY:"wheelDeltaY"in n?-n.wheelDeltaY:"wheelDelta"in n?-n.wheelDelta:0},deltaZ:0,deltaMode:0}),A5=Jo(I5),C5=[9,13,27,32],BT=ac&&"CompositionEvent"in window,Qg=null;ac&&"documentMode"in document&&(Qg=document.documentMode);var k5=ac&&"TextEvent"in window&&!Qg,FM=ac&&(!BT||Qg&&8<Qg&&11>=Qg),sk=" ",ok=!1;function jM(n,r){switch(n){case"keyup":return C5.indexOf(r.keyCode)!==-1;case"keydown":return r.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function NM(n){return n=n.detail,typeof n=="object"&&"data"in n?n.data:null}var jf=!1;function L5(n,r){switch(n){case"compositionend":return NM(r);case"keypress":return r.which!==32?null:(ok=!0,sk);case"textInput":return n=r.data,n===sk&&ok?null:n;default:return null}}function P5(n,r){if(jf)return n==="compositionend"||!BT&&jM(n,r)?(n=BM(),U0=DT=fu=null,jf=!1,n):null;switch(n){case"paste":return null;case"keypress":if(!(r.ctrlKey||r.altKey||r.metaKey)||r.ctrlKey&&r.altKey){if(r.char&&1<r.char.length)return r.char;if(r.which)return String.fromCharCode(r.which)}return null;case"compositionend":return FM&&r.locale!=="ko"?null:r.data;default:return null}}var M5={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function ak(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r==="input"?!!M5[n.type]:r==="textarea"}function UM(n,r,c,p){yM(p),r=rx(r,"onChange"),0<r.length&&(c=new OT("onChange","change",null,c,p),n.push({event:c,listeners:r}))}var e_=null,m_=null;function R5(n){JM(n,0)}function Fx(n){var r=Vf(n);if(hM(r))return n}function D5(n,r){if(n==="change")return r}var VM=!1;if(ac){var Tw;if(ac){var Ew="oninput"in document;if(!Ew){var lk=document.createElement("div");lk.setAttribute("oninput","return;"),Ew=typeof lk.oninput=="function"}Tw=Ew}else Tw=!1;VM=Tw&&(!document.documentMode||9<document.documentMode)}function ck(){e_&&(e_.detachEvent("onpropertychange",$M),m_=e_=null)}function $M(n){if(n.propertyName==="value"&&Fx(m_)){var r=[];UM(r,m_,n,kT(n)),wM(R5,r)}}function O5(n,r,c){n==="focusin"?(ck(),e_=r,m_=c,e_.attachEvent("onpropertychange",$M)):n==="focusout"&&ck()}function z5(n){if(n==="selectionchange"||n==="keyup"||n==="keydown")return Fx(m_)}function B5(n,r){if(n==="click")return Fx(r)}function F5(n,r){if(n==="input"||n==="change")return Fx(r)}function j5(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var Ja=typeof Object.is=="function"?Object.is:j5;function g_(n,r){if(Ja(n,r))return!0;if(typeof n!="object"||n===null||typeof r!="object"||r===null)return!1;var c=Object.keys(n),p=Object.keys(r);if(c.length!==p.length)return!1;for(p=0;p<c.length;p++){var v=c[p];if(!aS.call(r,v)||!Ja(n[v],r[v]))return!1}return!0}function uk(n){for(;n&&n.firstChild;)n=n.firstChild;return n}function hk(n,r){var c=uk(n);n=0;for(var p;c;){if(c.nodeType===3){if(p=n+c.textContent.length,n<=r&&p>=r)return{node:c,offset:r-n};n=p}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=uk(c)}}function GM(n,r){return n&&r?n===r?!0:n&&n.nodeType===3?!1:r&&r.nodeType===3?GM(n,r.parentNode):"contains"in n?n.contains(r):n.compareDocumentPosition?!!(n.compareDocumentPosition(r)&16):!1:!1}function HM(){for(var n=window,r=K0();r instanceof n.HTMLIFrameElement;){try{var c=typeof r.contentWindow.location.href=="string"}catch{c=!1}if(c)n=r.contentWindow;else break;r=K0(n.document)}return r}function FT(n){var r=n&&n.nodeName&&n.nodeName.toLowerCase();return r&&(r==="input"&&(n.type==="text"||n.type==="search"||n.type==="tel"||n.type==="url"||n.type==="password")||r==="textarea"||n.contentEditable==="true")}function N5(n){var r=HM(),c=n.focusedElem,p=n.selectionRange;if(r!==c&&c&&c.ownerDocument&&GM(c.ownerDocument.documentElement,c)){if(p!==null&&FT(c)){if(r=p.start,n=p.end,n===void 0&&(n=r),"selectionStart"in c)c.selectionStart=r,c.selectionEnd=Math.min(n,c.value.length);else if(n=(r=c.ownerDocument||document)&&r.defaultView||window,n.getSelection){n=n.getSelection();var v=c.textContent.length,w=Math.min(p.start,v);p=p.end===void 0?w:Math.min(p.end,v),!n.extend&&w>p&&(v=p,p=w,w=v),v=hk(c,w);var A=hk(c,p);v&&A&&(n.rangeCount!==1||n.anchorNode!==v.node||n.anchorOffset!==v.offset||n.focusNode!==A.node||n.focusOffset!==A.offset)&&(r=r.createRange(),r.setStart(v.node,v.offset),n.removeAllRanges(),w>p?(n.addRange(r),n.extend(A.node,A.offset)):(r.setEnd(A.node,A.offset),n.addRange(r)))}}for(r=[],n=c;n=n.parentNode;)n.nodeType===1&&r.push({element:n,left:n.scrollLeft,top:n.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<r.length;c++)n=r[c],n.element.scrollLeft=n.left,n.element.scrollTop=n.top}}var U5=ac&&"documentMode"in document&&11>=document.documentMode,Nf=null,IS=null,t_=null,AS=!1;function dk(n,r,c){var p=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;AS||Nf==null||Nf!==K0(p)||(p=Nf,"selectionStart"in p&&FT(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),t_&&g_(t_,p)||(t_=p,p=rx(IS,"onSelect"),0<p.length&&(r=new OT("onSelect","select",null,r,c),n.push({event:r,listeners:p}),r.target=Nf)))}function x0(n,r){var c={};return c[n.toLowerCase()]=r.toLowerCase(),c["Webkit"+n]="webkit"+r,c["Moz"+n]="moz"+r,c}var Uf={animationend:x0("Animation","AnimationEnd"),animationiteration:x0("Animation","AnimationIteration"),animationstart:x0("Animation","AnimationStart"),transitionend:x0("Transition","TransitionEnd")},Iw={},WM={};ac&&(WM=document.createElement("div").style,"AnimationEvent"in window||(delete Uf.animationend.animation,delete Uf.animationiteration.animation,delete Uf.animationstart.animation),"TransitionEvent"in window||delete Uf.transitionend.transition);function jx(n){if(Iw[n])return Iw[n];if(!Uf[n])return n;var r=Uf[n],c;for(c in r)if(r.hasOwnProperty(c)&&c in WM)return Iw[n]=r[c];return n}var qM=jx("animationend"),ZM=jx("animationiteration"),XM=jx("animationstart"),KM=jx("transitionend"),YM=new Map,fk="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Cu(n,r){YM.set(n,r),Jh(r,[n])}for(var Aw=0;Aw<fk.length;Aw++){var Cw=fk[Aw],V5=Cw.toLowerCase(),$5=Cw[0].toUpperCase()+Cw.slice(1);Cu(V5,"on"+$5)}Cu(qM,"onAnimationEnd");Cu(ZM,"onAnimationIteration");Cu(XM,"onAnimationStart");Cu("dblclick","onDoubleClick");Cu("focusin","onFocus");Cu("focusout","onBlur");Cu(KM,"onTransitionEnd");sp("onMouseEnter",["mouseout","mouseover"]);sp("onMouseLeave",["mouseout","mouseover"]);sp("onPointerEnter",["pointerout","pointerover"]);sp("onPointerLeave",["pointerout","pointerover"]);Jh("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Jh("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Jh("onBeforeInput",["compositionend","keypress","textInput","paste"]);Jh("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Jh("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Jh("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zg="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),G5=new Set("cancel close invalid load scroll toggle".split(" ").concat(Zg));function pk(n,r,c){var p=n.type||"unknown-event";n.currentTarget=c,VF(p,r,void 0,n),n.currentTarget=null}function JM(n,r){r=(r&4)!==0;for(var c=0;c<n.length;c++){var p=n[c],v=p.event;p=p.listeners;e:{var w=void 0;if(r)for(var A=p.length-1;0<=A;A--){var o=p[A],D=o.instance,j=o.currentTarget;if(o=o.listener,D!==w&&v.isPropagationStopped())break e;pk(v,o,j),w=D}else for(A=0;A<p.length;A++){if(o=p[A],D=o.instance,j=o.currentTarget,o=o.listener,D!==w&&v.isPropagationStopped())break e;pk(v,o,j),w=D}}}if(J0)throw n=wS,J0=!1,wS=null,n}function on(n,r){var c=r[MS];c===void 0&&(c=r[MS]=new Set);var p=n+"__bubble";c.has(p)||(QM(r,n,2,!1),c.add(p))}function kw(n,r,c){var p=0;r&&(p|=4),QM(c,n,p,r)}var b0="_reactListening"+Math.random().toString(36).slice(2);function __(n){if(!n[b0]){n[b0]=!0,oM.forEach(function(c){c!=="selectionchange"&&(G5.has(c)||kw(c,!1,n),kw(c,!0,n))});var r=n.nodeType===9?n:n.ownerDocument;r===null||r[b0]||(r[b0]=!0,kw("selectionchange",!1,r))}}function QM(n,r,c,p){switch(zM(r)){case 1:var v=n5;break;case 4:v=s5;break;default:v=RT}c=v.bind(null,r,c,n),v=void 0,!bS||r!=="touchstart"&&r!=="touchmove"&&r!=="wheel"||(v=!0),p?v!==void 0?n.addEventListener(r,c,{capture:!0,passive:v}):n.addEventListener(r,c,!0):v!==void 0?n.addEventListener(r,c,{passive:v}):n.addEventListener(r,c,!1)}function Lw(n,r,c,p,v){var w=p;if(!(r&1)&&!(r&2)&&p!==null)e:for(;;){if(p===null)return;var A=p.tag;if(A===3||A===4){var o=p.stateNode.containerInfo;if(o===v||o.nodeType===8&&o.parentNode===v)break;if(A===4)for(A=p.return;A!==null;){var D=A.tag;if((D===3||D===4)&&(D=A.stateNode.containerInfo,D===v||D.nodeType===8&&D.parentNode===v))return;A=A.return}for(;o!==null;){if(A=Uh(o),A===null)return;if(D=A.tag,D===5||D===6){p=w=A;continue e}o=o.parentNode}}p=p.return}wM(function(){var j=w,J=kT(c),ie=[];e:{var re=YM.get(n);if(re!==void 0){var he=OT,ce=n;switch(n){case"keypress":if(V0(c)===0)break e;case"keydown":case"keyup":he=x5;break;case"focusin":ce="focus",he=Sw;break;case"focusout":ce="blur",he=Sw;break;case"beforeblur":case"afterblur":he=Sw;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":he=ik;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":he=l5;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":he=S5;break;case qM:case ZM:case XM:he=h5;break;case KM:he=E5;break;case"scroll":he=o5;break;case"wheel":he=A5;break;case"copy":case"cut":case"paste":he=f5;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":he=nk}var xe=(r&4)!==0,Ee=!xe&&n==="scroll",ve=xe?re!==null?re+"Capture":null:re;xe=[];for(var K=j,fe;K!==null;){fe=K;var ke=fe.stateNode;if(fe.tag===5&&ke!==null&&(fe=ke,ve!==null&&(ke=h_(K,ve),ke!=null&&xe.push(y_(K,ke,fe)))),Ee)break;K=K.return}0<xe.length&&(re=new he(re,ce,null,c,J),ie.push({event:re,listeners:xe}))}}if(!(r&7)){e:{if(re=n==="mouseover"||n==="pointerover",he=n==="mouseout"||n==="pointerout",re&&c!==vS&&(ce=c.relatedTarget||c.fromElement)&&(Uh(ce)||ce[lc]))break e;if((he||re)&&(re=J.window===J?J:(re=J.ownerDocument)?re.defaultView||re.parentWindow:window,he?(ce=c.relatedTarget||c.toElement,he=j,ce=ce?Uh(ce):null,ce!==null&&(Ee=Qh(ce),ce!==Ee||ce.tag!==5&&ce.tag!==6)&&(ce=null)):(he=null,ce=j),he!==ce)){if(xe=ik,ke="onMouseLeave",ve="onMouseEnter",K="mouse",(n==="pointerout"||n==="pointerover")&&(xe=nk,ke="onPointerLeave",ve="onPointerEnter",K="pointer"),Ee=he==null?re:Vf(he),fe=ce==null?re:Vf(ce),re=new xe(ke,K+"leave",he,c,J),re.target=Ee,re.relatedTarget=fe,ke=null,Uh(J)===j&&(xe=new xe(ve,K+"enter",ce,c,J),xe.target=fe,xe.relatedTarget=Ee,ke=xe),Ee=ke,he&&ce)t:{for(xe=he,ve=ce,K=0,fe=xe;fe;fe=Ef(fe))K++;for(fe=0,ke=ve;ke;ke=Ef(ke))fe++;for(;0<K-fe;)xe=Ef(xe),K--;for(;0<fe-K;)ve=Ef(ve),fe--;for(;K--;){if(xe===ve||ve!==null&&xe===ve.alternate)break t;xe=Ef(xe),ve=Ef(ve)}xe=null}else xe=null;he!==null&&mk(ie,re,he,xe,!1),ce!==null&&Ee!==null&&mk(ie,Ee,ce,xe,!0)}}e:{if(re=j?Vf(j):window,he=re.nodeName&&re.nodeName.toLowerCase(),he==="select"||he==="input"&&re.type==="file")var Be=D5;else if(ak(re))if(VM)Be=F5;else{Be=z5;var Le=O5}else(he=re.nodeName)&&he.toLowerCase()==="input"&&(re.type==="checkbox"||re.type==="radio")&&(Be=B5);if(Be&&(Be=Be(n,j))){UM(ie,Be,c,J);break e}Le&&Le(n,re,j),n==="focusout"&&(Le=re._wrapperState)&&Le.controlled&&re.type==="number"&&pS(re,"number",re.value)}switch(Le=j?Vf(j):window,n){case"focusin":(ak(Le)||Le.contentEditable==="true")&&(Nf=Le,IS=j,t_=null);break;case"focusout":t_=IS=Nf=null;break;case"mousedown":AS=!0;break;case"contextmenu":case"mouseup":case"dragend":AS=!1,dk(ie,c,J);break;case"selectionchange":if(U5)break;case"keydown":case"keyup":dk(ie,c,J)}var We;if(BT)e:{switch(n){case"compositionstart":var ct="onCompositionStart";break e;case"compositionend":ct="onCompositionEnd";break e;case"compositionupdate":ct="onCompositionUpdate";break e}ct=void 0}else jf?jM(n,c)&&(ct="onCompositionEnd"):n==="keydown"&&c.keyCode===229&&(ct="onCompositionStart");ct&&(FM&&c.locale!=="ko"&&(jf||ct!=="onCompositionStart"?ct==="onCompositionEnd"&&jf&&(We=BM()):(fu=J,DT="value"in fu?fu.value:fu.textContent,jf=!0)),Le=rx(j,ct),0<Le.length&&(ct=new rk(ct,n,null,c,J),ie.push({event:ct,listeners:Le}),We?ct.data=We:(We=NM(c),We!==null&&(ct.data=We)))),(We=k5?L5(n,c):P5(n,c))&&(j=rx(j,"onBeforeInput"),0<j.length&&(J=new rk("onBeforeInput","beforeinput",null,c,J),ie.push({event:J,listeners:j}),J.data=We))}JM(ie,r)})}function y_(n,r,c){return{instance:n,listener:r,currentTarget:c}}function rx(n,r){for(var c=r+"Capture",p=[];n!==null;){var v=n,w=v.stateNode;v.tag===5&&w!==null&&(v=w,w=h_(n,c),w!=null&&p.unshift(y_(n,w,v)),w=h_(n,r),w!=null&&p.push(y_(n,w,v))),n=n.return}return p}function Ef(n){if(n===null)return null;do n=n.return;while(n&&n.tag!==5);return n||null}function mk(n,r,c,p,v){for(var w=r._reactName,A=[];c!==null&&c!==p;){var o=c,D=o.alternate,j=o.stateNode;if(D!==null&&D===p)break;o.tag===5&&j!==null&&(o=j,v?(D=h_(c,w),D!=null&&A.unshift(y_(c,D,o))):v||(D=h_(c,w),D!=null&&A.push(y_(c,D,o)))),c=c.return}A.length!==0&&n.push({event:r,listeners:A})}var H5=/\r\n?/g,W5=/\u0000|\uFFFD/g;function gk(n){return(typeof n=="string"?n:""+n).replace(H5,`
`).replace(W5,"")}function w0(n,r,c){if(r=gk(r),gk(n)!==r&&c)throw Error($t(425))}function nx(){}var CS=null,kS=null;function LS(n,r){return n==="textarea"||n==="noscript"||typeof r.children=="string"||typeof r.children=="number"||typeof r.dangerouslySetInnerHTML=="object"&&r.dangerouslySetInnerHTML!==null&&r.dangerouslySetInnerHTML.__html!=null}var PS=typeof setTimeout=="function"?setTimeout:void 0,q5=typeof clearTimeout=="function"?clearTimeout:void 0,_k=typeof Promise=="function"?Promise:void 0,Z5=typeof queueMicrotask=="function"?queueMicrotask:typeof _k<"u"?function(n){return _k.resolve(null).then(n).catch(X5)}:PS;function X5(n){setTimeout(function(){throw n})}function Pw(n,r){var c=r,p=0;do{var v=c.nextSibling;if(n.removeChild(c),v&&v.nodeType===8)if(c=v.data,c==="/$"){if(p===0){n.removeChild(v),p_(r);return}p--}else c!=="$"&&c!=="$?"&&c!=="$!"||p++;c=v}while(c);p_(r)}function xu(n){for(;n!=null;n=n.nextSibling){var r=n.nodeType;if(r===1||r===3)break;if(r===8){if(r=n.data,r==="$"||r==="$!"||r==="$?")break;if(r==="/$")return null}}return n}function yk(n){n=n.previousSibling;for(var r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="$"||c==="$!"||c==="$?"){if(r===0)return n;r--}else c==="/$"&&r++}n=n.previousSibling}return null}var gp=Math.random().toString(36).slice(2),kl="__reactFiber$"+gp,v_="__reactProps$"+gp,lc="__reactContainer$"+gp,MS="__reactEvents$"+gp,K5="__reactListeners$"+gp,Y5="__reactHandles$"+gp;function Uh(n){var r=n[kl];if(r)return r;for(var c=n.parentNode;c;){if(r=c[lc]||c[kl]){if(c=r.alternate,r.child!==null||c!==null&&c.child!==null)for(n=yk(n);n!==null;){if(c=n[kl])return c;n=yk(n)}return r}n=c,c=n.parentNode}return null}function N_(n){return n=n[kl]||n[lc],!n||n.tag!==5&&n.tag!==6&&n.tag!==13&&n.tag!==3?null:n}function Vf(n){if(n.tag===5||n.tag===6)return n.stateNode;throw Error($t(33))}function Nx(n){return n[v_]||null}var RS=[],$f=-1;function ku(n){return{current:n}}function an(n){0>$f||(n.current=RS[$f],RS[$f]=null,$f--)}function Kr(n,r){$f++,RS[$f]=n.current,n.current=r}var Au={},qs=ku(Au),Io=ku(!1),qh=Au;function op(n,r){var c=n.type.contextTypes;if(!c)return Au;var p=n.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===r)return p.__reactInternalMemoizedMaskedChildContext;var v={},w;for(w in c)v[w]=r[w];return p&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=r,n.__reactInternalMemoizedMaskedChildContext=v),v}function Ao(n){return n=n.childContextTypes,n!=null}function sx(){an(Io),an(qs)}function vk(n,r,c){if(qs.current!==Au)throw Error($t(168));Kr(qs,r),Kr(Io,c)}function eR(n,r,c){var p=n.stateNode;if(r=r.childContextTypes,typeof p.getChildContext!="function")return c;p=p.getChildContext();for(var v in p)if(!(v in r))throw Error($t(108,OF(n)||"Unknown",v));return bn({},c,p)}function ox(n){return n=(n=n.stateNode)&&n.__reactInternalMemoizedMergedChildContext||Au,qh=qs.current,Kr(qs,n),Kr(Io,Io.current),!0}function xk(n,r,c){var p=n.stateNode;if(!p)throw Error($t(169));c?(n=eR(n,r,qh),p.__reactInternalMemoizedMergedChildContext=n,an(Io),an(qs),Kr(qs,n)):an(Io),Kr(Io,c)}var rc=null,Ux=!1,Mw=!1;function tR(n){rc===null?rc=[n]:rc.push(n)}function J5(n){Ux=!0,tR(n)}function Lu(){if(!Mw&&rc!==null){Mw=!0;var n=0,r=$r;try{var c=rc;for($r=1;n<c.length;n++){var p=c[n];do p=p(!0);while(p!==null)}rc=null,Ux=!1}catch(v){throw rc!==null&&(rc=rc.slice(n+1)),IM(LT,Lu),v}finally{$r=r,Mw=!1}}return null}var Gf=[],Hf=0,ax=null,lx=0,va=[],xa=0,Zh=null,nc=1,sc="";function Oh(n,r){Gf[Hf++]=lx,Gf[Hf++]=ax,ax=n,lx=r}function iR(n,r,c){va[xa++]=nc,va[xa++]=sc,va[xa++]=Zh,Zh=n;var p=nc;n=sc;var v=32-Ka(p)-1;p&=~(1<<v),c+=1;var w=32-Ka(r)+v;if(30<w){var A=v-v%5;w=(p&(1<<A)-1).toString(32),p>>=A,v-=A,nc=1<<32-Ka(r)+v|c<<v|p,sc=w+n}else nc=1<<w|c<<v|p,sc=n}function jT(n){n.return!==null&&(Oh(n,1),iR(n,1,0))}function NT(n){for(;n===ax;)ax=Gf[--Hf],Gf[Hf]=null,lx=Gf[--Hf],Gf[Hf]=null;for(;n===Zh;)Zh=va[--xa],va[xa]=null,sc=va[--xa],va[xa]=null,nc=va[--xa],va[xa]=null}var Xo=null,Zo=null,dn=!1,Xa=null;function rR(n,r){var c=ba(5,null,null,0);c.elementType="DELETED",c.stateNode=r,c.return=n,r=n.deletions,r===null?(n.deletions=[c],n.flags|=16):r.push(c)}function bk(n,r){switch(n.tag){case 5:var c=n.type;return r=r.nodeType!==1||c.toLowerCase()!==r.nodeName.toLowerCase()?null:r,r!==null?(n.stateNode=r,Xo=n,Zo=xu(r.firstChild),!0):!1;case 6:return r=n.pendingProps===""||r.nodeType!==3?null:r,r!==null?(n.stateNode=r,Xo=n,Zo=null,!0):!1;case 13:return r=r.nodeType!==8?null:r,r!==null?(c=Zh!==null?{id:nc,overflow:sc}:null,n.memoizedState={dehydrated:r,treeContext:c,retryLane:1073741824},c=ba(18,null,null,0),c.stateNode=r,c.return=n,n.child=c,Xo=n,Zo=null,!0):!1;default:return!1}}function DS(n){return(n.mode&1)!==0&&(n.flags&128)===0}function OS(n){if(dn){var r=Zo;if(r){var c=r;if(!bk(n,r)){if(DS(n))throw Error($t(418));r=xu(c.nextSibling);var p=Xo;r&&bk(n,r)?rR(p,c):(n.flags=n.flags&-4097|2,dn=!1,Xo=n)}}else{if(DS(n))throw Error($t(418));n.flags=n.flags&-4097|2,dn=!1,Xo=n}}}function wk(n){for(n=n.return;n!==null&&n.tag!==5&&n.tag!==3&&n.tag!==13;)n=n.return;Xo=n}function S0(n){if(n!==Xo)return!1;if(!dn)return wk(n),dn=!0,!1;var r;if((r=n.tag!==3)&&!(r=n.tag!==5)&&(r=n.type,r=r!=="head"&&r!=="body"&&!LS(n.type,n.memoizedProps)),r&&(r=Zo)){if(DS(n))throw nR(),Error($t(418));for(;r;)rR(n,r),r=xu(r.nextSibling)}if(wk(n),n.tag===13){if(n=n.memoizedState,n=n!==null?n.dehydrated:null,!n)throw Error($t(317));e:{for(n=n.nextSibling,r=0;n;){if(n.nodeType===8){var c=n.data;if(c==="/$"){if(r===0){Zo=xu(n.nextSibling);break e}r--}else c!=="$"&&c!=="$!"&&c!=="$?"||r++}n=n.nextSibling}Zo=null}}else Zo=Xo?xu(n.stateNode.nextSibling):null;return!0}function nR(){for(var n=Zo;n;)n=xu(n.nextSibling)}function ap(){Zo=Xo=null,dn=!1}function UT(n){Xa===null?Xa=[n]:Xa.push(n)}var Q5=dc.ReactCurrentBatchConfig;function Fg(n,r,c){if(n=c.ref,n!==null&&typeof n!="function"&&typeof n!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error($t(309));var p=c.stateNode}if(!p)throw Error($t(147,n));var v=p,w=""+n;return r!==null&&r.ref!==null&&typeof r.ref=="function"&&r.ref._stringRef===w?r.ref:(r=function(A){var o=v.refs;A===null?delete o[w]:o[w]=A},r._stringRef=w,r)}if(typeof n!="string")throw Error($t(284));if(!c._owner)throw Error($t(290,n))}return n}function T0(n,r){throw n=Object.prototype.toString.call(r),Error($t(31,n==="[object Object]"?"object with keys {"+Object.keys(r).join(", ")+"}":n))}function Sk(n){var r=n._init;return r(n._payload)}function sR(n){function r(ve,K){if(n){var fe=ve.deletions;fe===null?(ve.deletions=[K],ve.flags|=16):fe.push(K)}}function c(ve,K){if(!n)return null;for(;K!==null;)r(ve,K),K=K.sibling;return null}function p(ve,K){for(ve=new Map;K!==null;)K.key!==null?ve.set(K.key,K):ve.set(K.index,K),K=K.sibling;return ve}function v(ve,K){return ve=Tu(ve,K),ve.index=0,ve.sibling=null,ve}function w(ve,K,fe){return ve.index=fe,n?(fe=ve.alternate,fe!==null?(fe=fe.index,fe<K?(ve.flags|=2,K):fe):(ve.flags|=2,K)):(ve.flags|=1048576,K)}function A(ve){return n&&ve.alternate===null&&(ve.flags|=2),ve}function o(ve,K,fe,ke){return K===null||K.tag!==6?(K=jw(fe,ve.mode,ke),K.return=ve,K):(K=v(K,fe),K.return=ve,K)}function D(ve,K,fe,ke){var Be=fe.type;return Be===Ff?J(ve,K,fe.props.children,ke,fe.key):K!==null&&(K.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===ou&&Sk(Be)===K.type)?(ke=v(K,fe.props),ke.ref=Fg(ve,K,fe),ke.return=ve,ke):(ke=X0(fe.type,fe.key,fe.props,null,ve.mode,ke),ke.ref=Fg(ve,K,fe),ke.return=ve,ke)}function j(ve,K,fe,ke){return K===null||K.tag!==4||K.stateNode.containerInfo!==fe.containerInfo||K.stateNode.implementation!==fe.implementation?(K=Nw(fe,ve.mode,ke),K.return=ve,K):(K=v(K,fe.children||[]),K.return=ve,K)}function J(ve,K,fe,ke,Be){return K===null||K.tag!==7?(K=Wh(fe,ve.mode,ke,Be),K.return=ve,K):(K=v(K,fe),K.return=ve,K)}function ie(ve,K,fe){if(typeof K=="string"&&K!==""||typeof K=="number")return K=jw(""+K,ve.mode,fe),K.return=ve,K;if(typeof K=="object"&&K!==null){switch(K.$$typeof){case f0:return fe=X0(K.type,K.key,K.props,null,ve.mode,fe),fe.ref=Fg(ve,null,K),fe.return=ve,fe;case Bf:return K=Nw(K,ve.mode,fe),K.return=ve,K;case ou:var ke=K._init;return ie(ve,ke(K._payload),fe)}if(Wg(K)||Rg(K))return K=Wh(K,ve.mode,fe,null),K.return=ve,K;T0(ve,K)}return null}function re(ve,K,fe,ke){var Be=K!==null?K.key:null;if(typeof fe=="string"&&fe!==""||typeof fe=="number")return Be!==null?null:o(ve,K,""+fe,ke);if(typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case f0:return fe.key===Be?D(ve,K,fe,ke):null;case Bf:return fe.key===Be?j(ve,K,fe,ke):null;case ou:return Be=fe._init,re(ve,K,Be(fe._payload),ke)}if(Wg(fe)||Rg(fe))return Be!==null?null:J(ve,K,fe,ke,null);T0(ve,fe)}return null}function he(ve,K,fe,ke,Be){if(typeof ke=="string"&&ke!==""||typeof ke=="number")return ve=ve.get(fe)||null,o(K,ve,""+ke,Be);if(typeof ke=="object"&&ke!==null){switch(ke.$$typeof){case f0:return ve=ve.get(ke.key===null?fe:ke.key)||null,D(K,ve,ke,Be);case Bf:return ve=ve.get(ke.key===null?fe:ke.key)||null,j(K,ve,ke,Be);case ou:var Le=ke._init;return he(ve,K,fe,Le(ke._payload),Be)}if(Wg(ke)||Rg(ke))return ve=ve.get(fe)||null,J(K,ve,ke,Be,null);T0(K,ke)}return null}function ce(ve,K,fe,ke){for(var Be=null,Le=null,We=K,ct=K=0,lt=null;We!==null&&ct<fe.length;ct++){We.index>ct?(lt=We,We=null):lt=We.sibling;var Pt=re(ve,We,fe[ct],ke);if(Pt===null){We===null&&(We=lt);break}n&&We&&Pt.alternate===null&&r(ve,We),K=w(Pt,K,ct),Le===null?Be=Pt:Le.sibling=Pt,Le=Pt,We=lt}if(ct===fe.length)return c(ve,We),dn&&Oh(ve,ct),Be;if(We===null){for(;ct<fe.length;ct++)We=ie(ve,fe[ct],ke),We!==null&&(K=w(We,K,ct),Le===null?Be=We:Le.sibling=We,Le=We);return dn&&Oh(ve,ct),Be}for(We=p(ve,We);ct<fe.length;ct++)lt=he(We,ve,ct,fe[ct],ke),lt!==null&&(n&&lt.alternate!==null&&We.delete(lt.key===null?ct:lt.key),K=w(lt,K,ct),Le===null?Be=lt:Le.sibling=lt,Le=lt);return n&&We.forEach(function(zt){return r(ve,zt)}),dn&&Oh(ve,ct),Be}function xe(ve,K,fe,ke){var Be=Rg(fe);if(typeof Be!="function")throw Error($t(150));if(fe=Be.call(fe),fe==null)throw Error($t(151));for(var Le=Be=null,We=K,ct=K=0,lt=null,Pt=fe.next();We!==null&&!Pt.done;ct++,Pt=fe.next()){We.index>ct?(lt=We,We=null):lt=We.sibling;var zt=re(ve,We,Pt.value,ke);if(zt===null){We===null&&(We=lt);break}n&&We&&zt.alternate===null&&r(ve,We),K=w(zt,K,ct),Le===null?Be=zt:Le.sibling=zt,Le=zt,We=lt}if(Pt.done)return c(ve,We),dn&&Oh(ve,ct),Be;if(We===null){for(;!Pt.done;ct++,Pt=fe.next())Pt=ie(ve,Pt.value,ke),Pt!==null&&(K=w(Pt,K,ct),Le===null?Be=Pt:Le.sibling=Pt,Le=Pt);return dn&&Oh(ve,ct),Be}for(We=p(ve,We);!Pt.done;ct++,Pt=fe.next())Pt=he(We,ve,ct,Pt.value,ke),Pt!==null&&(n&&Pt.alternate!==null&&We.delete(Pt.key===null?ct:Pt.key),K=w(Pt,K,ct),Le===null?Be=Pt:Le.sibling=Pt,Le=Pt);return n&&We.forEach(function(_i){return r(ve,_i)}),dn&&Oh(ve,ct),Be}function Ee(ve,K,fe,ke){if(typeof fe=="object"&&fe!==null&&fe.type===Ff&&fe.key===null&&(fe=fe.props.children),typeof fe=="object"&&fe!==null){switch(fe.$$typeof){case f0:e:{for(var Be=fe.key,Le=K;Le!==null;){if(Le.key===Be){if(Be=fe.type,Be===Ff){if(Le.tag===7){c(ve,Le.sibling),K=v(Le,fe.props.children),K.return=ve,ve=K;break e}}else if(Le.elementType===Be||typeof Be=="object"&&Be!==null&&Be.$$typeof===ou&&Sk(Be)===Le.type){c(ve,Le.sibling),K=v(Le,fe.props),K.ref=Fg(ve,Le,fe),K.return=ve,ve=K;break e}c(ve,Le);break}else r(ve,Le);Le=Le.sibling}fe.type===Ff?(K=Wh(fe.props.children,ve.mode,ke,fe.key),K.return=ve,ve=K):(ke=X0(fe.type,fe.key,fe.props,null,ve.mode,ke),ke.ref=Fg(ve,K,fe),ke.return=ve,ve=ke)}return A(ve);case Bf:e:{for(Le=fe.key;K!==null;){if(K.key===Le)if(K.tag===4&&K.stateNode.containerInfo===fe.containerInfo&&K.stateNode.implementation===fe.implementation){c(ve,K.sibling),K=v(K,fe.children||[]),K.return=ve,ve=K;break e}else{c(ve,K);break}else r(ve,K);K=K.sibling}K=Nw(fe,ve.mode,ke),K.return=ve,ve=K}return A(ve);case ou:return Le=fe._init,Ee(ve,K,Le(fe._payload),ke)}if(Wg(fe))return ce(ve,K,fe,ke);if(Rg(fe))return xe(ve,K,fe,ke);T0(ve,fe)}return typeof fe=="string"&&fe!==""||typeof fe=="number"?(fe=""+fe,K!==null&&K.tag===6?(c(ve,K.sibling),K=v(K,fe),K.return=ve,ve=K):(c(ve,K),K=jw(fe,ve.mode,ke),K.return=ve,ve=K),A(ve)):c(ve,K)}return Ee}var lp=sR(!0),oR=sR(!1),cx=ku(null),ux=null,Wf=null,VT=null;function $T(){VT=Wf=ux=null}function GT(n){var r=cx.current;an(cx),n._currentValue=r}function zS(n,r,c){for(;n!==null;){var p=n.alternate;if((n.childLanes&r)!==r?(n.childLanes|=r,p!==null&&(p.childLanes|=r)):p!==null&&(p.childLanes&r)!==r&&(p.childLanes|=r),n===c)break;n=n.return}}function tp(n,r){ux=n,VT=Wf=null,n=n.dependencies,n!==null&&n.firstContext!==null&&(n.lanes&r&&(Eo=!0),n.firstContext=null)}function Sa(n){var r=n._currentValue;if(VT!==n)if(n={context:n,memoizedValue:r,next:null},Wf===null){if(ux===null)throw Error($t(308));Wf=n,ux.dependencies={lanes:0,firstContext:n}}else Wf=Wf.next=n;return r}var Vh=null;function HT(n){Vh===null?Vh=[n]:Vh.push(n)}function aR(n,r,c,p){var v=r.interleaved;return v===null?(c.next=c,HT(r)):(c.next=v.next,v.next=c),r.interleaved=c,cc(n,p)}function cc(n,r){n.lanes|=r;var c=n.alternate;for(c!==null&&(c.lanes|=r),c=n,n=n.return;n!==null;)n.childLanes|=r,c=n.alternate,c!==null&&(c.childLanes|=r),c=n,n=n.return;return c.tag===3?c.stateNode:null}var au=!1;function WT(n){n.updateQueue={baseState:n.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lR(n,r){n=n.updateQueue,r.updateQueue===n&&(r.updateQueue={baseState:n.baseState,firstBaseUpdate:n.firstBaseUpdate,lastBaseUpdate:n.lastBaseUpdate,shared:n.shared,effects:n.effects})}function oc(n,r){return{eventTime:n,lane:r,tag:0,payload:null,callback:null,next:null}}function bu(n,r,c){var p=n.updateQueue;if(p===null)return null;if(p=p.shared,Pr&2){var v=p.pending;return v===null?r.next=r:(r.next=v.next,v.next=r),p.pending=r,cc(n,c)}return v=p.interleaved,v===null?(r.next=r,HT(p)):(r.next=v.next,v.next=r),p.interleaved=r,cc(n,c)}function $0(n,r,c){if(r=r.updateQueue,r!==null&&(r=r.shared,(c&4194240)!==0)){var p=r.lanes;p&=n.pendingLanes,c|=p,r.lanes=c,PT(n,c)}}function Tk(n,r){var c=n.updateQueue,p=n.alternate;if(p!==null&&(p=p.updateQueue,c===p)){var v=null,w=null;if(c=c.firstBaseUpdate,c!==null){do{var A={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};w===null?v=w=A:w=w.next=A,c=c.next}while(c!==null);w===null?v=w=r:w=w.next=r}else v=w=r;c={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:w,shared:p.shared,effects:p.effects},n.updateQueue=c;return}n=c.lastBaseUpdate,n===null?c.firstBaseUpdate=r:n.next=r,c.lastBaseUpdate=r}function hx(n,r,c,p){var v=n.updateQueue;au=!1;var w=v.firstBaseUpdate,A=v.lastBaseUpdate,o=v.shared.pending;if(o!==null){v.shared.pending=null;var D=o,j=D.next;D.next=null,A===null?w=j:A.next=j,A=D;var J=n.alternate;J!==null&&(J=J.updateQueue,o=J.lastBaseUpdate,o!==A&&(o===null?J.firstBaseUpdate=j:o.next=j,J.lastBaseUpdate=D))}if(w!==null){var ie=v.baseState;A=0,J=j=D=null,o=w;do{var re=o.lane,he=o.eventTime;if((p&re)===re){J!==null&&(J=J.next={eventTime:he,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var ce=n,xe=o;switch(re=r,he=c,xe.tag){case 1:if(ce=xe.payload,typeof ce=="function"){ie=ce.call(he,ie,re);break e}ie=ce;break e;case 3:ce.flags=ce.flags&-65537|128;case 0:if(ce=xe.payload,re=typeof ce=="function"?ce.call(he,ie,re):ce,re==null)break e;ie=bn({},ie,re);break e;case 2:au=!0}}o.callback!==null&&o.lane!==0&&(n.flags|=64,re=v.effects,re===null?v.effects=[o]:re.push(o))}else he={eventTime:he,lane:re,tag:o.tag,payload:o.payload,callback:o.callback,next:null},J===null?(j=J=he,D=ie):J=J.next=he,A|=re;if(o=o.next,o===null){if(o=v.shared.pending,o===null)break;re=o,o=re.next,re.next=null,v.lastBaseUpdate=re,v.shared.pending=null}}while(!0);if(J===null&&(D=ie),v.baseState=D,v.firstBaseUpdate=j,v.lastBaseUpdate=J,r=v.shared.interleaved,r!==null){v=r;do A|=v.lane,v=v.next;while(v!==r)}else w===null&&(v.shared.lanes=0);Kh|=A,n.lanes=A,n.memoizedState=ie}}function Ek(n,r,c){if(n=r.effects,r.effects=null,n!==null)for(r=0;r<n.length;r++){var p=n[r],v=p.callback;if(v!==null){if(p.callback=null,p=c,typeof v!="function")throw Error($t(191,v));v.call(p)}}}var U_={},Pl=ku(U_),x_=ku(U_),b_=ku(U_);function $h(n){if(n===U_)throw Error($t(174));return n}function qT(n,r){switch(Kr(b_,r),Kr(x_,n),Kr(Pl,U_),n=r.nodeType,n){case 9:case 11:r=(r=r.documentElement)?r.namespaceURI:gS(null,"");break;default:n=n===8?r.parentNode:r,r=n.namespaceURI||null,n=n.tagName,r=gS(r,n)}an(Pl),Kr(Pl,r)}function cp(){an(Pl),an(x_),an(b_)}function cR(n){$h(b_.current);var r=$h(Pl.current),c=gS(r,n.type);r!==c&&(Kr(x_,n),Kr(Pl,c))}function ZT(n){x_.current===n&&(an(Pl),an(x_))}var yn=ku(0);function dx(n){for(var r=n;r!==null;){if(r.tag===13){var c=r.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return r}else if(r.tag===19&&r.memoizedProps.revealOrder!==void 0){if(r.flags&128)return r}else if(r.child!==null){r.child.return=r,r=r.child;continue}if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return null;r=r.return}r.sibling.return=r.return,r=r.sibling}return null}var Rw=[];function XT(){for(var n=0;n<Rw.length;n++)Rw[n]._workInProgressVersionPrimary=null;Rw.length=0}var G0=dc.ReactCurrentDispatcher,Dw=dc.ReactCurrentBatchConfig,Xh=0,vn=null,Yn=null,ps=null,fx=!1,i_=!1,w_=0,ej=0;function $s(){throw Error($t(321))}function KT(n,r){if(r===null)return!1;for(var c=0;c<r.length&&c<n.length;c++)if(!Ja(n[c],r[c]))return!1;return!0}function YT(n,r,c,p,v,w){if(Xh=w,vn=r,r.memoizedState=null,r.updateQueue=null,r.lanes=0,G0.current=n===null||n.memoizedState===null?nj:sj,n=c(p,v),i_){w=0;do{if(i_=!1,w_=0,25<=w)throw Error($t(301));w+=1,ps=Yn=null,r.updateQueue=null,G0.current=oj,n=c(p,v)}while(i_)}if(G0.current=px,r=Yn!==null&&Yn.next!==null,Xh=0,ps=Yn=vn=null,fx=!1,r)throw Error($t(300));return n}function JT(){var n=w_!==0;return w_=0,n}function Cl(){var n={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ps===null?vn.memoizedState=ps=n:ps=ps.next=n,ps}function Ta(){if(Yn===null){var n=vn.alternate;n=n!==null?n.memoizedState:null}else n=Yn.next;var r=ps===null?vn.memoizedState:ps.next;if(r!==null)ps=r,Yn=n;else{if(n===null)throw Error($t(310));Yn=n,n={memoizedState:Yn.memoizedState,baseState:Yn.baseState,baseQueue:Yn.baseQueue,queue:Yn.queue,next:null},ps===null?vn.memoizedState=ps=n:ps=ps.next=n}return ps}function S_(n,r){return typeof r=="function"?r(n):r}function Ow(n){var r=Ta(),c=r.queue;if(c===null)throw Error($t(311));c.lastRenderedReducer=n;var p=Yn,v=p.baseQueue,w=c.pending;if(w!==null){if(v!==null){var A=v.next;v.next=w.next,w.next=A}p.baseQueue=v=w,c.pending=null}if(v!==null){w=v.next,p=p.baseState;var o=A=null,D=null,j=w;do{var J=j.lane;if((Xh&J)===J)D!==null&&(D=D.next={lane:0,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null}),p=j.hasEagerState?j.eagerState:n(p,j.action);else{var ie={lane:J,action:j.action,hasEagerState:j.hasEagerState,eagerState:j.eagerState,next:null};D===null?(o=D=ie,A=p):D=D.next=ie,vn.lanes|=J,Kh|=J}j=j.next}while(j!==null&&j!==w);D===null?A=p:D.next=o,Ja(p,r.memoizedState)||(Eo=!0),r.memoizedState=p,r.baseState=A,r.baseQueue=D,c.lastRenderedState=p}if(n=c.interleaved,n!==null){v=n;do w=v.lane,vn.lanes|=w,Kh|=w,v=v.next;while(v!==n)}else v===null&&(c.lanes=0);return[r.memoizedState,c.dispatch]}function zw(n){var r=Ta(),c=r.queue;if(c===null)throw Error($t(311));c.lastRenderedReducer=n;var p=c.dispatch,v=c.pending,w=r.memoizedState;if(v!==null){c.pending=null;var A=v=v.next;do w=n(w,A.action),A=A.next;while(A!==v);Ja(w,r.memoizedState)||(Eo=!0),r.memoizedState=w,r.baseQueue===null&&(r.baseState=w),c.lastRenderedState=w}return[w,p]}function uR(){}function hR(n,r){var c=vn,p=Ta(),v=r(),w=!Ja(p.memoizedState,v);if(w&&(p.memoizedState=v,Eo=!0),p=p.queue,QT(pR.bind(null,c,p,n),[n]),p.getSnapshot!==r||w||ps!==null&&ps.memoizedState.tag&1){if(c.flags|=2048,T_(9,fR.bind(null,c,p,v,r),void 0,null),ms===null)throw Error($t(349));Xh&30||dR(c,r,v)}return v}function dR(n,r,c){n.flags|=16384,n={getSnapshot:r,value:c},r=vn.updateQueue,r===null?(r={lastEffect:null,stores:null},vn.updateQueue=r,r.stores=[n]):(c=r.stores,c===null?r.stores=[n]:c.push(n))}function fR(n,r,c,p){r.value=c,r.getSnapshot=p,mR(r)&&gR(n)}function pR(n,r,c){return c(function(){mR(r)&&gR(n)})}function mR(n){var r=n.getSnapshot;n=n.value;try{var c=r();return!Ja(n,c)}catch{return!0}}function gR(n){var r=cc(n,1);r!==null&&Ya(r,n,1,-1)}function Ik(n){var r=Cl();return typeof n=="function"&&(n=n()),r.memoizedState=r.baseState=n,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:S_,lastRenderedState:n},r.queue=n,n=n.dispatch=rj.bind(null,vn,n),[r.memoizedState,n]}function T_(n,r,c,p){return n={tag:n,create:r,destroy:c,deps:p,next:null},r=vn.updateQueue,r===null?(r={lastEffect:null,stores:null},vn.updateQueue=r,r.lastEffect=n.next=n):(c=r.lastEffect,c===null?r.lastEffect=n.next=n:(p=c.next,c.next=n,n.next=p,r.lastEffect=n)),n}function _R(){return Ta().memoizedState}function H0(n,r,c,p){var v=Cl();vn.flags|=n,v.memoizedState=T_(1|r,c,void 0,p===void 0?null:p)}function Vx(n,r,c,p){var v=Ta();p=p===void 0?null:p;var w=void 0;if(Yn!==null){var A=Yn.memoizedState;if(w=A.destroy,p!==null&&KT(p,A.deps)){v.memoizedState=T_(r,c,w,p);return}}vn.flags|=n,v.memoizedState=T_(1|r,c,w,p)}function Ak(n,r){return H0(8390656,8,n,r)}function QT(n,r){return Vx(2048,8,n,r)}function yR(n,r){return Vx(4,2,n,r)}function vR(n,r){return Vx(4,4,n,r)}function xR(n,r){if(typeof r=="function")return n=n(),r(n),function(){r(null)};if(r!=null)return n=n(),r.current=n,function(){r.current=null}}function bR(n,r,c){return c=c!=null?c.concat([n]):null,Vx(4,4,xR.bind(null,r,n),c)}function e2(){}function wR(n,r){var c=Ta();r=r===void 0?null:r;var p=c.memoizedState;return p!==null&&r!==null&&KT(r,p[1])?p[0]:(c.memoizedState=[n,r],n)}function SR(n,r){var c=Ta();r=r===void 0?null:r;var p=c.memoizedState;return p!==null&&r!==null&&KT(r,p[1])?p[0]:(n=n(),c.memoizedState=[n,r],n)}function TR(n,r,c){return Xh&21?(Ja(c,r)||(c=kM(),vn.lanes|=c,Kh|=c,n.baseState=!0),r):(n.baseState&&(n.baseState=!1,Eo=!0),n.memoizedState=c)}function tj(n,r){var c=$r;$r=c!==0&&4>c?c:4,n(!0);var p=Dw.transition;Dw.transition={};try{n(!1),r()}finally{$r=c,Dw.transition=p}}function ER(){return Ta().memoizedState}function ij(n,r,c){var p=Su(n);if(c={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null},IR(n))AR(r,c);else if(c=aR(n,r,c,p),c!==null){var v=uo();Ya(c,n,p,v),CR(c,r,p)}}function rj(n,r,c){var p=Su(n),v={lane:p,action:c,hasEagerState:!1,eagerState:null,next:null};if(IR(n))AR(r,v);else{var w=n.alternate;if(n.lanes===0&&(w===null||w.lanes===0)&&(w=r.lastRenderedReducer,w!==null))try{var A=r.lastRenderedState,o=w(A,c);if(v.hasEagerState=!0,v.eagerState=o,Ja(o,A)){var D=r.interleaved;D===null?(v.next=v,HT(r)):(v.next=D.next,D.next=v),r.interleaved=v;return}}catch{}finally{}c=aR(n,r,v,p),c!==null&&(v=uo(),Ya(c,n,p,v),CR(c,r,p))}}function IR(n){var r=n.alternate;return n===vn||r!==null&&r===vn}function AR(n,r){i_=fx=!0;var c=n.pending;c===null?r.next=r:(r.next=c.next,c.next=r),n.pending=r}function CR(n,r,c){if(c&4194240){var p=r.lanes;p&=n.pendingLanes,c|=p,r.lanes=c,PT(n,c)}}var px={readContext:Sa,useCallback:$s,useContext:$s,useEffect:$s,useImperativeHandle:$s,useInsertionEffect:$s,useLayoutEffect:$s,useMemo:$s,useReducer:$s,useRef:$s,useState:$s,useDebugValue:$s,useDeferredValue:$s,useTransition:$s,useMutableSource:$s,useSyncExternalStore:$s,useId:$s,unstable_isNewReconciler:!1},nj={readContext:Sa,useCallback:function(n,r){return Cl().memoizedState=[n,r===void 0?null:r],n},useContext:Sa,useEffect:Ak,useImperativeHandle:function(n,r,c){return c=c!=null?c.concat([n]):null,H0(4194308,4,xR.bind(null,r,n),c)},useLayoutEffect:function(n,r){return H0(4194308,4,n,r)},useInsertionEffect:function(n,r){return H0(4,2,n,r)},useMemo:function(n,r){var c=Cl();return r=r===void 0?null:r,n=n(),c.memoizedState=[n,r],n},useReducer:function(n,r,c){var p=Cl();return r=c!==void 0?c(r):r,p.memoizedState=p.baseState=r,n={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:n,lastRenderedState:r},p.queue=n,n=n.dispatch=ij.bind(null,vn,n),[p.memoizedState,n]},useRef:function(n){var r=Cl();return n={current:n},r.memoizedState=n},useState:Ik,useDebugValue:e2,useDeferredValue:function(n){return Cl().memoizedState=n},useTransition:function(){var n=Ik(!1),r=n[0];return n=tj.bind(null,n[1]),Cl().memoizedState=n,[r,n]},useMutableSource:function(){},useSyncExternalStore:function(n,r,c){var p=vn,v=Cl();if(dn){if(c===void 0)throw Error($t(407));c=c()}else{if(c=r(),ms===null)throw Error($t(349));Xh&30||dR(p,r,c)}v.memoizedState=c;var w={value:c,getSnapshot:r};return v.queue=w,Ak(pR.bind(null,p,w,n),[n]),p.flags|=2048,T_(9,fR.bind(null,p,w,c,r),void 0,null),c},useId:function(){var n=Cl(),r=ms.identifierPrefix;if(dn){var c=sc,p=nc;c=(p&~(1<<32-Ka(p)-1)).toString(32)+c,r=":"+r+"R"+c,c=w_++,0<c&&(r+="H"+c.toString(32)),r+=":"}else c=ej++,r=":"+r+"r"+c.toString(32)+":";return n.memoizedState=r},unstable_isNewReconciler:!1},sj={readContext:Sa,useCallback:wR,useContext:Sa,useEffect:QT,useImperativeHandle:bR,useInsertionEffect:yR,useLayoutEffect:vR,useMemo:SR,useReducer:Ow,useRef:_R,useState:function(){return Ow(S_)},useDebugValue:e2,useDeferredValue:function(n){var r=Ta();return TR(r,Yn.memoizedState,n)},useTransition:function(){var n=Ow(S_)[0],r=Ta().memoizedState;return[n,r]},useMutableSource:uR,useSyncExternalStore:hR,useId:ER,unstable_isNewReconciler:!1},oj={readContext:Sa,useCallback:wR,useContext:Sa,useEffect:QT,useImperativeHandle:bR,useInsertionEffect:yR,useLayoutEffect:vR,useMemo:SR,useReducer:zw,useRef:_R,useState:function(){return zw(S_)},useDebugValue:e2,useDeferredValue:function(n){var r=Ta();return Yn===null?r.memoizedState=n:TR(r,Yn.memoizedState,n)},useTransition:function(){var n=zw(S_)[0],r=Ta().memoizedState;return[n,r]},useMutableSource:uR,useSyncExternalStore:hR,useId:ER,unstable_isNewReconciler:!1};function Wa(n,r){if(n&&n.defaultProps){r=bn({},r),n=n.defaultProps;for(var c in n)r[c]===void 0&&(r[c]=n[c]);return r}return r}function BS(n,r,c,p){r=n.memoizedState,c=c(p,r),c=c==null?r:bn({},r,c),n.memoizedState=c,n.lanes===0&&(n.updateQueue.baseState=c)}var $x={isMounted:function(n){return(n=n._reactInternals)?Qh(n)===n:!1},enqueueSetState:function(n,r,c){n=n._reactInternals;var p=uo(),v=Su(n),w=oc(p,v);w.payload=r,c!=null&&(w.callback=c),r=bu(n,w,v),r!==null&&(Ya(r,n,v,p),$0(r,n,v))},enqueueReplaceState:function(n,r,c){n=n._reactInternals;var p=uo(),v=Su(n),w=oc(p,v);w.tag=1,w.payload=r,c!=null&&(w.callback=c),r=bu(n,w,v),r!==null&&(Ya(r,n,v,p),$0(r,n,v))},enqueueForceUpdate:function(n,r){n=n._reactInternals;var c=uo(),p=Su(n),v=oc(c,p);v.tag=2,r!=null&&(v.callback=r),r=bu(n,v,p),r!==null&&(Ya(r,n,p,c),$0(r,n,p))}};function Ck(n,r,c,p,v,w,A){return n=n.stateNode,typeof n.shouldComponentUpdate=="function"?n.shouldComponentUpdate(p,w,A):r.prototype&&r.prototype.isPureReactComponent?!g_(c,p)||!g_(v,w):!0}function kR(n,r,c){var p=!1,v=Au,w=r.contextType;return typeof w=="object"&&w!==null?w=Sa(w):(v=Ao(r)?qh:qs.current,p=r.contextTypes,w=(p=p!=null)?op(n,v):Au),r=new r(c,w),n.memoizedState=r.state!==null&&r.state!==void 0?r.state:null,r.updater=$x,n.stateNode=r,r._reactInternals=n,p&&(n=n.stateNode,n.__reactInternalMemoizedUnmaskedChildContext=v,n.__reactInternalMemoizedMaskedChildContext=w),r}function kk(n,r,c,p){n=r.state,typeof r.componentWillReceiveProps=="function"&&r.componentWillReceiveProps(c,p),typeof r.UNSAFE_componentWillReceiveProps=="function"&&r.UNSAFE_componentWillReceiveProps(c,p),r.state!==n&&$x.enqueueReplaceState(r,r.state,null)}function FS(n,r,c,p){var v=n.stateNode;v.props=c,v.state=n.memoizedState,v.refs={},WT(n);var w=r.contextType;typeof w=="object"&&w!==null?v.context=Sa(w):(w=Ao(r)?qh:qs.current,v.context=op(n,w)),v.state=n.memoizedState,w=r.getDerivedStateFromProps,typeof w=="function"&&(BS(n,r,w,c),v.state=n.memoizedState),typeof r.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(r=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),r!==v.state&&$x.enqueueReplaceState(v,v.state,null),hx(n,c,v,p),v.state=n.memoizedState),typeof v.componentDidMount=="function"&&(n.flags|=4194308)}function up(n,r){try{var c="",p=r;do c+=DF(p),p=p.return;while(p);var v=c}catch(w){v=`
Error generating stack: `+w.message+`
`+w.stack}return{value:n,source:r,stack:v,digest:null}}function Bw(n,r,c){return{value:n,source:null,stack:c??null,digest:r??null}}function jS(n,r){try{console.error(r.value)}catch(c){setTimeout(function(){throw c})}}var aj=typeof WeakMap=="function"?WeakMap:Map;function LR(n,r,c){c=oc(-1,c),c.tag=3,c.payload={element:null};var p=r.value;return c.callback=function(){gx||(gx=!0,XS=p),jS(n,r)},c}function PR(n,r,c){c=oc(-1,c),c.tag=3;var p=n.type.getDerivedStateFromError;if(typeof p=="function"){var v=r.value;c.payload=function(){return p(v)},c.callback=function(){jS(n,r)}}var w=n.stateNode;return w!==null&&typeof w.componentDidCatch=="function"&&(c.callback=function(){jS(n,r),typeof p!="function"&&(wu===null?wu=new Set([this]):wu.add(this));var A=r.stack;this.componentDidCatch(r.value,{componentStack:A!==null?A:""})}),c}function Lk(n,r,c){var p=n.pingCache;if(p===null){p=n.pingCache=new aj;var v=new Set;p.set(r,v)}else v=p.get(r),v===void 0&&(v=new Set,p.set(r,v));v.has(c)||(v.add(c),n=bj.bind(null,n,r,c),r.then(n,n))}function Pk(n){do{var r;if((r=n.tag===13)&&(r=n.memoizedState,r=r!==null?r.dehydrated!==null:!0),r)return n;n=n.return}while(n!==null);return null}function Mk(n,r,c,p,v){return n.mode&1?(n.flags|=65536,n.lanes=v,n):(n===r?n.flags|=65536:(n.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(r=oc(-1,1),r.tag=2,bu(c,r,1))),c.lanes|=1),n)}var lj=dc.ReactCurrentOwner,Eo=!1;function co(n,r,c,p){r.child=n===null?oR(r,null,c,p):lp(r,n.child,c,p)}function Rk(n,r,c,p,v){c=c.render;var w=r.ref;return tp(r,v),p=YT(n,r,c,p,w,v),c=JT(),n!==null&&!Eo?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~v,uc(n,r,v)):(dn&&c&&jT(r),r.flags|=1,co(n,r,p,v),r.child)}function Dk(n,r,c,p,v){if(n===null){var w=c.type;return typeof w=="function"&&!l2(w)&&w.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(r.tag=15,r.type=w,MR(n,r,w,p,v)):(n=X0(c.type,null,p,r,r.mode,v),n.ref=r.ref,n.return=r,r.child=n)}if(w=n.child,!(n.lanes&v)){var A=w.memoizedProps;if(c=c.compare,c=c!==null?c:g_,c(A,p)&&n.ref===r.ref)return uc(n,r,v)}return r.flags|=1,n=Tu(w,p),n.ref=r.ref,n.return=r,r.child=n}function MR(n,r,c,p,v){if(n!==null){var w=n.memoizedProps;if(g_(w,p)&&n.ref===r.ref)if(Eo=!1,r.pendingProps=p=w,(n.lanes&v)!==0)n.flags&131072&&(Eo=!0);else return r.lanes=n.lanes,uc(n,r,v)}return NS(n,r,c,p,v)}function RR(n,r,c){var p=r.pendingProps,v=p.children,w=n!==null?n.memoizedState:null;if(p.mode==="hidden")if(!(r.mode&1))r.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kr(Zf,Wo),Wo|=c;else{if(!(c&1073741824))return n=w!==null?w.baseLanes|c:c,r.lanes=r.childLanes=1073741824,r.memoizedState={baseLanes:n,cachePool:null,transitions:null},r.updateQueue=null,Kr(Zf,Wo),Wo|=n,null;r.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=w!==null?w.baseLanes:c,Kr(Zf,Wo),Wo|=p}else w!==null?(p=w.baseLanes|c,r.memoizedState=null):p=c,Kr(Zf,Wo),Wo|=p;return co(n,r,v,c),r.child}function DR(n,r){var c=r.ref;(n===null&&c!==null||n!==null&&n.ref!==c)&&(r.flags|=512,r.flags|=2097152)}function NS(n,r,c,p,v){var w=Ao(c)?qh:qs.current;return w=op(r,w),tp(r,v),c=YT(n,r,c,p,w,v),p=JT(),n!==null&&!Eo?(r.updateQueue=n.updateQueue,r.flags&=-2053,n.lanes&=~v,uc(n,r,v)):(dn&&p&&jT(r),r.flags|=1,co(n,r,c,v),r.child)}function Ok(n,r,c,p,v){if(Ao(c)){var w=!0;ox(r)}else w=!1;if(tp(r,v),r.stateNode===null)W0(n,r),kR(r,c,p),FS(r,c,p,v),p=!0;else if(n===null){var A=r.stateNode,o=r.memoizedProps;A.props=o;var D=A.context,j=c.contextType;typeof j=="object"&&j!==null?j=Sa(j):(j=Ao(c)?qh:qs.current,j=op(r,j));var J=c.getDerivedStateFromProps,ie=typeof J=="function"||typeof A.getSnapshotBeforeUpdate=="function";ie||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(o!==p||D!==j)&&kk(r,A,p,j),au=!1;var re=r.memoizedState;A.state=re,hx(r,p,A,v),D=r.memoizedState,o!==p||re!==D||Io.current||au?(typeof J=="function"&&(BS(r,c,J,p),D=r.memoizedState),(o=au||Ck(r,c,o,p,re,D,j))?(ie||typeof A.UNSAFE_componentWillMount!="function"&&typeof A.componentWillMount!="function"||(typeof A.componentWillMount=="function"&&A.componentWillMount(),typeof A.UNSAFE_componentWillMount=="function"&&A.UNSAFE_componentWillMount()),typeof A.componentDidMount=="function"&&(r.flags|=4194308)):(typeof A.componentDidMount=="function"&&(r.flags|=4194308),r.memoizedProps=p,r.memoizedState=D),A.props=p,A.state=D,A.context=j,p=o):(typeof A.componentDidMount=="function"&&(r.flags|=4194308),p=!1)}else{A=r.stateNode,lR(n,r),o=r.memoizedProps,j=r.type===r.elementType?o:Wa(r.type,o),A.props=j,ie=r.pendingProps,re=A.context,D=c.contextType,typeof D=="object"&&D!==null?D=Sa(D):(D=Ao(c)?qh:qs.current,D=op(r,D));var he=c.getDerivedStateFromProps;(J=typeof he=="function"||typeof A.getSnapshotBeforeUpdate=="function")||typeof A.UNSAFE_componentWillReceiveProps!="function"&&typeof A.componentWillReceiveProps!="function"||(o!==ie||re!==D)&&kk(r,A,p,D),au=!1,re=r.memoizedState,A.state=re,hx(r,p,A,v);var ce=r.memoizedState;o!==ie||re!==ce||Io.current||au?(typeof he=="function"&&(BS(r,c,he,p),ce=r.memoizedState),(j=au||Ck(r,c,j,p,re,ce,D)||!1)?(J||typeof A.UNSAFE_componentWillUpdate!="function"&&typeof A.componentWillUpdate!="function"||(typeof A.componentWillUpdate=="function"&&A.componentWillUpdate(p,ce,D),typeof A.UNSAFE_componentWillUpdate=="function"&&A.UNSAFE_componentWillUpdate(p,ce,D)),typeof A.componentDidUpdate=="function"&&(r.flags|=4),typeof A.getSnapshotBeforeUpdate=="function"&&(r.flags|=1024)):(typeof A.componentDidUpdate!="function"||o===n.memoizedProps&&re===n.memoizedState||(r.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&re===n.memoizedState||(r.flags|=1024),r.memoizedProps=p,r.memoizedState=ce),A.props=p,A.state=ce,A.context=D,p=j):(typeof A.componentDidUpdate!="function"||o===n.memoizedProps&&re===n.memoizedState||(r.flags|=4),typeof A.getSnapshotBeforeUpdate!="function"||o===n.memoizedProps&&re===n.memoizedState||(r.flags|=1024),p=!1)}return US(n,r,c,p,w,v)}function US(n,r,c,p,v,w){DR(n,r);var A=(r.flags&128)!==0;if(!p&&!A)return v&&xk(r,c,!1),uc(n,r,w);p=r.stateNode,lj.current=r;var o=A&&typeof c.getDerivedStateFromError!="function"?null:p.render();return r.flags|=1,n!==null&&A?(r.child=lp(r,n.child,null,w),r.child=lp(r,null,o,w)):co(n,r,o,w),r.memoizedState=p.state,v&&xk(r,c,!0),r.child}function OR(n){var r=n.stateNode;r.pendingContext?vk(n,r.pendingContext,r.pendingContext!==r.context):r.context&&vk(n,r.context,!1),qT(n,r.containerInfo)}function zk(n,r,c,p,v){return ap(),UT(v),r.flags|=256,co(n,r,c,p),r.child}var VS={dehydrated:null,treeContext:null,retryLane:0};function $S(n){return{baseLanes:n,cachePool:null,transitions:null}}function zR(n,r,c){var p=r.pendingProps,v=yn.current,w=!1,A=(r.flags&128)!==0,o;if((o=A)||(o=n!==null&&n.memoizedState===null?!1:(v&2)!==0),o?(w=!0,r.flags&=-129):(n===null||n.memoizedState!==null)&&(v|=1),Kr(yn,v&1),n===null)return OS(r),n=r.memoizedState,n!==null&&(n=n.dehydrated,n!==null)?(r.mode&1?n.data==="$!"?r.lanes=8:r.lanes=1073741824:r.lanes=1,null):(A=p.children,n=p.fallback,w?(p=r.mode,w=r.child,A={mode:"hidden",children:A},!(p&1)&&w!==null?(w.childLanes=0,w.pendingProps=A):w=Wx(A,p,0,null),n=Wh(n,p,c,null),w.return=r,n.return=r,w.sibling=n,r.child=w,r.child.memoizedState=$S(c),r.memoizedState=VS,n):t2(r,A));if(v=n.memoizedState,v!==null&&(o=v.dehydrated,o!==null))return cj(n,r,A,p,o,v,c);if(w){w=p.fallback,A=r.mode,v=n.child,o=v.sibling;var D={mode:"hidden",children:p.children};return!(A&1)&&r.child!==v?(p=r.child,p.childLanes=0,p.pendingProps=D,r.deletions=null):(p=Tu(v,D),p.subtreeFlags=v.subtreeFlags&14680064),o!==null?w=Tu(o,w):(w=Wh(w,A,c,null),w.flags|=2),w.return=r,p.return=r,p.sibling=w,r.child=p,p=w,w=r.child,A=n.child.memoizedState,A=A===null?$S(c):{baseLanes:A.baseLanes|c,cachePool:null,transitions:A.transitions},w.memoizedState=A,w.childLanes=n.childLanes&~c,r.memoizedState=VS,p}return w=n.child,n=w.sibling,p=Tu(w,{mode:"visible",children:p.children}),!(r.mode&1)&&(p.lanes=c),p.return=r,p.sibling=null,n!==null&&(c=r.deletions,c===null?(r.deletions=[n],r.flags|=16):c.push(n)),r.child=p,r.memoizedState=null,p}function t2(n,r){return r=Wx({mode:"visible",children:r},n.mode,0,null),r.return=n,n.child=r}function E0(n,r,c,p){return p!==null&&UT(p),lp(r,n.child,null,c),n=t2(r,r.pendingProps.children),n.flags|=2,r.memoizedState=null,n}function cj(n,r,c,p,v,w,A){if(c)return r.flags&256?(r.flags&=-257,p=Bw(Error($t(422))),E0(n,r,A,p)):r.memoizedState!==null?(r.child=n.child,r.flags|=128,null):(w=p.fallback,v=r.mode,p=Wx({mode:"visible",children:p.children},v,0,null),w=Wh(w,v,A,null),w.flags|=2,p.return=r,w.return=r,p.sibling=w,r.child=p,r.mode&1&&lp(r,n.child,null,A),r.child.memoizedState=$S(A),r.memoizedState=VS,w);if(!(r.mode&1))return E0(n,r,A,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var o=p.dgst;return p=o,w=Error($t(419)),p=Bw(w,p,void 0),E0(n,r,A,p)}if(o=(A&n.childLanes)!==0,Eo||o){if(p=ms,p!==null){switch(A&-A){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=v&(p.suspendedLanes|A)?0:v,v!==0&&v!==w.retryLane&&(w.retryLane=v,cc(n,v),Ya(p,n,v,-1))}return a2(),p=Bw(Error($t(421))),E0(n,r,A,p)}return v.data==="$?"?(r.flags|=128,r.child=n.child,r=wj.bind(null,n),v._reactRetry=r,null):(n=w.treeContext,Zo=xu(v.nextSibling),Xo=r,dn=!0,Xa=null,n!==null&&(va[xa++]=nc,va[xa++]=sc,va[xa++]=Zh,nc=n.id,sc=n.overflow,Zh=r),r=t2(r,p.children),r.flags|=4096,r)}function Bk(n,r,c){n.lanes|=r;var p=n.alternate;p!==null&&(p.lanes|=r),zS(n.return,r,c)}function Fw(n,r,c,p,v){var w=n.memoizedState;w===null?n.memoizedState={isBackwards:r,rendering:null,renderingStartTime:0,last:p,tail:c,tailMode:v}:(w.isBackwards=r,w.rendering=null,w.renderingStartTime=0,w.last=p,w.tail=c,w.tailMode=v)}function BR(n,r,c){var p=r.pendingProps,v=p.revealOrder,w=p.tail;if(co(n,r,p.children,c),p=yn.current,p&2)p=p&1|2,r.flags|=128;else{if(n!==null&&n.flags&128)e:for(n=r.child;n!==null;){if(n.tag===13)n.memoizedState!==null&&Bk(n,c,r);else if(n.tag===19)Bk(n,c,r);else if(n.child!==null){n.child.return=n,n=n.child;continue}if(n===r)break e;for(;n.sibling===null;){if(n.return===null||n.return===r)break e;n=n.return}n.sibling.return=n.return,n=n.sibling}p&=1}if(Kr(yn,p),!(r.mode&1))r.memoizedState=null;else switch(v){case"forwards":for(c=r.child,v=null;c!==null;)n=c.alternate,n!==null&&dx(n)===null&&(v=c),c=c.sibling;c=v,c===null?(v=r.child,r.child=null):(v=c.sibling,c.sibling=null),Fw(r,!1,v,c,w);break;case"backwards":for(c=null,v=r.child,r.child=null;v!==null;){if(n=v.alternate,n!==null&&dx(n)===null){r.child=v;break}n=v.sibling,v.sibling=c,c=v,v=n}Fw(r,!0,c,null,w);break;case"together":Fw(r,!1,null,null,void 0);break;default:r.memoizedState=null}return r.child}function W0(n,r){!(r.mode&1)&&n!==null&&(n.alternate=null,r.alternate=null,r.flags|=2)}function uc(n,r,c){if(n!==null&&(r.dependencies=n.dependencies),Kh|=r.lanes,!(c&r.childLanes))return null;if(n!==null&&r.child!==n.child)throw Error($t(153));if(r.child!==null){for(n=r.child,c=Tu(n,n.pendingProps),r.child=c,c.return=r;n.sibling!==null;)n=n.sibling,c=c.sibling=Tu(n,n.pendingProps),c.return=r;c.sibling=null}return r.child}function uj(n,r,c){switch(r.tag){case 3:OR(r),ap();break;case 5:cR(r);break;case 1:Ao(r.type)&&ox(r);break;case 4:qT(r,r.stateNode.containerInfo);break;case 10:var p=r.type._context,v=r.memoizedProps.value;Kr(cx,p._currentValue),p._currentValue=v;break;case 13:if(p=r.memoizedState,p!==null)return p.dehydrated!==null?(Kr(yn,yn.current&1),r.flags|=128,null):c&r.child.childLanes?zR(n,r,c):(Kr(yn,yn.current&1),n=uc(n,r,c),n!==null?n.sibling:null);Kr(yn,yn.current&1);break;case 19:if(p=(c&r.childLanes)!==0,n.flags&128){if(p)return BR(n,r,c);r.flags|=128}if(v=r.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),Kr(yn,yn.current),p)break;return null;case 22:case 23:return r.lanes=0,RR(n,r,c)}return uc(n,r,c)}var FR,GS,jR,NR;FR=function(n,r){for(var c=r.child;c!==null;){if(c.tag===5||c.tag===6)n.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===r)break;for(;c.sibling===null;){if(c.return===null||c.return===r)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};GS=function(){};jR=function(n,r,c,p){var v=n.memoizedProps;if(v!==p){n=r.stateNode,$h(Pl.current);var w=null;switch(c){case"input":v=dS(n,v),p=dS(n,p),w=[];break;case"select":v=bn({},v,{value:void 0}),p=bn({},p,{value:void 0}),w=[];break;case"textarea":v=mS(n,v),p=mS(n,p),w=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(n.onclick=nx)}_S(c,p);var A;c=null;for(j in v)if(!p.hasOwnProperty(j)&&v.hasOwnProperty(j)&&v[j]!=null)if(j==="style"){var o=v[j];for(A in o)o.hasOwnProperty(A)&&(c||(c={}),c[A]="")}else j!=="dangerouslySetInnerHTML"&&j!=="children"&&j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&j!=="autoFocus"&&(c_.hasOwnProperty(j)?w||(w=[]):(w=w||[]).push(j,null));for(j in p){var D=p[j];if(o=v!=null?v[j]:void 0,p.hasOwnProperty(j)&&D!==o&&(D!=null||o!=null))if(j==="style")if(o){for(A in o)!o.hasOwnProperty(A)||D&&D.hasOwnProperty(A)||(c||(c={}),c[A]="");for(A in D)D.hasOwnProperty(A)&&o[A]!==D[A]&&(c||(c={}),c[A]=D[A])}else c||(w||(w=[]),w.push(j,c)),c=D;else j==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,o=o?o.__html:void 0,D!=null&&o!==D&&(w=w||[]).push(j,D)):j==="children"?typeof D!="string"&&typeof D!="number"||(w=w||[]).push(j,""+D):j!=="suppressContentEditableWarning"&&j!=="suppressHydrationWarning"&&(c_.hasOwnProperty(j)?(D!=null&&j==="onScroll"&&on("scroll",n),w||o===D||(w=[])):(w=w||[]).push(j,D))}c&&(w=w||[]).push("style",c);var j=w;(r.updateQueue=j)&&(r.flags|=4)}};NR=function(n,r,c,p){c!==p&&(r.flags|=4)};function jg(n,r){if(!dn)switch(n.tailMode){case"hidden":r=n.tail;for(var c=null;r!==null;)r.alternate!==null&&(c=r),r=r.sibling;c===null?n.tail=null:c.sibling=null;break;case"collapsed":c=n.tail;for(var p=null;c!==null;)c.alternate!==null&&(p=c),c=c.sibling;p===null?r||n.tail===null?n.tail=null:n.tail.sibling=null:p.sibling=null}}function Gs(n){var r=n.alternate!==null&&n.alternate.child===n.child,c=0,p=0;if(r)for(var v=n.child;v!==null;)c|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=n,v=v.sibling;else for(v=n.child;v!==null;)c|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=n,v=v.sibling;return n.subtreeFlags|=p,n.childLanes=c,r}function hj(n,r,c){var p=r.pendingProps;switch(NT(r),r.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Gs(r),null;case 1:return Ao(r.type)&&sx(),Gs(r),null;case 3:return p=r.stateNode,cp(),an(Io),an(qs),XT(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(n===null||n.child===null)&&(S0(r)?r.flags|=4:n===null||n.memoizedState.isDehydrated&&!(r.flags&256)||(r.flags|=1024,Xa!==null&&(JS(Xa),Xa=null))),GS(n,r),Gs(r),null;case 5:ZT(r);var v=$h(b_.current);if(c=r.type,n!==null&&r.stateNode!=null)jR(n,r,c,p,v),n.ref!==r.ref&&(r.flags|=512,r.flags|=2097152);else{if(!p){if(r.stateNode===null)throw Error($t(166));return Gs(r),null}if(n=$h(Pl.current),S0(r)){p=r.stateNode,c=r.type;var w=r.memoizedProps;switch(p[kl]=r,p[v_]=w,n=(r.mode&1)!==0,c){case"dialog":on("cancel",p),on("close",p);break;case"iframe":case"object":case"embed":on("load",p);break;case"video":case"audio":for(v=0;v<Zg.length;v++)on(Zg[v],p);break;case"source":on("error",p);break;case"img":case"image":case"link":on("error",p),on("load",p);break;case"details":on("toggle",p);break;case"input":WC(p,w),on("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!w.multiple},on("invalid",p);break;case"textarea":ZC(p,w),on("invalid",p)}_S(c,w),v=null;for(var A in w)if(w.hasOwnProperty(A)){var o=w[A];A==="children"?typeof o=="string"?p.textContent!==o&&(w.suppressHydrationWarning!==!0&&w0(p.textContent,o,n),v=["children",o]):typeof o=="number"&&p.textContent!==""+o&&(w.suppressHydrationWarning!==!0&&w0(p.textContent,o,n),v=["children",""+o]):c_.hasOwnProperty(A)&&o!=null&&A==="onScroll"&&on("scroll",p)}switch(c){case"input":p0(p),qC(p,w,!0);break;case"textarea":p0(p),XC(p);break;case"select":case"option":break;default:typeof w.onClick=="function"&&(p.onclick=nx)}p=v,r.updateQueue=p,p!==null&&(r.flags|=4)}else{A=v.nodeType===9?v:v.ownerDocument,n==="http://www.w3.org/1999/xhtml"&&(n=pM(c)),n==="http://www.w3.org/1999/xhtml"?c==="script"?(n=A.createElement("div"),n.innerHTML="<script><\/script>",n=n.removeChild(n.firstChild)):typeof p.is=="string"?n=A.createElement(c,{is:p.is}):(n=A.createElement(c),c==="select"&&(A=n,p.multiple?A.multiple=!0:p.size&&(A.size=p.size))):n=A.createElementNS(n,c),n[kl]=r,n[v_]=p,FR(n,r,!1,!1),r.stateNode=n;e:{switch(A=yS(c,p),c){case"dialog":on("cancel",n),on("close",n),v=p;break;case"iframe":case"object":case"embed":on("load",n),v=p;break;case"video":case"audio":for(v=0;v<Zg.length;v++)on(Zg[v],n);v=p;break;case"source":on("error",n),v=p;break;case"img":case"image":case"link":on("error",n),on("load",n),v=p;break;case"details":on("toggle",n),v=p;break;case"input":WC(n,p),v=dS(n,p),on("invalid",n);break;case"option":v=p;break;case"select":n._wrapperState={wasMultiple:!!p.multiple},v=bn({},p,{value:void 0}),on("invalid",n);break;case"textarea":ZC(n,p),v=mS(n,p),on("invalid",n);break;default:v=p}_S(c,v),o=v;for(w in o)if(o.hasOwnProperty(w)){var D=o[w];w==="style"?_M(n,D):w==="dangerouslySetInnerHTML"?(D=D?D.__html:void 0,D!=null&&mM(n,D)):w==="children"?typeof D=="string"?(c!=="textarea"||D!=="")&&u_(n,D):typeof D=="number"&&u_(n,""+D):w!=="suppressContentEditableWarning"&&w!=="suppressHydrationWarning"&&w!=="autoFocus"&&(c_.hasOwnProperty(w)?D!=null&&w==="onScroll"&&on("scroll",n):D!=null&&ET(n,w,D,A))}switch(c){case"input":p0(n),qC(n,p,!1);break;case"textarea":p0(n),XC(n);break;case"option":p.value!=null&&n.setAttribute("value",""+Iu(p.value));break;case"select":n.multiple=!!p.multiple,w=p.value,w!=null?Yf(n,!!p.multiple,w,!1):p.defaultValue!=null&&Yf(n,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(n.onclick=nx)}switch(c){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(r.flags|=4)}r.ref!==null&&(r.flags|=512,r.flags|=2097152)}return Gs(r),null;case 6:if(n&&r.stateNode!=null)NR(n,r,n.memoizedProps,p);else{if(typeof p!="string"&&r.stateNode===null)throw Error($t(166));if(c=$h(b_.current),$h(Pl.current),S0(r)){if(p=r.stateNode,c=r.memoizedProps,p[kl]=r,(w=p.nodeValue!==c)&&(n=Xo,n!==null))switch(n.tag){case 3:w0(p.nodeValue,c,(n.mode&1)!==0);break;case 5:n.memoizedProps.suppressHydrationWarning!==!0&&w0(p.nodeValue,c,(n.mode&1)!==0)}w&&(r.flags|=4)}else p=(c.nodeType===9?c:c.ownerDocument).createTextNode(p),p[kl]=r,r.stateNode=p}return Gs(r),null;case 13:if(an(yn),p=r.memoizedState,n===null||n.memoizedState!==null&&n.memoizedState.dehydrated!==null){if(dn&&Zo!==null&&r.mode&1&&!(r.flags&128))nR(),ap(),r.flags|=98560,w=!1;else if(w=S0(r),p!==null&&p.dehydrated!==null){if(n===null){if(!w)throw Error($t(318));if(w=r.memoizedState,w=w!==null?w.dehydrated:null,!w)throw Error($t(317));w[kl]=r}else ap(),!(r.flags&128)&&(r.memoizedState=null),r.flags|=4;Gs(r),w=!1}else Xa!==null&&(JS(Xa),Xa=null),w=!0;if(!w)return r.flags&65536?r:null}return r.flags&128?(r.lanes=c,r):(p=p!==null,p!==(n!==null&&n.memoizedState!==null)&&p&&(r.child.flags|=8192,r.mode&1&&(n===null||yn.current&1?Jn===0&&(Jn=3):a2())),r.updateQueue!==null&&(r.flags|=4),Gs(r),null);case 4:return cp(),GS(n,r),n===null&&__(r.stateNode.containerInfo),Gs(r),null;case 10:return GT(r.type._context),Gs(r),null;case 17:return Ao(r.type)&&sx(),Gs(r),null;case 19:if(an(yn),w=r.memoizedState,w===null)return Gs(r),null;if(p=(r.flags&128)!==0,A=w.rendering,A===null)if(p)jg(w,!1);else{if(Jn!==0||n!==null&&n.flags&128)for(n=r.child;n!==null;){if(A=dx(n),A!==null){for(r.flags|=128,jg(w,!1),p=A.updateQueue,p!==null&&(r.updateQueue=p,r.flags|=4),r.subtreeFlags=0,p=c,c=r.child;c!==null;)w=c,n=p,w.flags&=14680066,A=w.alternate,A===null?(w.childLanes=0,w.lanes=n,w.child=null,w.subtreeFlags=0,w.memoizedProps=null,w.memoizedState=null,w.updateQueue=null,w.dependencies=null,w.stateNode=null):(w.childLanes=A.childLanes,w.lanes=A.lanes,w.child=A.child,w.subtreeFlags=0,w.deletions=null,w.memoizedProps=A.memoizedProps,w.memoizedState=A.memoizedState,w.updateQueue=A.updateQueue,w.type=A.type,n=A.dependencies,w.dependencies=n===null?null:{lanes:n.lanes,firstContext:n.firstContext}),c=c.sibling;return Kr(yn,yn.current&1|2),r.child}n=n.sibling}w.tail!==null&&On()>hp&&(r.flags|=128,p=!0,jg(w,!1),r.lanes=4194304)}else{if(!p)if(n=dx(A),n!==null){if(r.flags|=128,p=!0,c=n.updateQueue,c!==null&&(r.updateQueue=c,r.flags|=4),jg(w,!0),w.tail===null&&w.tailMode==="hidden"&&!A.alternate&&!dn)return Gs(r),null}else 2*On()-w.renderingStartTime>hp&&c!==1073741824&&(r.flags|=128,p=!0,jg(w,!1),r.lanes=4194304);w.isBackwards?(A.sibling=r.child,r.child=A):(c=w.last,c!==null?c.sibling=A:r.child=A,w.last=A)}return w.tail!==null?(r=w.tail,w.rendering=r,w.tail=r.sibling,w.renderingStartTime=On(),r.sibling=null,c=yn.current,Kr(yn,p?c&1|2:c&1),r):(Gs(r),null);case 22:case 23:return o2(),p=r.memoizedState!==null,n!==null&&n.memoizedState!==null!==p&&(r.flags|=8192),p&&r.mode&1?Wo&1073741824&&(Gs(r),r.subtreeFlags&6&&(r.flags|=8192)):Gs(r),null;case 24:return null;case 25:return null}throw Error($t(156,r.tag))}function dj(n,r){switch(NT(r),r.tag){case 1:return Ao(r.type)&&sx(),n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 3:return cp(),an(Io),an(qs),XT(),n=r.flags,n&65536&&!(n&128)?(r.flags=n&-65537|128,r):null;case 5:return ZT(r),null;case 13:if(an(yn),n=r.memoizedState,n!==null&&n.dehydrated!==null){if(r.alternate===null)throw Error($t(340));ap()}return n=r.flags,n&65536?(r.flags=n&-65537|128,r):null;case 19:return an(yn),null;case 4:return cp(),null;case 10:return GT(r.type._context),null;case 22:case 23:return o2(),null;case 24:return null;default:return null}}var I0=!1,Hs=!1,fj=typeof WeakSet=="function"?WeakSet:Set,fi=null;function qf(n,r){var c=n.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(p){Ln(n,r,p)}else c.current=null}function HS(n,r,c){try{c()}catch(p){Ln(n,r,p)}}var Fk=!1;function pj(n,r){if(CS=tx,n=HM(),FT(n)){if("selectionStart"in n)var c={start:n.selectionStart,end:n.selectionEnd};else e:{c=(c=n.ownerDocument)&&c.defaultView||window;var p=c.getSelection&&c.getSelection();if(p&&p.rangeCount!==0){c=p.anchorNode;var v=p.anchorOffset,w=p.focusNode;p=p.focusOffset;try{c.nodeType,w.nodeType}catch{c=null;break e}var A=0,o=-1,D=-1,j=0,J=0,ie=n,re=null;t:for(;;){for(var he;ie!==c||v!==0&&ie.nodeType!==3||(o=A+v),ie!==w||p!==0&&ie.nodeType!==3||(D=A+p),ie.nodeType===3&&(A+=ie.nodeValue.length),(he=ie.firstChild)!==null;)re=ie,ie=he;for(;;){if(ie===n)break t;if(re===c&&++j===v&&(o=A),re===w&&++J===p&&(D=A),(he=ie.nextSibling)!==null)break;ie=re,re=ie.parentNode}ie=he}c=o===-1||D===-1?null:{start:o,end:D}}else c=null}c=c||{start:0,end:0}}else c=null;for(kS={focusedElem:n,selectionRange:c},tx=!1,fi=r;fi!==null;)if(r=fi,n=r.child,(r.subtreeFlags&1028)!==0&&n!==null)n.return=r,fi=n;else for(;fi!==null;){r=fi;try{var ce=r.alternate;if(r.flags&1024)switch(r.tag){case 0:case 11:case 15:break;case 1:if(ce!==null){var xe=ce.memoizedProps,Ee=ce.memoizedState,ve=r.stateNode,K=ve.getSnapshotBeforeUpdate(r.elementType===r.type?xe:Wa(r.type,xe),Ee);ve.__reactInternalSnapshotBeforeUpdate=K}break;case 3:var fe=r.stateNode.containerInfo;fe.nodeType===1?fe.textContent="":fe.nodeType===9&&fe.documentElement&&fe.removeChild(fe.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error($t(163))}}catch(ke){Ln(r,r.return,ke)}if(n=r.sibling,n!==null){n.return=r.return,fi=n;break}fi=r.return}return ce=Fk,Fk=!1,ce}function r_(n,r,c){var p=r.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&n)===n){var w=v.destroy;v.destroy=void 0,w!==void 0&&HS(r,c,w)}v=v.next}while(v!==p)}}function Gx(n,r){if(r=r.updateQueue,r=r!==null?r.lastEffect:null,r!==null){var c=r=r.next;do{if((c.tag&n)===n){var p=c.create;c.destroy=p()}c=c.next}while(c!==r)}}function WS(n){var r=n.ref;if(r!==null){var c=n.stateNode;switch(n.tag){case 5:n=c;break;default:n=c}typeof r=="function"?r(n):r.current=n}}function UR(n){var r=n.alternate;r!==null&&(n.alternate=null,UR(r)),n.child=null,n.deletions=null,n.sibling=null,n.tag===5&&(r=n.stateNode,r!==null&&(delete r[kl],delete r[v_],delete r[MS],delete r[K5],delete r[Y5])),n.stateNode=null,n.return=null,n.dependencies=null,n.memoizedProps=null,n.memoizedState=null,n.pendingProps=null,n.stateNode=null,n.updateQueue=null}function VR(n){return n.tag===5||n.tag===3||n.tag===4}function jk(n){e:for(;;){for(;n.sibling===null;){if(n.return===null||VR(n.return))return null;n=n.return}for(n.sibling.return=n.return,n=n.sibling;n.tag!==5&&n.tag!==6&&n.tag!==18;){if(n.flags&2||n.child===null||n.tag===4)continue e;n.child.return=n,n=n.child}if(!(n.flags&2))return n.stateNode}}function qS(n,r,c){var p=n.tag;if(p===5||p===6)n=n.stateNode,r?c.nodeType===8?c.parentNode.insertBefore(n,r):c.insertBefore(n,r):(c.nodeType===8?(r=c.parentNode,r.insertBefore(n,c)):(r=c,r.appendChild(n)),c=c._reactRootContainer,c!=null||r.onclick!==null||(r.onclick=nx));else if(p!==4&&(n=n.child,n!==null))for(qS(n,r,c),n=n.sibling;n!==null;)qS(n,r,c),n=n.sibling}function ZS(n,r,c){var p=n.tag;if(p===5||p===6)n=n.stateNode,r?c.insertBefore(n,r):c.appendChild(n);else if(p!==4&&(n=n.child,n!==null))for(ZS(n,r,c),n=n.sibling;n!==null;)ZS(n,r,c),n=n.sibling}var As=null,qa=!1;function nu(n,r,c){for(c=c.child;c!==null;)$R(n,r,c),c=c.sibling}function $R(n,r,c){if(Ll&&typeof Ll.onCommitFiberUnmount=="function")try{Ll.onCommitFiberUnmount(zx,c)}catch{}switch(c.tag){case 5:Hs||qf(c,r);case 6:var p=As,v=qa;As=null,nu(n,r,c),As=p,qa=v,As!==null&&(qa?(n=As,c=c.stateNode,n.nodeType===8?n.parentNode.removeChild(c):n.removeChild(c)):As.removeChild(c.stateNode));break;case 18:As!==null&&(qa?(n=As,c=c.stateNode,n.nodeType===8?Pw(n.parentNode,c):n.nodeType===1&&Pw(n,c),p_(n)):Pw(As,c.stateNode));break;case 4:p=As,v=qa,As=c.stateNode.containerInfo,qa=!0,nu(n,r,c),As=p,qa=v;break;case 0:case 11:case 14:case 15:if(!Hs&&(p=c.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var w=v,A=w.destroy;w=w.tag,A!==void 0&&(w&2||w&4)&&HS(c,r,A),v=v.next}while(v!==p)}nu(n,r,c);break;case 1:if(!Hs&&(qf(c,r),p=c.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=c.memoizedProps,p.state=c.memoizedState,p.componentWillUnmount()}catch(o){Ln(c,r,o)}nu(n,r,c);break;case 21:nu(n,r,c);break;case 22:c.mode&1?(Hs=(p=Hs)||c.memoizedState!==null,nu(n,r,c),Hs=p):nu(n,r,c);break;default:nu(n,r,c)}}function Nk(n){var r=n.updateQueue;if(r!==null){n.updateQueue=null;var c=n.stateNode;c===null&&(c=n.stateNode=new fj),r.forEach(function(p){var v=Sj.bind(null,n,p);c.has(p)||(c.add(p),p.then(v,v))})}}function Ga(n,r){var c=r.deletions;if(c!==null)for(var p=0;p<c.length;p++){var v=c[p];try{var w=n,A=r,o=A;e:for(;o!==null;){switch(o.tag){case 5:As=o.stateNode,qa=!1;break e;case 3:As=o.stateNode.containerInfo,qa=!0;break e;case 4:As=o.stateNode.containerInfo,qa=!0;break e}o=o.return}if(As===null)throw Error($t(160));$R(w,A,v),As=null,qa=!1;var D=v.alternate;D!==null&&(D.return=null),v.return=null}catch(j){Ln(v,r,j)}}if(r.subtreeFlags&12854)for(r=r.child;r!==null;)GR(r,n),r=r.sibling}function GR(n,r){var c=n.alternate,p=n.flags;switch(n.tag){case 0:case 11:case 14:case 15:if(Ga(r,n),Al(n),p&4){try{r_(3,n,n.return),Gx(3,n)}catch(xe){Ln(n,n.return,xe)}try{r_(5,n,n.return)}catch(xe){Ln(n,n.return,xe)}}break;case 1:Ga(r,n),Al(n),p&512&&c!==null&&qf(c,c.return);break;case 5:if(Ga(r,n),Al(n),p&512&&c!==null&&qf(c,c.return),n.flags&32){var v=n.stateNode;try{u_(v,"")}catch(xe){Ln(n,n.return,xe)}}if(p&4&&(v=n.stateNode,v!=null)){var w=n.memoizedProps,A=c!==null?c.memoizedProps:w,o=n.type,D=n.updateQueue;if(n.updateQueue=null,D!==null)try{o==="input"&&w.type==="radio"&&w.name!=null&&dM(v,w),yS(o,A);var j=yS(o,w);for(A=0;A<D.length;A+=2){var J=D[A],ie=D[A+1];J==="style"?_M(v,ie):J==="dangerouslySetInnerHTML"?mM(v,ie):J==="children"?u_(v,ie):ET(v,J,ie,j)}switch(o){case"input":fS(v,w);break;case"textarea":fM(v,w);break;case"select":var re=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!w.multiple;var he=w.value;he!=null?Yf(v,!!w.multiple,he,!1):re!==!!w.multiple&&(w.defaultValue!=null?Yf(v,!!w.multiple,w.defaultValue,!0):Yf(v,!!w.multiple,w.multiple?[]:"",!1))}v[v_]=w}catch(xe){Ln(n,n.return,xe)}}break;case 6:if(Ga(r,n),Al(n),p&4){if(n.stateNode===null)throw Error($t(162));v=n.stateNode,w=n.memoizedProps;try{v.nodeValue=w}catch(xe){Ln(n,n.return,xe)}}break;case 3:if(Ga(r,n),Al(n),p&4&&c!==null&&c.memoizedState.isDehydrated)try{p_(r.containerInfo)}catch(xe){Ln(n,n.return,xe)}break;case 4:Ga(r,n),Al(n);break;case 13:Ga(r,n),Al(n),v=n.child,v.flags&8192&&(w=v.memoizedState!==null,v.stateNode.isHidden=w,!w||v.alternate!==null&&v.alternate.memoizedState!==null||(n2=On())),p&4&&Nk(n);break;case 22:if(J=c!==null&&c.memoizedState!==null,n.mode&1?(Hs=(j=Hs)||J,Ga(r,n),Hs=j):Ga(r,n),Al(n),p&8192){if(j=n.memoizedState!==null,(n.stateNode.isHidden=j)&&!J&&n.mode&1)for(fi=n,J=n.child;J!==null;){for(ie=fi=J;fi!==null;){switch(re=fi,he=re.child,re.tag){case 0:case 11:case 14:case 15:r_(4,re,re.return);break;case 1:qf(re,re.return);var ce=re.stateNode;if(typeof ce.componentWillUnmount=="function"){p=re,c=re.return;try{r=p,ce.props=r.memoizedProps,ce.state=r.memoizedState,ce.componentWillUnmount()}catch(xe){Ln(p,c,xe)}}break;case 5:qf(re,re.return);break;case 22:if(re.memoizedState!==null){Vk(ie);continue}}he!==null?(he.return=re,fi=he):Vk(ie)}J=J.sibling}e:for(J=null,ie=n;;){if(ie.tag===5){if(J===null){J=ie;try{v=ie.stateNode,j?(w=v.style,typeof w.setProperty=="function"?w.setProperty("display","none","important"):w.display="none"):(o=ie.stateNode,D=ie.memoizedProps.style,A=D!=null&&D.hasOwnProperty("display")?D.display:null,o.style.display=gM("display",A))}catch(xe){Ln(n,n.return,xe)}}}else if(ie.tag===6){if(J===null)try{ie.stateNode.nodeValue=j?"":ie.memoizedProps}catch(xe){Ln(n,n.return,xe)}}else if((ie.tag!==22&&ie.tag!==23||ie.memoizedState===null||ie===n)&&ie.child!==null){ie.child.return=ie,ie=ie.child;continue}if(ie===n)break e;for(;ie.sibling===null;){if(ie.return===null||ie.return===n)break e;J===ie&&(J=null),ie=ie.return}J===ie&&(J=null),ie.sibling.return=ie.return,ie=ie.sibling}}break;case 19:Ga(r,n),Al(n),p&4&&Nk(n);break;case 21:break;default:Ga(r,n),Al(n)}}function Al(n){var r=n.flags;if(r&2){try{e:{for(var c=n.return;c!==null;){if(VR(c)){var p=c;break e}c=c.return}throw Error($t(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(u_(v,""),p.flags&=-33);var w=jk(n);ZS(n,w,v);break;case 3:case 4:var A=p.stateNode.containerInfo,o=jk(n);qS(n,o,A);break;default:throw Error($t(161))}}catch(D){Ln(n,n.return,D)}n.flags&=-3}r&4096&&(n.flags&=-4097)}function mj(n,r,c){fi=n,HR(n)}function HR(n,r,c){for(var p=(n.mode&1)!==0;fi!==null;){var v=fi,w=v.child;if(v.tag===22&&p){var A=v.memoizedState!==null||I0;if(!A){var o=v.alternate,D=o!==null&&o.memoizedState!==null||Hs;o=I0;var j=Hs;if(I0=A,(Hs=D)&&!j)for(fi=v;fi!==null;)A=fi,D=A.child,A.tag===22&&A.memoizedState!==null?$k(v):D!==null?(D.return=A,fi=D):$k(v);for(;w!==null;)fi=w,HR(w),w=w.sibling;fi=v,I0=o,Hs=j}Uk(n)}else v.subtreeFlags&8772&&w!==null?(w.return=v,fi=w):Uk(n)}}function Uk(n){for(;fi!==null;){var r=fi;if(r.flags&8772){var c=r.alternate;try{if(r.flags&8772)switch(r.tag){case 0:case 11:case 15:Hs||Gx(5,r);break;case 1:var p=r.stateNode;if(r.flags&4&&!Hs)if(c===null)p.componentDidMount();else{var v=r.elementType===r.type?c.memoizedProps:Wa(r.type,c.memoizedProps);p.componentDidUpdate(v,c.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var w=r.updateQueue;w!==null&&Ek(r,w,p);break;case 3:var A=r.updateQueue;if(A!==null){if(c=null,r.child!==null)switch(r.child.tag){case 5:c=r.child.stateNode;break;case 1:c=r.child.stateNode}Ek(r,A,c)}break;case 5:var o=r.stateNode;if(c===null&&r.flags&4){c=o;var D=r.memoizedProps;switch(r.type){case"button":case"input":case"select":case"textarea":D.autoFocus&&c.focus();break;case"img":D.src&&(c.src=D.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(r.memoizedState===null){var j=r.alternate;if(j!==null){var J=j.memoizedState;if(J!==null){var ie=J.dehydrated;ie!==null&&p_(ie)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error($t(163))}Hs||r.flags&512&&WS(r)}catch(re){Ln(r,r.return,re)}}if(r===n){fi=null;break}if(c=r.sibling,c!==null){c.return=r.return,fi=c;break}fi=r.return}}function Vk(n){for(;fi!==null;){var r=fi;if(r===n){fi=null;break}var c=r.sibling;if(c!==null){c.return=r.return,fi=c;break}fi=r.return}}function $k(n){for(;fi!==null;){var r=fi;try{switch(r.tag){case 0:case 11:case 15:var c=r.return;try{Gx(4,r)}catch(D){Ln(r,c,D)}break;case 1:var p=r.stateNode;if(typeof p.componentDidMount=="function"){var v=r.return;try{p.componentDidMount()}catch(D){Ln(r,v,D)}}var w=r.return;try{WS(r)}catch(D){Ln(r,w,D)}break;case 5:var A=r.return;try{WS(r)}catch(D){Ln(r,A,D)}}}catch(D){Ln(r,r.return,D)}if(r===n){fi=null;break}var o=r.sibling;if(o!==null){o.return=r.return,fi=o;break}fi=r.return}}var gj=Math.ceil,mx=dc.ReactCurrentDispatcher,i2=dc.ReactCurrentOwner,wa=dc.ReactCurrentBatchConfig,Pr=0,ms=null,Vn=null,Cs=0,Wo=0,Zf=ku(0),Jn=0,E_=null,Kh=0,Hx=0,r2=0,n_=null,To=null,n2=0,hp=1/0,tc=null,gx=!1,XS=null,wu=null,A0=!1,pu=null,_x=0,s_=0,KS=null,q0=-1,Z0=0;function uo(){return Pr&6?On():q0!==-1?q0:q0=On()}function Su(n){return n.mode&1?Pr&2&&Cs!==0?Cs&-Cs:Q5.transition!==null?(Z0===0&&(Z0=kM()),Z0):(n=$r,n!==0||(n=window.event,n=n===void 0?16:zM(n.type)),n):1}function Ya(n,r,c,p){if(50<s_)throw s_=0,KS=null,Error($t(185));F_(n,c,p),(!(Pr&2)||n!==ms)&&(n===ms&&(!(Pr&2)&&(Hx|=c),Jn===4&&hu(n,Cs)),Co(n,p),c===1&&Pr===0&&!(r.mode&1)&&(hp=On()+500,Ux&&Lu()))}function Co(n,r){var c=n.callbackNode;QF(n,r);var p=ex(n,n===ms?Cs:0);if(p===0)c!==null&&JC(c),n.callbackNode=null,n.callbackPriority=0;else if(r=p&-p,n.callbackPriority!==r){if(c!=null&&JC(c),r===1)n.tag===0?J5(Gk.bind(null,n)):tR(Gk.bind(null,n)),Z5(function(){!(Pr&6)&&Lu()}),c=null;else{switch(LM(p)){case 1:c=LT;break;case 4:c=AM;break;case 16:c=Q0;break;case 536870912:c=CM;break;default:c=Q0}c=QR(c,WR.bind(null,n))}n.callbackPriority=r,n.callbackNode=c}}function WR(n,r){if(q0=-1,Z0=0,Pr&6)throw Error($t(327));var c=n.callbackNode;if(ip()&&n.callbackNode!==c)return null;var p=ex(n,n===ms?Cs:0);if(p===0)return null;if(p&30||p&n.expiredLanes||r)r=yx(n,p);else{r=p;var v=Pr;Pr|=2;var w=ZR();(ms!==n||Cs!==r)&&(tc=null,hp=On()+500,Hh(n,r));do try{vj();break}catch(o){qR(n,o)}while(!0);$T(),mx.current=w,Pr=v,Vn!==null?r=0:(ms=null,Cs=0,r=Jn)}if(r!==0){if(r===2&&(v=SS(n),v!==0&&(p=v,r=YS(n,v))),r===1)throw c=E_,Hh(n,0),hu(n,p),Co(n,On()),c;if(r===6)hu(n,p);else{if(v=n.current.alternate,!(p&30)&&!_j(v)&&(r=yx(n,p),r===2&&(w=SS(n),w!==0&&(p=w,r=YS(n,w))),r===1))throw c=E_,Hh(n,0),hu(n,p),Co(n,On()),c;switch(n.finishedWork=v,n.finishedLanes=p,r){case 0:case 1:throw Error($t(345));case 2:zh(n,To,tc);break;case 3:if(hu(n,p),(p&130023424)===p&&(r=n2+500-On(),10<r)){if(ex(n,0)!==0)break;if(v=n.suspendedLanes,(v&p)!==p){uo(),n.pingedLanes|=n.suspendedLanes&v;break}n.timeoutHandle=PS(zh.bind(null,n,To,tc),r);break}zh(n,To,tc);break;case 4:if(hu(n,p),(p&4194240)===p)break;for(r=n.eventTimes,v=-1;0<p;){var A=31-Ka(p);w=1<<A,A=r[A],A>v&&(v=A),p&=~w}if(p=v,p=On()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*gj(p/1960))-p,10<p){n.timeoutHandle=PS(zh.bind(null,n,To,tc),p);break}zh(n,To,tc);break;case 5:zh(n,To,tc);break;default:throw Error($t(329))}}}return Co(n,On()),n.callbackNode===c?WR.bind(null,n):null}function YS(n,r){var c=n_;return n.current.memoizedState.isDehydrated&&(Hh(n,r).flags|=256),n=yx(n,r),n!==2&&(r=To,To=c,r!==null&&JS(r)),n}function JS(n){To===null?To=n:To.push.apply(To,n)}function _j(n){for(var r=n;;){if(r.flags&16384){var c=r.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var p=0;p<c.length;p++){var v=c[p],w=v.getSnapshot;v=v.value;try{if(!Ja(w(),v))return!1}catch{return!1}}}if(c=r.child,r.subtreeFlags&16384&&c!==null)c.return=r,r=c;else{if(r===n)break;for(;r.sibling===null;){if(r.return===null||r.return===n)return!0;r=r.return}r.sibling.return=r.return,r=r.sibling}}return!0}function hu(n,r){for(r&=~r2,r&=~Hx,n.suspendedLanes|=r,n.pingedLanes&=~r,n=n.expirationTimes;0<r;){var c=31-Ka(r),p=1<<c;n[c]=-1,r&=~p}}function Gk(n){if(Pr&6)throw Error($t(327));ip();var r=ex(n,0);if(!(r&1))return Co(n,On()),null;var c=yx(n,r);if(n.tag!==0&&c===2){var p=SS(n);p!==0&&(r=p,c=YS(n,p))}if(c===1)throw c=E_,Hh(n,0),hu(n,r),Co(n,On()),c;if(c===6)throw Error($t(345));return n.finishedWork=n.current.alternate,n.finishedLanes=r,zh(n,To,tc),Co(n,On()),null}function s2(n,r){var c=Pr;Pr|=1;try{return n(r)}finally{Pr=c,Pr===0&&(hp=On()+500,Ux&&Lu())}}function Yh(n){pu!==null&&pu.tag===0&&!(Pr&6)&&ip();var r=Pr;Pr|=1;var c=wa.transition,p=$r;try{if(wa.transition=null,$r=1,n)return n()}finally{$r=p,wa.transition=c,Pr=r,!(Pr&6)&&Lu()}}function o2(){Wo=Zf.current,an(Zf)}function Hh(n,r){n.finishedWork=null,n.finishedLanes=0;var c=n.timeoutHandle;if(c!==-1&&(n.timeoutHandle=-1,q5(c)),Vn!==null)for(c=Vn.return;c!==null;){var p=c;switch(NT(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&sx();break;case 3:cp(),an(Io),an(qs),XT();break;case 5:ZT(p);break;case 4:cp();break;case 13:an(yn);break;case 19:an(yn);break;case 10:GT(p.type._context);break;case 22:case 23:o2()}c=c.return}if(ms=n,Vn=n=Tu(n.current,null),Cs=Wo=r,Jn=0,E_=null,r2=Hx=Kh=0,To=n_=null,Vh!==null){for(r=0;r<Vh.length;r++)if(c=Vh[r],p=c.interleaved,p!==null){c.interleaved=null;var v=p.next,w=c.pending;if(w!==null){var A=w.next;w.next=v,p.next=A}c.pending=p}Vh=null}return n}function qR(n,r){do{var c=Vn;try{if($T(),G0.current=px,fx){for(var p=vn.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}fx=!1}if(Xh=0,ps=Yn=vn=null,i_=!1,w_=0,i2.current=null,c===null||c.return===null){Jn=1,E_=r,Vn=null;break}e:{var w=n,A=c.return,o=c,D=r;if(r=Cs,o.flags|=32768,D!==null&&typeof D=="object"&&typeof D.then=="function"){var j=D,J=o,ie=J.tag;if(!(J.mode&1)&&(ie===0||ie===11||ie===15)){var re=J.alternate;re?(J.updateQueue=re.updateQueue,J.memoizedState=re.memoizedState,J.lanes=re.lanes):(J.updateQueue=null,J.memoizedState=null)}var he=Pk(A);if(he!==null){he.flags&=-257,Mk(he,A,o,w,r),he.mode&1&&Lk(w,j,r),r=he,D=j;var ce=r.updateQueue;if(ce===null){var xe=new Set;xe.add(D),r.updateQueue=xe}else ce.add(D);break e}else{if(!(r&1)){Lk(w,j,r),a2();break e}D=Error($t(426))}}else if(dn&&o.mode&1){var Ee=Pk(A);if(Ee!==null){!(Ee.flags&65536)&&(Ee.flags|=256),Mk(Ee,A,o,w,r),UT(up(D,o));break e}}w=D=up(D,o),Jn!==4&&(Jn=2),n_===null?n_=[w]:n_.push(w),w=A;do{switch(w.tag){case 3:w.flags|=65536,r&=-r,w.lanes|=r;var ve=LR(w,D,r);Tk(w,ve);break e;case 1:o=D;var K=w.type,fe=w.stateNode;if(!(w.flags&128)&&(typeof K.getDerivedStateFromError=="function"||fe!==null&&typeof fe.componentDidCatch=="function"&&(wu===null||!wu.has(fe)))){w.flags|=65536,r&=-r,w.lanes|=r;var ke=PR(w,o,r);Tk(w,ke);break e}}w=w.return}while(w!==null)}KR(c)}catch(Be){r=Be,Vn===c&&c!==null&&(Vn=c=c.return);continue}break}while(!0)}function ZR(){var n=mx.current;return mx.current=px,n===null?px:n}function a2(){(Jn===0||Jn===3||Jn===2)&&(Jn=4),ms===null||!(Kh&268435455)&&!(Hx&268435455)||hu(ms,Cs)}function yx(n,r){var c=Pr;Pr|=2;var p=ZR();(ms!==n||Cs!==r)&&(tc=null,Hh(n,r));do try{yj();break}catch(v){qR(n,v)}while(!0);if($T(),Pr=c,mx.current=p,Vn!==null)throw Error($t(261));return ms=null,Cs=0,Jn}function yj(){for(;Vn!==null;)XR(Vn)}function vj(){for(;Vn!==null&&!GF();)XR(Vn)}function XR(n){var r=JR(n.alternate,n,Wo);n.memoizedProps=n.pendingProps,r===null?KR(n):Vn=r,i2.current=null}function KR(n){var r=n;do{var c=r.alternate;if(n=r.return,r.flags&32768){if(c=dj(c,r),c!==null){c.flags&=32767,Vn=c;return}if(n!==null)n.flags|=32768,n.subtreeFlags=0,n.deletions=null;else{Jn=6,Vn=null;return}}else if(c=hj(c,r,Wo),c!==null){Vn=c;return}if(r=r.sibling,r!==null){Vn=r;return}Vn=r=n}while(r!==null);Jn===0&&(Jn=5)}function zh(n,r,c){var p=$r,v=wa.transition;try{wa.transition=null,$r=1,xj(n,r,c,p)}finally{wa.transition=v,$r=p}return null}function xj(n,r,c,p){do ip();while(pu!==null);if(Pr&6)throw Error($t(327));c=n.finishedWork;var v=n.finishedLanes;if(c===null)return null;if(n.finishedWork=null,n.finishedLanes=0,c===n.current)throw Error($t(177));n.callbackNode=null,n.callbackPriority=0;var w=c.lanes|c.childLanes;if(e5(n,w),n===ms&&(Vn=ms=null,Cs=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||A0||(A0=!0,QR(Q0,function(){return ip(),null})),w=(c.flags&15990)!==0,c.subtreeFlags&15990||w){w=wa.transition,wa.transition=null;var A=$r;$r=1;var o=Pr;Pr|=4,i2.current=null,pj(n,c),GR(c,n),N5(kS),tx=!!CS,kS=CS=null,n.current=c,mj(c),HF(),Pr=o,$r=A,wa.transition=w}else n.current=c;if(A0&&(A0=!1,pu=n,_x=v),w=n.pendingLanes,w===0&&(wu=null),ZF(c.stateNode),Co(n,On()),r!==null)for(p=n.onRecoverableError,c=0;c<r.length;c++)v=r[c],p(v.value,{componentStack:v.stack,digest:v.digest});if(gx)throw gx=!1,n=XS,XS=null,n;return _x&1&&n.tag!==0&&ip(),w=n.pendingLanes,w&1?n===KS?s_++:(s_=0,KS=n):s_=0,Lu(),null}function ip(){if(pu!==null){var n=LM(_x),r=wa.transition,c=$r;try{if(wa.transition=null,$r=16>n?16:n,pu===null)var p=!1;else{if(n=pu,pu=null,_x=0,Pr&6)throw Error($t(331));var v=Pr;for(Pr|=4,fi=n.current;fi!==null;){var w=fi,A=w.child;if(fi.flags&16){var o=w.deletions;if(o!==null){for(var D=0;D<o.length;D++){var j=o[D];for(fi=j;fi!==null;){var J=fi;switch(J.tag){case 0:case 11:case 15:r_(8,J,w)}var ie=J.child;if(ie!==null)ie.return=J,fi=ie;else for(;fi!==null;){J=fi;var re=J.sibling,he=J.return;if(UR(J),J===j){fi=null;break}if(re!==null){re.return=he,fi=re;break}fi=he}}}var ce=w.alternate;if(ce!==null){var xe=ce.child;if(xe!==null){ce.child=null;do{var Ee=xe.sibling;xe.sibling=null,xe=Ee}while(xe!==null)}}fi=w}}if(w.subtreeFlags&2064&&A!==null)A.return=w,fi=A;else e:for(;fi!==null;){if(w=fi,w.flags&2048)switch(w.tag){case 0:case 11:case 15:r_(9,w,w.return)}var ve=w.sibling;if(ve!==null){ve.return=w.return,fi=ve;break e}fi=w.return}}var K=n.current;for(fi=K;fi!==null;){A=fi;var fe=A.child;if(A.subtreeFlags&2064&&fe!==null)fe.return=A,fi=fe;else e:for(A=K;fi!==null;){if(o=fi,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:Gx(9,o)}}catch(Be){Ln(o,o.return,Be)}if(o===A){fi=null;break e}var ke=o.sibling;if(ke!==null){ke.return=o.return,fi=ke;break e}fi=o.return}}if(Pr=v,Lu(),Ll&&typeof Ll.onPostCommitFiberRoot=="function")try{Ll.onPostCommitFiberRoot(zx,n)}catch{}p=!0}return p}finally{$r=c,wa.transition=r}}return!1}function Hk(n,r,c){r=up(c,r),r=LR(n,r,1),n=bu(n,r,1),r=uo(),n!==null&&(F_(n,1,r),Co(n,r))}function Ln(n,r,c){if(n.tag===3)Hk(n,n,c);else for(;r!==null;){if(r.tag===3){Hk(r,n,c);break}else if(r.tag===1){var p=r.stateNode;if(typeof r.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(wu===null||!wu.has(p))){n=up(c,n),n=PR(r,n,1),r=bu(r,n,1),n=uo(),r!==null&&(F_(r,1,n),Co(r,n));break}}r=r.return}}function bj(n,r,c){var p=n.pingCache;p!==null&&p.delete(r),r=uo(),n.pingedLanes|=n.suspendedLanes&c,ms===n&&(Cs&c)===c&&(Jn===4||Jn===3&&(Cs&130023424)===Cs&&500>On()-n2?Hh(n,0):r2|=c),Co(n,r)}function YR(n,r){r===0&&(n.mode&1?(r=_0,_0<<=1,!(_0&130023424)&&(_0=4194304)):r=1);var c=uo();n=cc(n,r),n!==null&&(F_(n,r,c),Co(n,c))}function wj(n){var r=n.memoizedState,c=0;r!==null&&(c=r.retryLane),YR(n,c)}function Sj(n,r){var c=0;switch(n.tag){case 13:var p=n.stateNode,v=n.memoizedState;v!==null&&(c=v.retryLane);break;case 19:p=n.stateNode;break;default:throw Error($t(314))}p!==null&&p.delete(r),YR(n,c)}var JR;JR=function(n,r,c){if(n!==null)if(n.memoizedProps!==r.pendingProps||Io.current)Eo=!0;else{if(!(n.lanes&c)&&!(r.flags&128))return Eo=!1,uj(n,r,c);Eo=!!(n.flags&131072)}else Eo=!1,dn&&r.flags&1048576&&iR(r,lx,r.index);switch(r.lanes=0,r.tag){case 2:var p=r.type;W0(n,r),n=r.pendingProps;var v=op(r,qs.current);tp(r,c),v=YT(null,r,p,n,v,c);var w=JT();return r.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(r.tag=1,r.memoizedState=null,r.updateQueue=null,Ao(p)?(w=!0,ox(r)):w=!1,r.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,WT(r),v.updater=$x,r.stateNode=v,v._reactInternals=r,FS(r,p,n,c),r=US(null,r,p,!0,w,c)):(r.tag=0,dn&&w&&jT(r),co(null,r,v,c),r=r.child),r;case 16:p=r.elementType;e:{switch(W0(n,r),n=r.pendingProps,v=p._init,p=v(p._payload),r.type=p,v=r.tag=Ej(p),n=Wa(p,n),v){case 0:r=NS(null,r,p,n,c);break e;case 1:r=Ok(null,r,p,n,c);break e;case 11:r=Rk(null,r,p,n,c);break e;case 14:r=Dk(null,r,p,Wa(p.type,n),c);break e}throw Error($t(306,p,""))}return r;case 0:return p=r.type,v=r.pendingProps,v=r.elementType===p?v:Wa(p,v),NS(n,r,p,v,c);case 1:return p=r.type,v=r.pendingProps,v=r.elementType===p?v:Wa(p,v),Ok(n,r,p,v,c);case 3:e:{if(OR(r),n===null)throw Error($t(387));p=r.pendingProps,w=r.memoizedState,v=w.element,lR(n,r),hx(r,p,null,c);var A=r.memoizedState;if(p=A.element,w.isDehydrated)if(w={element:p,isDehydrated:!1,cache:A.cache,pendingSuspenseBoundaries:A.pendingSuspenseBoundaries,transitions:A.transitions},r.updateQueue.baseState=w,r.memoizedState=w,r.flags&256){v=up(Error($t(423)),r),r=zk(n,r,p,c,v);break e}else if(p!==v){v=up(Error($t(424)),r),r=zk(n,r,p,c,v);break e}else for(Zo=xu(r.stateNode.containerInfo.firstChild),Xo=r,dn=!0,Xa=null,c=oR(r,null,p,c),r.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(ap(),p===v){r=uc(n,r,c);break e}co(n,r,p,c)}r=r.child}return r;case 5:return cR(r),n===null&&OS(r),p=r.type,v=r.pendingProps,w=n!==null?n.memoizedProps:null,A=v.children,LS(p,v)?A=null:w!==null&&LS(p,w)&&(r.flags|=32),DR(n,r),co(n,r,A,c),r.child;case 6:return n===null&&OS(r),null;case 13:return zR(n,r,c);case 4:return qT(r,r.stateNode.containerInfo),p=r.pendingProps,n===null?r.child=lp(r,null,p,c):co(n,r,p,c),r.child;case 11:return p=r.type,v=r.pendingProps,v=r.elementType===p?v:Wa(p,v),Rk(n,r,p,v,c);case 7:return co(n,r,r.pendingProps,c),r.child;case 8:return co(n,r,r.pendingProps.children,c),r.child;case 12:return co(n,r,r.pendingProps.children,c),r.child;case 10:e:{if(p=r.type._context,v=r.pendingProps,w=r.memoizedProps,A=v.value,Kr(cx,p._currentValue),p._currentValue=A,w!==null)if(Ja(w.value,A)){if(w.children===v.children&&!Io.current){r=uc(n,r,c);break e}}else for(w=r.child,w!==null&&(w.return=r);w!==null;){var o=w.dependencies;if(o!==null){A=w.child;for(var D=o.firstContext;D!==null;){if(D.context===p){if(w.tag===1){D=oc(-1,c&-c),D.tag=2;var j=w.updateQueue;if(j!==null){j=j.shared;var J=j.pending;J===null?D.next=D:(D.next=J.next,J.next=D),j.pending=D}}w.lanes|=c,D=w.alternate,D!==null&&(D.lanes|=c),zS(w.return,c,r),o.lanes|=c;break}D=D.next}}else if(w.tag===10)A=w.type===r.type?null:w.child;else if(w.tag===18){if(A=w.return,A===null)throw Error($t(341));A.lanes|=c,o=A.alternate,o!==null&&(o.lanes|=c),zS(A,c,r),A=w.sibling}else A=w.child;if(A!==null)A.return=w;else for(A=w;A!==null;){if(A===r){A=null;break}if(w=A.sibling,w!==null){w.return=A.return,A=w;break}A=A.return}w=A}co(n,r,v.children,c),r=r.child}return r;case 9:return v=r.type,p=r.pendingProps.children,tp(r,c),v=Sa(v),p=p(v),r.flags|=1,co(n,r,p,c),r.child;case 14:return p=r.type,v=Wa(p,r.pendingProps),v=Wa(p.type,v),Dk(n,r,p,v,c);case 15:return MR(n,r,r.type,r.pendingProps,c);case 17:return p=r.type,v=r.pendingProps,v=r.elementType===p?v:Wa(p,v),W0(n,r),r.tag=1,Ao(p)?(n=!0,ox(r)):n=!1,tp(r,c),kR(r,p,v),FS(r,p,v,c),US(null,r,p,!0,n,c);case 19:return BR(n,r,c);case 22:return RR(n,r,c)}throw Error($t(156,r.tag))};function QR(n,r){return IM(n,r)}function Tj(n,r,c,p){this.tag=n,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=r,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function ba(n,r,c,p){return new Tj(n,r,c,p)}function l2(n){return n=n.prototype,!(!n||!n.isReactComponent)}function Ej(n){if(typeof n=="function")return l2(n)?1:0;if(n!=null){if(n=n.$$typeof,n===AT)return 11;if(n===CT)return 14}return 2}function Tu(n,r){var c=n.alternate;return c===null?(c=ba(n.tag,r,n.key,n.mode),c.elementType=n.elementType,c.type=n.type,c.stateNode=n.stateNode,c.alternate=n,n.alternate=c):(c.pendingProps=r,c.type=n.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=n.flags&14680064,c.childLanes=n.childLanes,c.lanes=n.lanes,c.child=n.child,c.memoizedProps=n.memoizedProps,c.memoizedState=n.memoizedState,c.updateQueue=n.updateQueue,r=n.dependencies,c.dependencies=r===null?null:{lanes:r.lanes,firstContext:r.firstContext},c.sibling=n.sibling,c.index=n.index,c.ref=n.ref,c}function X0(n,r,c,p,v,w){var A=2;if(p=n,typeof n=="function")l2(n)&&(A=1);else if(typeof n=="string")A=5;else e:switch(n){case Ff:return Wh(c.children,v,w,r);case IT:A=8,v|=8;break;case lS:return n=ba(12,c,r,v|2),n.elementType=lS,n.lanes=w,n;case cS:return n=ba(13,c,r,v),n.elementType=cS,n.lanes=w,n;case uS:return n=ba(19,c,r,v),n.elementType=uS,n.lanes=w,n;case cM:return Wx(c,v,w,r);default:if(typeof n=="object"&&n!==null)switch(n.$$typeof){case aM:A=10;break e;case lM:A=9;break e;case AT:A=11;break e;case CT:A=14;break e;case ou:A=16,p=null;break e}throw Error($t(130,n==null?n:typeof n,""))}return r=ba(A,c,r,v),r.elementType=n,r.type=p,r.lanes=w,r}function Wh(n,r,c,p){return n=ba(7,n,p,r),n.lanes=c,n}function Wx(n,r,c,p){return n=ba(22,n,p,r),n.elementType=cM,n.lanes=c,n.stateNode={isHidden:!1},n}function jw(n,r,c){return n=ba(6,n,null,r),n.lanes=c,n}function Nw(n,r,c){return r=ba(4,n.children!==null?n.children:[],n.key,r),r.lanes=c,r.stateNode={containerInfo:n.containerInfo,pendingChildren:null,implementation:n.implementation},r}function Ij(n,r,c,p,v){this.tag=r,this.containerInfo=n,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=xw(0),this.expirationTimes=xw(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=xw(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function c2(n,r,c,p,v,w,A,o,D){return n=new Ij(n,r,c,o,D),r===1?(r=1,w===!0&&(r|=8)):r=0,w=ba(3,null,null,r),n.current=w,w.stateNode=n,w.memoizedState={element:p,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},WT(w),n}function Aj(n,r,c){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Bf,key:p==null?null:""+p,children:n,containerInfo:r,implementation:c}}function eD(n){if(!n)return Au;n=n._reactInternals;e:{if(Qh(n)!==n||n.tag!==1)throw Error($t(170));var r=n;do{switch(r.tag){case 3:r=r.stateNode.context;break e;case 1:if(Ao(r.type)){r=r.stateNode.__reactInternalMemoizedMergedChildContext;break e}}r=r.return}while(r!==null);throw Error($t(171))}if(n.tag===1){var c=n.type;if(Ao(c))return eR(n,c,r)}return r}function tD(n,r,c,p,v,w,A,o,D){return n=c2(c,p,!0,n,v,w,A,o,D),n.context=eD(null),c=n.current,p=uo(),v=Su(c),w=oc(p,v),w.callback=r??null,bu(c,w,v),n.current.lanes=v,F_(n,v,p),Co(n,p),n}function qx(n,r,c,p){var v=r.current,w=uo(),A=Su(v);return c=eD(c),r.context===null?r.context=c:r.pendingContext=c,r=oc(w,A),r.payload={element:n},p=p===void 0?null:p,p!==null&&(r.callback=p),n=bu(v,r,A),n!==null&&(Ya(n,v,A,w),$0(n,v,A)),A}function vx(n){if(n=n.current,!n.child)return null;switch(n.child.tag){case 5:return n.child.stateNode;default:return n.child.stateNode}}function Wk(n,r){if(n=n.memoizedState,n!==null&&n.dehydrated!==null){var c=n.retryLane;n.retryLane=c!==0&&c<r?c:r}}function u2(n,r){Wk(n,r),(n=n.alternate)&&Wk(n,r)}function Cj(){return null}var iD=typeof reportError=="function"?reportError:function(n){console.error(n)};function h2(n){this._internalRoot=n}Zx.prototype.render=h2.prototype.render=function(n){var r=this._internalRoot;if(r===null)throw Error($t(409));qx(n,r,null,null)};Zx.prototype.unmount=h2.prototype.unmount=function(){var n=this._internalRoot;if(n!==null){this._internalRoot=null;var r=n.containerInfo;Yh(function(){qx(null,n,null,null)}),r[lc]=null}};function Zx(n){this._internalRoot=n}Zx.prototype.unstable_scheduleHydration=function(n){if(n){var r=RM();n={blockedOn:null,target:n,priority:r};for(var c=0;c<uu.length&&r!==0&&r<uu[c].priority;c++);uu.splice(c,0,n),c===0&&OM(n)}};function d2(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11)}function Xx(n){return!(!n||n.nodeType!==1&&n.nodeType!==9&&n.nodeType!==11&&(n.nodeType!==8||n.nodeValue!==" react-mount-point-unstable "))}function qk(){}function kj(n,r,c,p,v){if(v){if(typeof p=="function"){var w=p;p=function(){var j=vx(A);w.call(j)}}var A=tD(r,p,n,0,null,!1,!1,"",qk);return n._reactRootContainer=A,n[lc]=A.current,__(n.nodeType===8?n.parentNode:n),Yh(),A}for(;v=n.lastChild;)n.removeChild(v);if(typeof p=="function"){var o=p;p=function(){var j=vx(D);o.call(j)}}var D=c2(n,0,!1,null,null,!1,!1,"",qk);return n._reactRootContainer=D,n[lc]=D.current,__(n.nodeType===8?n.parentNode:n),Yh(function(){qx(r,D,c,p)}),D}function Kx(n,r,c,p,v){var w=c._reactRootContainer;if(w){var A=w;if(typeof v=="function"){var o=v;v=function(){var D=vx(A);o.call(D)}}qx(r,A,n,v)}else A=kj(c,r,n,v,p);return vx(A)}PM=function(n){switch(n.tag){case 3:var r=n.stateNode;if(r.current.memoizedState.isDehydrated){var c=qg(r.pendingLanes);c!==0&&(PT(r,c|1),Co(r,On()),!(Pr&6)&&(hp=On()+500,Lu()))}break;case 13:Yh(function(){var p=cc(n,1);if(p!==null){var v=uo();Ya(p,n,1,v)}}),u2(n,1)}};MT=function(n){if(n.tag===13){var r=cc(n,134217728);if(r!==null){var c=uo();Ya(r,n,134217728,c)}u2(n,134217728)}};MM=function(n){if(n.tag===13){var r=Su(n),c=cc(n,r);if(c!==null){var p=uo();Ya(c,n,r,p)}u2(n,r)}};RM=function(){return $r};DM=function(n,r){var c=$r;try{return $r=n,r()}finally{$r=c}};xS=function(n,r,c){switch(r){case"input":if(fS(n,c),r=c.name,c.type==="radio"&&r!=null){for(c=n;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+r)+'][type="radio"]'),r=0;r<c.length;r++){var p=c[r];if(p!==n&&p.form===n.form){var v=Nx(p);if(!v)throw Error($t(90));hM(p),fS(p,v)}}}break;case"textarea":fM(n,c);break;case"select":r=c.value,r!=null&&Yf(n,!!c.multiple,r,!1)}};xM=s2;bM=Yh;var Lj={usingClientEntryPoint:!1,Events:[N_,Vf,Nx,yM,vM,s2]},Ng={findFiberByHostInstance:Uh,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Pj={bundleType:Ng.bundleType,version:Ng.version,rendererPackageName:Ng.rendererPackageName,rendererConfig:Ng.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:dc.ReactCurrentDispatcher,findHostInstanceByFiber:function(n){return n=TM(n),n===null?null:n.stateNode},findFiberByHostInstance:Ng.findFiberByHostInstance||Cj,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var C0=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!C0.isDisabled&&C0.supportsFiber)try{zx=C0.inject(Pj),Ll=C0}catch{}}Yo.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Lj;Yo.createPortal=function(n,r){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d2(r))throw Error($t(200));return Aj(n,r,null,c)};Yo.createRoot=function(n,r){if(!d2(n))throw Error($t(299));var c=!1,p="",v=iD;return r!=null&&(r.unstable_strictMode===!0&&(c=!0),r.identifierPrefix!==void 0&&(p=r.identifierPrefix),r.onRecoverableError!==void 0&&(v=r.onRecoverableError)),r=c2(n,1,!1,null,null,c,!1,p,v),n[lc]=r.current,__(n.nodeType===8?n.parentNode:n),new h2(r)};Yo.findDOMNode=function(n){if(n==null)return null;if(n.nodeType===1)return n;var r=n._reactInternals;if(r===void 0)throw typeof n.render=="function"?Error($t(188)):(n=Object.keys(n).join(","),Error($t(268,n)));return n=TM(r),n=n===null?null:n.stateNode,n};Yo.flushSync=function(n){return Yh(n)};Yo.hydrate=function(n,r,c){if(!Xx(r))throw Error($t(200));return Kx(null,n,r,!0,c)};Yo.hydrateRoot=function(n,r,c){if(!d2(n))throw Error($t(405));var p=c!=null&&c.hydratedSources||null,v=!1,w="",A=iD;if(c!=null&&(c.unstable_strictMode===!0&&(v=!0),c.identifierPrefix!==void 0&&(w=c.identifierPrefix),c.onRecoverableError!==void 0&&(A=c.onRecoverableError)),r=tD(r,null,n,1,c??null,v,!1,w,A),n[lc]=r.current,__(n),p)for(n=0;n<p.length;n++)c=p[n],v=c._getVersion,v=v(c._source),r.mutableSourceEagerHydrationData==null?r.mutableSourceEagerHydrationData=[c,v]:r.mutableSourceEagerHydrationData.push(c,v);return new Zx(r)};Yo.render=function(n,r,c){if(!Xx(r))throw Error($t(200));return Kx(null,n,r,!1,c)};Yo.unmountComponentAtNode=function(n){if(!Xx(n))throw Error($t(40));return n._reactRootContainer?(Yh(function(){Kx(null,null,n,!1,function(){n._reactRootContainer=null,n[lc]=null})}),!0):!1};Yo.unstable_batchedUpdates=s2;Yo.unstable_renderSubtreeIntoContainer=function(n,r,c,p){if(!Xx(c))throw Error($t(200));if(n==null||n._reactInternals===void 0)throw Error($t(38));return Kx(n,r,c,!1,p)};Yo.version="18.3.1-next-f1338f8080-20240426";function rD(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(rD)}catch(n){console.error(n)}}rD(),rM.exports=Yo;var ed=rM.exports,Zk=ed;oS.createRoot=Zk.createRoot,oS.hydrateRoot=Zk.hydrateRoot;/**
 * @remix-run/router v1.23.2
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function I_(){return I_=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(n[p]=c[p])}return n},I_.apply(this,arguments)}var mu;(function(n){n.Pop="POP",n.Push="PUSH",n.Replace="REPLACE"})(mu||(mu={}));const Xk="popstate";function Mj(n){n===void 0&&(n={});function r(p,v){let{pathname:w,search:A,hash:o}=p.location;return QS("",{pathname:w,search:A,hash:o},v.state&&v.state.usr||null,v.state&&v.state.key||"default")}function c(p,v){return typeof v=="string"?v:xx(v)}return Dj(r,c,null,n)}function xn(n,r){if(n===!1||n===null||typeof n>"u")throw new Error(r)}function f2(n,r){if(!n){typeof console<"u"&&console.warn(r);try{throw new Error(r)}catch{}}}function Rj(){return Math.random().toString(36).substr(2,8)}function Kk(n,r){return{usr:n.state,key:n.key,idx:r}}function QS(n,r,c,p){return c===void 0&&(c=null),I_({pathname:typeof n=="string"?n:n.pathname,search:"",hash:""},typeof r=="string"?_p(r):r,{state:c,key:r&&r.key||p||Rj()})}function xx(n){let{pathname:r="/",search:c="",hash:p=""}=n;return c&&c!=="?"&&(r+=c.charAt(0)==="?"?c:"?"+c),p&&p!=="#"&&(r+=p.charAt(0)==="#"?p:"#"+p),r}function _p(n){let r={};if(n){let c=n.indexOf("#");c>=0&&(r.hash=n.substr(c),n=n.substr(0,c));let p=n.indexOf("?");p>=0&&(r.search=n.substr(p),n=n.substr(0,p)),n&&(r.pathname=n)}return r}function Dj(n,r,c,p){p===void 0&&(p={});let{window:v=document.defaultView,v5Compat:w=!1}=p,A=v.history,o=mu.Pop,D=null,j=J();j==null&&(j=0,A.replaceState(I_({},A.state,{idx:j}),""));function J(){return(A.state||{idx:null}).idx}function ie(){o=mu.Pop;let Ee=J(),ve=Ee==null?null:Ee-j;j=Ee,D&&D({action:o,location:xe.location,delta:ve})}function re(Ee,ve){o=mu.Push;let K=QS(xe.location,Ee,ve);j=J()+1;let fe=Kk(K,j),ke=xe.createHref(K);try{A.pushState(fe,"",ke)}catch(Be){if(Be instanceof DOMException&&Be.name==="DataCloneError")throw Be;v.location.assign(ke)}w&&D&&D({action:o,location:xe.location,delta:1})}function he(Ee,ve){o=mu.Replace;let K=QS(xe.location,Ee,ve);j=J();let fe=Kk(K,j),ke=xe.createHref(K);A.replaceState(fe,"",ke),w&&D&&D({action:o,location:xe.location,delta:0})}function ce(Ee){let ve=v.location.origin!=="null"?v.location.origin:v.location.href,K=typeof Ee=="string"?Ee:xx(Ee);return K=K.replace(/ $/,"%20"),xn(ve,"No window.location.(origin|href) available to create URL for href: "+K),new URL(K,ve)}let xe={get action(){return o},get location(){return n(v,A)},listen(Ee){if(D)throw new Error("A history only accepts one active listener");return v.addEventListener(Xk,ie),D=Ee,()=>{v.removeEventListener(Xk,ie),D=null}},createHref(Ee){return r(v,Ee)},createURL:ce,encodeLocation(Ee){let ve=ce(Ee);return{pathname:ve.pathname,search:ve.search,hash:ve.hash}},push:re,replace:he,go(Ee){return A.go(Ee)}};return xe}var Yk;(function(n){n.data="data",n.deferred="deferred",n.redirect="redirect",n.error="error"})(Yk||(Yk={}));function Oj(n,r,c){return c===void 0&&(c="/"),zj(n,r,c)}function zj(n,r,c,p){let v=typeof r=="string"?_p(r):r,w=dp(v.pathname||"/",c);if(w==null)return null;let A=nD(n);Bj(A);let o=null;for(let D=0;o==null&&D<A.length;++D){let j=Zj(w);o=Wj(A[D],j)}return o}function nD(n,r,c,p){r===void 0&&(r=[]),c===void 0&&(c=[]),p===void 0&&(p="");let v=(w,A,o)=>{let D={relativePath:o===void 0?w.path||"":o,caseSensitive:w.caseSensitive===!0,childrenIndex:A,route:w};D.relativePath.startsWith("/")&&(xn(D.relativePath.startsWith(p),'Absolute route path "'+D.relativePath+'" nested under path '+('"'+p+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),D.relativePath=D.relativePath.slice(p.length));let j=Eu([p,D.relativePath]),J=c.concat(D);w.children&&w.children.length>0&&(xn(w.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+j+'".')),nD(w.children,r,J,j)),!(w.path==null&&!w.index)&&r.push({path:j,score:Gj(j,w.index),routesMeta:J})};return n.forEach((w,A)=>{var o;if(w.path===""||!((o=w.path)!=null&&o.includes("?")))v(w,A);else for(let D of sD(w.path))v(w,A,D)}),r}function sD(n){let r=n.split("/");if(r.length===0)return[];let[c,...p]=r,v=c.endsWith("?"),w=c.replace(/\?$/,"");if(p.length===0)return v?[w,""]:[w];let A=sD(p.join("/")),o=[];return o.push(...A.map(D=>D===""?w:[w,D].join("/"))),v&&o.push(...A),o.map(D=>n.startsWith("/")&&D===""?"/":D)}function Bj(n){n.sort((r,c)=>r.score!==c.score?c.score-r.score:Hj(r.routesMeta.map(p=>p.childrenIndex),c.routesMeta.map(p=>p.childrenIndex)))}const Fj=/^:[\w-]+$/,jj=3,Nj=2,Uj=1,Vj=10,$j=-2,Jk=n=>n==="*";function Gj(n,r){let c=n.split("/"),p=c.length;return c.some(Jk)&&(p+=$j),r&&(p+=Nj),c.filter(v=>!Jk(v)).reduce((v,w)=>v+(Fj.test(w)?jj:w===""?Uj:Vj),p)}function Hj(n,r){return n.length===r.length&&n.slice(0,-1).every((p,v)=>p===r[v])?n[n.length-1]-r[r.length-1]:0}function Wj(n,r,c){let{routesMeta:p}=n,v={},w="/",A=[];for(let o=0;o<p.length;++o){let D=p[o],j=o===p.length-1,J=w==="/"?r:r.slice(w.length)||"/",ie=eT({path:D.relativePath,caseSensitive:D.caseSensitive,end:j},J),re=D.route;if(!ie)return null;Object.assign(v,ie.params),A.push({params:v,pathname:Eu([w,ie.pathname]),pathnameBase:Qj(Eu([w,ie.pathnameBase])),route:re}),ie.pathnameBase!=="/"&&(w=Eu([w,ie.pathnameBase]))}return A}function eT(n,r){typeof n=="string"&&(n={path:n,caseSensitive:!1,end:!0});let[c,p]=qj(n.path,n.caseSensitive,n.end),v=r.match(c);if(!v)return null;let w=v[0],A=w.replace(/(.)\/+$/,"$1"),o=v.slice(1);return{params:p.reduce((j,J,ie)=>{let{paramName:re,isOptional:he}=J;if(re==="*"){let xe=o[ie]||"";A=w.slice(0,w.length-xe.length).replace(/(.)\/+$/,"$1")}const ce=o[ie];return he&&!ce?j[re]=void 0:j[re]=(ce||"").replace(/%2F/g,"/"),j},{}),pathname:w,pathnameBase:A,pattern:n}}function qj(n,r,c){r===void 0&&(r=!1),c===void 0&&(c=!0),f2(n==="*"||!n.endsWith("*")||n.endsWith("/*"),'Route path "'+n+'" will be treated as if it were '+('"'+n.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+n.replace(/\*$/,"/*")+'".'));let p=[],v="^"+n.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(A,o,D)=>(p.push({paramName:o,isOptional:D!=null}),D?"/?([^\\/]+)?":"/([^\\/]+)"));return n.endsWith("*")?(p.push({paramName:"*"}),v+=n==="*"||n==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):c?v+="\\/*$":n!==""&&n!=="/"&&(v+="(?:(?=\\/|$))"),[new RegExp(v,r?void 0:"i"),p]}function Zj(n){try{return n.split("/").map(r=>decodeURIComponent(r).replace(/\//g,"%2F")).join("/")}catch(r){return f2(!1,'The URL path "'+n+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+r+").")),n}}function dp(n,r){if(r==="/")return n;if(!n.toLowerCase().startsWith(r.toLowerCase()))return null;let c=r.endsWith("/")?r.length-1:r.length,p=n.charAt(c);return p&&p!=="/"?null:n.slice(c)||"/"}const Xj=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Kj=n=>Xj.test(n);function Yj(n,r){r===void 0&&(r="/");let{pathname:c,search:p="",hash:v=""}=typeof n=="string"?_p(n):n,w;if(c)if(Kj(c))w=c;else{if(c.includes("//")){let A=c;c=c.replace(/\/\/+/g,"/"),f2(!1,"Pathnames cannot have embedded double slashes - normalizing "+(A+" -> "+c))}c.startsWith("/")?w=Qk(c.substring(1),"/"):w=Qk(c,r)}else w=r;return{pathname:w,search:e4(p),hash:t4(v)}}function Qk(n,r){let c=r.replace(/\/+$/,"").split("/");return n.split("/").forEach(v=>{v===".."?c.length>1&&c.pop():v!=="."&&c.push(v)}),c.length>1?c.join("/"):"/"}function Uw(n,r,c,p){return"Cannot include a '"+n+"' character in a manually specified "+("`to."+r+"` field ["+JSON.stringify(p)+"].  Please separate it out to the ")+("`to."+c+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function Jj(n){return n.filter((r,c)=>c===0||r.route.path&&r.route.path.length>0)}function p2(n,r){let c=Jj(n);return r?c.map((p,v)=>v===c.length-1?p.pathname:p.pathnameBase):c.map(p=>p.pathnameBase)}function m2(n,r,c,p){p===void 0&&(p=!1);let v;typeof n=="string"?v=_p(n):(v=I_({},n),xn(!v.pathname||!v.pathname.includes("?"),Uw("?","pathname","search",v)),xn(!v.pathname||!v.pathname.includes("#"),Uw("#","pathname","hash",v)),xn(!v.search||!v.search.includes("#"),Uw("#","search","hash",v)));let w=n===""||v.pathname==="",A=w?"/":v.pathname,o;if(A==null)o=c;else{let ie=r.length-1;if(!p&&A.startsWith("..")){let re=A.split("/");for(;re[0]==="..";)re.shift(),ie-=1;v.pathname=re.join("/")}o=ie>=0?r[ie]:"/"}let D=Yj(v,o),j=A&&A!=="/"&&A.endsWith("/"),J=(w||A===".")&&c.endsWith("/");return!D.pathname.endsWith("/")&&(j||J)&&(D.pathname+="/"),D}const Eu=n=>n.join("/").replace(/\/\/+/g,"/"),Qj=n=>n.replace(/\/+$/,"").replace(/^\/*/,"/"),e4=n=>!n||n==="?"?"":n.startsWith("?")?n:"?"+n,t4=n=>!n||n==="#"?"":n.startsWith("#")?n:"#"+n;function i4(n){return n!=null&&typeof n.status=="number"&&typeof n.statusText=="string"&&typeof n.internal=="boolean"&&"data"in n}const oD=["post","put","patch","delete"];new Set(oD);const r4=["get",...oD];new Set(r4);/**
 * React Router v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function A_(){return A_=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(n[p]=c[p])}return n},A_.apply(this,arguments)}const Yx=Z.createContext(null),aD=Z.createContext(null),fc=Z.createContext(null),Jx=Z.createContext(null),pc=Z.createContext({outlet:null,matches:[],isDataRoute:!1}),lD=Z.createContext(null);function n4(n,r){let{relative:c}=r===void 0?{}:r;yp()||xn(!1);let{basename:p,navigator:v}=Z.useContext(fc),{hash:w,pathname:A,search:o}=Qx(n,{relative:c}),D=A;return p!=="/"&&(D=A==="/"?p:Eu([p,A])),v.createHref({pathname:D,search:o,hash:w})}function yp(){return Z.useContext(Jx)!=null}function td(){return yp()||xn(!1),Z.useContext(Jx).location}function cD(n){Z.useContext(fc).static||Z.useLayoutEffect(n)}function id(){let{isDataRoute:n}=Z.useContext(pc);return n?y4():s4()}function s4(){yp()||xn(!1);let n=Z.useContext(Yx),{basename:r,future:c,navigator:p}=Z.useContext(fc),{matches:v}=Z.useContext(pc),{pathname:w}=td(),A=JSON.stringify(p2(v,c.v7_relativeSplatPath)),o=Z.useRef(!1);return cD(()=>{o.current=!0}),Z.useCallback(function(j,J){if(J===void 0&&(J={}),!o.current)return;if(typeof j=="number"){p.go(j);return}let ie=m2(j,JSON.parse(A),w,J.relative==="path");n==null&&r!=="/"&&(ie.pathname=ie.pathname==="/"?r:Eu([r,ie.pathname])),(J.replace?p.replace:p.push)(ie,J.state,J)},[r,p,A,w,n])}function o4(){let{matches:n}=Z.useContext(pc),r=n[n.length-1];return r?r.params:{}}function Qx(n,r){let{relative:c}=r===void 0?{}:r,{future:p}=Z.useContext(fc),{matches:v}=Z.useContext(pc),{pathname:w}=td(),A=JSON.stringify(p2(v,p.v7_relativeSplatPath));return Z.useMemo(()=>m2(n,JSON.parse(A),w,c==="path"),[n,A,w,c])}function a4(n,r){return l4(n,r)}function l4(n,r,c,p){yp()||xn(!1);let{navigator:v}=Z.useContext(fc),{matches:w}=Z.useContext(pc),A=w[w.length-1],o=A?A.params:{};A&&A.pathname;let D=A?A.pathnameBase:"/";A&&A.route;let j=td(),J;if(r){var ie;let Ee=typeof r=="string"?_p(r):r;D==="/"||(ie=Ee.pathname)!=null&&ie.startsWith(D)||xn(!1),J=Ee}else J=j;let re=J.pathname||"/",he=re;if(D!=="/"){let Ee=D.replace(/^\//,"").split("/");he="/"+re.replace(/^\//,"").split("/").slice(Ee.length).join("/")}let ce=Oj(n,{pathname:he}),xe=f4(ce&&ce.map(Ee=>Object.assign({},Ee,{params:Object.assign({},o,Ee.params),pathname:Eu([D,v.encodeLocation?v.encodeLocation(Ee.pathname).pathname:Ee.pathname]),pathnameBase:Ee.pathnameBase==="/"?D:Eu([D,v.encodeLocation?v.encodeLocation(Ee.pathnameBase).pathname:Ee.pathnameBase])})),w,c,p);return r&&xe?Z.createElement(Jx.Provider,{value:{location:A_({pathname:"/",search:"",hash:"",state:null,key:"default"},J),navigationType:mu.Pop}},xe):xe}function c4(){let n=_4(),r=i4(n)?n.status+" "+n.statusText:n instanceof Error?n.message:JSON.stringify(n),c=n instanceof Error?n.stack:null,v={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return Z.createElement(Z.Fragment,null,Z.createElement("h2",null,"Unexpected Application Error!"),Z.createElement("h3",{style:{fontStyle:"italic"}},r),c?Z.createElement("pre",{style:v},c):null,null)}const u4=Z.createElement(c4,null);class h4 extends Z.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,c){return c.location!==r.location||c.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:c.error,location:c.location,revalidation:r.revalidation||c.revalidation}}componentDidCatch(r,c){console.error("React Router caught the following error during render",r,c)}render(){return this.state.error!==void 0?Z.createElement(pc.Provider,{value:this.props.routeContext},Z.createElement(lD.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function d4(n){let{routeContext:r,match:c,children:p}=n,v=Z.useContext(Yx);return v&&v.static&&v.staticContext&&(c.route.errorElement||c.route.ErrorBoundary)&&(v.staticContext._deepestRenderedBoundaryId=c.route.id),Z.createElement(pc.Provider,{value:r},p)}function f4(n,r,c,p){var v;if(r===void 0&&(r=[]),c===void 0&&(c=null),p===void 0&&(p=null),n==null){var w;if(!c)return null;if(c.errors)n=c.matches;else if((w=p)!=null&&w.v7_partialHydration&&r.length===0&&!c.initialized&&c.matches.length>0)n=c.matches;else return null}let A=n,o=(v=c)==null?void 0:v.errors;if(o!=null){let J=A.findIndex(ie=>ie.route.id&&(o==null?void 0:o[ie.route.id])!==void 0);J>=0||xn(!1),A=A.slice(0,Math.min(A.length,J+1))}let D=!1,j=-1;if(c&&p&&p.v7_partialHydration)for(let J=0;J<A.length;J++){let ie=A[J];if((ie.route.HydrateFallback||ie.route.hydrateFallbackElement)&&(j=J),ie.route.id){let{loaderData:re,errors:he}=c,ce=ie.route.loader&&re[ie.route.id]===void 0&&(!he||he[ie.route.id]===void 0);if(ie.route.lazy||ce){D=!0,j>=0?A=A.slice(0,j+1):A=[A[0]];break}}}return A.reduceRight((J,ie,re)=>{let he,ce=!1,xe=null,Ee=null;c&&(he=o&&ie.route.id?o[ie.route.id]:void 0,xe=ie.route.errorElement||u4,D&&(j<0&&re===0?(v4("route-fallback"),ce=!0,Ee=null):j===re&&(ce=!0,Ee=ie.route.hydrateFallbackElement||null)));let ve=r.concat(A.slice(0,re+1)),K=()=>{let fe;return he?fe=xe:ce?fe=Ee:ie.route.Component?fe=Z.createElement(ie.route.Component,null):ie.route.element?fe=ie.route.element:fe=J,Z.createElement(d4,{match:ie,routeContext:{outlet:J,matches:ve,isDataRoute:c!=null},children:fe})};return c&&(ie.route.ErrorBoundary||ie.route.errorElement||re===0)?Z.createElement(h4,{location:c.location,revalidation:c.revalidation,component:xe,error:he,children:K(),routeContext:{outlet:null,matches:ve,isDataRoute:!0}}):K()},null)}var uD=function(n){return n.UseBlocker="useBlocker",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n}(uD||{}),hD=function(n){return n.UseBlocker="useBlocker",n.UseLoaderData="useLoaderData",n.UseActionData="useActionData",n.UseRouteError="useRouteError",n.UseNavigation="useNavigation",n.UseRouteLoaderData="useRouteLoaderData",n.UseMatches="useMatches",n.UseRevalidator="useRevalidator",n.UseNavigateStable="useNavigate",n.UseRouteId="useRouteId",n}(hD||{});function p4(n){let r=Z.useContext(Yx);return r||xn(!1),r}function m4(n){let r=Z.useContext(aD);return r||xn(!1),r}function g4(n){let r=Z.useContext(pc);return r||xn(!1),r}function dD(n){let r=g4(),c=r.matches[r.matches.length-1];return c.route.id||xn(!1),c.route.id}function _4(){var n;let r=Z.useContext(lD),c=m4(),p=dD();return r!==void 0?r:(n=c.errors)==null?void 0:n[p]}function y4(){let{router:n}=p4(uD.UseNavigateStable),r=dD(hD.UseNavigateStable),c=Z.useRef(!1);return cD(()=>{c.current=!0}),Z.useCallback(function(v,w){w===void 0&&(w={}),c.current&&(typeof v=="number"?n.navigate(v):n.navigate(v,A_({fromRouteId:r},w)))},[n,r])}const eL={};function v4(n,r,c){eL[n]||(eL[n]=!0)}function x4(n,r){n==null||n.v7_startTransition,n==null||n.v7_relativeSplatPath}function b4(n){let{to:r,replace:c,state:p,relative:v}=n;yp()||xn(!1);let{future:w,static:A}=Z.useContext(fc),{matches:o}=Z.useContext(pc),{pathname:D}=td(),j=id(),J=m2(r,p2(o,w.v7_relativeSplatPath),D,v==="path"),ie=JSON.stringify(J);return Z.useEffect(()=>j(JSON.parse(ie),{replace:c,state:p,relative:v}),[j,ie,v,c,p]),null}function lo(n){xn(!1)}function w4(n){let{basename:r="/",children:c=null,location:p,navigationType:v=mu.Pop,navigator:w,static:A=!1,future:o}=n;yp()&&xn(!1);let D=r.replace(/^\/*/,"/"),j=Z.useMemo(()=>({basename:D,navigator:w,static:A,future:A_({v7_relativeSplatPath:!1},o)}),[D,o,w,A]);typeof p=="string"&&(p=_p(p));let{pathname:J="/",search:ie="",hash:re="",state:he=null,key:ce="default"}=p,xe=Z.useMemo(()=>{let Ee=dp(J,D);return Ee==null?null:{location:{pathname:Ee,search:ie,hash:re,state:he,key:ce},navigationType:v}},[D,J,ie,re,he,ce,v]);return xe==null?null:Z.createElement(fc.Provider,{value:j},Z.createElement(Jx.Provider,{children:c,value:xe}))}function S4(n){let{children:r,location:c}=n;return a4(tT(r),c)}new Promise(()=>{});function tT(n,r){r===void 0&&(r=[]);let c=[];return Z.Children.forEach(n,(p,v)=>{if(!Z.isValidElement(p))return;let w=[...r,v];if(p.type===Z.Fragment){c.push.apply(c,tT(p.props.children,w));return}p.type!==lo&&xn(!1),!p.props.index||!p.props.children||xn(!1);let A={id:p.props.id||w.join("-"),caseSensitive:p.props.caseSensitive,element:p.props.element,Component:p.props.Component,index:p.props.index,path:p.props.path,loader:p.props.loader,action:p.props.action,errorElement:p.props.errorElement,ErrorBoundary:p.props.ErrorBoundary,hasErrorBoundary:p.props.ErrorBoundary!=null||p.props.errorElement!=null,shouldRevalidate:p.props.shouldRevalidate,handle:p.props.handle,lazy:p.props.lazy};p.props.children&&(A.children=tT(p.props.children,w)),c.push(A)}),c}/**
 * React Router DOM v6.30.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function bx(){return bx=Object.assign?Object.assign.bind():function(n){for(var r=1;r<arguments.length;r++){var c=arguments[r];for(var p in c)Object.prototype.hasOwnProperty.call(c,p)&&(n[p]=c[p])}return n},bx.apply(this,arguments)}function fD(n,r){if(n==null)return{};var c={},p=Object.keys(n),v,w;for(w=0;w<p.length;w++)v=p[w],!(r.indexOf(v)>=0)&&(c[v]=n[v]);return c}function T4(n){return!!(n.metaKey||n.altKey||n.ctrlKey||n.shiftKey)}function E4(n,r){return n.button===0&&(!r||r==="_self")&&!T4(n)}const I4=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],A4=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],C4="6";try{window.__reactRouterVersion=C4}catch{}const k4=Z.createContext({isTransitioning:!1}),L4="startTransition",tL=bF[L4];function P4(n){let{basename:r,children:c,future:p,window:v}=n,w=Z.useRef();w.current==null&&(w.current=Mj({window:v,v5Compat:!0}));let A=w.current,[o,D]=Z.useState({action:A.action,location:A.location}),{v7_startTransition:j}=p||{},J=Z.useCallback(ie=>{j&&tL?tL(()=>D(ie)):D(ie)},[D,j]);return Z.useLayoutEffect(()=>A.listen(J),[A,J]),Z.useEffect(()=>x4(p),[p]),Z.createElement(w4,{basename:r,children:c,location:o.location,navigationType:o.action,navigator:A,future:p})}const M4=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",R4=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,D4=Z.forwardRef(function(r,c){let{onClick:p,relative:v,reloadDocument:w,replace:A,state:o,target:D,to:j,preventScrollReset:J,viewTransition:ie}=r,re=fD(r,I4),{basename:he}=Z.useContext(fc),ce,xe=!1;if(typeof j=="string"&&R4.test(j)&&(ce=j,M4))try{let fe=new URL(window.location.href),ke=j.startsWith("//")?new URL(fe.protocol+j):new URL(j),Be=dp(ke.pathname,he);ke.origin===fe.origin&&Be!=null?j=Be+ke.search+ke.hash:xe=!0}catch{}let Ee=n4(j,{relative:v}),ve=z4(j,{replace:A,state:o,target:D,preventScrollReset:J,relative:v,viewTransition:ie});function K(fe){p&&p(fe),fe.defaultPrevented||ve(fe)}return Z.createElement("a",bx({},re,{href:ce||Ee,onClick:xe||w?p:K,ref:c,target:D}))}),If=Z.forwardRef(function(r,c){let{"aria-current":p="page",caseSensitive:v=!1,className:w="",end:A=!1,style:o,to:D,viewTransition:j,children:J}=r,ie=fD(r,A4),re=Qx(D,{relative:ie.relative}),he=td(),ce=Z.useContext(aD),{navigator:xe,basename:Ee}=Z.useContext(fc),ve=ce!=null&&B4(re)&&j===!0,K=xe.encodeLocation?xe.encodeLocation(re).pathname:re.pathname,fe=he.pathname,ke=ce&&ce.navigation&&ce.navigation.location?ce.navigation.location.pathname:null;v||(fe=fe.toLowerCase(),ke=ke?ke.toLowerCase():null,K=K.toLowerCase()),ke&&Ee&&(ke=dp(ke,Ee)||ke);const Be=K!=="/"&&K.endsWith("/")?K.length-1:K.length;let Le=fe===K||!A&&fe.startsWith(K)&&fe.charAt(Be)==="/",We=ke!=null&&(ke===K||!A&&ke.startsWith(K)&&ke.charAt(K.length)==="/"),ct={isActive:Le,isPending:We,isTransitioning:ve},lt=Le?p:void 0,Pt;typeof w=="function"?Pt=w(ct):Pt=[w,Le?"active":null,We?"pending":null,ve?"transitioning":null].filter(Boolean).join(" ");let zt=typeof o=="function"?o(ct):o;return Z.createElement(D4,bx({},ie,{"aria-current":lt,className:Pt,ref:c,style:zt,to:D,viewTransition:j}),typeof J=="function"?J(ct):J)});var iT;(function(n){n.UseScrollRestoration="useScrollRestoration",n.UseSubmit="useSubmit",n.UseSubmitFetcher="useSubmitFetcher",n.UseFetcher="useFetcher",n.useViewTransitionState="useViewTransitionState"})(iT||(iT={}));var iL;(function(n){n.UseFetcher="useFetcher",n.UseFetchers="useFetchers",n.UseScrollRestoration="useScrollRestoration"})(iL||(iL={}));function O4(n){let r=Z.useContext(Yx);return r||xn(!1),r}function z4(n,r){let{target:c,replace:p,state:v,preventScrollReset:w,relative:A,viewTransition:o}=r===void 0?{}:r,D=id(),j=td(),J=Qx(n,{relative:A});return Z.useCallback(ie=>{if(E4(ie,c)){ie.preventDefault();let re=p!==void 0?p:xx(j)===xx(J);D(n,{replace:re,state:v,preventScrollReset:w,relative:A,viewTransition:o})}},[j,D,J,p,v,c,n,w,A,o])}function B4(n,r){r===void 0&&(r={});let c=Z.useContext(k4);c==null&&xn(!1);let{basename:p}=O4(iT.useViewTransitionState),v=Qx(n,{relative:r.relative});if(!c.isTransitioning)return!1;let w=dp(c.currentLocation.pathname,p)||c.currentLocation.pathname,A=dp(c.nextLocation.pathname,p)||c.nextLocation.pathname;return eT(v.pathname,A)!=null||eT(v.pathname,w)!=null}/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var F4={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j4=n=>n.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),tr=(n,r)=>{const c=Z.forwardRef(({color:p="currentColor",size:v=24,strokeWidth:w=2,absoluteStrokeWidth:A,className:o="",children:D,...j},J)=>Z.createElement("svg",{ref:J,...F4,width:v,height:v,stroke:p,strokeWidth:A?Number(w)*24/Number(v):w,className:["lucide",`lucide-${j4(n)}`,o].join(" "),...j},[...r.map(([ie,re])=>Z.createElement(ie,re)),...Array.isArray(D)?D:[D]]));return c.displayName=`${n}`,c};/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const N4=tr("Activity",[["path",{d:"M22 12h-4l-3 9L9 3l-3 9H2",key:"d5dnw9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const U4=tr("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pD=tr("AlertTriangle",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z",key:"c3ski4"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e1=tr("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V4=tr("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const mD=tr("CheckCircle",[["path",{d:"M22 11.08V12a10 10 0 1 1-5.93-9.14",key:"g774vq"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=tr("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $4=tr("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rf=tr("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G4=tr("ClipboardList",[["rect",{width:"8",height:"4",x:"8",y:"2",rx:"1",ry:"1",key:"tgr4d6"}],["path",{d:"M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2",key:"116196"}],["path",{d:"M12 11h4",key:"1jrz19"}],["path",{d:"M12 16h4",key:"n85exb"}],["path",{d:"M8 11h.01",key:"1dfujw"}],["path",{d:"M8 16h.01",key:"18s6g9"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t1=tr("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const H4=tr("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W4=tr("FileCheck",[["path",{d:"M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z",key:"1nnpy2"}],["polyline",{points:"14 2 14 8 20 8",key:"1ew0cm"}],["path",{d:"m9 15 2 2 4-4",key:"1grp1n"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q4=tr("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z4=tr("Flame",[["path",{d:"M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z",key:"96xj49"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X4=tr("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gD=tr("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K4=tr("Lightbulb",[["path",{d:"M15 14c.2-1 .7-1.7 1.5-2.5 1-.9 1.5-2.2 1.5-3.5A6 6 0 0 0 6 8c0 1 .2 2.2 1.5 3.5.7.7 1.3 1.5 1.5 2.5",key:"1gvzjb"}],["path",{d:"M9 18h6",key:"x1upvd"}],["path",{d:"M10 22h4",key:"ceow96"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y4=tr("List",[["line",{x1:"8",x2:"21",y1:"6",y2:"6",key:"7ey8pc"}],["line",{x1:"8",x2:"21",y1:"12",y2:"12",key:"rjfblc"}],["line",{x1:"8",x2:"21",y1:"18",y2:"18",key:"c3b1m8"}],["line",{x1:"3",x2:"3.01",y1:"6",y2:"6",key:"1g7gq3"}],["line",{x1:"3",x2:"3.01",y1:"12",y2:"12",key:"1pjlvk"}],["line",{x1:"3",x2:"3.01",y1:"18",y2:"18",key:"28t2mc"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const J4=tr("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Q4=tr("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eN=tr("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hc=tr("MapPin",[["path",{d:"M20 10c0 6-8 12-8 12s-8-6-8-12a8 8 0 0 1 16 0Z",key:"2oe9fu"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tN=tr("Map",[["polygon",{points:"3 6 9 3 15 6 21 3 21 18 15 21 9 18 3 21",key:"ok2ie8"}],["line",{x1:"9",x2:"9",y1:"3",y2:"18",key:"w34qz5"}],["line",{x1:"15",x2:"15",y1:"6",y2:"21",key:"volv9a"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rT=tr("MessageCircle",[["path",{d:"m3 21 1.9-5.7a8.5 8.5 0 1 1 3.8 3.8z",key:"v2veuj"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _D=tr("Navigation",[["polygon",{points:"3 11 22 2 13 21 11 13 3 11",key:"1ltx0t"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yD=tr("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iN=tr("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rN=tr("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nN=tr("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sN=tr("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oN=tr("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const g2=tr("Shield",[["path",{d:"M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10",key:"1irkt0"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vD=tr("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aN=tr("ThumbsDown",[["path",{d:"M17 14V2",key:"8ymqnk"}],["path",{d:"M9 18.12 10 14H4.17a2 2 0 0 1-1.92-2.56l2.33-8A2 2 0 0 1 6.5 2H20a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2h-2.76a2 2 0 0 0-1.79 1.11L12 22h0a3.13 3.13 0 0 1-3-3.88Z",key:"s6e0r"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lN=tr("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=tr("Trophy",[["path",{d:"M6 9H4.5a2.5 2.5 0 0 1 0-5H6",key:"17hqa7"}],["path",{d:"M18 9h1.5a2.5 2.5 0 0 0 0-5H18",key:"lmptdp"}],["path",{d:"M4 22h16",key:"57wxv0"}],["path",{d:"M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22",key:"1nw9bq"}],["path",{d:"M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22",key:"1np0yb"}],["path",{d:"M18 2H6v7a6 6 0 0 0 12 0V2Z",key:"u46fv3"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cN=tr("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xD=tr("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uN=tr("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hN=tr("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);/**
 * @license lucide-react v0.294.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _2=tr("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]]);function dN({onRefresh:n,children:r}){const[c,p]=Z.useState(0),[v,w]=Z.useState(!1),A=Z.useRef(0),o=Z.useRef(null),D=80,j=Z.useCallback(ce=>{var xe;((xe=o.current)==null?void 0:xe.scrollTop)===0&&(A.current=ce.touches[0].clientY)},[]),J=Z.useCallback(ce=>{var ve;if(v||((ve=o.current)==null?void 0:ve.scrollTop)!==0)return;const Ee=ce.touches[0].clientY-A.current;if(Ee>0&&A.current>0){const K=Math.min(Ee*.5,120);p(K)}},[v]),ie=Z.useCallback(async()=>{if(c>=D&&!v){w(!0),p(50);try{await n()}finally{w(!1),p(0)}}else p(0);A.current=0},[c,v,n]),re=c>10||v,he=c>=D;return N.jsxs("div",{ref:o,onTouchStart:j,onTouchMove:J,onTouchEnd:ie,style:{minHeight:"100%",transform:`translateY(${c*.3}px)`,transition:c===0?"transform 0.3s cubic-bezier(0.22, 1, 0.36, 1)":"none"},children:[N.jsx("div",{className:`pull-indicator ${re?"visible":""} ${v?"refreshing":""}`,style:{opacity:Math.min(c/D,1)},children:v?N.jsxs(N.Fragment,{children:[N.jsx("div",{className:"pull-spinner"}),N.jsx("span",{children:"Refreshing..."})]}):he?N.jsx("span",{children:"Release to refresh"}):N.jsx("span",{children:" Pull to refresh"})}),r]})}const fN=.7,pN=.9,mN=1e4,gN=.015;function _N(){const n=id(),r=new Date().getHours(),[,c]=Z.useState(0),p=r<12?"Good morning":r<17?"Good afternoon":"Good evening",v={name:"Marcus"},w=5,A=67,o=100,D=10,j=w*fN,J=j*pN,ie=J*mN,re=ie*gN,he=Z.useCallback(async()=>{await new Promise(ce=>setTimeout(ce,1200)),c(ce=>ce+1)},[]);return N.jsx(dN,{onRefresh:he,children:N.jsxs("div",{className:"page",children:[N.jsxs("div",{className:"greeting",children:[p,", ",v.name," ",N.jsx("span",{className:"greeting-time",children:""})]}),N.jsxs("div",{className:"card",style:{background:"linear-gradient(135deg, var(--bg-secondary) 0%, rgba(16, 185, 129, 0.1) 100%)",border:"1px solid rgba(16, 185, 129, 0.2)"},children:[N.jsx("div",{className:"card-title",children:"Today's Deals"}),N.jsx("div",{className:"earnings-big",style:{fontSize:"4rem"},children:w}),N.jsx("div",{className:"earnings-sub",style:{marginTop:"0.5rem"},children:"deals submitted"}),N.jsxs("div",{style:{marginTop:"1.25rem",paddingTop:"1rem",borderTop:"1px solid var(--bg-card)",display:"grid",gridTemplateColumns:"1fr 1fr",gap:"1rem"},children:[N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Proj. Approved (70%)"}),N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:j.toFixed(1)})]}),N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Proj. Allocated (90%)"}),N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:J.toFixed(1)})]}),N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Proj. kWh"}),N.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:600,display:"flex",alignItems:"center",gap:"0.25rem"},children:[N.jsx(_2,{size:16,style:{color:"var(--warning)"}}),(ie/1e3).toFixed(1),"k"]})]}),N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",textTransform:"uppercase",letterSpacing:"0.05em"},children:"Proj. Earnings"}),N.jsxs("div",{style:{fontSize:"1.25rem",fontWeight:600,color:"var(--accent)"},children:["$",re.toFixed(0)]})]})]})]}),N.jsxs("div",{className:"card",style:{display:"flex",gap:"0.75rem"},children:[N.jsxs("button",{className:"btn btn-secondary",style:{flex:1},onClick:()=>n("/map"),children:[N.jsx(hc,{size:18}),"Map"]}),N.jsxs("button",{className:"btn btn-secondary",style:{flex:1},onClick:()=>n("/log"),children:[N.jsx(G4,{size:18}),"View Log"]}),N.jsxs("button",{className:"btn btn-primary",style:{flex:1},onClick:()=>n("/door/next"),children:[N.jsx(iN,{size:18}),"Start"]})]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Daily Progress"}),N.jsxs("div",{className:"progress-container",children:[N.jsxs("div",{className:"progress-label",children:[N.jsx("span",{children:"Doors Knocked"}),N.jsxs("span",{children:[A,"/",o]})]}),N.jsx("div",{className:"progress-bar",children:N.jsx("div",{className:"progress-fill",style:{width:`${Math.min(A/o*100,100)}%`}})})]}),N.jsxs("div",{className:"progress-container",children:[N.jsxs("div",{className:"progress-label",children:[N.jsx("span",{children:"Deals"}),N.jsxs("span",{children:[w,"/",D]})]}),N.jsx("div",{className:"progress-bar",children:N.jsx("div",{className:"progress-fill",style:{width:`${Math.min(w/D*100,100)}%`}})})]})]}),N.jsx("div",{className:"card",style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.15) 0%, rgba(245, 158, 11, 0.05) 100%)",border:"1px solid rgba(251, 191, 36, 0.2)"},children:N.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[N.jsxs("div",{children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[N.jsx("span",{style:{fontSize:"1.5rem"},children:""}),N.jsx("span",{style:{fontSize:"1.25rem",fontWeight:700,color:"#fbbf24"},children:"7 Day Streak"})]}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:"3 more days for $50 bonus!"})]}),N.jsx("button",{onClick:()=>n("/achievements"),style:{background:"rgba(251, 191, 36, 0.2)",border:"none",borderRadius:"0.5rem",padding:"0.5rem 0.75rem",color:"#fbbf24",fontSize:"0.75rem",fontWeight:600},children:"View All "})]})})]})})}function C_(n){"@babel/helpers - typeof";return C_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},C_(n)}function yN(n,r){if(C_(n)!="object"||!n)return n;var c=n[Symbol.toPrimitive];if(c!==void 0){var p=c.call(n,r);if(C_(p)!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}function vN(n){var r=yN(n,"string");return C_(r)=="symbol"?r:r+""}function It(n,r,c){return(r=vN(r))in n?Object.defineProperty(n,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[r]=c,n}function bD(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var Vw,rL;function xN(){if(rL)return Vw;rL=1;var n=function(c,p,v,w,A,o,D,j){if(!c){var J;if(p===void 0)J=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var ie=[v,w,A,o,D,j],re=0;J=new Error(p.replace(/%s/g,function(){return ie[re++]})),J.name="Invariant Violation"}throw J.framesToPop=1,J}};return Vw=n,Vw}var bN=xN(),Qn=bD(bN),rr=Z.createContext(null);function wN(){Qn(!!Z.useContext,"useGoogleMap is React hook and requires React version 16.8+");var n=Z.useContext(rr);return Qn(!!n,"useGoogleMap needs a GoogleMap available up in the tree"),n}function SN(n,r,c){return Object.keys(n).reduce(function(v,w){return r(v,n[w],w)},c)}function TN(n,r){Object.keys(n).forEach(c=>r(n[c],c))}function EN(n,r,c,p){var v={},w=(A,o)=>{var D=c[o];D!==r[o]&&(v[o]=D,A(p,D))};return TN(n,w),v}function IN(n,r,c){var p=SN(c,function(w,A,o){return typeof n[o]=="function"&&w.push(google.maps.event.addListener(r,A,n[o])),w},[]);return p}function AN(n){google.maps.event.removeListener(n)}function _r(){var n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[];n.forEach(AN)}function fr(n){var{updaterMap:r,eventMap:c,prevProps:p,nextProps:v,instance:w}=n,A=IN(v,w,c);return EN(r,p,v,w),A}var nL={onDblClick:"dblclick",onDragEnd:"dragend",onDragStart:"dragstart",onMapTypeIdChanged:"maptypeid_changed",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseDown:"mousedown",onMouseUp:"mouseup",onRightClick:"rightclick",onTilesLoaded:"tilesloaded",onBoundsChanged:"bounds_changed",onCenterChanged:"center_changed",onClick:"click",onDrag:"drag",onHeadingChanged:"heading_changed",onIdle:"idle",onProjectionChanged:"projection_changed",onResize:"resize",onTiltChanged:"tilt_changed",onZoomChanged:"zoom_changed"},sL={extraMapTypes(n,r){r.forEach(function(p,v){n.mapTypes.set(String(v),p)})},center(n,r){n.setCenter(r)},clickableIcons(n,r){n.setClickableIcons(r)},heading(n,r){n.setHeading(r)},mapTypeId(n,r){n.setMapTypeId(r)},options(n,r){n.setOptions(r)},streetView(n,r){n.setStreetView(r)},tilt(n,r){n.setTilt(r)},zoom(n,r){n.setZoom(r)}};function CN(n){var{children:r,options:c,id:p,mapContainerStyle:v,mapContainerClassName:w,center:A,onClick:o,onDblClick:D,onDrag:j,onDragEnd:J,onDragStart:ie,onMouseMove:re,onMouseOut:he,onMouseOver:ce,onMouseDown:xe,onMouseUp:Ee,onRightClick:ve,onCenterChanged:K,onLoad:fe,onUnmount:ke}=n,[Be,Le]=Z.useState(null),We=Z.useRef(null),[ct,lt]=Z.useState(null),[Pt,zt]=Z.useState(null),[_i,Ut]=Z.useState(null),[bi,vi]=Z.useState(null),[ei,si]=Z.useState(null),[Tt,Ht]=Z.useState(null),[Gt,hi]=Z.useState(null),[Ft,Ot]=Z.useState(null),[di,wt]=Z.useState(null),[sr,pr]=Z.useState(null),[Fi,Si]=Z.useState(null),[Qt,Di]=Z.useState(null);return Z.useEffect(()=>{c&&Be!==null&&Be.setOptions(c)},[Be,c]),Z.useEffect(()=>{Be!==null&&typeof A<"u"&&Be.setCenter(A)},[Be,A]),Z.useEffect(()=>{Be&&D&&(Pt!==null&&google.maps.event.removeListener(Pt),zt(google.maps.event.addListener(Be,"dblclick",D)))},[D]),Z.useEffect(()=>{Be&&J&&(_i!==null&&google.maps.event.removeListener(_i),Ut(google.maps.event.addListener(Be,"dragend",J)))},[J]),Z.useEffect(()=>{Be&&ie&&(bi!==null&&google.maps.event.removeListener(bi),vi(google.maps.event.addListener(Be,"dragstart",ie)))},[ie]),Z.useEffect(()=>{Be&&xe&&(ei!==null&&google.maps.event.removeListener(ei),si(google.maps.event.addListener(Be,"mousedown",xe)))},[xe]),Z.useEffect(()=>{Be&&re&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(Be,"mousemove",re)))},[re]),Z.useEffect(()=>{Be&&he&&(Gt!==null&&google.maps.event.removeListener(Gt),hi(google.maps.event.addListener(Be,"mouseout",he)))},[he]),Z.useEffect(()=>{Be&&ce&&(Ft!==null&&google.maps.event.removeListener(Ft),Ot(google.maps.event.addListener(Be,"mouseover",ce)))},[ce]),Z.useEffect(()=>{Be&&Ee&&(di!==null&&google.maps.event.removeListener(di),wt(google.maps.event.addListener(Be,"mouseup",Ee)))},[Ee]),Z.useEffect(()=>{Be&&ve&&(sr!==null&&google.maps.event.removeListener(sr),pr(google.maps.event.addListener(Be,"rightclick",ve)))},[ve]),Z.useEffect(()=>{Be&&o&&(Fi!==null&&google.maps.event.removeListener(Fi),Si(google.maps.event.addListener(Be,"click",o)))},[o]),Z.useEffect(()=>{Be&&j&&(Qt!==null&&google.maps.event.removeListener(Qt),Di(google.maps.event.addListener(Be,"drag",j)))},[j]),Z.useEffect(()=>{Be&&K&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(Be,"center_changed",K)))},[o]),Z.useEffect(()=>{var Pn=We.current===null?null:new google.maps.Map(We.current,c);return Le(Pn),Pn!==null&&fe&&fe(Pn),()=>{Pn!==null&&ke&&ke(Pn)}},[]),N.jsx("div",{id:p,ref:We,style:v,className:w,children:N.jsx(rr.Provider,{value:Be,children:Be!==null?r:null})})}Z.memo(CN);class kN extends Z.PureComponent{constructor(){super(...arguments),It(this,"state",{map:null}),It(this,"registeredEvents",[]),It(this,"mapRef",null),It(this,"getInstance",()=>this.mapRef===null?null:new google.maps.Map(this.mapRef,this.props.options)),It(this,"panTo",r=>{var c=this.getInstance();c&&c.panTo(r)}),It(this,"setMapCallback",()=>{this.state.map!==null&&this.props.onLoad&&this.props.onLoad(this.state.map)}),It(this,"getRef",r=>{this.mapRef=r})}componentDidMount(){var r=this.getInstance();this.registeredEvents=fr({updaterMap:sL,eventMap:nL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{map:r}},this.setMapCallback)}componentDidUpdate(r){this.state.map!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:sL,eventMap:nL,prevProps:r,nextProps:this.props,instance:this.state.map}))}componentWillUnmount(){this.state.map!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.map),_r(this.registeredEvents))}render(){return N.jsx("div",{id:this.props.id,ref:this.getRef,style:this.props.mapContainerStyle,className:this.props.mapContainerClassName,children:N.jsx(rr.Provider,{value:this.state.map,children:this.state.map!==null?this.props.children:null})})}}function oL(n,r,c,p,v,w,A){try{var o=n[w](A),D=o.value}catch(j){return void c(j)}o.done?r(D):Promise.resolve(D).then(p,v)}function wD(n){return function(){var r=this,c=arguments;return new Promise(function(p,v){var w=n.apply(r,c);function A(D){oL(w,p,v,A,o,"next",D)}function o(D){oL(w,p,v,A,o,"throw",D)}A(void 0)})}}function SD(n){var{googleMapsApiKey:r,googleMapsClientId:c,version:p="weekly",language:v,region:w,libraries:A,channel:o,mapIds:D,authReferrerPolicy:j,apiUrl:J="https://maps.googleapis.com"}=n,ie=[];return Qn(r&&c||!(r&&c),"You need to specify either googleMapsApiKey or googleMapsClientId for @react-google-maps/api load script to work. You cannot use both at the same time."),r?ie.push("key=".concat(r)):c&&ie.push("client=".concat(c)),p&&ie.push("v=".concat(p)),v&&ie.push("language=".concat(v)),w&&ie.push("region=".concat(w)),A&&A.length&&ie.push("libraries=".concat(A.sort().join(","))),o&&ie.push("channel=".concat(o)),D&&D.length&&ie.push("map_ids=".concat(D.join(","))),j&&ie.push("auth_referrer_policy=".concat(j)),ie.push("loading=async"),ie.push("callback=initMap"),"".concat(J,"/maps/api/js?").concat(ie.join("&"))}var gu=typeof document<"u";function TD(n){var{url:r,id:c,nonce:p}=n;return gu?new Promise(function(w,A){var o=document.getElementById(c),D=window;if(o){var j=o.getAttribute("data-state");if(o.src===r&&j!=="error"){if(j==="ready")return w(c);var J=D.initMap,ie=o.onerror;D.initMap=function(){J&&J(),w(c)},o.onerror=function(he){ie&&ie(he),A(he)};return}else o.remove()}var re=document.createElement("script");re.type="text/javascript",re.src=r,re.id=c,re.async=!0,re.nonce=p||"",re.onerror=function(ce){re.setAttribute("data-state","error"),A(ce)},D.initMap=function(){re.setAttribute("data-state","ready"),w(c)},document.head.appendChild(re)}).catch(v=>{throw console.error("injectScript error: ",v),v}):Promise.reject(new Error("document is undefined"))}function aL(n){var r=n.href;return r&&(r.indexOf("https://fonts.googleapis.com/css?family=Roboto")===0||r.indexOf("https://fonts.googleapis.com/css?family=Google+Sans+Text")===0)?!0:n.tagName.toLowerCase()==="style"&&n.styleSheet&&n.styleSheet.cssText&&n.styleSheet.cssText.replace(`\r
`,"").indexOf(".gm-style")===0?(n.styleSheet.cssText="",!0):n.tagName.toLowerCase()==="style"&&n.innerHTML&&n.innerHTML.replace(`\r
`,"").indexOf(".gm-style")===0?(n.innerHTML="",!0):n.tagName.toLowerCase()==="style"&&!n.styleSheet&&!n.innerHTML}function y2(){var n=document.getElementsByTagName("head")[0];if(n){var r=n.insertBefore.bind(n);n.insertBefore=function(v,w){return aL(v)||Reflect.apply(r,n,[v,w]),v};var c=n.appendChild.bind(n);n.appendChild=function(v){return aL(v)||Reflect.apply(c,n,[v]),v}}}var Ug=!1;function ED(){return N.jsx("div",{children:"Loading..."})}var k_={id:"script-loader",version:"weekly"};class LN extends Z.PureComponent{constructor(){super(...arguments),It(this,"check",null),It(this,"state",{loaded:!1}),It(this,"cleanupCallback",()=>{delete window.google.maps,this.injectScript()}),It(this,"isCleaningUp",wD(function*(){function r(c){if(!Ug)c();else if(gu)var p=window.setInterval(function(){Ug||(window.clearInterval(p),c())},1)}return new Promise(r)})),It(this,"cleanup",()=>{Ug=!0;var r=document.getElementById(this.props.id);r&&r.parentNode&&r.parentNode.removeChild(r),Array.prototype.slice.call(document.getElementsByTagName("script")).filter(function(p){return typeof p.src=="string"&&p.src.includes("maps.googleapis")}).forEach(function(p){p.parentNode&&p.parentNode.removeChild(p)}),Array.prototype.slice.call(document.getElementsByTagName("link")).filter(function(p){return p.href==="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Google+Sans"}).forEach(function(p){p.parentNode&&p.parentNode.removeChild(p)}),Array.prototype.slice.call(document.getElementsByTagName("style")).filter(function(p){return p.innerText!==void 0&&p.innerText.length>0&&p.innerText.includes(".gm-")}).forEach(function(p){p.parentNode&&p.parentNode.removeChild(p)})}),It(this,"injectScript",()=>{this.props.preventGoogleFontsLoading&&y2(),Qn(!!this.props.id,'LoadScript requires "id" prop to be a string: %s',this.props.id);var r={id:this.props.id,nonce:this.props.nonce,url:SD(this.props)};TD(r).then(()=>{this.props.onLoad&&this.props.onLoad(),this.setState(function(){return{loaded:!0}})}).catch(c=>{this.props.onError&&this.props.onError(c),console.error(`
          There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(this.props.googleMapsApiKey||"-",") or Client ID (").concat(this.props.googleMapsClientId||"-",`) to <LoadScript />
          Otherwise it is a Network issue.
        `))})}),It(this,"getRef",r=>{this.check=r})}componentDidMount(){if(gu){if(window.google&&window.google.maps&&!Ug){console.error("google api is already presented");return}this.isCleaningUp().then(this.injectScript).catch(function(c){console.error("Error at injecting script after cleaning up: ",c)})}}componentDidUpdate(r){this.props.libraries!==r.libraries&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),gu&&r.language!==this.props.language&&(this.cleanup(),this.setState(function(){return{loaded:!1}},this.cleanupCallback))}componentWillUnmount(){if(gu){this.cleanup();var r=()=>{this.check||(delete window.google,Ug=!1)};window.setTimeout(r,1),this.props.onUnmount&&this.props.onUnmount()}}render(){return N.jsxs(N.Fragment,{children:[N.jsx("div",{ref:this.getRef}),this.state.loaded?this.props.children:this.props.loadingElement||N.jsx(ED,{})]})}}It(LN,"defaultProps",k_);function PN(n,r){if(n==null)return{};var c={};for(var p in n)if({}.hasOwnProperty.call(n,p)){if(r.includes(p))continue;c[p]=n[p]}return c}function v2(n,r){if(n==null)return{};var c,p,v=PN(n,r);if(Object.getOwnPropertySymbols){var w=Object.getOwnPropertySymbols(n);for(p=0;p<w.length;p++)c=w[p],r.includes(c)||{}.propertyIsEnumerable.call(n,c)&&(v[c]=n[c])}return v}var lL;function MN(n){var{id:r=k_.id,version:c=k_.version,nonce:p,googleMapsApiKey:v,googleMapsClientId:w,language:A,region:o,libraries:D,preventGoogleFontsLoading:j,channel:J,mapIds:ie,authReferrerPolicy:re,apiUrl:he="https://maps.googleapis.com"}=n,ce=Z.useRef(!1),[xe,Ee]=Z.useState(!1),[ve,K]=Z.useState(void 0);Z.useEffect(function(){return ce.current=!0,()=>{ce.current=!1}},[]),Z.useEffect(function(){gu&&j&&y2()},[j]),Z.useEffect(function(){xe&&Qn(!!window.google,"useLoadScript was marked as loaded, but window.google is not present. Something went wrong.")},[xe]);var fe=SD({version:c,googleMapsApiKey:v,googleMapsClientId:w,language:A,region:o,libraries:D,channel:J,mapIds:ie,authReferrerPolicy:re,apiUrl:he});Z.useEffect(function(){if(!gu)return;function Le(){ce.current&&(Ee(!0),lL=fe)}if(window.google&&window.google.maps&&lL===fe){Le();return}TD({id:r,url:fe,nonce:p}).then(Le).catch(function(ct){ce.current&&K(ct),console.warn(`
        There has been an Error with loading Google Maps API script, please check that you provided correct google API key (`.concat(v||"-",") or Client ID (").concat(w||"-",`)
        Otherwise it is a Network issue.
      `)),console.error(ct)})},[r,fe,p]);var ke=Z.useRef(void 0);return Z.useEffect(function(){ke.current&&D!==ke.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),ke.current=D},[D]),{isLoaded:xe,loadError:ve,url:fe}}var RN=["loadingElement","onLoad","onError","onUnmount","children"],DN=N.jsx(ED,{});function ON(n){var{loadingElement:r,onLoad:c,onError:p,onUnmount:v,children:w}=n,A=v2(n,RN),{isLoaded:o,loadError:D}=MN(A);return Z.useEffect(function(){o&&typeof c=="function"&&c()},[o,c]),Z.useEffect(function(){D&&typeof p=="function"&&p(D)},[D,p]),Z.useEffect(function(){return()=>{v&&v()}},[v]),o?w:r||DN}Z.memo(ON);function zN(n,r,c,p){function v(w){return w instanceof c?w:new c(function(A){A(w)})}return new(c||(c=Promise))(function(w,A){function o(J){try{j(p.next(J))}catch(ie){A(ie)}}function D(J){try{j(p.throw(J))}catch(ie){A(ie)}}function j(J){J.done?w(J.value):v(J.value).then(o,D)}j((p=p.apply(n,[])).next())})}function BN(n){return n&&n.__esModule&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n}var FN=function n(r,c){if(r===c)return!0;if(r&&c&&typeof r=="object"&&typeof c=="object"){if(r.constructor!==c.constructor)return!1;var p,v,w;if(Array.isArray(r)){if(p=r.length,p!=c.length)return!1;for(v=p;v--!==0;)if(!n(r[v],c[v]))return!1;return!0}if(r.constructor===RegExp)return r.source===c.source&&r.flags===c.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===c.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===c.toString();if(w=Object.keys(r),p=w.length,p!==Object.keys(c).length)return!1;for(v=p;v--!==0;)if(!Object.prototype.hasOwnProperty.call(c,w[v]))return!1;for(v=p;v--!==0;){var A=w[v];if(!n(r[A],c[A]))return!1}return!0}return r!==r&&c!==c},jN=BN(FN),cL="__googleMapsScriptId",Xf;(function(n){n[n.INITIALIZED=0]="INITIALIZED",n[n.LOADING=1]="LOADING",n[n.SUCCESS=2]="SUCCESS",n[n.FAILURE=3]="FAILURE"})(Xf||(Xf={}));class Fh{constructor(r){var{apiKey:c,authReferrerPolicy:p,channel:v,client:w,id:A=cL,language:o,libraries:D=[],mapIds:j,nonce:J,region:ie,retries:re=3,url:he="https://maps.googleapis.com/maps/api/js",version:ce}=r;if(this.callbacks=[],this.done=!1,this.loading=!1,this.errors=[],this.apiKey=c,this.authReferrerPolicy=p,this.channel=v,this.client=w,this.id=A||cL,this.language=o,this.libraries=D,this.mapIds=j,this.nonce=J,this.region=ie,this.retries=re,this.url=he,this.version=ce,Fh.instance){if(!jN(this.options,Fh.instance.options))throw new Error("Loader must not be called again with different options. ".concat(JSON.stringify(this.options)," !== ").concat(JSON.stringify(Fh.instance.options)));return Fh.instance}Fh.instance=this}get options(){return{version:this.version,apiKey:this.apiKey,channel:this.channel,client:this.client,id:this.id,libraries:this.libraries,language:this.language,region:this.region,mapIds:this.mapIds,nonce:this.nonce,url:this.url,authReferrerPolicy:this.authReferrerPolicy}}get status(){return this.errors.length?Xf.FAILURE:this.done?Xf.SUCCESS:this.loading?Xf.LOADING:Xf.INITIALIZED}get failed(){return this.done&&!this.loading&&this.errors.length>=this.retries+1}createUrl(){var r=this.url;return r+="?callback=__googleMapsCallback&loading=async",this.apiKey&&(r+="&key=".concat(this.apiKey)),this.channel&&(r+="&channel=".concat(this.channel)),this.client&&(r+="&client=".concat(this.client)),this.libraries.length>0&&(r+="&libraries=".concat(this.libraries.join(","))),this.language&&(r+="&language=".concat(this.language)),this.region&&(r+="&region=".concat(this.region)),this.version&&(r+="&v=".concat(this.version)),this.mapIds&&(r+="&map_ids=".concat(this.mapIds.join(","))),this.authReferrerPolicy&&(r+="&auth_referrer_policy=".concat(this.authReferrerPolicy)),r}deleteScript(){var r=document.getElementById(this.id);r&&r.remove()}load(){return this.loadPromise()}loadPromise(){return new Promise((r,c)=>{this.loadCallback(p=>{p?c(p.error):r(window.google)})})}importLibrary(r){return this.execute(),google.maps.importLibrary(r)}loadCallback(r){this.callbacks.push(r),this.execute()}setScript(){var r,c;if(document.getElementById(this.id)){this.callback();return}var p={key:this.apiKey,channel:this.channel,client:this.client,libraries:this.libraries.length&&this.libraries,v:this.version,mapIds:this.mapIds,language:this.language,region:this.region,authReferrerPolicy:this.authReferrerPolicy};Object.keys(p).forEach(w=>!p[w]&&delete p[w]),!((c=(r=window==null?void 0:window.google)===null||r===void 0?void 0:r.maps)===null||c===void 0)&&c.importLibrary||(w=>{var A,o,D,j="The Google Maps JavaScript API",J="google",ie="importLibrary",re="__ib__",he=document,ce=window;ce=ce[J]||(ce[J]={});var xe=ce.maps||(ce.maps={}),Ee=new Set,ve=new URLSearchParams,K=()=>A||(A=new Promise((fe,ke)=>zN(this,void 0,void 0,function*(){var Be;yield o=he.createElement("script"),o.id=this.id,ve.set("libraries",[...Ee]+"");for(D in w)ve.set(D.replace(/[A-Z]/g,Le=>"_"+Le[0].toLowerCase()),w[D]);ve.set("callback",J+".maps."+re),o.src=this.url+"?"+ve,xe[re]=fe,o.onerror=()=>A=ke(Error(j+" could not load.")),o.nonce=this.nonce||((Be=he.querySelector("script[nonce]"))===null||Be===void 0?void 0:Be.nonce)||"",he.head.append(o)})));xe[ie]?console.warn(j+" only loads once. Ignoring:",w):xe[ie]=function(fe){for(var ke=arguments.length,Be=new Array(ke>1?ke-1:0),Le=1;Le<ke;Le++)Be[Le-1]=arguments[Le];return Ee.add(fe)&&K().then(()=>xe[ie](fe,...Be))}})(p);var v=this.libraries.map(w=>this.importLibrary(w));v.length||v.push(this.importLibrary("core")),Promise.all(v).then(()=>this.callback(),w=>{var A=new ErrorEvent("error",{error:w});this.loadErrorCallback(A)})}reset(){this.deleteScript(),this.done=!1,this.loading=!1,this.errors=[],this.onerrorEvent=null}resetIfRetryingFailed(){this.failed&&this.reset()}loadErrorCallback(r){if(this.errors.push(r),this.errors.length<=this.retries){var c=this.errors.length*Math.pow(2,this.errors.length);console.error("Failed to load Google Maps script, retrying in ".concat(c," ms.")),setTimeout(()=>{this.deleteScript(),this.setScript()},c)}else this.onerrorEvent=r,this.callback()}callback(){this.done=!0,this.loading=!1,this.callbacks.forEach(r=>{r(this.onerrorEvent)}),this.callbacks=[]}execute(){if(this.resetIfRetryingFailed(),!this.loading)if(this.done)this.callback();else{if(window.google&&window.google.maps&&window.google.maps.version){console.warn("Google Maps already loaded outside @googlemaps/js-api-loader. This may result in undesirable behavior as options and script parameters may not match."),this.callback();return}this.loading=!0,this.setScript()}}}var NN=["maps"];function UN(n){var{id:r=k_.id,version:c=k_.version,nonce:p,googleMapsApiKey:v,language:w,region:A,libraries:o=NN,preventGoogleFontsLoading:D,mapIds:j,authReferrerPolicy:J}=n,ie=Z.useRef(!1),[re,he]=Z.useState(!1),[ce,xe]=Z.useState(void 0);Z.useEffect(function(){return ie.current=!0,()=>{ie.current=!1}},[]);var Ee=Z.useMemo(()=>new Fh({id:r,apiKey:v,version:c,libraries:o,language:w||"en",region:A||"US",mapIds:j||[],nonce:p||"",authReferrerPolicy:J||"origin"}),[r,v,c,o,w,A,j,p,J]);Z.useEffect(function(){re||Ee.load().then(()=>{ie.current&&he(!0)}).catch(fe=>{xe(fe)})},[]),Z.useEffect(()=>{gu&&D&&y2()},[D]);var ve=Z.useRef();return Z.useEffect(()=>{ve.current&&o!==ve.current&&console.warn("Performance warning! LoadScript has been reloaded unintentionally! You should not pass `libraries` prop as new array. Please keep an array of libraries as static class property for Components and PureComponents, or just a const variable outside of component, or somewhere in config files or ENV variables"),ve.current=o},[o]),{isLoaded:re,loadError:ce}}function uL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Sx(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?uL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):uL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var hL={},dL={options(n,r){n.setOptions(r)}};function VN(n){var{options:r,onLoad:c,onUnmount:p}=n,v=Z.useContext(rr),[w,A]=Z.useState(null);return Z.useEffect(()=>{w!==null&&w.setMap(v)},[v]),Z.useEffect(()=>{r&&w!==null&&w.setOptions(r)},[w,r]),Z.useEffect(()=>{var o=new google.maps.TrafficLayer(Sx(Sx({},r),{},{map:v}));return A(o),c&&c(o),()=>{w!==null&&(p&&p(w),w.setMap(null))}},[]),null}Z.memo(VN);class $N extends Z.PureComponent{constructor(){super(...arguments),It(this,"state",{trafficLayer:null}),It(this,"setTrafficLayerCallback",()=>{this.state.trafficLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.trafficLayer)}),It(this,"registeredEvents",[])}componentDidMount(){var r=new google.maps.TrafficLayer(Sx(Sx({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:dL,eventMap:hL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{trafficLayer:r}},this.setTrafficLayerCallback)}componentDidUpdate(r){this.state.trafficLayer!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:dL,eventMap:hL,prevProps:r,nextProps:this.props,instance:this.state.trafficLayer}))}componentWillUnmount(){this.state.trafficLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.trafficLayer),_r(this.registeredEvents),this.state.trafficLayer.setMap(null))}render(){return null}}It($N,"contextType",rr);function GN(n){var{onLoad:r,onUnmount:c}=n,p=Z.useContext(rr),[v,w]=Z.useState(null);return Z.useEffect(()=>{v!==null&&v.setMap(p)},[p]),Z.useEffect(()=>{var A=new google.maps.BicyclingLayer;return w(A),A.setMap(p),r&&r(A),()=>{A!==null&&(c&&c(A),A.setMap(null))}},[]),null}Z.memo(GN);class HN extends Z.PureComponent{constructor(){super(...arguments),It(this,"state",{bicyclingLayer:null}),It(this,"setBicyclingLayerCallback",()=>{this.state.bicyclingLayer!==null&&(this.state.bicyclingLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.bicyclingLayer))})}componentDidMount(){var r=new google.maps.BicyclingLayer;this.setState(()=>({bicyclingLayer:r}),this.setBicyclingLayerCallback)}componentWillUnmount(){this.state.bicyclingLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.bicyclingLayer),this.state.bicyclingLayer.setMap(null))}render(){return null}}It(HN,"contextType",rr);function WN(n){var{onLoad:r,onUnmount:c}=n,p=Z.useContext(rr),[v,w]=Z.useState(null);return Z.useEffect(()=>{v!==null&&v.setMap(p)},[p]),Z.useEffect(()=>{var A=new google.maps.TransitLayer;return w(A),A.setMap(p),r&&r(A),()=>{v!==null&&(c&&c(v),v.setMap(null))}},[]),null}Z.memo(WN);class qN extends Z.PureComponent{constructor(){super(...arguments),It(this,"state",{transitLayer:null}),It(this,"setTransitLayerCallback",()=>{this.state.transitLayer!==null&&(this.state.transitLayer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.transitLayer))})}componentDidMount(){var r=new google.maps.TransitLayer;this.setState(function(){return{transitLayer:r}},this.setTransitLayerCallback)}componentWillUnmount(){this.state.transitLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.transitLayer),this.state.transitLayer.setMap(null))}render(){return null}}It(qN,"contextType",rr);function fL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Tx(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?fL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):fL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var pL={onCircleComplete:"circlecomplete",onMarkerComplete:"markercomplete",onOverlayComplete:"overlaycomplete",onPolygonComplete:"polygoncomplete",onPolylineComplete:"polylinecomplete",onRectangleComplete:"rectanglecomplete"},mL={drawingMode(n,r){n.setDrawingMode(r)},options(n,r){n.setOptions(r)}};function ZN(n){var{options:r,drawingMode:c,onCircleComplete:p,onMarkerComplete:v,onOverlayComplete:w,onPolygonComplete:A,onPolylineComplete:o,onRectangleComplete:D,onLoad:j,onUnmount:J}=n,ie=Z.useContext(rr),[re,he]=Z.useState(null),[ce,xe]=Z.useState(null),[Ee,ve]=Z.useState(null),[K,fe]=Z.useState(null),[ke,Be]=Z.useState(null),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null);return Z.useEffect(()=>{re!==null&&re.setMap(ie)},[ie]),Z.useEffect(()=>{r&&re!==null&&re.setOptions(r)},[re,r]),Z.useEffect(()=>{re!==null&&re.setDrawingMode(c??null)},[re,c]),Z.useEffect(()=>{re&&p&&(ce!==null&&google.maps.event.removeListener(ce),xe(google.maps.event.addListener(re,"circlecomplete",p)))},[re,p]),Z.useEffect(()=>{re&&v&&(Ee!==null&&google.maps.event.removeListener(Ee),ve(google.maps.event.addListener(re,"markercomplete",v)))},[re,v]),Z.useEffect(()=>{re&&w&&(K!==null&&google.maps.event.removeListener(K),fe(google.maps.event.addListener(re,"overlaycomplete",w)))},[re,w]),Z.useEffect(()=>{re&&A&&(ke!==null&&google.maps.event.removeListener(ke),Be(google.maps.event.addListener(re,"polygoncomplete",A)))},[re,A]),Z.useEffect(()=>{re&&o&&(Le!==null&&google.maps.event.removeListener(Le),We(google.maps.event.addListener(re,"polylinecomplete",o)))},[re,o]),Z.useEffect(()=>{re&&D&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(re,"rectanglecomplete",D)))},[re,D]),Z.useEffect(()=>{Qn(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing);var Pt=new google.maps.drawing.DrawingManager(Tx(Tx({},r),{},{map:ie}));return c&&Pt.setDrawingMode(c),p&&xe(google.maps.event.addListener(Pt,"circlecomplete",p)),v&&ve(google.maps.event.addListener(Pt,"markercomplete",v)),w&&fe(google.maps.event.addListener(Pt,"overlaycomplete",w)),A&&Be(google.maps.event.addListener(Pt,"polygoncomplete",A)),o&&We(google.maps.event.addListener(Pt,"polylinecomplete",o)),D&&lt(google.maps.event.addListener(Pt,"rectanglecomplete",D)),he(Pt),j&&j(Pt),()=>{re!==null&&(ce&&google.maps.event.removeListener(ce),Ee&&google.maps.event.removeListener(Ee),K&&google.maps.event.removeListener(K),ke&&google.maps.event.removeListener(ke),Le&&google.maps.event.removeListener(Le),ct&&google.maps.event.removeListener(ct),J&&J(re),re.setMap(null))}},[]),null}Z.memo(ZN);class XN extends Z.PureComponent{constructor(r){super(r),It(this,"registeredEvents",[]),It(this,"state",{drawingManager:null}),It(this,"setDrawingManagerCallback",()=>{this.state.drawingManager!==null&&this.props.onLoad&&this.props.onLoad(this.state.drawingManager)}),Qn(!!google.maps.drawing,"Did you include prop libraries={['drawing']} in the URL? %s",google.maps.drawing)}componentDidMount(){var r=new google.maps.drawing.DrawingManager(Tx(Tx({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:mL,eventMap:pL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{drawingManager:r}},this.setDrawingManagerCallback)}componentDidUpdate(r){this.state.drawingManager!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:mL,eventMap:pL,prevProps:r,nextProps:this.props,instance:this.state.drawingManager}))}componentWillUnmount(){this.state.drawingManager!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.drawingManager),_r(this.registeredEvents),this.state.drawingManager.setMap(null))}render(){return null}}It(XN,"contextType",rr);function gL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function rp(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?gL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):gL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var _L={onAnimationChanged:"animation_changed",onClick:"click",onClickableChanged:"clickable_changed",onCursorChanged:"cursor_changed",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDraggableChanged:"draggable_changed",onDragStart:"dragstart",onFlatChanged:"flat_changed",onIconChanged:"icon_changed",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onPositionChanged:"position_changed",onRightClick:"rightclick",onShapeChanged:"shape_changed",onTitleChanged:"title_changed",onVisibleChanged:"visible_changed",onZindexChanged:"zindex_changed"},yL={animation(n,r){n.setAnimation(r)},clickable(n,r){n.setClickable(r)},cursor(n,r){n.setCursor(r)},draggable(n,r){n.setDraggable(r)},icon(n,r){n.setIcon(r)},label(n,r){n.setLabel(r)},map(n,r){n.setMap(r)},opacity(n,r){n.setOpacity(r)},options(n,r){n.setOptions(r)},position(n,r){n.setPosition(r)},shape(n,r){n.setShape(r)},title(n,r){n.setTitle(r)},visible(n,r){n.setVisible(r)},zIndex(n,r){n.setZIndex(r)}},Ex={};function KN(n){var{position:r,options:c,clusterer:p,noClustererRedraw:v,children:w,draggable:A,visible:o,animation:D,clickable:j,cursor:J,icon:ie,label:re,opacity:he,shape:ce,title:xe,zIndex:Ee,onClick:ve,onDblClick:K,onDrag:fe,onDragEnd:ke,onDragStart:Be,onMouseOut:Le,onMouseOver:We,onMouseUp:ct,onMouseDown:lt,onRightClick:Pt,onClickableChanged:zt,onCursorChanged:_i,onAnimationChanged:Ut,onDraggableChanged:bi,onFlatChanged:vi,onIconChanged:ei,onPositionChanged:si,onShapeChanged:Tt,onTitleChanged:Ht,onVisibleChanged:Gt,onZindexChanged:hi,onLoad:Ft,onUnmount:Ot}=n,di=Z.useContext(rr),[wt,sr]=Z.useState(null),[pr,Fi]=Z.useState(null),[Si,Qt]=Z.useState(null),[Di,Pn]=Z.useState(null),[or,Ls]=Z.useState(null),[ar,Qo]=Z.useState(null),[es,Dr]=Z.useState(null),[ko,Lo]=Z.useState(null),[Po,ea]=Z.useState(null),[ta,$n]=Z.useState(null),[zn,po]=Z.useState(null),[Ps,Mo]=Z.useState(null),[mo,Mn]=Z.useState(null),[Ro,ts]=Z.useState(null),[ia,go]=Z.useState(null),[Yr,_o]=Z.useState(null),[Ms,Do]=Z.useState(null),[Rs,Oo]=Z.useState(null),[zo,Ea]=Z.useState(null),[ir,ln]=Z.useState(null),[Ia,Aa]=Z.useState(null),[Bn,gc]=Z.useState(null);Z.useEffect(()=>{wt!==null&&wt.setMap(di)},[di]),Z.useEffect(()=>{typeof c<"u"&&wt!==null&&wt.setOptions(c)},[wt,c]),Z.useEffect(()=>{typeof A<"u"&&wt!==null&&wt.setDraggable(A)},[wt,A]),Z.useEffect(()=>{r&&wt!==null&&wt.setPosition(r)},[wt,r]),Z.useEffect(()=>{typeof o<"u"&&wt!==null&&wt.setVisible(o)},[wt,o]),Z.useEffect(()=>{wt==null||wt.setAnimation(D)},[wt,D]),Z.useEffect(()=>{wt&&j!==void 0&&wt.setClickable(j)},[wt,j]),Z.useEffect(()=>{wt&&J!==void 0&&wt.setCursor(J)},[wt,J]),Z.useEffect(()=>{wt&&ie!==void 0&&wt.setIcon(ie)},[wt,ie]),Z.useEffect(()=>{wt&&re!==void 0&&wt.setLabel(re)},[wt,re]),Z.useEffect(()=>{wt&&he!==void 0&&wt.setOpacity(he)},[wt,he]),Z.useEffect(()=>{wt&&ce!==void 0&&wt.setShape(ce)},[wt,ce]),Z.useEffect(()=>{wt&&xe!==void 0&&wt.setTitle(xe)},[wt,xe]),Z.useEffect(()=>{wt&&Ee!==void 0&&wt.setZIndex(Ee)},[wt,Ee]),Z.useEffect(()=>{wt&&K&&(pr!==null&&google.maps.event.removeListener(pr),Fi(google.maps.event.addListener(wt,"dblclick",K)))},[K]),Z.useEffect(()=>{wt&&ke&&(Si!==null&&google.maps.event.removeListener(Si),Qt(google.maps.event.addListener(wt,"dragend",ke)))},[ke]),Z.useEffect(()=>{wt&&Be&&(Di!==null&&google.maps.event.removeListener(Di),Pn(google.maps.event.addListener(wt,"dragstart",Be)))},[Be]),Z.useEffect(()=>{wt&&lt&&(or!==null&&google.maps.event.removeListener(or),Ls(google.maps.event.addListener(wt,"mousedown",lt)))},[lt]),Z.useEffect(()=>{wt&&Le&&(ar!==null&&google.maps.event.removeListener(ar),Qo(google.maps.event.addListener(wt,"mouseout",Le)))},[Le]),Z.useEffect(()=>{wt&&We&&(es!==null&&google.maps.event.removeListener(es),Dr(google.maps.event.addListener(wt,"mouseover",We)))},[We]),Z.useEffect(()=>{wt&&ct&&(ko!==null&&google.maps.event.removeListener(ko),Lo(google.maps.event.addListener(wt,"mouseup",ct)))},[ct]),Z.useEffect(()=>{wt&&Pt&&(Po!==null&&google.maps.event.removeListener(Po),ea(google.maps.event.addListener(wt,"rightclick",Pt)))},[Pt]),Z.useEffect(()=>{wt&&ve&&(ta!==null&&google.maps.event.removeListener(ta),$n(google.maps.event.addListener(wt,"click",ve)))},[ve]),Z.useEffect(()=>{wt&&fe&&(zn!==null&&google.maps.event.removeListener(zn),po(google.maps.event.addListener(wt,"drag",fe)))},[fe]),Z.useEffect(()=>{wt&&zt&&(Ps!==null&&google.maps.event.removeListener(Ps),Mo(google.maps.event.addListener(wt,"clickable_changed",zt)))},[zt]),Z.useEffect(()=>{wt&&_i&&(mo!==null&&google.maps.event.removeListener(mo),Mn(google.maps.event.addListener(wt,"cursor_changed",_i)))},[_i]),Z.useEffect(()=>{wt&&Ut&&(Ro!==null&&google.maps.event.removeListener(Ro),ts(google.maps.event.addListener(wt,"animation_changed",Ut)))},[Ut]),Z.useEffect(()=>{wt&&bi&&(ia!==null&&google.maps.event.removeListener(ia),go(google.maps.event.addListener(wt,"draggable_changed",bi)))},[bi]),Z.useEffect(()=>{wt&&vi&&(Yr!==null&&google.maps.event.removeListener(Yr),_o(google.maps.event.addListener(wt,"flat_changed",vi)))},[vi]),Z.useEffect(()=>{wt&&ei&&(Ms!==null&&google.maps.event.removeListener(Ms),Do(google.maps.event.addListener(wt,"icon_changed",ei)))},[ei]),Z.useEffect(()=>{wt&&si&&(Rs!==null&&google.maps.event.removeListener(Rs),Oo(google.maps.event.addListener(wt,"position_changed",si)))},[si]),Z.useEffect(()=>{wt&&Tt&&(zo!==null&&google.maps.event.removeListener(zo),Ea(google.maps.event.addListener(wt,"shape_changed",Tt)))},[Tt]),Z.useEffect(()=>{wt&&Ht&&(ir!==null&&google.maps.event.removeListener(ir),ln(google.maps.event.addListener(wt,"title_changed",Ht)))},[Ht]),Z.useEffect(()=>{wt&&Gt&&(Ia!==null&&google.maps.event.removeListener(Ia),Aa(google.maps.event.addListener(wt,"visible_changed",Gt)))},[Gt]),Z.useEffect(()=>{wt&&hi&&(Bn!==null&&google.maps.event.removeListener(Bn),gc(google.maps.event.addListener(wt,"zindex_changed",hi)))},[hi]),Z.useEffect(()=>{var at=rp(rp(rp({},c||Ex),p?Ex:{map:di}),{},{position:r}),Li=new google.maps.Marker(at);return p?p.addMarker(Li,!!v):Li.setMap(di),r&&Li.setPosition(r),typeof o<"u"&&Li.setVisible(o),typeof A<"u"&&Li.setDraggable(A),typeof j<"u"&&Li.setClickable(j),typeof J=="string"&&Li.setCursor(J),ie&&Li.setIcon(ie),typeof re<"u"&&Li.setLabel(re),typeof he<"u"&&Li.setOpacity(he),ce&&Li.setShape(ce),typeof xe=="string"&&Li.setTitle(xe),typeof Ee=="number"&&Li.setZIndex(Ee),K&&Fi(google.maps.event.addListener(Li,"dblclick",K)),ke&&Qt(google.maps.event.addListener(Li,"dragend",ke)),Be&&Pn(google.maps.event.addListener(Li,"dragstart",Be)),lt&&Ls(google.maps.event.addListener(Li,"mousedown",lt)),Le&&Qo(google.maps.event.addListener(Li,"mouseout",Le)),We&&Dr(google.maps.event.addListener(Li,"mouseover",We)),ct&&Lo(google.maps.event.addListener(Li,"mouseup",ct)),Pt&&ea(google.maps.event.addListener(Li,"rightclick",Pt)),ve&&$n(google.maps.event.addListener(Li,"click",ve)),fe&&po(google.maps.event.addListener(Li,"drag",fe)),zt&&Mo(google.maps.event.addListener(Li,"clickable_changed",zt)),_i&&Mn(google.maps.event.addListener(Li,"cursor_changed",_i)),Ut&&ts(google.maps.event.addListener(Li,"animation_changed",Ut)),bi&&go(google.maps.event.addListener(Li,"draggable_changed",bi)),vi&&_o(google.maps.event.addListener(Li,"flat_changed",vi)),ei&&Do(google.maps.event.addListener(Li,"icon_changed",ei)),si&&Oo(google.maps.event.addListener(Li,"position_changed",si)),Tt&&Ea(google.maps.event.addListener(Li,"shape_changed",Tt)),Ht&&ln(google.maps.event.addListener(Li,"title_changed",Ht)),Gt&&Aa(google.maps.event.addListener(Li,"visible_changed",Gt)),hi&&gc(google.maps.event.addListener(Li,"zindex_changed",hi)),sr(Li),Ft&&Ft(Li),()=>{pr!==null&&google.maps.event.removeListener(pr),Si!==null&&google.maps.event.removeListener(Si),Di!==null&&google.maps.event.removeListener(Di),or!==null&&google.maps.event.removeListener(or),ar!==null&&google.maps.event.removeListener(ar),es!==null&&google.maps.event.removeListener(es),ko!==null&&google.maps.event.removeListener(ko),Po!==null&&google.maps.event.removeListener(Po),ta!==null&&google.maps.event.removeListener(ta),Ps!==null&&google.maps.event.removeListener(Ps),mo!==null&&google.maps.event.removeListener(mo),Ro!==null&&google.maps.event.removeListener(Ro),ia!==null&&google.maps.event.removeListener(ia),Yr!==null&&google.maps.event.removeListener(Yr),Ms!==null&&google.maps.event.removeListener(Ms),Rs!==null&&google.maps.event.removeListener(Rs),ir!==null&&google.maps.event.removeListener(ir),Ia!==null&&google.maps.event.removeListener(Ia),Bn!==null&&google.maps.event.removeListener(Bn),Ot&&Ot(Li),p?p.removeMarker(Li,!!v):Li&&Li.setMap(null)}},[]);var Qa=Z.useMemo(()=>w?Z.Children.map(w,at=>{if(!Z.isValidElement(at))return at;var Li=at;return Z.cloneElement(Li,{anchor:wt})}):null,[w,wt]);return N.jsx(N.Fragment,{children:Qa})||null}Z.memo(KN);class nT extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[])}componentDidMount(){var r=this;return wD(function*(){var c=rp(rp(rp({},r.props.options||Ex),r.props.clusterer?Ex:{map:r.context}),{},{position:r.props.position});r.marker=new google.maps.Marker(c),r.props.clusterer?r.props.clusterer.addMarker(r.marker,!!r.props.noClustererRedraw):r.marker.setMap(r.context),r.registeredEvents=fr({updaterMap:yL,eventMap:_L,prevProps:{},nextProps:r.props,instance:r.marker}),r.props.onLoad&&r.props.onLoad(r.marker)})()}componentDidUpdate(r){this.marker&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:yL,eventMap:_L,prevProps:r,nextProps:this.props,instance:this.marker}))}componentWillUnmount(){this.marker&&(this.props.onUnmount&&this.props.onUnmount(this.marker),_r(this.registeredEvents),this.props.clusterer?this.props.clusterer.removeMarker(this.marker,!!this.props.noClustererRedraw):this.marker&&this.marker.setMap(null))}render(){var r=this.props.children?Z.Children.map(this.props.children,c=>{if(!Z.isValidElement(c))return c;var p=c;return Z.cloneElement(p,{anchor:this.marker})}):null;return r||null}}It(nT,"contextType",rr);var YN=function(){function n(r,c){r.getClusterer().extend(n,google.maps.OverlayView),this.cluster=r,this.clusterClassName=this.cluster.getClusterer().getClusterClass(),this.className=this.clusterClassName,this.styles=c,this.center=void 0,this.div=null,this.sums=null,this.visible=!1,this.boundsChangedListener=null,this.url="",this.height=0,this.width=0,this.anchorText=[0,0],this.anchorIcon=[0,0],this.textColor="black",this.textSize=11,this.textDecoration="none",this.fontWeight="bold",this.fontStyle="normal",this.fontFamily="Arial,sans-serif",this.backgroundPosition="0 0",this.cMouseDownInCluster=null,this.cDraggingMapByCluster=null,this.timeOut=null,this.setMap(r.getMap()),this.onBoundsChanged=this.onBoundsChanged.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onClick=this.onClick.bind(this),this.onMouseOver=this.onMouseOver.bind(this),this.onMouseOut=this.onMouseOut.bind(this),this.onAdd=this.onAdd.bind(this),this.onRemove=this.onRemove.bind(this),this.draw=this.draw.bind(this),this.hide=this.hide.bind(this),this.show=this.show.bind(this),this.useStyle=this.useStyle.bind(this),this.setCenter=this.setCenter.bind(this),this.getPosFromLatLng=this.getPosFromLatLng.bind(this)}return n.prototype.onBoundsChanged=function(){this.cDraggingMapByCluster=this.cMouseDownInCluster},n.prototype.onMouseDown=function(){this.cMouseDownInCluster=!0,this.cDraggingMapByCluster=!1},n.prototype.onClick=function(r){if(this.cMouseDownInCluster=!1,!this.cDraggingMapByCluster){var c=this.cluster.getClusterer();if(google.maps.event.trigger(c,"click",this.cluster),google.maps.event.trigger(c,"clusterclick",this.cluster),c.getZoomOnClick()){var p=c.getMaxZoom(),v=this.cluster.getBounds(),w=c.getMap();w!==null&&"fitBounds"in w&&w.fitBounds(v),this.timeOut=window.setTimeout(function(){var A=c.getMap();if(A!==null){"fitBounds"in A&&A.fitBounds(v);var o=A.getZoom()||0;p!==null&&o>p&&A.setZoom(p+1)}},100)}r.cancelBubble=!0,r.stopPropagation&&r.stopPropagation()}},n.prototype.onMouseOver=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseover",this.cluster)},n.prototype.onMouseOut=function(){google.maps.event.trigger(this.cluster.getClusterer(),"mouseout",this.cluster)},n.prototype.onAdd=function(){var r;this.div=document.createElement("div"),this.div.className=this.className,this.visible&&this.show(),(r=this.getPanes())===null||r===void 0||r.overlayMouseTarget.appendChild(this.div);var c=this.getMap();c!==null&&(this.boundsChangedListener=google.maps.event.addListener(c,"bounds_changed",this.onBoundsChanged),this.div.addEventListener("mousedown",this.onMouseDown),this.div.addEventListener("click",this.onClick),this.div.addEventListener("mouseover",this.onMouseOver),this.div.addEventListener("mouseout",this.onMouseOut))},n.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.hide(),this.boundsChangedListener!==null&&google.maps.event.removeListener(this.boundsChangedListener),this.div.removeEventListener("mousedown",this.onMouseDown),this.div.removeEventListener("click",this.onClick),this.div.removeEventListener("mouseover",this.onMouseOver),this.div.removeEventListener("mouseout",this.onMouseOut),this.div.parentNode.removeChild(this.div),this.timeOut!==null&&(window.clearTimeout(this.timeOut),this.timeOut=null),this.div=null)},n.prototype.draw=function(){if(this.visible&&this.div!==null&&this.center){var r=this.getPosFromLatLng(this.center);this.div.style.top=r!==null?"".concat(r.y,"px"):"0",this.div.style.left=r!==null?"".concat(r.x,"px"):"0"}},n.prototype.hide=function(){this.div&&(this.div.style.display="none"),this.visible=!1},n.prototype.show=function(){var r,c,p,v,w,A;if(this.div&&this.center){var o=this.sums===null||typeof this.sums.title>"u"||this.sums.title===""?this.cluster.getClusterer().getTitle():this.sums.title,D=this.backgroundPosition.split(" "),j=parseInt(((r=D[0])===null||r===void 0?void 0:r.replace(/^\s+|\s+$/g,""))||"0",10),J=parseInt(((c=D[1])===null||c===void 0?void 0:c.replace(/^\s+|\s+$/g,""))||"0",10),ie=this.getPosFromLatLng(this.center);this.div.className=this.className,this.div.setAttribute("style","cursor: pointer; position: absolute; top: ".concat(ie!==null?"".concat(ie.y,"px"):"0","; left: ").concat(ie!==null?"".concat(ie.x,"px"):"0","; width: ").concat(this.width,"px; height: ").concat(this.height,"px; "));var re=document.createElement("img");re.alt=o,re.src=this.url,re.width=this.width,re.height=this.height,re.setAttribute("style","position: absolute; top: ".concat(J,"px; left: ").concat(j,"px")),this.cluster.getClusterer().enableRetinaIcons||(re.style.clip="rect(-".concat(J,"px, -").concat(j+this.width,"px, -").concat(J+this.height,", -").concat(j,")"));var he=document.createElement("div");he.setAttribute("style","position: absolute; top: ".concat(this.anchorText[0],"px; left: ").concat(this.anchorText[1],"px; color: ").concat(this.textColor,"; font-size: ").concat(this.textSize,"px; font-family: ").concat(this.fontFamily,"; font-weight: ").concat(this.fontWeight,"; fontStyle: ").concat(this.fontStyle,"; text-decoration: ").concat(this.textDecoration,"; text-align: center; width: ").concat(this.width,"px; line-height: ").concat(this.height,"px")),!((p=this.sums)===null||p===void 0)&&p.text&&(he.innerText="".concat((v=this.sums)===null||v===void 0?void 0:v.text)),!((w=this.sums)===null||w===void 0)&&w.html&&(he.innerHTML="".concat((A=this.sums)===null||A===void 0?void 0:A.html)),this.div.innerHTML="",this.div.appendChild(re),this.div.appendChild(he),this.div.title=o,this.div.style.display=""}this.visible=!0},n.prototype.useStyle=function(r){this.sums=r;var c=this.cluster.getClusterer().getStyles(),p=c[Math.min(c.length-1,Math.max(0,r.index-1))];p&&(this.url=p.url,this.height=p.height,this.width=p.width,p.className&&(this.className="".concat(this.clusterClassName," ").concat(p.className)),this.anchorText=p.anchorText||[0,0],this.anchorIcon=p.anchorIcon||[this.height/2,this.width/2],this.textColor=p.textColor||"black",this.textSize=p.textSize||11,this.textDecoration=p.textDecoration||"none",this.fontWeight=p.fontWeight||"bold",this.fontStyle=p.fontStyle||"normal",this.fontFamily=p.fontFamily||"Arial,sans-serif",this.backgroundPosition=p.backgroundPosition||"0 0")},n.prototype.setCenter=function(r){this.center=r},n.prototype.getPosFromLatLng=function(r){var c=this.getProjection().fromLatLngToDivPixel(r);return c!==null&&(c.x-=this.anchorIcon[1],c.y-=this.anchorIcon[0]),c},n}(),JN=function(){function n(r){this.markerClusterer=r,this.map=this.markerClusterer.getMap(),this.gridSize=this.markerClusterer.getGridSize(),this.minClusterSize=this.markerClusterer.getMinimumClusterSize(),this.averageCenter=this.markerClusterer.getAverageCenter(),this.markers=[],this.center=void 0,this.bounds=null,this.clusterIcon=new YN(this,this.markerClusterer.getStyles()),this.getSize=this.getSize.bind(this),this.getMarkers=this.getMarkers.bind(this),this.getCenter=this.getCenter.bind(this),this.getMap=this.getMap.bind(this),this.getClusterer=this.getClusterer.bind(this),this.getBounds=this.getBounds.bind(this),this.remove=this.remove.bind(this),this.addMarker=this.addMarker.bind(this),this.isMarkerInClusterBounds=this.isMarkerInClusterBounds.bind(this),this.calculateBounds=this.calculateBounds.bind(this),this.updateIcon=this.updateIcon.bind(this),this.isMarkerAlreadyAdded=this.isMarkerAlreadyAdded.bind(this)}return n.prototype.getSize=function(){return this.markers.length},n.prototype.getMarkers=function(){return this.markers},n.prototype.getCenter=function(){return this.center},n.prototype.getMap=function(){return this.map},n.prototype.getClusterer=function(){return this.markerClusterer},n.prototype.getBounds=function(){for(var r=new google.maps.LatLngBounds(this.center,this.center),c=this.getMarkers(),p=0,v=c;p<v.length;p++){var w=v[p],A=w.getPosition();A&&r.extend(A)}return r},n.prototype.remove=function(){this.clusterIcon.setMap(null),this.markers=[],delete this.markers},n.prototype.addMarker=function(r){var c;if(this.isMarkerAlreadyAdded(r))return!1;if(this.center){if(this.averageCenter){var p=r.getPosition();if(p){var v=this.markers.length+1;this.center=new google.maps.LatLng((this.center.lat()*(v-1)+p.lat())/v,(this.center.lng()*(v-1)+p.lng())/v),this.calculateBounds()}}}else{var p=r.getPosition();p&&(this.center=p,this.calculateBounds())}r.isAdded=!0,this.markers.push(r);var w=this.markers.length,A=this.markerClusterer.getMaxZoom(),o=(c=this.map)===null||c===void 0?void 0:c.getZoom();if(A!==null&&typeof o<"u"&&o>A)r.getMap()!==this.map&&r.setMap(this.map);else if(w<this.minClusterSize)r.getMap()!==this.map&&r.setMap(this.map);else if(w===this.minClusterSize)for(var D=0,j=this.markers;D<j.length;D++){var J=j[D];J.setMap(null)}else r.setMap(null);return!0},n.prototype.isMarkerInClusterBounds=function(r){if(this.bounds!==null){var c=r.getPosition();if(c)return this.bounds.contains(c)}return!1},n.prototype.calculateBounds=function(){this.bounds=this.markerClusterer.getExtendedBounds(new google.maps.LatLngBounds(this.center,this.center))},n.prototype.updateIcon=function(){var r,c=this.markers.length,p=this.markerClusterer.getMaxZoom(),v=(r=this.map)===null||r===void 0?void 0:r.getZoom();if(p!==null&&typeof v<"u"&&v>p){this.clusterIcon.hide();return}if(c<this.minClusterSize){this.clusterIcon.hide();return}this.center&&this.clusterIcon.setCenter(this.center),this.clusterIcon.useStyle(this.markerClusterer.getCalculator()(this.markers,this.markerClusterer.getStyles().length)),this.clusterIcon.show()},n.prototype.isMarkerAlreadyAdded=function(r){if(this.markers.includes)return this.markers.includes(r);for(var c=0;c<this.markers.length;c++)if(r===this.markers[c])return!0;return!1},n}();function QN(n,r){var c=n.length,p=c.toString().length,v=Math.min(p,r);return{text:c.toString(),index:v,title:""}}var eU=2e3,tU=500,iU="https://developers.google.com/maps/documentation/javascript/examples/markerclusterer/m",rU="png",nU=[53,56,66,78,90],sU="cluster",ID=function(){function n(r,c,p){c===void 0&&(c=[]),p===void 0&&(p={}),this.getMinimumClusterSize=this.getMinimumClusterSize.bind(this),this.setMinimumClusterSize=this.setMinimumClusterSize.bind(this),this.getEnableRetinaIcons=this.getEnableRetinaIcons.bind(this),this.setEnableRetinaIcons=this.setEnableRetinaIcons.bind(this),this.addToClosestCluster=this.addToClosestCluster.bind(this),this.getImageExtension=this.getImageExtension.bind(this),this.setImageExtension=this.setImageExtension.bind(this),this.getExtendedBounds=this.getExtendedBounds.bind(this),this.getAverageCenter=this.getAverageCenter.bind(this),this.setAverageCenter=this.setAverageCenter.bind(this),this.getTotalClusters=this.getTotalClusters.bind(this),this.fitMapToMarkers=this.fitMapToMarkers.bind(this),this.getIgnoreHidden=this.getIgnoreHidden.bind(this),this.setIgnoreHidden=this.setIgnoreHidden.bind(this),this.getClusterClass=this.getClusterClass.bind(this),this.setClusterClass=this.setClusterClass.bind(this),this.getTotalMarkers=this.getTotalMarkers.bind(this),this.getZoomOnClick=this.getZoomOnClick.bind(this),this.setZoomOnClick=this.setZoomOnClick.bind(this),this.getBatchSizeIE=this.getBatchSizeIE.bind(this),this.setBatchSizeIE=this.setBatchSizeIE.bind(this),this.createClusters=this.createClusters.bind(this),this.onZoomChanged=this.onZoomChanged.bind(this),this.getImageSizes=this.getImageSizes.bind(this),this.setImageSizes=this.setImageSizes.bind(this),this.getCalculator=this.getCalculator.bind(this),this.setCalculator=this.setCalculator.bind(this),this.removeMarkers=this.removeMarkers.bind(this),this.resetViewport=this.resetViewport.bind(this),this.getImagePath=this.getImagePath.bind(this),this.setImagePath=this.setImagePath.bind(this),this.pushMarkerTo=this.pushMarkerTo.bind(this),this.removeMarker=this.removeMarker.bind(this),this.clearMarkers=this.clearMarkers.bind(this),this.setupStyles=this.setupStyles.bind(this),this.getGridSize=this.getGridSize.bind(this),this.setGridSize=this.setGridSize.bind(this),this.getClusters=this.getClusters.bind(this),this.getMaxZoom=this.getMaxZoom.bind(this),this.setMaxZoom=this.setMaxZoom.bind(this),this.getMarkers=this.getMarkers.bind(this),this.addMarkers=this.addMarkers.bind(this),this.getStyles=this.getStyles.bind(this),this.setStyles=this.setStyles.bind(this),this.addMarker=this.addMarker.bind(this),this.onRemove=this.onRemove.bind(this),this.getTitle=this.getTitle.bind(this),this.setTitle=this.setTitle.bind(this),this.repaint=this.repaint.bind(this),this.onIdle=this.onIdle.bind(this),this.redraw=this.redraw.bind(this),this.onAdd=this.onAdd.bind(this),this.draw=this.draw.bind(this),this.extend=this.extend.bind(this),this.extend(n,google.maps.OverlayView),this.markers=[],this.clusters=[],this.listeners=[],this.activeMap=null,this.ready=!1,this.gridSize=p.gridSize||60,this.minClusterSize=p.minimumClusterSize||2,this.maxZoom=p.maxZoom||null,this.styles=p.styles||[],this.title=p.title||"",this.zoomOnClick=!0,p.zoomOnClick!==void 0&&(this.zoomOnClick=p.zoomOnClick),this.averageCenter=!1,p.averageCenter!==void 0&&(this.averageCenter=p.averageCenter),this.ignoreHidden=!1,p.ignoreHidden!==void 0&&(this.ignoreHidden=p.ignoreHidden),this.enableRetinaIcons=!1,p.enableRetinaIcons!==void 0&&(this.enableRetinaIcons=p.enableRetinaIcons),this.imagePath=p.imagePath||iU,this.imageExtension=p.imageExtension||rU,this.imageSizes=p.imageSizes||nU,this.calculator=p.calculator||QN,this.batchSize=p.batchSize||eU,this.batchSizeIE=p.batchSizeIE||tU,this.clusterClass=p.clusterClass||sU,navigator.userAgent.toLowerCase().indexOf("msie")!==-1&&(this.batchSize=this.batchSizeIE),this.timerRefStatic=null,this.setupStyles(),this.addMarkers(c,!0),this.setMap(r)}return n.prototype.onZoomChanged=function(){var r,c;this.resetViewport(!1),(((r=this.getMap())===null||r===void 0?void 0:r.getZoom())===(this.get("minZoom")||0)||((c=this.getMap())===null||c===void 0?void 0:c.getZoom())===this.get("maxZoom"))&&google.maps.event.trigger(this,"idle")},n.prototype.onIdle=function(){this.redraw()},n.prototype.onAdd=function(){var r=this.getMap();this.activeMap=r,this.ready=!0,this.repaint(),r!==null&&(this.listeners=[google.maps.event.addListener(r,"zoom_changed",this.onZoomChanged),google.maps.event.addListener(r,"idle",this.onIdle)])},n.prototype.onRemove=function(){for(var r=0,c=this.markers;r<c.length;r++){var p=c[r];p.getMap()!==this.activeMap&&p.setMap(this.activeMap)}for(var v=0,w=this.clusters;v<w.length;v++){var A=w[v];A.remove()}this.clusters=[];for(var o=0,D=this.listeners;o<D.length;o++){var j=D[o];google.maps.event.removeListener(j)}this.listeners=[],this.activeMap=null,this.ready=!1},n.prototype.draw=function(){},n.prototype.getMap=function(){return null},n.prototype.getPanes=function(){return null},n.prototype.getProjection=function(){return{fromContainerPixelToLatLng:function(){return null},fromDivPixelToLatLng:function(){return null},fromLatLngToContainerPixel:function(){return null},fromLatLngToDivPixel:function(){return null},getVisibleRegion:function(){return null},getWorldWidth:function(){return 0}}},n.prototype.setMap=function(){},n.prototype.addListener=function(){return{remove:function(){}}},n.prototype.bindTo=function(){},n.prototype.get=function(){},n.prototype.notify=function(){},n.prototype.set=function(){},n.prototype.setValues=function(){},n.prototype.unbind=function(){},n.prototype.unbindAll=function(){},n.prototype.setupStyles=function(){if(!(this.styles.length>0))for(var r=0;r<this.imageSizes.length;r++)this.styles.push({url:"".concat(this.imagePath+(r+1),".").concat(this.imageExtension),height:this.imageSizes[r]||0,width:this.imageSizes[r]||0})},n.prototype.fitMapToMarkers=function(){for(var r=this.getMarkers(),c=new google.maps.LatLngBounds,p=0,v=r;p<v.length;p++){var w=v[p],A=w.getPosition();A&&c.extend(A)}var o=this.getMap();o!==null&&"fitBounds"in o&&o.fitBounds(c)},n.prototype.getGridSize=function(){return this.gridSize},n.prototype.setGridSize=function(r){this.gridSize=r},n.prototype.getMinimumClusterSize=function(){return this.minClusterSize},n.prototype.setMinimumClusterSize=function(r){this.minClusterSize=r},n.prototype.getMaxZoom=function(){return this.maxZoom},n.prototype.setMaxZoom=function(r){this.maxZoom=r},n.prototype.getStyles=function(){return this.styles},n.prototype.setStyles=function(r){this.styles=r},n.prototype.getTitle=function(){return this.title},n.prototype.setTitle=function(r){this.title=r},n.prototype.getZoomOnClick=function(){return this.zoomOnClick},n.prototype.setZoomOnClick=function(r){this.zoomOnClick=r},n.prototype.getAverageCenter=function(){return this.averageCenter},n.prototype.setAverageCenter=function(r){this.averageCenter=r},n.prototype.getIgnoreHidden=function(){return this.ignoreHidden},n.prototype.setIgnoreHidden=function(r){this.ignoreHidden=r},n.prototype.getEnableRetinaIcons=function(){return this.enableRetinaIcons},n.prototype.setEnableRetinaIcons=function(r){this.enableRetinaIcons=r},n.prototype.getImageExtension=function(){return this.imageExtension},n.prototype.setImageExtension=function(r){this.imageExtension=r},n.prototype.getImagePath=function(){return this.imagePath},n.prototype.setImagePath=function(r){this.imagePath=r},n.prototype.getImageSizes=function(){return this.imageSizes},n.prototype.setImageSizes=function(r){this.imageSizes=r},n.prototype.getCalculator=function(){return this.calculator},n.prototype.setCalculator=function(r){this.calculator=r},n.prototype.getBatchSizeIE=function(){return this.batchSizeIE},n.prototype.setBatchSizeIE=function(r){this.batchSizeIE=r},n.prototype.getClusterClass=function(){return this.clusterClass},n.prototype.setClusterClass=function(r){this.clusterClass=r},n.prototype.getMarkers=function(){return this.markers},n.prototype.getTotalMarkers=function(){return this.markers.length},n.prototype.getClusters=function(){return this.clusters},n.prototype.getTotalClusters=function(){return this.clusters.length},n.prototype.addMarker=function(r,c){this.pushMarkerTo(r),c||this.redraw()},n.prototype.addMarkers=function(r,c){for(var p in r)if(Object.prototype.hasOwnProperty.call(r,p)){var v=r[p];v&&this.pushMarkerTo(v)}c||this.redraw()},n.prototype.pushMarkerTo=function(r){var c=this;r.getDraggable()&&google.maps.event.addListener(r,"dragend",function(){c.ready&&(r.isAdded=!1,c.repaint())}),r.isAdded=!1,this.markers.push(r)},n.prototype.removeMarker_=function(r){var c=-1;if(this.markers.indexOf)c=this.markers.indexOf(r);else for(var p=0;p<this.markers.length;p++)if(r===this.markers[p]){c=p;break}return c===-1?!1:(r.setMap(null),this.markers.splice(c,1),!0)},n.prototype.removeMarker=function(r,c){var p=this.removeMarker_(r);return!c&&p&&this.repaint(),p},n.prototype.removeMarkers=function(r,c){for(var p=!1,v=0,w=r;v<w.length;v++){var A=w[v];p=p||this.removeMarker_(A)}return!c&&p&&this.repaint(),p},n.prototype.clearMarkers=function(){this.resetViewport(!0),this.markers=[]},n.prototype.repaint=function(){var r=this.clusters.slice();this.clusters=[],this.resetViewport(!1),this.redraw(),setTimeout(function(){for(var p=0,v=r;p<v.length;p++){var w=v[p];w.remove()}},0)},n.prototype.getExtendedBounds=function(r){var c=this.getProjection(),p=c.fromLatLngToDivPixel(new google.maps.LatLng(r.getNorthEast().lat(),r.getNorthEast().lng()));p!==null&&(p.x+=this.gridSize,p.y-=this.gridSize);var v=c.fromLatLngToDivPixel(new google.maps.LatLng(r.getSouthWest().lat(),r.getSouthWest().lng()));if(v!==null&&(v.x-=this.gridSize,v.y+=this.gridSize),p!==null){var w=c.fromDivPixelToLatLng(p);w!==null&&r.extend(w)}if(v!==null){var A=c.fromDivPixelToLatLng(v);A!==null&&r.extend(A)}return r},n.prototype.redraw=function(){this.createClusters(0)},n.prototype.resetViewport=function(r){for(var c=0,p=this.clusters;c<p.length;c++){var v=p[c];v.remove()}this.clusters=[];for(var w=0,A=this.markers;w<A.length;w++){var o=A[w];o.isAdded=!1,r&&o.setMap(null)}},n.prototype.distanceBetweenPoints=function(r,c){var p=6371,v=(c.lat()-r.lat())*Math.PI/180,w=(c.lng()-r.lng())*Math.PI/180,A=Math.sin(v/2)*Math.sin(v/2)+Math.cos(r.lat()*Math.PI/180)*Math.cos(c.lat()*Math.PI/180)*Math.sin(w/2)*Math.sin(w/2);return p*(2*Math.atan2(Math.sqrt(A),Math.sqrt(1-A)))},n.prototype.isMarkerInBounds=function(r,c){var p=r.getPosition();return p?c.contains(p):!1},n.prototype.addToClosestCluster=function(r){for(var c,p=4e4,v=null,w=0,A=this.clusters;w<A.length;w++){var o=A[w];c=o;var D=c.getCenter(),j=r.getPosition();if(D&&j){var J=this.distanceBetweenPoints(D,j);J<p&&(p=J,v=c)}}v&&v.isMarkerInClusterBounds(r)?v.addMarker(r):(c=new JN(this),c.addMarker(r),this.clusters.push(c))},n.prototype.createClusters=function(r){var c=this;if(this.ready){r===0&&(google.maps.event.trigger(this,"clusteringbegin",this),this.timerRefStatic!==null&&(window.clearTimeout(this.timerRefStatic),delete this.timerRefStatic));for(var p=this.getMap(),v=p!==null&&("getBounds"in p)?p.getBounds():null,w=(p==null?void 0:p.getZoom())||0,A=w>3?new google.maps.LatLngBounds(v==null?void 0:v.getSouthWest(),v==null?void 0:v.getNorthEast()):new google.maps.LatLngBounds(new google.maps.LatLng(85.02070771743472,-178.48388434375),new google.maps.LatLng(-85.08136444384544,178.00048865625)),o=this.getExtendedBounds(A),D=Math.min(r+this.batchSize,this.markers.length),j=r;j<D;j++){var J=this.markers[j];J&&!J.isAdded&&this.isMarkerInBounds(J,o)&&(!this.ignoreHidden||this.ignoreHidden&&J.getVisible())&&this.addToClosestCluster(J)}if(D<this.markers.length)this.timerRefStatic=window.setTimeout(function(){c.createClusters(D)},0);else{this.timerRefStatic=null,google.maps.event.trigger(this,"clusteringend",this);for(var ie=0,re=this.clusters;ie<re.length;ie++){var he=re[ie];he.updateIcon()}}}},n.prototype.extend=function(r,c){return(function(v){for(var w in v.prototype){var A=w;this.prototype[A]=v.prototype[A]}return this}).apply(r,[c])},n}();function vL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function oU(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?vL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):vL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var ya={onClick:"click",onClusteringBegin:"clusteringbegin",onClusteringEnd:"clusteringend",onMouseOut:"mouseout",onMouseOver:"mouseover"},Rr={averageCenter(n,r){n.setAverageCenter(r)},batchSizeIE(n,r){n.setBatchSizeIE(r)},calculator(n,r){n.setCalculator(r)},clusterClass(n,r){n.setClusterClass(r)},enableRetinaIcons(n,r){n.setEnableRetinaIcons(r)},gridSize(n,r){n.setGridSize(r)},ignoreHidden(n,r){n.setIgnoreHidden(r)},imageExtension(n,r){n.setImageExtension(r)},imagePath(n,r){n.setImagePath(r)},imageSizes(n,r){n.setImageSizes(r)},maxZoom(n,r){n.setMaxZoom(r)},minimumClusterSize(n,r){n.setMinimumClusterSize(r)},styles(n,r){n.setStyles(r)},title(n,r){n.setTitle(r)},zoomOnClick(n,r){n.setZoomOnClick(r)}},aU={};function lU(n){var{children:r,options:c,averageCenter:p,batchSizeIE:v,calculator:w,clusterClass:A,enableRetinaIcons:o,gridSize:D,ignoreHidden:j,imageExtension:J,imagePath:ie,imageSizes:re,maxZoom:he,minimumClusterSize:ce,styles:xe,title:Ee,zoomOnClick:ve,onClick:K,onClusteringBegin:fe,onClusteringEnd:ke,onMouseOver:Be,onMouseOut:Le,onLoad:We,onUnmount:ct}=n,[lt,Pt]=Z.useState(null),zt=Z.useContext(rr),[_i,Ut]=Z.useState(null),[bi,vi]=Z.useState(null),[ei,si]=Z.useState(null),[Tt,Ht]=Z.useState(null),[Gt,hi]=Z.useState(null);return Z.useEffect(()=>{lt&&Le&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(lt,ya.onMouseOut,Le)))},[Le]),Z.useEffect(()=>{lt&&Be&&(Gt!==null&&google.maps.event.removeListener(Gt),hi(google.maps.event.addListener(lt,ya.onMouseOver,Be)))},[Be]),Z.useEffect(()=>{lt&&K&&(_i!==null&&google.maps.event.removeListener(_i),Ut(google.maps.event.addListener(lt,ya.onClick,K)))},[K]),Z.useEffect(()=>{lt&&fe&&(bi!==null&&google.maps.event.removeListener(bi),vi(google.maps.event.addListener(lt,ya.onClusteringBegin,fe)))},[fe]),Z.useEffect(()=>{lt&&ke&&(ei!==null&&google.maps.event.removeListener(ei),vi(google.maps.event.addListener(lt,ya.onClusteringEnd,ke)))},[ke]),Z.useEffect(()=>{typeof p<"u"&&lt!==null&&Rr.averageCenter(lt,p)},[lt,p]),Z.useEffect(()=>{typeof v<"u"&&lt!==null&&Rr.batchSizeIE(lt,v)},[lt,v]),Z.useEffect(()=>{typeof w<"u"&&lt!==null&&Rr.calculator(lt,w)},[lt,w]),Z.useEffect(()=>{typeof A<"u"&&lt!==null&&Rr.clusterClass(lt,A)},[lt,A]),Z.useEffect(()=>{typeof o<"u"&&lt!==null&&Rr.enableRetinaIcons(lt,o)},[lt,o]),Z.useEffect(()=>{typeof D<"u"&&lt!==null&&Rr.gridSize(lt,D)},[lt,D]),Z.useEffect(()=>{typeof j<"u"&&lt!==null&&Rr.ignoreHidden(lt,j)},[lt,j]),Z.useEffect(()=>{typeof J<"u"&&lt!==null&&Rr.imageExtension(lt,J)},[lt,J]),Z.useEffect(()=>{typeof ie<"u"&&lt!==null&&Rr.imagePath(lt,ie)},[lt,ie]),Z.useEffect(()=>{typeof re<"u"&&lt!==null&&Rr.imageSizes(lt,re)},[lt,re]),Z.useEffect(()=>{typeof he<"u"&&lt!==null&&Rr.maxZoom(lt,he)},[lt,he]),Z.useEffect(()=>{typeof ce<"u"&&lt!==null&&Rr.minimumClusterSize(lt,ce)},[lt,ce]),Z.useEffect(()=>{typeof xe<"u"&&lt!==null&&Rr.styles(lt,xe)},[lt,xe]),Z.useEffect(()=>{typeof Ee<"u"&&lt!==null&&Rr.title(lt,Ee)},[lt,Ee]),Z.useEffect(()=>{typeof ve<"u"&&lt!==null&&Rr.zoomOnClick(lt,ve)},[lt,ve]),Z.useEffect(()=>{if(zt){var Ft=oU({},c||aU),Ot=new ID(zt,[],Ft);return p&&Rr.averageCenter(Ot,p),v&&Rr.batchSizeIE(Ot,v),w&&Rr.calculator(Ot,w),A&&Rr.clusterClass(Ot,A),o&&Rr.enableRetinaIcons(Ot,o),D&&Rr.gridSize(Ot,D),j&&Rr.ignoreHidden(Ot,j),J&&Rr.imageExtension(Ot,J),ie&&Rr.imagePath(Ot,ie),re&&Rr.imageSizes(Ot,re),he&&Rr.maxZoom(Ot,he),ce&&Rr.minimumClusterSize(Ot,ce),xe&&Rr.styles(Ot,xe),Ee&&Rr.title(Ot,Ee),ve&&Rr.zoomOnClick(Ot,ve),Le&&Ht(google.maps.event.addListener(Ot,ya.onMouseOut,Le)),Be&&hi(google.maps.event.addListener(Ot,ya.onMouseOver,Be)),K&&Ut(google.maps.event.addListener(Ot,ya.onClick,K)),fe&&vi(google.maps.event.addListener(Ot,ya.onClusteringBegin,fe)),ke&&si(google.maps.event.addListener(Ot,ya.onClusteringEnd,ke)),Pt(Ot),We&&We(Ot),()=>{Tt!==null&&google.maps.event.removeListener(Tt),Gt!==null&&google.maps.event.removeListener(Gt),_i!==null&&google.maps.event.removeListener(_i),bi!==null&&google.maps.event.removeListener(bi),ei!==null&&google.maps.event.removeListener(ei),ct&&ct(Ot)}}},[]),lt!==null&&r(lt)||null}Z.memo(lU);class cU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{markerClusterer:null}),It(this,"setClustererCallback",()=>{this.state.markerClusterer!==null&&this.props.onLoad&&this.props.onLoad(this.state.markerClusterer)})}componentDidMount(){if(this.context){var r=new ID(this.context,[],this.props.options);this.registeredEvents=fr({updaterMap:Rr,eventMap:ya,prevProps:{},nextProps:this.props,instance:r}),this.setState(()=>({markerClusterer:r}),this.setClustererCallback)}}componentDidUpdate(r){this.state.markerClusterer&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:Rr,eventMap:ya,prevProps:r,nextProps:this.props,instance:this.state.markerClusterer}))}componentWillUnmount(){this.state.markerClusterer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.markerClusterer),_r(this.registeredEvents),this.state.markerClusterer.setMap(null))}render(){return this.state.markerClusterer!==null?this.props.children(this.state.markerClusterer):null}}It(cU,"contextType",rr);function xL(n){n.cancelBubble=!0,n.stopPropagation&&n.stopPropagation()}var AD=function(){function n(r){r===void 0&&(r={}),this.getCloseClickHandler=this.getCloseClickHandler.bind(this),this.closeClickHandler=this.closeClickHandler.bind(this),this.createInfoBoxDiv=this.createInfoBoxDiv.bind(this),this.addClickHandler=this.addClickHandler.bind(this),this.getCloseBoxImg=this.getCloseBoxImg.bind(this),this.getBoxWidths=this.getBoxWidths.bind(this),this.setBoxStyle=this.setBoxStyle.bind(this),this.setPosition=this.setPosition.bind(this),this.getPosition=this.getPosition.bind(this),this.setOptions=this.setOptions.bind(this),this.setContent=this.setContent.bind(this),this.setVisible=this.setVisible.bind(this),this.getContent=this.getContent.bind(this),this.getVisible=this.getVisible.bind(this),this.setZIndex=this.setZIndex.bind(this),this.getZIndex=this.getZIndex.bind(this),this.onRemove=this.onRemove.bind(this),this.panBox=this.panBox.bind(this),this.extend=this.extend.bind(this),this.close=this.close.bind(this),this.draw=this.draw.bind(this),this.show=this.show.bind(this),this.hide=this.hide.bind(this),this.open=this.open.bind(this),this.extend(n,google.maps.OverlayView),this.content=r.content||"",this.disableAutoPan=r.disableAutoPan||!1,this.maxWidth=r.maxWidth||0,this.pixelOffset=r.pixelOffset||new google.maps.Size(0,0),this.position=r.position||new google.maps.LatLng(0,0),this.zIndex=r.zIndex||null,this.boxClass=r.boxClass||"infoBox",this.boxStyle=r.boxStyle||{},this.closeBoxMargin=r.closeBoxMargin||"2px",this.closeBoxURL=r.closeBoxURL||"http://www.google.com/intl/en_us/mapfiles/close.gif",r.closeBoxURL===""&&(this.closeBoxURL=""),this.infoBoxClearance=r.infoBoxClearance||new google.maps.Size(1,1),typeof r.visible>"u"&&(typeof r.isHidden>"u"?r.visible=!0:r.visible=!r.isHidden),this.isHidden=!r.visible,this.alignBottom=r.alignBottom||!1,this.pane=r.pane||"floatPane",this.enableEventPropagation=r.enableEventPropagation||!1,this.div=null,this.closeListener=null,this.moveListener=null,this.mapListener=null,this.contextListener=null,this.eventListeners=null,this.fixedWidthSet=null}return n.prototype.createInfoBoxDiv=function(){var r=this,c=function(J){J.returnValue=!1,J.preventDefault&&J.preventDefault(),r.enableEventPropagation||xL(J)};if(!this.div){this.div=document.createElement("div"),this.setBoxStyle(),typeof this.content=="string"?this.div.innerHTML=this.getCloseBoxImg()+this.content:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(this.content));var p=this.getPanes();if(p!==null&&p[this.pane].appendChild(this.div),this.addClickHandler(),this.div.style.width)this.fixedWidthSet=!0;else if(this.maxWidth!==0&&this.div.offsetWidth>this.maxWidth)this.div.style.width=this.maxWidth+"px",this.fixedWidthSet=!0;else{var v=this.getBoxWidths();this.div.style.width=this.div.offsetWidth-v.left-v.right+"px",this.fixedWidthSet=!1}if(this.panBox(this.disableAutoPan),!this.enableEventPropagation){this.eventListeners=[];for(var w=["mousedown","mouseover","mouseout","mouseup","click","dblclick","touchstart","touchend","touchmove"],A=0,o=w;A<o.length;A++){var D=o[A];this.eventListeners.push(google.maps.event.addListener(this.div,D,xL))}this.eventListeners.push(google.maps.event.addListener(this.div,"mouseover",function(){r.div&&(r.div.style.cursor="default")}))}this.contextListener=google.maps.event.addListener(this.div,"contextmenu",c),google.maps.event.trigger(this,"domready")}},n.prototype.getCloseBoxImg=function(){var r="";return this.closeBoxURL!==""&&(r='<img alt=""',r+=' aria-hidden="true"',r+=" src='"+this.closeBoxURL+"'",r+=" align=right",r+=" style='",r+=" position: relative;",r+=" cursor: pointer;",r+=" margin: "+this.closeBoxMargin+";",r+="'>"),r},n.prototype.addClickHandler=function(){this.closeListener=this.div&&this.div.firstChild&&this.closeBoxURL!==""?google.maps.event.addListener(this.div.firstChild,"click",this.getCloseClickHandler()):null},n.prototype.closeClickHandler=function(r){r.cancelBubble=!0,r.stopPropagation&&r.stopPropagation(),google.maps.event.trigger(this,"closeclick"),this.close()},n.prototype.getCloseClickHandler=function(){return this.closeClickHandler},n.prototype.panBox=function(r){if(this.div&&!r){var c=this.getMap();if(c instanceof google.maps.Map){var p=0,v=0,w=c.getBounds();w&&!w.contains(this.position)&&c.setCenter(this.position);var A=c.getDiv(),o=A.offsetWidth,D=A.offsetHeight,j=this.pixelOffset.width,J=this.pixelOffset.height,ie=this.div.offsetWidth,re=this.div.offsetHeight,he=this.infoBoxClearance.width,ce=this.infoBoxClearance.height,xe=this.getProjection(),Ee=xe.fromLatLngToContainerPixel(this.position);Ee!==null&&(Ee.x<-j+he?p=Ee.x+j-he:Ee.x+ie+j+he>o&&(p=Ee.x+ie+j+he-o),this.alignBottom?Ee.y<-J+ce+re?v=Ee.y+J-ce-re:Ee.y+J+ce>D&&(v=Ee.y+J+ce-D):Ee.y<-J+ce?v=Ee.y+J-ce:Ee.y+re+J+ce>D&&(v=Ee.y+re+J+ce-D)),p===0&&v===0||c.panBy(p,v)}}},n.prototype.setBoxStyle=function(){if(this.div){this.div.className=this.boxClass,this.div.style.cssText="";var r=this.boxStyle;for(var c in r)Object.prototype.hasOwnProperty.call(r,c)&&(this.div.style[c]=r[c]);if(this.div.style.webkitTransform="translateZ(0)",typeof this.div.style.opacity<"u"&&this.div.style.opacity!==""){var p=parseFloat(this.div.style.opacity||"");this.div.style.msFilter='"progid:DXImageTransform.Microsoft.Alpha(Opacity='+p*100+')"',this.div.style.filter="alpha(opacity="+p*100+")"}this.div.style.position="absolute",this.div.style.visibility="hidden",this.zIndex!==null&&(this.div.style.zIndex=this.zIndex+""),this.div.style.overflow||(this.div.style.overflow="auto")}},n.prototype.getBoxWidths=function(){var r={top:0,bottom:0,left:0,right:0};if(!this.div)return r;if(document.defaultView){var c=this.div.ownerDocument,p=c&&c.defaultView?c.defaultView.getComputedStyle(this.div,""):null;p&&(r.top=parseInt(p.borderTopWidth||"",10)||0,r.bottom=parseInt(p.borderBottomWidth||"",10)||0,r.left=parseInt(p.borderLeftWidth||"",10)||0,r.right=parseInt(p.borderRightWidth||"",10)||0)}else if(document.documentElement.currentStyle){var v=this.div.currentStyle;v&&(r.top=parseInt(v.borderTopWidth||"",10)||0,r.bottom=parseInt(v.borderBottomWidth||"",10)||0,r.left=parseInt(v.borderLeftWidth||"",10)||0,r.right=parseInt(v.borderRightWidth||"",10)||0)}return r},n.prototype.onRemove=function(){this.div&&this.div.parentNode&&(this.div.parentNode.removeChild(this.div),this.div=null)},n.prototype.draw=function(){if(this.createInfoBoxDiv(),this.div){var r=this.getProjection(),c=r.fromLatLngToDivPixel(this.position);c!==null&&(this.div.style.left=c.x+this.pixelOffset.width+"px",this.alignBottom?this.div.style.bottom=-(c.y+this.pixelOffset.height)+"px":this.div.style.top=c.y+this.pixelOffset.height+"px"),this.isHidden?this.div.style.visibility="hidden":this.div.style.visibility="visible"}},n.prototype.setOptions=function(r){r===void 0&&(r={}),typeof r.boxClass<"u"&&(this.boxClass=r.boxClass,this.setBoxStyle()),typeof r.boxStyle<"u"&&(this.boxStyle=r.boxStyle,this.setBoxStyle()),typeof r.content<"u"&&this.setContent(r.content),typeof r.disableAutoPan<"u"&&(this.disableAutoPan=r.disableAutoPan),typeof r.maxWidth<"u"&&(this.maxWidth=r.maxWidth),typeof r.pixelOffset<"u"&&(this.pixelOffset=r.pixelOffset),typeof r.alignBottom<"u"&&(this.alignBottom=r.alignBottom),typeof r.position<"u"&&this.setPosition(r.position),typeof r.zIndex<"u"&&this.setZIndex(r.zIndex),typeof r.closeBoxMargin<"u"&&(this.closeBoxMargin=r.closeBoxMargin),typeof r.closeBoxURL<"u"&&(this.closeBoxURL=r.closeBoxURL),typeof r.infoBoxClearance<"u"&&(this.infoBoxClearance=r.infoBoxClearance),typeof r.isHidden<"u"&&(this.isHidden=r.isHidden),typeof r.visible<"u"&&(this.isHidden=!r.visible),typeof r.enableEventPropagation<"u"&&(this.enableEventPropagation=r.enableEventPropagation),this.div&&this.draw()},n.prototype.setContent=function(r){this.content=r,this.div&&(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.fixedWidthSet||(this.div.style.width=""),typeof r=="string"?this.div.innerHTML=this.getCloseBoxImg()+r:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(r)),this.fixedWidthSet||(this.div.style.width=this.div.offsetWidth+"px",typeof r=="string"?this.div.innerHTML=this.getCloseBoxImg()+r:(this.div.innerHTML=this.getCloseBoxImg(),this.div.appendChild(r))),this.addClickHandler()),google.maps.event.trigger(this,"content_changed")},n.prototype.setPosition=function(r){this.position=r,this.div&&this.draw(),google.maps.event.trigger(this,"position_changed")},n.prototype.setVisible=function(r){this.isHidden=!r,this.div&&(this.div.style.visibility=this.isHidden?"hidden":"visible")},n.prototype.setZIndex=function(r){this.zIndex=r,this.div&&(this.div.style.zIndex=r+""),google.maps.event.trigger(this,"zindex_changed")},n.prototype.getContent=function(){return this.content},n.prototype.getPosition=function(){return this.position},n.prototype.getZIndex=function(){return this.zIndex},n.prototype.getVisible=function(){var r=this.getMap();return typeof r>"u"||r===null?!1:!this.isHidden},n.prototype.show=function(){this.isHidden=!1,this.div&&(this.div.style.visibility="visible")},n.prototype.hide=function(){this.isHidden=!0,this.div&&(this.div.style.visibility="hidden")},n.prototype.open=function(r,c){var p=this;c&&(this.position=c.getPosition(),this.moveListener=google.maps.event.addListener(c,"position_changed",function(){var v=c.getPosition();p.setPosition(v)}),this.mapListener=google.maps.event.addListener(c,"map_changed",function(){p.setMap(c.map)})),this.setMap(r),this.div&&this.panBox()},n.prototype.close=function(){if(this.closeListener&&(google.maps.event.removeListener(this.closeListener),this.closeListener=null),this.eventListeners){for(var r=0,c=this.eventListeners;r<c.length;r++){var p=c[r];google.maps.event.removeListener(p)}this.eventListeners=null}this.moveListener&&(google.maps.event.removeListener(this.moveListener),this.moveListener=null),this.mapListener&&(google.maps.event.removeListener(this.mapListener),this.mapListener=null),this.contextListener&&(google.maps.event.removeListener(this.contextListener),this.contextListener=null),this.setMap(null)},n.prototype.extend=function(r,c){return(function(v){for(var w in v.prototype)Object.prototype.hasOwnProperty.call(this,w)||(this.prototype[w]=v.prototype[w]);return this}).apply(r,[c])},n}(),uU=["position"],hU=["position"];function bL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Ix(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?bL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):bL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var wL={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},SL={options(n,r){n.setOptions(r)},position(n,r){r instanceof google.maps.LatLng?n.setPosition(r):n.setPosition(new google.maps.LatLng(r.lat,r.lng))},visible(n,r){n.setVisible(r)},zIndex(n,r){n.setZIndex(r)}},dU={};function fU(n){var{children:r,anchor:c,options:p,position:v,zIndex:w,onCloseClick:A,onDomReady:o,onContentChanged:D,onPositionChanged:j,onZindexChanged:J,onLoad:ie,onUnmount:re}=n,he=Z.useContext(rr),[ce,xe]=Z.useState(null),[Ee,ve]=Z.useState(null),[K,fe]=Z.useState(null),[ke,Be]=Z.useState(null),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null),Pt=Z.useRef(null);return Z.useEffect(()=>{he&&ce!==null&&(ce.close(),c?ce.open(he,c):ce.getPosition()&&ce.open(he))},[he,ce,c]),Z.useEffect(()=>{p&&ce!==null&&ce.setOptions(p)},[ce,p]),Z.useEffect(()=>{if(v&&ce!==null){var zt=v instanceof google.maps.LatLng?v:new google.maps.LatLng(v.lat,v.lng);ce.setPosition(zt)}},[v]),Z.useEffect(()=>{typeof w=="number"&&ce!==null&&ce.setZIndex(w)},[w]),Z.useEffect(()=>{ce&&A&&(Ee!==null&&google.maps.event.removeListener(Ee),ve(google.maps.event.addListener(ce,"closeclick",A)))},[A]),Z.useEffect(()=>{ce&&o&&(K!==null&&google.maps.event.removeListener(K),fe(google.maps.event.addListener(ce,"domready",o)))},[o]),Z.useEffect(()=>{ce&&D&&(ke!==null&&google.maps.event.removeListener(ke),Be(google.maps.event.addListener(ce,"content_changed",D)))},[D]),Z.useEffect(()=>{ce&&j&&(Le!==null&&google.maps.event.removeListener(Le),We(google.maps.event.addListener(ce,"position_changed",j)))},[j]),Z.useEffect(()=>{ce&&J&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(ce,"zindex_changed",J)))},[J]),Z.useEffect(()=>{if(he){var zt=p||dU,{position:_i}=zt,Ut=v2(zt,uU),bi;_i&&!(_i instanceof google.maps.LatLng)&&(bi=new google.maps.LatLng(_i.lat,_i.lng));var vi=new AD(Ix(Ix({},Ut),bi?{position:bi}:{}));Pt.current=document.createElement("div"),xe(vi),A&&ve(google.maps.event.addListener(vi,"closeclick",A)),o&&fe(google.maps.event.addListener(vi,"domready",o)),D&&Be(google.maps.event.addListener(vi,"content_changed",D)),j&&We(google.maps.event.addListener(vi,"position_changed",j)),J&&lt(google.maps.event.addListener(vi,"zindex_changed",J)),vi.setContent(Pt.current),c?vi.open(he,c):vi.getPosition()?vi.open(he):Qn(!1,"You must provide either an anchor or a position prop for <InfoBox>."),ie&&ie(vi)}return()=>{ce!==null&&(Ee&&google.maps.event.removeListener(Ee),ke&&google.maps.event.removeListener(ke),K&&google.maps.event.removeListener(K),Le&&google.maps.event.removeListener(Le),ct&&google.maps.event.removeListener(ct),re&&re(ce),ce.close())}},[]),Pt.current?ed.createPortal(Z.Children.only(r),Pt.current):null}Z.memo(fU);class pU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"containerElement",null),It(this,"state",{infoBox:null}),It(this,"open",(r,c)=>{c?this.context!==null&&r.open(this.context,c):r.getPosition()?this.context!==null&&r.open(this.context):Qn(!1,"You must provide either an anchor or a position prop for <InfoBox>.")}),It(this,"setInfoBoxCallback",()=>{this.state.infoBox!==null&&this.containerElement!==null&&(this.state.infoBox.setContent(this.containerElement),this.open(this.state.infoBox,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoBox))})}componentDidMount(){var r=this.props.options||{},{position:c}=r,p=v2(r,hU),v;c&&!(c instanceof google.maps.LatLng)&&(v=new google.maps.LatLng(c.lat,c.lng));var w=new AD(Ix(Ix({},p),v?{position:v}:{}));this.containerElement=document.createElement("div"),this.registeredEvents=fr({updaterMap:SL,eventMap:wL,prevProps:{},nextProps:this.props,instance:w}),this.setState({infoBox:w},this.setInfoBoxCallback)}componentDidUpdate(r){var{infoBox:c}=this.state;c!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:SL,eventMap:wL,prevProps:r,nextProps:this.props,instance:c}))}componentWillUnmount(){var{onUnmount:r}=this.props,{infoBox:c}=this.state;c!==null&&(r&&r(c),_r(this.registeredEvents),c.close())}render(){return this.containerElement?ed.createPortal(Z.Children.only(this.props.children),this.containerElement):null}}It(pU,"contextType",rr);var $w,TL;function mU(){return TL||(TL=1,$w=function n(r,c){if(r===c)return!0;if(r&&c&&typeof r=="object"&&typeof c=="object"){if(r.constructor!==c.constructor)return!1;var p,v,w;if(Array.isArray(r)){if(p=r.length,p!=c.length)return!1;for(v=p;v--!==0;)if(!n(r[v],c[v]))return!1;return!0}if(r.constructor===RegExp)return r.source===c.source&&r.flags===c.flags;if(r.valueOf!==Object.prototype.valueOf)return r.valueOf()===c.valueOf();if(r.toString!==Object.prototype.toString)return r.toString()===c.toString();if(w=Object.keys(r),p=w.length,p!==Object.keys(c).length)return!1;for(v=p;v--!==0;)if(!Object.prototype.hasOwnProperty.call(c,w[v]))return!1;for(v=p;v--!==0;){var A=w[v];if(!n(r[A],c[A]))return!1}return!0}return r!==r&&c!==c}),$w}var gU=mU(),EL=bD(gU),IL=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],Gw=1,Vg=8;class x2{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");var[c,p]=new Uint8Array(r,0,2);if(c!==219)throw new Error("Data does not appear to be in a KDBush format.");var v=p>>4;if(v!==Gw)throw new Error("Got v".concat(v," data when expected v").concat(Gw,"."));var w=IL[p&15];if(!w)throw new Error("Unrecognized array type.");var[A]=new Uint16Array(r,2,1),[o]=new Uint32Array(r,4,1);return new x2(o,A,w,r)}constructor(r){var c=arguments.length>1&&arguments[1]!==void 0?arguments[1]:64,p=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Float64Array,v=arguments.length>3?arguments[3]:void 0;if(isNaN(r)||r<0)throw new Error("Unpexpected numItems value: ".concat(r,"."));this.numItems=+r,this.nodeSize=Math.min(Math.max(+c,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;var w=IL.indexOf(this.ArrayType),A=r*2*this.ArrayType.BYTES_PER_ELEMENT,o=r*this.IndexArrayType.BYTES_PER_ELEMENT,D=(8-o%8)%8;if(w<0)throw new Error("Unexpected typed array class: ".concat(p,"."));v&&v instanceof ArrayBuffer?(this.data=v,this.ids=new this.IndexArrayType(this.data,Vg,r),this.coords=new this.ArrayType(this.data,Vg+o+D,r*2),this._pos=r*2,this._finished=!0):(this.data=new ArrayBuffer(Vg+A+o+D),this.ids=new this.IndexArrayType(this.data,Vg,r),this.coords=new this.ArrayType(this.data,Vg+o+D,r*2),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,(Gw<<4)+w]),new Uint16Array(this.data,2,1)[0]=c,new Uint32Array(this.data,4,1)[0]=r)}add(r,c){var p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=c,p}finish(){var r=this._pos>>1;if(r!==this.numItems)throw new Error("Added ".concat(r," items when expected ").concat(this.numItems,"."));return sT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,c,p,v){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:w,coords:A,nodeSize:o}=this,D=[0,w.length-1,0],j=[];D.length;){var J=D.pop()||0,ie=D.pop()||0,re=D.pop()||0;if(ie-re<=o){for(var he=re;he<=ie;he++){var ce=A[2*he],xe=A[2*he+1];ce>=r&&ce<=p&&xe>=c&&xe<=v&&j.push(w[he])}continue}var Ee=re+ie>>1,ve=A[2*Ee],K=A[2*Ee+1];ve>=r&&ve<=p&&K>=c&&K<=v&&j.push(w[Ee]),(J===0?r<=ve:c<=K)&&(D.push(re),D.push(Ee-1),D.push(1-J)),(J===0?p>=ve:v>=K)&&(D.push(Ee+1),D.push(ie),D.push(1-J))}return j}within(r,c,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");for(var{ids:v,coords:w,nodeSize:A}=this,o=[0,v.length-1,0],D=[],j=p*p;o.length;){var J=o.pop()||0,ie=o.pop()||0,re=o.pop()||0;if(ie-re<=A){for(var he=re;he<=ie;he++)AL(w[2*he],w[2*he+1],r,c)<=j&&D.push(v[he]);continue}var ce=re+ie>>1,xe=w[2*ce],Ee=w[2*ce+1];AL(xe,Ee,r,c)<=j&&D.push(v[ce]),(J===0?r-p<=xe:c-p<=Ee)&&(o.push(re),o.push(ce-1),o.push(1-J)),(J===0?r+p>=xe:c+p>=Ee)&&(o.push(ce+1),o.push(ie),o.push(1-J))}return D}}function sT(n,r,c,p,v,w){if(!(v-p<=c)){var A=p+v>>1;CD(n,r,A,p,v,w),sT(n,r,c,p,A-1,1-w),sT(n,r,c,A+1,v,1-w)}}function CD(n,r,c,p,v,w){for(;v>p;){if(v-p>600){var A=v-p+1,o=c-p+1,D=Math.log(A),j=.5*Math.exp(2*D/3),J=.5*Math.sqrt(D*j*(A-j)/A)*(o-A/2<0?-1:1),ie=Math.max(p,Math.floor(c-o*j/A+J)),re=Math.min(v,Math.floor(c+(A-o)*j/A+J));CD(n,r,c,ie,re,w)}var he=r[2*c+w],ce=p,xe=v;for($g(n,r,p,c),r[2*v+w]>he&&$g(n,r,p,v);ce<xe;){for($g(n,r,ce,xe),ce++,xe--;r[2*ce+w]<he;)ce++;for(;r[2*xe+w]>he;)xe--}r[2*p+w]===he?$g(n,r,p,xe):(xe++,$g(n,r,xe,v)),xe<=c&&(p=xe+1),c<=xe&&(v=xe-1)}}function $g(n,r,c,p){Hw(n,c,p),Hw(r,2*c,2*p),Hw(r,2*c+1,2*p+1)}function Hw(n,r,c){var p=n[r];n[r]=n[c],n[c]=p}function AL(n,r,c,p){var v=n-c,w=r-p;return v*v+w*w}var _U={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:n=>n},CL=Math.fround||(n=>r=>(n[0]=+r,n[0]))(new Float32Array(1)),Mh=2,lu=3,Ww=4,su=5,kD=6;class yU{constructor(r){this.options=Object.assign(Object.create(_U),r),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(r){var{log:c,minZoom:p,maxZoom:v}=this.options;c&&console.time("total time");var w="prepare ".concat(r.length," points");c&&console.time(w),this.points=r;for(var A=[],o=0;o<r.length;o++){var D=r[o];if(D.geometry){var[j,J]=D.geometry.coordinates,ie=CL(L0(j)),re=CL(P0(J));A.push(ie,re,1/0,o,-1,1),this.options.reduce&&A.push(0)}}var he=this.trees[v+1]=this._createTree(A);c&&console.timeEnd(w);for(var ce=v;ce>=p;ce--){var xe=+Date.now();he=this.trees[ce]=this._createTree(this._cluster(he,ce)),c&&console.log("z%d: %d clusters in %dms",ce,he.numItems,+Date.now()-xe)}return c&&console.timeEnd("total time"),this}getClusters(r,c){var p=((r[0]+180)%360+360)%360-180,v=Math.max(-90,Math.min(90,r[1])),w=r[2]===180?180:((r[2]+180)%360+360)%360-180,A=Math.max(-90,Math.min(90,r[3]));if(r[2]-r[0]>=360)p=-180,w=180;else if(p>w){var o=this.getClusters([p,v,180,A],c),D=this.getClusters([-180,v,w,A],c);return o.concat(D)}var j=this.trees[this._limitZoom(c)],J=j.range(L0(p),P0(A),L0(w),P0(v)),ie=j.data,re=[];for(var he of J){var ce=this.stride*he;re.push(ie[ce+su]>1?kL(ie,ce,this.clusterProps):this.points[ie[ce+lu]])}return re}getChildren(r){var c=this._getOriginId(r),p=this._getOriginZoom(r),v="No cluster with the specified id.",w=this.trees[p];if(!w)throw new Error(v);var A=w.data;if(c*this.stride>=A.length)throw new Error(v);var o=this.options.radius/(this.options.extent*Math.pow(2,p-1)),D=A[c*this.stride],j=A[c*this.stride+1],J=w.within(D,j,o),ie=[];for(var re of J){var he=re*this.stride;A[he+Ww]===r&&ie.push(A[he+su]>1?kL(A,he,this.clusterProps):this.points[A[he+lu]])}if(ie.length===0)throw new Error(v);return ie}getLeaves(r,c,p){c=c||10,p=p||0;var v=[];return this._appendLeaves(v,r,c,p,0),v}getTile(r,c,p){var v=this.trees[this._limitZoom(r)],w=Math.pow(2,r),{extent:A,radius:o}=this.options,D=o/A,j=(p-D)/w,J=(p+1+D)/w,ie={features:[]};return this._addTileFeatures(v.range((c-D)/w,j,(c+1+D)/w,J),v.data,c,p,w,ie),c===0&&this._addTileFeatures(v.range(1-D/w,j,1,J),v.data,w,p,w,ie),c===w-1&&this._addTileFeatures(v.range(0,j,D/w,J),v.data,-1,p,w,ie),ie.features.length?ie:null}getClusterExpansionZoom(r){for(var c=this._getOriginZoom(r)-1;c<=this.options.maxZoom;){var p=this.getChildren(r);if(c++,p.length!==1)break;r=p[0].properties.cluster_id}return c}_appendLeaves(r,c,p,v,w){var A=this.getChildren(c);for(var o of A){var D=o.properties;if(D&&D.cluster?w+D.point_count<=v?w+=D.point_count:w=this._appendLeaves(r,D.cluster_id,p,v,w):w<v?w++:r.push(o),r.length===p)break}return w}_createTree(r){for(var c=new x2(r.length/this.stride|0,this.options.nodeSize,Float32Array),p=0;p<r.length;p+=this.stride)c.add(r[p],r[p+1]);return c.finish(),c.data=r,c}_addTileFeatures(r,c,p,v,w,A){for(var o of r){var D=o*this.stride,j=c[D+su]>1,J=void 0,ie=void 0,re=void 0;if(j)J=LD(c,D,this.clusterProps),ie=c[D],re=c[D+1];else{var he=this.points[c[D+lu]];J=he.properties;var[ce,xe]=he.geometry.coordinates;ie=L0(ce),re=P0(xe)}var Ee={type:1,geometry:[[Math.round(this.options.extent*(ie*w-p)),Math.round(this.options.extent*(re*w-v))]],tags:J},ve=void 0;j||this.options.generateId?ve=c[D+lu]:ve=this.points[c[D+lu]].id,ve!==void 0&&(Ee.id=ve),A.features.push(Ee)}}_limitZoom(r){return Math.max(this.options.minZoom,Math.min(Math.floor(+r),this.options.maxZoom+1))}_cluster(r,c){for(var{radius:p,extent:v,reduce:w,minPoints:A}=this.options,o=p/(v*Math.pow(2,c)),D=r.data,j=[],J=this.stride,ie=0;ie<D.length;ie+=J)if(!(D[ie+Mh]<=c)){D[ie+Mh]=c;var re=D[ie],he=D[ie+1],ce=r.within(D[ie],D[ie+1],o),xe=D[ie+su],Ee=xe;for(var ve of ce){var K=ve*J;D[K+Mh]>c&&(Ee+=D[K+su])}if(Ee>xe&&Ee>=A){var fe=re*xe,ke=he*xe,Be=void 0,Le=-1,We=((ie/J|0)<<5)+(c+1)+this.points.length;for(var ct of ce){var lt=ct*J;if(!(D[lt+Mh]<=c)){D[lt+Mh]=c;var Pt=D[lt+su];fe+=D[lt]*Pt,ke+=D[lt+1]*Pt,D[lt+Ww]=We,w&&(Be||(Be=this._map(D,ie,!0),Le=this.clusterProps.length,this.clusterProps.push(Be)),w(Be,this._map(D,lt)))}}D[ie+Ww]=We,j.push(fe/Ee,ke/Ee,1/0,We,-1,Ee),w&&j.push(Le)}else{for(var zt=0;zt<J;zt++)j.push(D[ie+zt]);if(Ee>1)for(var _i of ce){var Ut=_i*J;if(!(D[Ut+Mh]<=c)){D[Ut+Mh]=c;for(var bi=0;bi<J;bi++)j.push(D[Ut+bi])}}}}return j}_getOriginId(r){return r-this.points.length>>5}_getOriginZoom(r){return(r-this.points.length)%32}_map(r,c,p){if(r[c+su]>1){var v=this.clusterProps[r[c+kD]];return p?Object.assign({},v):v}var w=this.points[r[c+lu]].properties,A=this.options.map(w);return p&&A===w?Object.assign({},A):A}}function kL(n,r,c){return{type:"Feature",id:n[r+lu],properties:LD(n,r,c),geometry:{type:"Point",coordinates:[vU(n[r]),xU(n[r+1])]}}}function LD(n,r,c){var p=n[r+su],v=p>=1e4?"".concat(Math.round(p/1e3),"k"):p>=1e3?"".concat(Math.round(p/100)/10,"k"):p,w=n[r+kD],A=w===-1?{}:Object.assign({},c[w]);return Object.assign(A,{cluster:!0,cluster_id:n[r+lu],point_count:p,point_count_abbreviated:v})}function L0(n){return n/360+.5}function P0(n){var r=Math.sin(n*Math.PI/180),c=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return c<0?0:c>1?1:c}function vU(n){return(n-.5)*360}function xU(n){var r=(180-n*360)*Math.PI/180;return 360*Math.atan(Math.exp(r))/Math.PI-90}/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function bU(n,r){var c={};for(var p in n)Object.prototype.hasOwnProperty.call(n,p)&&r.indexOf(p)<0&&(c[p]=n[p]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,p=Object.getOwnPropertySymbols(n);v<p.length;v++)r.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(n,p[v])&&(c[p[v]]=n[p[v]]);return c}class qo{static isAdvancedMarkerAvailable(r){return google.maps.marker&&r.getMapCapabilities().isAdvancedMarkersAvailable===!0}static isAdvancedMarker(r){return google.maps.marker&&r instanceof google.maps.marker.AdvancedMarkerElement}static setMap(r,c){this.isAdvancedMarker(r)?r.map=c:r.setMap(c)}static getPosition(r){if(this.isAdvancedMarker(r)){if(r.position){if(r.position instanceof google.maps.LatLng)return r.position;if(r.position.lat&&r.position.lng)return new google.maps.LatLng(r.position.lat,r.position.lng)}return new google.maps.LatLng(null)}return r.getPosition()}static getVisible(r){return this.isAdvancedMarker(r)?!0:r.getVisible()}}class oT{constructor(r){var{markers:c,position:p}=r;this.markers=c,p&&(p instanceof google.maps.LatLng?this._position=p:this._position=new google.maps.LatLng(p))}get bounds(){if(!(this.markers.length===0&&!this._position)){var r=new google.maps.LatLngBounds(this._position,this._position);for(var c of this.markers)r.extend(qo.getPosition(c));return r}}get position(){return this._position||this.bounds.getCenter()}get count(){return this.markers.filter(r=>qo.getVisible(r)).length}push(r){this.markers.push(r)}delete(){this.marker&&(qo.setMap(this.marker,null),this.marker=void 0),this.markers.length=0}}class wU{constructor(r){var{maxZoom:c=16}=r;this.maxZoom=c}noop(r){var{markers:c}=r;return SU(c)}}var SU=n=>{var r=n.map(c=>new oT({position:qo.getPosition(c),markers:[c]}));return r};class TU extends wU{constructor(r){var{maxZoom:c,radius:p=60}=r,v=bU(r,["maxZoom","radius"]);super({maxZoom:c}),this.state={zoom:-1},this.superCluster=new yU(Object.assign({maxZoom:this.maxZoom,radius:p},v))}calculate(r){var c=!1,p={zoom:r.map.getZoom()};if(!EL(r.markers,this.markers)){c=!0,this.markers=[...r.markers];var v=this.markers.map(w=>{var A=qo.getPosition(w),o=[A.lng(),A.lat()];return{type:"Feature",geometry:{type:"Point",coordinates:o},properties:{marker:w}}});this.superCluster.load(v)}return c||(this.state.zoom<=this.maxZoom||p.zoom<=this.maxZoom)&&(c=!EL(this.state,p)),this.state=p,c&&(this.clusters=this.cluster(r)),{clusters:this.clusters,changed:c}}cluster(r){var{map:c}=r;return this.superCluster.getClusters([-180,-90,180,90],Math.round(c.getZoom())).map(p=>this.transformCluster(p))}transformCluster(r){var{geometry:{coordinates:[c,p]},properties:v}=r;if(v.cluster)return new oT({markers:this.superCluster.getLeaves(v.cluster_id,1/0).map(A=>A.properties.marker),position:{lat:p,lng:c}});var w=v.marker;return new oT({markers:[w],position:qo.getPosition(w)})}}class EU{constructor(r,c){this.markers={sum:r.length};var p=c.map(w=>w.count),v=p.reduce((w,A)=>w+A,0);this.clusters={count:c.length,markers:{mean:v/c.length,sum:v,min:Math.min(...p),max:Math.max(...p)}}}}class IU{render(r,c,p){var{count:v,position:w}=r,A=v>Math.max(10,c.clusters.markers.mean)?"#ff0000":"#0000ff",o='<svg fill="'.concat(A,`" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240" width="50" height="50">
<circle cx="120" cy="120" opacity=".6" r="70" />
<circle cx="120" cy="120" opacity=".3" r="90" />
<circle cx="120" cy="120" opacity=".2" r="110" />
<text x="50%" y="50%" style="fill:#fff" text-anchor="middle" font-size="50" dominant-baseline="middle" font-family="roboto,arial,sans-serif">`).concat(v,`</text>
</svg>`),D="Cluster of ".concat(v," markers"),j=Number(google.maps.Marker.MAX_ZINDEX)+v;if(qo.isAdvancedMarkerAvailable(p)){var J=new DOMParser,ie=J.parseFromString(o,"image/svg+xml").documentElement;ie.setAttribute("transform","translate(0 25)");var re={map:p,position:w,zIndex:j,title:D,content:ie};return new google.maps.marker.AdvancedMarkerElement(re)}var he={position:w,zIndex:j,title:D,icon:{url:"data:image/svg+xml;base64,".concat(btoa(o)),anchor:new google.maps.Point(25,25)}};return new google.maps.Marker(he)}}function AU(n,r){for(var c in r.prototype)n.prototype[c]=r.prototype[c]}class b2{constructor(){AU(b2,google.maps.OverlayView)}}var o_;(function(n){n.CLUSTERING_BEGIN="clusteringbegin",n.CLUSTERING_END="clusteringend",n.CLUSTER_CLICK="click"})(o_||(o_={}));var CU=(n,r,c)=>{c.fitBounds(r.bounds)};class kU extends b2{constructor(r){var{map:c,markers:p=[],algorithmOptions:v={},algorithm:w=new TU(v),renderer:A=new IU,onClusterClick:o=CU}=r;super(),this.markers=[...p],this.clusters=[],this.algorithm=w,this.renderer=A,this.onClusterClick=o,c&&this.setMap(c)}addMarker(r,c){this.markers.includes(r)||(this.markers.push(r),c||this.render())}addMarkers(r,c){r.forEach(p=>{this.addMarker(p,!0)}),c||this.render()}removeMarker(r,c){var p=this.markers.indexOf(r);return p===-1?!1:(qo.setMap(r,null),this.markers.splice(p,1),c||this.render(),!0)}removeMarkers(r,c){var p=!1;return r.forEach(v=>{p=this.removeMarker(v,!0)||p}),p&&!c&&this.render(),p}clearMarkers(r){this.markers.length=0,r||this.render()}render(){var r=this.getMap();if(r instanceof google.maps.Map&&r.getProjection()){google.maps.event.trigger(this,o_.CLUSTERING_BEGIN,this);var{clusters:c,changed:p}=this.algorithm.calculate({markers:this.markers,map:r,mapCanvasProjection:this.getProjection()});if(p||p==null){var v=new Set;for(var w of c)w.markers.length==1&&v.add(w.markers[0]);var A=[];for(var o of this.clusters)o.marker!=null&&(o.markers.length==1?v.has(o.marker)||qo.setMap(o.marker,null):A.push(o.marker));this.clusters=c,this.renderClusters(),requestAnimationFrame(()=>A.forEach(D=>qo.setMap(D,null)))}google.maps.event.trigger(this,o_.CLUSTERING_END,this)}}onAdd(){this.idleListener=this.getMap().addListener("idle",this.render.bind(this)),this.render()}onRemove(){google.maps.event.removeListener(this.idleListener),this.reset()}reset(){this.markers.forEach(r=>qo.setMap(r,null)),this.clusters.forEach(r=>r.delete()),this.clusters=[]}renderClusters(){var r=new EU(this.markers,this.clusters),c=this.getMap();this.clusters.forEach(p=>{p.markers.length===1?p.marker=p.markers[0]:(p.marker=this.renderer.render(p,r,c),p.markers.forEach(v=>qo.setMap(v,null)),this.onClusterClick&&p.marker.addListener("click",v=>{google.maps.event.trigger(this,o_.CLUSTER_CLICK,p),this.onClusterClick(v,p,c)})),qo.setMap(p.marker,c)})}}function LL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function PL(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?LL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):LL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}function LU(n){var r=wN(),[c,p]=Z.useState(null);return Z.useEffect(()=>{if(r&&c===null){var v=new kU(PL(PL({},n),{},{map:r}));p(v)}},[r]),c}function PU(n){var{children:r,options:c}=n,p=LU(c);return p!==null?r(p):null}Z.memo(PU);var ML={onCloseClick:"closeclick",onContentChanged:"content_changed",onDomReady:"domready",onPositionChanged:"position_changed",onZindexChanged:"zindex_changed"},RL={options(n,r){n.setOptions(r)},position(n,r){n.setPosition(r)},zIndex(n,r){n.setZIndex(r)}};function MU(n){var{children:r,anchor:c,options:p,position:v,zIndex:w,onCloseClick:A,onDomReady:o,onContentChanged:D,onPositionChanged:j,onZindexChanged:J,onLoad:ie,onUnmount:re}=n,he=Z.useContext(rr),[ce,xe]=Z.useState(null),[Ee,ve]=Z.useState(null),[K,fe]=Z.useState(null),[ke,Be]=Z.useState(null),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null),Pt=Z.useRef(null);return Z.useEffect(()=>{ce!==null&&(ce.close(),c?ce.open(he,c):ce.getPosition()&&ce.open(he))},[he,ce,c]),Z.useEffect(()=>{p&&ce!==null&&ce.setOptions(p)},[ce,p]),Z.useEffect(()=>{v&&ce!==null&&ce.setPosition(v)},[v]),Z.useEffect(()=>{typeof w=="number"&&ce!==null&&ce.setZIndex(w)},[w]),Z.useEffect(()=>{ce&&A&&(Ee!==null&&google.maps.event.removeListener(Ee),ve(google.maps.event.addListener(ce,"closeclick",A)))},[A]),Z.useEffect(()=>{ce&&o&&(K!==null&&google.maps.event.removeListener(K),fe(google.maps.event.addListener(ce,"domready",o)))},[o]),Z.useEffect(()=>{ce&&D&&(ke!==null&&google.maps.event.removeListener(ke),Be(google.maps.event.addListener(ce,"content_changed",D)))},[D]),Z.useEffect(()=>{ce&&j&&(Le!==null&&google.maps.event.removeListener(Le),We(google.maps.event.addListener(ce,"position_changed",j)))},[j]),Z.useEffect(()=>{ce&&J&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(ce,"zindex_changed",J)))},[J]),Z.useEffect(()=>{var zt=new google.maps.InfoWindow(p);return xe(zt),Pt.current=document.createElement("div"),A&&ve(google.maps.event.addListener(zt,"closeclick",A)),o&&fe(google.maps.event.addListener(zt,"domready",o)),D&&Be(google.maps.event.addListener(zt,"content_changed",D)),j&&We(google.maps.event.addListener(zt,"position_changed",j)),J&&lt(google.maps.event.addListener(zt,"zindex_changed",J)),zt.setContent(Pt.current),v&&zt.setPosition(v),w&&zt.setZIndex(w),c?zt.open(he,c):zt.getPosition()?zt.open(he):Qn(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>."),ie&&ie(zt),()=>{Ee&&google.maps.event.removeListener(Ee),ke&&google.maps.event.removeListener(ke),K&&google.maps.event.removeListener(K),Le&&google.maps.event.removeListener(Le),ct&&google.maps.event.removeListener(ct),re&&re(zt),zt.close()}},[]),Pt.current?ed.createPortal(Z.Children.only(r),Pt.current):null}Z.memo(MU);class RU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"containerElement",null),It(this,"state",{infoWindow:null}),It(this,"open",(r,c)=>{c?r.open(this.context,c):r.getPosition()?r.open(this.context):Qn(!1,"You must provide either an anchor (typically render it inside a <Marker>) or a position props for <InfoWindow>.")}),It(this,"setInfoWindowCallback",()=>{this.state.infoWindow!==null&&this.containerElement!==null&&(this.state.infoWindow.setContent(this.containerElement),this.open(this.state.infoWindow,this.props.anchor),this.props.onLoad&&this.props.onLoad(this.state.infoWindow))})}componentDidMount(){var r=new google.maps.InfoWindow(this.props.options);this.containerElement=document.createElement("div"),this.registeredEvents=fr({updaterMap:RL,eventMap:ML,prevProps:{},nextProps:this.props,instance:r}),this.setState(()=>({infoWindow:r}),this.setInfoWindowCallback)}componentDidUpdate(r){this.state.infoWindow!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:RL,eventMap:ML,prevProps:r,nextProps:this.props,instance:this.state.infoWindow}))}componentWillUnmount(){this.state.infoWindow!==null&&(_r(this.registeredEvents),this.props.onUnmount&&this.props.onUnmount(this.state.infoWindow),this.state.infoWindow.close())}render(){return this.containerElement?ed.createPortal(Z.Children.only(this.props.children),this.containerElement):null}}It(RU,"contextType",rr);function DL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Ax(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?DL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):DL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var OL={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},zL={draggable(n,r){n.setDraggable(r)},editable(n,r){n.setEditable(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)},path(n,r){n.setPath(r)},visible(n,r){n.setVisible(r)}},DU={};function OU(n){var{options:r,draggable:c,editable:p,visible:v,path:w,onDblClick:A,onDragEnd:o,onDragStart:D,onMouseDown:j,onMouseMove:J,onMouseOut:ie,onMouseOver:re,onMouseUp:he,onRightClick:ce,onClick:xe,onDrag:Ee,onLoad:ve,onUnmount:K}=n,fe=Z.useContext(rr),[ke,Be]=Z.useState(null),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null),[Pt,zt]=Z.useState(null),[_i,Ut]=Z.useState(null),[bi,vi]=Z.useState(null),[ei,si]=Z.useState(null),[Tt,Ht]=Z.useState(null),[Gt,hi]=Z.useState(null),[Ft,Ot]=Z.useState(null),[di,wt]=Z.useState(null),[sr,pr]=Z.useState(null);return Z.useEffect(()=>{ke!==null&&ke.setMap(fe)},[fe]),Z.useEffect(()=>{typeof r<"u"&&ke!==null&&ke.setOptions(r)},[ke,r]),Z.useEffect(()=>{typeof c<"u"&&ke!==null&&ke.setDraggable(c)},[ke,c]),Z.useEffect(()=>{typeof p<"u"&&ke!==null&&ke.setEditable(p)},[ke,p]),Z.useEffect(()=>{typeof v<"u"&&ke!==null&&ke.setVisible(v)},[ke,v]),Z.useEffect(()=>{typeof w<"u"&&ke!==null&&ke.setPath(w)},[ke,w]),Z.useEffect(()=>{ke&&A&&(Le!==null&&google.maps.event.removeListener(Le),We(google.maps.event.addListener(ke,"dblclick",A)))},[A]),Z.useEffect(()=>{ke&&o&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(ke,"dragend",o)))},[o]),Z.useEffect(()=>{ke&&D&&(Pt!==null&&google.maps.event.removeListener(Pt),zt(google.maps.event.addListener(ke,"dragstart",D)))},[D]),Z.useEffect(()=>{ke&&j&&(_i!==null&&google.maps.event.removeListener(_i),Ut(google.maps.event.addListener(ke,"mousedown",j)))},[j]),Z.useEffect(()=>{ke&&J&&(bi!==null&&google.maps.event.removeListener(bi),vi(google.maps.event.addListener(ke,"mousemove",J)))},[J]),Z.useEffect(()=>{ke&&ie&&(ei!==null&&google.maps.event.removeListener(ei),si(google.maps.event.addListener(ke,"mouseout",ie)))},[ie]),Z.useEffect(()=>{ke&&re&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(ke,"mouseover",re)))},[re]),Z.useEffect(()=>{ke&&he&&(Gt!==null&&google.maps.event.removeListener(Gt),hi(google.maps.event.addListener(ke,"mouseup",he)))},[he]),Z.useEffect(()=>{ke&&ce&&(Ft!==null&&google.maps.event.removeListener(Ft),Ot(google.maps.event.addListener(ke,"rightclick",ce)))},[ce]),Z.useEffect(()=>{ke&&xe&&(di!==null&&google.maps.event.removeListener(di),wt(google.maps.event.addListener(ke,"click",xe)))},[xe]),Z.useEffect(()=>{ke&&Ee&&(sr!==null&&google.maps.event.removeListener(sr),pr(google.maps.event.addListener(ke,"drag",Ee)))},[Ee]),Z.useEffect(()=>{var Fi=new google.maps.Polyline(Ax(Ax({},r||DU),{},{map:fe}));return w&&Fi.setPath(w),typeof v<"u"&&Fi.setVisible(v),typeof p<"u"&&Fi.setEditable(p),typeof c<"u"&&Fi.setDraggable(c),A&&We(google.maps.event.addListener(Fi,"dblclick",A)),o&&lt(google.maps.event.addListener(Fi,"dragend",o)),D&&zt(google.maps.event.addListener(Fi,"dragstart",D)),j&&Ut(google.maps.event.addListener(Fi,"mousedown",j)),J&&vi(google.maps.event.addListener(Fi,"mousemove",J)),ie&&si(google.maps.event.addListener(Fi,"mouseout",ie)),re&&Ht(google.maps.event.addListener(Fi,"mouseover",re)),he&&hi(google.maps.event.addListener(Fi,"mouseup",he)),ce&&Ot(google.maps.event.addListener(Fi,"rightclick",ce)),xe&&wt(google.maps.event.addListener(Fi,"click",xe)),Ee&&pr(google.maps.event.addListener(Fi,"drag",Ee)),Be(Fi),ve&&ve(Fi),()=>{Le!==null&&google.maps.event.removeListener(Le),ct!==null&&google.maps.event.removeListener(ct),Pt!==null&&google.maps.event.removeListener(Pt),_i!==null&&google.maps.event.removeListener(_i),bi!==null&&google.maps.event.removeListener(bi),ei!==null&&google.maps.event.removeListener(ei),Tt!==null&&google.maps.event.removeListener(Tt),Gt!==null&&google.maps.event.removeListener(Gt),Ft!==null&&google.maps.event.removeListener(Ft),di!==null&&google.maps.event.removeListener(di),K&&K(Fi),Fi.setMap(null)}},[]),null}Z.memo(OU);class zU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{polyline:null}),It(this,"setPolylineCallback",()=>{this.state.polyline!==null&&this.props.onLoad&&this.props.onLoad(this.state.polyline)})}componentDidMount(){var r=new google.maps.Polyline(Ax(Ax({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:zL,eventMap:OL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{polyline:r}},this.setPolylineCallback)}componentDidUpdate(r){this.state.polyline!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:zL,eventMap:OL,prevProps:r,nextProps:this.props,instance:this.state.polyline}))}componentWillUnmount(){this.state.polyline!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.polyline),_r(this.registeredEvents),this.state.polyline.setMap(null))}render(){return null}}It(zU,"contextType",rr);function BL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function FL(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?BL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):BL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var jL={onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},NL={draggable(n,r){n.setDraggable(r)},editable(n,r){n.setEditable(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)},path(n,r){n.setPath(r)},paths(n,r){n.setPaths(r)},visible(n,r){n.setVisible(r)}};function BU(n){var{options:r,draggable:c,editable:p,visible:v,path:w,paths:A,onDblClick:o,onDragEnd:D,onDragStart:j,onMouseDown:J,onMouseMove:ie,onMouseOut:re,onMouseOver:he,onMouseUp:ce,onRightClick:xe,onClick:Ee,onDrag:ve,onLoad:K,onUnmount:fe,onEdit:ke}=n,Be=Z.useContext(rr),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null),[Pt,zt]=Z.useState(null),[_i,Ut]=Z.useState(null),[bi,vi]=Z.useState(null),[ei,si]=Z.useState(null),[Tt,Ht]=Z.useState(null),[Gt,hi]=Z.useState(null),[Ft,Ot]=Z.useState(null),[di,wt]=Z.useState(null),[sr,pr]=Z.useState(null),[Fi,Si]=Z.useState(null);return Z.useEffect(()=>{Le!==null&&Le.setMap(Be)},[Be]),Z.useEffect(()=>{typeof r<"u"&&Le!==null&&Le.setOptions(r)},[Le,r]),Z.useEffect(()=>{typeof c<"u"&&Le!==null&&Le.setDraggable(c)},[Le,c]),Z.useEffect(()=>{typeof p<"u"&&Le!==null&&Le.setEditable(p)},[Le,p]),Z.useEffect(()=>{typeof v<"u"&&Le!==null&&Le.setVisible(v)},[Le,v]),Z.useEffect(()=>{typeof w<"u"&&Le!==null&&Le.setPath(w)},[Le,w]),Z.useEffect(()=>{typeof A<"u"&&Le!==null&&Le.setPaths(A)},[Le,A]),Z.useEffect(()=>{Le&&typeof o=="function"&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(Le,"dblclick",o)))},[o]),Z.useEffect(()=>{Le&&(google.maps.event.addListener(Le.getPath(),"insert_at",()=>{ke==null||ke(Le)}),google.maps.event.addListener(Le.getPath(),"set_at",()=>{ke==null||ke(Le)}),google.maps.event.addListener(Le.getPath(),"remove_at",()=>{ke==null||ke(Le)}))},[Le,ke]),Z.useEffect(()=>{Le&&typeof D=="function"&&(Pt!==null&&google.maps.event.removeListener(Pt),zt(google.maps.event.addListener(Le,"dragend",D)))},[D]),Z.useEffect(()=>{Le&&typeof j=="function"&&(_i!==null&&google.maps.event.removeListener(_i),Ut(google.maps.event.addListener(Le,"dragstart",j)))},[j]),Z.useEffect(()=>{Le&&typeof J=="function"&&(bi!==null&&google.maps.event.removeListener(bi),vi(google.maps.event.addListener(Le,"mousedown",J)))},[J]),Z.useEffect(()=>{Le&&typeof ie=="function"&&(ei!==null&&google.maps.event.removeListener(ei),si(google.maps.event.addListener(Le,"mousemove",ie)))},[ie]),Z.useEffect(()=>{Le&&typeof re=="function"&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(Le,"mouseout",re)))},[re]),Z.useEffect(()=>{Le&&typeof he=="function"&&(Gt!==null&&google.maps.event.removeListener(Gt),hi(google.maps.event.addListener(Le,"mouseover",he)))},[he]),Z.useEffect(()=>{Le&&typeof ce=="function"&&(Ft!==null&&google.maps.event.removeListener(Ft),Ot(google.maps.event.addListener(Le,"mouseup",ce)))},[ce]),Z.useEffect(()=>{Le&&typeof xe=="function"&&(di!==null&&google.maps.event.removeListener(di),wt(google.maps.event.addListener(Le,"rightclick",xe)))},[xe]),Z.useEffect(()=>{Le&&typeof Ee=="function"&&(sr!==null&&google.maps.event.removeListener(sr),pr(google.maps.event.addListener(Le,"click",Ee)))},[Ee]),Z.useEffect(()=>{Le&&typeof ve=="function"&&(Fi!==null&&google.maps.event.removeListener(Fi),Si(google.maps.event.addListener(Le,"drag",ve)))},[ve]),Z.useEffect(()=>{var Qt=new google.maps.Polygon(FL(FL({},r),{},{map:Be}));return w&&Qt.setPath(w),A&&Qt.setPaths(A),typeof v<"u"&&Qt.setVisible(v),typeof p<"u"&&Qt.setEditable(p),typeof c<"u"&&Qt.setDraggable(c),o&&lt(google.maps.event.addListener(Qt,"dblclick",o)),D&&zt(google.maps.event.addListener(Qt,"dragend",D)),j&&Ut(google.maps.event.addListener(Qt,"dragstart",j)),J&&vi(google.maps.event.addListener(Qt,"mousedown",J)),ie&&si(google.maps.event.addListener(Qt,"mousemove",ie)),re&&Ht(google.maps.event.addListener(Qt,"mouseout",re)),he&&hi(google.maps.event.addListener(Qt,"mouseover",he)),ce&&Ot(google.maps.event.addListener(Qt,"mouseup",ce)),xe&&wt(google.maps.event.addListener(Qt,"rightclick",xe)),Ee&&pr(google.maps.event.addListener(Qt,"click",Ee)),ve&&Si(google.maps.event.addListener(Qt,"drag",ve)),We(Qt),K&&K(Qt),()=>{ct!==null&&google.maps.event.removeListener(ct),Pt!==null&&google.maps.event.removeListener(Pt),_i!==null&&google.maps.event.removeListener(_i),bi!==null&&google.maps.event.removeListener(bi),ei!==null&&google.maps.event.removeListener(ei),Tt!==null&&google.maps.event.removeListener(Tt),Gt!==null&&google.maps.event.removeListener(Gt),Ft!==null&&google.maps.event.removeListener(Ft),di!==null&&google.maps.event.removeListener(di),sr!==null&&google.maps.event.removeListener(sr),fe&&fe(Qt),Qt.setMap(null)}},[]),null}Z.memo(BU);class FU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[])}componentDidMount(){var r=this.props.options||{};this.polygon=new google.maps.Polygon(r),this.polygon.setMap(this.context),this.registeredEvents=fr({updaterMap:NL,eventMap:jL,prevProps:{},nextProps:this.props,instance:this.polygon}),this.props.onLoad&&this.props.onLoad(this.polygon)}componentDidUpdate(r){this.polygon&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:NL,eventMap:jL,prevProps:r,nextProps:this.props,instance:this.polygon}))}componentWillUnmount(){this.polygon&&(this.props.onUnmount&&this.props.onUnmount(this.polygon),_r(this.registeredEvents),this.polygon&&this.polygon.setMap(null))}render(){return null}}It(FU,"contextType",rr);function UL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Cx(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?UL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):UL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var VL={onBoundsChanged:"bounds_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},$L={bounds(n,r){n.setBounds(r)},draggable(n,r){n.setDraggable(r)},editable(n,r){n.setEditable(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)},visible(n,r){n.setVisible(r)}};function jU(n){var{options:r,bounds:c,draggable:p,editable:v,visible:w,onDblClick:A,onDragEnd:o,onDragStart:D,onMouseDown:j,onMouseMove:J,onMouseOut:ie,onMouseOver:re,onMouseUp:he,onRightClick:ce,onClick:xe,onDrag:Ee,onBoundsChanged:ve,onLoad:K,onUnmount:fe}=n,ke=Z.useContext(rr),[Be,Le]=Z.useState(null),[We,ct]=Z.useState(null),[lt,Pt]=Z.useState(null),[zt,_i]=Z.useState(null),[Ut,bi]=Z.useState(null),[vi,ei]=Z.useState(null),[si,Tt]=Z.useState(null),[Ht,Gt]=Z.useState(null),[hi,Ft]=Z.useState(null),[Ot,di]=Z.useState(null),[wt,sr]=Z.useState(null),[pr,Fi]=Z.useState(null),[Si,Qt]=Z.useState(null);return Z.useEffect(()=>{Be!==null&&Be.setMap(ke)},[ke]),Z.useEffect(()=>{typeof r<"u"&&Be!==null&&Be.setOptions(r)},[Be,r]),Z.useEffect(()=>{typeof p<"u"&&Be!==null&&Be.setDraggable(p)},[Be,p]),Z.useEffect(()=>{typeof v<"u"&&Be!==null&&Be.setEditable(v)},[Be,v]),Z.useEffect(()=>{typeof w<"u"&&Be!==null&&Be.setVisible(w)},[Be,w]),Z.useEffect(()=>{typeof c<"u"&&Be!==null&&Be.setBounds(c)},[Be,c]),Z.useEffect(()=>{Be&&A&&(We!==null&&google.maps.event.removeListener(We),ct(google.maps.event.addListener(Be,"dblclick",A)))},[A]),Z.useEffect(()=>{Be&&o&&(lt!==null&&google.maps.event.removeListener(lt),Pt(google.maps.event.addListener(Be,"dragend",o)))},[o]),Z.useEffect(()=>{Be&&D&&(zt!==null&&google.maps.event.removeListener(zt),_i(google.maps.event.addListener(Be,"dragstart",D)))},[D]),Z.useEffect(()=>{Be&&j&&(Ut!==null&&google.maps.event.removeListener(Ut),bi(google.maps.event.addListener(Be,"mousedown",j)))},[j]),Z.useEffect(()=>{Be&&J&&(vi!==null&&google.maps.event.removeListener(vi),ei(google.maps.event.addListener(Be,"mousemove",J)))},[J]),Z.useEffect(()=>{Be&&ie&&(si!==null&&google.maps.event.removeListener(si),Tt(google.maps.event.addListener(Be,"mouseout",ie)))},[ie]),Z.useEffect(()=>{Be&&re&&(Ht!==null&&google.maps.event.removeListener(Ht),Gt(google.maps.event.addListener(Be,"mouseover",re)))},[re]),Z.useEffect(()=>{Be&&he&&(hi!==null&&google.maps.event.removeListener(hi),Ft(google.maps.event.addListener(Be,"mouseup",he)))},[he]),Z.useEffect(()=>{Be&&ce&&(Ot!==null&&google.maps.event.removeListener(Ot),di(google.maps.event.addListener(Be,"rightclick",ce)))},[ce]),Z.useEffect(()=>{Be&&xe&&(wt!==null&&google.maps.event.removeListener(wt),sr(google.maps.event.addListener(Be,"click",xe)))},[xe]),Z.useEffect(()=>{Be&&Ee&&(pr!==null&&google.maps.event.removeListener(pr),Fi(google.maps.event.addListener(Be,"drag",Ee)))},[Ee]),Z.useEffect(()=>{Be&&ve&&(Si!==null&&google.maps.event.removeListener(Si),Qt(google.maps.event.addListener(Be,"bounds_changed",ve)))},[ve]),Z.useEffect(()=>{var Di=new google.maps.Rectangle(Cx(Cx({},r),{},{map:ke}));return typeof w<"u"&&Di.setVisible(w),typeof v<"u"&&Di.setEditable(v),typeof p<"u"&&Di.setDraggable(p),typeof c<"u"&&Di.setBounds(c),A&&ct(google.maps.event.addListener(Di,"dblclick",A)),o&&Pt(google.maps.event.addListener(Di,"dragend",o)),D&&_i(google.maps.event.addListener(Di,"dragstart",D)),j&&bi(google.maps.event.addListener(Di,"mousedown",j)),J&&ei(google.maps.event.addListener(Di,"mousemove",J)),ie&&Tt(google.maps.event.addListener(Di,"mouseout",ie)),re&&Gt(google.maps.event.addListener(Di,"mouseover",re)),he&&Ft(google.maps.event.addListener(Di,"mouseup",he)),ce&&di(google.maps.event.addListener(Di,"rightclick",ce)),xe&&sr(google.maps.event.addListener(Di,"click",xe)),Ee&&Fi(google.maps.event.addListener(Di,"drag",Ee)),ve&&Qt(google.maps.event.addListener(Di,"bounds_changed",ve)),Le(Di),K&&K(Di),()=>{We!==null&&google.maps.event.removeListener(We),lt!==null&&google.maps.event.removeListener(lt),zt!==null&&google.maps.event.removeListener(zt),Ut!==null&&google.maps.event.removeListener(Ut),vi!==null&&google.maps.event.removeListener(vi),si!==null&&google.maps.event.removeListener(si),Ht!==null&&google.maps.event.removeListener(Ht),hi!==null&&google.maps.event.removeListener(hi),Ot!==null&&google.maps.event.removeListener(Ot),wt!==null&&google.maps.event.removeListener(wt),pr!==null&&google.maps.event.removeListener(pr),Si!==null&&google.maps.event.removeListener(Si),fe&&fe(Di),Di.setMap(null)}},[]),null}Z.memo(jU);class NU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{rectangle:null}),It(this,"setRectangleCallback",()=>{this.state.rectangle!==null&&this.props.onLoad&&this.props.onLoad(this.state.rectangle)})}componentDidMount(){var r=new google.maps.Rectangle(Cx(Cx({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:$L,eventMap:VL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{rectangle:r}},this.setRectangleCallback)}componentDidUpdate(r){this.state.rectangle!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:$L,eventMap:VL,prevProps:r,nextProps:this.props,instance:this.state.rectangle}))}componentWillUnmount(){this.state.rectangle!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.rectangle),_r(this.registeredEvents),this.state.rectangle.setMap(null))}render(){return null}}It(NU,"contextType",rr);function GL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function kx(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?GL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):GL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var HL={onCenterChanged:"center_changed",onRadiusChanged:"radius_changed",onClick:"click",onDblClick:"dblclick",onDrag:"drag",onDragEnd:"dragend",onDragStart:"dragstart",onMouseDown:"mousedown",onMouseMove:"mousemove",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick"},WL={center(n,r){n.setCenter(r)},draggable(n,r){n.setDraggable(r)},editable(n,r){n.setEditable(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)},radius(n,r){n.setRadius(r)},visible(n,r){n.setVisible(r)}},UU={};function VU(n){var{options:r,center:c,radius:p,draggable:v,editable:w,visible:A,onDblClick:o,onDragEnd:D,onDragStart:j,onMouseDown:J,onMouseMove:ie,onMouseOut:re,onMouseOver:he,onMouseUp:ce,onRightClick:xe,onClick:Ee,onDrag:ve,onCenterChanged:K,onRadiusChanged:fe,onLoad:ke,onUnmount:Be}=n,Le=Z.useContext(rr),[We,ct]=Z.useState(null),[lt,Pt]=Z.useState(null),[zt,_i]=Z.useState(null),[Ut,bi]=Z.useState(null),[vi,ei]=Z.useState(null),[si,Tt]=Z.useState(null),[Ht,Gt]=Z.useState(null),[hi,Ft]=Z.useState(null),[Ot,di]=Z.useState(null),[wt,sr]=Z.useState(null),[pr,Fi]=Z.useState(null),[Si,Qt]=Z.useState(null),[Di,Pn]=Z.useState(null),[or,Ls]=Z.useState(null);return Z.useEffect(()=>{We!==null&&We.setMap(Le)},[Le]),Z.useEffect(()=>{typeof r<"u"&&We!==null&&We.setOptions(r)},[We,r]),Z.useEffect(()=>{typeof v<"u"&&We!==null&&We.setDraggable(v)},[We,v]),Z.useEffect(()=>{typeof w<"u"&&We!==null&&We.setEditable(w)},[We,w]),Z.useEffect(()=>{typeof A<"u"&&We!==null&&We.setVisible(A)},[We,A]),Z.useEffect(()=>{typeof p=="number"&&We!==null&&We.setRadius(p)},[We,p]),Z.useEffect(()=>{typeof c<"u"&&We!==null&&We.setCenter(c)},[We,c]),Z.useEffect(()=>{We&&o&&(lt!==null&&google.maps.event.removeListener(lt),Pt(google.maps.event.addListener(We,"dblclick",o)))},[o]),Z.useEffect(()=>{We&&D&&(zt!==null&&google.maps.event.removeListener(zt),_i(google.maps.event.addListener(We,"dragend",D)))},[D]),Z.useEffect(()=>{We&&j&&(Ut!==null&&google.maps.event.removeListener(Ut),bi(google.maps.event.addListener(We,"dragstart",j)))},[j]),Z.useEffect(()=>{We&&J&&(vi!==null&&google.maps.event.removeListener(vi),ei(google.maps.event.addListener(We,"mousedown",J)))},[J]),Z.useEffect(()=>{We&&ie&&(si!==null&&google.maps.event.removeListener(si),Tt(google.maps.event.addListener(We,"mousemove",ie)))},[ie]),Z.useEffect(()=>{We&&re&&(Ht!==null&&google.maps.event.removeListener(Ht),Gt(google.maps.event.addListener(We,"mouseout",re)))},[re]),Z.useEffect(()=>{We&&he&&(hi!==null&&google.maps.event.removeListener(hi),Ft(google.maps.event.addListener(We,"mouseover",he)))},[he]),Z.useEffect(()=>{We&&ce&&(Ot!==null&&google.maps.event.removeListener(Ot),di(google.maps.event.addListener(We,"mouseup",ce)))},[ce]),Z.useEffect(()=>{We&&xe&&(wt!==null&&google.maps.event.removeListener(wt),sr(google.maps.event.addListener(We,"rightclick",xe)))},[xe]),Z.useEffect(()=>{We&&Ee&&(pr!==null&&google.maps.event.removeListener(pr),Fi(google.maps.event.addListener(We,"click",Ee)))},[Ee]),Z.useEffect(()=>{We&&ve&&(Si!==null&&google.maps.event.removeListener(Si),Qt(google.maps.event.addListener(We,"drag",ve)))},[ve]),Z.useEffect(()=>{We&&K&&(Di!==null&&google.maps.event.removeListener(Di),Pn(google.maps.event.addListener(We,"center_changed",K)))},[Ee]),Z.useEffect(()=>{We&&fe&&(or!==null&&google.maps.event.removeListener(or),Ls(google.maps.event.addListener(We,"radius_changed",fe)))},[fe]),Z.useEffect(()=>{var ar=new google.maps.Circle(kx(kx({},r||UU),{},{map:Le}));return typeof p=="number"&&ar.setRadius(p),typeof c<"u"&&ar.setCenter(c),typeof p=="number"&&ar.setRadius(p),typeof A<"u"&&ar.setVisible(A),typeof w<"u"&&ar.setEditable(w),typeof v<"u"&&ar.setDraggable(v),o&&Pt(google.maps.event.addListener(ar,"dblclick",o)),D&&_i(google.maps.event.addListener(ar,"dragend",D)),j&&bi(google.maps.event.addListener(ar,"dragstart",j)),J&&ei(google.maps.event.addListener(ar,"mousedown",J)),ie&&Tt(google.maps.event.addListener(ar,"mousemove",ie)),re&&Gt(google.maps.event.addListener(ar,"mouseout",re)),he&&Ft(google.maps.event.addListener(ar,"mouseover",he)),ce&&di(google.maps.event.addListener(ar,"mouseup",ce)),xe&&sr(google.maps.event.addListener(ar,"rightclick",xe)),Ee&&Fi(google.maps.event.addListener(ar,"click",Ee)),ve&&Qt(google.maps.event.addListener(ar,"drag",ve)),K&&Pn(google.maps.event.addListener(ar,"center_changed",K)),fe&&Ls(google.maps.event.addListener(ar,"radius_changed",fe)),ct(ar),ke&&ke(ar),()=>{lt!==null&&google.maps.event.removeListener(lt),zt!==null&&google.maps.event.removeListener(zt),Ut!==null&&google.maps.event.removeListener(Ut),vi!==null&&google.maps.event.removeListener(vi),si!==null&&google.maps.event.removeListener(si),Ht!==null&&google.maps.event.removeListener(Ht),hi!==null&&google.maps.event.removeListener(hi),Ot!==null&&google.maps.event.removeListener(Ot),wt!==null&&google.maps.event.removeListener(wt),pr!==null&&google.maps.event.removeListener(pr),Di!==null&&google.maps.event.removeListener(Di),or!==null&&google.maps.event.removeListener(or),Be&&Be(ar),ar.setMap(null)}},[]),null}Z.memo(VU);class PD extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{circle:null}),It(this,"setCircleCallback",()=>{this.state.circle!==null&&this.props.onLoad&&this.props.onLoad(this.state.circle)})}componentDidMount(){var r=new google.maps.Circle(kx(kx({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:WL,eventMap:HL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{circle:r}},this.setCircleCallback)}componentDidUpdate(r){this.state.circle!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:WL,eventMap:HL,prevProps:r,nextProps:this.props,instance:this.state.circle}))}componentWillUnmount(){if(this.state.circle!==null){var r;this.props.onUnmount&&this.props.onUnmount(this.state.circle),_r(this.registeredEvents),(r=this.state.circle)===null||r===void 0||r.setMap(null)}}render(){return null}}It(PD,"contextType",rr);function qL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Lx(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?qL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):qL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var ZL={onClick:"click",onDblClick:"dblclick",onMouseDown:"mousedown",onMouseOut:"mouseout",onMouseOver:"mouseover",onMouseUp:"mouseup",onRightClick:"rightclick",onAddFeature:"addfeature",onRemoveFeature:"removefeature",onRemoveProperty:"removeproperty",onSetGeometry:"setgeometry",onSetProperty:"setproperty"},XL={add(n,r){n.add(r)},addgeojson(n,r,c){n.addGeoJson(r,c)},contains(n,r){n.contains(r)},foreach(n,r){n.forEach(r)},loadgeojson(n,r,c,p){n.loadGeoJson(r,c,p)},overridestyle(n,r,c){n.overrideStyle(r,c)},remove(n,r){n.remove(r)},revertstyle(n,r){n.revertStyle(r)},controlposition(n,r){n.setControlPosition(r)},controls(n,r){n.setControls(r)},drawingmode(n,r){n.setDrawingMode(r)},map(n,r){n.setMap(r)},style(n,r){n.setStyle(r)},togeojson(n,r){n.toGeoJson(r)}};function $U(n){var{options:r,onClick:c,onDblClick:p,onMouseDown:v,onMouseMove:w,onMouseOut:A,onMouseOver:o,onMouseUp:D,onRightClick:j,onAddFeature:J,onRemoveFeature:ie,onRemoveProperty:re,onSetGeometry:he,onSetProperty:ce,onLoad:xe,onUnmount:Ee}=n,ve=Z.useContext(rr),[K,fe]=Z.useState(null),[ke,Be]=Z.useState(null),[Le,We]=Z.useState(null),[ct,lt]=Z.useState(null),[Pt,zt]=Z.useState(null),[_i,Ut]=Z.useState(null),[bi,vi]=Z.useState(null),[ei,si]=Z.useState(null),[Tt,Ht]=Z.useState(null),[Gt,hi]=Z.useState(null),[Ft,Ot]=Z.useState(null),[di,wt]=Z.useState(null),[sr,pr]=Z.useState(null),[Fi,Si]=Z.useState(null);return Z.useEffect(()=>{K!==null&&K.setMap(ve)},[ve]),Z.useEffect(()=>{K&&p&&(ke!==null&&google.maps.event.removeListener(ke),Be(google.maps.event.addListener(K,"dblclick",p)))},[p]),Z.useEffect(()=>{K&&v&&(Le!==null&&google.maps.event.removeListener(Le),We(google.maps.event.addListener(K,"mousedown",v)))},[v]),Z.useEffect(()=>{K&&w&&(ct!==null&&google.maps.event.removeListener(ct),lt(google.maps.event.addListener(K,"mousemove",w)))},[w]),Z.useEffect(()=>{K&&A&&(Pt!==null&&google.maps.event.removeListener(Pt),zt(google.maps.event.addListener(K,"mouseout",A)))},[A]),Z.useEffect(()=>{K&&o&&(_i!==null&&google.maps.event.removeListener(_i),Ut(google.maps.event.addListener(K,"mouseover",o)))},[o]),Z.useEffect(()=>{K&&D&&(bi!==null&&google.maps.event.removeListener(bi),vi(google.maps.event.addListener(K,"mouseup",D)))},[D]),Z.useEffect(()=>{K&&j&&(ei!==null&&google.maps.event.removeListener(ei),si(google.maps.event.addListener(K,"rightclick",j)))},[j]),Z.useEffect(()=>{K&&c&&(Tt!==null&&google.maps.event.removeListener(Tt),Ht(google.maps.event.addListener(K,"click",c)))},[c]),Z.useEffect(()=>{K&&J&&(Gt!==null&&google.maps.event.removeListener(Gt),hi(google.maps.event.addListener(K,"addfeature",J)))},[J]),Z.useEffect(()=>{K&&ie&&(Ft!==null&&google.maps.event.removeListener(Ft),Ot(google.maps.event.addListener(K,"removefeature",ie)))},[ie]),Z.useEffect(()=>{K&&re&&(di!==null&&google.maps.event.removeListener(di),wt(google.maps.event.addListener(K,"removeproperty",re)))},[re]),Z.useEffect(()=>{K&&he&&(sr!==null&&google.maps.event.removeListener(sr),pr(google.maps.event.addListener(K,"setgeometry",he)))},[he]),Z.useEffect(()=>{K&&ce&&(Fi!==null&&google.maps.event.removeListener(Fi),Si(google.maps.event.addListener(K,"setproperty",ce)))},[ce]),Z.useEffect(()=>{if(ve!==null){var Qt=new google.maps.Data(Lx(Lx({},r),{},{map:ve}));p&&Be(google.maps.event.addListener(Qt,"dblclick",p)),v&&We(google.maps.event.addListener(Qt,"mousedown",v)),w&&lt(google.maps.event.addListener(Qt,"mousemove",w)),A&&zt(google.maps.event.addListener(Qt,"mouseout",A)),o&&Ut(google.maps.event.addListener(Qt,"mouseover",o)),D&&vi(google.maps.event.addListener(Qt,"mouseup",D)),j&&si(google.maps.event.addListener(Qt,"rightclick",j)),c&&Ht(google.maps.event.addListener(Qt,"click",c)),J&&hi(google.maps.event.addListener(Qt,"addfeature",J)),ie&&Ot(google.maps.event.addListener(Qt,"removefeature",ie)),re&&wt(google.maps.event.addListener(Qt,"removeproperty",re)),he&&pr(google.maps.event.addListener(Qt,"setgeometry",he)),ce&&Si(google.maps.event.addListener(Qt,"setproperty",ce)),fe(Qt),xe&&xe(Qt)}return()=>{K&&(ke!==null&&google.maps.event.removeListener(ke),Le!==null&&google.maps.event.removeListener(Le),ct!==null&&google.maps.event.removeListener(ct),Pt!==null&&google.maps.event.removeListener(Pt),_i!==null&&google.maps.event.removeListener(_i),bi!==null&&google.maps.event.removeListener(bi),ei!==null&&google.maps.event.removeListener(ei),Tt!==null&&google.maps.event.removeListener(Tt),Gt!==null&&google.maps.event.removeListener(Gt),Ft!==null&&google.maps.event.removeListener(Ft),di!==null&&google.maps.event.removeListener(di),sr!==null&&google.maps.event.removeListener(sr),Fi!==null&&google.maps.event.removeListener(Fi),Ee&&Ee(K),K.setMap(null))}},[]),null}Z.memo($U);class GU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{data:null}),It(this,"setDataCallback",()=>{this.state.data!==null&&this.props.onLoad&&this.props.onLoad(this.state.data)})}componentDidMount(){if(this.context!==null){var r=new google.maps.Data(Lx(Lx({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:XL,eventMap:ZL,prevProps:{},nextProps:this.props,instance:r}),this.setState(()=>({data:r}),this.setDataCallback)}}componentDidUpdate(r){this.state.data!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:XL,eventMap:ZL,prevProps:r,nextProps:this.props,instance:this.state.data}))}componentWillUnmount(){this.state.data!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.data),_r(this.registeredEvents),this.state.data&&this.state.data.setMap(null))}render(){return null}}It(GU,"contextType",rr);function KL(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function YL(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?KL(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):KL(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var JL={onClick:"click",onDefaultViewportChanged:"defaultviewport_changed",onStatusChanged:"status_changed"},QL={options(n,r){n.setOptions(r)},url(n,r){n.setUrl(r)},zIndex(n,r){n.setZIndex(r)}};class HU extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{kmlLayer:null}),It(this,"setKmlLayerCallback",()=>{this.state.kmlLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.kmlLayer)})}componentDidMount(){var r=new google.maps.KmlLayer(YL(YL({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:QL,eventMap:JL,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{kmlLayer:r}},this.setKmlLayerCallback)}componentDidUpdate(r){this.state.kmlLayer!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:QL,eventMap:JL,prevProps:r,nextProps:this.props,instance:this.state.kmlLayer}))}componentWillUnmount(){this.state.kmlLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.kmlLayer),_r(this.registeredEvents),this.state.kmlLayer.setMap(null))}render(){return null}}It(HU,"contextType",rr);function MD(n,r){return typeof r=="function"?r(n.offsetWidth,n.offsetHeight):{x:0,y:0}}function WU(n,r){return new r(n.lat,n.lng)}function qU(n,r){return new r(new google.maps.LatLng(n.ne.lat,n.ne.lng),new google.maps.LatLng(n.sw.lat,n.sw.lng))}function ZU(n,r,c){return n instanceof r?n:c(n,r)}function XU(n,r,c){return n instanceof r?n:c(n,r)}function KU(n,r,c){var p=n&&n.fromLatLngToDivPixel(c.getNorthEast()),v=n&&n.fromLatLngToDivPixel(c.getSouthWest());return p&&v?{left:"".concat(v.x+r.x,"px"),top:"".concat(p.y+r.y,"px"),width:"".concat(p.x-v.x-r.x,"px"),height:"".concat(v.y-p.y-r.y,"px")}:{left:"-9999px",top:"-9999px"}}function YU(n,r,c){var p=n&&n.fromLatLngToDivPixel(c);if(p){var{x:v,y:w}=p;return{left:"".concat(v+r.x,"px"),top:"".concat(w+r.y,"px")}}return{left:"-9999px",top:"-9999px"}}function RD(n,r,c,p){return c!==void 0?KU(n,r,XU(c,google.maps.LatLngBounds,qU)):YU(n,r,ZU(p,google.maps.LatLng,WU))}function JU(n,r){return n.left===r.left&&n.top===r.top&&n.width===r.height&&n.height===r.height}function eP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function QU(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?eP(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):eP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}function e6(n,r,c,p,v){class w extends google.maps.OverlayView{constructor(o,D,j,J){super(),this.container=o,this.pane=D,this.position=j,this.bounds=J}onAdd(){var o,D=(o=this.getPanes())===null||o===void 0?void 0:o[this.pane];D==null||D.appendChild(this.container)}draw(){var o=this.getProjection(),D=QU({},this.container?MD(this.container,v):{x:0,y:0}),j=RD(o,D,this.bounds,this.position);for(var[J,ie]of Object.entries(j))this.container.style[J]=ie}onRemove(){this.container.parentNode!==null&&this.container.parentNode.removeChild(this.container)}}return new w(n,r,c,p)}function tP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function t6(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?tP(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):tP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}function iP(n){if(!n)return"";var r=n instanceof google.maps.LatLng?n:new google.maps.LatLng(n.lat,n.lng);return r+""}function rP(n){if(!n)return"";var r=n instanceof google.maps.LatLngBounds?n:new google.maps.LatLngBounds(new google.maps.LatLng(n.south,n.east),new google.maps.LatLng(n.north,n.west));return r+""}function i6(n){var{position:r,bounds:c,mapPaneName:p,zIndex:v,onLoad:w,onUnmount:A,getPixelPositionOffset:o,children:D}=n,j=Z.useContext(rr),J=Z.useMemo(()=>{var re=document.createElement("div");return re.style.position="absolute",re},[]),ie=Z.useMemo(()=>e6(J,p,r,c,o),[J,p,r,c]);return Z.useEffect(()=>(w==null||w(ie),ie==null||ie.setMap(j),()=>{A==null||A(ie),ie==null||ie.setMap(null)}),[j,ie]),Z.useEffect(()=>{J.style.zIndex="".concat(v)},[v,J]),ed.createPortal(D,J)}Z.memo(i6);class vp extends Z.PureComponent{constructor(r){super(r),It(this,"state",{paneEl:null,containerStyle:{position:"absolute"}}),It(this,"updatePane",()=>{var p=this.props.mapPaneName,v=this.overlayView.getPanes();Qn(!!p,"OverlayView requires props.mapPaneName but got %s",p),v?this.setState({paneEl:v[p]}):this.setState({paneEl:null})}),It(this,"onAdd",()=>{var p,v;this.updatePane(),(p=(v=this.props).onLoad)===null||p===void 0||p.call(v,this.overlayView)}),It(this,"onPositionElement",()=>{var p=this.overlayView.getProjection(),v=t6({x:0,y:0},this.containerRef.current?MD(this.containerRef.current,this.props.getPixelPositionOffset):{}),w=RD(p,v,this.props.bounds,this.props.position);if(!JU(w,{left:this.state.containerStyle.left,top:this.state.containerStyle.top,width:this.state.containerStyle.width,height:this.state.containerStyle.height})){var A,o,D,j;this.setState({containerStyle:{top:(A=w.top)!==null&&A!==void 0?A:0,left:(o=w.left)!==null&&o!==void 0?o:0,width:(D=w.width)!==null&&D!==void 0?D:0,height:(j=w.height)!==null&&j!==void 0?j:0,position:"absolute"}})}}),It(this,"draw",()=>{this.onPositionElement()}),It(this,"onRemove",()=>{var p,v;this.setState(()=>({paneEl:null})),(p=(v=this.props).onUnmount)===null||p===void 0||p.call(v,this.overlayView)}),this.containerRef=Z.createRef();var c=new google.maps.OverlayView;c.onAdd=this.onAdd,c.draw=this.draw,c.onRemove=this.onRemove,this.overlayView=c}componentDidMount(){this.overlayView.setMap(this.context)}componentDidUpdate(r){var c=iP(r.position),p=iP(this.props.position),v=rP(r.bounds),w=rP(this.props.bounds);(c!==p||v!==w)&&this.overlayView.draw(),r.mapPaneName!==this.props.mapPaneName&&this.updatePane()}componentWillUnmount(){this.overlayView.setMap(null)}render(){var r=this.state.paneEl;return r?ed.createPortal(N.jsx("div",{ref:this.containerRef,style:this.state.containerStyle,children:Z.Children.only(this.props.children)}),r):null}}It(vp,"FLOAT_PANE","floatPane");It(vp,"MAP_PANE","mapPane");It(vp,"MARKER_LAYER","markerLayer");It(vp,"OVERLAY_LAYER","overlayLayer");It(vp,"OVERLAY_MOUSE_TARGET","overlayMouseTarget");It(vp,"contextType",rr);function r6(){}function nP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function sP(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?nP(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):nP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var oP={onDblClick:"dblclick",onClick:"click"},aP={opacity(n,r){n.setOpacity(r)}};function n6(n){var{url:r,bounds:c,options:p,visible:v}=n,w=Z.useContext(rr),A=new google.maps.LatLngBounds(new google.maps.LatLng(c.south,c.west),new google.maps.LatLng(c.north,c.east)),o=Z.useMemo(()=>new google.maps.GroundOverlay(r,A,p),[]);return Z.useEffect(()=>{o!==null&&o.setMap(w)},[w]),Z.useEffect(()=>{typeof r<"u"&&o!==null&&(o.set("url",r),o.setMap(w))},[o,r]),Z.useEffect(()=>{typeof v<"u"&&o!==null&&o.setOpacity(v?1:0)},[o,v]),Z.useEffect(()=>{var D=new google.maps.LatLngBounds(new google.maps.LatLng(c.south,c.west),new google.maps.LatLng(c.north,c.east));typeof c<"u"&&o!==null&&(o.set("bounds",D),o.setMap(w))},[o,c]),null}Z.memo(n6);class DD extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{groundOverlay:null}),It(this,"setGroundOverlayCallback",()=>{this.state.groundOverlay!==null&&this.props.onLoad&&this.props.onLoad(this.state.groundOverlay)})}componentDidMount(){Qn(!!this.props.url||!!this.props.bounds,"For GroundOverlay, url and bounds are passed in to constructor and are immutable after instantiated. This is the behavior of Google Maps JavaScript API v3 ( See https://developers.google.com/maps/documentation/javascript/reference#GroundOverlay) Hence, use the corresponding two props provided by `react-google-maps-api`, url and bounds. In some cases, you'll need the GroundOverlay component to reflect the changes of url and bounds. You can leverage the React's key property to remount the component. Typically, just `key={url}` would serve your need. See https://github.com/tomchentw/react-google-maps/issues/655");var r=new google.maps.GroundOverlay(this.props.url,this.props.bounds,sP(sP({},this.props.options),{},{map:this.context}));this.registeredEvents=fr({updaterMap:aP,eventMap:oP,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{groundOverlay:r}},this.setGroundOverlayCallback)}componentDidUpdate(r){this.state.groundOverlay!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:aP,eventMap:oP,prevProps:r,nextProps:this.props,instance:this.state.groundOverlay}))}componentWillUnmount(){this.state.groundOverlay&&(this.props.onUnmount&&this.props.onUnmount(this.state.groundOverlay),this.state.groundOverlay.setMap(null))}render(){return null}}It(DD,"defaultProps",{onLoad:r6});It(DD,"contextType",rr);function lP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Px(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?lP(Object(c),!0).forEach(function(p){It(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):lP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}var cP={},uP={data(n,r){n.setData(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)}};function s6(n){var{data:r,onLoad:c,onUnmount:p,options:v}=n,w=Z.useContext(rr),[A,o]=Z.useState(null);return Z.useEffect(()=>{google.maps.visualization||Qn(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} in useJsApiScript? %s',google.maps.visualization)},[]),Z.useEffect(()=>{Qn(!!r,"data property is required in HeatmapLayer %s",r)},[r]),Z.useEffect(()=>{A!==null&&A.setMap(w)},[w]),Z.useEffect(()=>{v&&A!==null&&A.setOptions(v)},[A,v]),Z.useEffect(()=>{var D=new google.maps.visualization.HeatmapLayer(Px(Px({},v),{},{data:r,map:w}));return o(D),c&&c(D),()=>{A!==null&&(p&&p(A),A.setMap(null))}},[]),null}Z.memo(s6);class o6 extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{heatmapLayer:null}),It(this,"setHeatmapLayerCallback",()=>{this.state.heatmapLayer!==null&&this.props.onLoad&&this.props.onLoad(this.state.heatmapLayer)})}componentDidMount(){Qn(!!google.maps.visualization,'Did you include prop libraries={["visualization"]} to <LoadScript />? %s',google.maps.visualization),Qn(!!this.props.data,"data property is required in HeatmapLayer %s",this.props.data);var r=new google.maps.visualization.HeatmapLayer(Px(Px({},this.props.options),{},{data:this.props.data,map:this.context}));this.registeredEvents=fr({updaterMap:uP,eventMap:cP,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{heatmapLayer:r}},this.setHeatmapLayerCallback)}componentDidUpdate(r){_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:uP,eventMap:cP,prevProps:r,nextProps:this.props,instance:this.state.heatmapLayer})}componentWillUnmount(){this.state.heatmapLayer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.heatmapLayer),_r(this.registeredEvents),this.state.heatmapLayer.setMap(null))}render(){return null}}It(o6,"contextType",rr);var hP={onCloseClick:"closeclick",onPanoChanged:"pano_changed",onPositionChanged:"position_changed",onPovChanged:"pov_changed",onResize:"resize",onStatusChanged:"status_changed",onVisibleChanged:"visible_changed",onZoomChanged:"zoom_changed"},dP={register(n,r,c){n.registerPanoProvider(r,c)},links(n,r){n.setLinks(r)},motionTracking(n,r){n.setMotionTracking(r)},options(n,r){n.setOptions(r)},pano(n,r){n.setPano(r)},position(n,r){n.setPosition(r)},pov(n,r){n.setPov(r)},visible(n,r){n.setVisible(r)},zoom(n,r){n.setZoom(r)}};class a6 extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{streetViewPanorama:null}),It(this,"setStreetViewPanoramaCallback",()=>{this.state.streetViewPanorama!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewPanorama)})}componentDidMount(){var r,c,p=(r=(c=this.context)===null||c===void 0?void 0:c.getStreetView())!==null&&r!==void 0?r:null;this.registeredEvents=fr({updaterMap:dP,eventMap:hP,prevProps:{},nextProps:this.props,instance:p}),this.setState(()=>({streetViewPanorama:p}),this.setStreetViewPanoramaCallback)}componentDidUpdate(r){this.state.streetViewPanorama!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:dP,eventMap:hP,prevProps:r,nextProps:this.props,instance:this.state.streetViewPanorama}))}componentWillUnmount(){this.state.streetViewPanorama!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.streetViewPanorama),_r(this.registeredEvents),this.state.streetViewPanorama.setVisible(!1))}render(){return null}}It(a6,"contextType",rr);class l6 extends Z.PureComponent{constructor(){super(...arguments),It(this,"state",{streetViewService:null}),It(this,"setStreetViewServiceCallback",()=>{this.state.streetViewService!==null&&this.props.onLoad&&this.props.onLoad(this.state.streetViewService)})}componentDidMount(){var r=new google.maps.StreetViewService;this.setState(function(){return{streetViewService:r}},this.setStreetViewServiceCallback)}componentWillUnmount(){this.state.streetViewService!==null&&this.props.onUnmount&&this.props.onUnmount(this.state.streetViewService)}render(){return null}}It(l6,"contextType",rr);var fP={onDirectionsChanged:"directions_changed"},pP={directions(n,r){n.setDirections(r)},map(n,r){n.setMap(r)},options(n,r){n.setOptions(r)},panel(n,r){n.setPanel(r)},routeIndex(n,r){n.setRouteIndex(r)}};class c6 extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"state",{directionsRenderer:null}),It(this,"setDirectionsRendererCallback",()=>{this.state.directionsRenderer!==null&&(this.state.directionsRenderer.setMap(this.context),this.props.onLoad&&this.props.onLoad(this.state.directionsRenderer))})}componentDidMount(){var r=new google.maps.DirectionsRenderer(this.props.options);this.registeredEvents=fr({updaterMap:pP,eventMap:fP,prevProps:{},nextProps:this.props,instance:r}),this.setState(function(){return{directionsRenderer:r}},this.setDirectionsRendererCallback)}componentDidUpdate(r){this.state.directionsRenderer!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:pP,eventMap:fP,prevProps:r,nextProps:this.props,instance:this.state.directionsRenderer}))}componentWillUnmount(){this.state.directionsRenderer!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.directionsRenderer),_r(this.registeredEvents),this.state.directionsRenderer&&this.state.directionsRenderer.setMap(null))}render(){return null}}It(c6,"contextType",rr);var mP={onPlacesChanged:"places_changed"},gP={bounds(n,r){n.setBounds(r)}};class u6 extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"containerElement",Z.createRef()),It(this,"state",{searchBox:null}),It(this,"setSearchBoxCallback",()=>{this.state.searchBox!==null&&this.props.onLoad&&this.props.onLoad(this.state.searchBox)})}componentDidMount(){if(Qn(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places),this.containerElement!==null&&this.containerElement.current!==null){var r=this.containerElement.current.querySelector("input");if(r!==null){var c=new google.maps.places.SearchBox(r,this.props.options);this.registeredEvents=fr({updaterMap:gP,eventMap:mP,prevProps:{},nextProps:this.props,instance:c}),this.setState(function(){return{searchBox:c}},this.setSearchBoxCallback)}}}componentDidUpdate(r){this.state.searchBox!==null&&(_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:gP,eventMap:mP,prevProps:r,nextProps:this.props,instance:this.state.searchBox}))}componentWillUnmount(){this.state.searchBox!==null&&(this.props.onUnmount&&this.props.onUnmount(this.state.searchBox),_r(this.registeredEvents))}render(){return N.jsx("div",{ref:this.containerElement,children:Z.Children.only(this.props.children)})}}It(u6,"contextType",rr);var _P={onPlaceChanged:"place_changed"},yP={bounds(n,r){n.setBounds(r)},restrictions(n,r){n.setComponentRestrictions(r)},fields(n,r){n.setFields(r)},options(n,r){n.setOptions(r)},types(n,r){n.setTypes(r)}};class OD extends Z.PureComponent{constructor(){super(...arguments),It(this,"registeredEvents",[]),It(this,"containerElement",Z.createRef()),It(this,"state",{autocomplete:null}),It(this,"setAutocompleteCallback",()=>{this.state.autocomplete!==null&&this.props.onLoad&&this.props.onLoad(this.state.autocomplete)})}componentDidMount(){var r;Qn(!!google.maps.places,'You need to provide libraries={["places"]} prop to <LoadScript /> component %s',google.maps.places);var c=(r=this.containerElement.current)===null||r===void 0?void 0:r.querySelector("input");if(c){var p=new google.maps.places.Autocomplete(c,this.props.options);this.registeredEvents=fr({updaterMap:yP,eventMap:_P,prevProps:{},nextProps:this.props,instance:p}),this.setState(()=>({autocomplete:p}),this.setAutocompleteCallback)}}componentDidUpdate(r){_r(this.registeredEvents),this.registeredEvents=fr({updaterMap:yP,eventMap:_P,prevProps:r,nextProps:this.props,instance:this.state.autocomplete})}componentWillUnmount(){this.state.autocomplete!==null&&_r(this.registeredEvents)}render(){return N.jsx("div",{ref:this.containerElement,className:this.props.className,children:Z.Children.only(this.props.children)})}}It(OD,"defaultProps",{className:""});It(OD,"contextType",rr);function i1(n,r){var c={};for(var p in n)Object.prototype.hasOwnProperty.call(n,p)&&r.indexOf(p)<0&&(c[p]=n[p]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var v=0,p=Object.getOwnPropertySymbols(n);v<p.length;v++)r.indexOf(p[v])<0&&Object.prototype.propertyIsEnumerable.call(n,p[v])&&(c[p[v]]=n[p[v]]);return c}function h6(n,r,c,p){function v(w){return w instanceof c?w:new c(function(A){A(w)})}return new(c||(c=Promise))(function(w,A){function o(J){try{j(p.next(J))}catch(ie){A(ie)}}function D(J){try{j(p.throw(J))}catch(ie){A(ie)}}function j(J){J.done?w(J.value):v(J.value).then(o,D)}j((p=p.apply(n,r||[])).next())})}const d6=n=>n?(...r)=>n(...r):(...r)=>fetch(...r);class w2 extends Error{constructor(r,c="FunctionsError",p){super(r),this.name=c,this.context=p}}class f6 extends w2{constructor(r){super("Failed to send a request to the Edge Function","FunctionsFetchError",r)}}class vP extends w2{constructor(r){super("Relay Error invoking the Edge Function","FunctionsRelayError",r)}}class xP extends w2{constructor(r){super("Edge Function returned a non-2xx status code","FunctionsHttpError",r)}}var aT;(function(n){n.Any="any",n.ApNortheast1="ap-northeast-1",n.ApNortheast2="ap-northeast-2",n.ApSouth1="ap-south-1",n.ApSoutheast1="ap-southeast-1",n.ApSoutheast2="ap-southeast-2",n.CaCentral1="ca-central-1",n.EuCentral1="eu-central-1",n.EuWest1="eu-west-1",n.EuWest2="eu-west-2",n.EuWest3="eu-west-3",n.SaEast1="sa-east-1",n.UsEast1="us-east-1",n.UsWest1="us-west-1",n.UsWest2="us-west-2"})(aT||(aT={}));class p6{constructor(r,{headers:c={},customFetch:p,region:v=aT.Any}={}){this.url=r,this.headers=c,this.region=v,this.fetch=d6(p)}setAuth(r){this.headers.Authorization=`Bearer ${r}`}invoke(r){return h6(this,arguments,void 0,function*(c,p={}){var v;let w,A;try{const{headers:o,method:D,body:j,signal:J,timeout:ie}=p;let re={},{region:he}=p;he||(he=this.region);const ce=new URL(`${this.url}/${c}`);he&&he!=="any"&&(re["x-region"]=he,ce.searchParams.set("forceFunctionRegion",he));let xe;j&&(o&&!Object.prototype.hasOwnProperty.call(o,"Content-Type")||!o)?typeof Blob<"u"&&j instanceof Blob||j instanceof ArrayBuffer?(re["Content-Type"]="application/octet-stream",xe=j):typeof j=="string"?(re["Content-Type"]="text/plain",xe=j):typeof FormData<"u"&&j instanceof FormData?xe=j:(re["Content-Type"]="application/json",xe=JSON.stringify(j)):j&&typeof j!="string"&&!(typeof Blob<"u"&&j instanceof Blob)&&!(j instanceof ArrayBuffer)&&!(typeof FormData<"u"&&j instanceof FormData)?xe=JSON.stringify(j):xe=j;let Ee=J;ie&&(A=new AbortController,w=setTimeout(()=>A.abort(),ie),J?(Ee=A.signal,J.addEventListener("abort",()=>A.abort())):Ee=A.signal);const ve=yield this.fetch(ce.toString(),{method:D||"POST",headers:Object.assign(Object.assign(Object.assign({},re),this.headers),o),body:xe,signal:Ee}).catch(Be=>{throw new f6(Be)}),K=ve.headers.get("x-relay-error");if(K&&K==="true")throw new vP(ve);if(!ve.ok)throw new xP(ve);let fe=((v=ve.headers.get("Content-Type"))!==null&&v!==void 0?v:"text/plain").split(";")[0].trim(),ke;return fe==="application/json"?ke=yield ve.json():fe==="application/octet-stream"||fe==="application/pdf"?ke=yield ve.blob():fe==="text/event-stream"?ke=ve:fe==="multipart/form-data"?ke=yield ve.formData():ke=yield ve.text(),{data:ke,error:null,response:ve}}catch(o){return{data:null,error:o,response:o instanceof xP||o instanceof vP?o.context:void 0}}finally{w&&clearTimeout(w)}})}}var m6=class extends Error{constructor(n){super(n.message),this.name="PostgrestError",this.details=n.details,this.hint=n.hint,this.code=n.code}},g6=class{constructor(n){var r,c;this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=new Headers(n.headers),this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=(r=n.shouldThrowOnError)!==null&&r!==void 0?r:!1,this.signal=n.signal,this.isMaybeSingle=(c=n.isMaybeSingle)!==null&&c!==void 0?c:!1,n.fetch?this.fetch=n.fetch:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,r){return this.headers=new Headers(this.headers),this.headers.set(n,r),this}then(n,r){var c=this;this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers.set("Accept-Profile",this.schema):this.headers.set("Content-Profile",this.schema)),this.method!=="GET"&&this.method!=="HEAD"&&this.headers.set("Content-Type","application/json");const p=this.fetch;let v=p(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async w=>{let A=null,o=null,D=null,j=w.status,J=w.statusText;if(w.ok){var ie,re;if(c.method!=="HEAD"){var he;const ve=await w.text();ve===""||(c.headers.get("Accept")==="text/csv"||c.headers.get("Accept")&&(!((he=c.headers.get("Accept"))===null||he===void 0)&&he.includes("application/vnd.pgrst.plan+text"))?o=ve:o=JSON.parse(ve))}const xe=(ie=c.headers.get("Prefer"))===null||ie===void 0?void 0:ie.match(/count=(exact|planned|estimated)/),Ee=(re=w.headers.get("content-range"))===null||re===void 0?void 0:re.split("/");xe&&Ee&&Ee.length>1&&(D=parseInt(Ee[1])),c.isMaybeSingle&&c.method==="GET"&&Array.isArray(o)&&(o.length>1?(A={code:"PGRST116",details:`Results contain ${o.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},o=null,D=null,j=406,J="Not Acceptable"):o.length===1?o=o[0]:o=null)}else{var ce;const xe=await w.text();try{A=JSON.parse(xe),Array.isArray(A)&&w.status===404&&(o=[],A=null,j=200,J="OK")}catch{w.status===404&&xe===""?(j=204,J="No Content"):A={message:xe}}if(A&&c.isMaybeSingle&&(!(A==null||(ce=A.details)===null||ce===void 0)&&ce.includes("0 rows"))&&(A=null,j=200,J="OK"),A&&c.shouldThrowOnError)throw new m6(A)}return{error:A,data:o,count:D,status:j,statusText:J}});return this.shouldThrowOnError||(v=v.catch(w=>{var A;let o="";const D=w==null?void 0:w.cause;if(D){var j,J,ie,re;const ce=(j=D==null?void 0:D.message)!==null&&j!==void 0?j:"",xe=(J=D==null?void 0:D.code)!==null&&J!==void 0?J:"";o=`${(ie=w==null?void 0:w.name)!==null&&ie!==void 0?ie:"FetchError"}: ${w==null?void 0:w.message}`,o+=`

Caused by: ${(re=D==null?void 0:D.name)!==null&&re!==void 0?re:"Error"}: ${ce}`,xe&&(o+=` (${xe})`),D!=null&&D.stack&&(o+=`
${D.stack}`)}else{var he;o=(he=w==null?void 0:w.stack)!==null&&he!==void 0?he:""}return{error:{message:`${(A=w==null?void 0:w.name)!==null&&A!==void 0?A:"FetchError"}: ${w==null?void 0:w.message}`,details:o,hint:"",code:""},data:null,count:null,status:0,statusText:""}})),v.then(n,r)}returns(){return this}overrideTypes(){return this}},_6=class extends g6{select(n){let r=!1;const c=(n??"*").split("").map(p=>/\s/.test(p)&&!r?"":(p==='"'&&(r=!r),p)).join("");return this.url.searchParams.set("select",c),this.headers.append("Prefer","return=representation"),this}order(n,{ascending:r=!0,nullsFirst:c,foreignTable:p,referencedTable:v=p}={}){const w=v?`${v}.order`:"order",A=this.url.searchParams.get(w);return this.url.searchParams.set(w,`${A?`${A},`:""}${n}.${r?"asc":"desc"}${c===void 0?"":c?".nullsfirst":".nullslast"}`),this}limit(n,{foreignTable:r,referencedTable:c=r}={}){const p=typeof c>"u"?"limit":`${c}.limit`;return this.url.searchParams.set(p,`${n}`),this}range(n,r,{foreignTable:c,referencedTable:p=c}={}){const v=typeof p>"u"?"offset":`${p}.offset`,w=typeof p>"u"?"limit":`${p}.limit`;return this.url.searchParams.set(v,`${n}`),this.url.searchParams.set(w,`${r-n+1}`),this}abortSignal(n){return this.signal=n,this}single(){return this.headers.set("Accept","application/vnd.pgrst.object+json"),this}maybeSingle(){return this.method==="GET"?this.headers.set("Accept","application/json"):this.headers.set("Accept","application/vnd.pgrst.object+json"),this.isMaybeSingle=!0,this}csv(){return this.headers.set("Accept","text/csv"),this}geojson(){return this.headers.set("Accept","application/geo+json"),this}explain({analyze:n=!1,verbose:r=!1,settings:c=!1,buffers:p=!1,wal:v=!1,format:w="text"}={}){var A;const o=[n?"analyze":null,r?"verbose":null,c?"settings":null,p?"buffers":null,v?"wal":null].filter(Boolean).join("|"),D=(A=this.headers.get("Accept"))!==null&&A!==void 0?A:"application/json";return this.headers.set("Accept",`application/vnd.pgrst.plan+${w}; for="${D}"; options=${o};`),w==="json"?this:this}rollback(){return this.headers.append("Prefer","tx=rollback"),this}returns(){return this}maxAffected(n){return this.headers.append("Prefer","handling=strict"),this.headers.append("Prefer",`max-affected=${n}`),this}};const bP=new RegExp("[,()]");var Df=class extends _6{eq(n,r){return this.url.searchParams.append(n,`eq.${r}`),this}neq(n,r){return this.url.searchParams.append(n,`neq.${r}`),this}gt(n,r){return this.url.searchParams.append(n,`gt.${r}`),this}gte(n,r){return this.url.searchParams.append(n,`gte.${r}`),this}lt(n,r){return this.url.searchParams.append(n,`lt.${r}`),this}lte(n,r){return this.url.searchParams.append(n,`lte.${r}`),this}like(n,r){return this.url.searchParams.append(n,`like.${r}`),this}likeAllOf(n,r){return this.url.searchParams.append(n,`like(all).{${r.join(",")}}`),this}likeAnyOf(n,r){return this.url.searchParams.append(n,`like(any).{${r.join(",")}}`),this}ilike(n,r){return this.url.searchParams.append(n,`ilike.${r}`),this}ilikeAllOf(n,r){return this.url.searchParams.append(n,`ilike(all).{${r.join(",")}}`),this}ilikeAnyOf(n,r){return this.url.searchParams.append(n,`ilike(any).{${r.join(",")}}`),this}regexMatch(n,r){return this.url.searchParams.append(n,`match.${r}`),this}regexIMatch(n,r){return this.url.searchParams.append(n,`imatch.${r}`),this}is(n,r){return this.url.searchParams.append(n,`is.${r}`),this}isDistinct(n,r){return this.url.searchParams.append(n,`isdistinct.${r}`),this}in(n,r){const c=Array.from(new Set(r)).map(p=>typeof p=="string"&&bP.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(n,`in.(${c})`),this}notIn(n,r){const c=Array.from(new Set(r)).map(p=>typeof p=="string"&&bP.test(p)?`"${p}"`:`${p}`).join(",");return this.url.searchParams.append(n,`not.in.(${c})`),this}contains(n,r){return typeof r=="string"?this.url.searchParams.append(n,`cs.${r}`):Array.isArray(r)?this.url.searchParams.append(n,`cs.{${r.join(",")}}`):this.url.searchParams.append(n,`cs.${JSON.stringify(r)}`),this}containedBy(n,r){return typeof r=="string"?this.url.searchParams.append(n,`cd.${r}`):Array.isArray(r)?this.url.searchParams.append(n,`cd.{${r.join(",")}}`):this.url.searchParams.append(n,`cd.${JSON.stringify(r)}`),this}rangeGt(n,r){return this.url.searchParams.append(n,`sr.${r}`),this}rangeGte(n,r){return this.url.searchParams.append(n,`nxl.${r}`),this}rangeLt(n,r){return this.url.searchParams.append(n,`sl.${r}`),this}rangeLte(n,r){return this.url.searchParams.append(n,`nxr.${r}`),this}rangeAdjacent(n,r){return this.url.searchParams.append(n,`adj.${r}`),this}overlaps(n,r){return typeof r=="string"?this.url.searchParams.append(n,`ov.${r}`):this.url.searchParams.append(n,`ov.{${r.join(",")}}`),this}textSearch(n,r,{config:c,type:p}={}){let v="";p==="plain"?v="pl":p==="phrase"?v="ph":p==="websearch"&&(v="w");const w=c===void 0?"":`(${c})`;return this.url.searchParams.append(n,`${v}fts${w}.${r}`),this}match(n){return Object.entries(n).forEach(([r,c])=>{this.url.searchParams.append(r,`eq.${c}`)}),this}not(n,r,c){return this.url.searchParams.append(n,`not.${r}.${c}`),this}or(n,{foreignTable:r,referencedTable:c=r}={}){const p=c?`${c}.or`:"or";return this.url.searchParams.append(p,`(${n})`),this}filter(n,r,c){return this.url.searchParams.append(n,`${r}.${c}`),this}},y6=class{constructor(n,{headers:r={},schema:c,fetch:p}){this.url=n,this.headers=new Headers(r),this.schema=c,this.fetch=p}cloneRequestState(){return{url:new URL(this.url.toString()),headers:new Headers(this.headers)}}select(n,r){const{head:c=!1,count:p}=r??{},v=c?"HEAD":"GET";let w=!1;const A=(n??"*").split("").map(j=>/\s/.test(j)&&!w?"":(j==='"'&&(w=!w),j)).join(""),{url:o,headers:D}=this.cloneRequestState();return o.searchParams.set("select",A),p&&D.append("Prefer",`count=${p}`),new Df({method:v,url:o,headers:D,schema:this.schema,fetch:this.fetch})}insert(n,{count:r,defaultToNull:c=!0}={}){var p;const v="POST",{url:w,headers:A}=this.cloneRequestState();if(r&&A.append("Prefer",`count=${r}`),c||A.append("Prefer","missing=default"),Array.isArray(n)){const o=n.reduce((D,j)=>D.concat(Object.keys(j)),[]);if(o.length>0){const D=[...new Set(o)].map(j=>`"${j}"`);w.searchParams.set("columns",D.join(","))}}return new Df({method:v,url:w,headers:A,schema:this.schema,body:n,fetch:(p=this.fetch)!==null&&p!==void 0?p:fetch})}upsert(n,{onConflict:r,ignoreDuplicates:c=!1,count:p,defaultToNull:v=!0}={}){var w;const A="POST",{url:o,headers:D}=this.cloneRequestState();if(D.append("Prefer",`resolution=${c?"ignore":"merge"}-duplicates`),r!==void 0&&o.searchParams.set("on_conflict",r),p&&D.append("Prefer",`count=${p}`),v||D.append("Prefer","missing=default"),Array.isArray(n)){const j=n.reduce((J,ie)=>J.concat(Object.keys(ie)),[]);if(j.length>0){const J=[...new Set(j)].map(ie=>`"${ie}"`);o.searchParams.set("columns",J.join(","))}}return new Df({method:A,url:o,headers:D,schema:this.schema,body:n,fetch:(w=this.fetch)!==null&&w!==void 0?w:fetch})}update(n,{count:r}={}){var c;const p="PATCH",{url:v,headers:w}=this.cloneRequestState();return r&&w.append("Prefer",`count=${r}`),new Df({method:p,url:v,headers:w,schema:this.schema,body:n,fetch:(c=this.fetch)!==null&&c!==void 0?c:fetch})}delete({count:n}={}){var r;const c="DELETE",{url:p,headers:v}=this.cloneRequestState();return n&&v.append("Prefer",`count=${n}`),new Df({method:c,url:p,headers:v,schema:this.schema,fetch:(r=this.fetch)!==null&&r!==void 0?r:fetch})}},v6=class zD{constructor(r,{headers:c={},schema:p,fetch:v}={}){this.url=r,this.headers=new Headers(c),this.schemaName=p,this.fetch=v}from(r){if(!r||typeof r!="string"||r.trim()==="")throw new Error("Invalid relation name: relation must be a non-empty string.");return new y6(new URL(`${this.url}/${r}`),{headers:new Headers(this.headers),schema:this.schemaName,fetch:this.fetch})}schema(r){return new zD(this.url,{headers:this.headers,schema:r,fetch:this.fetch})}rpc(r,c={},{head:p=!1,get:v=!1,count:w}={}){var A;let o;const D=new URL(`${this.url}/rpc/${r}`);let j;const J=he=>he!==null&&typeof he=="object"&&(!Array.isArray(he)||he.some(J)),ie=p&&Object.values(c).some(J);ie?(o="POST",j=c):p||v?(o=p?"HEAD":"GET",Object.entries(c).filter(([he,ce])=>ce!==void 0).map(([he,ce])=>[he,Array.isArray(ce)?`{${ce.join(",")}}`:`${ce}`]).forEach(([he,ce])=>{D.searchParams.append(he,ce)})):(o="POST",j=c);const re=new Headers(this.headers);return ie?re.set("Prefer",w?`count=${w},return=minimal`:"return=minimal"):w&&re.set("Prefer",`count=${w}`),new Df({method:o,url:D,headers:re,schema:this.schemaName,body:j,fetch:(A=this.fetch)!==null&&A!==void 0?A:fetch})}};class x6{constructor(){}static detectEnvironment(){var r;if(typeof WebSocket<"u")return{type:"native",constructor:WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocket<"u")return{type:"native",constructor:globalThis.WebSocket};if(typeof global<"u"&&typeof global.WebSocket<"u")return{type:"native",constructor:global.WebSocket};if(typeof globalThis<"u"&&typeof globalThis.WebSocketPair<"u"&&typeof globalThis.WebSocket>"u")return{type:"cloudflare",error:"Cloudflare Workers detected. WebSocket clients are not supported in Cloudflare Workers.",workaround:"Use Cloudflare Workers WebSocket API for server-side WebSocket handling, or deploy to a different runtime."};if(typeof globalThis<"u"&&globalThis.EdgeRuntime||typeof navigator<"u"&&(!((r=navigator.userAgent)===null||r===void 0)&&r.includes("Vercel-Edge")))return{type:"unsupported",error:"Edge runtime detected (Vercel Edge/Netlify Edge). WebSockets are not supported in edge functions.",workaround:"Use serverless functions or a different deployment target for WebSocket functionality."};const c=globalThis.process;if(c){const p=c.versions;if(p&&p.node){const v=p.node,w=parseInt(v.replace(/^v/,"").split(".")[0]);return w>=22?typeof globalThis.WebSocket<"u"?{type:"native",constructor:globalThis.WebSocket}:{type:"unsupported",error:`Node.js ${w} detected but native WebSocket not found.`,workaround:"Provide a WebSocket implementation via the transport option."}:{type:"unsupported",error:`Node.js ${w} detected without native WebSocket support.`,workaround:`For Node.js < 22, install "ws" package and provide it via the transport option:
import ws from "ws"
new RealtimeClient(url, { transport: ws })`}}}return{type:"unsupported",error:"Unknown JavaScript runtime without WebSocket support.",workaround:"Ensure you're running in a supported environment (browser, Node.js, Deno) or provide a custom WebSocket implementation."}}static getWebSocketConstructor(){const r=this.detectEnvironment();if(r.constructor)return r.constructor;let c=r.error||"WebSocket not supported in this environment.";throw r.workaround&&(c+=`

Suggested solution: ${r.workaround}`),new Error(c)}static createWebSocket(r,c){const p=this.getWebSocketConstructor();return new p(r,c)}static isWebSocketSupported(){try{const r=this.detectEnvironment();return r.type==="native"||r.type==="ws"}catch{return!1}}}const b6="2.93.1",w6=`realtime-js/${b6}`,S6="1.0.0",BD="2.0.0",wP=BD,lT=1e4,T6=1e3,E6=100;var cu;(function(n){n[n.connecting=0]="connecting",n[n.open=1]="open",n[n.closing=2]="closing",n[n.closed=3]="closed"})(cu||(cu={}));var Kn;(function(n){n.closed="closed",n.errored="errored",n.joined="joined",n.joining="joining",n.leaving="leaving"})(Kn||(Kn={}));var Za;(function(n){n.close="phx_close",n.error="phx_error",n.join="phx_join",n.reply="phx_reply",n.leave="phx_leave",n.access_token="access_token"})(Za||(Za={}));var cT;(function(n){n.websocket="websocket"})(cT||(cT={}));var jh;(function(n){n.Connecting="connecting",n.Open="open",n.Closing="closing",n.Closed="closed"})(jh||(jh={}));class I6{constructor(r){this.HEADER_LENGTH=1,this.USER_BROADCAST_PUSH_META_LENGTH=6,this.KINDS={userBroadcastPush:3,userBroadcast:4},this.BINARY_ENCODING=0,this.JSON_ENCODING=1,this.BROADCAST_EVENT="broadcast",this.allowedMetadataKeys=[],this.allowedMetadataKeys=r??[]}encode(r,c){if(r.event===this.BROADCAST_EVENT&&!(r.payload instanceof ArrayBuffer)&&typeof r.payload.event=="string")return c(this._binaryEncodeUserBroadcastPush(r));let p=[r.join_ref,r.ref,r.topic,r.event,r.payload];return c(JSON.stringify(p))}_binaryEncodeUserBroadcastPush(r){var c;return this._isArrayBuffer((c=r.payload)===null||c===void 0?void 0:c.payload)?this._encodeBinaryUserBroadcastPush(r):this._encodeJsonUserBroadcastPush(r)}_encodeBinaryUserBroadcastPush(r){var c,p;const v=(p=(c=r.payload)===null||c===void 0?void 0:c.payload)!==null&&p!==void 0?p:new ArrayBuffer(0);return this._encodeUserBroadcastPush(r,this.BINARY_ENCODING,v)}_encodeJsonUserBroadcastPush(r){var c,p;const v=(p=(c=r.payload)===null||c===void 0?void 0:c.payload)!==null&&p!==void 0?p:{},A=new TextEncoder().encode(JSON.stringify(v)).buffer;return this._encodeUserBroadcastPush(r,this.JSON_ENCODING,A)}_encodeUserBroadcastPush(r,c,p){var v,w;const A=r.topic,o=(v=r.ref)!==null&&v!==void 0?v:"",D=(w=r.join_ref)!==null&&w!==void 0?w:"",j=r.payload.event,J=this.allowedMetadataKeys?this._pick(r.payload,this.allowedMetadataKeys):{},ie=Object.keys(J).length===0?"":JSON.stringify(J);if(D.length>255)throw new Error(`joinRef length ${D.length} exceeds maximum of 255`);if(o.length>255)throw new Error(`ref length ${o.length} exceeds maximum of 255`);if(A.length>255)throw new Error(`topic length ${A.length} exceeds maximum of 255`);if(j.length>255)throw new Error(`userEvent length ${j.length} exceeds maximum of 255`);if(ie.length>255)throw new Error(`metadata length ${ie.length} exceeds maximum of 255`);const re=this.USER_BROADCAST_PUSH_META_LENGTH+D.length+o.length+A.length+j.length+ie.length,he=new ArrayBuffer(this.HEADER_LENGTH+re);let ce=new DataView(he),xe=0;ce.setUint8(xe++,this.KINDS.userBroadcastPush),ce.setUint8(xe++,D.length),ce.setUint8(xe++,o.length),ce.setUint8(xe++,A.length),ce.setUint8(xe++,j.length),ce.setUint8(xe++,ie.length),ce.setUint8(xe++,c),Array.from(D,ve=>ce.setUint8(xe++,ve.charCodeAt(0))),Array.from(o,ve=>ce.setUint8(xe++,ve.charCodeAt(0))),Array.from(A,ve=>ce.setUint8(xe++,ve.charCodeAt(0))),Array.from(j,ve=>ce.setUint8(xe++,ve.charCodeAt(0))),Array.from(ie,ve=>ce.setUint8(xe++,ve.charCodeAt(0)));var Ee=new Uint8Array(he.byteLength+p.byteLength);return Ee.set(new Uint8Array(he),0),Ee.set(new Uint8Array(p),he.byteLength),Ee.buffer}decode(r,c){if(this._isArrayBuffer(r)){let p=this._binaryDecode(r);return c(p)}if(typeof r=="string"){const p=JSON.parse(r),[v,w,A,o,D]=p;return c({join_ref:v,ref:w,topic:A,event:o,payload:D})}return c({})}_binaryDecode(r){const c=new DataView(r),p=c.getUint8(0),v=new TextDecoder;switch(p){case this.KINDS.userBroadcast:return this._decodeUserBroadcast(r,c,v)}}_decodeUserBroadcast(r,c,p){const v=c.getUint8(1),w=c.getUint8(2),A=c.getUint8(3),o=c.getUint8(4);let D=this.HEADER_LENGTH+4;const j=p.decode(r.slice(D,D+v));D=D+v;const J=p.decode(r.slice(D,D+w));D=D+w;const ie=p.decode(r.slice(D,D+A));D=D+A;const re=r.slice(D,r.byteLength),he=o===this.JSON_ENCODING?JSON.parse(p.decode(re)):re,ce={type:this.BROADCAST_EVENT,event:J,payload:he};return A>0&&(ce.meta=JSON.parse(ie)),{join_ref:null,ref:null,topic:j,event:this.BROADCAST_EVENT,payload:ce}}_isArrayBuffer(r){var c;return r instanceof ArrayBuffer||((c=r==null?void 0:r.constructor)===null||c===void 0?void 0:c.name)==="ArrayBuffer"}_pick(r,c){return!r||typeof r!="object"?{}:Object.fromEntries(Object.entries(r).filter(([p])=>c.includes(p)))}}class FD{constructor(r,c){this.callback=r,this.timerCalc=c,this.timer=void 0,this.tries=0,this.callback=r,this.timerCalc=c}reset(){this.tries=0,clearTimeout(this.timer),this.timer=void 0}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var Xr;(function(n){n.abstime="abstime",n.bool="bool",n.date="date",n.daterange="daterange",n.float4="float4",n.float8="float8",n.int2="int2",n.int4="int4",n.int4range="int4range",n.int8="int8",n.int8range="int8range",n.json="json",n.jsonb="jsonb",n.money="money",n.numeric="numeric",n.oid="oid",n.reltime="reltime",n.text="text",n.time="time",n.timestamp="timestamp",n.timestamptz="timestamptz",n.timetz="timetz",n.tsrange="tsrange",n.tstzrange="tstzrange"})(Xr||(Xr={}));const SP=(n,r,c={})=>{var p;const v=(p=c.skipTypes)!==null&&p!==void 0?p:[];return r?Object.keys(r).reduce((w,A)=>(w[A]=A6(A,n,r,v),w),{}):{}},A6=(n,r,c,p)=>{const v=r.find(o=>o.name===n),w=v==null?void 0:v.type,A=c[n];return w&&!p.includes(w)?jD(w,A):uT(A)},jD=(n,r)=>{if(n.charAt(0)==="_"){const c=n.slice(1,n.length);return P6(r,c)}switch(n){case Xr.bool:return C6(r);case Xr.float4:case Xr.float8:case Xr.int2:case Xr.int4:case Xr.int8:case Xr.numeric:case Xr.oid:return k6(r);case Xr.json:case Xr.jsonb:return L6(r);case Xr.timestamp:return M6(r);case Xr.abstime:case Xr.date:case Xr.daterange:case Xr.int4range:case Xr.int8range:case Xr.money:case Xr.reltime:case Xr.text:case Xr.time:case Xr.timestamptz:case Xr.timetz:case Xr.tsrange:case Xr.tstzrange:return uT(r);default:return uT(r)}},uT=n=>n,C6=n=>{switch(n){case"t":return!0;case"f":return!1;default:return n}},k6=n=>{if(typeof n=="string"){const r=parseFloat(n);if(!Number.isNaN(r))return r}return n},L6=n=>{if(typeof n=="string")try{return JSON.parse(n)}catch{return n}return n},P6=(n,r)=>{if(typeof n!="string")return n;const c=n.length-1,p=n[c];if(n[0]==="{"&&p==="}"){let w;const A=n.slice(1,c);try{w=JSON.parse("["+A+"]")}catch{w=A?A.split(","):[]}return w.map(o=>jD(r,o))}return n},M6=n=>typeof n=="string"?n.replace(" ","T"):n,ND=n=>{const r=new URL(n);return r.protocol=r.protocol.replace(/^ws/i,"http"),r.pathname=r.pathname.replace(/\/+$/,"").replace(/\/socket\/websocket$/i,"").replace(/\/socket$/i,"").replace(/\/websocket$/i,""),r.pathname===""||r.pathname==="/"?r.pathname="/api/broadcast":r.pathname=r.pathname+"/api/broadcast",r.href};class qw{constructor(r,c,p={},v=lT){this.channel=r,this.event=c,this.payload=p,this.timeout=v,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(r){this.timeout=r,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(r){this.payload=Object.assign(Object.assign({},this.payload),r)}receive(r,c){var p;return this._hasReceived(r)&&c((p=this.receivedResp)===null||p===void 0?void 0:p.response),this.recHooks.push({status:r,callback:c}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const r=c=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=c,this._matchReceive(c)};this.channel._on(this.refEvent,{},r),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(r,c){this.refEvent&&this.channel._trigger(this.refEvent,{status:r,response:c})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:r,response:c}){this.recHooks.filter(p=>p.status===r).forEach(p=>p.callback(c))}_hasReceived(r){return this.receivedResp&&this.receivedResp.status===r}}var TP;(function(n){n.SYNC="sync",n.JOIN="join",n.LEAVE="leave"})(TP||(TP={}));class a_{constructor(r,c){this.channel=r,this.state={},this.pendingDiffs=[],this.joinRef=null,this.enabled=!1,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const p=(c==null?void 0:c.events)||{state:"presence_state",diff:"presence_diff"};this.channel._on(p.state,{},v=>{const{onJoin:w,onLeave:A,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=a_.syncState(this.state,v,w,A),this.pendingDiffs.forEach(D=>{this.state=a_.syncDiff(this.state,D,w,A)}),this.pendingDiffs=[],o()}),this.channel._on(p.diff,{},v=>{const{onJoin:w,onLeave:A,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(v):(this.state=a_.syncDiff(this.state,v,w,A),o())}),this.onJoin((v,w,A)=>{this.channel._trigger("presence",{event:"join",key:v,currentPresences:w,newPresences:A})}),this.onLeave((v,w,A)=>{this.channel._trigger("presence",{event:"leave",key:v,currentPresences:w,leftPresences:A})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(r,c,p,v){const w=this.cloneDeep(r),A=this.transformState(c),o={},D={};return this.map(w,(j,J)=>{A[j]||(D[j]=J)}),this.map(A,(j,J)=>{const ie=w[j];if(ie){const re=J.map(Ee=>Ee.presence_ref),he=ie.map(Ee=>Ee.presence_ref),ce=J.filter(Ee=>he.indexOf(Ee.presence_ref)<0),xe=ie.filter(Ee=>re.indexOf(Ee.presence_ref)<0);ce.length>0&&(o[j]=ce),xe.length>0&&(D[j]=xe)}else o[j]=J}),this.syncDiff(w,{joins:o,leaves:D},p,v)}static syncDiff(r,c,p,v){const{joins:w,leaves:A}={joins:this.transformState(c.joins),leaves:this.transformState(c.leaves)};return p||(p=()=>{}),v||(v=()=>{}),this.map(w,(o,D)=>{var j;const J=(j=r[o])!==null&&j!==void 0?j:[];if(r[o]=this.cloneDeep(D),J.length>0){const ie=r[o].map(he=>he.presence_ref),re=J.filter(he=>ie.indexOf(he.presence_ref)<0);r[o].unshift(...re)}p(o,J,D)}),this.map(A,(o,D)=>{let j=r[o];if(!j)return;const J=D.map(ie=>ie.presence_ref);j=j.filter(ie=>J.indexOf(ie.presence_ref)<0),r[o]=j,v(o,j,D),j.length===0&&delete r[o]}),r}static map(r,c){return Object.getOwnPropertyNames(r).map(p=>c(p,r[p]))}static transformState(r){return r=this.cloneDeep(r),Object.getOwnPropertyNames(r).reduce((c,p)=>{const v=r[p];return"metas"in v?c[p]=v.metas.map(w=>(w.presence_ref=w.phx_ref,delete w.phx_ref,delete w.phx_ref_prev,w)):c[p]=v,c},{})}static cloneDeep(r){return JSON.parse(JSON.stringify(r))}onJoin(r){this.caller.onJoin=r}onLeave(r){this.caller.onLeave=r}onSync(r){this.caller.onSync=r}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var EP;(function(n){n.ALL="*",n.INSERT="INSERT",n.UPDATE="UPDATE",n.DELETE="DELETE"})(EP||(EP={}));var l_;(function(n){n.BROADCAST="broadcast",n.PRESENCE="presence",n.POSTGRES_CHANGES="postgres_changes",n.SYSTEM="system"})(l_||(l_={}));var ic;(function(n){n.SUBSCRIBED="SUBSCRIBED",n.TIMED_OUT="TIMED_OUT",n.CLOSED="CLOSED",n.CHANNEL_ERROR="CHANNEL_ERROR"})(ic||(ic={}));class Kf{constructor(r,c={config:{}},p){var v,w;if(this.topic=r,this.params=c,this.socket=p,this.bindings={},this.state=Kn.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=r.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:"",enabled:!1},private:!1},c.config),this.timeout=this.socket.timeout,this.joinPush=new qw(this,Za.join,this.params,this.timeout),this.rejoinTimer=new FD(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=Kn.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(A=>A.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=Kn.closed,this.socket._remove(this)}),this._onError(A=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,A),this.state=Kn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=Kn.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("error",A=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,A),this.state=Kn.errored,this.rejoinTimer.scheduleTimeout())}),this._on(Za.reply,{},(A,o)=>{this._trigger(this._replyEventName(o),A)}),this.presence=new a_(this),this.broadcastEndpointURL=ND(this.socket.endPoint),this.private=this.params.config.private||!1,!this.private&&(!((w=(v=this.params.config)===null||v===void 0?void 0:v.broadcast)===null||w===void 0)&&w.replay))throw`tried to use replay on public channel '${this.topic}'. It must be a private channel.`}subscribe(r,c=this.timeout){var p,v,w;if(this.socket.isConnected()||this.socket.connect(),this.state==Kn.closed){const{config:{broadcast:A,presence:o,private:D}}=this.params,j=(v=(p=this.bindings.postgres_changes)===null||p===void 0?void 0:p.map(he=>he.filter))!==null&&v!==void 0?v:[],J=!!this.bindings[l_.PRESENCE]&&this.bindings[l_.PRESENCE].length>0||((w=this.params.config.presence)===null||w===void 0?void 0:w.enabled)===!0,ie={},re={broadcast:A,presence:Object.assign(Object.assign({},o),{enabled:J}),postgres_changes:j,private:D};this.socket.accessTokenValue&&(ie.access_token=this.socket.accessTokenValue),this._onError(he=>r==null?void 0:r(ic.CHANNEL_ERROR,he)),this._onClose(()=>r==null?void 0:r(ic.CLOSED)),this.updateJoinPayload(Object.assign({config:re},ie)),this.joinedOnce=!0,this._rejoin(c),this.joinPush.receive("ok",async({postgres_changes:he})=>{var ce;if(this.socket._isManualToken()||this.socket.setAuth(),he===void 0){r==null||r(ic.SUBSCRIBED);return}else{const xe=this.bindings.postgres_changes,Ee=(ce=xe==null?void 0:xe.length)!==null&&ce!==void 0?ce:0,ve=[];for(let K=0;K<Ee;K++){const fe=xe[K],{filter:{event:ke,schema:Be,table:Le,filter:We}}=fe,ct=he&&he[K];if(ct&&ct.event===ke&&Kf.isFilterValueEqual(ct.schema,Be)&&Kf.isFilterValueEqual(ct.table,Le)&&Kf.isFilterValueEqual(ct.filter,We))ve.push(Object.assign(Object.assign({},fe),{id:ct.id}));else{this.unsubscribe(),this.state=Kn.errored,r==null||r(ic.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=ve,r&&r(ic.SUBSCRIBED);return}}).receive("error",he=>{this.state=Kn.errored,r==null||r(ic.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(he).join(", ")||"error")))}).receive("timeout",()=>{r==null||r(ic.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(r,c={}){return await this.send({type:"presence",event:"track",payload:r},c.timeout||this.timeout)}async untrack(r={}){return await this.send({type:"presence",event:"untrack"},r)}on(r,c,p){return this.state===Kn.joined&&r===l_.PRESENCE&&(this.socket.log("channel",`resubscribe to ${this.topic} due to change in presence callbacks on joined channel`),this.unsubscribe().then(async()=>await this.subscribe())),this._on(r,c,p)}async httpSend(r,c,p={}){var v;if(c==null)return Promise.reject("Payload is required for httpSend()");const w={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(w.Authorization=`Bearer ${this.socket.accessTokenValue}`);const A={method:"POST",headers:w,body:JSON.stringify({messages:[{topic:this.subTopic,event:r,payload:c,private:this.private}]})},o=await this._fetchWithTimeout(this.broadcastEndpointURL,A,(v=p.timeout)!==null&&v!==void 0?v:this.timeout);if(o.status===202)return{success:!0};let D=o.statusText;try{const j=await o.json();D=j.error||j.message||D}catch{}return Promise.reject(new Error(D))}async send(r,c={}){var p,v;if(!this._canPush()&&r.type==="broadcast"){console.warn("Realtime send() is automatically falling back to REST API. This behavior will be deprecated in the future. Please use httpSend() explicitly for REST delivery.");const{event:w,payload:A}=r,o={apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"};this.socket.accessTokenValue&&(o.Authorization=`Bearer ${this.socket.accessTokenValue}`);const D={method:"POST",headers:o,body:JSON.stringify({messages:[{topic:this.subTopic,event:w,payload:A,private:this.private}]})};try{const j=await this._fetchWithTimeout(this.broadcastEndpointURL,D,(p=c.timeout)!==null&&p!==void 0?p:this.timeout);return await((v=j.body)===null||v===void 0?void 0:v.cancel()),j.ok?"ok":"error"}catch(j){return j.name==="AbortError"?"timed out":"error"}}else return new Promise(w=>{var A,o,D;const j=this._push(r.type,r,c.timeout||this.timeout);r.type==="broadcast"&&!(!((D=(o=(A=this.params)===null||A===void 0?void 0:A.config)===null||o===void 0?void 0:o.broadcast)===null||D===void 0)&&D.ack)&&w("ok"),j.receive("ok",()=>w("ok")),j.receive("error",()=>w("error")),j.receive("timeout",()=>w("timed out"))})}updateJoinPayload(r){this.joinPush.updatePayload(r)}unsubscribe(r=this.timeout){this.state=Kn.leaving;const c=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(Za.close,"leave",this._joinRef())};this.joinPush.destroy();let p=null;return new Promise(v=>{p=new qw(this,Za.leave,{},r),p.receive("ok",()=>{c(),v("ok")}).receive("timeout",()=>{c(),v("timed out")}).receive("error",()=>{v("error")}),p.send(),this._canPush()||p.trigger("ok",{})}).finally(()=>{p==null||p.destroy()})}teardown(){this.pushBuffer.forEach(r=>r.destroy()),this.pushBuffer=[],this.rejoinTimer.reset(),this.joinPush.destroy(),this.state=Kn.closed,this.bindings={}}async _fetchWithTimeout(r,c,p){const v=new AbortController,w=setTimeout(()=>v.abort(),p),A=await this.socket.fetch(r,Object.assign(Object.assign({},c),{signal:v.signal}));return clearTimeout(w),A}_push(r,c,p=this.timeout){if(!this.joinedOnce)throw`tried to push '${r}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let v=new qw(this,r,c,p);return this._canPush()?v.send():this._addToPushBuffer(v),v}_addToPushBuffer(r){if(r.startTimeout(),this.pushBuffer.push(r),this.pushBuffer.length>E6){const c=this.pushBuffer.shift();c&&(c.destroy(),this.socket.log("channel",`discarded push due to buffer overflow: ${c.event}`,c.payload))}}_onMessage(r,c,p){return c}_isMember(r){return this.topic===r}_joinRef(){return this.joinPush.ref}_trigger(r,c,p){var v,w;const A=r.toLocaleLowerCase(),{close:o,error:D,leave:j,join:J}=Za;if(p&&[o,D,j,J].indexOf(A)>=0&&p!==this._joinRef())return;let re=this._onMessage(A,c,p);if(c&&!re)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(A)?(v=this.bindings.postgres_changes)===null||v===void 0||v.filter(he=>{var ce,xe,Ee;return((ce=he.filter)===null||ce===void 0?void 0:ce.event)==="*"||((Ee=(xe=he.filter)===null||xe===void 0?void 0:xe.event)===null||Ee===void 0?void 0:Ee.toLocaleLowerCase())===A}).map(he=>he.callback(re,p)):(w=this.bindings[A])===null||w===void 0||w.filter(he=>{var ce,xe,Ee,ve,K,fe;if(["broadcast","presence","postgres_changes"].includes(A))if("id"in he){const ke=he.id,Be=(ce=he.filter)===null||ce===void 0?void 0:ce.event;return ke&&((xe=c.ids)===null||xe===void 0?void 0:xe.includes(ke))&&(Be==="*"||(Be==null?void 0:Be.toLocaleLowerCase())===((Ee=c.data)===null||Ee===void 0?void 0:Ee.type.toLocaleLowerCase()))}else{const ke=(K=(ve=he==null?void 0:he.filter)===null||ve===void 0?void 0:ve.event)===null||K===void 0?void 0:K.toLocaleLowerCase();return ke==="*"||ke===((fe=c==null?void 0:c.event)===null||fe===void 0?void 0:fe.toLocaleLowerCase())}else return he.type.toLocaleLowerCase()===A}).map(he=>{if(typeof re=="object"&&"ids"in re){const ce=re.data,{schema:xe,table:Ee,commit_timestamp:ve,type:K,errors:fe}=ce;re=Object.assign(Object.assign({},{schema:xe,table:Ee,commit_timestamp:ve,eventType:K,new:{},old:{},errors:fe}),this._getPayloadRecords(ce))}he.callback(re,p)})}_isClosed(){return this.state===Kn.closed}_isJoined(){return this.state===Kn.joined}_isJoining(){return this.state===Kn.joining}_isLeaving(){return this.state===Kn.leaving}_replyEventName(r){return`chan_reply_${r}`}_on(r,c,p){const v=r.toLocaleLowerCase(),w={type:v,filter:c,callback:p};return this.bindings[v]?this.bindings[v].push(w):this.bindings[v]=[w],this}_off(r,c){const p=r.toLocaleLowerCase();return this.bindings[p]&&(this.bindings[p]=this.bindings[p].filter(v=>{var w;return!(((w=v.type)===null||w===void 0?void 0:w.toLocaleLowerCase())===p&&Kf.isEqual(v.filter,c))})),this}static isEqual(r,c){if(Object.keys(r).length!==Object.keys(c).length)return!1;for(const p in r)if(r[p]!==c[p])return!1;return!0}static isFilterValueEqual(r,c){return(r??void 0)===(c??void 0)}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(r){this._on(Za.close,{},r)}_onError(r){this._on(Za.error,{},c=>r(c))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(r=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=Kn.joining,this.joinPush.resend(r))}_getPayloadRecords(r){const c={new:{},old:{}};return(r.type==="INSERT"||r.type==="UPDATE")&&(c.new=SP(r.columns,r.record)),(r.type==="UPDATE"||r.type==="DELETE")&&(c.old=SP(r.columns,r.old_record)),c}}const Zw=()=>{},M0={HEARTBEAT_INTERVAL:25e3,RECONNECT_DELAY:10,HEARTBEAT_TIMEOUT_FALLBACK:100},R6=[1e3,2e3,5e3,1e4],D6=1e4,O6=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class z6{constructor(r,c){var p;if(this.accessTokenValue=null,this.apiKey=null,this._manuallySetToken=!1,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=lT,this.transport=null,this.heartbeatIntervalMs=M0.HEARTBEAT_INTERVAL,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Zw,this.ref=0,this.reconnectTimer=null,this.vsn=wP,this.logger=Zw,this.conn=null,this.sendBuffer=[],this.serializer=new I6,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._connectionState="disconnected",this._wasManualDisconnect=!1,this._authPromise=null,this._heartbeatSentAt=null,this._resolveFetch=v=>v?(...w)=>v(...w):(...w)=>fetch(...w),!(!((p=c==null?void 0:c.params)===null||p===void 0)&&p.apikey))throw new Error("API key is required to connect to Realtime");this.apiKey=c.params.apikey,this.endPoint=`${r}/${cT.websocket}`,this.httpEndpoint=ND(r),this._initializeOptions(c),this._setupReconnectionTimer(),this.fetch=this._resolveFetch(c==null?void 0:c.fetch)}connect(){if(!(this.isConnecting()||this.isDisconnecting()||this.conn!==null&&this.isConnected())){if(this._setConnectionState("connecting"),this.accessToken&&!this._authPromise&&this._setAuthSafely("connect"),this.transport)this.conn=new this.transport(this.endpointURL());else try{this.conn=x6.createWebSocket(this.endpointURL())}catch(r){this._setConnectionState("disconnected");const c=r.message;throw c.includes("Node.js")?new Error(`${c}

To use Realtime in Node.js, you need to provide a WebSocket implementation:

Option 1: Use Node.js 22+ which has native WebSocket support
Option 2: Install and provide the "ws" package:

  npm install ws

  import ws from "ws"
  const client = new RealtimeClient(url, {
    ...options,
    transport: ws
  })`):new Error(`WebSocket not available: ${c}`)}this._setupConnectionHandlers()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:this.vsn}))}disconnect(r,c){if(!this.isDisconnecting())if(this._setConnectionState("disconnecting",!0),this.conn){const p=setTimeout(()=>{this._setConnectionState("disconnected")},100);this.conn.onclose=()=>{clearTimeout(p),this._setConnectionState("disconnected")},typeof this.conn.close=="function"&&(r?this.conn.close(r,c??""):this.conn.close()),this._teardownConnection()}else this._setConnectionState("disconnected")}getChannels(){return this.channels}async removeChannel(r){const c=await r.unsubscribe();return this.channels.length===0&&this.disconnect(),c}async removeAllChannels(){const r=await Promise.all(this.channels.map(c=>c.unsubscribe()));return this.channels=[],this.disconnect(),r}log(r,c,p){this.logger(r,c,p)}connectionState(){switch(this.conn&&this.conn.readyState){case cu.connecting:return jh.Connecting;case cu.open:return jh.Open;case cu.closing:return jh.Closing;default:return jh.Closed}}isConnected(){return this.connectionState()===jh.Open}isConnecting(){return this._connectionState==="connecting"}isDisconnecting(){return this._connectionState==="disconnecting"}channel(r,c={config:{}}){const p=`realtime:${r}`,v=this.getChannels().find(w=>w.topic===p);if(v)return v;{const w=new Kf(`realtime:${r}`,c,this);return this.channels.push(w),w}}push(r){const{topic:c,event:p,payload:v,ref:w}=r,A=()=>{this.encode(r,o=>{var D;(D=this.conn)===null||D===void 0||D.send(o)})};this.log("push",`${c} ${p} (${w})`,v),this.isConnected()?A():this.sendBuffer.push(A)}async setAuth(r=null){this._authPromise=this._performAuth(r);try{await this._authPromise}finally{this._authPromise=null}}_isManualToken(){return this._manuallySetToken}async sendHeartbeat(){var r;if(!this.isConnected()){try{this.heartbeatCallback("disconnected")}catch(c){this.log("error","error in heartbeat callback",c)}return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this._heartbeatSentAt=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection");try{this.heartbeatCallback("timeout")}catch(c){this.log("error","error in heartbeat callback",c)}this._wasManualDisconnect=!1,(r=this.conn)===null||r===void 0||r.close(T6,"heartbeat timeout"),setTimeout(()=>{var c;this.isConnected()||(c=this.reconnectTimer)===null||c===void 0||c.scheduleTimeout()},M0.HEARTBEAT_TIMEOUT_FALLBACK);return}this._heartbeatSentAt=Date.now(),this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef});try{this.heartbeatCallback("sent")}catch(c){this.log("error","error in heartbeat callback",c)}this._setAuthSafely("heartbeat")}onHeartbeat(r){this.heartbeatCallback=r}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(r=>r()),this.sendBuffer=[])}_makeRef(){let r=this.ref+1;return r===this.ref?this.ref=0:this.ref=r,this.ref.toString()}_leaveOpenTopic(r){let c=this.channels.find(p=>p.topic===r&&(p._isJoined()||p._isJoining()));c&&(this.log("transport",`leaving duplicate topic "${r}"`),c.unsubscribe())}_remove(r){this.channels=this.channels.filter(c=>c.topic!==r.topic)}_onConnMessage(r){this.decode(r.data,c=>{if(c.topic==="phoenix"&&c.event==="phx_reply"&&c.ref&&c.ref===this.pendingHeartbeatRef){const j=this._heartbeatSentAt?Date.now()-this._heartbeatSentAt:void 0;try{this.heartbeatCallback(c.payload.status==="ok"?"ok":"error",j)}catch(J){this.log("error","error in heartbeat callback",J)}this._heartbeatSentAt=null,this.pendingHeartbeatRef=null}const{topic:p,event:v,payload:w,ref:A}=c,o=A?`(${A})`:"",D=w.status||"";this.log("receive",`${D} ${p} ${v} ${o}`.trim(),w),this.channels.filter(j=>j._isMember(p)).forEach(j=>j._trigger(v,w,A)),this._triggerStateCallbacks("message",c)})}_clearTimer(r){var c;r==="heartbeat"&&this.heartbeatTimer?(clearInterval(this.heartbeatTimer),this.heartbeatTimer=void 0):r==="reconnect"&&((c=this.reconnectTimer)===null||c===void 0||c.reset())}_clearAllTimers(){this._clearTimer("heartbeat"),this._clearTimer("reconnect")}_setupConnectionHandlers(){this.conn&&("binaryType"in this.conn&&(this.conn.binaryType="arraybuffer"),this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=r=>this._onConnError(r),this.conn.onmessage=r=>this._onConnMessage(r),this.conn.onclose=r=>this._onConnClose(r),this.conn.readyState===cu.open&&this._onConnOpen())}_teardownConnection(){if(this.conn){if(this.conn.readyState===cu.open||this.conn.readyState===cu.connecting)try{this.conn.close()}catch(r){this.log("error","Error closing connection",r)}this.conn.onopen=null,this.conn.onerror=null,this.conn.onmessage=null,this.conn.onclose=null,this.conn=null}this._clearAllTimers(),this._terminateWorker(),this.channels.forEach(r=>r.teardown())}_onConnOpen(){this._setConnectionState("connected"),this.log("transport",`connected to ${this.endpointURL()}`),(this._authPromise||(this.accessToken&&!this.accessTokenValue?this.setAuth():Promise.resolve())).then(()=>{this.flushSendBuffer()}).catch(c=>{this.log("error","error waiting for auth on connect",c),this.flushSendBuffer()}),this._clearTimer("reconnect"),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this._triggerStateCallbacks("open")}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const r=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(r),this.workerRef.onerror=c=>{this.log("worker","worker error",c.message),this._terminateWorker()},this.workerRef.onmessage=c=>{c.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_terminateWorker(){this.workerRef&&(this.log("worker","terminating worker"),this.workerRef.terminate(),this.workerRef=void 0)}_onConnClose(r){var c;this._setConnectionState("disconnected"),this.log("transport","close",r),this._triggerChanError(),this._clearTimer("heartbeat"),this._wasManualDisconnect||(c=this.reconnectTimer)===null||c===void 0||c.scheduleTimeout(),this._triggerStateCallbacks("close",r)}_onConnError(r){this._setConnectionState("disconnected"),this.log("transport",`${r}`),this._triggerChanError(),this._triggerStateCallbacks("error",r);try{this.heartbeatCallback("error")}catch(c){this.log("error","error in heartbeat callback",c)}}_triggerChanError(){this.channels.forEach(r=>r._trigger(Za.error))}_appendParams(r,c){if(Object.keys(c).length===0)return r;const p=r.match(/\?/)?"&":"?",v=new URLSearchParams(c);return`${r}${p}${v}`}_workerObjectUrl(r){let c;if(r)c=r;else{const p=new Blob([O6],{type:"application/javascript"});c=URL.createObjectURL(p)}return c}_setConnectionState(r,c=!1){this._connectionState=r,r==="connecting"?this._wasManualDisconnect=!1:r==="disconnecting"&&(this._wasManualDisconnect=c)}async _performAuth(r=null){let c,p=!1;if(r)c=r,p=!0;else if(this.accessToken)try{c=await this.accessToken()}catch(v){this.log("error","Error fetching access token from callback",v),c=this.accessTokenValue}else c=this.accessTokenValue;p?this._manuallySetToken=!0:this.accessToken&&(this._manuallySetToken=!1),this.accessTokenValue!=c&&(this.accessTokenValue=c,this.channels.forEach(v=>{const w={access_token:c,version:w6};c&&v.updateJoinPayload(w),v.joinedOnce&&v._isJoined()&&v._push(Za.access_token,{access_token:c})}))}async _waitForAuthIfNeeded(){this._authPromise&&await this._authPromise}_setAuthSafely(r="general"){this._isManualToken()||this.setAuth().catch(c=>{this.log("error",`Error setting auth in ${r}`,c)})}_triggerStateCallbacks(r,c){try{this.stateChangeCallbacks[r].forEach(p=>{try{p(c)}catch(v){this.log("error",`error in ${r} callback`,v)}})}catch(p){this.log("error",`error triggering ${r} callbacks`,p)}}_setupReconnectionTimer(){this.reconnectTimer=new FD(async()=>{setTimeout(async()=>{await this._waitForAuthIfNeeded(),this.isConnected()||this.connect()},M0.RECONNECT_DELAY)},this.reconnectAfterMs)}_initializeOptions(r){var c,p,v,w,A,o,D,j,J,ie,re,he;switch(this.transport=(c=r==null?void 0:r.transport)!==null&&c!==void 0?c:null,this.timeout=(p=r==null?void 0:r.timeout)!==null&&p!==void 0?p:lT,this.heartbeatIntervalMs=(v=r==null?void 0:r.heartbeatIntervalMs)!==null&&v!==void 0?v:M0.HEARTBEAT_INTERVAL,this.worker=(w=r==null?void 0:r.worker)!==null&&w!==void 0?w:!1,this.accessToken=(A=r==null?void 0:r.accessToken)!==null&&A!==void 0?A:null,this.heartbeatCallback=(o=r==null?void 0:r.heartbeatCallback)!==null&&o!==void 0?o:Zw,this.vsn=(D=r==null?void 0:r.vsn)!==null&&D!==void 0?D:wP,r!=null&&r.params&&(this.params=r.params),r!=null&&r.logger&&(this.logger=r.logger),(r!=null&&r.logLevel||r!=null&&r.log_level)&&(this.logLevel=r.logLevel||r.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),this.reconnectAfterMs=(j=r==null?void 0:r.reconnectAfterMs)!==null&&j!==void 0?j:ce=>R6[ce-1]||D6,this.vsn){case S6:this.encode=(J=r==null?void 0:r.encode)!==null&&J!==void 0?J:(ce,xe)=>xe(JSON.stringify(ce)),this.decode=(ie=r==null?void 0:r.decode)!==null&&ie!==void 0?ie:(ce,xe)=>xe(JSON.parse(ce));break;case BD:this.encode=(re=r==null?void 0:r.encode)!==null&&re!==void 0?re:this.serializer.encode.bind(this.serializer),this.decode=(he=r==null?void 0:r.decode)!==null&&he!==void 0?he:this.serializer.decode.bind(this.serializer);break;default:throw new Error(`Unsupported serializer version: ${this.vsn}`)}if(this.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.workerUrl=r==null?void 0:r.workerUrl}}}var L_=class extends Error{constructor(n,r){var c;super(n),this.name="IcebergError",this.status=r.status,this.icebergType=r.icebergType,this.icebergCode=r.icebergCode,this.details=r.details,this.isCommitStateUnknown=r.icebergType==="CommitStateUnknownException"||[500,502,504].includes(r.status)&&((c=r.icebergType)==null?void 0:c.includes("CommitState"))===!0}isNotFound(){return this.status===404}isConflict(){return this.status===409}isAuthenticationTimeout(){return this.status===419}};function B6(n,r,c){const p=new URL(r,n);if(c)for(const[v,w]of Object.entries(c))w!==void 0&&p.searchParams.set(v,w);return p.toString()}async function F6(n){return!n||n.type==="none"?{}:n.type==="bearer"?{Authorization:`Bearer ${n.token}`}:n.type==="header"?{[n.name]:n.value}:n.type==="custom"?await n.getHeaders():{}}function j6(n){const r=n.fetchImpl??globalThis.fetch;return{async request({method:c,path:p,query:v,body:w,headers:A}){const o=B6(n.baseUrl,p,v),D=await F6(n.auth),j=await r(o,{method:c,headers:{...w?{"Content-Type":"application/json"}:{},...D,...A},body:w?JSON.stringify(w):void 0}),J=await j.text(),ie=(j.headers.get("content-type")||"").includes("application/json"),re=ie&&J?JSON.parse(J):J;if(!j.ok){const he=ie?re:void 0,ce=he==null?void 0:he.error;throw new L_((ce==null?void 0:ce.message)??`Request failed with status ${j.status}`,{status:j.status,icebergType:ce==null?void 0:ce.type,icebergCode:ce==null?void 0:ce.code,details:he})}return{status:j.status,headers:j.headers,data:re}}}}function R0(n){return n.join("")}var N6=class{constructor(n,r=""){this.client=n,this.prefix=r}async listNamespaces(n){const r=n?{parent:R0(n.namespace)}:void 0;return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces`,query:r})).data.namespaces.map(p=>({namespace:p}))}async createNamespace(n,r){const c={namespace:n.namespace,properties:r==null?void 0:r.properties};return(await this.client.request({method:"POST",path:`${this.prefix}/namespaces`,body:c})).data}async dropNamespace(n){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${R0(n.namespace)}`})}async loadNamespaceMetadata(n){return{properties:(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${R0(n.namespace)}`})).data.properties}}async namespaceExists(n){try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${R0(n.namespace)}`}),!0}catch(r){if(r instanceof L_&&r.status===404)return!1;throw r}}async createNamespaceIfNotExists(n,r){try{return await this.createNamespace(n,r)}catch(c){if(c instanceof L_&&c.status===409)return;throw c}}};function Af(n){return n.join("")}var U6=class{constructor(n,r="",c){this.client=n,this.prefix=r,this.accessDelegation=c}async listTables(n){return(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables`})).data.identifiers}async createTable(n,r){const c={};return this.accessDelegation&&(c["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables`,body:r,headers:c})).data.metadata}async updateTable(n,r){const c=await this.client.request({method:"POST",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables/${n.name}`,body:r});return{"metadata-location":c.data["metadata-location"],metadata:c.data.metadata}}async dropTable(n,r){await this.client.request({method:"DELETE",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables/${n.name}`,query:{purgeRequested:String((r==null?void 0:r.purge)??!1)}})}async loadTable(n){const r={};return this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation),(await this.client.request({method:"GET",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables/${n.name}`,headers:r})).data.metadata}async tableExists(n){const r={};this.accessDelegation&&(r["X-Iceberg-Access-Delegation"]=this.accessDelegation);try{return await this.client.request({method:"HEAD",path:`${this.prefix}/namespaces/${Af(n.namespace)}/tables/${n.name}`,headers:r}),!0}catch(c){if(c instanceof L_&&c.status===404)return!1;throw c}}async createTableIfNotExists(n,r){try{return await this.createTable(n,r)}catch(c){if(c instanceof L_&&c.status===409)return await this.loadTable({namespace:n.namespace,name:r.name});throw c}}},V6=class{constructor(n){var p;let r="v1";n.catalogName&&(r+=`/${n.catalogName}`);const c=n.baseUrl.endsWith("/")?n.baseUrl:`${n.baseUrl}/`;this.client=j6({baseUrl:c,auth:n.auth,fetchImpl:n.fetch}),this.accessDelegation=(p=n.accessDelegation)==null?void 0:p.join(","),this.namespaceOps=new N6(this.client,r),this.tableOps=new U6(this.client,r,this.accessDelegation)}async listNamespaces(n){return this.namespaceOps.listNamespaces(n)}async createNamespace(n,r){return this.namespaceOps.createNamespace(n,r)}async dropNamespace(n){await this.namespaceOps.dropNamespace(n)}async loadNamespaceMetadata(n){return this.namespaceOps.loadNamespaceMetadata(n)}async listTables(n){return this.tableOps.listTables(n)}async createTable(n,r){return this.tableOps.createTable(n,r)}async updateTable(n,r){return this.tableOps.updateTable(n,r)}async dropTable(n,r){await this.tableOps.dropTable(n,r)}async loadTable(n){return this.tableOps.loadTable(n)}async namespaceExists(n){return this.namespaceOps.namespaceExists(n)}async tableExists(n){return this.tableOps.tableExists(n)}async createNamespaceIfNotExists(n,r){return this.namespaceOps.createNamespaceIfNotExists(n,r)}async createTableIfNotExists(n,r){return this.tableOps.createTableIfNotExists(n,r)}},r1=class extends Error{constructor(n,r="storage",c,p){super(n),this.__isStorageError=!0,this.namespace=r,this.name=r==="vectors"?"StorageVectorsError":"StorageError",this.status=c,this.statusCode=p}};function n1(n){return typeof n=="object"&&n!==null&&"__isStorageError"in n}var D0=class extends r1{constructor(n,r,c,p="storage"){super(n,p,r,c),this.name=p==="vectors"?"StorageVectorsApiError":"StorageApiError",this.status=r,this.statusCode=c}toJSON(){return{name:this.name,message:this.message,status:this.status,statusCode:this.statusCode}}},UD=class extends r1{constructor(n,r,c="storage"){super(n,c),this.name=c==="vectors"?"StorageVectorsUnknownError":"StorageUnknownError",this.originalError=r}};const $6=n=>n?(...r)=>n(...r):(...r)=>fetch(...r),G6=n=>{if(typeof n!="object"||n===null)return!1;const r=Object.getPrototypeOf(n);return(r===null||r===Object.prototype||Object.getPrototypeOf(r)===null)&&!(Symbol.toStringTag in n)&&!(Symbol.iterator in n)},hT=n=>{if(Array.isArray(n))return n.map(c=>hT(c));if(typeof n=="function"||n!==Object(n))return n;const r={};return Object.entries(n).forEach(([c,p])=>{const v=c.replace(/([-_][a-z])/gi,w=>w.toUpperCase().replace(/[-_]/g,""));r[v]=hT(p)}),r},H6=n=>!n||typeof n!="string"||n.length===0||n.length>100||n.trim()!==n||n.includes("/")||n.includes("\\")?!1:/^[\w!.\*'() &$@=;:+,?-]+$/.test(n);function P_(n){"@babel/helpers - typeof";return P_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},P_(n)}function W6(n,r){if(P_(n)!="object"||!n)return n;var c=n[Symbol.toPrimitive];if(c!==void 0){var p=c.call(n,r);if(P_(p)!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}function q6(n){var r=W6(n,"string");return P_(r)=="symbol"?r:r+""}function Z6(n,r,c){return(r=q6(r))in n?Object.defineProperty(n,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[r]=c,n}function IP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function Gi(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?IP(Object(c),!0).forEach(function(p){Z6(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):IP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}const AP=n=>{var r;return n.msg||n.message||n.error_description||(typeof n.error=="string"?n.error:(r=n.error)===null||r===void 0?void 0:r.message)||JSON.stringify(n)},X6=async(n,r,c,p)=>{if(n&&typeof n=="object"&&"status"in n&&"ok"in n&&typeof n.status=="number"&&!(c!=null&&c.noResolveJson)){const v=n,w=v.status||500;if(typeof v.json=="function")v.json().then(A=>{const o=(A==null?void 0:A.statusCode)||(A==null?void 0:A.code)||w+"";r(new D0(AP(A),w,o,p))}).catch(()=>{if(p==="vectors"){const A=w+"";r(new D0(v.statusText||`HTTP ${w} error`,w,A,p))}else{const A=w+"";r(new D0(v.statusText||`HTTP ${w} error`,w,A,p))}});else{const A=w+"";r(new D0(v.statusText||`HTTP ${w} error`,w,A,p))}}else r(new UD(AP(n),n,p))},K6=(n,r,c,p)=>{const v={method:n,headers:(r==null?void 0:r.headers)||{}};return n==="GET"||n==="HEAD"||!p?Gi(Gi({},v),c):(G6(p)?(v.headers=Gi({"Content-Type":"application/json"},r==null?void 0:r.headers),v.body=JSON.stringify(p)):v.body=p,r!=null&&r.duplex&&(v.duplex=r.duplex),Gi(Gi({},v),c))};async function Gg(n,r,c,p,v,w,A){return new Promise((o,D)=>{n(c,K6(r,p,v,w)).then(j=>{if(!j.ok)throw j;if(p!=null&&p.noResolveJson)return j;if(A==="vectors"){const J=j.headers.get("content-type");if(!J||!J.includes("application/json"))return{}}return j.json()}).then(j=>o(j)).catch(j=>X6(j,D,p,A))})}function Y6(n="storage"){return{get:async(r,c,p,v)=>Gg(r,"GET",c,p,v,void 0,n),post:async(r,c,p,v,w)=>Gg(r,"POST",c,v,w,p,n),put:async(r,c,p,v,w)=>Gg(r,"PUT",c,v,w,p,n),head:async(r,c,p,v)=>Gg(r,"HEAD",c,Gi(Gi({},p),{},{noResolveJson:!0}),v,void 0,n),remove:async(r,c,p,v,w)=>Gg(r,"DELETE",c,v,w,p,n)}}const J6=Y6("storage"),{get:M_,post:hn,put:dT,head:Q6,remove:S2}=J6;var xp=class{constructor(n,r={},c,p="storage"){this.shouldThrowOnError=!1,this.url=n,this.headers=r,this.fetch=$6(c),this.namespace=p}throwOnError(){return this.shouldThrowOnError=!0,this}async handleOperation(n){var r=this;try{return{data:await n(),error:null}}catch(c){if(r.shouldThrowOnError)throw c;if(n1(c))return{data:null,error:c};throw c}}},eV=class{constructor(n,r){this.downloadFn=n,this.shouldThrowOnError=r}then(n,r){return this.execute().then(n,r)}async execute(){var n=this;try{return{data:(await n.downloadFn()).body,error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(n1(r))return{data:null,error:r};throw r}}};let VD;VD=Symbol.toStringTag;var tV=class{constructor(n,r){this.downloadFn=n,this.shouldThrowOnError=r,this[VD]="BlobDownloadBuilder",this.promise=null}asStream(){return new eV(this.downloadFn,this.shouldThrowOnError)}then(n,r){return this.getPromise().then(n,r)}catch(n){return this.getPromise().catch(n)}finally(n){return this.getPromise().finally(n)}getPromise(){return this.promise||(this.promise=this.execute()),this.promise}async execute(){var n=this;try{return{data:await(await n.downloadFn()).blob(),error:null}}catch(r){if(n.shouldThrowOnError)throw r;if(n1(r))return{data:null,error:r};throw r}}};const iV={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},CP={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};var rV=class extends xp{constructor(n,r={},c,p){super(n,r,p,"storage"),this.bucketId=c}async uploadOrUpdate(n,r,c,p){var v=this;return v.handleOperation(async()=>{let w;const A=Gi(Gi({},CP),p);let o=Gi(Gi({},v.headers),n==="POST"&&{"x-upsert":String(A.upsert)});const D=A.metadata;typeof Blob<"u"&&c instanceof Blob?(w=new FormData,w.append("cacheControl",A.cacheControl),D&&w.append("metadata",v.encodeMetadata(D)),w.append("",c)):typeof FormData<"u"&&c instanceof FormData?(w=c,w.has("cacheControl")||w.append("cacheControl",A.cacheControl),D&&!w.has("metadata")&&w.append("metadata",v.encodeMetadata(D))):(w=c,o["cache-control"]=`max-age=${A.cacheControl}`,o["content-type"]=A.contentType,D&&(o["x-metadata"]=v.toBase64(v.encodeMetadata(D))),(typeof ReadableStream<"u"&&w instanceof ReadableStream||w&&typeof w=="object"&&"pipe"in w&&typeof w.pipe=="function")&&!A.duplex&&(A.duplex="half")),p!=null&&p.headers&&(o=Gi(Gi({},o),p.headers));const j=v._removeEmptyFolders(r),J=v._getFinalPath(j),ie=await(n=="PUT"?dT:hn)(v.fetch,`${v.url}/object/${J}`,w,Gi({headers:o},A!=null&&A.duplex?{duplex:A.duplex}:{}));return{path:j,id:ie.Id,fullPath:ie.Key}})}async upload(n,r,c){return this.uploadOrUpdate("POST",n,r,c)}async uploadToSignedUrl(n,r,c,p){var v=this;const w=v._removeEmptyFolders(n),A=v._getFinalPath(w),o=new URL(v.url+`/object/upload/sign/${A}`);return o.searchParams.set("token",r),v.handleOperation(async()=>{let D;const j=Gi({upsert:CP.upsert},p),J=Gi(Gi({},v.headers),{"x-upsert":String(j.upsert)});return typeof Blob<"u"&&c instanceof Blob?(D=new FormData,D.append("cacheControl",j.cacheControl),D.append("",c)):typeof FormData<"u"&&c instanceof FormData?(D=c,D.append("cacheControl",j.cacheControl)):(D=c,J["cache-control"]=`max-age=${j.cacheControl}`,J["content-type"]=j.contentType),{path:w,fullPath:(await dT(v.fetch,o.toString(),D,{headers:J})).Key}})}async createSignedUploadUrl(n,r){var c=this;return c.handleOperation(async()=>{let p=c._getFinalPath(n);const v=Gi({},c.headers);r!=null&&r.upsert&&(v["x-upsert"]="true");const w=await hn(c.fetch,`${c.url}/object/upload/sign/${p}`,{},{headers:v}),A=new URL(c.url+w.url),o=A.searchParams.get("token");if(!o)throw new r1("No token returned by API");return{signedUrl:A.toString(),path:n,token:o}})}async update(n,r,c){return this.uploadOrUpdate("PUT",n,r,c)}async move(n,r,c){var p=this;return p.handleOperation(async()=>await hn(p.fetch,`${p.url}/object/move`,{bucketId:p.bucketId,sourceKey:n,destinationKey:r,destinationBucket:c==null?void 0:c.destinationBucket},{headers:p.headers}))}async copy(n,r,c){var p=this;return p.handleOperation(async()=>({path:(await hn(p.fetch,`${p.url}/object/copy`,{bucketId:p.bucketId,sourceKey:n,destinationKey:r,destinationBucket:c==null?void 0:c.destinationBucket},{headers:p.headers})).Key}))}async createSignedUrl(n,r,c){var p=this;return p.handleOperation(async()=>{let v=p._getFinalPath(n),w=await hn(p.fetch,`${p.url}/object/sign/${v}`,Gi({expiresIn:r},c!=null&&c.transform?{transform:c.transform}:{}),{headers:p.headers});const A=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return{signedUrl:encodeURI(`${p.url}${w.signedURL}${A}`)}})}async createSignedUrls(n,r,c){var p=this;return p.handleOperation(async()=>{const v=await hn(p.fetch,`${p.url}/object/sign/${p.bucketId}`,{expiresIn:r,paths:n},{headers:p.headers}),w=c!=null&&c.download?`&download=${c.download===!0?"":c.download}`:"";return v.map(A=>Gi(Gi({},A),{},{signedUrl:A.signedURL?encodeURI(`${p.url}${A.signedURL}${w}`):null}))})}download(n,r){const c=typeof(r==null?void 0:r.transform)<"u"?"render/image/authenticated":"object",p=this.transformOptsToQueryString((r==null?void 0:r.transform)||{}),v=p?`?${p}`:"",w=this._getFinalPath(n),A=()=>M_(this.fetch,`${this.url}/${c}/${w}${v}`,{headers:this.headers,noResolveJson:!0});return new tV(A,this.shouldThrowOnError)}async info(n){var r=this;const c=r._getFinalPath(n);return r.handleOperation(async()=>hT(await M_(r.fetch,`${r.url}/object/info/${c}`,{headers:r.headers})))}async exists(n){var r=this;const c=r._getFinalPath(n);try{return await Q6(r.fetch,`${r.url}/object/${c}`,{headers:r.headers}),{data:!0,error:null}}catch(p){if(r.shouldThrowOnError)throw p;if(n1(p)&&p instanceof UD){const v=p.originalError;if([400,404].includes(v==null?void 0:v.status))return{data:!1,error:p}}throw p}}getPublicUrl(n,r){const c=this._getFinalPath(n),p=[],v=r!=null&&r.download?`download=${r.download===!0?"":r.download}`:"";v!==""&&p.push(v);const w=typeof(r==null?void 0:r.transform)<"u"?"render/image":"object",A=this.transformOptsToQueryString((r==null?void 0:r.transform)||{});A!==""&&p.push(A);let o=p.join("&");return o!==""&&(o=`?${o}`),{data:{publicUrl:encodeURI(`${this.url}/${w}/public/${c}${o}`)}}}async remove(n){var r=this;return r.handleOperation(async()=>await S2(r.fetch,`${r.url}/object/${r.bucketId}`,{prefixes:n},{headers:r.headers}))}async list(n,r,c){var p=this;return p.handleOperation(async()=>{const v=Gi(Gi(Gi({},iV),r),{},{prefix:n||""});return await hn(p.fetch,`${p.url}/object/list/${p.bucketId}`,v,{headers:p.headers},c)})}async listV2(n,r){var c=this;return c.handleOperation(async()=>{const p=Gi({},n);return await hn(c.fetch,`${c.url}/object/list-v2/${c.bucketId}`,p,{headers:c.headers},r)})}encodeMetadata(n){return JSON.stringify(n)}toBase64(n){return typeof Buffer<"u"?Buffer.from(n).toString("base64"):btoa(n)}_getFinalPath(n){return`${this.bucketId}/${n.replace(/^\/+/,"")}`}_removeEmptyFolders(n){return n.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(n){const r=[];return n.width&&r.push(`width=${n.width}`),n.height&&r.push(`height=${n.height}`),n.resize&&r.push(`resize=${n.resize}`),n.format&&r.push(`format=${n.format}`),n.quality&&r.push(`quality=${n.quality}`),r.join("&")}};const nV="2.93.1",V_={"X-Client-Info":`storage-js/${nV}`};var sV=class extends xp{constructor(n,r={},c,p){const v=new URL(n);p!=null&&p.useNewHostname&&/supabase\.(co|in|red)$/.test(v.hostname)&&!v.hostname.includes("storage.supabase.")&&(v.hostname=v.hostname.replace("supabase.","storage.supabase."));const w=v.href.replace(/\/$/,""),A=Gi(Gi({},V_),r);super(w,A,c,"storage")}async listBuckets(n){var r=this;return r.handleOperation(async()=>{const c=r.listBucketOptionsToQueryString(n);return await M_(r.fetch,`${r.url}/bucket${c}`,{headers:r.headers})})}async getBucket(n){var r=this;return r.handleOperation(async()=>await M_(r.fetch,`${r.url}/bucket/${n}`,{headers:r.headers}))}async createBucket(n,r={public:!1}){var c=this;return c.handleOperation(async()=>await hn(c.fetch,`${c.url}/bucket`,{id:n,name:n,type:r.type,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:c.headers}))}async updateBucket(n,r){var c=this;return c.handleOperation(async()=>await dT(c.fetch,`${c.url}/bucket/${n}`,{id:n,name:n,public:r.public,file_size_limit:r.fileSizeLimit,allowed_mime_types:r.allowedMimeTypes},{headers:c.headers}))}async emptyBucket(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/bucket/${n}/empty`,{},{headers:r.headers}))}async deleteBucket(n){var r=this;return r.handleOperation(async()=>await S2(r.fetch,`${r.url}/bucket/${n}`,{},{headers:r.headers}))}listBucketOptionsToQueryString(n){const r={};return n&&("limit"in n&&(r.limit=String(n.limit)),"offset"in n&&(r.offset=String(n.offset)),n.search&&(r.search=n.search),n.sortColumn&&(r.sortColumn=n.sortColumn),n.sortOrder&&(r.sortOrder=n.sortOrder)),Object.keys(r).length>0?"?"+new URLSearchParams(r).toString():""}},oV=class extends xp{constructor(n,r={},c){const p=n.replace(/\/$/,""),v=Gi(Gi({},V_),r);super(p,v,c,"storage")}async createBucket(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/bucket`,{name:n},{headers:r.headers}))}async listBuckets(n){var r=this;return r.handleOperation(async()=>{const c=new URLSearchParams;(n==null?void 0:n.limit)!==void 0&&c.set("limit",n.limit.toString()),(n==null?void 0:n.offset)!==void 0&&c.set("offset",n.offset.toString()),n!=null&&n.sortColumn&&c.set("sortColumn",n.sortColumn),n!=null&&n.sortOrder&&c.set("sortOrder",n.sortOrder),n!=null&&n.search&&c.set("search",n.search);const p=c.toString(),v=p?`${r.url}/bucket?${p}`:`${r.url}/bucket`;return await M_(r.fetch,v,{headers:r.headers})})}async deleteBucket(n){var r=this;return r.handleOperation(async()=>await S2(r.fetch,`${r.url}/bucket/${n}`,{},{headers:r.headers}))}from(n){var r=this;if(!H6(n))throw new r1("Invalid bucket name: File, folder, and bucket names must follow AWS object key naming guidelines and should avoid the use of any other characters.");const c=new V6({baseUrl:this.url,catalogName:n,auth:{type:"custom",getHeaders:async()=>r.headers},fetch:this.fetch}),p=this.shouldThrowOnError;return new Proxy(c,{get(v,w){const A=v[w];return typeof A!="function"?A:async(...o)=>{try{return{data:await A.apply(v,o),error:null}}catch(D){if(p)throw D;return{data:null,error:D}}}}})}},aV=class extends xp{constructor(n,r={},c){const p=n.replace(/\/$/,""),v=Gi(Gi({},V_),{},{"Content-Type":"application/json"},r);super(p,v,c,"vectors")}async createIndex(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/CreateIndex`,n,{headers:r.headers})||{})}async getIndex(n,r){var c=this;return c.handleOperation(async()=>await hn(c.fetch,`${c.url}/GetIndex`,{vectorBucketName:n,indexName:r},{headers:c.headers}))}async listIndexes(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/ListIndexes`,n,{headers:r.headers}))}async deleteIndex(n,r){var c=this;return c.handleOperation(async()=>await hn(c.fetch,`${c.url}/DeleteIndex`,{vectorBucketName:n,indexName:r},{headers:c.headers})||{})}},lV=class extends xp{constructor(n,r={},c){const p=n.replace(/\/$/,""),v=Gi(Gi({},V_),{},{"Content-Type":"application/json"},r);super(p,v,c,"vectors")}async putVectors(n){var r=this;if(n.vectors.length<1||n.vectors.length>500)throw new Error("Vector batch size must be between 1 and 500 items");return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/PutVectors`,n,{headers:r.headers})||{})}async getVectors(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/GetVectors`,n,{headers:r.headers}))}async listVectors(n){var r=this;if(n.segmentCount!==void 0){if(n.segmentCount<1||n.segmentCount>16)throw new Error("segmentCount must be between 1 and 16");if(n.segmentIndex!==void 0&&(n.segmentIndex<0||n.segmentIndex>=n.segmentCount))throw new Error(`segmentIndex must be between 0 and ${n.segmentCount-1}`)}return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/ListVectors`,n,{headers:r.headers}))}async queryVectors(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/QueryVectors`,n,{headers:r.headers}))}async deleteVectors(n){var r=this;if(n.keys.length<1||n.keys.length>500)throw new Error("Keys batch size must be between 1 and 500 items");return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/DeleteVectors`,n,{headers:r.headers})||{})}},cV=class extends xp{constructor(n,r={},c){const p=n.replace(/\/$/,""),v=Gi(Gi({},V_),{},{"Content-Type":"application/json"},r);super(p,v,c,"vectors")}async createBucket(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/CreateVectorBucket`,{vectorBucketName:n},{headers:r.headers})||{})}async getBucket(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/GetVectorBucket`,{vectorBucketName:n},{headers:r.headers}))}async listBuckets(n={}){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/ListVectorBuckets`,n,{headers:r.headers}))}async deleteBucket(n){var r=this;return r.handleOperation(async()=>await hn(r.fetch,`${r.url}/DeleteVectorBucket`,{vectorBucketName:n},{headers:r.headers})||{})}},uV=class extends cV{constructor(n,r={}){super(n,r.headers||{},r.fetch)}from(n){return new hV(this.url,this.headers,n,this.fetch)}async createBucket(n){var r=()=>super.createBucket,c=this;return r().call(c,n)}async getBucket(n){var r=()=>super.getBucket,c=this;return r().call(c,n)}async listBuckets(n={}){var r=()=>super.listBuckets,c=this;return r().call(c,n)}async deleteBucket(n){var r=()=>super.deleteBucket,c=this;return r().call(c,n)}},hV=class extends aV{constructor(n,r,c,p){super(n,r,p),this.vectorBucketName=c}async createIndex(n){var r=()=>super.createIndex,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName}))}async listIndexes(n={}){var r=()=>super.listIndexes,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName}))}async getIndex(n){var r=()=>super.getIndex,c=this;return r().call(c,c.vectorBucketName,n)}async deleteIndex(n){var r=()=>super.deleteIndex,c=this;return r().call(c,c.vectorBucketName,n)}index(n){return new dV(this.url,this.headers,this.vectorBucketName,n,this.fetch)}},dV=class extends lV{constructor(n,r,c,p,v){super(n,r,v),this.vectorBucketName=c,this.indexName=p}async putVectors(n){var r=()=>super.putVectors,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName,indexName:c.indexName}))}async getVectors(n){var r=()=>super.getVectors,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName,indexName:c.indexName}))}async listVectors(n={}){var r=()=>super.listVectors,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName,indexName:c.indexName}))}async queryVectors(n){var r=()=>super.queryVectors,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName,indexName:c.indexName}))}async deleteVectors(n){var r=()=>super.deleteVectors,c=this;return r().call(c,Gi(Gi({},n),{},{vectorBucketName:c.vectorBucketName,indexName:c.indexName}))}},fV=class extends sV{constructor(n,r={},c,p){super(n,r,c,p)}from(n){return new rV(this.url,this.headers,n,this.fetch)}get vectors(){return new uV(this.url+"/vector",{headers:this.headers,fetch:this.fetch})}get analytics(){return new oV(this.url+"/iceberg",this.headers,this.fetch)}};const $D="2.93.1",Of=30*1e3,fT=3,Xw=fT*Of,pV="http://localhost:9999",mV="supabase.auth.token",gV={"X-Client-Info":`gotrue-js/${$D}`},pT="X-Supabase-Api-Version",GD={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},_V=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,yV=10*60*1e3;class R_ extends Error{constructor(r,c,p){super(r),this.__isAuthError=!0,this.name="AuthError",this.status=c,this.code=p}}function Ei(n){return typeof n=="object"&&n!==null&&"__isAuthError"in n}class vV extends R_{constructor(r,c,p){super(r,c,p),this.name="AuthApiError",this.status=c,this.code=p}}function xV(n){return Ei(n)&&n.name==="AuthApiError"}class Nh extends R_{constructor(r,c){super(r),this.name="AuthUnknownError",this.originalError=c}}class mc extends R_{constructor(r,c,p,v){super(r,p,v),this.name=c,this.status=p}}class Ho extends mc{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Kw(n){return Ei(n)&&n.name==="AuthSessionMissingError"}class Cf extends mc{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class O0 extends mc{constructor(r){super(r,"AuthInvalidCredentialsError",400,void 0)}}class z0 extends mc{constructor(r,c=null){super(r,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=c}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function bV(n){return Ei(n)&&n.name==="AuthImplicitGrantRedirectError"}class kP extends mc{constructor(r,c=null){super(r,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=c}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class wV extends mc{constructor(){super("PKCE code verifier not found in storage. This can happen if the auth flow was initiated in a different browser or device, or if the storage was cleared. For SSR frameworks (Next.js, SvelteKit, etc.), use @supabase/ssr on both the server and client to store the code verifier in cookies.","AuthPKCECodeVerifierMissingError",400,"pkce_code_verifier_not_found")}}class mT extends mc{constructor(r,c){super(r,"AuthRetryableFetchError",c,void 0)}}function Yw(n){return Ei(n)&&n.name==="AuthRetryableFetchError"}class LP extends mc{constructor(r,c,p){super(r,"AuthWeakPasswordError",c,"weak_password"),this.reasons=p}}class gT extends mc{constructor(r){super(r,"AuthInvalidJwtError",400,"invalid_jwt")}}const Mx="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),PP=` 	
\r=`.split(""),SV=(()=>{const n=new Array(128);for(let r=0;r<n.length;r+=1)n[r]=-1;for(let r=0;r<PP.length;r+=1)n[PP[r].charCodeAt(0)]=-2;for(let r=0;r<Mx.length;r+=1)n[Mx[r].charCodeAt(0)]=r;return n})();function MP(n,r,c){if(n!==null)for(r.queue=r.queue<<8|n,r.queuedBits+=8;r.queuedBits>=6;){const p=r.queue>>r.queuedBits-6&63;c(Mx[p]),r.queuedBits-=6}else if(r.queuedBits>0)for(r.queue=r.queue<<6-r.queuedBits,r.queuedBits=6;r.queuedBits>=6;){const p=r.queue>>r.queuedBits-6&63;c(Mx[p]),r.queuedBits-=6}}function HD(n,r,c){const p=SV[n];if(p>-1)for(r.queue=r.queue<<6|p,r.queuedBits+=6;r.queuedBits>=8;)c(r.queue>>r.queuedBits-8&255),r.queuedBits-=8;else{if(p===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(n)}"`)}}function RP(n){const r=[],c=A=>{r.push(String.fromCodePoint(A))},p={utf8seq:0,codepoint:0},v={queue:0,queuedBits:0},w=A=>{IV(A,p,c)};for(let A=0;A<n.length;A+=1)HD(n.charCodeAt(A),v,w);return r.join("")}function TV(n,r){if(n<=127){r(n);return}else if(n<=2047){r(192|n>>6),r(128|n&63);return}else if(n<=65535){r(224|n>>12),r(128|n>>6&63),r(128|n&63);return}else if(n<=1114111){r(240|n>>18),r(128|n>>12&63),r(128|n>>6&63),r(128|n&63);return}throw new Error(`Unrecognized Unicode codepoint: ${n.toString(16)}`)}function EV(n,r){for(let c=0;c<n.length;c+=1){let p=n.charCodeAt(c);if(p>55295&&p<=56319){const v=(p-55296)*1024&65535;p=(n.charCodeAt(c+1)-56320&65535|v)+65536,c+=1}TV(p,r)}}function IV(n,r,c){if(r.utf8seq===0){if(n<=127){c(n);return}for(let p=1;p<6;p+=1)if(!(n>>7-p&1)){r.utf8seq=p;break}if(r.utf8seq===2)r.codepoint=n&31;else if(r.utf8seq===3)r.codepoint=n&15;else if(r.utf8seq===4)r.codepoint=n&7;else throw new Error("Invalid UTF-8 sequence");r.utf8seq-=1}else if(r.utf8seq>0){if(n<=127)throw new Error("Invalid UTF-8 sequence");r.codepoint=r.codepoint<<6|n&63,r.utf8seq-=1,r.utf8seq===0&&c(r.codepoint)}}function np(n){const r=[],c={queue:0,queuedBits:0},p=v=>{r.push(v)};for(let v=0;v<n.length;v+=1)HD(n.charCodeAt(v),c,p);return new Uint8Array(r)}function AV(n){const r=[];return EV(n,c=>r.push(c)),new Uint8Array(r)}function Gh(n){const r=[],c={queue:0,queuedBits:0},p=v=>{r.push(v)};return n.forEach(v=>MP(v,c,p)),MP(null,c,p),r.join("")}function CV(n){return Math.round(Date.now()/1e3)+n}function kV(){return Symbol("auth-callback")}const Is=()=>typeof window<"u"&&typeof document<"u",Rh={tested:!1,writable:!1},WD=()=>{if(!Is())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Rh.tested)return Rh.writable;const n=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(n,n),globalThis.localStorage.removeItem(n),Rh.tested=!0,Rh.writable=!0}catch{Rh.tested=!0,Rh.writable=!1}return Rh.writable};function LV(n){const r={},c=new URL(n);if(c.hash&&c.hash[0]==="#")try{new URLSearchParams(c.hash.substring(1)).forEach((v,w)=>{r[w]=v})}catch{}return c.searchParams.forEach((p,v)=>{r[v]=p}),r}const qD=n=>n?(...r)=>n(...r):(...r)=>fetch(...r),PV=n=>typeof n=="object"&&n!==null&&"status"in n&&"ok"in n&&"json"in n&&typeof n.json=="function",zf=async(n,r,c)=>{await n.setItem(r,JSON.stringify(c))},Dh=async(n,r)=>{const c=await n.getItem(r);if(!c)return null;try{return JSON.parse(c)}catch{return c}},Es=async(n,r)=>{await n.removeItem(r)};class s1{constructor(){this.promise=new s1.promiseConstructor((r,c)=>{this.resolve=r,this.reject=c})}}s1.promiseConstructor=Promise;function B0(n){const r=n.split(".");if(r.length!==3)throw new gT("Invalid JWT structure");for(let p=0;p<r.length;p++)if(!_V.test(r[p]))throw new gT("JWT not in base64url format");return{header:JSON.parse(RP(r[0])),payload:JSON.parse(RP(r[1])),signature:np(r[2]),raw:{header:r[0],payload:r[1]}}}async function MV(n){return await new Promise(r=>{setTimeout(()=>r(null),n)})}function RV(n,r){return new Promise((p,v)=>{(async()=>{for(let w=0;w<1/0;w++)try{const A=await n(w);if(!r(w,null,A)){p(A);return}}catch(A){if(!r(w,A)){v(A);return}}})()})}function DV(n){return("0"+n.toString(16)).substr(-2)}function OV(){const r=new Uint32Array(56);if(typeof crypto>"u"){const c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",p=c.length;let v="";for(let w=0;w<56;w++)v+=c.charAt(Math.floor(Math.random()*p));return v}return crypto.getRandomValues(r),Array.from(r,DV).join("")}async function zV(n){const c=new TextEncoder().encode(n),p=await crypto.subtle.digest("SHA-256",c),v=new Uint8Array(p);return Array.from(v).map(w=>String.fromCharCode(w)).join("")}async function BV(n){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),n;const c=await zV(n);return btoa(c).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function kf(n,r,c=!1){const p=OV();let v=p;c&&(v+="/PASSWORD_RECOVERY"),await zf(n,`${r}-code-verifier`,v);const w=await BV(p);return[w,p===w?"plain":"s256"]}const FV=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function jV(n){const r=n.headers.get(pT);if(!r||!r.match(FV))return null;try{return new Date(`${r}T00:00:00.0Z`)}catch{return null}}function NV(n){if(!n)throw new Error("Missing exp claim");const r=Math.floor(Date.now()/1e3);if(n<=r)throw new Error("JWT has expired")}function UV(n){switch(n){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const VV=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function Lf(n){if(!VV.test(n))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function Jw(){const n={};return new Proxy(n,{get:(r,c)=>{if(c==="__isUserNotAvailableProxy")return!0;if(typeof c=="symbol"){const p=c.toString();if(p==="Symbol(Symbol.toPrimitive)"||p==="Symbol(Symbol.toStringTag)"||p==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${c}" property of the session object is not supported. Please use getUser() instead.`)},set:(r,c)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${c}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(r,c)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${c}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function $V(n,r){return new Proxy(n,{get:(c,p,v)=>{if(p==="__isInsecureUserWarningProxy")return!0;if(typeof p=="symbol"){const w=p.toString();if(w==="Symbol(Symbol.toPrimitive)"||w==="Symbol(Symbol.toStringTag)"||w==="Symbol(util.inspect.custom)"||w==="Symbol(nodejs.util.inspect.custom)")return Reflect.get(c,p,v)}return!r.value&&typeof p=="string"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),r.value=!0),Reflect.get(c,p,v)}})}function DP(n){return JSON.parse(JSON.stringify(n))}const Bh=n=>n.msg||n.message||n.error_description||n.error||JSON.stringify(n),GV=[502,503,504];async function OP(n){var r;if(!PV(n))throw new mT(Bh(n),0);if(GV.includes(n.status))throw new mT(Bh(n),n.status);let c;try{c=await n.json()}catch(w){throw new Nh(Bh(w),w)}let p;const v=jV(n);if(v&&v.getTime()>=GD["2024-01-01"].timestamp&&typeof c=="object"&&c&&typeof c.code=="string"?p=c.code:typeof c=="object"&&c&&typeof c.error_code=="string"&&(p=c.error_code),p){if(p==="weak_password")throw new LP(Bh(c),n.status,((r=c.weak_password)===null||r===void 0?void 0:r.reasons)||[]);if(p==="session_not_found")throw new Ho}else if(typeof c=="object"&&c&&typeof c.weak_password=="object"&&c.weak_password&&Array.isArray(c.weak_password.reasons)&&c.weak_password.reasons.length&&c.weak_password.reasons.reduce((w,A)=>w&&typeof A=="string",!0))throw new LP(Bh(c),n.status,c.weak_password.reasons);throw new vV(Bh(c),n.status||500,p)}const HV=(n,r,c,p)=>{const v={method:n,headers:(r==null?void 0:r.headers)||{}};return n==="GET"?v:(v.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},r==null?void 0:r.headers),v.body=JSON.stringify(p),Object.assign(Object.assign({},v),c))};async function Vi(n,r,c,p){var v;const w=Object.assign({},p==null?void 0:p.headers);w[pT]||(w[pT]=GD["2024-01-01"].name),p!=null&&p.jwt&&(w.Authorization=`Bearer ${p.jwt}`);const A=(v=p==null?void 0:p.query)!==null&&v!==void 0?v:{};p!=null&&p.redirectTo&&(A.redirect_to=p.redirectTo);const o=Object.keys(A).length?"?"+new URLSearchParams(A).toString():"",D=await WV(n,r,c+o,{headers:w,noResolveJson:p==null?void 0:p.noResolveJson},{},p==null?void 0:p.body);return p!=null&&p.xform?p==null?void 0:p.xform(D):{data:Object.assign({},D),error:null}}async function WV(n,r,c,p,v,w){const A=HV(r,p,v,w);let o;try{o=await n(c,Object.assign({},A))}catch(D){throw console.error(D),new mT(Bh(D),0)}if(o.ok||await OP(o),p!=null&&p.noResolveJson)return o;try{return await o.json()}catch(D){await OP(D)}}function Ha(n){var r;let c=null;XV(n)&&(c=Object.assign({},n),n.expires_at||(c.expires_at=CV(n.expires_in)));const p=(r=n.user)!==null&&r!==void 0?r:n;return{data:{session:c,user:p},error:null}}function zP(n){const r=Ha(n);return!r.error&&n.weak_password&&typeof n.weak_password=="object"&&Array.isArray(n.weak_password.reasons)&&n.weak_password.reasons.length&&n.weak_password.message&&typeof n.weak_password.message=="string"&&n.weak_password.reasons.reduce((c,p)=>c&&typeof p=="string",!0)&&(r.data.weak_password=n.weak_password),r}function du(n){var r;return{data:{user:(r=n.user)!==null&&r!==void 0?r:n},error:null}}function qV(n){return{data:n,error:null}}function ZV(n){const{action_link:r,email_otp:c,hashed_token:p,redirect_to:v,verification_type:w}=n,A=i1(n,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:r,email_otp:c,hashed_token:p,redirect_to:v,verification_type:w},D=Object.assign({},A);return{data:{properties:o,user:D},error:null}}function BP(n){return n}function XV(n){return n.access_token&&n.refresh_token&&n.expires_in}const Qw=["global","local","others"];class KV{constructor({url:r="",headers:c={},fetch:p}){this.url=r,this.headers=c,this.fetch=qD(p),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)},this.oauth={listClients:this._listOAuthClients.bind(this),createClient:this._createOAuthClient.bind(this),getClient:this._getOAuthClient.bind(this),updateClient:this._updateOAuthClient.bind(this),deleteClient:this._deleteOAuthClient.bind(this),regenerateClientSecret:this._regenerateOAuthClientSecret.bind(this)}}async signOut(r,c=Qw[0]){if(Qw.indexOf(c)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${Qw.join(", ")}`);try{return await Vi(this.fetch,"POST",`${this.url}/logout?scope=${c}`,{headers:this.headers,jwt:r,noResolveJson:!0}),{data:null,error:null}}catch(p){if(Ei(p))return{data:null,error:p};throw p}}async inviteUserByEmail(r,c={}){try{return await Vi(this.fetch,"POST",`${this.url}/invite`,{body:{email:r,data:c.data},headers:this.headers,redirectTo:c.redirectTo,xform:du})}catch(p){if(Ei(p))return{data:{user:null},error:p};throw p}}async generateLink(r){try{const{options:c}=r,p=i1(r,["options"]),v=Object.assign(Object.assign({},p),c);return"newEmail"in p&&(v.new_email=p==null?void 0:p.newEmail,delete v.newEmail),await Vi(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:v,headers:this.headers,xform:ZV,redirectTo:c==null?void 0:c.redirectTo})}catch(c){if(Ei(c))return{data:{properties:null,user:null},error:c};throw c}}async createUser(r){try{return await Vi(this.fetch,"POST",`${this.url}/admin/users`,{body:r,headers:this.headers,xform:du})}catch(c){if(Ei(c))return{data:{user:null},error:c};throw c}}async listUsers(r){var c,p,v,w,A,o,D;try{const j={nextPage:null,lastPage:0,total:0},J=await Vi(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(p=(c=r==null?void 0:r.page)===null||c===void 0?void 0:c.toString())!==null&&p!==void 0?p:"",per_page:(w=(v=r==null?void 0:r.perPage)===null||v===void 0?void 0:v.toString())!==null&&w!==void 0?w:""},xform:BP});if(J.error)throw J.error;const ie=await J.json(),re=(A=J.headers.get("x-total-count"))!==null&&A!==void 0?A:0,he=(D=(o=J.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&D!==void 0?D:[];return he.length>0&&(he.forEach(ce=>{const xe=parseInt(ce.split(";")[0].split("=")[1].substring(0,1)),Ee=JSON.parse(ce.split(";")[1].split("=")[1]);j[`${Ee}Page`]=xe}),j.total=parseInt(re)),{data:Object.assign(Object.assign({},ie),j),error:null}}catch(j){if(Ei(j))return{data:{users:[]},error:j};throw j}}async getUserById(r){Lf(r);try{return await Vi(this.fetch,"GET",`${this.url}/admin/users/${r}`,{headers:this.headers,xform:du})}catch(c){if(Ei(c))return{data:{user:null},error:c};throw c}}async updateUserById(r,c){Lf(r);try{return await Vi(this.fetch,"PUT",`${this.url}/admin/users/${r}`,{body:c,headers:this.headers,xform:du})}catch(p){if(Ei(p))return{data:{user:null},error:p};throw p}}async deleteUser(r,c=!1){Lf(r);try{return await Vi(this.fetch,"DELETE",`${this.url}/admin/users/${r}`,{headers:this.headers,body:{should_soft_delete:c},xform:du})}catch(p){if(Ei(p))return{data:{user:null},error:p};throw p}}async _listFactors(r){Lf(r.userId);try{const{data:c,error:p}=await Vi(this.fetch,"GET",`${this.url}/admin/users/${r.userId}/factors`,{headers:this.headers,xform:v=>({data:{factors:v},error:null})});return{data:c,error:p}}catch(c){if(Ei(c))return{data:null,error:c};throw c}}async _deleteFactor(r){Lf(r.userId),Lf(r.id);try{return{data:await Vi(this.fetch,"DELETE",`${this.url}/admin/users/${r.userId}/factors/${r.id}`,{headers:this.headers}),error:null}}catch(c){if(Ei(c))return{data:null,error:c};throw c}}async _listOAuthClients(r){var c,p,v,w,A,o,D;try{const j={nextPage:null,lastPage:0,total:0},J=await Vi(this.fetch,"GET",`${this.url}/admin/oauth/clients`,{headers:this.headers,noResolveJson:!0,query:{page:(p=(c=r==null?void 0:r.page)===null||c===void 0?void 0:c.toString())!==null&&p!==void 0?p:"",per_page:(w=(v=r==null?void 0:r.perPage)===null||v===void 0?void 0:v.toString())!==null&&w!==void 0?w:""},xform:BP});if(J.error)throw J.error;const ie=await J.json(),re=(A=J.headers.get("x-total-count"))!==null&&A!==void 0?A:0,he=(D=(o=J.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&D!==void 0?D:[];return he.length>0&&(he.forEach(ce=>{const xe=parseInt(ce.split(";")[0].split("=")[1].substring(0,1)),Ee=JSON.parse(ce.split(";")[1].split("=")[1]);j[`${Ee}Page`]=xe}),j.total=parseInt(re)),{data:Object.assign(Object.assign({},ie),j),error:null}}catch(j){if(Ei(j))return{data:{clients:[]},error:j};throw j}}async _createOAuthClient(r){try{return await Vi(this.fetch,"POST",`${this.url}/admin/oauth/clients`,{body:r,headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(Ei(c))return{data:null,error:c};throw c}}async _getOAuthClient(r){try{return await Vi(this.fetch,"GET",`${this.url}/admin/oauth/clients/${r}`,{headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(Ei(c))return{data:null,error:c};throw c}}async _updateOAuthClient(r,c){try{return await Vi(this.fetch,"PUT",`${this.url}/admin/oauth/clients/${r}`,{body:c,headers:this.headers,xform:p=>({data:p,error:null})})}catch(p){if(Ei(p))return{data:null,error:p};throw p}}async _deleteOAuthClient(r){try{return await Vi(this.fetch,"DELETE",`${this.url}/admin/oauth/clients/${r}`,{headers:this.headers,noResolveJson:!0}),{data:null,error:null}}catch(c){if(Ei(c))return{data:null,error:c};throw c}}async _regenerateOAuthClientSecret(r){try{return await Vi(this.fetch,"POST",`${this.url}/admin/oauth/clients/${r}/regenerate_secret`,{headers:this.headers,xform:c=>({data:c,error:null})})}catch(c){if(Ei(c))return{data:null,error:c};throw c}}}function FP(n={}){return{getItem:r=>n[r]||null,setItem:(r,c)=>{n[r]=c},removeItem:r=>{delete n[r]}}}const Pf={debug:!!(globalThis&&WD()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class ZD extends Error{constructor(r){super(r),this.isAcquireTimeout=!0}}class YV extends ZD{}async function JV(n,r,c){Pf.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",n,r);const p=new globalThis.AbortController;return r>0&&setTimeout(()=>{p.abort(),Pf.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",n)},r),await Promise.resolve().then(()=>globalThis.navigator.locks.request(n,r===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:p.signal},async v=>{if(v){Pf.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",n,v.name);try{return await c()}finally{Pf.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",n,v.name)}}else{if(r===0)throw Pf.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",n),new YV(`Acquiring an exclusive Navigator LockManager lock "${n}" immediately failed`);if(Pf.debug)try{const w=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(w,null,"  "))}catch(w){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",w)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await c()}}))}function QV(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}function XD(n){if(!/^0x[a-fA-F0-9]{40}$/.test(n))throw new Error(`@supabase/auth-js: Address "${n}" is invalid.`);return n.toLowerCase()}function e8(n){return parseInt(n,16)}function t8(n){const r=new TextEncoder().encode(n);return"0x"+Array.from(r,p=>p.toString(16).padStart(2,"0")).join("")}function i8(n){var r;const{chainId:c,domain:p,expirationTime:v,issuedAt:w=new Date,nonce:A,notBefore:o,requestId:D,resources:j,scheme:J,uri:ie,version:re}=n;{if(!Number.isInteger(c))throw new Error(`@supabase/auth-js: Invalid SIWE message field "chainId". Chain ID must be a EIP-155 chain ID. Provided value: ${c}`);if(!p)throw new Error('@supabase/auth-js: Invalid SIWE message field "domain". Domain must be provided.');if(A&&A.length<8)throw new Error(`@supabase/auth-js: Invalid SIWE message field "nonce". Nonce must be at least 8 characters. Provided value: ${A}`);if(!ie)throw new Error('@supabase/auth-js: Invalid SIWE message field "uri". URI must be provided.');if(re!=="1")throw new Error(`@supabase/auth-js: Invalid SIWE message field "version". Version must be '1'. Provided value: ${re}`);if(!((r=n.statement)===null||r===void 0)&&r.includes(`
`))throw new Error(`@supabase/auth-js: Invalid SIWE message field "statement". Statement must not include '\\n'. Provided value: ${n.statement}`)}const he=XD(n.address),ce=J?`${J}://${p}`:p,xe=n.statement?`${n.statement}
`:"",Ee=`${ce} wants you to sign in with your Ethereum account:
${he}

${xe}`;let ve=`URI: ${ie}
Version: ${re}
Chain ID: ${c}${A?`
Nonce: ${A}`:""}
Issued At: ${w.toISOString()}`;if(v&&(ve+=`
Expiration Time: ${v.toISOString()}`),o&&(ve+=`
Not Before: ${o.toISOString()}`),D&&(ve+=`
Request ID: ${D}`),j){let K=`
Resources:`;for(const fe of j){if(!fe||typeof fe!="string")throw new Error(`@supabase/auth-js: Invalid SIWE message field "resources". Every resource must be a valid string. Provided value: ${fe}`);K+=`
- ${fe}`}ve+=K}return`${Ee}
${ve}`}class Un extends Error{constructor({message:r,code:c,cause:p,name:v}){var w;super(r,{cause:p}),this.__isWebAuthnError=!0,this.name=(w=v??(p instanceof Error?p.name:void 0))!==null&&w!==void 0?w:"Unknown Error",this.code=c}}class Rx extends Un{constructor(r,c){super({code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:c,message:r}),this.name="WebAuthnUnknownError",this.originalError=c}}function r8({error:n,options:r}){var c,p,v;const{publicKey:w}=r;if(!w)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(r.signal instanceof AbortSignal)return new Un({message:"Registration ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else if(n.name==="ConstraintError"){if(((c=w.authenticatorSelection)===null||c===void 0?void 0:c.requireResidentKey)===!0)return new Un({message:"Discoverable credentials were required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_DISCOVERABLE_CREDENTIAL_SUPPORT",cause:n});if(r.mediation==="conditional"&&((p=w.authenticatorSelection)===null||p===void 0?void 0:p.userVerification)==="required")return new Un({message:"User verification was required during automatic registration but it could not be performed",code:"ERROR_AUTO_REGISTER_USER_VERIFICATION_FAILURE",cause:n});if(((v=w.authenticatorSelection)===null||v===void 0?void 0:v.userVerification)==="required")return new Un({message:"User verification was required but no available authenticator supported it",code:"ERROR_AUTHENTICATOR_MISSING_USER_VERIFICATION_SUPPORT",cause:n})}else{if(n.name==="InvalidStateError")return new Un({message:"The authenticator was previously registered",code:"ERROR_AUTHENTICATOR_PREVIOUSLY_REGISTERED",cause:n});if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="NotSupportedError")return w.pubKeyCredParams.filter(o=>o.type==="public-key").length===0?new Un({message:'No entry in pubKeyCredParams was of type "public-key"',code:"ERROR_MALFORMED_PUBKEYCREDPARAMS",cause:n}):new Un({message:"No available authenticator supported any of the specified pubKeyCredParams algorithms",code:"ERROR_AUTHENTICATOR_NO_SUPPORTED_PUBKEYCREDPARAMS_ALG",cause:n});if(n.name==="SecurityError"){const A=window.location.hostname;if(KD(A)){if(w.rp.id!==A)return new Un({message:`The RP ID "${w.rp.id}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="TypeError"){if(w.user.id.byteLength<1||w.user.id.byteLength>64)return new Un({message:"User ID was not between 1 and 64 characters",code:"ERROR_INVALID_USER_ID_LENGTH",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new credential",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}function n8({error:n,options:r}){const{publicKey:c}=r;if(!c)throw Error("options was missing required publicKey property");if(n.name==="AbortError"){if(r.signal instanceof AbortSignal)return new Un({message:"Authentication ceremony was sent an abort signal",code:"ERROR_CEREMONY_ABORTED",cause:n})}else{if(n.name==="NotAllowedError")return new Un({message:n.message,code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n});if(n.name==="SecurityError"){const p=window.location.hostname;if(KD(p)){if(c.rpId!==p)return new Un({message:`The RP ID "${c.rpId}" is invalid for this domain`,code:"ERROR_INVALID_RP_ID",cause:n})}else return new Un({message:`${window.location.hostname} is an invalid domain`,code:"ERROR_INVALID_DOMAIN",cause:n})}else if(n.name==="UnknownError")return new Un({message:"The authenticator was unable to process the specified options, or could not create a new assertion signature",code:"ERROR_AUTHENTICATOR_GENERAL_ERROR",cause:n})}return new Un({message:"a Non-Webauthn related error has occurred",code:"ERROR_PASSTHROUGH_SEE_CAUSE_PROPERTY",cause:n})}class s8{createNewAbortSignal(){if(this.controller){const c=new Error("Cancelling existing WebAuthn API call for new one");c.name="AbortError",this.controller.abort(c)}const r=new AbortController;return this.controller=r,r.signal}cancelCeremony(){if(this.controller){const r=new Error("Manually cancelling existing WebAuthn API call");r.name="AbortError",this.controller.abort(r),this.controller=void 0}}}const o8=new s8;function a8(n){if(!n)throw new Error("Credential creation options are required");if(typeof PublicKeyCredential<"u"&&"parseCreationOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseCreationOptionsFromJSON=="function")return PublicKeyCredential.parseCreationOptionsFromJSON(n);const{challenge:r,user:c,excludeCredentials:p}=n,v=i1(n,["challenge","user","excludeCredentials"]),w=np(r).buffer,A=Object.assign(Object.assign({},c),{id:np(c.id).buffer}),o=Object.assign(Object.assign({},v),{challenge:w,user:A});if(p&&p.length>0){o.excludeCredentials=new Array(p.length);for(let D=0;D<p.length;D++){const j=p[D];o.excludeCredentials[D]=Object.assign(Object.assign({},j),{id:np(j.id).buffer,type:j.type||"public-key",transports:j.transports})}}return o}function l8(n){if(!n)throw new Error("Credential request options are required");if(typeof PublicKeyCredential<"u"&&"parseRequestOptionsFromJSON"in PublicKeyCredential&&typeof PublicKeyCredential.parseRequestOptionsFromJSON=="function")return PublicKeyCredential.parseRequestOptionsFromJSON(n);const{challenge:r,allowCredentials:c}=n,p=i1(n,["challenge","allowCredentials"]),v=np(r).buffer,w=Object.assign(Object.assign({},p),{challenge:v});if(c&&c.length>0){w.allowCredentials=new Array(c.length);for(let A=0;A<c.length;A++){const o=c[A];w.allowCredentials[A]=Object.assign(Object.assign({},o),{id:np(o.id).buffer,type:o.type||"public-key",transports:o.transports})}}return w}function c8(n){var r;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const c=n;return{id:n.id,rawId:n.id,response:{attestationObject:Gh(new Uint8Array(n.response.attestationObject)),clientDataJSON:Gh(new Uint8Array(n.response.clientDataJSON))},type:"public-key",clientExtensionResults:n.getClientExtensionResults(),authenticatorAttachment:(r=c.authenticatorAttachment)!==null&&r!==void 0?r:void 0}}function u8(n){var r;if("toJSON"in n&&typeof n.toJSON=="function")return n.toJSON();const c=n,p=n.getClientExtensionResults(),v=n.response;return{id:n.id,rawId:n.id,response:{authenticatorData:Gh(new Uint8Array(v.authenticatorData)),clientDataJSON:Gh(new Uint8Array(v.clientDataJSON)),signature:Gh(new Uint8Array(v.signature)),userHandle:v.userHandle?Gh(new Uint8Array(v.userHandle)):void 0},type:"public-key",clientExtensionResults:p,authenticatorAttachment:(r=c.authenticatorAttachment)!==null&&r!==void 0?r:void 0}}function KD(n){return n==="localhost"||/^([a-z0-9]+(-[a-z0-9]+)*\.)+[a-z]{2,}$/i.test(n)}function jP(){var n,r;return!!(Is()&&"PublicKeyCredential"in window&&window.PublicKeyCredential&&"credentials"in navigator&&typeof((n=navigator==null?void 0:navigator.credentials)===null||n===void 0?void 0:n.create)=="function"&&typeof((r=navigator==null?void 0:navigator.credentials)===null||r===void 0?void 0:r.get)=="function")}async function h8(n){try{const r=await navigator.credentials.create(n);return r?r instanceof PublicKeyCredential?{data:r,error:null}:{data:null,error:new Rx("Browser returned unexpected credential type",r)}:{data:null,error:new Rx("Empty credential response",r)}}catch(r){return{data:null,error:r8({error:r,options:n})}}}async function d8(n){try{const r=await navigator.credentials.get(n);return r?r instanceof PublicKeyCredential?{data:r,error:null}:{data:null,error:new Rx("Browser returned unexpected credential type",r)}:{data:null,error:new Rx("Empty credential response",r)}}catch(r){return{data:null,error:n8({error:r,options:n})}}}const f8={hints:["security-key"],authenticatorSelection:{authenticatorAttachment:"cross-platform",requireResidentKey:!1,userVerification:"preferred",residentKey:"discouraged"},attestation:"direct"},p8={userVerification:"preferred",hints:["security-key"],attestation:"direct"};function Dx(...n){const r=v=>v!==null&&typeof v=="object"&&!Array.isArray(v),c=v=>v instanceof ArrayBuffer||ArrayBuffer.isView(v),p={};for(const v of n)if(v)for(const w in v){const A=v[w];if(A!==void 0)if(Array.isArray(A))p[w]=A;else if(c(A))p[w]=A;else if(r(A)){const o=p[w];r(o)?p[w]=Dx(o,A):p[w]=Dx(A)}else p[w]=A}return p}function m8(n,r){return Dx(f8,n,r||{})}function g8(n,r){return Dx(p8,n,r||{})}class _8{constructor(r){this.client=r,this.enroll=this._enroll.bind(this),this.challenge=this._challenge.bind(this),this.verify=this._verify.bind(this),this.authenticate=this._authenticate.bind(this),this.register=this._register.bind(this)}async _enroll(r){return this.client.mfa.enroll(Object.assign(Object.assign({},r),{factorType:"webauthn"}))}async _challenge({factorId:r,webauthn:c,friendlyName:p,signal:v},w){try{const{data:A,error:o}=await this.client.mfa.challenge({factorId:r,webauthn:c});if(!A)return{data:null,error:o};const D=v??o8.createNewAbortSignal();if(A.webauthn.type==="create"){const{user:j}=A.webauthn.credential_options.publicKey;j.name||(j.name=`${j.id}:${p}`),j.displayName||(j.displayName=j.name)}switch(A.webauthn.type){case"create":{const j=m8(A.webauthn.credential_options.publicKey,w==null?void 0:w.create),{data:J,error:ie}=await h8({publicKey:j,signal:D});return J?{data:{factorId:r,challengeId:A.id,webauthn:{type:A.webauthn.type,credential_response:J}},error:null}:{data:null,error:ie}}case"request":{const j=g8(A.webauthn.credential_options.publicKey,w==null?void 0:w.request),{data:J,error:ie}=await d8(Object.assign(Object.assign({},A.webauthn.credential_options),{publicKey:j,signal:D}));return J?{data:{factorId:r,challengeId:A.id,webauthn:{type:A.webauthn.type,credential_response:J}},error:null}:{data:null,error:ie}}}}catch(A){return Ei(A)?{data:null,error:A}:{data:null,error:new Nh("Unexpected error in challenge",A)}}}async _verify({challengeId:r,factorId:c,webauthn:p}){return this.client.mfa.verify({factorId:c,challengeId:r,webauthn:p})}async _authenticate({factorId:r,webauthn:{rpId:c=typeof window<"u"?window.location.hostname:void 0,rpOrigins:p=typeof window<"u"?[window.location.origin]:void 0,signal:v}={}},w){if(!c)return{data:null,error:new R_("rpId is required for WebAuthn authentication")};try{if(!jP())return{data:null,error:new Nh("Browser does not support WebAuthn",null)};const{data:A,error:o}=await this.challenge({factorId:r,webauthn:{rpId:c,rpOrigins:p},signal:v},{request:w});if(!A)return{data:null,error:o};const{webauthn:D}=A;return this._verify({factorId:r,challengeId:A.challengeId,webauthn:{type:D.type,rpId:c,rpOrigins:p,credential_response:D.credential_response}})}catch(A){return Ei(A)?{data:null,error:A}:{data:null,error:new Nh("Unexpected error in authenticate",A)}}}async _register({friendlyName:r,webauthn:{rpId:c=typeof window<"u"?window.location.hostname:void 0,rpOrigins:p=typeof window<"u"?[window.location.origin]:void 0,signal:v}={}},w){if(!c)return{data:null,error:new R_("rpId is required for WebAuthn registration")};try{if(!jP())return{data:null,error:new Nh("Browser does not support WebAuthn",null)};const{data:A,error:o}=await this._enroll({friendlyName:r});if(!A)return await this.client.mfa.listFactors().then(J=>{var ie;return(ie=J.data)===null||ie===void 0?void 0:ie.all.find(re=>re.factor_type==="webauthn"&&re.friendly_name===r&&re.status!=="unverified")}).then(J=>J?this.client.mfa.unenroll({factorId:J==null?void 0:J.id}):void 0),{data:null,error:o};const{data:D,error:j}=await this._challenge({factorId:A.id,friendlyName:A.friendly_name,webauthn:{rpId:c,rpOrigins:p},signal:v},{create:w});return D?this._verify({factorId:A.id,challengeId:D.challengeId,webauthn:{rpId:c,rpOrigins:p,type:D.webauthn.type,credential_response:D.webauthn.credential_response}}):{data:null,error:j}}catch(A){return Ei(A)?{data:null,error:A}:{data:null,error:new Nh("Unexpected error in register",A)}}}}QV();const y8={url:pV,storageKey:mV,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:gV,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1,throwOnError:!1,lockAcquireTimeout:1e4};async function NP(n,r,c){return await c()}const Mf={};class D_{get jwks(){var r,c;return(c=(r=Mf[this.storageKey])===null||r===void 0?void 0:r.jwks)!==null&&c!==void 0?c:{keys:[]}}set jwks(r){Mf[this.storageKey]=Object.assign(Object.assign({},Mf[this.storageKey]),{jwks:r})}get jwks_cached_at(){var r,c;return(c=(r=Mf[this.storageKey])===null||r===void 0?void 0:r.cachedAt)!==null&&c!==void 0?c:Number.MIN_SAFE_INTEGER}set jwks_cached_at(r){Mf[this.storageKey]=Object.assign(Object.assign({},Mf[this.storageKey]),{cachedAt:r})}constructor(r){var c,p,v;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.autoRefreshTickTimeout=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log;const w=Object.assign(Object.assign({},y8),r);if(this.storageKey=w.storageKey,this.instanceID=(c=D_.nextInstanceID[this.storageKey])!==null&&c!==void 0?c:0,D_.nextInstanceID[this.storageKey]=this.instanceID+1,this.logDebugMessages=!!w.debug,typeof w.debug=="function"&&(this.logger=w.debug),this.instanceID>0&&Is()){const A=`${this._logPrefix()} Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.`;console.warn(A),this.logDebugMessages&&console.trace(A)}if(this.persistSession=w.persistSession,this.autoRefreshToken=w.autoRefreshToken,this.admin=new KV({url:w.url,headers:w.headers,fetch:w.fetch}),this.url=w.url,this.headers=w.headers,this.fetch=qD(w.fetch),this.lock=w.lock||NP,this.detectSessionInUrl=w.detectSessionInUrl,this.flowType=w.flowType,this.hasCustomAuthorizationHeader=w.hasCustomAuthorizationHeader,this.throwOnError=w.throwOnError,this.lockAcquireTimeout=w.lockAcquireTimeout,w.lock?this.lock=w.lock:this.persistSession&&Is()&&(!((p=globalThis==null?void 0:globalThis.navigator)===null||p===void 0)&&p.locks)?this.lock=JV:this.lock=NP,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this),webauthn:new _8(this)},this.oauth={getAuthorizationDetails:this._getAuthorizationDetails.bind(this),approveAuthorization:this._approveAuthorization.bind(this),denyAuthorization:this._denyAuthorization.bind(this),listGrants:this._listOAuthGrants.bind(this),revokeGrant:this._revokeOAuthGrant.bind(this)},this.persistSession?(w.storage?this.storage=w.storage:WD()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=FP(this.memoryStorage)),w.userStorage&&(this.userStorage=w.userStorage)):(this.memoryStorage={},this.storage=FP(this.memoryStorage)),Is()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(A){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",A)}(v=this.broadcastChannel)===null||v===void 0||v.addEventListener("message",async A=>{this._debug("received broadcast notification from other tab or client",A);try{await this._notifyAllSubscribers(A.data.event,A.data.session,!1)}catch(o){this._debug("#broadcastChannel","error",o)}})}this.initialize().catch(A=>{this._debug("#initialize()","error",A)})}isThrowOnErrorEnabled(){return this.throwOnError}_returnResult(r){if(this.throwOnError&&r&&r.error)throw r.error;return r}_logPrefix(){return`GoTrueClient@${this.storageKey}:${this.instanceID} (${$D}) ${new Date().toISOString()}`}_debug(...r){return this.logDebugMessages&&this.logger(this._logPrefix(),...r),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(this.lockAcquireTimeout,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var r;try{let c={},p="none";if(Is()&&(c=LV(window.location.href),this._isImplicitGrantCallback(c)?p="implicit":await this._isPKCECallback(c)&&(p="pkce")),Is()&&this.detectSessionInUrl&&p!=="none"){const{data:v,error:w}=await this._getSessionFromURL(c,p);if(w){if(this._debug("#_initialize()","error detecting session from URL",w),bV(w)){const D=(r=w.details)===null||r===void 0?void 0:r.code;if(D==="identity_already_exists"||D==="identity_not_found"||D==="single_identity_not_deletable")return{error:w}}return{error:w}}const{session:A,redirectType:o}=v;return this._debug("#_initialize()","detected session in URL",A,"redirect type",o),await this._saveSession(A),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",A):await this._notifyAllSubscribers("SIGNED_IN",A)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(c){return Ei(c)?this._returnResult({error:c}):this._returnResult({error:new Nh("Unexpected error during initialization",c)})}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(r){var c,p,v;try{const w=await Vi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(p=(c=r==null?void 0:r.options)===null||c===void 0?void 0:c.data)!==null&&p!==void 0?p:{},gotrue_meta_security:{captcha_token:(v=r==null?void 0:r.options)===null||v===void 0?void 0:v.captchaToken}},xform:Ha}),{data:A,error:o}=w;if(o||!A)return this._returnResult({data:{user:null,session:null},error:o});const D=A.session,j=A.user;return A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",D)),this._returnResult({data:{user:j,session:D},error:null})}catch(w){if(Ei(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signUp(r){var c,p,v;try{let w;if("email"in r){const{email:J,password:ie,options:re}=r;let he=null,ce=null;this.flowType==="pkce"&&([he,ce]=await kf(this.storage,this.storageKey)),w=await Vi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:re==null?void 0:re.emailRedirectTo,body:{email:J,password:ie,data:(c=re==null?void 0:re.data)!==null&&c!==void 0?c:{},gotrue_meta_security:{captcha_token:re==null?void 0:re.captchaToken},code_challenge:he,code_challenge_method:ce},xform:Ha})}else if("phone"in r){const{phone:J,password:ie,options:re}=r;w=await Vi(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:J,password:ie,data:(p=re==null?void 0:re.data)!==null&&p!==void 0?p:{},channel:(v=re==null?void 0:re.channel)!==null&&v!==void 0?v:"sms",gotrue_meta_security:{captcha_token:re==null?void 0:re.captchaToken}},xform:Ha})}else throw new O0("You must provide either an email or phone number and a password");const{data:A,error:o}=w;if(o||!A)return await Es(this.storage,`${this.storageKey}-code-verifier`),this._returnResult({data:{user:null,session:null},error:o});const D=A.session,j=A.user;return A.session&&(await this._saveSession(A.session),await this._notifyAllSubscribers("SIGNED_IN",D)),this._returnResult({data:{user:j,session:D},error:null})}catch(w){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(w))return this._returnResult({data:{user:null,session:null},error:w});throw w}}async signInWithPassword(r){try{let c;if("email"in r){const{email:w,password:A,options:o}=r;c=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:w,password:A,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zP})}else if("phone"in r){const{phone:w,password:A,options:o}=r;c=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:w,password:A,gotrue_meta_security:{captcha_token:o==null?void 0:o.captchaToken}},xform:zP})}else throw new O0("You must provide either an email or phone number and a password");const{data:p,error:v}=c;if(v)return this._returnResult({data:{user:null,session:null},error:v});if(!p||!p.session||!p.user){const w=new Cf;return this._returnResult({data:{user:null,session:null},error:w})}return p.session&&(await this._saveSession(p.session),await this._notifyAllSubscribers("SIGNED_IN",p.session)),this._returnResult({data:Object.assign({user:p.user,session:p.session},p.weak_password?{weakPassword:p.weak_password}:null),error:v})}catch(c){if(Ei(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithOAuth(r){var c,p,v,w;return await this._handleProviderSignIn(r.provider,{redirectTo:(c=r.options)===null||c===void 0?void 0:c.redirectTo,scopes:(p=r.options)===null||p===void 0?void 0:p.scopes,queryParams:(v=r.options)===null||v===void 0?void 0:v.queryParams,skipBrowserRedirect:(w=r.options)===null||w===void 0?void 0:w.skipBrowserRedirect})}async exchangeCodeForSession(r){return await this.initializePromise,this._acquireLock(this.lockAcquireTimeout,async()=>this._exchangeCodeForSession(r))}async signInWithWeb3(r){const{chain:c}=r;switch(c){case"ethereum":return await this.signInWithEthereum(r);case"solana":return await this.signInWithSolana(r);default:throw new Error(`@supabase/auth-js: Unsupported chain "${c}"`)}}async signInWithEthereum(r){var c,p,v,w,A,o,D,j,J,ie,re;let he,ce;if("message"in r)he=r.message,ce=r.signature;else{const{chain:xe,wallet:Ee,statement:ve,options:K}=r;let fe;if(Is())if(typeof Ee=="object")fe=Ee;else{const lt=window;if("ethereum"in lt&&typeof lt.ethereum=="object"&&"request"in lt.ethereum&&typeof lt.ethereum.request=="function")fe=lt.ethereum;else throw new Error("@supabase/auth-js: No compatible Ethereum wallet interface on the window object (window.ethereum) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'ethereum', wallet: resolvedUserWallet }) instead.")}else{if(typeof Ee!="object"||!(K!=null&&K.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");fe=Ee}const ke=new URL((c=K==null?void 0:K.url)!==null&&c!==void 0?c:window.location.href),Be=await fe.request({method:"eth_requestAccounts"}).then(lt=>lt).catch(()=>{throw new Error("@supabase/auth-js: Wallet method eth_requestAccounts is missing or invalid")});if(!Be||Be.length===0)throw new Error("@supabase/auth-js: No accounts available. Please ensure the wallet is connected.");const Le=XD(Be[0]);let We=(p=K==null?void 0:K.signInWithEthereum)===null||p===void 0?void 0:p.chainId;if(!We){const lt=await fe.request({method:"eth_chainId"});We=e8(lt)}const ct={domain:ke.host,address:Le,statement:ve,uri:ke.href,version:"1",chainId:We,nonce:(v=K==null?void 0:K.signInWithEthereum)===null||v===void 0?void 0:v.nonce,issuedAt:(A=(w=K==null?void 0:K.signInWithEthereum)===null||w===void 0?void 0:w.issuedAt)!==null&&A!==void 0?A:new Date,expirationTime:(o=K==null?void 0:K.signInWithEthereum)===null||o===void 0?void 0:o.expirationTime,notBefore:(D=K==null?void 0:K.signInWithEthereum)===null||D===void 0?void 0:D.notBefore,requestId:(j=K==null?void 0:K.signInWithEthereum)===null||j===void 0?void 0:j.requestId,resources:(J=K==null?void 0:K.signInWithEthereum)===null||J===void 0?void 0:J.resources};he=i8(ct),ce=await fe.request({method:"personal_sign",params:[t8(he),Le]})}try{const{data:xe,error:Ee}=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"ethereum",message:he,signature:ce},!((ie=r.options)===null||ie===void 0)&&ie.captchaToken?{gotrue_meta_security:{captcha_token:(re=r.options)===null||re===void 0?void 0:re.captchaToken}}:null),xform:Ha});if(Ee)throw Ee;if(!xe||!xe.session||!xe.user){const ve=new Cf;return this._returnResult({data:{user:null,session:null},error:ve})}return xe.session&&(await this._saveSession(xe.session),await this._notifyAllSubscribers("SIGNED_IN",xe.session)),this._returnResult({data:Object.assign({},xe),error:Ee})}catch(xe){if(Ei(xe))return this._returnResult({data:{user:null,session:null},error:xe});throw xe}}async signInWithSolana(r){var c,p,v,w,A,o,D,j,J,ie,re,he;let ce,xe;if("message"in r)ce=r.message,xe=r.signature;else{const{chain:Ee,wallet:ve,statement:K,options:fe}=r;let ke;if(Is())if(typeof ve=="object")ke=ve;else{const Le=window;if("solana"in Le&&typeof Le.solana=="object"&&("signIn"in Le.solana&&typeof Le.solana.signIn=="function"||"signMessage"in Le.solana&&typeof Le.solana.signMessage=="function"))ke=Le.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof ve!="object"||!(fe!=null&&fe.url))throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");ke=ve}const Be=new URL((c=fe==null?void 0:fe.url)!==null&&c!==void 0?c:window.location.href);if("signIn"in ke&&ke.signIn){const Le=await ke.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},fe==null?void 0:fe.signInWithSolana),{version:"1",domain:Be.host,uri:Be.href}),K?{statement:K}:null));let We;if(Array.isArray(Le)&&Le[0]&&typeof Le[0]=="object")We=Le[0];else if(Le&&typeof Le=="object"&&"signedMessage"in Le&&"signature"in Le)We=Le;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in We&&"signature"in We&&(typeof We.signedMessage=="string"||We.signedMessage instanceof Uint8Array)&&We.signature instanceof Uint8Array)ce=typeof We.signedMessage=="string"?We.signedMessage:new TextDecoder().decode(We.signedMessage),xe=We.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in ke)||typeof ke.signMessage!="function"||!("publicKey"in ke)||typeof ke!="object"||!ke.publicKey||!("toBase58"in ke.publicKey)||typeof ke.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");ce=[`${Be.host} wants you to sign in with your Solana account:`,ke.publicKey.toBase58(),...K?["",K,""]:[""],"Version: 1",`URI: ${Be.href}`,`Issued At: ${(v=(p=fe==null?void 0:fe.signInWithSolana)===null||p===void 0?void 0:p.issuedAt)!==null&&v!==void 0?v:new Date().toISOString()}`,...!((w=fe==null?void 0:fe.signInWithSolana)===null||w===void 0)&&w.notBefore?[`Not Before: ${fe.signInWithSolana.notBefore}`]:[],...!((A=fe==null?void 0:fe.signInWithSolana)===null||A===void 0)&&A.expirationTime?[`Expiration Time: ${fe.signInWithSolana.expirationTime}`]:[],...!((o=fe==null?void 0:fe.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${fe.signInWithSolana.chainId}`]:[],...!((D=fe==null?void 0:fe.signInWithSolana)===null||D===void 0)&&D.nonce?[`Nonce: ${fe.signInWithSolana.nonce}`]:[],...!((j=fe==null?void 0:fe.signInWithSolana)===null||j===void 0)&&j.requestId?[`Request ID: ${fe.signInWithSolana.requestId}`]:[],...!((ie=(J=fe==null?void 0:fe.signInWithSolana)===null||J===void 0?void 0:J.resources)===null||ie===void 0)&&ie.length?["Resources",...fe.signInWithSolana.resources.map(We=>`- ${We}`)]:[]].join(`
`);const Le=await ke.signMessage(new TextEncoder().encode(ce),"utf8");if(!Le||!(Le instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");xe=Le}}try{const{data:Ee,error:ve}=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:ce,signature:Gh(xe)},!((re=r.options)===null||re===void 0)&&re.captchaToken?{gotrue_meta_security:{captcha_token:(he=r.options)===null||he===void 0?void 0:he.captchaToken}}:null),xform:Ha});if(ve)throw ve;if(!Ee||!Ee.session||!Ee.user){const K=new Cf;return this._returnResult({data:{user:null,session:null},error:K})}return Ee.session&&(await this._saveSession(Ee.session),await this._notifyAllSubscribers("SIGNED_IN",Ee.session)),this._returnResult({data:Object.assign({},Ee),error:ve})}catch(Ee){if(Ei(Ee))return this._returnResult({data:{user:null,session:null},error:Ee});throw Ee}}async _exchangeCodeForSession(r){const c=await Dh(this.storage,`${this.storageKey}-code-verifier`),[p,v]=(c??"").split("/");try{if(!p&&this.flowType==="pkce")throw new wV;const{data:w,error:A}=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:r,code_verifier:p},xform:Ha});if(await Es(this.storage,`${this.storageKey}-code-verifier`),A)throw A;if(!w||!w.session||!w.user){const o=new Cf;return this._returnResult({data:{user:null,session:null,redirectType:null},error:o})}return w.session&&(await this._saveSession(w.session),await this._notifyAllSubscribers("SIGNED_IN",w.session)),this._returnResult({data:Object.assign(Object.assign({},w),{redirectType:v??null}),error:A})}catch(w){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(w))return this._returnResult({data:{user:null,session:null,redirectType:null},error:w});throw w}}async signInWithIdToken(r){try{const{options:c,provider:p,token:v,access_token:w,nonce:A}=r,o=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:p,id_token:v,access_token:w,nonce:A,gotrue_meta_security:{captcha_token:c==null?void 0:c.captchaToken}},xform:Ha}),{data:D,error:j}=o;if(j)return this._returnResult({data:{user:null,session:null},error:j});if(!D||!D.session||!D.user){const J=new Cf;return this._returnResult({data:{user:null,session:null},error:J})}return D.session&&(await this._saveSession(D.session),await this._notifyAllSubscribers("SIGNED_IN",D.session)),this._returnResult({data:D,error:j})}catch(c){if(Ei(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async signInWithOtp(r){var c,p,v,w,A;try{if("email"in r){const{email:o,options:D}=r;let j=null,J=null;this.flowType==="pkce"&&([j,J]=await kf(this.storage,this.storageKey));const{error:ie}=await Vi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(c=D==null?void 0:D.data)!==null&&c!==void 0?c:{},create_user:(p=D==null?void 0:D.shouldCreateUser)!==null&&p!==void 0?p:!0,gotrue_meta_security:{captcha_token:D==null?void 0:D.captchaToken},code_challenge:j,code_challenge_method:J},redirectTo:D==null?void 0:D.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:ie})}if("phone"in r){const{phone:o,options:D}=r,{data:j,error:J}=await Vi(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(v=D==null?void 0:D.data)!==null&&v!==void 0?v:{},create_user:(w=D==null?void 0:D.shouldCreateUser)!==null&&w!==void 0?w:!0,gotrue_meta_security:{captcha_token:D==null?void 0:D.captchaToken},channel:(A=D==null?void 0:D.channel)!==null&&A!==void 0?A:"sms"}});return this._returnResult({data:{user:null,session:null,messageId:j==null?void 0:j.message_id},error:J})}throw new O0("You must provide either an email or phone number.")}catch(o){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(o))return this._returnResult({data:{user:null,session:null},error:o});throw o}}async verifyOtp(r){var c,p;try{let v,w;"options"in r&&(v=(c=r.options)===null||c===void 0?void 0:c.redirectTo,w=(p=r.options)===null||p===void 0?void 0:p.captchaToken);const{data:A,error:o}=await Vi(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},r),{gotrue_meta_security:{captcha_token:w}}),redirectTo:v,xform:Ha});if(o)throw o;if(!A)throw new Error("An error occurred on token verification.");const D=A.session,j=A.user;return D!=null&&D.access_token&&(await this._saveSession(D),await this._notifyAllSubscribers(r.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",D)),this._returnResult({data:{user:j,session:D},error:null})}catch(v){if(Ei(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}}async signInWithSSO(r){var c,p,v,w,A;try{let o=null,D=null;this.flowType==="pkce"&&([o,D]=await kf(this.storage,this.storageKey));const j=await Vi(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in r?{provider_id:r.providerId}:null),"domain"in r?{domain:r.domain}:null),{redirect_to:(p=(c=r.options)===null||c===void 0?void 0:c.redirectTo)!==null&&p!==void 0?p:void 0}),!((v=r==null?void 0:r.options)===null||v===void 0)&&v.captchaToken?{gotrue_meta_security:{captcha_token:r.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:o,code_challenge_method:D}),headers:this.headers,xform:qV});return!((w=j.data)===null||w===void 0)&&w.url&&Is()&&!(!((A=r.options)===null||A===void 0)&&A.skipBrowserRedirect)&&window.location.assign(j.data.url),this._returnResult(j)}catch(o){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(o))return this._returnResult({data:null,error:o});throw o}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async r=>{const{data:{session:c},error:p}=r;if(p)throw p;if(!c)throw new Ho;const{error:v}=await Vi(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:c.access_token});return this._returnResult({data:{user:null,session:null},error:v})})}catch(r){if(Ei(r))return this._returnResult({data:{user:null,session:null},error:r});throw r}}async resend(r){try{const c=`${this.url}/resend`;if("email"in r){const{email:p,type:v,options:w}=r,{error:A}=await Vi(this.fetch,"POST",c,{headers:this.headers,body:{email:p,type:v,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}},redirectTo:w==null?void 0:w.emailRedirectTo});return this._returnResult({data:{user:null,session:null},error:A})}else if("phone"in r){const{phone:p,type:v,options:w}=r,{data:A,error:o}=await Vi(this.fetch,"POST",c,{headers:this.headers,body:{phone:p,type:v,gotrue_meta_security:{captcha_token:w==null?void 0:w.captchaToken}}});return this._returnResult({data:{user:null,session:null,messageId:A==null?void 0:A.message_id},error:o})}throw new O0("You must provide either an email or phone number and a type")}catch(c){if(Ei(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async getSession(){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>this._useSession(async c=>c))}async _acquireLock(r,c){this._debug("#_acquireLock","begin",r);try{if(this.lockAcquired){const p=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),v=(async()=>(await p,await c()))();return this.pendingInLock.push((async()=>{try{await v}catch{}})()),v}return await this.lock(`lock:${this.storageKey}`,r,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const p=c();for(this.pendingInLock.push((async()=>{try{await p}catch{}})()),await p;this.pendingInLock.length;){const v=[...this.pendingInLock];await Promise.all(v),this.pendingInLock.splice(0,v.length)}return await p}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(r){this._debug("#_useSession","begin");try{const c=await this.__loadSession();return await r(c)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let r=null;const c=await Dh(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",c),c!==null&&(this._isValidSession(c)?r=c:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!r)return{data:{session:null},error:null};const p=r.expires_at?r.expires_at*1e3-Date.now()<Xw:!1;if(this._debug("#__loadSession()",`session has${p?"":" not"} expired`,"expires_at",r.expires_at),!p){if(this.userStorage){const A=await Dh(this.userStorage,this.storageKey+"-user");A!=null&&A.user?r.user=A.user:r.user=Jw()}if(this.storage.isServer&&r.user&&!r.user.__isUserNotAvailableProxy){const A={value:this.suppressGetSessionWarning};r.user=$V(r.user,A),A.value&&(this.suppressGetSessionWarning=!0)}return{data:{session:r},error:null}}const{data:v,error:w}=await this._callRefreshToken(r.refresh_token);return w?this._returnResult({data:{session:null},error:w}):this._returnResult({data:{session:v},error:null})}finally{this._debug("#__loadSession()","end")}}async getUser(r){if(r)return await this._getUser(r);await this.initializePromise;const c=await this._acquireLock(this.lockAcquireTimeout,async()=>await this._getUser());return c.data.user&&(this.suppressGetSessionWarning=!0),c}async _getUser(r){try{return r?await Vi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:r,xform:du}):await this._useSession(async c=>{var p,v,w;const{data:A,error:o}=c;if(o)throw o;return!(!((p=A.session)===null||p===void 0)&&p.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new Ho}:await Vi(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(w=(v=A.session)===null||v===void 0?void 0:v.access_token)!==null&&w!==void 0?w:void 0,xform:du})})}catch(c){if(Ei(c))return Kw(c)&&(await this._removeSession(),await Es(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({data:{user:null},error:c});throw c}}async updateUser(r,c={}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._updateUser(r,c))}async _updateUser(r,c={}){try{return await this._useSession(async p=>{const{data:v,error:w}=p;if(w)throw w;if(!v.session)throw new Ho;const A=v.session;let o=null,D=null;this.flowType==="pkce"&&r.email!=null&&([o,D]=await kf(this.storage,this.storageKey));const{data:j,error:J}=await Vi(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:c==null?void 0:c.emailRedirectTo,body:Object.assign(Object.assign({},r),{code_challenge:o,code_challenge_method:D}),jwt:A.access_token,xform:du});if(J)throw J;return A.user=j.user,await this._saveSession(A),await this._notifyAllSubscribers("USER_UPDATED",A),this._returnResult({data:{user:A.user},error:null})})}catch(p){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(p))return this._returnResult({data:{user:null},error:p});throw p}}async setSession(r){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._setSession(r))}async _setSession(r){try{if(!r.access_token||!r.refresh_token)throw new Ho;const c=Date.now()/1e3;let p=c,v=!0,w=null;const{payload:A}=B0(r.access_token);if(A.exp&&(p=A.exp,v=p<=c),v){const{data:o,error:D}=await this._callRefreshToken(r.refresh_token);if(D)return this._returnResult({data:{user:null,session:null},error:D});if(!o)return{data:{user:null,session:null},error:null};w=o}else{const{data:o,error:D}=await this._getUser(r.access_token);if(D)return this._returnResult({data:{user:null,session:null},error:D});w={access_token:r.access_token,refresh_token:r.refresh_token,user:o.user,token_type:"bearer",expires_in:p-c,expires_at:p},await this._saveSession(w),await this._notifyAllSubscribers("SIGNED_IN",w)}return this._returnResult({data:{user:w.user,session:w},error:null})}catch(c){if(Ei(c))return this._returnResult({data:{session:null,user:null},error:c});throw c}}async refreshSession(r){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._refreshSession(r))}async _refreshSession(r){try{return await this._useSession(async c=>{var p;if(!r){const{data:A,error:o}=c;if(o)throw o;r=(p=A.session)!==null&&p!==void 0?p:void 0}if(!(r!=null&&r.refresh_token))throw new Ho;const{data:v,error:w}=await this._callRefreshToken(r.refresh_token);return w?this._returnResult({data:{user:null,session:null},error:w}):v?this._returnResult({data:{user:v.user,session:v},error:null}):this._returnResult({data:{user:null,session:null},error:null})})}catch(c){if(Ei(c))return this._returnResult({data:{user:null,session:null},error:c});throw c}}async _getSessionFromURL(r,c){try{if(!Is())throw new z0("No browser detected.");if(r.error||r.error_description||r.error_code)throw new z0(r.error_description||"Error in URL with unspecified error_description",{error:r.error||"unspecified_error",code:r.error_code||"unspecified_code"});switch(c){case"implicit":if(this.flowType==="pkce")throw new kP("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new z0("Not a valid implicit grant flow url.");break;default:}if(c==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!r.code)throw new kP("No code detected.");const{data:K,error:fe}=await this._exchangeCodeForSession(r.code);if(fe)throw fe;const ke=new URL(window.location.href);return ke.searchParams.delete("code"),window.history.replaceState(window.history.state,"",ke.toString()),{data:{session:K.session,redirectType:null},error:null}}const{provider_token:p,provider_refresh_token:v,access_token:w,refresh_token:A,expires_in:o,expires_at:D,token_type:j}=r;if(!w||!o||!A||!j)throw new z0("No session defined in URL");const J=Math.round(Date.now()/1e3),ie=parseInt(o);let re=J+ie;D&&(re=parseInt(D));const he=re-J;he*1e3<=Of&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${he}s, should have been closer to ${ie}s`);const ce=re-ie;J-ce>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",ce,re,J):J-ce<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",ce,re,J);const{data:xe,error:Ee}=await this._getUser(w);if(Ee)throw Ee;const ve={provider_token:p,provider_refresh_token:v,access_token:w,expires_in:ie,expires_at:re,refresh_token:A,token_type:j,user:xe.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),this._returnResult({data:{session:ve,redirectType:r.type},error:null})}catch(p){if(Ei(p))return this._returnResult({data:{session:null,redirectType:null},error:p});throw p}}_isImplicitGrantCallback(r){return typeof this.detectSessionInUrl=="function"?this.detectSessionInUrl(new URL(window.location.href),r):!!(r.access_token||r.error_description)}async _isPKCECallback(r){const c=await Dh(this.storage,`${this.storageKey}-code-verifier`);return!!(r.code&&c)}async signOut(r={scope:"global"}){return await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>await this._signOut(r))}async _signOut({scope:r}={scope:"global"}){return await this._useSession(async c=>{var p;const{data:v,error:w}=c;if(w&&!Kw(w))return this._returnResult({error:w});const A=(p=v.session)===null||p===void 0?void 0:p.access_token;if(A){const{error:o}=await this.admin.signOut(A,r);if(o&&!(xV(o)&&(o.status===404||o.status===401||o.status===403)||Kw(o)))return this._returnResult({error:o})}return r!=="others"&&(await this._removeSession(),await Es(this.storage,`${this.storageKey}-code-verifier`)),this._returnResult({error:null})})}onAuthStateChange(r){const c=kV(),p={id:c,callback:r,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",c),this.stateChangeEmitters.delete(c)}};return this._debug("#onAuthStateChange()","registered callback with id",c),this.stateChangeEmitters.set(c,p),(async()=>(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{this._emitInitialSession(c)})))(),{data:{subscription:p}}}async _emitInitialSession(r){return await this._useSession(async c=>{var p,v;try{const{data:{session:w},error:A}=c;if(A)throw A;await((p=this.stateChangeEmitters.get(r))===null||p===void 0?void 0:p.callback("INITIAL_SESSION",w)),this._debug("INITIAL_SESSION","callback id",r,"session",w)}catch(w){await((v=this.stateChangeEmitters.get(r))===null||v===void 0?void 0:v.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",r,"error",w),console.error(w)}})}async resetPasswordForEmail(r,c={}){let p=null,v=null;this.flowType==="pkce"&&([p,v]=await kf(this.storage,this.storageKey,!0));try{return await Vi(this.fetch,"POST",`${this.url}/recover`,{body:{email:r,code_challenge:p,code_challenge_method:v,gotrue_meta_security:{captcha_token:c.captchaToken}},headers:this.headers,redirectTo:c.redirectTo})}catch(w){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(w))return this._returnResult({data:null,error:w});throw w}}async getUserIdentities(){var r;try{const{data:c,error:p}=await this.getUser();if(p)throw p;return this._returnResult({data:{identities:(r=c.user.identities)!==null&&r!==void 0?r:[]},error:null})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async linkIdentity(r){return"token"in r?this.linkIdentityIdToken(r):this.linkIdentityOAuth(r)}async linkIdentityOAuth(r){var c;try{const{data:p,error:v}=await this._useSession(async w=>{var A,o,D,j,J;const{data:ie,error:re}=w;if(re)throw re;const he=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,r.provider,{redirectTo:(A=r.options)===null||A===void 0?void 0:A.redirectTo,scopes:(o=r.options)===null||o===void 0?void 0:o.scopes,queryParams:(D=r.options)===null||D===void 0?void 0:D.queryParams,skipBrowserRedirect:!0});return await Vi(this.fetch,"GET",he,{headers:this.headers,jwt:(J=(j=ie.session)===null||j===void 0?void 0:j.access_token)!==null&&J!==void 0?J:void 0})});if(v)throw v;return Is()&&!(!((c=r.options)===null||c===void 0)&&c.skipBrowserRedirect)&&window.location.assign(p==null?void 0:p.url),this._returnResult({data:{provider:r.provider,url:p==null?void 0:p.url},error:null})}catch(p){if(Ei(p))return this._returnResult({data:{provider:r.provider,url:null},error:p});throw p}}async linkIdentityIdToken(r){return await this._useSession(async c=>{var p;try{const{error:v,data:{session:w}}=c;if(v)throw v;const{options:A,provider:o,token:D,access_token:j,nonce:J}=r,ie=await Vi(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,jwt:(p=w==null?void 0:w.access_token)!==null&&p!==void 0?p:void 0,body:{provider:o,id_token:D,access_token:j,nonce:J,link_identity:!0,gotrue_meta_security:{captcha_token:A==null?void 0:A.captchaToken}},xform:Ha}),{data:re,error:he}=ie;return he?this._returnResult({data:{user:null,session:null},error:he}):!re||!re.session||!re.user?this._returnResult({data:{user:null,session:null},error:new Cf}):(re.session&&(await this._saveSession(re.session),await this._notifyAllSubscribers("USER_UPDATED",re.session)),this._returnResult({data:re,error:he}))}catch(v){if(await Es(this.storage,`${this.storageKey}-code-verifier`),Ei(v))return this._returnResult({data:{user:null,session:null},error:v});throw v}})}async unlinkIdentity(r){try{return await this._useSession(async c=>{var p,v;const{data:w,error:A}=c;if(A)throw A;return await Vi(this.fetch,"DELETE",`${this.url}/user/identities/${r.identity_id}`,{headers:this.headers,jwt:(v=(p=w.session)===null||p===void 0?void 0:p.access_token)!==null&&v!==void 0?v:void 0})})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async _refreshAccessToken(r){const c=`#_refreshAccessToken(${r.substring(0,5)}...)`;this._debug(c,"begin");try{const p=Date.now();return await RV(async v=>(v>0&&await MV(200*Math.pow(2,v-1)),this._debug(c,"refreshing attempt",v),await Vi(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:r},headers:this.headers,xform:Ha})),(v,w)=>{const A=200*Math.pow(2,v);return w&&Yw(w)&&Date.now()+A-p<Of})}catch(p){if(this._debug(c,"error",p),Ei(p))return this._returnResult({data:{session:null,user:null},error:p});throw p}finally{this._debug(c,"end")}}_isValidSession(r){return typeof r=="object"&&r!==null&&"access_token"in r&&"refresh_token"in r&&"expires_at"in r}async _handleProviderSignIn(r,c){const p=await this._getUrlForProvider(`${this.url}/authorize`,r,{redirectTo:c.redirectTo,scopes:c.scopes,queryParams:c.queryParams});return this._debug("#_handleProviderSignIn()","provider",r,"options",c,"url",p),Is()&&!c.skipBrowserRedirect&&window.location.assign(p),{data:{provider:r,url:p},error:null}}async _recoverAndRefresh(){var r,c;const p="#_recoverAndRefresh()";this._debug(p,"begin");try{const v=await Dh(this.storage,this.storageKey);if(v&&this.userStorage){let A=await Dh(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!A&&(A={user:v.user},await zf(this.userStorage,this.storageKey+"-user",A)),v.user=(r=A==null?void 0:A.user)!==null&&r!==void 0?r:Jw()}else if(v&&!v.user&&!v.user){const A=await Dh(this.storage,this.storageKey+"-user");A&&(A!=null&&A.user)?(v.user=A.user,await Es(this.storage,this.storageKey+"-user"),await zf(this.storage,this.storageKey,v)):v.user=Jw()}if(this._debug(p,"session from storage",v),!this._isValidSession(v)){this._debug(p,"session is not valid"),v!==null&&await this._removeSession();return}const w=((c=v.expires_at)!==null&&c!==void 0?c:1/0)*1e3-Date.now()<Xw;if(this._debug(p,`session has${w?"":" not"} expired with margin of ${Xw}s`),w){if(this.autoRefreshToken&&v.refresh_token){const{error:A}=await this._callRefreshToken(v.refresh_token);A&&(console.error(A),Yw(A)||(this._debug(p,"refresh failed with a non-retryable error, removing the session",A),await this._removeSession()))}}else if(v.user&&v.user.__isUserNotAvailableProxy===!0)try{const{data:A,error:o}=await this._getUser(v.access_token);!o&&(A!=null&&A.user)?(v.user=A.user,await this._saveSession(v),await this._notifyAllSubscribers("SIGNED_IN",v)):this._debug(p,"could not get user data, skipping SIGNED_IN notification")}catch(A){console.error("Error getting user data:",A),this._debug(p,"error getting user data, skipping SIGNED_IN notification",A)}else await this._notifyAllSubscribers("SIGNED_IN",v)}catch(v){this._debug(p,"error",v),console.error(v);return}finally{this._debug(p,"end")}}async _callRefreshToken(r){var c,p;if(!r)throw new Ho;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const v=`#_callRefreshToken(${r.substring(0,5)}...)`;this._debug(v,"begin");try{this.refreshingDeferred=new s1;const{data:w,error:A}=await this._refreshAccessToken(r);if(A)throw A;if(!w.session)throw new Ho;await this._saveSession(w.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",w.session);const o={data:w.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(w){if(this._debug(v,"error",w),Ei(w)){const A={data:null,error:w};return Yw(w)||await this._removeSession(),(c=this.refreshingDeferred)===null||c===void 0||c.resolve(A),A}throw(p=this.refreshingDeferred)===null||p===void 0||p.reject(w),w}finally{this.refreshingDeferred=null,this._debug(v,"end")}}async _notifyAllSubscribers(r,c,p=!0){const v=`#_notifyAllSubscribers(${r})`;this._debug(v,"begin",c,`broadcast = ${p}`);try{this.broadcastChannel&&p&&this.broadcastChannel.postMessage({event:r,session:c});const w=[],A=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(r,c)}catch(D){w.push(D)}});if(await Promise.all(A),w.length>0){for(let o=0;o<w.length;o+=1)console.error(w[o]);throw w[0]}}finally{this._debug(v,"end")}}async _saveSession(r){this._debug("#_saveSession()",r),this.suppressGetSessionWarning=!0,await Es(this.storage,`${this.storageKey}-code-verifier`);const c=Object.assign({},r),p=c.user&&c.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!p&&c.user&&await zf(this.userStorage,this.storageKey+"-user",{user:c.user});const v=Object.assign({},c);delete v.user;const w=DP(v);await zf(this.storage,this.storageKey,w)}else{const v=DP(c);await zf(this.storage,this.storageKey,v)}}async _removeSession(){this._debug("#_removeSession()"),this.suppressGetSessionWarning=!1,await Es(this.storage,this.storageKey),await Es(this.storage,this.storageKey+"-code-verifier"),await Es(this.storage,this.storageKey+"-user"),this.userStorage&&await Es(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const r=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{r&&Is()&&(window!=null&&window.removeEventListener)&&window.removeEventListener("visibilitychange",r)}catch(c){console.error("removing visibilitychange callback failed",c)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const r=setInterval(()=>this._autoRefreshTokenTick(),Of);this.autoRefreshTicker=r,r&&typeof r=="object"&&typeof r.unref=="function"?r.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(r);const c=setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0);this.autoRefreshTickTimeout=c,c&&typeof c=="object"&&typeof c.unref=="function"?c.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(c)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const r=this.autoRefreshTicker;this.autoRefreshTicker=null,r&&clearInterval(r);const c=this.autoRefreshTickTimeout;this.autoRefreshTickTimeout=null,c&&clearTimeout(c)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const r=Date.now();try{return await this._useSession(async c=>{const{data:{session:p}}=c;if(!p||!p.refresh_token||!p.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const v=Math.floor((p.expires_at*1e3-r)/Of);this._debug("#_autoRefreshTokenTick()",`access token expires in ${v} ticks, a tick lasts ${Of}ms, refresh threshold is ${fT} ticks`),v<=fT&&await this._callRefreshToken(p.refresh_token)})}catch(c){console.error("Auto refresh tick failed with error. This is likely a transient error.",c)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(r){if(r.isAcquireTimeout||r instanceof ZD)this._debug("auto refresh token tick lock not available");else throw r}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!Is()||!(window!=null&&window.addEventListener))return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>{try{await this._onVisibilityChanged(!1)}catch(r){this._debug("#visibilityChangedCallback","error",r)}},window==null||window.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(r){console.error("_handleVisibilityChange",r)}}async _onVisibilityChanged(r){const c=`#_onVisibilityChanged(${r})`;this._debug(c,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),r||(await this.initializePromise,await this._acquireLock(this.lockAcquireTimeout,async()=>{if(document.visibilityState!=="visible"){this._debug(c,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(r,c,p){const v=[`provider=${encodeURIComponent(c)}`];if(p!=null&&p.redirectTo&&v.push(`redirect_to=${encodeURIComponent(p.redirectTo)}`),p!=null&&p.scopes&&v.push(`scopes=${encodeURIComponent(p.scopes)}`),this.flowType==="pkce"){const[w,A]=await kf(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(w)}`,code_challenge_method:`${encodeURIComponent(A)}`});v.push(o.toString())}if(p!=null&&p.queryParams){const w=new URLSearchParams(p.queryParams);v.push(w.toString())}return p!=null&&p.skipBrowserRedirect&&v.push(`skip_http_redirect=${p.skipBrowserRedirect}`),`${r}?${v.join("&")}`}async _unenroll(r){try{return await this._useSession(async c=>{var p;const{data:v,error:w}=c;return w?this._returnResult({data:null,error:w}):await Vi(this.fetch,"DELETE",`${this.url}/factors/${r.factorId}`,{headers:this.headers,jwt:(p=v==null?void 0:v.session)===null||p===void 0?void 0:p.access_token})})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async _enroll(r){try{return await this._useSession(async c=>{var p,v;const{data:w,error:A}=c;if(A)return this._returnResult({data:null,error:A});const o=Object.assign({friendly_name:r.friendlyName,factor_type:r.factorType},r.factorType==="phone"?{phone:r.phone}:r.factorType==="totp"?{issuer:r.issuer}:{}),{data:D,error:j}=await Vi(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(p=w==null?void 0:w.session)===null||p===void 0?void 0:p.access_token});return j?this._returnResult({data:null,error:j}):(r.factorType==="totp"&&D.type==="totp"&&(!((v=D==null?void 0:D.totp)===null||v===void 0)&&v.qr_code)&&(D.totp.qr_code=`data:image/svg+xml;utf-8,${D.totp.qr_code}`),this._returnResult({data:D,error:null}))})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async _verify(r){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async c=>{var p;const{data:v,error:w}=c;if(w)return this._returnResult({data:null,error:w});const A=Object.assign({challenge_id:r.challengeId},"webauthn"in r?{webauthn:Object.assign(Object.assign({},r.webauthn),{credential_response:r.webauthn.type==="create"?c8(r.webauthn.credential_response):u8(r.webauthn.credential_response)})}:{code:r.code}),{data:o,error:D}=await Vi(this.fetch,"POST",`${this.url}/factors/${r.factorId}/verify`,{body:A,headers:this.headers,jwt:(p=v==null?void 0:v.session)===null||p===void 0?void 0:p.access_token});return D?this._returnResult({data:null,error:D}):(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+o.expires_in},o)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",o),this._returnResult({data:o,error:D}))})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}})}async _challenge(r){return this._acquireLock(this.lockAcquireTimeout,async()=>{try{return await this._useSession(async c=>{var p;const{data:v,error:w}=c;if(w)return this._returnResult({data:null,error:w});const A=await Vi(this.fetch,"POST",`${this.url}/factors/${r.factorId}/challenge`,{body:r,headers:this.headers,jwt:(p=v==null?void 0:v.session)===null||p===void 0?void 0:p.access_token});if(A.error)return A;const{data:o}=A;if(o.type!=="webauthn")return{data:o,error:null};switch(o.webauthn.type){case"create":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:a8(o.webauthn.credential_options.publicKey)})})}),error:null};case"request":return{data:Object.assign(Object.assign({},o),{webauthn:Object.assign(Object.assign({},o.webauthn),{credential_options:Object.assign(Object.assign({},o.webauthn.credential_options),{publicKey:l8(o.webauthn.credential_options.publicKey)})})}),error:null}}})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}})}async _challengeAndVerify(r){const{data:c,error:p}=await this._challenge({factorId:r.factorId});return p?this._returnResult({data:null,error:p}):await this._verify({factorId:r.factorId,challengeId:c.id,code:r.code})}async _listFactors(){var r;const{data:{user:c},error:p}=await this.getUser();if(p)return{data:null,error:p};const v={all:[],phone:[],totp:[],webauthn:[]};for(const w of(r=c==null?void 0:c.factors)!==null&&r!==void 0?r:[])v.all.push(w),w.status==="verified"&&v[w.factor_type].push(w);return{data:v,error:null}}async _getAuthenticatorAssuranceLevel(r){var c,p,v,w;if(r)try{const{payload:he}=B0(r);let ce=null;he.aal&&(ce=he.aal);let xe=ce;const{data:{user:Ee},error:ve}=await this.getUser(r);if(ve)return this._returnResult({data:null,error:ve});((p=(c=Ee==null?void 0:Ee.factors)===null||c===void 0?void 0:c.filter(ke=>ke.status==="verified"))!==null&&p!==void 0?p:[]).length>0&&(xe="aal2");const fe=he.amr||[];return{data:{currentLevel:ce,nextLevel:xe,currentAuthenticationMethods:fe},error:null}}catch(he){if(Ei(he))return this._returnResult({data:null,error:he});throw he}const{data:{session:A},error:o}=await this.getSession();if(o)return this._returnResult({data:null,error:o});if(!A)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:D}=B0(A.access_token);let j=null;D.aal&&(j=D.aal);let J=j;((w=(v=A.user.factors)===null||v===void 0?void 0:v.filter(he=>he.status==="verified"))!==null&&w!==void 0?w:[]).length>0&&(J="aal2");const re=D.amr||[];return{data:{currentLevel:j,nextLevel:J,currentAuthenticationMethods:re},error:null}}async _getAuthorizationDetails(r){try{return await this._useSession(async c=>{const{data:{session:p},error:v}=c;return v?this._returnResult({data:null,error:v}):p?await Vi(this.fetch,"GET",`${this.url}/oauth/authorizations/${r}`,{headers:this.headers,jwt:p.access_token,xform:w=>({data:w,error:null})}):this._returnResult({data:null,error:new Ho})})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async _approveAuthorization(r,c){try{return await this._useSession(async p=>{const{data:{session:v},error:w}=p;if(w)return this._returnResult({data:null,error:w});if(!v)return this._returnResult({data:null,error:new Ho});const A=await Vi(this.fetch,"POST",`${this.url}/oauth/authorizations/${r}/consent`,{headers:this.headers,jwt:v.access_token,body:{action:"approve"},xform:o=>({data:o,error:null})});return A.data&&A.data.redirect_url&&Is()&&!(c!=null&&c.skipBrowserRedirect)&&window.location.assign(A.data.redirect_url),A})}catch(p){if(Ei(p))return this._returnResult({data:null,error:p});throw p}}async _denyAuthorization(r,c){try{return await this._useSession(async p=>{const{data:{session:v},error:w}=p;if(w)return this._returnResult({data:null,error:w});if(!v)return this._returnResult({data:null,error:new Ho});const A=await Vi(this.fetch,"POST",`${this.url}/oauth/authorizations/${r}/consent`,{headers:this.headers,jwt:v.access_token,body:{action:"deny"},xform:o=>({data:o,error:null})});return A.data&&A.data.redirect_url&&Is()&&!(c!=null&&c.skipBrowserRedirect)&&window.location.assign(A.data.redirect_url),A})}catch(p){if(Ei(p))return this._returnResult({data:null,error:p});throw p}}async _listOAuthGrants(){try{return await this._useSession(async r=>{const{data:{session:c},error:p}=r;return p?this._returnResult({data:null,error:p}):c?await Vi(this.fetch,"GET",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:c.access_token,xform:v=>({data:v,error:null})}):this._returnResult({data:null,error:new Ho})})}catch(r){if(Ei(r))return this._returnResult({data:null,error:r});throw r}}async _revokeOAuthGrant(r){try{return await this._useSession(async c=>{const{data:{session:p},error:v}=c;return v?this._returnResult({data:null,error:v}):p?(await Vi(this.fetch,"DELETE",`${this.url}/user/oauth/grants`,{headers:this.headers,jwt:p.access_token,query:{client_id:r.clientId},noResolveJson:!0}),{data:{},error:null}):this._returnResult({data:null,error:new Ho})})}catch(c){if(Ei(c))return this._returnResult({data:null,error:c});throw c}}async fetchJwk(r,c={keys:[]}){let p=c.keys.find(o=>o.kid===r);if(p)return p;const v=Date.now();if(p=this.jwks.keys.find(o=>o.kid===r),p&&this.jwks_cached_at+yV>v)return p;const{data:w,error:A}=await Vi(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(A)throw A;return!w.keys||w.keys.length===0||(this.jwks=w,this.jwks_cached_at=v,p=w.keys.find(o=>o.kid===r),!p)?null:p}async getClaims(r,c={}){try{let p=r;if(!p){const{data:he,error:ce}=await this.getSession();if(ce||!he.session)return this._returnResult({data:null,error:ce});p=he.session.access_token}const{header:v,payload:w,signature:A,raw:{header:o,payload:D}}=B0(p);c!=null&&c.allowExpired||NV(w.exp);const j=!v.alg||v.alg.startsWith("HS")||!v.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(v.kid,c!=null&&c.keys?{keys:c.keys}:c==null?void 0:c.jwks);if(!j){const{error:he}=await this.getUser(p);if(he)throw he;return{data:{claims:w,header:v,signature:A},error:null}}const J=UV(v.alg),ie=await crypto.subtle.importKey("jwk",j,J,!0,["verify"]);if(!await crypto.subtle.verify(J,ie,A,AV(`${o}.${D}`)))throw new gT("Invalid JWT signature");return{data:{claims:w,header:v,signature:A},error:null}}catch(p){if(Ei(p))return this._returnResult({data:null,error:p});throw p}}}D_.nextInstanceID={};const v8=D_,x8="2.93.1";let Xg="";typeof Deno<"u"?Xg="deno":typeof document<"u"?Xg="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Xg="react-native":Xg="node";function b8(){const n=globalThis.process;if(n&&n.platform){const r=n.platform;if(r==="darwin")return"macOS";if(r==="win32")return"Windows";if(r==="linux")return"Linux";if(r==="android")return"Android"}if(typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platform){const r=navigator.userAgentData.platform;if(r==="macOS")return"macOS";if(r==="Windows")return"Windows";if(r==="Linux")return"Linux";if(r==="Android")return"Android";if(r==="iOS")return"iOS"}return null}function w8(){const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node&&typeof window>"u")try{const c=globalThis.require;if(c)return c("os").release()}catch{return null}}if(typeof Deno<"u"&&Deno.osRelease)try{return Deno.osRelease()}catch{return null}return typeof navigator<"u"&&navigator.userAgentData&&navigator.userAgentData.platformVersion?navigator.userAgentData.platformVersion:null}function S8(){if(typeof Deno<"u")return"deno";if(typeof Bun<"u")return"bun";const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node)return"node"}return null}function T8(){if(typeof Deno<"u"&&Deno.version)return Deno.version.deno;if(typeof Bun<"u"&&Bun.version)return Bun.version;const n=globalThis.process;if(n){const r=n.versions;if(r&&r.node)return r.node}return null}function E8(){const n={"X-Client-Info":`supabase-js-${Xg}/${x8}`},r=b8();r&&(n["X-Supabase-Client-Platform"]=r);const c=w8();c&&(n["X-Supabase-Client-Platform-Version"]=c);const p=S8();p&&(n["X-Supabase-Client-Runtime"]=p);const v=T8();return v&&(n["X-Supabase-Client-Runtime-Version"]=v),n}const I8=E8(),A8={headers:I8},C8={schema:"public"},k8={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},L8={};function O_(n){"@babel/helpers - typeof";return O_=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},O_(n)}function P8(n,r){if(O_(n)!="object"||!n)return n;var c=n[Symbol.toPrimitive];if(c!==void 0){var p=c.call(n,r);if(O_(p)!="object")return p;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}function M8(n){var r=P8(n,"string");return O_(r)=="symbol"?r:r+""}function R8(n,r,c){return(r=M8(r))in n?Object.defineProperty(n,r,{value:c,enumerable:!0,configurable:!0,writable:!0}):n[r]=c,n}function UP(n,r){var c=Object.keys(n);if(Object.getOwnPropertySymbols){var p=Object.getOwnPropertySymbols(n);r&&(p=p.filter(function(v){return Object.getOwnPropertyDescriptor(n,v).enumerable})),c.push.apply(c,p)}return c}function kn(n){for(var r=1;r<arguments.length;r++){var c=arguments[r]!=null?arguments[r]:{};r%2?UP(Object(c),!0).forEach(function(p){R8(n,p,c[p])}):Object.getOwnPropertyDescriptors?Object.defineProperties(n,Object.getOwnPropertyDescriptors(c)):UP(Object(c)).forEach(function(p){Object.defineProperty(n,p,Object.getOwnPropertyDescriptor(c,p))})}return n}const D8=n=>n?(...r)=>n(...r):(...r)=>fetch(...r),O8=()=>Headers,z8=(n,r,c)=>{const p=D8(c),v=O8();return async(w,A)=>{var o;const D=(o=await r())!==null&&o!==void 0?o:n;let j=new v(A==null?void 0:A.headers);return j.has("apikey")||j.set("apikey",n),j.has("Authorization")||j.set("Authorization",`Bearer ${D}`),p(w,kn(kn({},A),{},{headers:j}))}};function B8(n){return n.endsWith("/")?n:n+"/"}function F8(n,r){var c,p;const{db:v,auth:w,realtime:A,global:o}=n,{db:D,auth:j,realtime:J,global:ie}=r,re={db:kn(kn({},D),v),auth:kn(kn({},j),w),realtime:kn(kn({},J),A),storage:{},global:kn(kn(kn({},ie),o),{},{headers:kn(kn({},(c=ie==null?void 0:ie.headers)!==null&&c!==void 0?c:{}),(p=o==null?void 0:o.headers)!==null&&p!==void 0?p:{})}),accessToken:async()=>""};return n.accessToken?re.accessToken=n.accessToken:delete re.accessToken,re}function j8(n){const r=n==null?void 0:n.trim();if(!r)throw new Error("supabaseUrl is required.");if(!r.match(/^https?:\/\//i))throw new Error("Invalid supabaseUrl: Must be a valid HTTP or HTTPS URL.");try{return new URL(B8(r))}catch{throw Error("Invalid supabaseUrl: Provided URL is malformed.")}}var N8=class extends v8{constructor(n){super(n)}},U8=class{constructor(n,r,c){var p,v;this.supabaseUrl=n,this.supabaseKey=r;const w=j8(n);if(!r)throw new Error("supabaseKey is required.");this.realtimeUrl=new URL("realtime/v1",w),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",w),this.storageUrl=new URL("storage/v1",w),this.functionsUrl=new URL("functions/v1",w);const A=`sb-${w.hostname.split(".")[0]}-auth-token`,o={db:C8,realtime:L8,auth:kn(kn({},k8),{},{storageKey:A}),global:A8},D=F8(c??{},o);if(this.storageKey=(p=D.auth.storageKey)!==null&&p!==void 0?p:"",this.headers=(v=D.global.headers)!==null&&v!==void 0?v:{},D.accessToken)this.accessToken=D.accessToken,this.auth=new Proxy({},{get:(J,ie)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(ie)} is not possible`)}});else{var j;this.auth=this._initSupabaseAuthClient((j=D.auth)!==null&&j!==void 0?j:{},this.headers,D.global.fetch)}this.fetch=z8(r,this._getAccessToken.bind(this),D.global.fetch),this.realtime=this._initRealtimeClient(kn({headers:this.headers,accessToken:this._getAccessToken.bind(this)},D.realtime)),this.accessToken&&Promise.resolve(this.accessToken()).then(J=>this.realtime.setAuth(J)).catch(J=>console.warn("Failed to set initial Realtime auth token:",J)),this.rest=new v6(new URL("rest/v1",w).href,{headers:this.headers,schema:D.db.schema,fetch:this.fetch}),this.storage=new fV(this.storageUrl.href,this.headers,this.fetch,c==null?void 0:c.storage),D.accessToken||this._listenForAuthEvents()}get functions(){return new p6(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}from(n){return this.rest.from(n)}schema(n){return this.rest.schema(n)}rpc(n,r={},c={head:!1,get:!1,count:void 0}){return this.rest.rpc(n,r,c)}channel(n,r={config:{}}){return this.realtime.channel(n,r)}getChannels(){return this.realtime.getChannels()}removeChannel(n){return this.realtime.removeChannel(n)}removeAllChannels(){return this.realtime.removeAllChannels()}async _getAccessToken(){var n=this,r,c;if(n.accessToken)return await n.accessToken();const{data:p}=await n.auth.getSession();return(r=(c=p.session)===null||c===void 0?void 0:c.access_token)!==null&&r!==void 0?r:n.supabaseKey}_initSupabaseAuthClient({autoRefreshToken:n,persistSession:r,detectSessionInUrl:c,storage:p,userStorage:v,storageKey:w,flowType:A,lock:o,debug:D,throwOnError:j},J,ie){const re={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new N8({url:this.authUrl.href,headers:kn(kn({},re),J),storageKey:w,autoRefreshToken:n,persistSession:r,detectSessionInUrl:c,storage:p,userStorage:v,flowType:A,lock:o,debug:D,throwOnError:j,fetch:ie,hasCustomAuthorizationHeader:Object.keys(this.headers).some(he=>he.toLowerCase()==="authorization")})}_initRealtimeClient(n){return new z6(this.realtimeUrl.href,kn(kn({},n),{},{params:kn(kn({},{apikey:this.supabaseKey}),n==null?void 0:n.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((n,r)=>{this._handleTokenChanged(n,"CLIENT",r==null?void 0:r.access_token)})}_handleTokenChanged(n,r,c){(n==="TOKEN_REFRESHED"||n==="SIGNED_IN")&&this.changedAccessToken!==c?(this.changedAccessToken=c,this.realtime.setAuth(c)):n==="SIGNED_OUT"&&(this.realtime.setAuth(),r=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}};const V8=(n,r,c)=>new U8(n,r,c);function $8(){if(typeof window<"u")return!1;const n=globalThis.process;if(!n)return!1;const r=n.version;if(r==null)return!1;const c=r.match(/^v(\d+)\./);return c?parseInt(c[1],10)<=18:!1}$8()&&console.warn("  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const G8="https://gfbbhvsfznxhimwvokob.supabase.co",H8="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImdmYmJodnNmem54aGltd3Zva29iIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjkxMzQ4MTYsImV4cCI6MjA4NDcxMDgxNn0.IJaI6vQJPA5Yb0tWtMHznjk-qY83RSWdYPjzorQUMyw",W8=G8,q8=H8,Ws=V8(W8,q8,{realtime:{params:{eventsPerSecond:10}}});async function YD(n,r){try{const c=await fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${n}&lon=${r}&addressdetails=1`,{headers:{"User-Agent":"EMG-FieldOps/1.0"}});if(!c.ok)return null;const p=await c.json();if(p.address){const{house_number:v,road:w,city:A,town:o,village:D,state:j}=p.address,J=[];return v&&w?J.push(`${v} ${w}`):w&&J.push(w),(A||o||D)&&J.push(A||o||D),j&&J.push(j),J.join(", ")||p.display_name}return p.display_name||null}catch(c){return console.error("Reverse geocode error:",c),null}}async function Z8(n){try{let r=n.address;r||(r=await YD(n.position.lat,n.position.lng)||void 0);const{data:c,error:p}=await Ws.from("knocks").insert({lat:n.position.lat,lng:n.position.lng,address:r,result:n.result,notes:n.notes,canvasser_id:n.canvasserId,canvasser_name:n.canvasserName}).select().single();return p?(console.error("Error creating knock:",p),null):c}catch(r){return console.error("Create knock error:",r),null}}async function X8(){try{const n=new Date;n.setHours(0,0,0,0);const{data:r,error:c}=await Ws.from("knocks").select("*").gte("created_at",n.toISOString()).order("created_at",{ascending:!1});return c?(console.error("Error fetching today knocks:",c),[]):r}catch(n){return console.error("Get today knocks error:",n),[]}}function K8(n,r,c){const p=Ws.channel("knocks-realtime").on("postgres_changes",{event:"INSERT",schema:"public",table:"knocks"},v=>n(v.new)).on("postgres_changes",{event:"UPDATE",schema:"public",table:"knocks"},v=>r==null?void 0:r(v.new)).on("postgres_changes",{event:"DELETE",schema:"public",table:"knocks"},v=>c==null?void 0:c(v.old.id)).subscribe();return()=>{p.unsubscribe()}}const Y8={},VP=n=>{let r;const c=new Set,p=(J,ie)=>{const re=typeof J=="function"?J(r):J;if(!Object.is(re,r)){const he=r;r=ie??(typeof re!="object"||re===null)?re:Object.assign({},r,re),c.forEach(ce=>ce(r,he))}},v=()=>r,D={setState:p,getState:v,getInitialState:()=>j,subscribe:J=>(c.add(J),()=>c.delete(J)),destroy:()=>{(Y8?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),c.clear()}},j=r=n(p,v,D);return D},J8=n=>n?VP(n):VP;var JD={exports:{}},QD={},eO={exports:{}},tO={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fp=Z;function Q8(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var e7=typeof Object.is=="function"?Object.is:Q8,t7=fp.useState,i7=fp.useEffect,r7=fp.useLayoutEffect,n7=fp.useDebugValue;function s7(n,r){var c=r(),p=t7({inst:{value:c,getSnapshot:r}}),v=p[0].inst,w=p[1];return r7(function(){v.value=c,v.getSnapshot=r,eS(v)&&w({inst:v})},[n,c,r]),i7(function(){return eS(v)&&w({inst:v}),n(function(){eS(v)&&w({inst:v})})},[n]),n7(c),c}function eS(n){var r=n.getSnapshot;n=n.value;try{var c=r();return!e7(n,c)}catch{return!0}}function o7(n,r){return r()}var a7=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?o7:s7;tO.useSyncExternalStore=fp.useSyncExternalStore!==void 0?fp.useSyncExternalStore:a7;eO.exports=tO;var l7=eO.exports;/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o1=Z,c7=l7;function u7(n,r){return n===r&&(n!==0||1/n===1/r)||n!==n&&r!==r}var h7=typeof Object.is=="function"?Object.is:u7,d7=c7.useSyncExternalStore,f7=o1.useRef,p7=o1.useEffect,m7=o1.useMemo,g7=o1.useDebugValue;QD.useSyncExternalStoreWithSelector=function(n,r,c,p,v){var w=f7(null);if(w.current===null){var A={hasValue:!1,value:null};w.current=A}else A=w.current;w=m7(function(){function D(he){if(!j){if(j=!0,J=he,he=p(he),v!==void 0&&A.hasValue){var ce=A.value;if(v(ce,he))return ie=ce}return ie=he}if(ce=ie,h7(J,he))return ce;var xe=p(he);return v!==void 0&&v(ce,xe)?(J=he,ce):(J=he,ie=xe)}var j=!1,J,ie,re=c===void 0?null:c;return[function(){return D(r())},re===null?void 0:function(){return D(re())}]},[r,c,p,v]);var o=d7(n,w[0],w[1]);return p7(function(){A.hasValue=!0,A.value=o},[o]),g7(o),o};JD.exports=QD;var _7=JD.exports;const y7=_T(_7),iO={},{useDebugValue:v7}=wT,{useSyncExternalStoreWithSelector:x7}=y7;let $P=!1;const b7=n=>n;function w7(n,r=b7,c){(iO?"production":void 0)!=="production"&&c&&!$P&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),$P=!0);const p=x7(n.subscribe,n.getState,n.getServerState||n.getInitialState,r,c);return v7(p),p}const S7=n=>{(iO?"production":void 0)!=="production"&&typeof n!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const r=typeof n=="function"?J8(n):n,c=(p,v)=>w7(r,p,v);return Object.assign(c,r),c},T7=n=>S7,E7={};function I7(n,r){let c;try{c=n()}catch{return}return{getItem:v=>{var w;const A=D=>D===null?null:JSON.parse(D,void 0),o=(w=c.getItem(v))!=null?w:null;return o instanceof Promise?o.then(A):A(o)},setItem:(v,w)=>c.setItem(v,JSON.stringify(w,void 0)),removeItem:v=>c.removeItem(v)}}const z_=n=>r=>{try{const c=n(r);return c instanceof Promise?c:{then(p){return z_(p)(c)},catch(p){return this}}}catch(c){return{then(p){return this},catch(p){return z_(p)(c)}}}},A7=(n,r)=>(c,p,v)=>{let w={getStorage:()=>localStorage,serialize:JSON.stringify,deserialize:JSON.parse,partialize:Ee=>Ee,version:0,merge:(Ee,ve)=>({...ve,...Ee}),...r},A=!1;const o=new Set,D=new Set;let j;try{j=w.getStorage()}catch{}if(!j)return n((...Ee)=>{console.warn(`[zustand persist middleware] Unable to update item '${w.name}', the given storage is currently unavailable.`),c(...Ee)},p,v);const J=z_(w.serialize),ie=()=>{const Ee=w.partialize({...p()});let ve;const K=J({state:Ee,version:w.version}).then(fe=>j.setItem(w.name,fe)).catch(fe=>{ve=fe});if(ve)throw ve;return K},re=v.setState;v.setState=(Ee,ve)=>{re(Ee,ve),ie()};const he=n((...Ee)=>{c(...Ee),ie()},p,v);let ce;const xe=()=>{var Ee;if(!j)return;A=!1,o.forEach(K=>K(p()));const ve=((Ee=w.onRehydrateStorage)==null?void 0:Ee.call(w,p()))||void 0;return z_(j.getItem.bind(j))(w.name).then(K=>{if(K)return w.deserialize(K)}).then(K=>{if(K)if(typeof K.version=="number"&&K.version!==w.version){if(w.migrate)return w.migrate(K.state,K.version);console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return K.state}).then(K=>{var fe;return ce=w.merge(K,(fe=p())!=null?fe:he),c(ce,!0),ie()}).then(()=>{ve==null||ve(ce,void 0),A=!0,D.forEach(K=>K(ce))}).catch(K=>{ve==null||ve(void 0,K)})};return v.persist={setOptions:Ee=>{w={...w,...Ee},Ee.getStorage&&(j=Ee.getStorage())},clearStorage:()=>{j==null||j.removeItem(w.name)},getOptions:()=>w,rehydrate:()=>xe(),hasHydrated:()=>A,onHydrate:Ee=>(o.add(Ee),()=>{o.delete(Ee)}),onFinishHydration:Ee=>(D.add(Ee),()=>{D.delete(Ee)})},xe(),ce||he},C7=(n,r)=>(c,p,v)=>{let w={storage:I7(()=>localStorage),partialize:xe=>xe,version:0,merge:(xe,Ee)=>({...Ee,...xe}),...r},A=!1;const o=new Set,D=new Set;let j=w.storage;if(!j)return n((...xe)=>{console.warn(`[zustand persist middleware] Unable to update item '${w.name}', the given storage is currently unavailable.`),c(...xe)},p,v);const J=()=>{const xe=w.partialize({...p()});return j.setItem(w.name,{state:xe,version:w.version})},ie=v.setState;v.setState=(xe,Ee)=>{ie(xe,Ee),J()};const re=n((...xe)=>{c(...xe),J()},p,v);v.getInitialState=()=>re;let he;const ce=()=>{var xe,Ee;if(!j)return;A=!1,o.forEach(K=>{var fe;return K((fe=p())!=null?fe:re)});const ve=((Ee=w.onRehydrateStorage)==null?void 0:Ee.call(w,(xe=p())!=null?xe:re))||void 0;return z_(j.getItem.bind(j))(w.name).then(K=>{if(K)if(typeof K.version=="number"&&K.version!==w.version){if(w.migrate)return[!0,w.migrate(K.state,K.version)];console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,K.state];return[!1,void 0]}).then(K=>{var fe;const[ke,Be]=K;if(he=w.merge(Be,(fe=p())!=null?fe:re),c(he,!0),ke)return J()}).then(()=>{ve==null||ve(he,void 0),he=p(),A=!0,D.forEach(K=>K(he))}).catch(K=>{ve==null||ve(void 0,K)})};return v.persist={setOptions:xe=>{w={...w,...xe},xe.storage&&(j=xe.storage)},clearStorage:()=>{j==null||j.removeItem(w.name)},getOptions:()=>w,rehydrate:()=>ce(),hasHydrated:()=>A,onHydrate:xe=>(o.add(xe),()=>{o.delete(xe)}),onFinishHydration:xe=>(D.add(xe),()=>{D.delete(xe)})},w.skipHydration||ce(),he||re},k7=(n,r)=>"getStorage"in r||"serialize"in r||"deserialize"in r?((E7?"production":void 0)!=="production"&&console.warn("[DEPRECATED] `getStorage`, `serialize` and `deserialize` options are deprecated. Use `storage` option instead."),A7(n,r)):C7(n,r),L7=k7,P7=[{id:"aaaaaaaa-aaaa-aaaa-aaaa-aaaaaaaaaaaa",name:"Omar",email:"omar.amin.jem@gmail.com",enm_number:"Enm058",active:!0,isAdmin:!0},{id:"bbbbbbbb-bbbb-bbbb-bbbb-bbbbbbbbbbbb",name:"Ahmad Amin",email:"ahmad@emgllc.co",enm_number:"ENM001",active:!0,isAdmin:!0},{id:"cccccccc-cccc-cccc-cccc-cccccccccccc",name:"Carli",email:"carli@cmwmarketingsolutions.com",enm_number:"Enm019",active:!0,isAdmin:!0},{id:"dddddddd-dddd-dddd-dddd-dddddddddddd",name:"Aiman Ibrahim",email:"aimanibrahimrsm@gmail.com",enm_number:"Enm090",active:!0,isAdmin:!0},{id:"enm115",name:"Jaydev Solanki",email:"jayskee1989@gmail.com",enm_number:"ENM115",active:!0},{id:"enm095",name:"Vernon Thomas",email:"vernt151@gmail.com",enm_number:"ENM095",active:!0},{id:"enm075",name:"Jacob Berube",email:"jakeberube01@gmail.com",enm_number:"ENM075",active:!0},{id:"enm101",name:"Totiana Washington-Stevens",email:"totianaw.fcb@gmail.com",enm_number:"ENM101",active:!0},{id:"enm088",name:"Lejohn Windn",email:"lejohnw@gmail.com",enm_number:"ENM088",active:!0},{id:"enm045",name:"Dominic Shea",email:"dominicshea99@gmail.com",enm_number:"ENM045",active:!0},{id:"enm050",name:"Tyler Dessaure",email:"tydesse@gmail.com",enm_number:"ENM050",active:!0},{id:"enm083",name:"Sean Ivey",email:"poisenivey@gmail.com",enm_number:"ENM083",active:!0},{id:"enm116",name:"Quinton Palmer",email:"cue_palmer@yahoo.com",enm_number:"ENM116",active:!0},{id:"enm064",name:"Haseeb Uppal",email:"haseebuppal123@gmail.com",enm_number:"ENM064",active:!0},{id:"enm106",name:"Marques Haskins",email:"marques.haskins212@gmail.com",enm_number:"ENM106",active:!0},{id:"enm103",name:"Talan Alexander",email:"talanalexander23@gmail.com",enm_number:"ENM103",active:!0},{id:"enm094",name:"Shibela Goins",email:"shibelagoins@gmail.com",enm_number:"ENM094",active:!0},{id:"enm086",name:"Keiron Moore",email:"kmoore0722@outlook.com",enm_number:"ENM086",active:!0},{id:"enm047",name:"Steven Moore",email:"mooresteven227@gmail.com",enm_number:"ENM047",active:!0},{id:"enm070",name:"Tommy DeSocio",email:"tommyaeg@emarketinggroup.co",enm_number:"ENM070",active:!0},{id:"enm039",name:"Paul Oslica",email:"pauloslica94@gmail.com",enm_number:"ENM039",active:!0},{id:"enm107",name:"Babacar Niang",email:"bniang006@gmail.com",enm_number:"ENM107",active:!0},{id:"enm084",name:"Christian Sawyer",email:"chrisjeansawyer@gmail.com",enm_number:"ENM084",active:!0},{id:"enm096",name:"Aiden Harris",email:"aidenjon.134@gmail.com",enm_number:"ENM096",active:!0},{id:"enm035",name:"Malani Lamkin",email:"malani.lamkin@icloud.com",enm_number:"ENM035",active:!0},{id:"enm069",name:"Cameron Fahey",email:"cam.fahey97@gmail.com",enm_number:"ENM069",active:!0},{id:"enm104",name:"Giavanna Agostini",email:"giavannamodeling@gmail.com",enm_number:"ENM104",active:!0},{id:"enm098",name:"Parion Martin",email:"parionmartin02@gmail.com",enm_number:"ENM098",active:!0},{id:"enm071",name:"Kirubel Motuma",email:"kirubem@gmail.com",enm_number:"ENM071",active:!0},{id:"enm076",name:"Vincenzo Castronovo",email:"vcastronovo16@gmail.com",enm_number:"ENM076",active:!0},{id:"enm093",name:"Jamar Johnson",email:"jboydjohnson38@gmail.com",enm_number:"ENM093",active:!0},{id:"enm067",name:"Yusuf Kamara",email:"princekamara2727@gmail.com",enm_number:"ENM067",active:!0}],Pu=T7()(L7((n,r)=>({currentRep:null,isLoading:!1,error:null,login:async(c,p)=>{n({isLoading:!0,error:null});const v=c.toLowerCase().trim(),w=P7.find(o=>o.email.toLowerCase()===v&&o.enm_number===p&&o.active);if(!w)return n({isLoading:!1,error:"Invalid email or ENM number"}),!1;const{data:A}=await Ws.from("canvassers").select("*").eq("id",w.id).single();return A||await Ws.from("canvassers").insert({id:w.id,name:w.name,email:w.email,active:!0}),n({currentRep:{...w,created_at:new Date().toISOString()},isLoading:!1,error:null}),!0},logout:()=>{n({currentRep:null,error:null})},updateProfile:async c=>{const{currentRep:p}=r();if(!p)return!1;const{error:v}=await Ws.from("canvassers").update({name:c.name}).eq("id",p.id);return v?(console.error("Failed to update profile:",v),!1):(n({currentRep:{...p,...c}}),!0)}}),{name:"emg-auth",partialize:n=>({currentRep:n.currentRep})})),M7="AIzaSyA0Bf8ogR-QMUaHnA2SX_q8J9ONknHiuBU",tS=[{result:"not_home",label:"Not Home",shortLabel:"Not Home",icon:gD,color:"#6b7280",markerColor:"#9ca3af"},{result:"not_interested",label:"Not Interested",shortLabel:"No Interest",icon:aN,color:"#ef4444",markerColor:"#f87171"},{result:"signed_up",label:"Signed Up!",shortLabel:"SIGNED UP",icon:mD,color:"#10b981",markerColor:"#34d399"},{result:"doesnt_qualify",label:"Doesn't Qualify",shortLabel:"No Qualify",icon:cN,color:"#f59e0b",markerColor:"#fbbf24"},{result:"callback",label:"Callback",shortLabel:"Callback",icon:yD,color:"#3b82f6",markerColor:"#60a5fa"},{result:"wrong_address",label:"Pending Enrollment",shortLabel:"Pending",icon:X4,color:"#8b5cf6",markerColor:"#a78bfa"}],R7={width:"100%",height:"100%"},D7={lat:37.05,lng:-76.3},O7={disableDefaultUI:!0,zoomControl:!1,mapTypeControl:!1,streetViewControl:!1,fullscreenControl:!1,gestureHandling:"greedy",styles:[{elementType:"geometry",stylers:[{color:"#1a1a2e"}]},{elementType:"labels.text.stroke",stylers:[{color:"#1a1a2e"}]},{elementType:"labels.text.fill",stylers:[{color:"#8b8b8b"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#2d2d44"}]},{featureType:"road",elementType:"labels.text.fill",stylers:[{color:"#9ca3af"}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#0e4166"}]},{featureType:"poi",elementType:"labels",stylers:[{visibility:"off"}]},{featureType:"poi.park",elementType:"geometry",stylers:[{color:"#1a3a1a"}]},{featureType:"transit",stylers:[{visibility:"off"}]}]};function z7(){const[n,r]=Z.useState(null),[c,p]=Z.useState("acquiring"),[v,w]=Z.useState("map"),[A,o]=Z.useState(null),[D,j]=Z.useState(""),[J,ie]=Z.useState(!1),[re,he]=Z.useState(""),[ce,xe]=Z.useState(!1),[Ee,ve]=Z.useState([]),[K,fe]=Z.useState(null),[ke,Be]=Z.useState(D7),[Le,We]=Z.useState(!0),ct=Z.useRef(null),lt=Z.useRef(null),{currentRep:Pt}=Pu(),zt=(Pt==null?void 0:Pt.id)||"00000000-0000-0000-0000-000000000001",_i=(Pt==null?void 0:Pt.name)||"Unknown",{isLoaded:Ut,loadError:bi}=UN({googleMapsApiKey:M7});Z.useEffect(()=>(p("acquiring"),ct.current=navigator.geolocation.watchPosition(Ft=>{const Ot={lat:Ft.coords.latitude,lng:Ft.coords.longitude,accuracy:Ft.coords.accuracy};r(Ot),p("locked"),Le&&Be({lat:Ot.lat,lng:Ot.lng})},Ft=>{console.error("GPS error:",Ft),p("error")},{enableHighAccuracy:!0,maximumAge:3e3,timeout:1e4}),()=>{ct.current&&navigator.geolocation.clearWatch(ct.current)}),[Le]),Z.useEffect(()=>{X8().then(ve)},[]),Z.useEffect(()=>K8(Ot=>ve(di=>[Ot,...di]),Ot=>ve(di=>di.map(wt=>wt.id===Ot.id?Ot:wt)),Ot=>ve(di=>di.filter(wt=>wt.id!==Ot))),[]);const vi=Z.useCallback(Ft=>{lt.current=Ft},[]),ei=Z.useCallback(()=>{We(!1)},[]),si=()=>{n&&lt.current&&(lt.current.panTo({lat:n.lat,lng:n.lng}),We(!0))},Tt=async()=>{if(w("knock"),o(null),j(""),he(""),n){xe(!0);try{const Ft=await YD(n.lat,n.lng);he(Ft||"")}catch(Ft){console.error("Geocode error:",Ft)}xe(!1)}},Ht=async Ft=>{if(n){o(Ft),ie(!0);try{if(await Z8({position:{lat:n.lat,lng:n.lng,accuracy:n.accuracy,timestamp:Date.now()},result:Ft,notes:D||void 0,canvasserId:zt,canvasserName:_i,address:re||void 0})){const di=tS.find(wt=>wt.result===Ft);fe({message:` ${(di==null?void 0:di.shortLabel)||Ft}`,type:"success"}),setTimeout(()=>fe(null),2e3),w("map"),o(null),j("")}}catch{fe({message:" Failed",type:"error"}),setTimeout(()=>fe(null),2e3)}ie(!1)}},Gt={total:Ee.length,signedUp:Ee.filter(Ft=>Ft.result==="signed_up").length},hi=Ft=>{const Ot=tS.find(wt=>wt.result===Ft),di=(Ot==null?void 0:Ot.markerColor)||"#9ca3af";return{path:google.maps.SymbolPath.CIRCLE,fillColor:di,fillOpacity:.9,strokeColor:"#ffffff",strokeWeight:2,scale:Ft==="signed_up"?10:7}};return bi?N.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"#0f172a",color:"#ef4444"},children:"Map failed to load"}):Ut?N.jsxs("div",{style:{display:"flex",flexDirection:"column",height:"calc(100vh - 5rem)",background:"#0f172a"},children:[K&&N.jsx("div",{style:{position:"fixed",top:"1rem",left:"50%",transform:"translateX(-50%)",background:K.type==="success"?"#10b981":"#ef4444",color:"white",padding:"0.75rem 1.5rem",borderRadius:"2rem",boxShadow:"0 4px 20px rgba(0,0,0,0.4)",zIndex:1e3,fontWeight:700,fontSize:"1rem"},children:K.message}),v==="map"?N.jsxs(N.Fragment,{children:[N.jsxs("div",{style:{padding:"0.5rem 1rem",background:"var(--bg-primary)",display:"flex",justifyContent:"space-between",alignItems:"center",borderBottom:"1px solid var(--bg-card)"},children:[N.jsxs("div",{style:{fontSize:"0.875rem",fontWeight:600},children:[" ",Gt.signedUp," signed  ",Gt.total," total"]}),N.jsx("div",{style:{fontSize:"0.75rem",padding:"0.25rem 0.5rem",borderRadius:"1rem",background:c==="locked"?"rgba(16,185,129,0.2)":"rgba(239,68,68,0.2)",color:c==="locked"?"#10b981":"#ef4444"},children:c==="locked"&&n?`${Math.round(n.accuracy)}m`:c==="acquiring"?"...":""})]}),N.jsxs("div",{style:{flex:1,position:"relative"},children:[N.jsxs(kN,{mapContainerStyle:R7,center:ke,zoom:18,options:O7,onLoad:vi,onDragStart:ei,children:[n&&N.jsxs(N.Fragment,{children:[N.jsx(PD,{center:{lat:n.lat,lng:n.lng},radius:n.accuracy,options:{fillColor:"#3b82f6",fillOpacity:.15,strokeColor:"#3b82f6",strokeOpacity:.3,strokeWeight:1}}),N.jsx(nT,{position:{lat:n.lat,lng:n.lng},icon:{path:google.maps.SymbolPath.CIRCLE,fillColor:"#3b82f6",fillOpacity:1,strokeColor:"#ffffff",strokeWeight:3,scale:8},zIndex:1e3})]}),Ee.map(Ft=>N.jsx(nT,{position:{lat:Ft.lat,lng:Ft.lng},icon:hi(Ft.result),title:`${Ft.result}${Ft.address?` - ${Ft.address}`:""}`},Ft.id))]}),!Le&&n&&N.jsx("button",{onClick:si,style:{position:"absolute",bottom:"1rem",right:"1rem",width:"48px",height:"48px",borderRadius:"50%",background:"var(--bg-card)",border:"2px solid var(--bg-secondary)",display:"flex",alignItems:"center",justifyContent:"center",color:"#3b82f6",boxShadow:"0 2px 10px rgba(0,0,0,0.3)",zIndex:100},children:N.jsx(_D,{size:24})})]}),N.jsx("div",{style:{padding:"1rem",paddingBottom:"1.5rem",background:"var(--bg-primary)"},children:N.jsxs("button",{onClick:Tt,disabled:c!=="locked",style:{width:"100%",padding:"1.25rem",fontSize:"1.25rem",fontWeight:700,background:c==="locked"?"#10b981":"#374151",color:"white",border:"none",borderRadius:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.75rem",boxShadow:c==="locked"?"0 4px 20px rgba(16,185,129,0.4)":"none",opacity:c==="locked"?1:.5},children:[N.jsx(rN,{size:28,strokeWidth:3})," LOG KNOCK"]})})]}):N.jsxs("div",{style:{flex:1,display:"flex",flexDirection:"column",background:"#0f172a",overflow:"hidden"},children:[N.jsx("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderBottom:"1px solid var(--bg-card)"},children:N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.5rem"},children:[N.jsxs("div",{style:{flex:1},children:[N.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginBottom:"0.25rem"},children:[N.jsx(hc,{size:12,style:{display:"inline",marginRight:"0.25rem"}}),"LOGGING AT:"]}),ce?N.jsx("div",{style:{color:"var(--text-secondary)"},children:"Detecting address..."}):N.jsx("div",{style:{fontSize:"0.9rem",fontWeight:500,color:"var(--text-primary)"},children:re||"Address unavailable"})]}),N.jsx("button",{onClick:()=>w("map"),style:{background:"var(--bg-card)",border:"none",borderRadius:"50%",width:"44px",height:"44px",display:"flex",alignItems:"center",justifyContent:"center",color:"var(--text-primary)"},children:N.jsx(hN,{size:24})})]})}),N.jsx("div",{style:{padding:"0.75rem",display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.5rem"},children:tS.map(({result:Ft,shortLabel:Ot,icon:di,color:wt})=>N.jsxs("button",{onClick:()=>Ht(Ft),disabled:J,style:{background:A===Ft?wt:"var(--bg-card)",border:`2px solid ${wt}`,borderRadius:"0.75rem",padding:"0.875rem 0.5rem",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",gap:"0.25rem",color:"white",fontSize:"0.8rem",fontWeight:600,opacity:J?.5:1},children:[N.jsx(di,{size:24,color:A===Ft?"white":wt}),N.jsx("span",{style:{color:A===Ft?"white":wt},children:Ot})]},Ft))}),N.jsx("div",{style:{padding:"0.5rem 0.75rem 0.75rem",background:"var(--bg-secondary)"},children:N.jsx("input",{type:"text",value:D,onChange:Ft=>j(Ft.target.value),placeholder:"+ Add note (optional)",style:{width:"100%",background:"var(--bg-card)",border:"2px solid var(--bg-card)",borderRadius:"0.5rem",padding:"0.75rem",color:"var(--text-primary)",fontSize:"0.875rem",textAlign:"center"}})})]})]}):N.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100vh",background:"#0f172a",color:"white"},children:N.jsx(J4,{className:"animate-spin",size:32})})}const T2=[{id:"1",name:"Yusuf K.",weeklyDeals:21,payrollKwh:247,lastUpdated:"2026-01-27"},{id:"2",name:"Syed N.",weeklyDeals:16,payrollKwh:237,lastUpdated:"2026-01-27"},{id:"3",name:"Jamar J.",weeklyDeals:13,payrollKwh:136,lastUpdated:"2026-01-27"},{id:"4",name:"Parion M.",weeklyDeals:13,payrollKwh:82,lastUpdated:"2026-01-27"},{id:"5",name:"Vernon T.",weeklyDeals:12,payrollKwh:97,lastUpdated:"2026-01-27"}],B7=()=>[...T2].sort((n,r)=>r.weeklyDeals-n.weeklyDeals),F7=()=>[...T2].sort((n,r)=>r.payrollKwh-n.payrollKwh),j7=()=>{var n;return((n=T2[0])==null?void 0:n.lastUpdated)||"Never"},N7={weeklyTarget:120},GP=n=>n>=N7.weeklyTarget;function U7(){const[n,r]=Z.useState("deals"),c=n==="deals"?B7():F7(),p=j7(),v=j=>j===1?"":j===2?"":j===3?"":j,w=j=>j===1?"gold":j===2?"silver":j===3?"bronze":"",A=c.reduce((j,J)=>j+J.weeklyDeals,0),o=c.reduce((j,J)=>j+J.payrollKwh,0),D=c.filter(j=>GP(j.payrollKwh)).length;return N.jsxs("div",{className:"page",children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600},children:" Leaderboard"}),N.jsx("div",{style:{background:"var(--bg-secondary)",borderRadius:"1rem",padding:"0.375rem 0.75rem",color:"var(--text-secondary)",fontSize:"0.7rem"},children:"Viper Data"})]}),N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.5rem",marginBottom:"1rem"},children:[N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--accent)"},children:A}),N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:"Payroll Deals"})]}),N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--warning)"},children:[o,"k"]}),N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:"Payroll kWh"})]}),N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#a855f7"},children:D}),N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:"Trip Pace"})]})]}),N.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[N.jsxs("button",{onClick:()=>r("deals"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",background:n==="deals"?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"0.75rem",color:"var(--text-primary)",fontWeight:n==="deals"?600:400},children:[N.jsx(W4,{size:18}),"Deals"]}),N.jsxs("button",{onClick:()=>r("payroll"),style:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",padding:"0.75rem",background:n==="payroll"?"var(--warning)":"var(--bg-secondary)",border:"none",borderRadius:"0.75rem",color:"var(--text-primary)",fontWeight:n==="payroll"?600:400},children:[N.jsx(H4,{size:18}),"Payroll"]})]}),N.jsxs("div",{style:{background:n==="deals"?"rgba(16, 185, 129, 0.1)":"rgba(251, 191, 36, 0.1)",border:`1px solid ${n==="deals"?"rgba(16, 185, 129, 0.2)":"rgba(251, 191, 36, 0.2)"}`,borderRadius:"0.75rem",padding:"0.75rem 1rem",marginBottom:"1rem"},children:[N.jsx("div",{style:{fontSize:"0.875rem",fontWeight:600,color:n==="deals"?"var(--accent)":"var(--warning)"},children:n==="deals"?" Payroll Deals":" Payroll kWh"}),N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"0.25rem"},children:n==="deals"?"Deals hitting payroll this week (Mon-Sun)":"kWh hitting payroll this week (Mon-Sun)"})]}),N.jsx("div",{className:"card",children:c.map((j,J)=>{const ie=GP(j.payrollKwh);return N.jsxs("div",{className:"leaderboard-item",style:{padding:"0.875rem 0"},children:[N.jsx("div",{className:`leaderboard-rank ${w(J+1)}`,children:v(J+1)}),N.jsx("div",{style:{flex:1},children:N.jsxs("div",{className:"leaderboard-name",style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[j.name,ie&&N.jsx("span",{style:{background:"rgba(168, 85, 247, 0.2)",color:"#a855f7",fontSize:"0.6rem",padding:"0.125rem 0.375rem",borderRadius:"0.25rem",fontWeight:600},children:" TRIP"})]})}),N.jsxs("div",{style:{textAlign:"right"},children:[N.jsx("div",{className:"leaderboard-value",style:{color:n==="deals"?"var(--accent)":"var(--warning)",display:"flex",alignItems:"center",justifyContent:"flex-end",gap:"0.25rem"},children:n==="deals"?N.jsxs(N.Fragment,{children:[j.weeklyDeals," deals"]}):N.jsxs(N.Fragment,{children:[N.jsx(_2,{size:14}),j.payrollKwh,"k"]})}),N.jsx("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:n==="deals"?`${j.payrollKwh}k kWh`:`${j.weeklyDeals} deals`})]})]},j.id)})}),N.jsxs("div",{style:{textAlign:"center",color:"var(--text-secondary)",fontSize:"0.75rem",marginTop:"1rem"},children:["Last sync: ",p]})]})}function V7(){const p=[{day:"Mon",earnings:142.5,signups:3},{day:"Tue",earnings:190,signups:4},{day:"Wed",earnings:95,signups:2},{day:"Thu",earnings:237.5,signups:5},{day:"Fri",earnings:182.5,signups:4},{day:"Sat",earnings:0,signups:0},{day:"Sun",earnings:0,signups:0}];return N.jsxs("div",{className:"page",children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:"1rem"},children:" Earnings"}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"This Week"}),N.jsxs("div",{className:"earnings-big",children:["$",847.5.toFixed(2)]}),N.jsxs("div",{className:"progress-container",style:{marginTop:"1rem"},children:[N.jsxs("div",{className:"progress-label",children:[N.jsx("span",{style:{color:"var(--text-secondary)"},children:"Weekly Goal"}),N.jsxs("span",{children:["$",1e3.toFixed(0)]})]}),N.jsx("div",{className:"progress-bar",style:{height:"0.75rem"},children:N.jsx("div",{className:"progress-fill",style:{width:`${Math.min(84.75,100)}%`}})})]}),N.jsxs("div",{style:{textAlign:"center",marginTop:"0.75rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:["$",(1e3-847.5).toFixed(2)," to weekly goal"]})]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Daily Breakdown"}),p.map((A,o)=>{const D=o===4,j=Math.max(...p.map(ie=>ie.earnings)),J=A.earnings>0?A.earnings/j*100:0;return N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 0",borderBottom:o<p.length-1?"1px solid var(--bg-card)":"none",opacity:A.earnings===0?.4:1},children:[N.jsxs("div",{style:{width:"40px",fontWeight:D?700:400},children:[A.day,D&&N.jsx("span",{style:{color:"var(--accent)"},children:" "})]}),N.jsx("div",{style:{flex:1},children:N.jsx("div",{style:{height:"8px",background:"var(--bg-card)",borderRadius:"4px",overflow:"hidden"},children:N.jsx("div",{style:{height:"100%",width:`${J}%`,background:"var(--accent)",borderRadius:"4px",transition:"width 0.3s ease"}})})}),N.jsx("div",{style:{width:"80px",textAlign:"right",fontWeight:600,color:A.earnings>0?"var(--accent)":"var(--text-secondary)"},children:A.earnings>0?`$${A.earnings.toFixed(2)}`:"--"}),N.jsx("div",{style:{width:"50px",textAlign:"right",fontSize:"0.875rem",color:"var(--text-secondary)"},children:A.signups>0?`${A.signups} sig`:""})]},A.day)})]}),N.jsxs("div",{className:"card",style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.2) 0%, rgba(16, 185, 129, 0.05) 100%)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:[N.jsx("div",{className:"card-title",style:{color:"var(--accent-light)"},children:" Pending Payout"}),N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[N.jsxs("div",{children:[N.jsxs("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--accent-light)"},children:["$",847.5.toFixed(2)]}),N.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:["Next payday: ","Friday, Jan 31"]})]}),N.jsx("div",{style:{fontSize:"2.5rem"},children:""})]})]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"All-Time Stats"}),N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:"$8,550"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Total Earned"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:"180"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Total Signups"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:"1,847"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Doors Knocked"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:"9.7%"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Conversion Rate"})]})]})]})]})}function $7(){const[n,r]=Z.useState(null),c=p=>{r(n===p?null:p)};return N.jsxs("div",{className:"page",children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:"1rem"},children:" Quick Reference"}),N.jsxs("div",{className:"card",style:{padding:0},children:[N.jsxs("button",{onClick:()=>c("pitch"),className:"ref-item",style:{width:"100%",background:n==="pitch"?"var(--bg-card)":"transparent",borderRadius:n==="pitch"?"1rem 1rem 0 0":"1rem"},children:[N.jsx(vD,{style:{color:"var(--accent)"}}),N.jsx("span",{style:{flex:1,textAlign:"left"},children:"Opening & Pitch"}),n==="pitch"?N.jsx(k0,{size:20}):N.jsx(Rf,{size:20})]}),n==="pitch"&&N.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid var(--bg-card)"},children:[N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"var(--accent)"},children:" The Opening (First 10 Seconds)"}),N.jsx("div",{style:{background:"var(--bg-card)",padding:"1rem",borderRadius:"0.5rem",fontStyle:"italic",lineHeight:1.6},children:`"Hi there! I'm [NAME]  I'm out in the neighborhood today letting folks know about a state program that's saving people money on their electric bills. Quick question: do you or anyone in the household receive any state benefits like SNAP or Medicaid?"`})]}),N.jsxs("div",{children:[N.jsx("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"var(--accent)"},children:" The Pitch (If They Qualify)"}),N.jsx("div",{style:{background:"var(--bg-card)",padding:"1rem",borderRadius:"0.5rem",fontStyle:"italic",lineHeight:1.6},children:`"Perfect  the state has this program that gives credits directly on your electric bill. People in this area are getting $20 to $50 off every month. Since you're already receiving [BENEFIT], you automatically qualify. I can get you signed up right now  takes about 2 minutes. Just need your electric bill and benefit card."`})]})]})]}),N.jsxs("div",{className:"card",style:{padding:0},children:[N.jsxs("button",{onClick:()=>c("objections"),className:"ref-item",style:{width:"100%",background:n==="objections"?"var(--bg-card)":"transparent",borderRadius:n==="objections"?"1rem 1rem 0 0":"1rem"},children:[N.jsx(g2,{style:{color:"var(--accent)"}}),N.jsx("span",{style:{flex:1,textAlign:"left"},children:"Objection Handlers"}),n==="objections"?N.jsx(k0,{size:20}):N.jsx(Rf,{size:20})]}),n==="objections"&&N.jsx("div",{style:{padding:"1rem",borderTop:"1px solid var(--bg-card)"},children:[{objection:`"I'm not interested"`,response:"Totally understand  just so you know, this is a state program you're already paying for through taxes. You're leaving money on the table."},{objection:'"Is this a scam?"',response:"Great question  this is a real state-run program. Here's my ID, here's the program info. You can call the number yourself to verify."},{objection:'"I need to talk to my spouse"',response:"No problem  when's a good time for me to come back when you're both here?"},{objection:`"I don't have time"`,response:"I get it  it literally takes 2 minutes. I can wait while you grab your bill."},{objection:'"I already have this"',response:"That's great! Do you know how much you're saving? Sometimes people only get partial benefits."}].map((p,v)=>N.jsxs("div",{style:{marginBottom:v<4?"1rem":0},children:[N.jsx("div",{style:{fontWeight:600,marginBottom:"0.25rem",color:"#f87171"},children:p.objection}),N.jsxs("div",{style:{color:"var(--text-secondary)",paddingLeft:"0.5rem",borderLeft:"2px solid var(--accent)"},children:[" ",p.response]})]},v))})]}),N.jsxs("div",{className:"card",style:{padding:0},children:[N.jsxs("button",{onClick:()=>c("benefits"),className:"ref-item",style:{width:"100%",background:n==="benefits"?"var(--bg-card)":"transparent",borderRadius:n==="benefits"?"1rem 1rem 0 0":"1rem"},children:[N.jsx(mD,{style:{color:"var(--accent)"}}),N.jsx("span",{style:{flex:1,textAlign:"left"},children:"Qualifying Benefits"}),n==="benefits"?N.jsx(k0,{size:20}):N.jsx(Rf,{size:20})]}),n==="benefits"&&N.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid var(--bg-card)"},children:[N.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.5rem"},children:[" SNAP (Food Stamps)"," Medicaid"," SSI"," LIHEAP"," Public Housing"," TANF"," WIC"," VA Pension"].map((p,v)=>N.jsx("div",{style:{padding:"0.5rem",background:"var(--bg-card)",borderRadius:"0.5rem",fontSize:"0.875rem"},children:p},v))}),N.jsxs("div",{style:{marginTop:"1rem",fontSize:"0.875rem",color:"var(--text-secondary)"},children:["Customer needs ",N.jsx("strong",{children:"ONE"})," qualifying benefit + lives in service zone = SIGN THEM UP"]})]})]}),N.jsxs("div",{className:"card",style:{padding:0},children:[N.jsxs("button",{onClick:()=>c("dos"),className:"ref-item",style:{width:"100%",background:n==="dos"?"var(--bg-card)":"transparent",borderRadius:n==="dos"?"1rem 1rem 0 0":"1rem"},children:[N.jsx(pD,{style:{color:"var(--accent)"}}),N.jsx("span",{style:{flex:1,textAlign:"left"},children:"Do's and Don'ts"}),n==="dos"?N.jsx(k0,{size:20}):N.jsx(Rf,{size:20})]}),n==="dos"&&N.jsxs("div",{style:{padding:"1rem",borderTop:"1px solid var(--bg-card)"},children:[N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"var(--accent)"},children:" DO"}),N.jsxs("ul",{style:{paddingLeft:"1.25rem",lineHeight:1.8},children:[N.jsx("li",{children:"Be honest about what this is"}),N.jsx("li",{children:"Be friendly and professional"}),N.jsx("li",{children:"Leave info even if they say no"}),N.jsx("li",{children:"Move on if they're firm"})]})]}),N.jsxs("div",{children:[N.jsx("div",{style:{fontWeight:600,marginBottom:"0.5rem",color:"#f87171"},children:" DON'T"}),N.jsxs("ul",{style:{paddingLeft:"1.25rem",lineHeight:1.8},children:[N.jsx("li",{children:"Promise specific amounts"}),N.jsx("li",{children:"Enter anyone's home"}),N.jsx("li",{children:"Argue with hostile people"}),N.jsx("li",{children:"Work after dark"})]})]})]})]}),N.jsxs("a",{href:"tel:+15551234567",className:"ref-item",style:{marginTop:"1rem",textDecoration:"none"},children:[N.jsx(yD,{style:{color:"var(--accent)"}}),N.jsx("span",{style:{flex:1},children:"Call Manager"}),N.jsx(Rf,{size:20})]})]})}function G7(){const n=id(),{id:r}=o4(),{currentRep:c}=Pu(),[p,v]=Z.useState(!1),[w,A]=Z.useState(!1),[o,D]=Z.useState(null),[j,J]=Z.useState(!1),[ie,re]=Z.useState("idle"),he={id:r,address:"142 Collier Dr",territory:"Langley Village",number:34,total:80},ce=async K=>{if(!j)if(K==="yes")v(!0);else if(K==="no")A(!0);else{J(!0),re("saving");const fe=await Ee(K);re(fe?"saved":"error"),setTimeout(()=>{J(!1),n("/door/next")},fe?300:1e3)}},xe=async K=>{if(j)return;J(!0),re("saving");const fe=await Ee("no",K);re(fe?"saved":"error"),setTimeout(()=>{J(!1),n("/door/next")},fe?300:1e3)},Ee=async(K,fe)=>{const ke={no_answer:"not_home",no:"not_interested",yes:"signed_up",callback:"callback",skip:"wrong_address"};let Be=0,Le=0;try{const ct=await new Promise((lt,Pt)=>{navigator.geolocation.getCurrentPosition(lt,Pt,{timeout:1e4,enableHighAccuracy:!0,maximumAge:3e4})});Be=ct.coords.latitude,Le=ct.coords.longitude}catch(ct){console.warn("Could not get location:",ct)}const We={lat:Be,lng:Le,address:he.address,result:ke[K],notes:fe?`Objection: ${fe}`:void 0,canvasser_id:(c==null?void 0:c.id)||"00000000-0000-0000-0000-000000000001",canvasser_name:(c==null?void 0:c.name)||"Unknown"};try{const{data:ct,error:lt}=await Ws.from("knocks").insert([We]).select();return lt?(console.error("Failed to save knock:",lt),!1):(console.log("Knock saved:",ct),!0)}catch(ct){return console.error("Error saving knock:",ct),!1}},ve=async K=>{if(j)return;J(!0),re("saving");const fe=await Ee("yes");try{const{error:ke}=await Ws.from("signups").insert([{customer_name:K.name,phone:K.phone,address:he.address,benefit_type:K.benefit,account_number:K.accountNumber,canvasser_id:"00000000-0000-0000-0000-000000000001",canvasser_name:"Demo User",lat:0,lng:0}]);ke?(console.error("Failed to save signup:",ke),re("error")):re("saved")}catch(ke){console.error("Error saving signup:",ke),re("error")}setTimeout(()=>{J(!1),n("/door/next")},fe?500:1500)};return w?N.jsx(W7,{onSelect:xe,onCancel:()=>A(!1)}):p?N.jsx(H7,{address:he.address,onSubmit:ve,onCancel:()=>v(!1),saving:j,saveStatus:ie}):N.jsxs("div",{children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[N.jsx("button",{onClick:()=>n("/map"),style:{background:"none",color:"var(--text-secondary)"},children:N.jsx(e1,{size:24})}),N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:he.address}),N.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:["Door ",he.number," of ",he.total]})]})]}),ie!=="idle"&&N.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",borderRadius:"0.5rem",textAlign:"center",background:ie==="saving"?"var(--bg-secondary)":ie==="saved"?"rgba(16, 185, 129, 0.2)":"rgba(239, 68, 68, 0.2)",color:ie==="saving"?"var(--text-secondary)":ie==="saved"?"#10b981":"#ef4444"},children:[ie==="saving"&&" Saving...",ie==="saved"&&" Saved!",ie==="error"&&" Save failed - will retry"]}),N.jsxs("div",{className:"door-buttons",children:[N.jsxs("button",{className:"door-btn no-answer",onClick:()=>ce("no_answer"),disabled:j,style:{opacity:j?.5:1},children:[N.jsx("span",{className:"door-btn-icon",children:""}),N.jsx("span",{children:"No Answer"})]}),N.jsxs("button",{className:"door-btn no",onClick:()=>ce("no"),disabled:j,style:{opacity:j?.5:1},children:[N.jsx("span",{className:"door-btn-icon",children:""}),N.jsx("span",{children:"Not Interested"})]}),N.jsxs("button",{className:"door-btn yes",onClick:()=>ce("yes"),disabled:j,style:{opacity:j?.5:1},children:[N.jsx("span",{className:"door-btn-icon",children:""}),N.jsx("span",{children:"Qualified!"})]})]}),N.jsxs("div",{className:"door-buttons",style:{gridTemplateColumns:"repeat(2, 1fr)"},children:[N.jsxs("button",{className:"door-btn callback",onClick:()=>ce("callback"),disabled:j,style:{opacity:j?.5:1},children:[N.jsx("span",{className:"door-btn-icon",children:""}),N.jsx("span",{children:"Callback"})]}),N.jsxs("button",{className:"door-btn skip",onClick:()=>ce("skip"),disabled:j,style:{opacity:j?.5:1},children:[N.jsx("span",{className:"door-btn-icon",children:""}),N.jsx("span",{children:"Skip"})]})]}),N.jsxs("div",{style:{marginTop:"2rem"},children:[N.jsxs("button",{className:"btn btn-secondary",style:{marginBottom:"0.75rem"},onClick:()=>n("/reference#pitch"),children:[N.jsx(K4,{size:18}),"Pitch Script"]}),N.jsxs("button",{className:"btn btn-secondary",onClick:()=>n("/reference#objections"),children:[N.jsx(g2,{size:18}),"Handle Objection"]})]})]})}function H7({address:n,onSubmit:r,onCancel:c,saving:p,saveStatus:v}){const[w,A]=Z.useState({name:"",phone:"",benefit:"",accountNumber:""}),o=["SNAP","Medicaid","SSI","LIHEAP","TANF","WIC","VA Pension","Other"];return N.jsxs("div",{children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[N.jsx("button",{onClick:c,disabled:p,style:{background:"none",color:"var(--text-secondary)",opacity:p?.5:1},children:N.jsx(e1,{size:24})}),N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:"New Signup"})]}),v!=="idle"&&N.jsxs("div",{style:{padding:"0.75rem",marginBottom:"1rem",borderRadius:"0.5rem",textAlign:"center",background:v==="saving"?"var(--bg-secondary)":v==="saved"?"rgba(16, 185, 129, 0.2)":"rgba(239, 68, 68, 0.2)",color:v==="saving"?"var(--text-secondary)":v==="saved"?"#10b981":"#ef4444"},children:[v==="saving"&&" Saving signup...",v==="saved"&&" Signup saved!",v==="error"&&" Save failed - will retry"]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Customer Info"}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",color:"var(--text-secondary)"},children:"Full Name"}),N.jsx("input",{type:"text",value:w.name,onChange:D=>A({...w,name:D.target.value}),placeholder:"John Smith",style:{width:"100%",padding:"0.875rem",background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem"}})]}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",color:"var(--text-secondary)"},children:"Phone Number"}),N.jsx("input",{type:"tel",value:w.phone,onChange:D=>A({...w,phone:D.target.value}),placeholder:"(555) 123-4567",style:{width:"100%",padding:"0.875rem",background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem"}})]}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",fontSize:"0.875rem",marginBottom:"0.5rem",color:"var(--text-secondary)"},children:"Address"}),N.jsxs("div",{style:{padding:"0.875rem",background:"var(--bg-card)",borderRadius:"0.5rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",gap:"0.5rem"},children:[N.jsx(hc,{size:16}),n]})]})]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Qualifying Benefit"}),N.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"0.5rem"},children:o.map(D=>N.jsx("button",{onClick:()=>A({...w,benefit:D}),style:{padding:"0.75rem",background:w.benefit===D?"var(--accent)":"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontWeight:w.benefit===D?600:400},children:D},D))})]}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Electric Account"}),N.jsx("button",{className:"btn btn-secondary",style:{marginBottom:"1rem"},onClick:()=>{A({...w,accountNumber:"1234567890"})},children:" Scan Electric Bill"}),w.accountNumber&&N.jsxs("div",{style:{padding:"0.75rem",background:"var(--bg-card)",borderRadius:"0.5rem",fontFamily:"monospace",textAlign:"center"},children:["Account: ",w.accountNumber]})]}),N.jsx("button",{className:"btn btn-primary btn-large",onClick:()=>r(w),disabled:!w.name||!w.phone||!w.benefit||p,style:{opacity:!w.name||!w.phone||!w.benefit||p?.5:1},children:p?" Saving...":" Submit Signup"})]})}function W7({onSelect:n,onCancel:r}){const c=[{id:"not_interested",label:"Not interested",emoji:""},{id:"scam",label:"Thinks it's a scam",emoji:""},{id:"spouse",label:"Needs to ask spouse",emoji:""},{id:"no_time",label:"No time right now",emoji:""},{id:"already_have",label:"Already has it",emoji:""},{id:"other",label:"Other / Unknown",emoji:""}];return N.jsxs("div",{children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[N.jsx("button",{onClick:r,style:{background:"none",color:"var(--text-secondary)"},children:N.jsx(e1,{size:24})}),N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:"What was their objection?"})]}),N.jsx("div",{style:{marginBottom:"1rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Quick tap  this helps us find the best areas"}),N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.75rem"},children:c.map(p=>N.jsxs("button",{onClick:()=>n(p.id),style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem",background:"var(--bg-secondary)",border:"none",borderRadius:"0.75rem",color:"var(--text-primary)",textAlign:"left",width:"100%"},children:[N.jsx("span",{style:{fontSize:"1.5rem"},children:p.emoji}),N.jsx("span",{style:{fontSize:"1rem"},children:p.label})]},p.id))}),N.jsx("button",{className:"btn btn-secondary",style:{marginTop:"1rem"},onClick:()=>n("other"),children:"Skip (just log as No)"})]})}function q7(){const[n,r]=Z.useState("achievements"),c=[{id:"first_signup",name:"First Blood",description:"Get your first signup",icon:"",unlocked:!0,date:"Jan 15"},{id:"ten_signups",name:"Double Digits",description:"Get 10 signups",icon:"",unlocked:!0,date:"Jan 18"},{id:"fifty_signups",name:"Closer",description:"Get 50 signups",icon:"",unlocked:!0,date:"Jan 23"},{id:"hundred_signups",name:"Centurion",description:"Get 100 signups",icon:"",unlocked:!1,progress:67},{id:"hundred_doors",name:"Iron Legs",description:"Knock 100 doors in a day",icon:"",unlocked:!1,progress:87},{id:"five_day_streak",name:"Consistent",description:"5-day signup streak",icon:"",unlocked:!0,date:"Jan 20"},{id:"ten_day_streak",name:"Machine",description:"10-day signup streak",icon:"",unlocked:!1,progress:70},{id:"perfect_day",name:"Perfect Day",description:"10+ signups in one day",icon:"",unlocked:!1,progress:50},{id:"early_bird",name:"Early Bird",description:"First signup before 10am",icon:"",unlocked:!0,date:"Jan 22"},{id:"shark",name:"Shark",description:"50%+ close rate (min 10 qualified)",icon:"",unlocked:!0,date:"Jan 24"},{id:"territory_clear",name:"Cleared It",description:"Complete an entire territory",icon:"",unlocked:!1,progress:84},{id:"thousand_dollars",name:"$1K Week",description:"Earn $1,000 in a week",icon:"",unlocked:!1,progress:85}],p={current:7,longest:12,thisWeek:[!0,!0,!0,!0,!0,!1,!1],bonus:{next:10,reward:"$50 bonus"}},v=[{signups:100,reward:"$100 bonus",progress:67},{signups:250,reward:"Day off + $150",progress:27},{signups:500,reward:"Weekend trip",progress:13},{signups:1e3,reward:"$1,000 bonus",progress:7}],w=c.filter(o=>o.unlocked).length,A=c.length;return N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:"1rem"},children:" Achievements"}),N.jsxs("div",{className:"card",style:{textAlign:"center"},children:[N.jsxs("div",{style:{fontSize:"3rem",marginBottom:"0.5rem"},children:[w,"/",A]}),N.jsx("div",{style:{color:"var(--text-secondary)"},children:"Achievements Unlocked"}),N.jsx("div",{style:{marginTop:"1rem",height:"8px",background:"var(--bg-card)",borderRadius:"4px",overflow:"hidden"},children:N.jsx("div",{style:{height:"100%",width:`${w/A*100}%`,background:"linear-gradient(90deg, var(--accent), #fbbf24)"}})})]}),N.jsxs("div",{style:{display:"flex",background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.25rem",marginBottom:"1rem"},children:[N.jsxs("button",{onClick:()=>r("achievements"),style:{flex:1,padding:"0.75rem",background:n==="achievements"?"var(--accent)":"transparent",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontWeight:n==="achievements"?600:400,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[N.jsx(wx,{size:18}),"Badges"]}),N.jsxs("button",{onClick:()=>r("streaks"),style:{flex:1,padding:"0.75rem",background:n==="streaks"?"var(--accent)":"transparent",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontWeight:n==="streaks"?600:400,display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:[N.jsx(Z4,{size:18}),"Streaks"]})]}),n==="achievements"?N.jsxs(N.Fragment,{children:[N.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"0.75rem",marginBottom:"1rem"},children:c.map(o=>N.jsxs("div",{className:"card",style:{textAlign:"center",padding:"1rem 0.5rem",opacity:o.unlocked?1:.5,position:"relative"},children:[N.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.25rem"},children:o.icon}),N.jsx("div",{style:{fontSize:"0.75rem",fontWeight:600},children:o.name}),o.unlocked?N.jsxs("div",{style:{fontSize:"0.625rem",color:"var(--accent)",marginTop:"0.25rem"},children:[" ",o.date]}):o.progress?N.jsxs("div",{style:{marginTop:"0.25rem"},children:[N.jsx("div",{style:{height:"4px",background:"var(--bg-card)",borderRadius:"2px",overflow:"hidden"},children:N.jsx("div",{style:{height:"100%",width:`${o.progress}%`,background:"var(--accent)"}})}),N.jsxs("div",{style:{fontSize:"0.625rem",color:"var(--text-secondary)",marginTop:"0.125rem"},children:[o.progress,"%"]})]}):null]},o.id))}),N.jsxs("div",{className:"card",children:[N.jsxs("div",{className:"card-title",children:[N.jsx(vD,{size:16,style:{display:"inline",marginRight:"0.5rem"}}),"Milestone Bonuses"]}),v.map((o,D)=>N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 0",borderBottom:D<v.length-1?"1px solid var(--bg-card)":"none"},children:[N.jsx("div",{style:{width:"48px",textAlign:"center",fontWeight:700,color:o.progress>=100?"var(--accent)":"var(--text-secondary)"},children:o.signups}),N.jsxs("div",{style:{flex:1},children:[N.jsx("div",{style:{fontWeight:500},children:o.reward}),N.jsx("div",{style:{height:"6px",background:"var(--bg-card)",borderRadius:"3px",marginTop:"0.5rem",overflow:"hidden"},children:N.jsx("div",{style:{height:"100%",width:`${o.progress}%`,background:"var(--accent)"}})})]}),N.jsxs("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:[o.progress,"%"]})]},o.signups))]})]}):N.jsxs(N.Fragment,{children:[N.jsxs("div",{className:"card",style:{background:"linear-gradient(135deg, rgba(251, 191, 36, 0.2) 0%, rgba(245, 158, 11, 0.1) 100%)",border:"1px solid rgba(251, 191, 36, 0.3)",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"4rem"},children:""}),N.jsxs("div",{style:{fontSize:"3rem",fontWeight:700,color:"#fbbf24"},children:[p.current," Days"]}),N.jsx("div",{style:{color:"var(--text-secondary)",marginBottom:"1rem"},children:"Current Streak"}),N.jsx("div",{style:{display:"flex",justifyContent:"center",gap:"0.5rem",marginBottom:"1rem"},children:["M","T","W","T","F","S","S"].map((o,D)=>N.jsx("div",{style:{width:"36px",height:"36px",borderRadius:"50%",background:p.thisWeek[D]?"var(--accent)":"var(--bg-card)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"0.75rem",fontWeight:500},children:p.thisWeek[D]?"":o},D))}),N.jsxs("div",{style:{padding:"0.75rem",background:"rgba(0,0,0,0.2)",borderRadius:"0.5rem",fontSize:"0.875rem"},children:[N.jsx(_2,{size:16,style:{display:"inline",marginRight:"0.5rem",color:"#fbbf24"}}),p.bonus.next-p.current," more days for ",p.bonus.reward,"!"]})]}),N.jsx("div",{className:"card",children:N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"2rem",fontWeight:700},children:p.longest}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Longest Streak"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"2rem",fontWeight:700},children:"23"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Total Streak Days"})]})]})}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Streak Rewards"}),[{days:5,reward:"$25 bonus",reached:!0},{days:10,reward:"$50 bonus",reached:!1,current:!0},{days:20,reward:"$100 bonus",reached:!1},{days:30,reward:"Day off + $150",reached:!1}].map((o,D)=>N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 0",borderBottom:D<3?"1px solid var(--bg-card)":"none",opacity:o.reached?1:.7},children:[N.jsx("div",{style:{width:"40px",height:"40px",borderRadius:"50%",background:o.reached?"var(--accent)":o.current?"#fbbf24":"var(--bg-card)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"1.25rem"},children:o.reached?"":o.current?"":o.days}),N.jsxs("div",{style:{flex:1},children:[N.jsxs("div",{style:{fontWeight:500},children:[o.days,"-Day Streak"]}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:o.reward})]}),o.current&&N.jsxs("div",{style:{fontSize:"0.75rem",color:"#fbbf24",fontWeight:600},children:[o.days-p.current," to go!"]})]},o.days))]})]})]})}function Z7(){const n=[{name:"Langley Village",knocked:67,total:80,signups:8,conversionRate:11.9,closeRate:53,bestTime:"10am-12pm",topObjection:"Not interested"},{name:"Sulik Park",knocked:32,total:40,signups:5,conversionRate:15.6,closeRate:62,bestTime:"4pm-6pm",topObjection:"Need to ask spouse"},{name:"Semple Farm",knocked:0,total:50,signups:0,conversionRate:0,closeRate:0,bestTime:"No data",topObjection:"No data"}],r={avgConversion:13.1,avgCloseRate:57,bestDay:"Tuesday",bestTime:"10am-12pm"},c=[{area:"Collier Dr block",signups:4,rate:"18%"},{area:"Main entrance area",signups:3,rate:"15%"}],p=[{area:"Back section",signups:0,rate:"0%",reason:"High no-answer rate"}],v=[{objection:"Not interested",count:23,pct:42},{objection:"Already have it",count:12,pct:22},{objection:"Need to ask spouse",count:11,pct:20},{objection:"Is this a scam?",count:5,pct:9},{objection:"No time",count:4,pct:7}];return N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600,marginBottom:"1rem"},children:" Area Analytics"}),N.jsxs("div",{className:"card",children:[N.jsx("div",{className:"card-title",children:"Overall Performance"}),N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"1rem"},children:[N.jsxs("div",{style:{textAlign:"center"},children:[N.jsxs("div",{style:{fontSize:"1.75rem",fontWeight:700,color:"var(--accent)"},children:[r.avgConversion,"%"]}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Conversion Rate"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsxs("div",{style:{fontSize:"1.75rem",fontWeight:700,color:"var(--accent)"},children:[r.avgCloseRate,"%"]}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Close Rate"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:r.bestDay}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Best Day"})]}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.25rem",fontWeight:600},children:r.bestTime}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Best Time"})]})]})]}),N.jsxs("div",{className:"card",children:[N.jsxs("div",{className:"card-title",children:[N.jsx(hc,{size:16,style:{display:"inline",marginRight:"0.5rem"}}),"Territory Performance"]}),n.map((w,A)=>N.jsxs("div",{style:{padding:"0.75rem 0",borderBottom:A<n.length-1?"1px solid var(--bg-card)":"none"},children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.5rem"},children:[N.jsx("div",{style:{fontWeight:600},children:w.name}),N.jsx("div",{style:{fontSize:"0.875rem",color:w.conversionRate>12?"var(--accent)":"var(--text-secondary)"},children:w.conversionRate>0?`${w.conversionRate}% conv`:"No data"})]}),N.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"0.5rem"},children:[N.jsx("div",{style:{flex:1,background:"var(--bg-card)",borderRadius:"4px",overflow:"hidden",height:"8px"},children:N.jsx("div",{style:{height:"100%",width:`${w.knocked/w.total*100}%`,background:"var(--accent)"}})}),N.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:[w.knocked,"/",w.total]})]}),N.jsxs("div",{style:{display:"flex",gap:"1rem",fontSize:"0.75rem",color:"var(--text-secondary)"},children:[N.jsxs("span",{children:[" ",w.signups," signups"]}),w.closeRate>0&&N.jsxs("span",{children:[" ",w.closeRate,"% close"]}),w.bestTime!=="No data"&&N.jsxs("span",{children:[" ",w.bestTime]})]})]},w.name))]}),N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"0.75rem"},children:[N.jsxs("div",{className:"card",style:{background:"rgba(16, 185, 129, 0.1)",border:"1px solid rgba(16, 185, 129, 0.3)"},children:[N.jsx("div",{className:"card-title",style:{color:"var(--accent)"},children:" Hot Zones"}),c.map(w=>N.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.875rem"},children:[N.jsx("div",{style:{fontWeight:500},children:w.area}),N.jsxs("div",{style:{color:"var(--text-secondary)"},children:[w.signups," signups  ",w.rate]})]},w.area))]}),N.jsxs("div",{className:"card",style:{background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)"},children:[N.jsx("div",{className:"card-title",style:{color:"#f87171"},children:" Cold Zones"}),p.map(w=>N.jsxs("div",{style:{marginBottom:"0.5rem",fontSize:"0.875rem"},children:[N.jsx("div",{style:{fontWeight:500},children:w.area}),N.jsx("div",{style:{color:"var(--text-secondary)"},children:w.reason})]},w.area))]})]}),N.jsxs("div",{className:"card",children:[N.jsxs("div",{className:"card-title",children:[N.jsx(pD,{size:16,style:{display:"inline",marginRight:"0.5rem"}}),"Objection Breakdown"]}),v.map(w=>N.jsxs("div",{style:{marginBottom:"0.75rem"},children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[N.jsx("span",{style:{fontSize:"0.875rem"},children:w.objection}),N.jsxs("span",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:[w.count," (",w.pct,"%)"]})]}),N.jsx("div",{style:{height:"6px",background:"var(--bg-card)",borderRadius:"3px",overflow:"hidden"},children:N.jsx("div",{style:{height:"100%",width:`${w.pct}%`,background:w.pct>30?"#f87171":w.pct>15?"#fbbf24":"var(--accent)"}})})]},w.objection)),N.jsxs("div",{style:{marginTop:"1rem",padding:"0.75rem",background:"var(--bg-card)",borderRadius:"0.5rem",fontSize:"0.875rem"},children:[N.jsx("strong",{children:" Insight:"}),' "Not interested" is high  reps may need stronger opening hooks. Consider A/B testing different openers.']})]}),N.jsxs("div",{className:"card",children:[N.jsxs("div",{className:"card-title",children:[N.jsx(t1,{size:16,style:{display:"inline",marginRight:"0.5rem"}}),"Best Knock Times"]}),N.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem"},children:[{time:"9-10am",score:60},{time:"10-11am",score:85},{time:"11-12pm",score:90},{time:"12-1pm",score:40},{time:"1-2pm",score:35},{time:"2-3pm",score:30},{time:"3-4pm",score:55},{time:"4-5pm",score:75},{time:"5-6pm",score:80},{time:"6-7pm",score:70},{time:"7-8pm",score:45},{time:"8pm+",score:15}].map(w=>N.jsxs("div",{style:{padding:"0.5rem",borderRadius:"0.5rem",textAlign:"center",fontSize:"0.75rem",background:`rgba(16, 185, 129, ${w.score/100*.5})`,border:w.score>75?"1px solid var(--accent)":"none"},children:[N.jsx("div",{style:{fontWeight:w.score>75?600:400},children:w.time}),N.jsxs("div",{style:{opacity:.7},children:[w.score,"%"]})]},w.time))}),N.jsx("div",{style:{marginTop:"1rem",fontSize:"0.75rem",color:"var(--text-secondary)",textAlign:"center"},children:"Higher % = better conversion rate during that time"})]}),N.jsxs("div",{className:"card",children:[N.jsxs("div",{className:"card-title",children:[N.jsx(lN,{size:16,style:{display:"inline",marginRight:"0.5rem"}}),"Recommended Next Territories"]}),[{name:"Semple Farm",expected:"6-8 signups",reason:"Similar to Sulik, fresh territory"},{name:"Warwick Medallion",expected:"12-15 signups",reason:"Largest park, high potential"},{name:"Derby Run",expected:"8-10 signups",reason:"VB has good demo match"}].map((w,A)=>N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",padding:"0.75rem 0",borderBottom:A<2?"1px solid var(--bg-card)":"none"},children:[N.jsx("div",{style:{width:"28px",height:"28px",borderRadius:"50%",background:"var(--accent)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:"0.875rem"},children:A+1}),N.jsxs("div",{style:{flex:1},children:[N.jsx("div",{style:{fontWeight:600},children:w.name}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:w.reason})]}),N.jsx("div",{style:{fontSize:"0.875rem",color:"var(--accent)",fontWeight:600},children:w.expected})]},w.name))]})]})}const iS=[{rank:1,gridId:"2551_-4245",lat:36.99698,lng:-76.42217,city:"NEWPORT NEWS",zip:"0",competitorDeals:665,ourDeals:0,score:665},{rank:2,gridId:"2550_-4244",lat:36.98077,lng:-76.40255,city:"NEWPORT NEWS",zip:"23607",competitorDeals:427,ourDeals:0,score:427},{rank:3,gridId:"2539_-4236",lat:36.82585,lng:-76.25725,city:"NORFOLK",zip:"0",competitorDeals:390,ourDeals:0,score:390},{rank:4,gridId:"2592_-4302",lat:37.58807,lng:-77.44396,city:"RICHMOND",zip:"0",competitorDeals:374,ourDeals:0,score:374},{rank:5,gridId:"2550_-4245",lat:36.98257,lng:-76.41785,city:"NEWPORT NEWS",zip:"0",competitorDeals:349,ourDeals:0,score:349},{rank:6,gridId:"2589_-4298",lat:37.54916,lng:-77.36951,city:"RICHMOND",zip:"0",competitorDeals:298,ourDeals:0,score:298},{rank:7,gridId:"2554_-4243",lat:37.04472,lng:-76.38211,city:"HAMPTON",zip:"0",competitorDeals:293,ourDeals:0,score:293},{rank:8,gridId:"2541_-4237",lat:36.85435,lng:-76.27383,city:"NORFOLK",zip:"0",competitorDeals:293,ourDeals:0,score:293},{rank:9,gridId:"2532_-4253",lat:36.72109,lng:-76.56217,city:"SUFFOLK",zip:"0",competitorDeals:288,ourDeals:0,score:288},{rank:10,gridId:"2539_-4237",lat:36.82349,lng:-76.27557,city:"NORFOLK",zip:"0",competitorDeals:286,ourDeals:0,score:286},{rank:11,gridId:"2554_-4241",lat:37.04143,lng:-76.34831,city:"HAMPTON",zip:"0",competitorDeals:285,ourDeals:0,score:285},{rank:12,gridId:"2589_-4300",lat:37.54688,lng:-77.4108,city:"RICHMOND",zip:"23223",competitorDeals:284,ourDeals:0,score:284},{rank:13,gridId:"2544_-4235",lat:36.89581,lng:-76.23623,city:"NORFOLK",zip:"0",competitorDeals:282,ourDeals:0,score:282},{rank:14,gridId:"2559_-4250",lat:37.11438,lng:-76.51456,city:"NEWPORT NEWS",zip:"0",competitorDeals:279,ourDeals:0,score:279},{rank:15,gridId:"2541_-4236",lat:36.85564,lng:-76.26178,city:"NORFOLK",zip:"0",competitorDeals:253,ourDeals:0,score:253},{rank:16,gridId:"2593_-4302",lat:37.60977,lng:-77.44305,city:"RICHMOND",zip:"23227",competitorDeals:249,ourDeals:0,score:249},{rank:17,gridId:"2561_-4252",lat:37.13681,lng:-76.54395,city:"NEWPORT NEWS",zip:"0",competitorDeals:247,ourDeals:0,score:247},{rank:18,gridId:"2589_-4301",lat:37.54669,lng:-77.42082,city:"RICHMOND",zip:"23223",competitorDeals:243,ourDeals:0,score:243},{rank:19,gridId:"2583_-4305",lat:37.46013,lng:-77.50302,city:"RICHMOND",zip:"0",competitorDeals:239,ourDeals:0,score:239},{rank:20,gridId:"2557_-4248",lat:37.07877,lng:-76.47452,city:"NEWPORT NEWS",zip:"0",competitorDeals:233,ourDeals:0,score:233},{rank:21,gridId:"2555_-4239",lat:37.0533,lng:-76.30767,city:"HAMPTON",zip:"0",competitorDeals:230,ourDeals:0,score:230},{rank:22,gridId:"2555_-4247",lat:37.05705,lng:-76.46,city:"NEWPORT NEWS",zip:"0",competitorDeals:229,ourDeals:0,score:229},{rank:23,gridId:"2566_-4300",lat:37.21469,lng:-77.40862,city:"PETERSBURG",zip:"23803",competitorDeals:227,ourDeals:0,score:227},{rank:24,gridId:"2589_-4296",lat:37.54716,lng:-77.34196,city:"RICHMOND",zip:"23223",competitorDeals:224,ourDeals:0,score:224},{rank:25,gridId:"2587_-4306",lat:37.51451,lng:-77.51856,city:"RICHMOND",zip:"0",competitorDeals:223,ourDeals:0,score:223},{rank:26,gridId:"2542_-4232",lat:36.86445,lng:-76.18091,city:"VIRGINIA BEACH",zip:"0",competitorDeals:223,ourDeals:0,score:223},{rank:27,gridId:"2542_-4237",lat:36.86466,lng:-76.27451,city:"NORFOLK",zip:"0",competitorDeals:217,ourDeals:0,score:217},{rank:28,gridId:"2593_-4301",lat:37.60662,lng:-77.42659,city:"RICHMOND",zip:"0",competitorDeals:216,ourDeals:0,score:216},{rank:29,gridId:"2591_-4301",lat:37.58081,lng:-77.42609,city:"RICHMOND",zip:"0",competitorDeals:216,ourDeals:0,score:216},{rank:30,gridId:"2586_-4305",lat:37.50751,lng:-77.50178,city:"RICHMOND",zip:"0",competitorDeals:214,ourDeals:0,score:214},{rank:31,gridId:"2562_-4253",lat:37.15759,lng:-76.55948,city:"NEWPORT NEWS",zip:"0",competitorDeals:210,ourDeals:0,score:210},{rank:32,gridId:"2592_-4301",lat:37.5873,lng:-77.42914,city:"Richmond",zip:"23222",competitorDeals:207,ourDeals:0,score:207},{rank:33,gridId:"2536_-4237",lat:36.7808,lng:-76.27182,city:"CHESAPEAKE",zip:"0",competitorDeals:199,ourDeals:0,score:199},{rank:34,gridId:"2545_-4236",lat:36.9122,lng:-76.25533,city:"NORFOLK",zip:"0",competitorDeals:197,ourDeals:0,score:197},{rank:35,gridId:"2587_-4305",lat:37.51998,lng:-77.50119,city:"RICHMOND",zip:"0",competitorDeals:195,ourDeals:0,score:195},{rank:36,gridId:"2622_-4360",lat:38.0245,lng:-78.48976,city:"CHARLOTTESVILLE",zip:"0",competitorDeals:194,ourDeals:0,score:194},{rank:37,gridId:"2545_-4235",lat:36.91052,lng:-76.23795,city:"NORFOLK",zip:"0",competitorDeals:194,ourDeals:0,score:194},{rank:38,gridId:"2586_-4303",lat:37.50327,lng:-77.46416,city:"RICHMOND",zip:"23224",competitorDeals:190,ourDeals:0,score:190},{rank:39,gridId:"2642_-4305",lat:38.31472,lng:-77.49901,city:"FREDERICKSBURG",zip:"0",competitorDeals:188,ourDeals:0,score:188},{rank:40,gridId:"2586_-4299",lat:37.50628,lng:-77.39232,city:"HENRICO",zip:"23231",competitorDeals:187,ourDeals:0,score:187},{rank:41,gridId:"2567_-4251",lat:37.22812,lng:-76.52156,city:"YORKTOWN",zip:"0",competitorDeals:183,ourDeals:0,score:183},{rank:42,gridId:"2538_-4236",lat:36.81085,lng:-76.25198,city:"CHESAPEAKE",zip:"0",competitorDeals:179,ourDeals:0,score:179},{rank:43,gridId:"2566_-4299",lat:37.21443,lng:-77.38927,city:"PETERSBURG",zip:"0",competitorDeals:178,ourDeals:0,score:178},{rank:44,gridId:"2537_-4240",lat:36.79509,lng:-76.33152,city:"PORTSMOUTH",zip:"23702",competitorDeals:177,ourDeals:0,score:177},{rank:45,gridId:"2591_-4302",lat:37.5805,lng:-77.44506,city:"RICHMOND",zip:"0",competitorDeals:175,ourDeals:0,score:175},{rank:46,gridId:"2553_-4242",lat:37.02582,lng:-76.36415,city:"HAMPTON",zip:"0",competitorDeals:175,ourDeals:0,score:175},{rank:47,gridId:"2532_-4281",lat:36.72357,lng:-77.07271,city:"COURTLAND",zip:"0",competitorDeals:174,ourDeals:0,score:174},{rank:48,gridId:"2583_-4306",lat:37.46402,lng:-77.511,city:"RICHMOND",zip:"0",competitorDeals:174,ourDeals:0,score:174},{rank:49,gridId:"2552_-4246",lat:37.01541,lng:-76.43854,city:"NEWPORT NEWS",zip:"0",competitorDeals:172,ourDeals:0,score:172},{rank:50,gridId:"2540_-4240",lat:36.83632,lng:-76.33278,city:"PORTSMOUTH",zip:"0",competitorDeals:172,ourDeals:0,score:172},{rank:51,gridId:"2571_-4294",lat:37.28688,lng:-77.29865,city:"HOPEWELL",zip:"23860",competitorDeals:172,ourDeals:0,score:172},{rank:52,gridId:"2586_-4306",lat:37.50806,lng:-77.51738,city:"RICHMOND",zip:"0",competitorDeals:169,ourDeals:0,score:169},{rank:53,gridId:"2543_-4238",lat:36.87802,lng:-76.29277,city:"NORFOLK",zip:"0",competitorDeals:166,ourDeals:0,score:166},{rank:54,gridId:"2587_-4304",lat:37.51395,lng:-77.48528,city:"RICHMOND",zip:"0",competitorDeals:164,ourDeals:0,score:164},{rank:55,gridId:"2560_-4251",lat:37.13101,lng:-76.52579,city:"NEWPORT NEWS",zip:"23608",competitorDeals:163,ourDeals:0,score:163},{rank:56,gridId:"2538_-4235",lat:36.81237,lng:-76.24624,city:"CHESAPEAKE",zip:"23324",competitorDeals:161,ourDeals:0,score:161},{rank:57,gridId:"2585_-4302",lat:37.49121,lng:-77.44042,city:"RICHMOND",zip:"23224",competitorDeals:159,ourDeals:0,score:159},{rank:58,gridId:"2581_-4303",lat:37.43713,lng:-77.45752,city:"RICHMOND",zip:"0",competitorDeals:156,ourDeals:0,score:156},{rank:59,gridId:"2540_-4221",lat:36.83883,lng:-75.99231,city:"VIRGINIA BEACH",zip:"23451",competitorDeals:155,ourDeals:0,score:155},{rank:60,gridId:"2567_-4299",lat:37.22799,lng:-77.38879,city:"PETERSBURG",zip:"23803",competitorDeals:152,ourDeals:0,score:152},{rank:61,gridId:"2563_-4252",lat:37.16891,lng:-76.54489,city:"NEWPORT NEWS",zip:"0",competitorDeals:151,ourDeals:0,score:151},{rank:62,gridId:"2586_-4302",lat:37.50398,lng:-77.44126,city:"RICHMOND",zip:"23224",competitorDeals:150,ourDeals:0,score:150},{rank:63,gridId:"2547_-4235",lat:36.94125,lng:-76.24363,city:"NORFOLK",zip:"0",competitorDeals:149,ourDeals:0,score:149},{rank:64,gridId:"2562_-4252",lat:37.15321,lng:-76.54858,city:"NEWPORT NEWS",zip:"0",competitorDeals:147,ourDeals:0,score:147},{rank:65,gridId:"2590_-4302",lat:37.55887,lng:-77.44562,city:"RICHMOND",zip:"0",competitorDeals:142,ourDeals:0,score:142},{rank:66,gridId:"2582_-4302",lat:37.44541,lng:-77.44599,city:"RICHMOND",zip:"0",competitorDeals:140,ourDeals:0,score:140},{rank:67,gridId:"2539_-4241",lat:36.8197,lng:-76.34279,city:"PORTSMOUTH",zip:"0",competitorDeals:135,ourDeals:0,score:135},{rank:68,gridId:"2591_-4299",lat:37.57247,lng:-77.39154,city:"RICHMOND",zip:"23223",competitorDeals:132,ourDeals:0,score:132},{rank:69,gridId:"2547_-4236",lat:36.93984,lng:-76.25059,city:"NORFOLK",zip:"0",competitorDeals:131,ourDeals:0,score:131},{rank:70,gridId:"2587_-4302",lat:37.5167,lng:-77.44271,city:"RICHMOND",zip:"0",competitorDeals:131,ourDeals:0,score:131},{rank:71,gridId:"2541_-4235",lat:36.85033,lng:-76.24028,city:"NORFOLK",zip:"0",competitorDeals:130,ourDeals:0,score:130},{rank:72,gridId:"2545_-4237",lat:36.91276,lng:-76.27501,city:"NORFOLK",zip:"0",competitorDeals:129,ourDeals:0,score:129},{rank:73,gridId:"2540_-4236",lat:36.83691,lng:-76.26236,city:"NORFOLK",zip:"0",competitorDeals:127,ourDeals:0,score:127},{rank:74,gridId:"2539_-4239",lat:36.82445,lng:-76.31006,city:"PORTSMOUTH",zip:"23704",competitorDeals:126,ourDeals:0,score:126},{rank:75,gridId:"2567_-4300",lat:37.22852,lng:-77.41166,city:"PETERSBURG",zip:"0",competitorDeals:126,ourDeals:0,score:126},{rank:76,gridId:"2538_-4234",lat:36.81239,lng:-76.22068,city:"VIRGINIA BEACH",zip:"23325",competitorDeals:125,ourDeals:0,score:125},{rank:77,gridId:"2586_-4304",lat:37.5081,lng:-77.48026,city:"RICHMOND",zip:"23224",competitorDeals:121,ourDeals:0,score:121},{rank:78,gridId:"2584_-4304",lat:37.47549,lng:-77.48356,city:"RICHMOND",zip:"0",competitorDeals:120,ourDeals:0,score:120},{rank:79,gridId:"2590_-4301",lat:37.56219,lng:-77.42806,city:"RICHMOND",zip:"0",competitorDeals:120,ourDeals:0,score:120},{rank:80,gridId:"2539_-4240",lat:36.82294,lng:-76.33312,city:"PORTSMOUTH",zip:"0",competitorDeals:119,ourDeals:0,score:119},{rank:81,gridId:"2546_-4236",lat:36.91822,lng:-76.25775,city:"NORFOLK",zip:"0",competitorDeals:118,ourDeals:0,score:118},{rank:82,gridId:"2587_-4297",lat:37.52484,lng:-77.34792,city:"HENRICO",zip:"0",competitorDeals:117,ourDeals:0,score:117},{rank:83,gridId:"2542_-4235",lat:36.86838,lng:-76.23778,city:"NORFOLK",zip:"0",competitorDeals:116,ourDeals:0,score:116},{rank:84,gridId:"2587_-4299",lat:37.52007,lng:-77.39457,city:"HENRICO",zip:"0",competitorDeals:114,ourDeals:0,score:114},{rank:85,gridId:"2542_-4231",lat:36.86687,lng:-76.16905,city:"VIRGINIA BEACH",zip:"23462",competitorDeals:114,ourDeals:0,score:114},{rank:86,gridId:"2566_-4301",lat:37.21207,lng:-77.42833,city:"PETERSBURG",zip:"23803",competitorDeals:114,ourDeals:0,score:114},{rank:87,gridId:"2566_-4302",lat:37.21072,lng:-77.43818,city:"PETERSBURG",zip:"0",competitorDeals:114,ourDeals:0,score:114},{rank:88,gridId:"2534_-4237",lat:36.75526,lng:-76.27945,city:"CHESAPEAKE",zip:"23320",competitorDeals:114,ourDeals:0,score:114},{rank:89,gridId:"2530_-4307",lat:36.69406,lng:-77.53627,city:"EMPORIA",zip:"0",competitorDeals:113,ourDeals:0,score:113},{rank:90,gridId:"2533_-4339",lat:36.73265,lng:-78.1101,city:"SOUTH HILL",zip:"0",competitorDeals:113,ourDeals:0,score:113},{rank:91,gridId:"2542_-4244",lat:36.86897,lng:-76.40142,city:"PORTSMOUTH",zip:"23703",competitorDeals:113,ourDeals:0,score:113},{rank:92,gridId:"2557_-4244",lat:37.08832,lng:-76.39651,city:"HAMPTON",zip:"23666",competitorDeals:113,ourDeals:0,score:113},{rank:93,gridId:"2583_-4303",lat:37.46349,lng:-77.46169,city:"RICHMOND",zip:"0",competitorDeals:112,ourDeals:0,score:112},{rank:94,gridId:"2588_-4295",lat:37.53663,lng:-77.31573,city:"HENRICO",zip:"23075",competitorDeals:111,ourDeals:0,score:111},{rank:95,gridId:"2554_-4242",lat:37.04586,lng:-76.35737,city:"HAMPTON",zip:"23669",competitorDeals:109,ourDeals:0,score:109},{rank:96,gridId:"2585_-4304",lat:37.49278,lng:-77.48106,city:"RICHMOND",zip:"0",competitorDeals:108,ourDeals:0,score:108},{rank:97,gridId:"2588_-4299",lat:37.53251,lng:-77.39539,city:"RICHMOND",zip:"0",competitorDeals:106,ourDeals:0,score:106},{rank:98,gridId:"2553_-4244",lat:37.01939,lng:-76.40605,city:"HAMPTON",zip:"0",competitorDeals:106,ourDeals:0,score:106},{rank:99,gridId:"2541_-4230",lat:36.85047,lng:-76.15632,city:"VIRGINIA BEACH",zip:"0",competitorDeals:106,ourDeals:0,score:106},{rank:100,gridId:"2589_-4299",lat:37.54976,lng:-77.39707,city:"RICHMOND",zip:"23223",competitorDeals:104,ourDeals:0,score:104}];function X7(){const[n,r]=Z.useState(25),c=(p,v)=>{window.open(`https://maps.google.com/?q=${p},${v}`,"_blank")};return N.jsxs("div",{className:"page",children:[N.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600},children:" Hot Blocks (1-Mile)"})}),N.jsxs("div",{style:{background:"linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, var(--bg-secondary) 100%)",border:"1px solid rgba(16, 185, 129, 0.2)",borderRadius:"0.75rem",padding:"0.75rem 1rem",marginBottom:"1rem",fontSize:"0.8rem"},children:[N.jsx("strong",{style:{color:"var(--accent)"},children:"1-mile blocks"})," where competitors closed deals.",N.jsx("br",{}),N.jsx("span",{style:{color:"var(--text-secondary)"},children:"Proven demand  tap the block to open in Google Maps."})]}),N.jsx("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[25,50,100].map(p=>N.jsxs("button",{onClick:()=>r(p),style:{flex:1,background:n===p?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:n===p?600:400},children:["Top ",p]},p))}),N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:iS.slice(0,n).map(p=>N.jsxs("div",{onClick:()=>c(p.lat,p.lng),style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.875rem",cursor:"pointer",display:"flex",alignItems:"center",gap:"0.75rem",borderLeft:`4px solid ${p.rank<=10?"#10b981":p.rank<=25?"#3b82f6":p.rank<=50?"#f59e0b":"#6b7280"}`},children:[N.jsx("div",{style:{width:"2.5rem",height:"2.5rem",borderRadius:"0.5rem",background:p.rank<=10?"rgba(16, 185, 129, 0.2)":"var(--bg-card)",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:700,fontSize:p.rank<=9?"1.25rem":"1rem",color:p.rank<=10?"var(--accent)":"var(--text-primary)"},children:p.rank}),N.jsxs("div",{style:{flex:1},children:[N.jsx("div",{style:{fontWeight:600,fontSize:"0.95rem"},children:p.city}),N.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:[p.zip,"  ",p.lat.toFixed(3),", ",p.lng.toFixed(3)]})]}),N.jsxs("div",{style:{textAlign:"right"},children:[N.jsx("div",{style:{fontWeight:700,fontSize:"1.25rem",color:p.competitorDeals>=300?"#10b981":p.competitorDeals>=200?"#3b82f6":"var(--text-primary)"},children:p.competitorDeals}),N.jsx("div",{style:{fontSize:"0.65rem",color:"var(--text-secondary)"},children:"deals"})]}),N.jsx("div",{style:{color:"var(--text-secondary)"},children:N.jsx(_D,{size:18})})]},p.gridId))}),N.jsxs("div",{style:{marginTop:"1rem",padding:"1rem",background:"var(--bg-secondary)",borderRadius:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"2rem",fontWeight:700,color:"var(--accent)"},children:iS.reduce((p,v)=>p+v.competitorDeals,0).toLocaleString()}),N.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)"},children:["total competitor deals in ",iS.length," hot blocks"]})]}),N.jsx("div",{style:{height:"2rem"}})]})}const rS={not_home:"#6b7280",not_interested:"#ef4444",signed_up:"#10b981",doesnt_qualify:"#f59e0b",wrong_address:"#8b5cf6",callback:"#3b82f6"},HP={not_home:"Not Home",not_interested:"Not Interested",signed_up:"Signed Up ",doesnt_qualify:"Doesn't Qualify",wrong_address:"Wrong Address",callback:"Callback"};function K7(){const[n,r]=Z.useState([]),[c,p]=Z.useState(!0),[v,w]=Z.useState("today"),[A,o]=Z.useState(new Date),[D,j]=Z.useState("all"),J=()=>{const K=new Date(A),fe=new Date(A);return v==="today"?(K.setHours(0,0,0,0),fe.setHours(23,59,59,999)):v==="yesterday"?(K.setDate(K.getDate()-1),K.setHours(0,0,0,0),fe.setDate(fe.getDate()-1),fe.setHours(23,59,59,999)):v==="week"&&(K.setDate(K.getDate()-7),K.setHours(0,0,0,0),fe.setHours(23,59,59,999)),{start:K,end:fe}};Z.useEffect(()=>{(async()=>{p(!0);const{start:fe,end:ke}=J();try{const{data:Be,error:Le}=await Ws.from("knocks").select("*").gte("created_at",fe.toISOString()).lte("created_at",ke.toISOString()).order("created_at",{ascending:!1});if(Le)throw Le;r(Be||[])}catch(Be){console.error("Error loading knocks:",Be),r([])}finally{p(!1)}})()},[v,A]);const ie=()=>{const K=new Date(A);K.setDate(K.getDate()-1),o(K),w("custom")},re=()=>{const K=new Date(A);K.setDate(K.getDate()+1),K<=new Date&&(o(K),w("custom"))},he=()=>{o(new Date),w("today")},ce=D==="all"?n:n.filter(K=>K.result===D),xe={total:n.length,signedUp:n.filter(K=>K.result==="signed_up").length,notHome:n.filter(K=>K.result==="not_home").length,notInterested:n.filter(K=>K.result==="not_interested").length,callback:n.filter(K=>K.result==="callback").length},Ee=K=>{const fe=new Date,ke=new Date(fe);return ke.setDate(ke.getDate()-1),K.toDateString()===fe.toDateString()?"Today":K.toDateString()===ke.toDateString()?"Yesterday":K.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})},ve=K=>new Date(K).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit"});return N.jsxs("div",{className:"page",children:[N.jsx("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"1rem"},children:N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:600},children:" Knock Log"})}),N.jsxs("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",marginBottom:"1rem"},children:[N.jsx("button",{onClick:ie,style:{background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",cursor:"pointer"},children:N.jsx($4,{size:20})}),N.jsxs("div",{style:{textAlign:"center"},children:[N.jsx("div",{style:{fontWeight:600,fontSize:"1rem"},children:Ee(A)}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:A.toLocaleDateString("en-US",{month:"long",day:"numeric",year:"numeric"})})]}),N.jsx("button",{onClick:re,disabled:A.toDateString()===new Date().toDateString(),style:{background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:A.toDateString()===new Date().toDateString()?"var(--text-secondary)":"var(--text-primary)",cursor:A.toDateString()===new Date().toDateString()?"not-allowed":"pointer",opacity:A.toDateString()===new Date().toDateString()?.5:1},children:N.jsx(Rf,{size:20})})]}),N.jsxs("div",{style:{display:"flex",gap:"0.5rem",marginBottom:"1rem"},children:[N.jsx("button",{onClick:he,style:{flex:1,background:v==="today"?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:v==="today"?600:400},children:"Today"}),N.jsx("button",{onClick:()=>{w("yesterday"),o(new Date(Date.now()-864e5))},style:{flex:1,background:v==="yesterday"?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:v==="yesterday"?600:400},children:"Yesterday"}),N.jsx("button",{onClick:()=>w("week"),style:{flex:1,background:v==="week"?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",fontSize:"0.875rem",fontWeight:v==="week"?600:400},children:"Last 7 Days"})]}),N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem",marginBottom:"1rem"},children:[N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:xe.total}),N.jsx("div",{style:{fontSize:"0.65rem",color:"var(--text-secondary)"},children:"Total"})]}),N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#10b981"},children:xe.signedUp}),N.jsx("div",{style:{fontSize:"0.65rem",color:"var(--text-secondary)"},children:"Signed"})]}),N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#6b7280"},children:xe.notHome}),N.jsx("div",{style:{fontSize:"0.65rem",color:"var(--text-secondary)"},children:"Not Home"})]}),N.jsxs("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"#3b82f6"},children:xe.callback}),N.jsx("div",{style:{fontSize:"0.65rem",color:"var(--text-secondary)"},children:"Callback"})]})]}),N.jsxs("div",{style:{display:"flex",gap:"0.375rem",marginBottom:"1rem",overflowX:"auto",paddingBottom:"0.25rem"},children:[N.jsx("button",{onClick:()=>j("all"),style:{background:D==="all"?"var(--accent)":"var(--bg-secondary)",border:"none",borderRadius:"1rem",padding:"0.375rem 0.75rem",fontSize:"0.7rem",color:"var(--text-primary)",whiteSpace:"nowrap"},children:"All"}),Object.entries(HP).map(([K,fe])=>N.jsx("button",{onClick:()=>j(K),style:{background:D===K?rS[K]:"var(--bg-secondary)",border:"none",borderRadius:"1rem",padding:"0.375rem 0.75rem",fontSize:"0.7rem",color:"var(--text-primary)",whiteSpace:"nowrap"},children:fe.split(" ")[0]},K))]}),c?N.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-secondary)"},children:"Loading..."}):ce.length===0?N.jsxs("div",{style:{textAlign:"center",padding:"3rem 1rem",color:"var(--text-secondary)",background:"var(--bg-secondary)",borderRadius:"1rem"},children:[N.jsx("div",{style:{fontSize:"2rem",marginBottom:"0.5rem"},children:""}),N.jsx("div",{children:"No knocks recorded for this period"})]}):N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:ce.map(K=>N.jsx("div",{style:{background:"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.875rem",borderLeft:`4px solid ${rS[K.result]||"#666"}`},children:N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[N.jsxs("div",{children:[N.jsx("div",{style:{fontWeight:600,color:rS[K.result],fontSize:"0.875rem",marginBottom:"0.25rem"},children:HP[K.result]||K.result}),K.address&&N.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",gap:"0.25rem"},children:[N.jsx(hc,{size:12}),K.address]}),K.notes&&N.jsxs("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:['"',K.notes,'"']})]}),N.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",gap:"0.25rem"},children:[N.jsx(t1,{size:10}),ve(K.created_at)]})]})},K.id))}),N.jsx("div",{style:{height:"2rem"}})]})}function Y7(){const n=id(),{login:r,isLoading:c,error:p}=Pu(),[v,w]=Z.useState(""),[A,o]=Z.useState(""),D=async j=>{j.preventDefault(),await r(v,A)&&n("/")};return N.jsxs("div",{style:{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"2rem",background:"linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%)"},children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.75rem",marginBottom:"2rem"},children:[N.jsx("div",{style:{width:"60px",height:"60px",background:"linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)",borderRadius:"16px",display:"flex",alignItems:"center",justifyContent:"center"},children:N.jsx(hc,{size:32,color:"white"})}),N.jsxs("div",{children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700,color:"var(--text-primary)"},children:"EMG"}),N.jsx("div",{style:{fontSize:"0.875rem",color:"var(--text-secondary)"},children:"Field App"})]})]}),N.jsxs("form",{onSubmit:D,style:{background:"var(--bg-card)",borderRadius:"1rem",padding:"2rem",width:"100%",maxWidth:"360px",boxShadow:"0 4px 20px rgba(0,0,0,0.3)"},children:[N.jsx("h2",{style:{margin:"0 0 1.5rem 0",textAlign:"center",color:"var(--text-primary)",fontSize:"1.25rem"},children:"Rep Login"}),p&&N.jsxs("div",{style:{background:"rgba(239, 68, 68, 0.2)",border:"1px solid #ef4444",borderRadius:"0.5rem",padding:"0.75rem",marginBottom:"1rem",display:"flex",alignItems:"center",gap:"0.5rem",fontSize:"0.875rem",color:"#ef4444"},children:[N.jsx(U4,{size:16}),p]}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Email"}),N.jsx("input",{type:"email",value:v,onChange:j=>w(j.target.value),placeholder:"your.email@emg.com",required:!0,style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"1px solid var(--bg-secondary)",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem"}})]}),N.jsxs("div",{style:{marginBottom:"1.5rem"},children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"ENM Number"}),N.jsx("input",{type:"password",value:A,onChange:j=>o(j.target.value),placeholder:"",required:!0,style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"1px solid var(--bg-secondary)",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem",letterSpacing:"0.1em"}})]}),N.jsx("button",{type:"submit",disabled:c,className:"btn btn-primary",style:{width:"100%",padding:"1rem",fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",opacity:c?.7:1},children:c?"Logging in...":N.jsxs(N.Fragment,{children:[N.jsx(Q4,{size:20}),"Sign In"]})})]}),N.jsx("div",{style:{marginTop:"2rem",color:"var(--text-secondary)",fontSize:"0.75rem",textAlign:"center"},children:"Contact your manager if you don't have login credentials"})]})}function J7(){const n=id(),{currentRep:r,updateProfile:c,logout:p}=Pu(),v=Z.useRef(null),[w,A]=Z.useState((r==null?void 0:r.name)||""),[o,D]=Z.useState((r==null?void 0:r.bio)||""),[j,J]=Z.useState((r==null?void 0:r.profile_pic)||""),[ie,re]=Z.useState(!1),[he,ce]=Z.useState(!1);if(!r)return n("/login"),null;const xe=K=>{var ke;const fe=(ke=K.target.files)==null?void 0:ke[0];if(fe){const Be=new FileReader;Be.onloadend=()=>{J(Be.result)},Be.readAsDataURL(fe)}},Ee=async()=>{re(!0);const K=await c({name:w,bio:o,profile_pic:j});re(!1),K&&(ce(!0),setTimeout(()=>ce(!1),2e3))},ve=()=>{p(),n("/login")};return N.jsxs("div",{style:{minHeight:"calc(100vh - 5rem)",padding:"1rem",background:"var(--bg-primary)"},children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"1rem",marginBottom:"1.5rem"},children:[N.jsx("button",{onClick:()=>n(-1),style:{background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",padding:"0.5rem",color:"var(--text-primary)",cursor:"pointer"},children:N.jsx(e1,{size:20})}),N.jsx("h1",{style:{margin:0,fontSize:"1.25rem"},children:"My Profile"})]}),N.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"2rem"},children:[N.jsxs("div",{onClick:()=>{var K;return(K=v.current)==null?void 0:K.click()},style:{width:"120px",height:"120px",borderRadius:"50%",background:j?`url(${j}) center/cover`:"var(--bg-card)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"pointer",border:"3px solid var(--accent)",position:"relative"},children:[!j&&N.jsx(xD,{size:48,color:"var(--text-secondary)"}),N.jsx("div",{style:{position:"absolute",bottom:"0",right:"0",background:"var(--accent)",borderRadius:"50%",padding:"0.5rem",border:"2px solid var(--bg-primary)"},children:N.jsx(V4,{size:16,color:"white"})})]}),N.jsx("input",{ref:v,type:"file",accept:"image/*",onChange:xe,style:{display:"none"}}),N.jsx("div",{style:{marginTop:"0.5rem",fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Tap to change photo"})]}),N.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:"1rem",padding:"1.5rem",marginBottom:"1rem"},children:[N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Display Name"}),N.jsx("input",{type:"text",value:w,onChange:K=>A(K.target.value),style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem"}})]}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Email"}),N.jsx("input",{type:"email",value:r.email,disabled:!0,style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",color:"var(--text-secondary)",fontSize:"1rem"}})]}),N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"ENM Number"}),N.jsx("input",{type:"text",value:r.enm_number,disabled:!0,style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",color:"var(--text-secondary)",fontSize:"1rem"}})]}),N.jsxs("div",{children:[N.jsx("label",{style:{display:"block",marginBottom:"0.5rem",color:"var(--text-secondary)",fontSize:"0.875rem"},children:"Bio"}),N.jsx("textarea",{value:o,onChange:K=>D(K.target.value),placeholder:"Tell us about yourself...",rows:3,style:{width:"100%",padding:"0.875rem",background:"var(--bg-secondary)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"1rem",resize:"none"}})]})]}),N.jsx("button",{onClick:Ee,disabled:ie,className:"btn btn-primary",style:{width:"100%",padding:"1rem",marginBottom:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem"},children:he?" Saved!":ie?"Saving...":N.jsxs(N.Fragment,{children:[N.jsx(sN,{size:20}),"Save Profile"]})}),N.jsxs("button",{onClick:ve,style:{width:"100%",padding:"1rem",background:"transparent",border:"1px solid #ef4444",borderRadius:"0.5rem",color:"#ef4444",fontSize:"1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",cursor:"pointer"},children:[N.jsx(eN,{size:20}),"Sign Out"]})]})}function Q7(){const{currentRep:n}=Pu(),[r,c]=Z.useState([]),[p,v]=Z.useState(!0),[w,A]=Z.useState(""),[o,D]=Z.useState(!1),j=Z.useRef(null),J=Z.useRef(null);Z.useEffect(()=>{ie()},[]),Z.useEffect(()=>{const K=Ws.channel("deals-feed").on("postgres_changes",{event:"INSERT",schema:"public",table:"knocks",filter:"result=eq.signed_up"},ke=>{const Be=ke.new;re(Be),xe()}).subscribe(),fe=Ws.channel("messages-feed").on("postgres_changes",{event:"INSERT",schema:"public",table:"feed_messages"},ke=>{const Be=ke.new;he({id:Be.id,type:"message",sender_name:Be.sender_name,sender_id:Be.sender_id,timestamp:Be.created_at,text:Be.message})}).subscribe();return()=>{K.unsubscribe(),fe.unsubscribe()}},[]);const ie=async()=>{v(!0);const K=[],fe=new Date;fe.setHours(0,0,0,0);const{data:ke}=await Ws.from("knocks").select("*").eq("result","signed_up").gte("created_at",fe.toISOString()).order("created_at",{ascending:!1}).limit(50);ke&&ke.forEach(Le=>{K.push({id:Le.id,type:"deal",sender_name:Le.canvasser_name||"Unknown Rep",sender_id:Le.canvasser_id,address:Le.address,timestamp:Le.created_at,text:" Closed a deal!"})});const{data:Be}=await Ws.from("feed_messages").select("*").gte("created_at",fe.toISOString()).order("created_at",{ascending:!1}).limit(50);Be&&Be.forEach(Le=>{K.push({id:Le.id,type:"message",sender_name:Le.sender_name,sender_id:Le.sender_id,timestamp:Le.created_at,text:Le.message})}),K.sort((Le,We)=>new Date(We.timestamp).getTime()-new Date(Le.timestamp).getTime()),c(K),v(!1)},re=K=>{const fe={id:K.id,type:"deal",sender_name:K.canvasser_name||"Unknown Rep",sender_id:K.canvasser_id,address:K.address,timestamp:K.created_at,text:" Closed a deal!"};c(ke=>[fe,...ke]),ce()},he=K=>{c(fe=>[K,...fe]),ce()},ce=()=>{j.current&&(j.current.scrollTop=0)},xe=()=>{J.current||(J.current=new Audio("data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdH2Onp+ZjHVmaX6Ok5+dmIpxZGd9kJugnZSGcWRqfZCbn5ySg3BkaX2RnZ+ckYNwZWl9kp6gnJKDcGVpfZOen5ySg3Blan6Tnp+bkYJwZWp+k56fm5GBcGZqfpSen5uRgXBman6UnZ+akYFwZmt+lJ2fmpGBcGZrfpSdn5qQgXBmbH6UnZ+aj4FwZmx+lJ2fmo+AcGdsfpSdn5qPgHBnbH6UnZ+ajoBwZ21+lJ2emo6AcGdtfpSdnpqOgHBnbX6UnZ6ajoB"),J.current.volume=.5),J.current.play().catch(()=>{})},Ee=async()=>{if(!w.trim()||!n||o)return;D(!0);const{data:K,error:fe}=await Ws.from("feed_messages").insert({message:w.trim(),sender_id:n.id,sender_name:n.name}).select().single();!fe&&K||he({id:Date.now().toString(),type:"message",sender_name:n.name,sender_id:n.id,timestamp:new Date().toISOString(),text:w.trim()}),A(""),D(!1)},ve=K=>{const fe=new Date(K),Be=new Date().getTime()-fe.getTime(),Le=Math.floor(Be/6e4);if(Le<1)return"Just now";if(Le<60)return`${Le}m ago`;const We=Math.floor(Le/60);return We<24?`${We}h ago`:fe.toLocaleDateString()};return N.jsxs("div",{style:{height:"calc(100vh - 5rem)",background:"var(--bg-primary)",display:"flex",flexDirection:"column"},children:[N.jsxs("div",{style:{padding:"1rem",background:"var(--bg-secondary)",borderBottom:"1px solid var(--bg-card)",display:"flex",alignItems:"center",gap:"0.75rem"},children:[N.jsx("div",{style:{width:"40px",height:"40px",background:"linear-gradient(135deg, #10b981 0%, #059669 100%)",borderRadius:"10px",display:"flex",alignItems:"center",justifyContent:"center"},children:N.jsx(rT,{size:20,color:"white"})}),N.jsxs("div",{children:[N.jsx("div",{style:{fontWeight:600,fontSize:"1.1rem"},children:"Team Chat"}),N.jsx("div",{style:{fontSize:"0.75rem",color:"var(--text-secondary)"},children:"Deals + messages"})]})]}),N.jsx("div",{ref:j,style:{flex:1,overflow:"auto",padding:"1rem",display:"flex",flexDirection:"column-reverse"},children:p?N.jsx("div",{style:{textAlign:"center",padding:"3rem",color:"var(--text-secondary)"},children:"Loading..."}):r.length===0?N.jsxs("div",{style:{textAlign:"center",padding:"3rem",color:"var(--text-secondary)"},children:[N.jsx(wx,{size:48,style:{marginBottom:"1rem",opacity:.5}}),N.jsx("div",{style:{fontSize:"1rem",marginBottom:"0.5rem"},children:"No activity yet today"}),N.jsx("div",{style:{fontSize:"0.875rem"},children:"Close a deal or send a message! "})]}):N.jsx("div",{style:{display:"flex",flexDirection:"column-reverse",gap:"0.75rem"},children:r.map(K=>N.jsxs("div",{style:{background:K.type==="deal"?"var(--bg-card)":"var(--bg-secondary)",borderRadius:"0.75rem",padding:"0.875rem",borderLeft:K.type==="deal"?"4px solid #10b981":"4px solid var(--accent)"},children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"0.375rem"},children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[K.type==="deal"?N.jsx(wx,{size:16,color:"#10b981"}):N.jsx(rT,{size:16,color:"var(--accent)"}),N.jsx("span",{style:{fontWeight:600,color:"var(--text-primary)",fontSize:"0.9rem"},children:K.sender_name}),K.sender_id===(n==null?void 0:n.id)&&N.jsx("span",{style:{background:"var(--accent)",color:"white",fontSize:"0.6rem",padding:"0.1rem 0.3rem",borderRadius:"0.25rem",fontWeight:600},children:"YOU"})]}),N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"var(--text-secondary)",fontSize:"0.7rem"},children:[N.jsx(t1,{size:10}),ve(K.timestamp)]})]}),N.jsx("div",{style:{fontSize:"0.95rem",color:"var(--text-primary)",marginLeft:"1.5rem"},children:K.text}),K.address&&N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.25rem",color:"var(--text-secondary)",fontSize:"0.75rem",marginLeft:"1.5rem",marginTop:"0.25rem"},children:[N.jsx(hc,{size:10}),K.address]})]},K.id))})}),N.jsxs("div",{style:{padding:"0.75rem 1rem",background:"var(--bg-secondary)",borderTop:"1px solid var(--bg-card)",display:"flex",gap:"0.75rem"},children:[N.jsx("input",{type:"text",value:w,onChange:K=>A(K.target.value),onKeyDown:K=>K.key==="Enter"&&Ee(),placeholder:"Type a message...",style:{flex:1,padding:"0.75rem 1rem",background:"var(--bg-card)",border:"none",borderRadius:"1.5rem",color:"var(--text-primary)",fontSize:"0.9rem"}}),N.jsx("button",{onClick:Ee,disabled:!w.trim()||o,style:{width:"44px",height:"44px",background:w.trim()?"var(--accent)":"var(--bg-card)",border:"none",borderRadius:"50%",display:"flex",alignItems:"center",justifyContent:"center",cursor:w.trim()?"pointer":"default",transition:"background 0.2s"},children:N.jsx(oN,{size:18,color:w.trim()?"white":"var(--text-secondary)"})})]})]})}var rO={exports:{}};(function(n,r){(function(c,p){n.exports=p()})(sF,function(){var c,p,v;function w(o,D){if(!c)c=D;else if(!p)p=D;else{var j="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+c+")(sharedChunk); ("+p+")(sharedChunk); self.onerror = null;",J={};c(J),v=D(J),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(v.workerUrl=window.URL.createObjectURL(new Blob([j],{type:"text/javascript"})))}}w(["exports"],function(o){var D=1e-6,j=typeof Float32Array<"u"?Float32Array:Array;function J(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=i*f-u*a;return m?(s[0]=f*(m=1/m),s[1]=-a*m,s[2]=-u*m,s[3]=i*m,s):null}function ie(){var s=new j(9);return j!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function re(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=e[4],_=e[5],b=e[6],S=e[7],I=e[8];return s[0]=m*I-_*S,s[1]=u*S-a*I,s[2]=a*_-u*m,s[3]=_*b-f*I,s[4]=i*I-u*b,s[5]=u*f-i*_,s[6]=f*S-m*b,s[7]=a*b-i*S,s[8]=i*m-a*f,s}function he(s,e,i){var a=e[0],u=e[1],f=e[2],m=e[3],_=e[4],b=e[5],S=e[6],I=e[7],C=e[8],k=i[0],M=i[1],R=i[2],F=i[3],$=i[4],U=i[5],H=i[6],X=i[7],Q=i[8];return s[0]=k*a+M*m+R*S,s[1]=k*u+M*_+R*I,s[2]=k*f+M*b+R*C,s[3]=F*a+$*m+U*S,s[4]=F*u+$*_+U*I,s[5]=F*f+$*b+U*C,s[6]=H*a+X*m+Q*S,s[7]=H*u+X*_+Q*I,s[8]=H*f+X*b+Q*C,s}function ce(){var s=new j(16);return j!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function xe(s){var e=new j(16);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e[3]=s[3],e[4]=s[4],e[5]=s[5],e[6]=s[6],e[7]=s[7],e[8]=s[8],e[9]=s[9],e[10]=s[10],e[11]=s[11],e[12]=s[12],e[13]=s[13],e[14]=s[14],e[15]=s[15],e}function Ee(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function ve(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=e[4],_=e[5],b=e[6],S=e[7],I=e[8],C=e[9],k=e[10],M=e[11],R=e[12],F=e[13],$=e[14],U=e[15],H=i*_-a*m,X=i*b-u*m,Q=i*S-f*m,ae=a*b-u*_,oe=a*S-f*_,ge=u*S-f*b,ye=I*F-C*R,me=I*$-k*R,Se=I*U-M*R,Ae=C*$-k*F,Ze=C*U-M*F,Ge=k*U-M*$,qe=H*Ge-X*Ze+Q*Ae+ae*Se-oe*me+ge*ye;return qe?(s[0]=(_*Ge-b*Ze+S*Ae)*(qe=1/qe),s[1]=(u*Ze-a*Ge-f*Ae)*qe,s[2]=(F*ge-$*oe+U*ae)*qe,s[3]=(k*oe-C*ge-M*ae)*qe,s[4]=(b*Se-m*Ge-S*me)*qe,s[5]=(i*Ge-u*Se+f*me)*qe,s[6]=($*Q-R*ge-U*X)*qe,s[7]=(I*ge-k*Q+M*X)*qe,s[8]=(m*Ze-_*Se+S*ye)*qe,s[9]=(a*Se-i*Ze-f*ye)*qe,s[10]=(R*oe-F*Q+U*H)*qe,s[11]=(C*Q-I*oe-M*H)*qe,s[12]=(_*me-m*Ae-b*ye)*qe,s[13]=(i*Ae-a*me+u*ye)*qe,s[14]=(F*X-R*ae-$*H)*qe,s[15]=(I*ae-C*X+k*H)*qe,s):null}function K(s,e,i){var a=e[0],u=e[1],f=e[2],m=e[3],_=e[4],b=e[5],S=e[6],I=e[7],C=e[8],k=e[9],M=e[10],R=e[11],F=e[12],$=e[13],U=e[14],H=e[15],X=i[0],Q=i[1],ae=i[2],oe=i[3];return s[0]=X*a+Q*_+ae*C+oe*F,s[1]=X*u+Q*b+ae*k+oe*$,s[2]=X*f+Q*S+ae*M+oe*U,s[3]=X*m+Q*I+ae*R+oe*H,s[4]=(X=i[4])*a+(Q=i[5])*_+(ae=i[6])*C+(oe=i[7])*F,s[5]=X*u+Q*b+ae*k+oe*$,s[6]=X*f+Q*S+ae*M+oe*U,s[7]=X*m+Q*I+ae*R+oe*H,s[8]=(X=i[8])*a+(Q=i[9])*_+(ae=i[10])*C+(oe=i[11])*F,s[9]=X*u+Q*b+ae*k+oe*$,s[10]=X*f+Q*S+ae*M+oe*U,s[11]=X*m+Q*I+ae*R+oe*H,s[12]=(X=i[12])*a+(Q=i[13])*_+(ae=i[14])*C+(oe=i[15])*F,s[13]=X*u+Q*b+ae*k+oe*$,s[14]=X*f+Q*S+ae*M+oe*U,s[15]=X*m+Q*I+ae*R+oe*H,s}function fe(s,e,i){var a,u,f,m,_,b,S,I,C,k,M,R,F=i[0],$=i[1],U=i[2];return e===s?(s[12]=e[0]*F+e[4]*$+e[8]*U+e[12],s[13]=e[1]*F+e[5]*$+e[9]*U+e[13],s[14]=e[2]*F+e[6]*$+e[10]*U+e[14],s[15]=e[3]*F+e[7]*$+e[11]*U+e[15]):(u=e[1],f=e[2],m=e[3],_=e[4],b=e[5],S=e[6],I=e[7],C=e[8],k=e[9],M=e[10],R=e[11],s[0]=a=e[0],s[1]=u,s[2]=f,s[3]=m,s[4]=_,s[5]=b,s[6]=S,s[7]=I,s[8]=C,s[9]=k,s[10]=M,s[11]=R,s[12]=a*F+_*$+C*U+e[12],s[13]=u*F+b*$+k*U+e[13],s[14]=f*F+S*$+M*U+e[14],s[15]=m*F+I*$+R*U+e[15]),s}function ke(s,e,i){var a=i[0],u=i[1],f=i[2];return s[0]=e[0]*a,s[1]=e[1]*a,s[2]=e[2]*a,s[3]=e[3]*a,s[4]=e[4]*u,s[5]=e[5]*u,s[6]=e[6]*u,s[7]=e[7]*u,s[8]=e[8]*f,s[9]=e[9]*f,s[10]=e[10]*f,s[11]=e[11]*f,s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15],s}function Be(s,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[4],m=e[5],_=e[6],b=e[7],S=e[8],I=e[9],C=e[10],k=e[11];return e!==s&&(s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[3],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[4]=f*u+S*a,s[5]=m*u+I*a,s[6]=_*u+C*a,s[7]=b*u+k*a,s[8]=S*u-f*a,s[9]=I*u-m*a,s[10]=C*u-_*a,s[11]=k*u-b*a,s}function Le(s,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],_=e[2],b=e[3],S=e[8],I=e[9],C=e[10],k=e[11];return e!==s&&(s[4]=e[4],s[5]=e[5],s[6]=e[6],s[7]=e[7],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=f*u-S*a,s[1]=m*u-I*a,s[2]=_*u-C*a,s[3]=b*u-k*a,s[8]=f*a+S*u,s[9]=m*a+I*u,s[10]=_*a+C*u,s[11]=b*a+k*u,s}function We(s,e,i){var a=Math.sin(i),u=Math.cos(i),f=e[0],m=e[1],_=e[2],b=e[3],S=e[4],I=e[5],C=e[6],k=e[7];return e!==s&&(s[8]=e[8],s[9]=e[9],s[10]=e[10],s[11]=e[11],s[12]=e[12],s[13]=e[13],s[14]=e[14],s[15]=e[15]),s[0]=f*u+S*a,s[1]=m*u+I*a,s[2]=_*u+C*a,s[3]=b*u+k*a,s[4]=S*u-f*a,s[5]=I*u-m*a,s[6]=C*u-_*a,s[7]=k*u-b*a,s}function ct(s,e){return s[0]=e[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=e[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=e[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function lt(s,e,i){var a,u,f,m=i[0],_=i[1],b=i[2],S=Math.sqrt(m*m+_*_+b*b);return S<D?null:(m*=S=1/S,_*=S,b*=S,a=Math.sin(e),u=Math.cos(e),s[0]=m*m*(f=1-u)+u,s[1]=_*m*f+b*a,s[2]=b*m*f-_*a,s[3]=0,s[4]=m*_*f-b*a,s[5]=_*_*f+u,s[6]=b*_*f+m*a,s[7]=0,s[8]=m*b*f+_*a,s[9]=_*b*f-m*a,s[10]=b*b*f+u,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Pt(s,e){var i=e[0],a=e[1],u=e[2],f=e[4],m=e[5],_=e[6],b=e[8],S=e[9],I=e[10];return s[0]=Math.sqrt(i*i+a*a+u*u),s[1]=Math.sqrt(f*f+m*m+_*_),s[2]=Math.sqrt(b*b+S*S+I*I),s}function zt(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=i+i,_=a+a,b=u+u,S=i*m,I=a*m,C=a*_,k=u*m,M=u*_,R=u*b,F=f*m,$=f*_,U=f*b;return s[0]=1-C-R,s[1]=I+U,s[2]=k-$,s[3]=0,s[4]=I-U,s[5]=1-S-R,s[6]=M+F,s[7]=0,s[8]=k+$,s[9]=M-F,s[10]=1-S-C,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}var _i=K;function Ut(){var s=new j(3);return j!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function bi(s){var e=new j(3);return e[0]=s[0],e[1]=s[1],e[2]=s[2],e}function vi(s){var e=s[0],i=s[1],a=s[2];return Math.sqrt(e*e+i*i+a*a)}function ei(s,e,i){var a=new j(3);return a[0]=s,a[1]=e,a[2]=i,a}function si(s,e,i,a){return s[0]=e,s[1]=i,s[2]=a,s}function Tt(s,e,i){return s[0]=e[0]+i[0],s[1]=e[1]+i[1],s[2]=e[2]+i[2],s}function Ht(s,e,i){return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s[2]=e[2]-i[2],s}function Gt(s,e,i){return s[0]=e[0]*i[0],s[1]=e[1]*i[1],s[2]=e[2]*i[2],s}function hi(s,e,i){return s[0]=Math.min(e[0],i[0]),s[1]=Math.min(e[1],i[1]),s[2]=Math.min(e[2],i[2]),s}function Ft(s,e,i){return s[0]=Math.max(e[0],i[0]),s[1]=Math.max(e[1],i[1]),s[2]=Math.max(e[2],i[2]),s}function Ot(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s}function di(s,e,i,a){return s[0]=e[0]+i[0]*a,s[1]=e[1]+i[1]*a,s[2]=e[2]+i[2]*a,s}function wt(s,e){var i=e[0]-s[0],a=e[1]-s[1],u=e[2]-s[2];return Math.sqrt(i*i+a*a+u*u)}function sr(s,e){var i=e[0]-s[0],a=e[1]-s[1],u=e[2]-s[2];return i*i+a*a+u*u}function pr(s){var e=s[0],i=s[1],a=s[2];return e*e+i*i+a*a}function Fi(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s}function Si(s,e){var i=e[0],a=e[1],u=e[2],f=i*i+a*a+u*u;return f>0&&(f=1/Math.sqrt(f)),s[0]=e[0]*f,s[1]=e[1]*f,s[2]=e[2]*f,s}function Qt(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]}function Di(s,e,i){var a=e[0],u=e[1],f=e[2],m=i[0],_=i[1],b=i[2];return s[0]=u*b-f*_,s[1]=f*m-a*b,s[2]=a*_-u*m,s}function Pn(s,e,i,a){var u=e[0],f=e[1],m=e[2];return s[0]=u+a*(i[0]-u),s[1]=f+a*(i[1]-f),s[2]=m+a*(i[2]-m),s}function or(s,e,i){var a=e[0],u=e[1],f=e[2],m=i[3]*a+i[7]*u+i[11]*f+i[15];return s[0]=(i[0]*a+i[4]*u+i[8]*f+i[12])/(m=m||1),s[1]=(i[1]*a+i[5]*u+i[9]*f+i[13])/m,s[2]=(i[2]*a+i[6]*u+i[10]*f+i[14])/m,s}function Ls(s,e,i){var a=e[0],u=e[1],f=e[2];return s[0]=a*i[0]+u*i[3]+f*i[6],s[1]=a*i[1]+u*i[4]+f*i[7],s[2]=a*i[2]+u*i[5]+f*i[8],s}function ar(s,e,i){var a=i[0],u=i[1],f=i[2],m=i[3],_=e[0],b=e[1],S=e[2],I=u*S-f*b,C=f*_-a*S,k=a*b-u*_;return s[0]=_+m*(I+=I)+u*(k+=k)-f*(C+=C),s[1]=b+m*C+f*I-a*k,s[2]=S+m*k+a*C-u*I,s}function Qo(s){return s[0]=0,s[1]=0,s[2]=0,s}function es(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]}var Dr=Ht,ko=Gt,Lo=vi;function Po(){var s=new j(4);return j!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function ea(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s[2]=e[2]*i,s[3]=e[3]*i,s}function ta(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=i*i+a*a+u*u+f*f;return m>0&&(m=1/Math.sqrt(m)),s[0]=i*m,s[1]=a*m,s[2]=u*m,s[3]=f*m,s}function $n(s,e){return s[0]*e[0]+s[1]*e[1]+s[2]*e[2]+s[3]*e[3]}function zn(s,e,i){var a=e[0],u=e[1],f=e[2],m=e[3];return s[0]=i[0]*a+i[4]*u+i[8]*f+i[12]*m,s[1]=i[1]*a+i[5]*u+i[9]*f+i[13]*m,s[2]=i[2]*a+i[6]*u+i[10]*f+i[14]*m,s[3]=i[3]*a+i[7]*u+i[11]*f+i[15]*m,s}function po(){var s=new j(4);return j!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function Ps(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Mo(s,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],_=Math.sin(i),b=Math.cos(i);return s[0]=a*b+m*_,s[1]=u*b+f*_,s[2]=f*b-u*_,s[3]=m*b-a*_,s}function mo(s,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],_=Math.sin(i),b=Math.cos(i);return s[0]=a*b-f*_,s[1]=u*b+m*_,s[2]=f*b+a*_,s[3]=m*b-u*_,s}Ut(),Po();var Mn,Ro,ts,ia=ta,go=(Mn=Ut(),Ro=ei(1,0,0),ts=ei(0,1,0),function(s,e,i){var a=Qt(e,i);return a<-.999999?(Di(Mn,Ro,e),Lo(Mn)<1e-6&&Di(Mn,ts,e),Si(Mn,Mn),function(u,f,m){m*=.5;var _=Math.sin(m);u[0]=_*f[0],u[1]=_*f[1],u[2]=_*f[2],u[3]=Math.cos(m)}(s,Mn,Math.PI),s):a>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(Di(Mn,e,i),s[0]=Mn[0],s[1]=Mn[1],s[2]=Mn[2],s[3]=1+a,ia(s,s))});function Yr(){var s=new j(2);return j!=Float32Array&&(s[0]=0,s[1]=0),s}function _o(s,e){var i=new j(2);return i[0]=s,i[1]=e,i}function Ms(s,e,i){return s[0]=e,s[1]=i,s}function Do(s,e,i){return s[0]=e[0]+i[0],s[1]=e[1]+i[1],s}function Rs(s,e,i){return s[0]=e[0]-i[0],s[1]=e[1]-i[1],s}function Oo(s,e,i){return s[0]=e[0]*i,s[1]=e[1]*i,s}function zo(s){var e=s[0],i=s[1];return Math.sqrt(e*e+i*i)}function Ea(s,e){var i=e[0],a=e[1],u=i*i+a*a;return u>0&&(u=1/Math.sqrt(u)),s[0]=e[0]*u,s[1]=e[1]*u,s}function ir(s,e){return s[0]*e[0]+s[1]*e[1]}po(),po(),ie();var ln,Ia,Aa=Rs;function Bn(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}Yr();var gc=function(){if(Ia)return ln;function s(e,i,a,u){this.cx=3*e,this.bx=3*(a-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(u-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=i,this.p2x=a,this.p2y=u}return Ia=1,ln=s,s.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,i){if(i===void 0&&(i=1e-6),e<0)return 0;if(e>1)return 1;for(var a=e,u=0;u<8;u++){var f=this.sampleCurveX(a)-e;if(Math.abs(f)<i)return a;var m=this.sampleCurveDerivativeX(a);if(Math.abs(m)<1e-6)break;a-=f/m}var _=0,b=1;for(a=e,u=0;u<20&&(f=this.sampleCurveX(a),!(Math.abs(f-e)<i));u++)e>f?_=a:b=a,a=.5*(b-_)+_;return a},solve:function(e,i){return this.sampleCurveY(this.solveCurveX(e,i))}},ln}(),Qa=Bn(gc);function at(s,e){this.x=s,this.y=e}function Li(s,e){if(Array.isArray(s)){if(!Array.isArray(e)||s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(!Li(s[i],e[i]))return!1;return!0}if(typeof s=="object"&&s!==null&&e!==null){if(typeof e!="object"||Object.keys(s).length!==Object.keys(e).length)return!1;for(const i in s)if(!Li(s[i],e[i]))return!1;return!0}return s===e}at.prototype={clone(){return new at(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,e){return this.clone()._rotateAround(s,e)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const e=s.x-this.x,i=s.y-this.y;return e*e+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,e){return Math.atan2(this.x*e-this.y*s,this.x*s+this.y*e)},_matMult(s){const e=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=e,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const e=Math.cos(s),i=Math.sin(s),a=i*this.x+e*this.y;return this.x=e*this.x-i*this.y,this.y=a,this},_rotateAround(s,e){const i=Math.cos(s),a=Math.sin(s),u=e.y+a*(this.x-e.x)+i*(this.y-e.y);return this.x=e.x+i*(this.x-e.x)-a*(this.y-e.y),this.y=u,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:at},at.convert=function(s){if(s instanceof at)return s;if(Array.isArray(s))return new at(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new at(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};const bp=Math.PI/180,Mu=180/Math.PI;function Pi(s){return s*bp}function De(s){return s*Mu}const q=[[0,0],[1,0],[1,1],[0,1]];function ee(s){if(s<=0)return 0;if(s>=1)return 1;const e=s*s,i=e*s;return 4*(s<.5?i:3*(s-e)+i-.75)}function ue(s,e,i,a){const u=new Qa(s,e,i,a);return function(f){return u.solve(f)}}const Ce=ue(.25,.1,.25,1);function pe(s,e,i){return Math.min(i,Math.max(e,s))}function Pe(s,e,i){return(i=pe((i-s)/(e-s),0,1))*i*(3-2*i)}function Ue(s,e,i){const a=i-e,u=((s-e)%a+a)%a+e;return u===e?i:u}function Re(s,e,i){if(!s.length)return i(null,[]);let a=s.length;const u=new Array(s.length);let f=null;s.forEach((m,_)=>{e(m,(b,S)=>{b&&(f=b),u[_]=S,--a===0&&i(f,u)})})}let He=1;function ut(){return He++}function st(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log2(s)))}function At(s,e){s.forEach(i=>{e[i]&&(e[i]=e[i].bind(e))})}function Nt(s,e,i){const a={};for(const u in s)a[u]=e.call(this,s[u],u,s);return a}function Wt(s,e,i){const a={};for(const u in s)e.call(this,s[u],u,s)&&(a[u]=s[u]);return a}function oi(s){return Array.isArray(s)?s.map(oi):typeof s=="object"&&s?Nt(s,oi):s}function pi(s,e){for(let i=0;i<s.length;i++)if(e.indexOf(s[i])>=0)return!0;return!1}const ti={};function Kt(s){ti[s]||(typeof console<"u"&&console.warn(s),ti[s]=!0)}function lr(s,e,i){return(i.y-s.y)*(e.x-s.x)>(e.y-s.y)*(i.x-s.x)}function Wr(s){let e=0;for(let i,a,u=0,f=s.length,m=f-1;u<f;m=u++)i=s[u],a=s[m],e+=(a.x-i.x)*(i.y+a.y);return e}function Or([s,e,i]){const a=Pi(e+90),u=Pi(i);return{x:s*Math.cos(a)*Math.sin(u),y:s*Math.sin(a)*Math.sin(u),z:s*Math.cos(u),azimuthal:e,polar:i}}function zr(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function vr(s){const e={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,a,u,f)=>{const m=u||f;return e[a]=!m||m.toLowerCase(),""}),e["max-age"]){const i=parseInt(e["max-age"],10);isNaN(i)?delete e["max-age"]:e["max-age"]=i}return e}let Ci=null;function Sr(s,e){return[s[4*e],s[4*e+1],s[4*e+2],s[4*e+3]]}function Qi(s,e,i,a){for(;e<i;){const u=e+i>>1;s[u]<a?e=u+1:i=u}return e}function er(s,e,i,a){for(;e<i;){const u=e+i>>1;s[u]<=a?e=u+1:i=u}return e}function Mr(s){return s>0?1/(1.001-s):1+s}function Rn(s){return s>0?1-1/(1.001-s):-s}function wn(s,e,i){return(s-e.min)*(i.max-i.min)/(e.max-e.min)+i.min}const Jr={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Jr.API_URL)return null;try{const s=new URL(Jr.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function el(s){return Jr.API_URL_REGEX.test(s)}function Gn(s){return Jr.API_SPRITE_REGEX.test(s)}let Ds,yo,Bo,Os,is,Ca;function Ml(){return Ds==null&&(Ds=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Ds}const Zs={now:()=>Os!==void 0?Os:performance.now(),setNow(s){Os=s},restoreNow(){Os=void 0},frame(s){const e=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(e)}},getImageData(s,e=0){const{width:i,height:a}=s;is||(is=document.createElement("canvas"));const u=is.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(i>is.width||a>is.height)&&(is.width=i,is.height=a),u.clearRect(-e,-e,i+2*e,a+2*e),u.drawImage(s,0,0,i,a),u.getImageData(-e,-e,i+2*e,a+2*e)},resolveURL:s=>(yo||(yo=document.createElement("a")),yo.href=s,yo.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Bo==null&&(Bo=window.matchMedia("(prefers-reduced-motion: reduce)")),Bo.matches)},hasCanvasFingerprintNoise(){if(Ca!==void 0)return Ca;if(!Ml())return Ca=!1,!1;const s=new OffscreenCanvas(85,1),e=s.getContext("2d",{willReadFrequently:!0});let i=0;for(let u=0;u<s.width;++u)e.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,e.fillRect(u,0,1,1);const a=e.getImageData(0,0,s.width,s.height);i=0;for(let u=0;u<a.data.length;++u)if(u%4!=3&&i++!==a.data[u])return Ca=!0,!0;return Ca=!1,!1}};function Ru(s,e){const i=s.indexOf("?");if(i<0)return`${s}?${new URLSearchParams(e).toString()}`;const a=new URLSearchParams(s.slice(i));for(const u in e)a.set(u,e[u]);return`${s.slice(0,i)}?${a.toString()}`}function Du(s,e={persistentParams:[]}){const i=s.indexOf("?");if(i<0)return s;const a=new URLSearchParams,u=new URLSearchParams(s.slice(i));for(const m of e.persistentParams){const _=u.get(m);_&&a.set(m,_)}const f=a.toString();return`${s.slice(0,i)}${f.length>0?`?${f}`:""}`}const $_="mapbox-tiles";let G_=500,wp=50;const Sp=["language","worldview","jobid"];let Sn,Xs;function ka(){try{return caches}catch{}}function Ks(){const s=ka();s&&Sn==null&&(Sn=s.open($_))}let ra=1/0;const _c={supported:!1,testSupport:function(s){!tl&&Rl&&(rd?W_(s):yc=s)}};let yc,Rl,tl=!1,rd=!1;const H_=typeof self<"u"?self:{};function W_(s){const e=s.createTexture();s.bindTexture(s.TEXTURE_2D,e);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,Rl),s.isContextLost())return;_c.supported=!0}catch{}s.deleteTexture(e),tl=!0}H_.document&&(Rl=H_.document.createElement("img"),Rl.onload=function(){yc&&W_(yc),yc=null,rd=!0},Rl.onerror=function(){tl=!0,yc=null},Rl.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const gs={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(gs);class Ou extends Error{constructor(e,i,a){i===401&&el(a)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=i,this.url=a}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const zu=zr()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,La=function(s,e){if(!(/^file:/.test(i=s.url)||/^file:/.test(zu())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(a,u){const f=new AbortController,m=new Request(a.url,{method:a.method||"GET",body:a.body,credentials:a.credentials,headers:a.headers,referrer:zu(),referrerPolicy:a.referrerPolicy,signal:f.signal});let _=!1,b=!1;const S=(I=m.url).indexOf("sku=")>0&&el(I);var I;a.type==="json"&&m.headers.set("Accept","application/json");const C=(M,R,F)=>{if(b)return;if(M&&M.message!=="SecurityError"&&Kt(M.toString()),R&&F)return k(R);const $=Date.now();fetch(m).then(U=>{if(U.ok){const H=S?U.clone():null;return k(U,H,$)}return u(new Ou(U.statusText,U.status,a.url))}).catch(U=>{U.name!=="AbortError"&&u(new Error(`${U.message} ${a.url}`))})},k=(M,R,F)=>{(a.type==="arrayBuffer"?M.arrayBuffer():a.type==="json"?M.json():M.text()).then($=>{b||(R&&F&&function(U,H,X){if(Ks(),Sn==null)return;const Q=vr(H.headers.get("Cache-Control")||"");if(Q["no-store"])return;const ae={status:H.status,statusText:H.statusText,headers:new Headers};H.headers.forEach((ye,me)=>ae.headers.set(me,ye)),Q["max-age"]&&ae.headers.set("Expires",new Date(X+1e3*Q["max-age"]).toUTCString());const oe=ae.headers.get("Expires");if(!oe||new Date(oe).getTime()-X<42e4)return;let ge=Du(U.url,{persistentParams:Sp});if(H.status===206){const ye=U.headers.get("Range");if(!ye)return;ae.status=200,ge=Ru(ge,{range:ye})}(function(ye,me){if(Xs===void 0)try{new Response(new ReadableStream),Xs=!0}catch{Xs=!1}Xs?me(ye.body):ye.blob().then(me).catch(Se=>Kt(Se.message))})(H,ye=>{const me=new Response((Se=H.status)!==200&&Se!==404&&[101,103,204,205,304].includes(Se)?null:ye,ae);var Se;Ks(),Sn!=null&&Sn.then(Ae=>Ae.put(ge,me)).catch(Ae=>Kt(Ae.message))})}(m,R,F),_=!0,u(null,$,M.headers))}).catch($=>{b||u(new Error($.message))})};return S?function(M,R){if(Ks(),Sn==null)return R(null);Sn.then(F=>{let $=Du(M.url,{persistentParams:Sp});const U=M.headers.get("Range");U&&($=Ru($,{range:U})),F.match($).then(H=>{const X=function(Q){if(!Q)return!1;const ae=new Date(Q.headers.get("Expires")||0),oe=vr(Q.headers.get("Cache-Control")||"");return Number(ae)>Date.now()&&!oe["no-cache"]}(H);F.delete($).catch(R),X&&F.put($,H.clone()).catch(R),R(null,H,X)}).catch(R)}).catch(R)}(m,C):C(null,null),{cancel:()=>{b=!0,_||f.abort()}}}(s,e);if(zr(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,e,void 0,!0)}var i;return function(a,u){const f=new XMLHttpRequest;f.open(a.method||"GET",a.url,!0),a.type==="arrayBuffer"&&(f.responseType="arraybuffer");for(const m in a.headers)f.setRequestHeader(m,a.headers[m]);return a.type==="json"&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials=a.credentials==="include",f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||f.status===0)&&f.response!==null){let m=f.response;if(a.type==="json")try{m=JSON.parse(f.response)}catch(b){return u(b)}const _=new Headers;f.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(b=>{const S=b.split(": "),I=S.shift(),C=S.join(": ");_.append(I,C)}),u(null,m,_)}else u(new Ou(f.statusText,f.status,a.url))},f.send(a.body),{cancel:()=>f.abort()}}(s,e)},Bu=function(s,e){return La(Object.assign(s,{type:"arrayBuffer"}),e)};function a1(s){const e=document.createElement("a");return e.href=s,e.protocol===location.protocol&&e.host===location.host}const Tp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Oi,vc;Oi=[],vc=0;const nd=function(s,e){if(_c.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),vc>=Jr.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:s,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Oi.push(f),f}vc++;let i=!1;const a=()=>{if(!i)for(i=!0,vc--;Oi.length&&vc<Jr.MAX_PARALLEL_IMAGE_REQUESTS;){const f=Oi.shift(),{requestParameters:m,callback:_,cancelled:b}=f;b||(f.cancel=nd(m,_).cancel)}},u=Bu(s,(f,m,_)=>{a(),f?e(f):m&&(self.createImageBitmap?function(b,S){const I=new Blob([new Uint8Array(b)],{type:"image/png"});createImageBitmap(I).then(C=>{S(null,C)}).catch(C=>{S(new Error(`Could not load image because of ${C.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(m,(b,S)=>e(b,S,_)):function(b,S){const I=new Image;I.onload=()=>{S(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=Tp})},I.onerror=()=>S(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const C=new Blob([new Uint8Array(b)],{type:"image/png"});I.src=b.byteLength?URL.createObjectURL(C):Tp}(m,(b,S)=>e(b,S,_)))});return{cancel:()=>{u.cancel(),a()}}};var q_,Z_,Fu,il={exports:{}},ju={exports:{}},sd={exports:{}},l1=function(){if(Fu)return il.exports;Fu=1;var s=(q_||(q_=1,ju.exports=function(i,a){var u,f,m,_,b,S,I,C;for(f=i.length-(u=3&i.length),m=a,b=3432918353,S=461845907,C=0;C<f;)I=255&i.charCodeAt(C)|(255&i.charCodeAt(++C))<<8|(255&i.charCodeAt(++C))<<16|(255&i.charCodeAt(++C))<<24,++C,m=27492+(65535&(_=5*(65535&(m=(m^=I=(65535&(I=(I=(65535&I)*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+(((_>>>16)+58964&65535)<<16);switch(I=0,u){case 3:I^=(255&i.charCodeAt(C+2))<<16;case 2:I^=(255&i.charCodeAt(C+1))<<8;case 1:m^=I=(65535&(I=(I=(65535&(I^=255&i.charCodeAt(C)))*b+(((I>>>16)*b&65535)<<16)&4294967295)<<15|I>>>17))*S+(((I>>>16)*S&65535)<<16)&4294967295}return m^=i.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}),ju.exports),e=(Z_||(Z_=1,sd.exports=function(i,a){for(var u,f=i.length,m=a^f,_=0;f>=4;)u=1540483477*(65535&(u=255&i.charCodeAt(_)|(255&i.charCodeAt(++_))<<8|(255&i.charCodeAt(++_))<<16|(255&i.charCodeAt(++_))<<24))+((1540483477*(u>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(u=1540483477*(65535&(u^=u>>>24))+((1540483477*(u>>>16)&65535)<<16)),f-=4,++_;switch(f){case 3:m^=(255&i.charCodeAt(_+2))<<16;case 2:m^=(255&i.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&i.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}),sd.exports);return il.exports=s,il.exports.murmur3=s,il.exports.murmur2=e,il.exports}(),xc=Bn(l1);class Pa{constructor(e,...i){Object.assign(this,i[0]||{}),this.type=e}}class Nu extends Pa{constructor(e,i={}){super("error",Object.assign({error:e},i))}}function X_(s,e,i){i[s]&&i[s].indexOf(e)!==-1||(i[s]=i[s]||[],i[s].push(e))}function Dl(s,e,i){if(i&&i[s]){const a=i[s].indexOf(e);a!==-1&&i[s].splice(a,1)}}class Ma{on(e,i){return this._listeners=this._listeners||{},X_(e,i,this._listeners),this}off(e,i){return Dl(e,i,this._listeners),Dl(e,i,this._oneTimeListeners),this}once(e,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},X_(e,i,this._oneTimeListeners),this):new Promise(a=>{this.once(e,a)})}fire(e,i){const a=typeof e=="string"?new Pa(e,i):e,u=a.type;if(this.listens(u)){a.target=this;const f=this._listeners&&this._listeners[u]?this._listeners[u].slice():[];for(const b of f)b.call(this,a);const m=this._oneTimeListeners&&this._oneTimeListeners[u]?this._oneTimeListeners[u].slice():[];for(const b of m)Dl(u,b,this._oneTimeListeners),b.call(this,a);const _=this._eventedParent;if(_){const b=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(a,b),_.fire(a)}}else a instanceof Nu&&console.error(a.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,i){return this._eventedParent=e,this._eventedParentData=i,this}}class _s{constructor(e){typeof e=="string"?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new _s(e)}static toString(e){return e.iconsetId?`${e.name}${e.iconsetId}`:e.name}static parse(e){const[i,a]=e.split("");return new _s({name:i,iconsetId:a})}static isEqual(e,i){return e.name===i.name&&e.iconsetId===i.iconsetId}toString(){return _s.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var vo,od={},K_=function(){if(vo)return od;vo=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function e(f){return(f=Math.round(f))<0?0:f>255?255:f}function i(f){return e(f[f.length-1]==="%"?parseFloat(f)/100*255:parseInt(f))}function a(f){return(m=f[f.length-1]==="%"?parseFloat(f)/100:parseFloat(f))<0?0:m>1?1:m;var m}function u(f,m,_){return _<0?_+=1:_>1&&(_-=1),6*_<1?f+(m-f)*_*6:2*_<1?m:3*_<2?f+(m-f)*(2/3-_)*6:f}try{od.parseCSSColor=function(f){var m,_=f.replace(/ /g,"").toLowerCase();if(_ in s)return s[_].slice();if(_[0]==="#")return _.length===4?(m=parseInt(_.substr(1),16))>=0&&m<=4095?[(3840&m)>>4|(3840&m)>>8,240&m|(240&m)>>4,15&m|(15&m)<<4,1]:null:_.length===7&&(m=parseInt(_.substr(1),16))>=0&&m<=16777215?[(16711680&m)>>16,(65280&m)>>8,255&m,1]:null;var b=_.indexOf("("),S=_.indexOf(")");if(b!==-1&&S+1===_.length){var I=_.substr(0,b),C=_.substr(b+1,S-(b+1)).split(","),k=1;switch(I){case"rgba":if(C.length!==4)return null;k=a(C.pop());case"rgb":return C.length!==3?null:[i(C[0]),i(C[1]),i(C[2]),k];case"hsla":if(C.length!==4)return null;k=a(C.pop());case"hsl":if(C.length!==3)return null;var M=(parseFloat(C[0])%360+360)%360/360,R=a(C[1]),F=a(C[2]),$=F<=.5?F*(R+1):F+R-F*R,U=2*F-$;return[e(255*u(U,$,M+1/3)),e(255*u(U,$,M)),e(255*u(U,$,M-1/3)),k];default:return null}}return null}}catch{}return od}();class Hi{constructor(e,i,a,u=1){this.r=e,this.g=i,this.b=a,this.a=u}static parse(e){if(!e)return;if(e instanceof Hi)return e;if(typeof e!="string")return;const i=K_.parseCSSColor(e);return i?new Hi(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[e,i,a,u]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*e)},${Math.round(255*i)},${Math.round(255*a)},${u})`}toNonPremultipliedRenderColor(e){const{r:i,g:a,b:u,a:f}=this;return new Y_(e,i,a,u,f)}toPremultipliedRenderColor(e){const{r:i,g:a,b:u,a:f}=this;return new J_(e,i*f,a*f,u*f,f)}clone(){return new Hi(this.r,this.g,this.b,this.a)}}class Ep{constructor(e,i,a,u,f,m=!1){if(this.premultiplied=!1,this.premultiplied=m,e){const _=e.image.height,b=_*_;this.premultiplied?(i=f===0?0:i/f*(_-1),a=f===0?0:a/f*(_-1),u=f===0?0:u/f*(_-1)):(i*=_-1,a*=_-1,u*=_-1),i=Math.max(0,Math.min(_-1,i)),a=Math.max(0,Math.min(_-1,a)),u=Math.max(0,Math.min(_-1,u));const S=Math.floor(i),I=Math.floor(a),C=Math.floor(u),k=Math.ceil(i),M=Math.ceil(a),R=Math.ceil(u),F=i-S,$=a-I,U=u-C,H=e.image.data,X=4*(S+I*b+C*_),Q=4*(S+I*b+R*_),ae=4*(S+M*b+C*_),oe=4*(S+M*b+R*_),ge=4*(k+I*b+C*_),ye=4*(k+I*b+R*_),me=4*(k+M*b+C*_),Se=4*(k+M*b+R*_);this.r=qt(qt(qt(H[X],H[Q],U),qt(H[ae],H[oe],U),$),qt(qt(H[ge],H[ye],U),qt(H[me],H[Se],U),$),F)/255*(this.premultiplied?f:1),this.g=qt(qt(qt(H[X+1],H[Q+1],U),qt(H[ae+1],H[oe+1],U),$),qt(qt(H[ge+1],H[ye+1],U),qt(H[me+1],H[Se+1],U),$),F)/255*(this.premultiplied?f:1),this.b=qt(qt(qt(H[X+2],H[Q+2],U),qt(H[ae+2],H[oe+2],U),$),qt(qt(H[ge+2],H[ye+2],U),qt(H[me+2],H[Se+2],U),$),F)/255*(this.premultiplied?f:1),this.a=f}else this.r=i,this.g=a,this.b=u,this.a=f}toArray(){const{r:e,g:i,b:a,a:u}=this;return[255*e,255*i,255*a,u]}toHslaArray(){let{r:e,g:i,b:a,a:u}=this;if(this.premultiplied){if(u===0)return[0,0,0,0];const R=1/u;e*=R,i*=R,a*=R}const f=Math.min(Math.max(e,0),1),m=Math.min(Math.max(i,0),1),_=Math.min(Math.max(a,0),1),b=Math.min(f,m,_),S=Math.max(f,m,_),I=S-b,C=.5*(b+S);if(I===0)return[0,0,100*C,u];const k=C>.5?I/(2-S-b):I/(S+b);let M;switch(S){case f:M=60*((m-_)/I+(m<_?6:0));break;case m:M=60*((_-f)/I+2);break;default:M=60*((f-m)/I+4)}return[M,100*k,100*C,u]}toArray01(){const{r:e,g:i,b:a,a:u}=this;return[e,i,a,u]}toArray01Scaled(e){const{r:i,g:a,b:u}=this;return[i*e,a*e,u*e]}toArray01Linear(){const{r:e,g:i,b:a,a:u}=this;return[Math.pow(e,2.2),Math.pow(i,2.2),Math.pow(a,2.2),u]}}class Y_ extends Ep{constructor(e,i,a,u,f){super(e,i,a,u,f,!1)}}class J_ extends Ep{constructor(e,i,a,u,f){super(e,i,a,u,f,!0)}}function qt(s,e,i){return s*(1-i)+e*i}function Ip(s,e,i){return s.map((a,u)=>qt(a,e[u],i))}Hi.black=new Hi(0,0,0,1),Hi.white=new Hi(1,1,1,1),Hi.transparent=new Hi(0,0,0,0),Hi.red=new Hi(1,0,0,1),Hi.blue=new Hi(0,0,1,1);var Ol=Object.freeze({__proto__:null,array:Ip,color:function(s,e,i){return new Hi(qt(s.r,e.r,i),qt(s.g,e.g,i),qt(s.b,e.b,i),qt(s.a,e.a,i))},number:qt});class rs extends Error{constructor(e,i){super(i),this.message=i,this.key=e}}class ad{constructor(e,i=[]){this.parent=e,this.bindings={};for(const[a,u]of i)this.bindings[a]=u}concat(e){return new ad(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const ys={kind:"null"},Bt={kind:"number"},$i={kind:"string"},zi={kind:"boolean"},ns={kind:"color"},bc={kind:"object"},qi={kind:"value"},ld={kind:"collator"},wc={kind:"formatted"},zl={kind:"resolvedImage"};function Hn(s,e){return{kind:"array",itemType:s,N:e}}function Vr(s){if(s.kind==="array"){const e=Vr(s.itemType);return typeof s.N=="number"?`array<${e}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${e}>`}return s.kind}const c1=[ys,Bt,$i,zi,ns,wc,bc,Hn(qi),zl];function Uu(s,e){if(e.kind==="error")return null;if(s.kind==="array"){if(e.kind==="array"&&(e.N===0&&e.itemType.kind==="value"||!Uu(s.itemType,e.itemType))&&(typeof s.N!="number"||s.N===e.N))return null}else{if(s.kind===e.kind)return null;if(s.kind==="value"){for(const i of c1)if(!Uu(i,e))return null}}return`Expected ${Vr(s)} but found ${Vr(e)} instead.`}function Ap(s,e){return e.some(i=>i.kind===s.kind)}function Vu(s,e){return e.some(i=>i==="null"?s===null:i==="array"?Array.isArray(s):i==="object"?s&&!Array.isArray(s)&&typeof s=="object":i===typeof s)}function cd(s,e){return s.kind==="array"&&e.kind==="array"?s.N===e.N&&cd(s.itemType,e.itemType):s.kind===e.kind}class Cp{constructor(e,i,a){this.sensitivity=e?i?"variant":"case":i?"accent":"base",this.locale=a,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,i){return this.collator.compare(e,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ud{constructor(e,i,a,u,f){this.text=e.normalize?e.normalize():e,this.image=i,this.scale=a,this.fontStack=u,this.textColor=f}}class Wn{constructor(e){this.sections=e}static fromString(e){return new Wn([new ud(e,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(e=>e.text.length!==0||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Wn?e:Wn.fromString(e)}toString(){return this.sections.length===0?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const i of this.sections){if(i.image){const u=i.image.getPrimary().id.toString();e.push(["image",u]);continue}e.push(i.text);const a={};i.fontStack&&(a["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(a["font-scale"]=i.scale),i.textColor&&(a["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(a)}return e}}class vs{constructor(e,i={}){this.id=_s.from(e),this.params=i.params,this.sx=i.sx||1,this.sy=i.sy||1}toString(){return JSON.stringify(this)}static parse(e){let i,a,u,f;try{({id:i,params:a,sx:u,sy:f}=JSON.parse(e)||{})}catch{return null}return i?new vs(i,{params:a,sx:u,sy:f}):null}scaleSelf(e,i=e){return this.sx*=e,this.sy*=i,this}}class xs{constructor(e,i,a,u,f=!1){this.primaryId=_s.from(e),this.primaryOptions=i,a&&(this.secondaryId=_s.from(a)),this.secondaryOptions=u,this.available=f}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new vs(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new vs(this.secondaryId,this.secondaryOptions):null}static from(e){return typeof e=="string"?xs.build({name:e}):e}static build(e,i,a,u){return!e||typeof e=="object"&&!("name"in e)?null:new xs(e,a,i,u)}}function kp(s,e,i,a){return typeof s=="number"&&s>=0&&s<=255&&typeof e=="number"&&e>=0&&e<=255&&typeof i=="number"&&i>=0&&i<=255?a===void 0||typeof a=="number"&&a>=0&&a<=1?null:`Invalid rgba value [${[s,e,i,a].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof a=="number"?[s,e,i,a]:[s,e,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function rl(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Hi||s instanceof Cp||s instanceof Wn||s instanceof xs)return!0;if(Array.isArray(s)){for(const e of s)if(!rl(e))return!1;return!0}if(typeof s=="object"){for(const e in s)if(!rl(s[e]))return!1;return!0}return!1}function cn(s){if(s===null)return ys;if(typeof s=="string")return $i;if(typeof s=="boolean")return zi;if(typeof s=="number")return Bt;if(s instanceof Hi)return ns;if(s instanceof Cp)return ld;if(s instanceof Wn)return wc;if(s instanceof xs)return zl;if(Array.isArray(s)){const e=s.length;let i;for(const a of s){const u=cn(a);if(i){if(i===u)continue;i=qi;break}i=u}return Hn(i||qi,e)}return bc}function na(s){const e=typeof s;return s===null?"":e==="string"||e==="number"||e==="boolean"?String(s):s instanceof Wn||s instanceof xs||s instanceof Hi?s.toString():JSON.stringify(s)}class Ra{constructor(e,i){this.type=e,this.value=i}static parse(e,i){if(e.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!rl(e[1]))return i.error("invalid value");const a=e[1];let u=cn(a);const f=i.expectedType;return u.kind!=="array"||u.N!==0||!f||f.kind!=="array"||typeof f.N=="number"&&f.N!==0||(u=f),new Ra(u,a)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Hi?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Wn?this.value.serialize():this.value}}class Qr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const nl={string:$i,number:Bt,boolean:zi,object:bc};class ri{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");let a,u=1;const f=e[0];if(f==="array"){let _,b;if(e.length>2){const S=e[1];if(typeof S!="string"||!(S in nl)||S==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);_=nl[S],u++}else _=qi;if(e.length>3){if(e[2]!==null&&(typeof e[2]!="number"||e[2]<0||e[2]!==Math.floor(e[2])))return i.error('The length argument to "array" must be a positive integer literal',2);b=e[2],u++}a=Hn(_,b)}else a=nl[f];const m=[];for(;u<e.length;u++){const _=i.parse(e[u],u,qi);if(!_)return null;m.push(_)}return new ri(a,m)}evaluate(e){for(let i=0;i<this.args.length;i++){const a=this.args[i].evaluate(e);if(!Uu(this.type,cn(a)))return a;if(i===this.args.length-1)throw new Qr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Vr(cn(a))} but was expected to be of type ${Vr(this.type)}.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,i=[e.kind];if(e.kind==="array"){const a=e.itemType;if(a.kind==="string"||a.kind==="number"||a.kind==="boolean"){i.push(a.kind);const u=e.N;(typeof u=="number"||this.args.length>1)&&i.push(u)}}return i.concat(this.args.map(a=>a.serialize()))}}class Dt{constructor(e){this.type=wc,this.sections=e}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[1];if(!Array.isArray(a)&&typeof a=="object")return i.error("First argument must be an image or text section.");const u=[];let f=!1;for(let m=1;m<=e.length-1;++m){const _=e[m];if(f&&typeof _=="object"&&!Array.isArray(_)){f=!1;let b=null;if(_["font-scale"]&&(b=i.parseObjectValue(_["font-scale"],m,"font-scale",Bt),!b))return null;let S=null;if(_["text-font"]&&(S=i.parseObjectValue(_["text-font"],m,"text-font",Hn($i)),!S))return null;let I=null;if(_["text-color"]&&(I=i.parseObjectValue(_["text-color"],m,"text-color",ns),!I))return null;const C=u[u.length-1];C.scale=b,C.font=S,C.textColor=I}else{const b=i.parse(e[m],m,qi);if(!b)return null;const S=b.type.kind;if(S!=="string"&&S!=="value"&&S!=="null"&&S!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:b,scale:null,font:null,textColor:null})}}return new Dt(u)}evaluate(e){return new Wn(this.sections.map(i=>{const a=i.content.evaluate(e);return cd(cn(a),zl)?new ud("",a,null,null,null):new ud(na(a),null,i.scale?i.scale.evaluate(e):null,i.font?i.font.evaluate(e).join(","):null,i.textColor?i.textColor.evaluate(e):null)}))}eachChild(e){for(const i of this.sections)e(i.content),i.scale&&e(i.scale),i.font&&e(i.font),i.textColor&&e(i.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const i of this.sections){e.push(i.content.serialize());const a={};i.scale&&(a["font-scale"]=i.scale.serialize()),i.font&&(a["text-font"]=i.font.serialize()),i.textColor&&(a["text-color"]=i.textColor.serialize()),e.push(a)}return e}}class Sc{constructor(e,i,a,u){this._imageWarnHistory={},this.type=zl,this.namePrimary=e,this.nameSecondary=i,a&&(this.paramsPrimary=a.params,this.iconsetIdPrimary=a.iconset?a.iconset.id:void 0),u&&(this.paramsSecondary=u.params,this.iconsetIdSecondary=u.iconset?u.iconset.id:void 0)}static parse(e,i){if(e.length<2)return i.error("Expected two or more arguments.");let a=1;const u=[];function f(){if(a<e.length){const _=i.parse(e[a],a++,$i);return _?(u.push({image:_,options:{}}),!0):(i.error(u.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function m(){if(a<e.length){const b=e[a];if((_=b)===null||typeof _!="object"||Array.isArray(_))return!0;const S=b.params,I=b.iconset,C=i.concat(a);if(!S&&!I)return a++,!0;if(S){if(typeof S!="object"||S.constructor!==Object)return C.error('Image options "params" should be an object'),!1;const k={},M=C.concat(void 0,"params");for(const R in S){if(!R)return M.error("Image parameter name should be non-empty"),!1;const F=M.concat(void 0,R).parse(S[R],void 0,ns,void 0,{typeAnnotation:"coerce"});if(!F)return!1;k[R]=F}u[u.length-1].options.params=k}if(I){if(typeof I!="object"||I.constructor!==Object)return C.error('Image options "iconset" should be an object'),!1;if(!I.id)return C.error('Image options "iconset" should have an "id" property'),!1;u[u.length-1].options.iconset=I}return a++,!0}var _;return!0}for(let _=0;_<2;_++)if(!f()||!m())return;return new Sc(u[0].image,u[1]?u[1].image:void 0,u[0].options,u[1]?u[1].options:void 0)}evaluateParams(e,i){const a={};if(i){for(const u in i)if(i[u])try{a[u]=i[u].evaluate(e)}catch{continue}if(Object.keys(a).length!==0)return{params:a}}}evaluate(e){const i={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},a=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,u=xs.build(i,a,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(u&&e.availableImages){const f=u.getPrimary().id;if(u.available=e.availableImages.some(m=>_s.isEqual(m,f)),u.available){const m=u.getSecondary()?u.getSecondary().id:null;m&&(u.available=e.availableImages.some(_=>_s.isEqual(_,m)))}}return u}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&e(this.paramsPrimary[i]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&e(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(e,i){const a={};if(i&&(a.iconset={id:i}),e){a.params={};for(const u in e)e[u]&&(a.params[u]=e[u].serialize())}return Object.keys(a).length>0?a:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&e.push(i)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&e.push(i)}return e}}function Yt(s){return $u(s)?"string":Zt(s)?"number":Lp(s)?"boolean":Array.isArray(s)?"array":s===null?"null":hd(s)?"object":typeof s}function hd(s){return s!=null&&!Array.isArray(s)&&typeof s!="function"&&!(s instanceof String||s instanceof Number||s instanceof Boolean)&&typeof s=="object"}function $u(s){return typeof s=="string"||s instanceof String}function Zt(s){return typeof s=="number"||s instanceof Number}function Lp(s){return typeof s=="boolean"||s instanceof Boolean}const Pp={"to-boolean":zi,"to-color":ns,"to-number":Bt,"to-string":$i};class sa{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expected at least one argument.");const a=e[0],u=[];let f=ys;if(a==="to-array"){if(!Array.isArray(e[1]))return null;const m=e[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);f=Hn(i.expectedType.itemType,m)}else{if(!(m>0&&rl(e[1][0])))return null;f=Hn(cn(e[1][0]),m)}for(let _=0;_<m;_++){const b=e[1][_];let S;if(Array.isArray(b))S=i.parse(b,void 0,f.itemType);else{const I=Yt(b);if(I!==f.itemType.kind)return i.error(`Expected ${f.itemType.kind} but found ${I}.`);S=i.registry.literal.parse(["literal",b===void 0?null:b],i)}if(!S)return null;u.push(S)}}else{if((a==="to-boolean"||a==="to-string")&&e.length!==2)return i.error("Expected one argument.");f=Pp[a];for(let m=1;m<e.length;m++){const _=i.parse(e[m],m,qi);if(!_)return null;u.push(_)}}return new sa(f,u)}evaluate(e){if(this.type.kind==="boolean")return!!this.args[0].evaluate(e);if(this.type.kind==="color"){let i,a;for(const u of this.args){if(i=u.evaluate(e),a=null,i instanceof Hi)return i;if(typeof i=="string"){const f=e.parseColor(i);if(f)return f}else if(Array.isArray(i)&&(a=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:kp(i[0],i[1],i[2],i[3]),!a))return new Hi(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Qr(a||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const a of this.args){if(i=a.evaluate(e),i===null)return 0;const u=Number(i);if(!isNaN(u))return u}throw new Qr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?Wn.fromString(na(this.args[0].evaluate(e))):this.type.kind==="resolvedImage"?xs.build(na(this.args[0].evaluate(e))):this.type.kind==="array"?this.args.map(i=>i.evaluate(e)):na(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if(this.type.kind==="formatted")return new Dt([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new Sc(this.args[0]).serialize();const e=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{e.push(i.serialize())}),e}}const Q_=["Unknown","Point","LineString","Polygon"];class Tc{constructor(e,i,a){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=i,this.iconImageUseTheme=a}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Q_[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:a,y:u}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*i-e[0])+this.featureDistanceData.bearing[1]*(u*i-e[1])}return 0}parseColor(e){let i=this._parseColorCache[e];return i||(i=this._parseColorCache[e]=Hi.parse(e)),i}getConfig(e){return this.options?this.options.get(e):null}}class bs{constructor(e,i,a,u,f){this.name=e,this.type=i,this._evaluate=a,this.args=u,this._overloadIndex=f}evaluate(e){if(!this._evaluate){const i=bs.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,i){const a=e[0],u=bs.definitions[a];if(!u)return i.error(`Unknown expression "${a}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,m=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,_=[];let b=null,S=-1;for(const[I,C]of m){if(Array.isArray(I)&&I.length!==e.length-1)continue;_.push(I),S++,b=new bd(i.registry,i.path,null,i.scope,void 0,i._scope,i.options,i.iconImageUseTheme);const k=[];let M=!1;for(let R=1;R<e.length;R++){const F=e[R],$=Array.isArray(I)?I[R-1]:I.type,U=b.parse(F,1+k.length,$);if(!U){M=!0;break}k.push(U)}if(!M)if(Array.isArray(I)&&I.length!==k.length)b.error(`Expected ${I.length} arguments, but found ${k.length} instead.`);else{for(let R=0;R<k.length;R++){const F=Array.isArray(I)?I[R]:I.type,$=k[R];b.concat(R+1).checkSubtype(F,$.type)}if(b.errors.length===0)return new bs(a,f,C,k,S)}}if(_.length===1)i.errors.push(...b.errors);else{const I=(_.length?_:m.map(([k])=>k)).map(Mp).join(" | "),C=[];for(let k=1;k<e.length;k++){const M=i.parse(e[k],1+C.length);if(!M)return null;C.push(Vr(M.type))}i.error(`Expected arguments of type ${I}, but found (${C.join(", ")}) instead.`)}return null}static register(e,i){bs.definitions=i;for(const a in i)e[a]=bs}}function Mp(s){return Array.isArray(s)?`(${s.map(Vr).join(", ")})`:`(${Vr(s.type)}...)`}class oa{constructor(e,i,a){this.type=ld,this.locale=a,this.caseSensitive=e,this.diacriticSensitive=i}static parse(e,i){if(e.length!==2)return i.error("Expected one argument.");const a=e[1];if(typeof a!="object"||Array.isArray(a))return i.error("Collator options argument must be an object.");const u=a["case-sensitive"]===void 0?i.parse(!1,1,zi):i.parseObjectValue(a["case-sensitive"],1,"case-sensitive",zi);if(!u)return null;const f=a["diacritic-sensitive"]===void 0?i.parse(!1,1,zi):i.parseObjectValue(a["diacritic-sensitive"],1,"diacritic-sensitive",zi);if(!f)return null;let m=null;return a.locale&&(m=i.parseObjectValue(a.locale,1,"locale",$i),!m)?null:new oa(u,f,m)}evaluate(e){return new Cp(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function dd(s,e,i=0,a=s.length-1,u=sl){for(;a>i;){if(a-i>600){const b=a-i+1,S=e-i+1,I=Math.log(b),C=.5*Math.exp(2*I/3),k=.5*Math.sqrt(I*C*(b-C)/b)*(S-b/2<0?-1:1);dd(s,e,Math.max(i,Math.floor(e-S*C/b+k)),Math.min(a,Math.floor(e+(b-S)*C/b+k)),u)}const f=s[e];let m=i,_=a;for(xo(s,i,e),u(s[a],f)>0&&xo(s,i,a);m<_;){for(xo(s,m,_),m++,_--;u(s[m],f)<0;)m++;for(;u(s[_],f)>0;)_--}u(s[i],f)===0?xo(s,i,_):(_++,xo(s,_,a)),_<=e&&(i=_+1),e<=_&&(a=_-1)}}function xo(s,e,i){const a=s[e];s[e]=s[i],s[i]=a}function sl(s,e){return s<e?-1:s>e?1:0}function u1(s){let e=0;for(let i,a,u=0,f=s.length,m=f-1;u<f;m=u++)i=s[u],a=s[m],e+=(a.x-i.x)*(i.y+a.y);return e}function Gu(s,e){s[0]=Math.min(s[0],e[0]),s[1]=Math.min(s[1],e[1]),s[2]=Math.max(s[2],e[0]),s[3]=Math.max(s[3],e[1])}function Hu(s,e){return!(s[0]<=e[0]||s[2]>=e[2]||s[1]<=e[1]||s[3]>=e[3])}function fd(s,e,i){const a=s[0]-e[0],u=s[1]-e[1],f=s[0]-i[0],m=s[1]-i[1];return a*m-f*u===0&&a*f<=0&&u*m<=0}function ey(s,e,i){return e[1]>s[1]!=i[1]>s[1]&&s[0]<(i[0]-e[0])*(s[1]-e[1])/(i[1]-e[1])+e[0]}function bo(s,e,i=!1){let a=!1;for(let u=0,f=e.length;u<f;u++){const m=e[u];for(let _=0,b=m.length,S=b-1;_<b;S=_++){const I=m[S],C=m[_];if(fd(s,I,C))return i;ey(s,I,C)&&(a=!a)}}return a}function ty(s,e,i,a){const u=a[0]-i[0],f=a[1]-i[1],m=(s[0]-i[0])*f-u*(s[1]-i[1]),_=(e[0]-i[0])*f-u*(e[1]-i[1]);return m>0&&_<0||m<0&&_>0}function pd(s,e,i,a){return(u=[a[0]-i[0],a[1]-i[1]])[0]*(f=[e[0]-s[0],e[1]-s[1]])[1]-u[1]*f[0]!==0&&!(!ty(s,e,i,a)||!ty(i,a,s,e));var u,f}function Wu(s){const e=new at(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new at(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const a of s[0])e.x>a.x&&(e.x=a.x),e.y>a.y&&(e.y=a.y),i.x<a.x&&(i.x=a.x),i.y<a.y&&(i.y=a.y);return{min:e,max:i}}const ol=8192;function h1(s,e){const i=(180+s[0])/360,a=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(i*u*ol),Math.round(a*u*ol)]}function iy(s,e){for(let i=0;i<e.length;i++)if(bo(s,e[i]))return!0;return!1}function d1(s,e,i){for(const a of i)for(let u=0,f=a.length,m=f-1;u<f;m=u++)if(pd(s,e,a[m],a[u]))return!0;return!1}function Rp(s,e){for(let i=0;i<s.length;++i)if(!bo(s[i],e))return!1;for(let i=0;i<s.length-1;++i)if(d1(s[i],s[i+1],e))return!1;return!0}function f1(s,e){for(let i=0;i<e.length;i++)if(Rp(s,e[i]))return!0;return!1}function Da(s,e,i){const a=[];for(let u=0;u<s.length;u++){const f=[];for(let m=0;m<s[u].length;m++){const _=h1(s[u][m],i);Gu(e,_),f.push(_)}a.push(f)}return a}function ry(s,e,i){const a=[];for(let u=0;u<s.length;u++){const f=Da(s[u],e,i);a.push(f)}return a}function ny(s,e,i,a){if(s[0]<i[0]||s[0]>i[2]){const u=.5*a;let f=s[0]-i[0]>u?-a:i[0]-s[0]>u?a:0;f===0&&(f=s[0]-i[2]>u?-a:i[2]-s[0]>u?a:0),s[0]+=f}Gu(e,s)}function md(s,e,i,a){const u=Math.pow(2,a.z)*ol,f=[a.x*ol,a.y*ol],m=[];if(!s)return m;for(const _ of s)for(const b of _){const S=[b.x+f[0],b.y+f[1]];ny(S,e,i,u),m.push(S)}return m}function Dp(s,e,i,a){const u=Math.pow(2,a.z)*ol,f=[a.x*ol,a.y*ol],m=[];if(!s)return m;for(const b of s){const S=[];for(const I of b){const C=[I.x+f[0],I.y+f[1]];Gu(e,C),S.push(C)}m.push(S)}if(e[2]-e[0]<=u/2){(_=e)[0]=_[1]=1/0,_[2]=_[3]=-1/0;for(const b of m)for(const S of b)ny(S,e,i,u)}var _;return m}class al{constructor(e,i){this.type=zi,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(rl(e[1])){const a=e[1];if(a.type==="FeatureCollection")for(let u=0;u<a.features.length;++u){const f=a.features[u].geometry.type;if(f==="Polygon"||f==="MultiPolygon")return new al(a,a.features[u].geometry)}else if(a.type==="Feature"){const u=a.geometry.type;if(u==="Polygon"||u==="MultiPolygon")return new al(a,a.geometry)}else if(a.type==="Polygon"||a.type==="MultiPolygon")return new al(a,a)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(e.geometry()!=null&&e.canonicalID()!=null){if(e.geometryType()==="Point")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const _=Da(a.coordinates,f,m),b=md(i.geometry(),u,f,m);if(!Hu(u,f))return!1;for(const S of b)if(!bo(S,_))return!1}if(a.type==="MultiPolygon"){const _=ry(a.coordinates,f,m),b=md(i.geometry(),u,f,m);if(!Hu(u,f))return!1;for(const S of b)if(!iy(S,_))return!1}return!0}(e,this.geometries);if(e.geometryType()==="LineString")return function(i,a){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],m=i.canonicalID();if(!m)return!1;if(a.type==="Polygon"){const _=Da(a.coordinates,f,m),b=Dp(i.geometry(),u,f,m);if(!Hu(u,f))return!1;for(const S of b)if(!Rp(S,_))return!1}if(a.type==="MultiPolygon"){const _=ry(a.coordinates,f,m),b=Dp(i.geometry(),u,f,m);if(!Hu(u,f))return!1;for(const S of b)if(!f1(S,_))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const zs={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Op=1/298.257223563,zp=Op*(2-Op),Ec=Math.PI/180;class Ic{static fromTile(e,i,a){const u=Math.PI*(1-2*(e+.5)/Math.pow(2,i)),f=Math.atan(.5*(Math.exp(u)-Math.exp(-u)))/Ec;return new Ic(f,a)}static get units(){return zs}constructor(e,i){if(e===void 0)throw new Error("No latitude given.");if(i&&!zs[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(zs).join(", ")}`);const a=6378.137*Ec*(i?zs[i]:1),u=Math.cos(e*Ec),f=1/(1-zp*(1-u*u)),m=Math.sqrt(f);this.kx=a*m*u,this.ky=a*m*f*(1-zp)}distance(e,i){const a=Ys(e[0]-i[0])*this.kx,u=(e[1]-i[1])*this.ky;return Math.sqrt(a*a+u*u)}bearing(e,i){const a=Ys(i[0]-e[0])*this.kx;return Math.atan2(a,(i[1]-e[1])*this.ky)/Ec}destination(e,i,a){const u=a*Ec;return this.offset(e,Math.sin(u)*i,Math.cos(u)*i)}offset(e,i,a){return[e[0]+i/this.kx,e[1]+a/this.ky]}lineDistance(e){let i=0;for(let a=0;a<e.length-1;a++)i+=this.distance(e[a],e[a+1]);return i}area(e){let i=0;for(let a=0;a<e.length;a++){const u=e[a];for(let f=0,m=u.length,_=m-1;f<m;_=f++)i+=Ys(u[f][0]-u[_][0])*(u[f][1]+u[_][1])*(a?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(e,i){let a=0;if(i<=0)return e[0];for(let u=0;u<e.length-1;u++){const f=e[u],m=e[u+1],_=this.distance(f,m);if(a+=_,a>i)return gd(f,m,(i-(a-_))/_)}return e[e.length-1]}pointToSegmentDistance(e,i,a){let[u,f]=i,m=Ys(a[0]-u)*this.kx,_=(a[1]-f)*this.ky;if(m!==0||_!==0){const b=(Ys(e[0]-u)*this.kx*m+(e[1]-f)*this.ky*_)/(m*m+_*_);b>1?(u=a[0],f=a[1]):b>0&&(u+=m/this.kx*b,f+=_/this.ky*b)}return m=Ys(e[0]-u)*this.kx,_=(e[1]-f)*this.ky,Math.sqrt(m*m+_*_)}pointOnLine(e,i){let a=1/0,u=e[0][0],f=e[0][1],m=0,_=0;for(let b=0;b<e.length-1;b++){let S=e[b][0],I=e[b][1],C=Ys(e[b+1][0]-S)*this.kx,k=(e[b+1][1]-I)*this.ky,M=0;C===0&&k===0||(M=(Ys(i[0]-S)*this.kx*C+(i[1]-I)*this.ky*k)/(C*C+k*k),M>1?(S=e[b+1][0],I=e[b+1][1]):M>0&&(S+=C/this.kx*M,I+=k/this.ky*M)),C=Ys(i[0]-S)*this.kx,k=(i[1]-I)*this.ky;const R=C*C+k*k;R<a&&(a=R,u=S,f=I,m=b,_=M)}return{point:[u,f],index:m,t:Math.max(0,Math.min(1,_))}}lineSlice(e,i,a){let u=this.pointOnLine(a,e),f=this.pointOnLine(a,i);if(u.index>f.index||u.index===f.index&&u.t>f.t){const S=u;u=f,f=S}const m=[u.point],_=u.index+1,b=f.index;!Bp(a[_],m[0])&&_<=b&&m.push(a[_]);for(let S=_+1;S<=b;S++)m.push(a[S]);return Bp(a[b],f.point)||m.push(f.point),m}lineSliceAlong(e,i,a){let u=0;const f=[];for(let m=0;m<a.length-1;m++){const _=a[m],b=a[m+1],S=this.distance(_,b);if(u+=S,u>e&&f.length===0&&f.push(gd(_,b,(e-(u-S))/S)),u>=i)return f.push(gd(_,b,(i-(u-S))/S)),f;u>e&&f.push(b)}return f}bufferPoint(e,i){const a=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-a,e[0]+u,e[1]+a]}bufferBBox(e,i){const a=i/this.ky,u=i/this.kx;return[e[0]-u,e[1]-a,e[2]+u,e[3]+a]}insideBBox(e,i){return Ys(e[0]-i[0])>=0&&Ys(e[0]-i[2])<=0&&e[1]>=i[1]&&e[1]<=i[3]}}function Bp(s,e){return s[0]===e[0]&&s[1]===e[1]}function gd(s,e,i){const a=Ys(e[0]-s[0]);return[s[0]+a*i,s[1]+(e[1]-s[1])*i]}function Ys(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class qu{constructor(e=[],i=(a,u)=>a<u?-1:a>u?1:0){if(this.data=e,this.length=this.data.length,this.compare=i,this.length>0)for(let a=(this.length>>1)-1;a>=0;a--)this._down(a)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(this.length===0)return;const e=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:i,compare:a}=this,u=i[e];for(;e>0;){const f=e-1>>1,m=i[f];if(a(u,m)>=0)break;i[e]=m,e=f}i[e]=u}_down(e){const{data:i,compare:a}=this,u=this.length>>1,f=i[e];for(;e<u;){let m=1+(e<<1);const _=m+1;if(_<this.length&&a(i[_],i[m])<0&&(m=_),a(i[m],f)>=0)break;i[e]=i[m],e=m}i[e]=f}}var gt=8192;function Fp(s,e){return e.dist-s.dist}function jp(s){const e=[1/0,1/0,-1/0,-1/0];if(e.length!==s.length)return!1;for(let i=0;i<e.length;i++)if(e[i]!==s[i])return!1;return!0}function Zu(s){return s[1]-s[0]+1}function aa(s,e){const i=s[1]>=s[0]&&s[1]<e;return i||console.warn("Distance Expression: Index is out of range"),i}function Np(s,e){if(s[0]>s[1])return[null,null];const i=Zu(s);if(e){if(i===2)return[s,null];const a=Math.floor(i/2);return[[s[0],s[0]+a],[s[0]+a,s[1]]]}{if(i===1)return[s,null];const a=Math.floor(i/2)-1;return[[s[0],s[0]+a],[s[0]+a+1,s[1]]]}}function Bl(s,e){const i=[1/0,1/0,-1/0,-1/0];if(!aa(e,s.length))return i;for(let a=e[0];a<=e[1];++a)Gu(i,s[a]);return i}function Fl(s){const e=[1/0,1/0,-1/0,-1/0];for(let i=0;i<s.length;++i)for(let a=0;a<s[i].length;++a)Gu(e,s[i][a]);return e}function ll(s,e,i){if(jp(s)||jp(e))return NaN;let a=0,u=0;return s[2]<e[0]&&(a=e[0]-s[2]),s[0]>e[2]&&(a=s[0]-e[2]),s[1]>e[3]&&(u=s[1]-e[3]),s[3]<e[1]&&(u=e[1]-s[3]),i.distance([0,0],[a,u])}function _d(s){return 360*s-180}function sy(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function yd(s,e){const i=Math.pow(2,e.z),a=(s.y/gt+e.y)/i;return[_d((s.x/gt+e.x)/i),sy(a)]}function p1(s,e){const i=[];for(let a=0;a<s.length;++a)i.push(yd(s[a],e));return i}function oy(s,e,i){const a=i.pointOnLine(e,s).point;return i.distance(s,a)}function Up(s,e,i,a,u){const f=i.slice(a[0],a[1]+1);let m=1/0;for(let _=e[0];_<=e[1];++_)if((m=Math.min(m,oy(s[_],f,u)))===0)return 0;return m}function cl(s,e,i,a,u){const f=Math.min(u.pointToSegmentDistance(s,i,a),u.pointToSegmentDistance(e,i,a)),m=Math.min(u.pointToSegmentDistance(i,s,e),u.pointToSegmentDistance(a,s,e));return Math.min(f,m)}function Ai(s,e,i,a,u){if(!aa(e,s.length)||!aa(a,i.length))return NaN;let f=1/0;for(let m=e[0];m<e[1];++m)for(let _=a[0];_<a[1];++_){if(pd(s[m],s[m+1],i[_],i[_+1]))return 0;f=Math.min(f,cl(s[m],s[m+1],i[_],i[_+1],u))}return f}function m1(s,e,i,a,u){if(!aa(e,s.length)||!aa(a,i.length))return NaN;let f=1/0;for(let m=e[0];m<=e[1];++m)for(let _=a[0];_<=a[1];++_)if((f=Math.min(f,u.distance(s[m],i[_])))===0)return f;return f}function g1(s,e,i){if(bo(s,e,!0))return 0;let a=1/0;for(const u of e){const f=u.length;if(f<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(u[0]!==u[f-1]&&(a=Math.min(a,i.pointToSegmentDistance(s,u[f-1],u[0])))===0||(a=Math.min(a,oy(s,u,i)))===0)return a}return a}function _1(s,e,i,a){if(!aa(e,s.length))return NaN;for(let f=e[0];f<=e[1];++f)if(bo(s[f],i,!0))return 0;let u=1/0;for(let f=e[0];f<e[1];++f)for(const m of i)for(let _=0,b=m.length,S=b-1;_<b;S=_++){if(pd(s[f],s[f+1],m[S],m[_]))return 0;u=Math.min(u,cl(s[f],s[f+1],m[S],m[_],a))}return u}function Vp(s,e){for(const i of s)for(let a=0;a<=i.length-1;++a)if(bo(i[a],e,!0))return!0;return!1}function y1(s,e,i,a=1/0){const u=Fl(s),f=Fl(e);if(a!==1/0&&ll(u,f,i)>=a)return a;if(Hu(u,f)){if(Vp(s,e))return 0}else if(Vp(e,s))return 0;let m=a;for(const _ of s)for(let b=0,S=_.length,I=S-1;b<S;I=b++)for(const C of e)for(let k=0,M=C.length,R=M-1;k<M;R=k++){if(pd(_[I],_[b],C[R],C[k]))return 0;m=Math.min(m,cl(_[I],_[b],C[R],C[k],i))}return m}function mr(s,e,i,a,u,f,m){if(f===null||m===null)return;const _=ll(Bl(a,f),Bl(u,m),i);_<e&&s.push({dist:_,range1:f,range2:m})}function v1(s,e,i,a,u=1/0){let f=Math.min(a.distance(s[0],i[0][0]),u);if(f===0)return f;const m=new qu([{dist:0,range1:[0,s.length-1],range2:[0,0]}],Fp),_=e?50:100,b=Fl(i);for(;m.length;){const S=m.pop();if(S.dist>=f)continue;const I=S.range1;if(Zu(I)<=_){if(!aa(I,s.length))return NaN;if(e){const C=_1(s,I,i,a);if((f=Math.min(f,C))===0)return f}else for(let C=I[0];C<=I[1];++C){const k=g1(s[C],i,a);if((f=Math.min(f,k))===0)return f}}else{const C=Np(I,e);if(C[0]!==null){const k=ll(Bl(s,C[0]),b,a);k<f&&m.push({dist:k,range1:C[0],range2:[0,0]})}if(C[1]!==null){const k=ll(Bl(s,C[1]),b,a);k<f&&m.push({dist:k,range1:C[1],range2:[0,0]})}}}return f}function ay(s,e,i,a,u,f=1/0){let m=Math.min(f,u.distance(s[0],i[0]));if(m===0)return m;const _=new qu([{dist:0,range1:[0,s.length-1],range2:[0,i.length-1]}],Fp),b=e?50:100,S=a?50:100;for(;_.length;){const I=_.pop();if(I.dist>=m)continue;const C=I.range1,k=I.range2;if(Zu(C)<=b&&Zu(k)<=S){if(!aa(C,s.length)||!aa(k,i.length))return NaN;if(e&&a?m=Math.min(m,Ai(s,C,i,k,u)):e||a?e&&!a?m=Math.min(m,Up(i,k,s,C,u)):!e&&a&&(m=Math.min(m,Up(s,C,i,k,u))):m=Math.min(m,m1(s,C,i,k,u)),m===0)return m}else{const M=Np(C,e),R=Np(k,a);mr(_,m,u,s,i,M[0],R[0]),mr(_,m,u,s,i,M[0],R[1]),mr(_,m,u,s,i,M[1],R[0]),mr(_,m,u,s,i,M[1],R[1])}}return m}function $p(s,e,i,a,u=1/0){let f=u;const m=Bl(s,[0,s.length-1]);for(const _ of i)if(!(f!==1/0&&ll(m,Bl(_,[0,_.length-1]),a)>=f)&&(f=Math.min(f,ay(s,e,_,!0,a,f)),f===0))return f;return f}function vd(s,e,i,a,u=1/0){let f=u;const m=Bl(s,[0,s.length-1]);for(const _ of i){if(f!==1/0&&ll(m,Fl(_),a)>=f)continue;const b=v1(s,e,_,a,f);if(isNaN(b))return b;if((f=Math.min(f,b))===0)return f}return f}function Gp(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class jl{constructor(e,i){this.type=Bt,this.geojson=e,this.geometries=i}static parse(e,i){if(e.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${e.length-1} instead.`);if(rl(e[1])){const a=e[1];if(a.type==="FeatureCollection"){for(let u=0;u<a.features.length;++u)if(Gp(a.features[u].geometry.type))return new jl(a,a.features[u].geometry)}else if(a.type==="Feature"){if(Gp(a.geometry.type))return new jl(a,a.geometry)}else if(Gp(a.type))return new jl(a,a)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const i=e.geometry(),a=e.canonicalID();if(i!=null&&a!=null){if(e.geometryType()==="Point")return function(u,f,m){const _=[];for(const S of u)for(const I of S)_.push(yd(I,f));const b=new Ic(_[0][1],"meters");return m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString"?ay(_,!1,m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",b):m.type==="MultiLineString"?$p(_,!1,m.coordinates,b):m.type==="Polygon"||m.type==="MultiPolygon"?vd(_,!1,m.type==="Polygon"?[m.coordinates]:m.coordinates,b):null}(i,a,this.geometries);if(e.geometryType()==="LineString")return function(u,f,m){const _=[];for(const S of u){const I=[];for(const C of S)I.push(yd(C,f));_.push(I)}const b=new Ic(_[0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return $p(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",_,b);if(m.type==="MultiLineString"){let S=1/0;for(let I=0;I<m.coordinates.length;I++){const C=$p(m.coordinates[I],!0,_,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}if(m.type==="Polygon"||m.type==="MultiPolygon"){let S=1/0;for(let I=0;I<_.length;I++){const C=vd(_[I],!0,m.type==="Polygon"?[m.coordinates]:m.coordinates,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}return null}(i,a,this.geometries);if(e.geometryType()==="Polygon")return function(u,f,m){const _=[];for(const S of function(I){const C=I.length;if(C<=1)return[I];const k=[];let M,R;for(let F=0;F<C;F++){const $=u1(I[F]);$!==0&&(I[F].area=Math.abs($),R===void 0&&(R=$<0),R===$<0?(M&&k.push(M),M=[I[F]]):M.push(I[F]))}return M&&k.push(M),k}(u)){const I=[];for(let C=0;C<S.length;++C)I.push(p1(S[C],f));_.push(I)}const b=new Ic(_[0][0][0][1],"meters");if(m.type==="Point"||m.type==="MultiPoint"||m.type==="LineString")return vd(m.type==="Point"?[m.coordinates]:m.coordinates,m.type==="LineString",_,b);if(m.type==="MultiLineString"){let S=1/0;for(let I=0;I<m.coordinates.length;I++){const C=vd(m.coordinates[I],!0,_,b,S);if(isNaN(C))return C;if((S=Math.min(S,C))===0)return S}return S}return m.type==="Polygon"||m.type==="MultiPolygon"?function(S,I,C){let k=1/0;for(const M of S)for(const R of I){const F=y1(M,R,C,k);if(isNaN(F))return F;if((k=Math.min(k,F))===0)return k}return k}(m.type==="Polygon"?[m.coordinates]:m.coordinates,_,b):null}(i,a,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Ac(s){if(s instanceof bs&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof al||s instanceof jl)return!1;if(s instanceof kc)return s.featureConstant;let e=!0;return s.eachChild(i=>{e&&!Ac(i)&&(e=!1)}),e}function Xu(s){if(s instanceof bs&&s.name==="feature-state")return!1;let e=!0;return s.eachChild(i=>{e&&!Xu(i)&&(e=!1)}),e}function Cc(s,e){if(s instanceof bs&&e.indexOf(s.name)>=0)return!1;let i=!0;return s.eachChild(a=>{i&&!Cc(a,e)&&(i=!1)}),i}function ly(s,e,i){return[s,e,i].filter(Boolean).join("")}function Hp(s,e){switch(s){case"string":return na(e);case"number":return+e;case"boolean":return!!e;case"color":return Hi.parse(e);case"formatted":return Wn.fromString(na(e));case"resolvedImage":return xs.build(na(e))}return e}function cy(s,e,i,a){return a!==void 0&&(s=a*Math.round(s/a)),e!==void 0&&s<e&&(s=e),i!==void 0&&s>i&&(s=i),s}class kc{constructor(e,i,a,u=!1){this.type=e,this.key=i,this.scope=a,this.featureConstant=u}static parse(e,i){let a=i.expectedType;if(a==null&&(a=qi),e.length<2||e.length>3)return i.error("Invalid number of arguments for 'config' expression.");const u=i.parse(e[1],1);if(!(u instanceof Ra))return i.error("Key name of 'config' expression must be a string literal.");let f,m=!0;const _=na(u.value);if(e.length>=3){const b=i.parse(e[2],2);if(!(b instanceof Ra))return i.error("Scope of 'config' expression must be a string literal.");f=na(b.value)}if(i.options){const b=ly(_,f,i._scope),S=i.options.get(b);S&&(m=Ac(S.value||S.default))}return new kc(a,_,f,m)}evaluate(e){const i=ly(this.key,this.scope,e.scope),a=e.getConfig(i);if(!a)return null;const{type:u,value:f,values:m,minValue:_,maxValue:b,stepValue:S}=a,I=a.default.evaluate(e);let C=I;if(f){const k=e.scope;e.scope=(k||"").split("").slice(1).join(""),C=f.evaluate(e),e.scope=k}return u&&(C=Hp(u,C)),C===void 0||_===void 0&&b===void 0&&S===void 0||(typeof C=="number"?C=cy(C,_,b,S):Array.isArray(C)&&(C=C.map(k=>typeof k=="number"?cy(k,_,b,S):k))),f!==void 0&&C!==void 0&&m&&!m.includes(C)&&(C=I,u&&(C=Hp(u,C))),(u&&u!==this.type||C!==void 0&&!cd(cn(C),this.type))&&(C=Hp(this.type.kind,C)),C}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class xd{constructor(e,i){this.type=i.type,this.name=e,this.boundExpression=i}static parse(e,i){if(e.length!==2||typeof e[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const a=e[1];return i.scope.has(a)?new xd(a,i.scope.get(a)):i.error(`Unknown variable "${a}". Make sure "${a}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class bd{constructor(e,i=[],a,u=new ad,f=[],m,_,b){this.registry=e,this.path=i,this.key=i.map(S=>typeof S=="string"?`['${S}']`:`[${S}]`).join(""),this.scope=u,this.errors=f,this.expectedType=a,this._scope=m,this.options=_,this.iconImageUseTheme=b}parse(e,i,a,u,f={}){return i||a?this.concat(i,null,a,u)._parse(e,f):this._parse(e,f)}parseObjectValue(e,i,a,u,f,m={}){return this.concat(i,a,u,f)._parse(e,m)}_parse(e,i){function a(u,f,m){return m==="assert"?new ri(f,[u]):m==="coerce"?new sa(f,[u]):u}if(e!==null&&typeof e!="string"&&typeof e!="boolean"&&typeof e!="number"||(e=["literal",e]),Array.isArray(e)){if(e.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=typeof e[0]=="string"?this.registry[e[0]]:void 0;if(u){let f=u.parse(e,this);if(!f)return null;if(this.expectedType){const m=this.expectedType,_=f.type;if(m.kind!=="string"&&m.kind!=="number"&&m.kind!=="boolean"&&m.kind!=="object"&&m.kind!=="array"||_.kind!=="value")if(m.kind!=="color"&&m.kind!=="formatted"&&m.kind!=="resolvedImage"||_.kind!=="value"&&_.kind!=="string"){if(this.checkSubtype(m,_))return null}else f=a(f,m,i.typeAnnotation||"coerce");else f=a(f,m,i.typeAnnotation||"assert")}if(!(f instanceof Ra)&&f.type.kind!=="resolvedImage"&&Wp(f)){const m=new Tc(this._scope,this.options,this.iconImageUseTheme);try{f=new Ra(f.type,f.evaluate(m))}catch(_){return this.error(_.message),null}}return f}return sa.parse(["to-array",e],this)}return this.error(e===void 0?"'undefined' value invalid. Use null instead.":typeof e=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,i,a,u){let f=typeof e=="number"?this.path.concat(e):this.path;f=typeof i=="string"?f.concat(i):f;const m=u?this.scope.concat(u):this.scope;return new bd(this.registry,f,a||null,m,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e,...i){const a=`${this.key}${i.map(u=>`[${u}]`).join("")}`;this.errors.push(new rs(a,e))}checkSubtype(e,i){const a=Uu(e,i);return a&&this.error(a),a}}function Wp(s){if(s instanceof xd)return Wp(s.boundExpression);if(s instanceof bs&&s.name==="error"||s instanceof oa||s instanceof al||s instanceof jl||s instanceof kc)return!1;const e=s instanceof sa||s instanceof ri;let i=!0;return s.eachChild(a=>{i=e?i&&Wp(a):i&&a instanceof Ra}),!!i&&Ac(s)&&Cc(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function wd(s,e){const i=s.length-1;let a,u,f=0,m=i,_=0;for(;f<=m;)if(_=Math.floor((f+m)/2),a=s[_],u=s[_+1],a<=e){if(_===i||e<u)return _;f=_+1}else{if(!(a>e))throw new Qr("Input is not a number.");m=_-1}return 0}class Ku{constructor(e,i,a){this.type=e,this.input=i,this.labels=[],this.outputs=[];for(const[u,f]of a)this.labels.push(u),this.outputs.push(f)}static parse(e,i){if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return i.error("Expected an even number of arguments.");const a=i.parse(e[1],1,Bt);if(!a)return null;const u=[];let f=null;i.expectedType&&i.expectedType.kind!=="value"&&(f=i.expectedType);for(let m=1;m<e.length;m+=2){const _=m===1?-1/0:e[m],b=e[m+1],S=m,I=m+1;if(typeof _!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',S);if(u.length&&u[u.length-1][0]>=_)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',S);const C=i.parse(b,I,f);if(!C)return null;f=f||C.type,u.push([_,C])}return new Ku(f,a,u)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;return u>=i[f-1]?a[f-1].evaluate(e):a[wd(i,u)].evaluate(e)}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&e.push(this.labels[i]),e.push(this.outputs[i].serialize());return e}}const uy=.95047,hy=1.08883,dy=4/29,Lc=6/29,fy=3*Lc*Lc,x1=Lc*Lc*Lc,b1=Math.PI/180,w1=180/Math.PI;function qp(s){return s>x1?Math.pow(s,1/3):s/fy+dy}function Zp(s){return s>Lc?s*s*s:fy*(s-dy)}function Xp(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function Kp(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function py(s){const e=Kp(s.r),i=Kp(s.g),a=Kp(s.b),u=qp((.4124564*e+.3575761*i+.1804375*a)/uy),f=qp((.2126729*e+.7151522*i+.072175*a)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-qp((.0193339*e+.119192*i+.9503041*a)/hy)),alpha:s.a}}function Sd(s){let e=(s.l+16)/116,i=isNaN(s.a)?e:e+s.a/500,a=isNaN(s.b)?e:e-s.b/200;return e=1*Zp(e),i=uy*Zp(i),a=hy*Zp(a),new Hi(Xp(3.2404542*i-1.5371385*e-.4985314*a),Xp(-.969266*i+1.8760108*e+.041556*a),Xp(.0556434*i-.2040259*e+1.0572252*a),s.alpha)}function Td(s,e,i){const a=e-s;return s+i*(a>180||a<-180?a-360*Math.round(a/360):a)}const Pc={forward:py,reverse:Sd,interpolate:function(s,e,i){return{l:qt(s.l,e.l,i),a:qt(s.a,e.a,i),b:qt(s.b,e.b,i),alpha:qt(s.alpha,e.alpha,i)}}},Yu={forward:function(s){const{l:e,a:i,b:a}=py(s),u=Math.atan2(a,i)*w1;return{h:u<0?u+360:u,c:Math.sqrt(i*i+a*a),l:e,alpha:s.a}},reverse:function(s){const e=s.h*b1,i=s.c;return Sd({l:s.l,a:Math.cos(e)*i,b:Math.sin(e)*i,alpha:s.alpha})},interpolate:function(s,e,i){return{h:Td(s.h,e.h,i),c:qt(s.c,e.c,i),l:qt(s.l,e.l,i),alpha:qt(s.alpha,e.alpha,i)}}};var my=Object.freeze({__proto__:null,hcl:Yu,lab:Pc});class Js{constructor(e,i,a,u,f){this.type=e,this.operator=i,this.interpolation=a,this.input=u,this.labels=[],this.outputs=[];for(const[m,_]of f)this.labels.push(m),this.outputs.push(_)}static interpolationFactor(e,i,a,u){let f=0;if(e.name==="exponential")f=Ed(i,e.base,a,u);else if(e.name==="linear")f=Ed(i,1,a,u);else if(e.name==="cubic-bezier"){const m=e.controlPoints;f=new Qa(m[0],m[1],m[2],m[3]).solve(Ed(i,1,a,u))}return f}static parse(e,i){let[a,u,f,...m]=e;if(!Array.isArray(u)||u.length===0)return i.error("Expected an interpolation type expression.",1);if(u[0]==="linear")u={name:"linear"};else if(u[0]==="exponential"){const S=u[1];if(typeof S!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:S}}else{if(u[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const S=u.slice(1);if(S.length!==4||S.some(I=>typeof I!="number"||I<0||I>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:S}}}if(e.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length-1>3&&(e.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(f=i.parse(f,2,Bt),!f)return null;const _=[];let b=null;a==="interpolate-hcl"||a==="interpolate-lab"?b=ns:i.expectedType&&i.expectedType.kind!=="value"&&(b=i.expectedType);for(let S=0;S<m.length;S+=2){const I=m[S],C=m[S+1],k=S+3,M=S+4;if(typeof I!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',k);if(_.length&&_[_.length-1][0]>=I)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',k);const R=i.parse(C,M,b);if(!R)return null;b=b||R.type,_.push([I,R])}return b.kind==="number"||b.kind==="color"||b.kind==="array"&&b.itemType.kind==="number"&&typeof b.N=="number"?new Js(b,a,u,f,_):i.error(`Type ${Vr(b)} is not interpolatable.`)}evaluate(e){const i=this.labels,a=this.outputs;if(i.length===1)return a[0].evaluate(e);const u=this.input.evaluate(e);if(u<=i[0])return a[0].evaluate(e);const f=i.length;if(u>=i[f-1])return a[f-1].evaluate(e);const m=wd(i,u),_=Js.interpolationFactor(this.interpolation,u,i[m],i[m+1]),b=a[m].evaluate(e),S=a[m+1].evaluate(e);return this.operator==="interpolate"?Ol[this.type.kind.toLowerCase()](b,S,_):this.operator==="interpolate-hcl"?Yu.reverse(Yu.interpolate(Yu.forward(b),Yu.forward(S),_)):Pc.reverse(Pc.interpolate(Pc.forward(b),Pc.forward(S),_))}eachChild(e){e(this.input);for(const i of this.outputs)e(i)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,e,this.input.serialize()];for(let a=0;a<this.labels.length;a++)i.push(this.labels[a],this.outputs[a].serialize());return i}}function Ed(s,e,i,a){const u=a-i,f=s-i;return u===0?0:e===1?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}class Ju{constructor(e,i){this.type=e,this.args=i}static parse(e,i){if(e.length<2)return i.error("Expectected at least one argument.");let a=null;const u=i.expectedType;u&&u.kind!=="value"&&(a=u);const f=[];for(const _ of e.slice(1)){const b=i.parse(_,1+f.length,a,void 0,{typeAnnotation:"omit"});if(!b)return null;a=a||b.type,f.push(b)}const m=u&&f.some(_=>Uu(u,_.type));return new Ju(m?qi:a,f)}evaluate(e){let i,a=null,u=0;for(const f of this.args){if(u++,a=f.evaluate(e),a&&a instanceof xs&&!a.available&&(i||(i=a),a=null,u===this.args.length))return i;if(a!==null)break}return a}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Oa{constructor(e,i){this.type=i.type,this.bindings=[].concat(e),this.result=i}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const i of this.bindings)e(i[1]);e(this.result)}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const a=[];for(let f=1;f<e.length-1;f+=2){const m=e[f];if(typeof m!="string")return i.error(`Expected string, but found ${typeof m} instead.`,f);if(/[^a-zA-Z0-9_]/.test(m))return i.error("Variable names must contain only alphanumeric characters or '_'.",f);const _=i.parse(e[f+1],f+1);if(!_)return null;a.push([m,_])}const u=i.parse(e[e.length-1],e.length-1,i.expectedType,a);return u?new Oa(a,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[i,a]of this.bindings)e.push(i,a.serialize());return e.push(this.result.serialize()),e}}class Id{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Bt),u=i.parse(e[2],2,Hn(i.expectedType||qi));return a&&u?new Id(u.type.itemType,a,u):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Qr("Array index out of bounds: negative index");if(i>=a.length)throw new Qr("Array index out of bounds: index exceeds array size");if(i!==Math.floor(i))throw new Qr("Array index must be an integer. Use at-interpolated for fractional indices");return a[i]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Ad{constructor(e,i,a){this.type=e,this.index=i,this.input=a}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,Bt),u=i.parse(e[2],2,Hn(i.expectedType||qi));return a&&u?new Ad(u.type.itemType,a,u):null}evaluate(e){const i=this.index.evaluate(e),a=this.input.evaluate(e);if(i<0)throw new Qr(`Array index out of bounds: ${i} < 0.`);if(i>a.length-1)throw new Qr(`Array index out of bounds: ${i} > ${a.length-1}.`);if(i===Math.floor(i))return a[i];const u=Math.floor(i),f=Math.ceil(i),m=a[u],_=a[f];if(typeof m!="number"||typeof _!="number")throw new Qr(`Cannot interpolate between non-number values at index ${i}.`);const b=i-u;return m*(1-b)+_*b}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class Yp{constructor(e,i){this.type=zi,this.needle=e,this.haystack=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qi),u=i.parse(e[2],2,qi);return a&&u?Ap(a.type,[zi,$i,Bt,ys,qi])?new Yp(a,u):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(a.type)} instead`):null}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(a==null)return!1;if(!Vu(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(cn(i))} instead.`);if(!Vu(a,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${Vr(cn(a))} instead.`);return a.indexOf(i)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Mc{constructor(e,i,a){this.type=Bt,this.needle=e,this.haystack=i,this.fromIndex=a}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qi),u=i.parse(e[2],2,qi);if(!a||!u)return null;if(!Ap(a.type,[zi,$i,Bt,ys,qi]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(a.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Bt);return f?new Mc(a,u,f):null}return new Mc(a,u)}evaluate(e){const i=this.needle.evaluate(e),a=this.haystack.evaluate(e);if(!Vu(i,["boolean","string","number","null"]))throw new Qr(`Expected first argument to be of type boolean, string, number or null, but found ${Vr(cn(i))} instead.`);if(!Vu(a,["string","array"]))throw new Qr(`Expected second argument to be of type array or string, but found ${Vr(cn(a))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return a.indexOf(i,u)}return a.indexOf(i)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Qu{constructor(e,i,a,u,f,m){this.inputType=e,this.type=i,this.input=a,this.cases=u,this.outputs=f,this.otherwise=m}static parse(e,i){if(e.length<5)return i.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return i.error("Expected an even number of arguments.");let a,u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const f={},m=[];for(let S=2;S<e.length-1;S+=2){let I=e[S];const C=e[S+1];Array.isArray(I)||(I=[I]);const k=i.concat(S);if(I.length===0)return k.error("Expected at least one branch label.");for(const R of I){if(typeof R!="number"&&typeof R!="string")return k.error("Branch labels must be numbers or strings.");if(typeof R=="number"&&Math.abs(R)>Number.MAX_SAFE_INTEGER)return k.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof R=="number"&&Math.floor(R)!==R)return k.error("Numeric branch labels must be integer values.");if(a){if(k.checkSubtype(a,cn(R)))return null}else a=cn(R);if(f[String(R)]!==void 0)return k.error("Branch labels must be unique.");f[String(R)]=m.length}const M=i.parse(C,S,u);if(!M)return null;u=u||M.type,m.push(M)}const _=i.parse(e[1],1,qi);if(!_)return null;const b=i.parse(e[e.length-1],e.length-1,u);return b?_.type.kind!=="value"&&i.concat(1).checkSubtype(a,_.type)?null:new Qu(a,u,_,f,m,b):null}evaluate(e){const i=this.input.evaluate(e);return(cd(cn(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),a=[],u={};for(const m of i){const _=u[this.cases[m]];_===void 0?(u[this.cases[m]]=a.length,a.push([this.cases[m],[m]])):a[_][1].push(m)}const f=m=>this.inputType.kind==="number"?Number(m):m;for(const[m,_]of a)e.push(_.length===1?f(_[0]):_.map(f)),e.push(this.outputs[m].serialize());return e.push(this.otherwise.serialize()),e}}class eh{constructor(e,i,a){this.type=e,this.branches=i,this.otherwise=a}static parse(e,i){if(e.length<4)return i.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return i.error("Expected an odd number of arguments.");let a;i.expectedType&&i.expectedType.kind!=="value"&&(a=i.expectedType);const u=[];for(let m=1;m<e.length-1;m+=2){const _=i.parse(e[m],m,zi);if(!_)return null;const b=i.parse(e[m+1],m+1,a);if(!b)return null;u.push([_,b]),a=a||b.type}const f=i.parse(e[e.length-1],e.length-1,a);return f?new eh(a,u,f):null}evaluate(e){for(const[i,a]of this.branches)if(i.evaluate(e))return a.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[i,a]of this.branches)e(i),e(a);e(this.otherwise)}outputDefined(){return this.branches.every(([e,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(i=>{e.push(i.serialize())}),e}}class Cd{constructor(e,i,a,u){this.type=e,this.input=i,this.beginIndex=a,this.endIndex=u}static parse(e,i){if(e.length<=2||e.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,qi),u=i.parse(e[2],2,Bt);if(!a||!u)return null;if(!Ap(a.type,[Hn(qi),$i,qi]))return i.error(`Expected first argument to be of type array or string, but found ${Vr(a.type)} instead`);if(e.length===4){const f=i.parse(e[3],3,Bt);return f?new Cd(a.type,a,u,f):null}return new Cd(a.type,a,u)}evaluate(e){const i=this.input.evaluate(e),a=this.beginIndex.evaluate(e);if(!Vu(i,["string","array"]))throw new Qr(`Expected first argument to be of type array or string, but found ${Vr(cn(i))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return i.slice(a,u)}return i.slice(a)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class Jp{constructor(e,i){this.type=Hn($i),this.str=e,this.delimiter=i}static parse(e,i){if(e.length!==3)return i.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const a=i.parse(e[1],1,$i),u=i.parse(e[2],2,$i);return a&&u?new Jp(a,u):void 0}evaluate(e){const i=this.str.evaluate(e),a=this.delimiter.evaluate(e);return i.split(a)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function Qp(s,e){return s==="=="||s==="!="?e.kind==="boolean"||e.kind==="string"||e.kind==="number"||e.kind==="null"||e.kind==="value":e.kind==="string"||e.kind==="number"||e.kind==="value"}function em(s,e,i,a){return a.compare(e,i)===0}function Rc(s,e,i){const a=s!=="=="&&s!=="!=";return class nO{constructor(f,m,_){this.type=zi,this.lhs=f,this.rhs=m,this.collator=_,this.hasUntypedArgument=f.type.kind==="value"||m.type.kind==="value"}static parse(f,m){if(f.length!==3&&f.length!==4)return m.error("Expected two or three arguments.");const _=f[0];let b=m.parse(f[1],1,qi);if(!b)return null;if(!Qp(_,b.type))return m.concat(1).error(`"${_}" comparisons are not supported for type '${Vr(b.type)}'.`);let S=m.parse(f[2],2,qi);if(!S)return null;if(!Qp(_,S.type))return m.concat(2).error(`"${_}" comparisons are not supported for type '${Vr(S.type)}'.`);if(b.type.kind!==S.type.kind&&b.type.kind!=="value"&&S.type.kind!=="value")return m.error(`Cannot compare types '${Vr(b.type)}' and '${Vr(S.type)}'.`);a&&(b.type.kind==="value"&&S.type.kind!=="value"?b=new ri(S.type,[b]):b.type.kind!=="value"&&S.type.kind==="value"&&(S=new ri(b.type,[S])));let I=null;if(f.length===4){if(b.type.kind!=="string"&&S.type.kind!=="string"&&b.type.kind!=="value"&&S.type.kind!=="value")return m.error("Cannot use collator to compare non-string types.");if(I=m.parse(f[3],3,ld),!I)return null}return new nO(b,S,I)}evaluate(f){const m=this.lhs.evaluate(f),_=this.rhs.evaluate(f);if(a&&this.hasUntypedArgument){const b=cn(m),S=cn(_);if(b.kind!==S.kind||b.kind!=="string"&&b.kind!=="number")throw new Qr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${b.kind}, ${S.kind}) instead.`)}if(this.collator&&!a&&this.hasUntypedArgument){const b=cn(m),S=cn(_);if(b.kind!=="string"||S.kind!=="string")return e(f,m,_)}return this.collator?i(f,m,_,this.collator.evaluate(f)):e(f,m,_)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[s];return this.eachChild(m=>{f.push(m.serialize())}),f}}}const S1=Rc("==",function(s,e,i){return e===i},em),T1=Rc("!=",function(s,e,i){return e!==i},function(s,e,i,a){return!em(0,e,i,a)}),gy=Rc("<",function(s,e,i){return e<i},function(s,e,i,a){return a.compare(e,i)<0}),_y=Rc(">",function(s,e,i){return e>i},function(s,e,i,a){return a.compare(e,i)>0}),kd=Rc("<=",function(s,e,i){return e<=i},function(s,e,i,a){return a.compare(e,i)<=0}),E1=Rc(">=",function(s,e,i){return e>=i},function(s,e,i,a){return a.compare(e,i)>=0});class Ld{constructor(e,i,a,u,f,m){this.type=$i,this.number=e,this.locale=i,this.currency=a,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=m}static parse(e,i){if(e.length!==3)return i.error("Expected two arguments.");const a=i.parse(e[1],1,Bt);if(!a)return null;const u=e[2];if(typeof u!="object"||Array.isArray(u))return i.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=i.parseObjectValue(u.locale,2,"locale",$i),!f))return null;let m=null;if(u.currency&&(m=i.parseObjectValue(u.currency,2,"currency",$i),!m))return null;let _=null;if(u.unit&&(_=i.parseObjectValue(u.unit,2,"unit",$i),!_))return null;let b=null;if(u["min-fraction-digits"]&&(b=i.parseObjectValue(u["min-fraction-digits"],2,"min-fraction-digits",Bt),!b))return null;let S=null;return u["max-fraction-digits"]&&(S=i.parseObjectValue(u["max-fraction-digits"],2,"max-fraction-digits",Bt),!S)?null:new Ld(a,f,m,_,b,S)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class tm{constructor(e){this.type=Bt,this.input=e}static parse(e,i){if(e.length!==2)return i.error(`Expected 1 argument, but found ${e.length-1} instead.`);const a=i.parse(e[1],1);return a?a.type.kind!=="array"&&a.type.kind!=="string"&&a.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Vr(a.type)} instead.`):new tm(a):null}evaluate(e){const i=this.input.evaluate(e);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Qr(`Expected value to be of type string or array, but found ${Vr(cn(i))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(i=>{e.push(i.serialize())}),e}}function yy(s){return function(){s=1831565813+(s|=0)|0;let e=Math.imul(s^s>>>15,1|s);return e=e+Math.imul(e^e>>>7,61|e)^e,((e^e>>>14)>>>0)/4294967296}}const Nl={"==":S1,"!=":T1,">":_y,"<":gy,">=":E1,"<=":kd,array:ri,at:Id,"at-interpolated":Ad,boolean:ri,case:eh,coalesce:Ju,collator:oa,format:Dt,image:Sc,in:Yp,"index-of":Mc,interpolate:Js,"interpolate-hcl":Js,"interpolate-lab":Js,length:tm,let:Oa,literal:Ra,match:Qu,number:ri,"number-format":Ld,object:ri,slice:Cd,step:Ku,string:ri,"to-boolean":sa,"to-color":sa,"to-number":sa,"to-string":sa,var:xd,within:al,distance:jl,config:kc,split:Jp};function im(s,[e,i,a,u]){e=e.evaluate(s),i=i.evaluate(s),a=a.evaluate(s);const f=u?u.evaluate(s):1,m=kp(e,i,a,f);if(m)throw new Qr(m);return new Hi(e/255,i/255,a/255,f)}function vy(s,[e,i,a,u]){e=e.evaluate(s),i=i.evaluate(s),a=a.evaluate(s);const f=u?u.evaluate(s):1,m=function(S,I,C,k){return typeof S=="number"&&S>=0&&S<=360?typeof I=="number"&&I>=0&&I<=100&&typeof C=="number"&&C>=0&&C<=100?k===void 0||typeof k=="number"&&k>=0&&k<=1?null:`Invalid hsla value [${[S,I,C,k].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof k=="number"?[S,I,C,k]:[S,I,C]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof k=="number"?[S,I,C,k]:[S,I,C]).join(", ")}]: 'h' must be between 0 and 360.`}(e,i,a,f);if(m)throw new Qr(m);const _=`hsla(${e}, ${i}%, ${a}%, ${f})`,b=Hi.parse(_);if(!b)throw new Qr(`Failed to parse HSLA color: ${_}`);return b}function xy(s,e){return s in e}function rm(s,e){const i=e[s];return i===void 0?null:i}function ul(s){return{type:s}}function Ul(s){if(s instanceof kc)return new Set([s.key]);let e=new Set;return s.eachChild(i=>{e=new Set([...e,...Ul(i)])}),e}function Pd(s){if(s instanceof bs&&s.name==="is-active-floor")return!0;let e=!1;return s.eachChild(i=>{!e&&Pd(i)&&(e=!0)}),e}function by(s){return{result:"success",value:s}}function hl(s){return{result:"error",value:s}}function nm(s,e){return!!s&&!!s.parameters&&s.parameters.indexOf(e)>-1}function Md(s){return s["property-type"]==="data-driven"}function sm(s){return nm(s.expression,"measure-light")}function wy(s){return nm(s.expression,"zoom")}function om(s){return!!s.expression&&s.expression.interpolated}function Rd(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Sy(s){return s}function am(s,e){const i=e.type==="color",a=s.stops&&typeof s.stops[0][0]=="object",u=a||!(a||s.property!==void 0),f=s.type||(om(e)?"exponential":"interval");if(i&&((s=Object.assign({},s)).stops&&(s.stops=s.stops.map(S=>[S[0],Hi.parse(S[1])])),s.default=Hi.parse(s.default?s.default:e.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!my[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let m,_,b;if(f==="exponential")m=Ty;else if(f==="interval")m=I1;else if(f==="categorical"){m=Dc,_=Object.create(null);for(const S of s.stops)_[S[0]]=S[1];b=typeof s.stops[0][0]}else{if(f!=="identity")throw new Error(`Unknown function type "${f}"`);m=A1}if(a){const S={},I=[];for(let M=0;M<s.stops.length;M++){const R=s.stops[M],F=R[0].zoom;S[F]===void 0&&(S[F]={zoom:F,type:s.type,property:s.property,default:s.default,stops:[]},I.push(F)),S[F].stops.push([R[0].value,R[1]])}const C=[];for(const M of I)C.push([S[M].zoom,am(S[M],e)]);const k={name:"linear"};return{kind:"composite",interpolationType:k,interpolationFactor:Js.interpolationFactor.bind(void 0,k),zoomStops:C.map(M=>M[0]),evaluate:({zoom:M},R)=>Ty({stops:C,base:s.base},e,M).evaluate(M,R)}}if(u){const S=f==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:Js.interpolationFactor.bind(void 0,S),zoomStops:s.stops.map(I=>I[0]),evaluate:({zoom:I})=>m(s,e,I,_,b)}}return{kind:"source",evaluate(S,I){const C=I&&I.properties?I.properties[s.property]:void 0;return C===void 0?th(s.default,e.default):m(s,e,C,_,b)}}}function th(s,e,i){return s!==void 0?s:e!==void 0?e:i!==void 0?i:void 0}function Dc(s,e,i,a,u){return th(typeof i===u?a[i]:void 0,s.default,e.default)}function I1(s,e,i){if(!Zt(i))return th(s.default,e.default);const a=s.stops.length;if(a===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[a-1][0])return s.stops[a-1][1];const u=wd(s.stops.map(f=>f[0]),i);return s.stops[u][1]}function Ty(s,e,i){const a=s.base!==void 0?s.base:1;if(!Zt(i))return th(s.default,e.default);const u=s.stops.length;if(u===1||i<=s.stops[0][0])return s.stops[0][1];if(i>=s.stops[u-1][0])return s.stops[u-1][1];const f=wd(s.stops.map(I=>I[0]),i),m=function(I,C,k,M){const R=M-k,F=I-k;return R===0?0:C===1?F/R:(Math.pow(C,F)-1)/(Math.pow(C,R)-1)}(i,a,s.stops[f][0],s.stops[f+1][0]),_=s.stops[f][1],b=s.stops[f+1][1];let S=Ol[e.type]||Sy;if(s.colorSpace&&s.colorSpace!=="rgb"){const I=my[s.colorSpace];S=(C,k)=>I.reverse(I.interpolate(I.forward(C),I.forward(k),m))}return typeof _.evaluate=="function"?{evaluate(...I){const C=_.evaluate.apply(void 0,I),k=b.evaluate.apply(void 0,I);if(C!==void 0&&k!==void 0)return S(C,k,m)}}:S(_,b,m)}function A1(s,e,i){return e.type==="color"?i=Hi.parse(i):e.type==="formatted"?i=Wn.fromString(i.toString()):e.type==="resolvedImage"?i=xs.build(i.toString()):Yt(i)===e.type||e.type==="enum"&&e.values[i]||(i=void 0),th(i,s.default,e.default)}bs.register(Nl,{error:[{kind:"error"},[$i],(s,[e])=>{throw new Qr(e.evaluate(s))}],typeof:[$i,[qi],(s,[e])=>Vr(cn(e.evaluate(s)))],"to-rgba":[Hn(Bt,4),[ns],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Hn(Bt,4),[ns],(s,[e])=>e.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ns,[Bt,Bt,Bt],im],rgba:[ns,[Bt,Bt,Bt,Bt],im],hsl:[ns,[Bt,Bt,Bt],vy],hsla:[ns,[Bt,Bt,Bt,Bt],vy],has:{type:zi,overloads:[[[$i],(s,[e])=>xy(e.evaluate(s),s.properties())],[[$i,bc],(s,[e,i])=>xy(e.evaluate(s),i.evaluate(s))]]},get:{type:qi,overloads:[[[$i],(s,[e])=>rm(e.evaluate(s),s.properties())],[[$i,bc],(s,[e,i])=>rm(e.evaluate(s),i.evaluate(s))]]},"feature-state":[qi,[$i],(s,[e])=>rm(e.evaluate(s),s.featureState||{})],properties:[bc,[],s=>s.properties()],"geometry-type":[$i,[],s=>s.geometryType()],worldview:[$i,[],s=>s.globals.worldview||""],"is-active-floor":[zi,ul($i),(s,e)=>{if(!(s.globals.activeFloors&&s.globals.activeFloors.size>0))return!1;const i=s.globals.activeFloors;return e.some(a=>{const u=a.evaluate(s);return i.has(u)})}],id:[qi,[],s=>s.id()],zoom:[Bt,[],s=>s.globals.zoom],pitch:[Bt,[],s=>s.globals.pitch||0],"distance-from-center":[Bt,[],s=>s.distanceFromCenter()],"measure-light":[Bt,[$i],(s,[e])=>s.measureLight(e.evaluate(s))],"heatmap-density":[Bt,[],s=>s.globals.heatmapDensity||0],"line-progress":[Bt,[],s=>s.globals.lineProgress||0],"raster-value":[Bt,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[Bt,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[Bt,[],s=>s.globals.skyRadialProgress||0],accumulated:[qi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[Bt,ul(Bt),(s,e)=>{let i=0;for(const a of e)i+=a.evaluate(s);return i}],"*":[Bt,ul(Bt),(s,e)=>{let i=1;for(const a of e)i*=a.evaluate(s);return i}],"-":{type:Bt,overloads:[[[Bt,Bt],(s,[e,i])=>e.evaluate(s)-i.evaluate(s)],[[Bt],(s,[e])=>-e.evaluate(s)]]},"/":[Bt,[Bt,Bt],(s,[e,i])=>e.evaluate(s)/i.evaluate(s)],"%":[Bt,[Bt,Bt],(s,[e,i])=>e.evaluate(s)%i.evaluate(s)],ln2:[Bt,[],()=>Math.LN2],pi:[Bt,[],()=>Math.PI],e:[Bt,[],()=>Math.E],"^":[Bt,[Bt,Bt],(s,[e,i])=>Math.pow(e.evaluate(s),i.evaluate(s))],sqrt:[Bt,[Bt],(s,[e])=>Math.sqrt(e.evaluate(s))],log10:[Bt,[Bt],(s,[e])=>Math.log(e.evaluate(s))/Math.LN10],ln:[Bt,[Bt],(s,[e])=>Math.log(e.evaluate(s))],log2:[Bt,[Bt],(s,[e])=>Math.log2(e.evaluate(s))],sin:[Bt,[Bt],(s,[e])=>Math.sin(e.evaluate(s))],cos:[Bt,[Bt],(s,[e])=>Math.cos(e.evaluate(s))],tan:[Bt,[Bt],(s,[e])=>Math.tan(e.evaluate(s))],asin:[Bt,[Bt],(s,[e])=>Math.asin(e.evaluate(s))],acos:[Bt,[Bt],(s,[e])=>Math.acos(e.evaluate(s))],atan:[Bt,[Bt],(s,[e])=>Math.atan(e.evaluate(s))],min:[Bt,ul(Bt),(s,e)=>Math.min(...e.map(i=>i.evaluate(s)))],max:[Bt,ul(Bt),(s,e)=>Math.max(...e.map(i=>i.evaluate(s)))],abs:[Bt,[Bt],(s,[e])=>Math.abs(e.evaluate(s))],round:[Bt,[Bt],(s,[e])=>{const i=e.evaluate(s);return i<0?-Math.round(-i):Math.round(i)}],floor:[Bt,[Bt],(s,[e])=>Math.floor(e.evaluate(s))],ceil:[Bt,[Bt],(s,[e])=>Math.ceil(e.evaluate(s))],"filter-==":[zi,[$i,qi],(s,[e,i])=>s.properties()[e.value]===i.value],"filter-id-==":[zi,[qi],(s,[e])=>s.id()===e.value],"filter-type-==":[zi,[$i],(s,[e])=>s.geometryType()===e.value],"filter-<":[zi,[$i,qi],(s,[e,i])=>{const a=s.properties()[e.value],u=i.value;return typeof a==typeof u&&a<u}],"filter-id-<":[zi,[qi],(s,[e])=>{const i=s.id(),a=e.value;return typeof i==typeof a&&i<a}],"filter->":[zi,[$i,qi],(s,[e,i])=>{const a=s.properties()[e.value],u=i.value;return typeof a==typeof u&&a>u}],"filter-id->":[zi,[qi],(s,[e])=>{const i=s.id(),a=e.value;return typeof i==typeof a&&i>a}],"filter-<=":[zi,[$i,qi],(s,[e,i])=>{const a=s.properties()[e.value],u=i.value;return typeof a==typeof u&&a<=u}],"filter-id-<=":[zi,[qi],(s,[e])=>{const i=s.id(),a=e.value;return typeof i==typeof a&&i<=a}],"filter->=":[zi,[$i,qi],(s,[e,i])=>{const a=s.properties()[e.value],u=i.value;return typeof a==typeof u&&a>=u}],"filter-id->=":[zi,[qi],(s,[e])=>{const i=s.id(),a=e.value;return typeof i==typeof a&&i>=a}],"filter-has":[zi,[qi],(s,[e])=>e.value in s.properties()],"filter-has-id":[zi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[zi,[Hn($i)],(s,[e])=>e.value.indexOf(s.geometryType())>=0],"filter-id-in":[zi,[Hn(qi)],(s,[e])=>e.value.indexOf(s.id())>=0],"filter-in-small":[zi,[$i,Hn(qi)],(s,[e,i])=>i.value.indexOf(s.properties()[e.value])>=0],"filter-in-large":[zi,[$i,Hn(qi)],(s,[e,i])=>function(a,u,f,m){for(;f<=m;){const _=f+m>>1;if(u[_]===a)return!0;u[_]>a?m=_-1:f=_+1}return!1}(s.properties()[e.value],i.value,0,i.value.length-1)],all:{type:zi,overloads:[[[zi,zi],(s,[e,i])=>e.evaluate(s)&&i.evaluate(s)],[ul(zi),(s,e)=>{for(const i of e)if(!i.evaluate(s))return!1;return!0}]]},any:{type:zi,overloads:[[[zi,zi],(s,[e,i])=>e.evaluate(s)||i.evaluate(s)],[ul(zi),(s,e)=>{for(const i of e)if(i.evaluate(s))return!0;return!1}]]},"!":[zi,[zi],(s,[e])=>!e.evaluate(s)],"is-supported-script":[zi,[$i],(s,[e])=>{const i=s.globals&&s.globals.isSupportedScript;return!i||i(e.evaluate(s))}],upcase:[$i,[$i],(s,[e])=>e.evaluate(s).toUpperCase()],downcase:[$i,[$i],(s,[e])=>e.evaluate(s).toLowerCase()],concat:[$i,ul(qi),(s,e)=>e.map(i=>na(i.evaluate(s))).join("")],"resolved-locale":[$i,[ld],(s,[e])=>e.evaluate(s).resolvedLocale()],random:[Bt,[Bt,Bt,qi],(s,e)=>{const[i,a,u]=e.map(m=>m.evaluate(s));if(i>a||i===a)return i;let f;if(typeof u=="string")f=function(m){let _=0;if(m.length===0)return _;for(let b=0;b<m.length;b++)_=(_<<5)-_+m.charCodeAt(b),_&=_;return _}(u);else{if(typeof u!="number")throw new Qr(`Invalid seed input: ${u}`);f=u}return i+yy(f)()*(a-i)}]});class Dd{constructor(e,i,a,u,f){this.expression=e,this._warningHistory={},this._scope=a,this._options=u,this._iconImageUseTheme=f,this._evaluator=new Tc(a,u,f),this._defaultValue=i?function(m){return m.type==="color"&&(Rd(m.default)||Array.isArray(m.default))?new Hi(0,0,0,0):m.type==="color"?Hi.parse(m.default)||null:m.default===void 0?null:m.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=Ul(e),this.isIndoorDependent=Pd(e)}evaluateWithoutErrorHandling(e,i,a,u,f,m,_,b){return this._evaluator.globals=e,this._evaluator.feature=i,this._evaluator.featureState=a,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=b||null,this.expression.evaluate(this._evaluator)}evaluate(e,i,a,u,f,m,_,b,S){this._evaluator||(this._evaluator=new Tc(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=i||null,this._evaluator.featureState=a||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=m||null,this._evaluator.featureTileCoord=_||null,this._evaluator.featureDistanceData=b||null,this._evaluator.iconImageUseTheme=S||null;try{const I=this.expression.evaluate(this._evaluator);if(I==null||typeof I=="number"&&I!=I)return this._defaultValue;if(this._enumValues&&!(I in this._enumValues))throw new Qr(`Expected value to be one of ${Object.keys(this._enumValues).map(C=>JSON.stringify(C)).join(", ")}, but found ${JSON.stringify(I)} instead.`);return I}catch(I){const C=I;return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${C.message}`)),this._defaultValue}}}function ih(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Nl}function dl(s,e,i,a,u){const f=new bd(Nl,[],e?function(_){const b={color:ns,string:$i,number:Bt,enum:$i,boolean:zi,formatted:wc,resolvedImage:zl};return _.type==="array"?Hn(b[_.value]||qi,_.length):b[_.type]}(e):void 0,void 0,void 0,i,a,u),m=f.parse(s,void 0,void 0,void 0,e&&e.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?by(new Dd(m,e,i,a,u)):hl(f.errors)}class rh{constructor(e,i,a,u){this.kind=e,this._styleExpression=i,this.isLightConstant=a,this.isLineProgressConstant=u,this.isStateDependent=e!=="constant"&&!Xu(i.expression),this.configDependencies=Ul(i.expression),this.isIndoorDependent=Pd(i.expression)}evaluateWithoutErrorHandling(e,i,a,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,m)}evaluate(e,i,a,u,f,m,_){return this._styleExpression.evaluate(e,i,a,u,f,m,void 0,void 0,_)}}class Vl{constructor(e,i,a,u,f,m){this.kind=e,this.zoomStops=a,this._styleExpression=i,this.isStateDependent=e!=="camera"&&!Xu(i.expression),this.isIndoorDependent=Pd(i.expression),this.isLightConstant=f,this.isLineProgressConstant=m,this.configDependencies=Ul(i.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,i,a,u,f,m){return this._styleExpression.evaluateWithoutErrorHandling(e,i,a,u,f,m)}evaluate(e,i,a,u,f,m){return this._styleExpression.evaluate(e,i,a,u,f,m)}interpolationFactor(e,i,a){return this.interpolationType?Js.interpolationFactor(this.interpolationType,e,i,a):0}}function Od(s,e,i,a,u){if((s=dl(s,e,i,a,u)).result==="error")return s;const f=s.value.expression,m=Ac(f);if(!m&&!Md(e))return hl([new rs("","data expressions not supported")]);const _=Cc(f,["zoom","pitch","distance-from-center"]);if(!_&&!wy(e))return hl([new rs("","zoom expressions not supported")]);const b=Cc(f,["measure-light"]);if(!b&&!sm(e))return hl([new rs("","measure-light expression not supported")]);const S=Cc(f,["line-progress"]);if(!S&&!function(k){return nm(k.expression,"line-progress")}(e))return hl([new rs("","line-progress expression not supported")]);const I=e.expression&&e.expression.relaxZoomRestriction,C=zd(f);return C||_||I?C instanceof rs?hl([C]):C instanceof Js&&!om(e)?hl([new rs("",'"interpolate" expressions cannot be used with this property')]):by(C?new Vl(m&&S?"camera":"composite",s.value,C.labels,C instanceof Js?C.interpolation:void 0,b,S):new rh(m&&S?"constant":"source",s.value,b,S)):hl([new rs("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class nh{constructor(e,i){this._parameters=e,this._specification=i,Object.assign(this,am(this._parameters,this._specification))}static deserialize(e){return new nh(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function zd(s){let e=null;if(s instanceof Oa)e=zd(s.result);else if(s instanceof Ju){for(const i of s.args)if(e=zd(i),e)break}else(s instanceof Ku||s instanceof Js)&&s.input instanceof bs&&s.input.name==="zoom"&&(e=s);return e instanceof rs||s.eachChild(i=>{const a=zd(i);a instanceof rs?e=a:e&&a&&e!==a&&(e=new rs("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}var la,Ey,C1=function(){if(Ey)return la;Ey=1,la=e;var s=3;function e(i,a,u){var f=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var m=new Int32Array(this.arrayBuffer);i=m[0],this.d=(a=m[1])+2*(u=m[2]);for(var _=0;_<this.d*this.d;_++){var b=m[s+_],S=m[s+_+1];f.push(b===S?null:m.subarray(b,S))}var I=m[s+f.length+1];this.keys=m.subarray(m[s+f.length],I),this.bboxes=m.subarray(I),this.insert=this._insertReadonly}else{this.d=a+2*u;for(var C=0;C<this.d*this.d;C++)f.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=i,this.padding=u,this.scale=a/i,this.uid=0;var k=u/a*i;this.min=-k,this.max=i+k}return e.prototype.insert=function(i,a,u,f,m){this._forEachCell(a,u,f,m,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(a),this.bboxes.push(u),this.bboxes.push(f),this.bboxes.push(m)},e.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},e.prototype._insertCell=function(i,a,u,f,m,_){this.cells[m].push(_)},e.prototype.query=function(i,a,u,f,m){var _=this.min,b=this.max;if(i<=_&&a<=_&&b<=u&&b<=f&&!m)return Array.prototype.slice.call(this.keys);var S=[];return this._forEachCell(i,a,u,f,this._queryCell,S,{},m),S},e.prototype._queryCell=function(i,a,u,f,m,_,b,S){var I=this.cells[m];if(I!==null)for(var C=this.keys,k=this.bboxes,M=0;M<I.length;M++){var R=I[M];if(b[R]===void 0){var F=4*R;(S?S(k[F+0],k[F+1],k[F+2],k[F+3]):i<=k[F+2]&&a<=k[F+3]&&u>=k[F+0]&&f>=k[F+1])?(b[R]=!0,_.push(C[R])):b[R]=!1}}},e.prototype._forEachCell=function(i,a,u,f,m,_,b,S){for(var I=this._convertToCellCoord(i),C=this._convertToCellCoord(a),k=this._convertToCellCoord(u),M=this._convertToCellCoord(f),R=I;R<=k;R++)for(var F=C;F<=M;F++){var $=this.d*F+R;if((!S||S(this._convertFromCellCoord(R),this._convertFromCellCoord(F),this._convertFromCellCoord(R+1),this._convertFromCellCoord(F+1)))&&m.call(this,i,a,u,f,$,_,b,S))return}},e.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},e.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},e.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,a=s+this.cells.length+1+1,u=0,f=0;f<this.cells.length;f++)u+=this.cells[f].length;var m=new Int32Array(a+u+this.keys.length+this.bboxes.length);m[0]=this.extent,m[1]=this.n,m[2]=this.padding;for(var _=a,b=0;b<i.length;b++){var S=i[b];m[s+b]=_,m.set(S,_),_+=S.length}return m[s+i.length]=_,m.set(this.keys,_),m[s+i.length+1]=_+=this.keys.length,m.set(this.bboxes,_),_+=this.bboxes.length,m.buffer},la}(),$l=Bn(C1);const Bd={};function Ct(s,e,i={}){Object.defineProperty(s,"_classRegistryKey",{value:e,writable:!1}),Bd[e]={klass:s,omit:i.omit||[]}}Ct(Object,"Object"),$l.serialize=function(s,e){const i=s.toArrayBuffer();return e&&e.add(i),{buffer:i}},$l.deserialize=function(s){return new $l(s.buffer)},Object.defineProperty($l,"name",{value:"Grid"}),Ct($l,"Grid"),delete at.prototype.constructor,Ct(Hi,"Color"),Ct(Error,"Error"),Ct(Wn,"Formatted"),Ct(ud,"FormattedSection"),Ct(Ou,"AJAXError"),Ct(xs,"ResolvedImage"),Ct(nh,"StylePropertyFunction"),Ct(Dd,"StyleExpression",{omit:["_evaluator"]}),Ct(_s,"ImageId"),Ct(vs,"ImageVariant"),Ct(Vl,"ZoomDependentExpression"),Ct(rh,"ZoomConstantExpression"),Ct(bs,"CompoundExpression",{omit:["_evaluate"]});for(const s in Nl)Bd[Nl[s]._classRegistryKey]||Ct(Nl[s],`Expression${s}`);function lm(s){return s&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Fo(s,e){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(lm(s)||s instanceof ImageBitmap)return e&&e.add(s),s;if(ArrayBuffer.isView(s))return e&&e.add(s.buffer),s;if(s instanceof ImageData)return e&&e.add(s.data.buffer),s;if(Array.isArray(s)){const i=[];for(const a of s)i.push(Fo(a,e));return i}if(s instanceof Map){const i={$name:"Map",entries:[]};for(const[a,u]of s.entries())i.entries.push(Fo(a),Fo(u,e));return i}if(s instanceof Set){const i={$name:"Set"};let a=0;for(const u of s.values())i[++a]=Fo(u);return i}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const i=s.constructor,a=i._classRegistryKey;if(!a)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const u=i.serialize?i.serialize(s,e):{};if(!i.serialize){for(const f in s)s.hasOwnProperty(f)&&(Bd[a].omit.indexOf(f)>=0||(u[f]=Fo(s[f],e)));s instanceof Error&&(u.message=s.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return a!=="Object"&&(u.$name=a),u}throw new Error("can't serialize object of type "+typeof s)}function za(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||lm(s)||s instanceof ImageBitmap||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(za);if(typeof s=="object"){const e=s.$name||"Object";if(e==="Map"){const u=s.entries||[],f=new Map;for(let m=0;m<u.length;m+=2)f.set(za(u[m]),za(u[m+1]));return f}if(e==="Set"){const u=new Set;for(const f of Object.keys(s))f!=="$name"&&u.add(za(s[f]));return u}if(e==="BigInt")return BigInt(s.value);const{klass:i}=Bd[e];if(!i)throw new Error(`Can't deserialize unregistered class "${e}".`);if(i.deserialize)return i.deserialize(s);const a=Object.create(i.prototype);for(const u of Object.keys(s))u!=="$name"&&(a[u]=za(s[u]));return a}throw new Error("can't deserialize object of type "+typeof s)}const Iy=s=>s>=1536&&s<=1791,Ay=s=>s>=1872&&s<=1919,Fd=s=>s>=2208&&s<=2303,jd=s=>s>=11904&&s<=12031,cm=s=>s>=12032&&s<=12255,um=s=>s>=12272&&s<=12287,Oc=s=>s>=12288&&s<=12351,zc=s=>s>=12352&&s<=12447,sh=s=>s>=12448&&s<=12543,ca=s=>s>=12544&&s<=12591,Cy=s=>s>=12704&&s<=12735,ky=s=>s>=12736&&s<=12783,Ly=s=>s>=12784&&s<=12799,Py=s=>s>=12800&&s<=13055,hm=s=>s>=13056&&s<=13311,Bc=s=>s>=13312&&s<=19903,Nd=s=>s>=19968&&s<=40959,dm=s=>s>=40960&&s<=42127,Ud=s=>s>=42128&&s<=42191,My=s=>s>=44032&&s<=55215,Ry=s=>s>=63744&&s<=64255,fm=s=>s>=64336&&s<=65023,Dy=s=>s>=65040&&s<=65055,pm=s=>s>=65072&&s<=65103,Oy=s=>s>=65104&&s<=65135,mm=s=>s>=65136&&s<=65279,gm=s=>s>=65280&&s<=65519;function _m(s){for(const e of s)if(fl(e.charCodeAt(0)))return!0;return!1}function k1(s){for(const e of s)if(!L1(e.charCodeAt(0)))return!1;return!0}function L1(s){return!(Iy(s)||Ay(s)||Fd(s)||fm(s)||mm(s))}function zy(s){return!(s<11904||!(Cy(s)||ca(s)||pm(s)||Ry(s)||hm(s)||jd(s)||ky(s)||Oc(s)||Bc(s)||Nd(s)||Py(s)||gm(s)||zc(s)||um(s)||cm(s)||Ly(s)||sh(s)||Dy(s)||Ud(s)||dm(s)))}function fl(s){return!(s!==746&&s!==747&&(s<4352||!(Cy(s)||ca(s)||pm(s)&&!(s>=65097&&s<=65103)||Ry(s)||hm(s)||jd(s)||ky(s)||!(!Oc(s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||Bc(s)||Nd(s)||Py(s)||(e=>e>=12592&&e<=12687)(s)||(e=>e>=43360&&e<=43391)(s)||(e=>e>=55216&&e<=55295)(s)||(e=>e>=4352&&e<=4607)(s)||My(s)||zc(s)||um(s)||(e=>e>=12688&&e<=12703)(s)||cm(s)||Ly(s)||sh(s)&&s!==12540||!(!gm(s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!Oy(s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||(e=>e>=5120&&e<=5759)(s)||(e=>e>=6320&&e<=6399)(s)||Dy(s)||(e=>e>=19904&&e<=19967)(s)||dm(s)||Ud(s))))}function By(s){return s===12312||s===12313||s===12316||s===12540||s===12448}function ym(s){return!(fl(s)||function(e){return!!((i=>i>=128&&i<=255)(e)&&(e===167||e===169||e===174||e===177||e===188||e===189||e===190||e===215||e===247)||(i=>i>=8192&&i<=8303)(e)&&(e===8214||e===8224||e===8225||e===8240||e===8241||e===8251||e===8252||e===8258||e===8263||e===8264||e===8265||e===8273)||(i=>i>=8448&&i<=8527)(e)||(i=>i>=8528&&i<=8591)(e)||(i=>i>=8960&&i<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||e===9003||e>=9085&&e<=9114||e>=9150&&e<=9165||e===9167||e>=9169&&e<=9179||e>=9186&&e<=9215)||(i=>i>=9216&&i<=9279)(e)&&e!==9251||(i=>i>=9280&&i<=9311)(e)||(i=>i>=9312&&i<=9471)(e)||(i=>i>=9632&&i<=9727)(e)||(i=>i>=9728&&i<=9983)(e)&&!(e>=9754&&e<=9759)||(i=>i>=11008&&i<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oc(e)||sh(e)||(i=>i>=57344&&i<=63743)(e)||pm(e)||Oy(e)||gm(e)||e===8734||e===8756||e===8757||e>=9984&&e<=10087||e>=10102&&e<=10131||e===65532||e===65533)}(s))}function Vd(s){return Iy(s)||Ay(s)||Fd(s)||fm(s)||mm(s)}function Fy(s){return s>=1424&&s<=2303||fm(s)||mm(s)}function P1(s,e){return!(!e&&Fy(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||(i=>i>=6016&&i<=6143)(s))}function pl(s){for(const e of s)if(Fy(e.charCodeAt(0)))return!0;return!1}const ws={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let ml=null,ss=ws.unavailable,gl=null;const jy=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(ss=ws.error),ml&&ml(s)};function vm(){xm.fire(new Pa("pluginStateChange",{pluginStatus:ss,pluginURL:gl}))}const xm=new Ma,bm=function(){return ss},wm=function(){if(ss!==ws.deferred||!gl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ss=ws.loading,vm(),gl&&Bu({url:gl},s=>{s?jy(s):(ss=ws.loaded,vm())})},jo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>ss===ws.loaded||jo.applyArabicShaping!=null,isLoading:()=>ss===ws.loading,setState(s){ss=s.pluginStatus,gl=s.pluginURL},isParsing:()=>ss===ws.parsing,isParsed:()=>ss===ws.parsed,getPluginURL:()=>gl};class Yi{constructor(e,i){this.zoom=e,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview,this.activeFloors=i.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(i,a){for(const u of i)if(!P1(u.charCodeAt(0),a))return!1;return!0}(e,jo.isLoaded())}}class oh{constructor(e,i,a,u,f){this.property=e,this.value=i,this.expression=function(m,_,b,S,I){if(Rd(m))return new nh(m,_);if(ih(m)||Array.isArray(m)&&m.length>0){const C=Od(m,_,b,S,I);if(C.result==="error")throw new Error(C.value.map(k=>`${k.key}: ${k.message}`).join(", "));return C.value}{let C=m;return typeof m=="string"&&_.type==="color"&&(C=Hi.parse(m)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>C}}}(i===void 0?e.specification.default:i,e.specification,a,u,f)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(e,i,a,u){return this.property.possiblyEvaluate(this,e,i,a,u)}}class ah{constructor(e,i,a,u){this.property=e,this.value=new oh(e,void 0,i,a,u)}transitioned(e,i){return new Ny(this.property,this.value,i,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Ny(this.property,this.value,null,{},0)}}class Fc{constructor(e,i,a,u){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return oi(this._values[e].value.value)}setValue(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ah(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new oh(this._values[e].property,i===null?void 0:oi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,i){i&&(this._options=i);const a=this._properties.properties;if(e)for(const u in e){const f=e[u];if(u.endsWith("-transition")){const m=u.slice(0,-11);a[m]&&this.setTransition(m,f)}else a.hasOwnProperty(u)&&this.setValue(u,f)}}getTransition(e){return oi(this._values[e].transition)}setTransition(e,i){this._values.hasOwnProperty(e)||(this._values[e]=new ah(this._values[e].property)),this._values[e].transition=oi(i)||void 0}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a);const u=this.getTransition(i);u!==void 0&&(e[`${i}-transition`]=u)}return e}transitioned(e,i){const a=new Uy(this._properties);for(const u of Object.keys(this._values))a._values[u]=this._values[u].transitioned(e,i._values[u]);return a}untransitioned(){const e=new Uy(this._properties);for(const i of Object.keys(this._values))e._values[i]=this._values[i].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Ny{constructor(e,i,a,u,f){const m=u.delay||0,_=u.duration||0;f=f||0,this.property=e,this.value=i,this.begin=f+m,this.end=this.begin+_,e.specification.transition&&(u.delay||u.duration)&&(this.prior=a)}possiblyEvaluate(e,i,a){const u=e.now||0,f=this.value.possiblyEvaluate(e,i,a),m=this.prior;if(m){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return m.possiblyEvaluate(e,i,a);{const _=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(m.possiblyEvaluate(e,i,a),f,ee(_))}}return f}}class Uy{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,i,a){const u=new os(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,i,a);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class Sm{constructor(e,i,a,u){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=i,this._options=a,this._iconImageUseTheme=u,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return oi(this._values[e].value)}setValue(e,i){this._values[e]=new oh(this._values[e].property,i===null?void 0:oi(i),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const i of Object.keys(this._values)){const a=this.getValue(i);a!==void 0&&(e[i]=a)}return e}possiblyEvaluate(e,i,a,u){const f=new os(this._properties);for(const m of Object.keys(this._values))f._values[m]=this._values[m].possiblyEvaluate(e,i,a,u);return f}isIndoorDependent(){return this._isIndoorDependent}}class Gl{constructor(e,i,a,u){this.property=e,this.value=i,this.parameters=a,this.iconImageUseTheme=u}isConstant(){return this.value.kind==="constant"}constantOr(e){return this.value.kind==="constant"?this.value.value:e}evaluate(e,i,a,u){return this.property.evaluate(this.value,this.parameters,e,i,a,u,this.iconImageUseTheme)}}class os{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class ft{constructor(e){this.specification=e}possiblyEvaluate(e,i){return e.expression.evaluate(i)}interpolate(e,i,a){const u=Ol[this.specification.type];return u?u(e,i,a):e}}class vt{constructor(e,i){this.specification=e,this.overrides=i}possiblyEvaluate(e,i,a,u,f){return e.expression.kind==="constant"||e.expression.kind==="camera"?new Gl(this,{kind:"constant",value:e.expression.evaluate(i,null,{},a,u,void 0,f)},i):new Gl(this,e.expression,i,f)}interpolate(e,i,a){if(e.value.kind!=="constant"||i.value.kind!=="constant")return e;if(e.value.value===void 0||i.value.value===void 0)return new Gl(this,{kind:"constant",value:void 0},e.parameters);const u=Ol[this.specification.type];return u?new Gl(this,{kind:"constant",value:u(e.value.value,i.value.value,a)},e.parameters):e}evaluate(e,i,a,u,f,m,_){return e.kind==="constant"?e.value:e.evaluate(i,a,u,f,m,void 0,_)}}class jc{constructor(e){this.specification=e}possiblyEvaluate(e,i,a,u){return!!e.expression.evaluate(i,null,{},a,u)}interpolate(){return!1}}class Cr{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Yi(0,{});for(const a in e){const u=e[a];u.specification.overridable&&this.overridableProperties.push(a);const f=this.defaultPropertyValues[a]=new oh(u,void 0),m=this.defaultTransitionablePropertyValues[a]=new ah(u);this.defaultTransitioningPropertyValues[a]=m.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=f.possiblyEvaluate(i)}}}Ct(vt,"DataDrivenProperty"),Ct(ft,"DataConstantProperty"),Ct(jc,"ColorRampProperty");var ze=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"shadow-draw-before-layer":{"type":"string"}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"url":{"type":"string"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"model-allow-density-reduction":{"type":"boolean","default":true}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Vy(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function $d(s){if(Array.isArray(s))return s.map($d);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const e={};for(const i in s)e[i]=$d(s[i]);return e}return Vy(s)}function Tm(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const e of s.slice(1))if(!Tm(e)&&typeof e!="boolean")return!1;return!0;default:return!0}}function Em(s,e="",i=null,a="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tm(s)||(s=lh(s));const u=s;let f=!0;try{f=function(I){if(!Nc(I))return I;let C=$d(I);return Im(C),C=$y(C),C}(u)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(u,null,2)}
        `)}let m=null,_=null;if(a!=="background"&&a!=="sky"&&a!=="slot"){_=ze[`filter_${a}`];const I=dl(f,_,e,i);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));m=(C,k,M)=>I.value.evaluate(C,k,{},M)}let b=null,S=null;if(f!==u){const I=dl(u,_,e,i);if(I.result==="error")throw new Error(I.value.map(C=>`${C.key}: ${C.message}`).join(", "));b=(C,k,M,R,F)=>I.value.evaluate(C,k,{},M,void 0,void 0,R,F),S=!Ac(I.value.expression)}return{filter:m,dynamicFilter:b||void 0,needGeometry:Am(f),needFeature:!!S}}function $y(s){if(!Array.isArray(s))return s;const e=function(i){if(M1.has(i[0])){for(let a=1;a<i.length;a++)if(Nc(i[a]))return!0}return i}(s);return e===!0?e:e.map(i=>$y(i))}function Im(s){let e=!1;const i=[];if(s[0]==="case"){for(let a=1;a<s.length-1;a+=2)e=e||Nc(s[a]),i.push(s[a+1]);i.push(s[s.length-1])}else if(s[0]==="match"){e=e||Nc(s[1]);for(let a=2;a<s.length-1;a+=2)i.push(s[a+1]);i.push(s[s.length-1])}else if(s[0]==="step"){e=e||Nc(s[1]);for(let a=1;a<s.length-1;a+=2)i.push(s[a+1])}e&&(s.length=0,s.push("any",...i));for(let a=1;a<s.length;a++)Im(s[a])}function Nc(s){if(!Array.isArray(s))return!1;if((e=s[0])==="pitch"||e==="distance-from-center")return!0;var e;for(let i=1;i<s.length;i++)if(Nc(s[i]))return!0;return!1}const M1=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function R1(s,e){return s<e?-1:s>e?1:0}function Am(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let e=1;e<s.length;e++)if(Am(s[e]))return!0;return!1}function lh(s){if(!s)return!0;const e=s[0];return s.length<=1?e!=="any":e==="=="?ua(s[1],s[2],"=="):e==="!="?Gd(ua(s[1],s[2],"==")):e==="<"||e===">"||e==="<="||e===">="?ua(s[1],s[2],e):e==="any"?(i=s.slice(1),["any"].concat(i.map(lh))):e==="all"?["all"].concat(s.slice(1).map(lh)):e==="none"?["all"].concat(s.slice(1).map(lh).map(Gd)):e==="in"?Cm(s[1],s.slice(2)):e==="!in"?Gd(Cm(s[1],s.slice(2))):e==="has"?Gy(s[1]):e!=="!has"||Gd(Gy(s[1]));var i}function ua(s,e,i){switch(s){case"$type":return[`filter-type-${i}`,e];case"$id":return[`filter-id-${i}`,e];default:return[`filter-${i}`,s,e]}}function Cm(s,e){if(e.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(i=>typeof i!=typeof e[0])?["filter-in-large",s,["literal",e.sort(R1)]]:["filter-in-small",s,["literal",e]]}}function Gy(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Gd(s){return["!",s]}const ch="";function Hl(s,e){return e?`${s}${ch}${e}`:s}let km;const Lm=()=>km||(km=new Cr({"icon-size":new vt(ze.layout_symbol["icon-size"]),"icon-image":new vt(ze.layout_symbol["icon-image"]),"icon-rotate":new vt(ze.layout_symbol["icon-rotate"]),"icon-offset":new vt(ze.layout_symbol["icon-offset"]),"text-size":new vt(ze.layout_symbol["text-size"]),"text-rotate":new vt(ze.layout_symbol["text-rotate"]),"text-offset":new vt(ze.layout_symbol["text-offset"])}));class Hy{constructor(e,i,a,u,f,m){const _=dl(e,ze.appearance.condition);if(_.result==="success"&&(this.condition=_.value),this.name=i,a){this.properties=new os(Lm()),this.unevaluatedLayout=new Sm(Lm(),u,f,m);for(const b in a)this.unevaluatedLayout.setValue(b,a[b])}}isActive(e){return!(this.condition||!e.isHidden||this.name!=="hidden")||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,i,a){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,i,a))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),i=this.hasProperty("icon-size"),a=this.hasProperty("icon-offset"),u=this.hasProperty("icon-rotate");return e||i||a||u}hasTextProperties(){const e=this.hasProperty("text-size"),i=this.hasProperty("text-offset"),a=this.hasProperty("text-rotate");return e||i||a}hasProperty(e){return this.getUnevaluatedProperty(e).value!==void 0}}const Wy="-transition",qy=new Set(["fill","line","background","hillshade","raster"]);class as extends Ma{constructor(e,i,a,u,f,m){if(super(),this.id=e.id,this.fqid=Hl(this.id,a),this.type=e.type,this.scope=a,this.lut=u,this.options=f,this.iconImageUseTheme=m,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},e.type!=="custom"){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&e.type!=="background"&&e.type!=="sky"&&e.type!=="slot"){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const _=dl(this.filter,ze[`filter_${e.type}`]);_.result!=="error"&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,..._.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||_.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),i.layout&&(this._unevaluatedLayout=new Sm(i.layout,this.scope,f,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),i.paint){this._transitionablePaint=new Fc(i.paint,this.scope,f);for(const _ in e.paint)this.setPaintProperty(_,e.paint[_]);for(const _ in e.layout)this.setLayoutProperty(_,e.layout[_]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new os(i.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&qy.has(this.type)}getLayoutProperty(e){return e==="visibility"?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,i){if(this.type==="custom"&&e==="visibility")return void(this.visibility=i);const a=this._unevaluatedLayout;a._properties.properties[e]&&(a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),e==="visibility"&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(i=>{this.appearances.push(new Hy(i.condition,i.name,i.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(Wy)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,i){const a=this._transitionablePaint,u=a._properties.properties;if(e.endsWith(Wy)){const C=e.slice(0,-11);return u[C]&&a.setTransition(C,i||void 0),!1}if(!u[e])return!1;const f=a._values[e],m=f.value.isDataDriven(),_=f.value;a.setValue(e,i),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...a.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||a.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const b=a._values[e].value,S=b.isDataDriven(),I=e.endsWith("pattern")||e==="line-dasharray";return S||m||I||this._handleOverridablePaintPropertyUpdate(e,_,b)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,i,a){return null}_handleOverridablePaintPropertyUpdate(e,i,a){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||this.visibility==="none"}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,i,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,i)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(e.appearances=this.appearances.map(i=>i.serialize())),Wt(e,(i,a)=>!(i===void 0||a==="layout"&&!Object.keys(i).length||a==="paint"&&!Object.keys(i).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const i=this.paint.get(e);if(i instanceof Gl&&Md(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}for(const e of this.appearances)if(!Xu(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Em(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&(e.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,i,a){return{}}queryRadius(e){}queryIntersectsFeature(e,i,a,u,f,m,_,b,S,I){}}const Zy={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class _l{constructor(e,i){this._structArray=e,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const D1=new ArrayBuffer(0);class hr{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,i){return e._trim(),i&&e.arrayBuffer&&i.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const i=Object.create(this.prototype);return i.arrayBuffer=e.arrayBuffer,i.length=e.length,e.arrayBuffer?i.capacity=e.arrayBuffer.byteLength/i.bytesPerElement:(i.capacity=0,i.arrayBuffer=D1),i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...e){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...e){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function wi(s,e=1){let i=0,a=0;return{members:s.map(u=>{const f=Zy[u.type].BYTES_PER_ELEMENT,m=i=Xy(i,Math.max(e,f)),_=u.components||1;return a=Math.max(a,f),i+=f*_,{name:u.name,type:u.type,components:_,offset:m}}),size:Xy(i,Math.max(a,e)),alignment:e}}function Xy(s,e){return Math.ceil(s/e)*e}class yl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.int16[u+0]=i,this.int16[u+1]=a,e}}yl.prototype.bytesPerElement=4,Ct(yl,"StructArrayLayout2i4");class Ba extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=u,e}}Ba.prototype.bytesPerElement=6,Ct(Ba,"StructArrayLayout3i6");class Fa extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const m=4*e;return this.int16[m+0]=i,this.int16[m+1]=a,this.int16[m+2]=u,this.int16[m+3]=f,e}}Fa.prototype.bytesPerElement=8,Ct(Fa,"StructArrayLayout4i8");class Tn extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.float32[1*e+0]=i,e}}Tn.prototype.bytesPerElement=4,Ct(Tn,"StructArrayLayout1f4");class Uc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=4*e,m=2*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.float32[m+1]=u,e}}Uc.prototype.bytesPerElement=8,Ct(Uc,"StructArrayLayout2i1f8");class Pm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=4*e;return this.int16[f+0]=i,this.int16[f+1]=a,this.int16[f+2]=u,e}}Pm.prototype.bytesPerElement=8,Ct(Pm,"StructArrayLayout3i8");class Mm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,u,f)}emplace(e,i,a,u,f,m){const _=5*e;return this.int16[_+0]=i,this.int16[_+1]=a,this.int16[_+2]=u,this.int16[_+3]=f,this.int16[_+4]=m,e}}Mm.prototype.bytesPerElement=10,Ct(Mm,"StructArrayLayout5i10");class Rm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,m,_)}emplace(e,i,a,u,f,m,_,b){const S=6*e,I=12*e,C=3*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.uint8[I+4]=u,this.uint8[I+5]=f,this.uint8[I+6]=m,this.uint8[I+7]=_,this.float32[C+2]=b,e}}Rm.prototype.bytesPerElement=12,Ct(Rm,"StructArrayLayout2i4ub1f12");class wo extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.float32[f+0]=i,this.float32[f+1]=a,this.float32[f+2]=u,e}}wo.prototype.bytesPerElement=12,Ct(wo,"StructArrayLayout3f12");class ha extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,u,f)}emplace(e,i,a,u,f,m){const _=6*e,b=3*e;return this.uint16[_+0]=i,this.uint16[_+1]=a,this.uint16[_+2]=u,this.uint16[_+3]=f,this.float32[b+2]=m,e}}ha.prototype.bytesPerElement=12,Ct(ha,"StructArrayLayout4ui1f12");class Vc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const m=4*e;return this.uint16[m+0]=i,this.uint16[m+1]=a,this.uint16[m+2]=u,this.uint16[m+3]=f,e}}Vc.prototype.bytesPerElement=8,Ct(Vc,"StructArrayLayout4ui8");class $c extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,f,m)}emplace(e,i,a,u,f,m,_){const b=6*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=u,this.int16[b+3]=f,this.int16[b+4]=m,this.int16[b+5]=_,e}}$c.prototype.bytesPerElement=12,Ct($c,"StructArrayLayout6i12");class Dm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C,k){const M=this.length;return this.resize(M+1),this.emplace(M,e,i,a,u,f,m,_,b,S,I,C,k)}emplace(e,i,a,u,f,m,_,b,S,I,C,k,M){const R=12*e;return this.int16[R+0]=i,this.int16[R+1]=a,this.int16[R+2]=u,this.int16[R+3]=f,this.uint16[R+4]=m,this.uint16[R+5]=_,this.uint16[R+6]=b,this.uint16[R+7]=S,this.int16[R+8]=I,this.int16[R+9]=C,this.int16[R+10]=k,this.int16[R+11]=M,e}}Dm.prototype.bytesPerElement=24,Ct(Dm,"StructArrayLayout4i4ui4i24");class Om extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,f,m)}emplace(e,i,a,u,f,m,_){const b=10*e,S=5*e;return this.int16[b+0]=i,this.int16[b+1]=a,this.int16[b+2]=u,this.float32[S+2]=f,this.float32[S+3]=m,this.float32[S+4]=_,e}}Om.prototype.bytesPerElement=20,Ct(Om,"StructArrayLayout3i3f20");class vl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const m=4*e;return this.float32[m+0]=i,this.float32[m+1]=a,this.float32[m+2]=u,this.float32[m+3]=f,e}}vl.prototype.bytesPerElement=16,Ct(vl,"StructArrayLayout4f16");class zm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint32[1*e+0]=i,e}}zm.prototype.bytesPerElement=4,Ct(zm,"StructArrayLayout1ul4");class Qs extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.uint16[u+0]=i,this.uint16[u+1]=a,e}}Qs.prototype.bytesPerElement=4,Ct(Qs,"StructArrayLayout2ui4");class uh extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C,k,M){const R=this.length;return this.resize(R+1),this.emplace(R,e,i,a,u,f,m,_,b,S,I,C,k,M)}emplace(e,i,a,u,f,m,_,b,S,I,C,k,M,R){const F=20*e,$=10*e;return this.int16[F+0]=i,this.int16[F+1]=a,this.int16[F+2]=u,this.int16[F+3]=f,this.int16[F+4]=m,this.float32[$+3]=_,this.float32[$+4]=b,this.float32[$+5]=S,this.float32[$+6]=I,this.int16[F+14]=C,this.uint32[$+8]=k,this.uint16[F+18]=M,this.uint16[F+19]=R,e}}uh.prototype.bytesPerElement=40,Ct(uh,"StructArrayLayout5i4f1i1ul2ui40");class Hd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,m,_)}emplace(e,i,a,u,f,m,_,b){const S=8*e;return this.int16[S+0]=i,this.int16[S+1]=a,this.int16[S+2]=u,this.int16[S+4]=f,this.int16[S+5]=m,this.int16[S+6]=_,this.int16[S+7]=b,e}}Hd.prototype.bytesPerElement=16,Ct(Hd,"StructArrayLayout3i2i2i16");class Wd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,u,f)}emplace(e,i,a,u,f,m){const _=4*e,b=8*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=u,this.int16[b+6]=f,this.int16[b+7]=m,e}}Wd.prototype.bytesPerElement=16,Ct(Wd,"StructArrayLayout2f1f2i16");class qd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,f,m)}emplace(e,i,a,u,f,m,_){const b=20*e,S=5*e;return this.uint8[b+0]=i,this.uint8[b+1]=a,this.float32[S+1]=u,this.float32[S+2]=f,this.float32[S+3]=m,this.float32[S+4]=_,e}}qd.prototype.bytesPerElement=20,Ct(qd,"StructArrayLayout2ub4f20");class en extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a){const u=this.length;return this.resize(u+1),this.emplace(u,e,i,a)}emplace(e,i,a,u){const f=3*e;return this.uint16[f+0]=i,this.uint16[f+1]=a,this.uint16[f+2]=u,e}}en.prototype.bytesPerElement=6,Ct(en,"StructArrayLayout3ui6");class hh extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae){const oe=this.length;return this.resize(oe+1),this.emplace(oe,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae)}emplace(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae,oe){const ge=30*e,ye=15*e,me=60*e;return this.int16[ge+0]=i,this.int16[ge+1]=a,this.int16[ge+2]=u,this.float32[ye+2]=f,this.float32[ye+3]=m,this.uint16[ge+8]=_,this.uint16[ge+9]=b,this.uint32[ye+5]=S,this.uint32[ye+6]=I,this.uint32[ye+7]=C,this.uint16[ge+16]=k,this.uint16[ge+17]=M,this.uint16[ge+18]=R,this.float32[ye+10]=F,this.float32[ye+11]=$,this.uint8[me+48]=U,this.uint8[me+49]=H,this.uint8[me+50]=X,this.uint32[ye+13]=Q,this.int16[ge+28]=ae,this.uint8[me+58]=oe,e}}hh.prototype.bytesPerElement=60,Ct(hh,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Gc extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae,oe,ge,ye,me,Se,Ae,Ze,Ge,qe,et,Je,Qe){const Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae,oe,ge,ye,me,Se,Ae,Ze,Ge,qe,et,Je,Qe)}emplace(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae,oe,ge,ye,me,Se,Ae,Ze,Ge,qe,et,Je,Qe,Ne){const it=20*e,Ke=40*e,rt=80*e;return this.float32[it+0]=i,this.float32[it+1]=a,this.int16[Ke+4]=u,this.int16[Ke+5]=f,this.int16[Ke+6]=m,this.int16[Ke+7]=_,this.int16[Ke+8]=b,this.int16[Ke+9]=S,this.int16[Ke+10]=I,this.int16[Ke+11]=C,this.int16[Ke+12]=k,this.uint16[Ke+13]=M,this.uint16[Ke+14]=R,this.uint16[Ke+15]=F,this.uint16[Ke+16]=$,this.uint16[Ke+17]=U,this.uint16[Ke+18]=H,this.uint16[Ke+19]=X,this.uint16[Ke+20]=Q,this.uint16[Ke+21]=ae,this.uint16[Ke+22]=oe,this.uint16[Ke+23]=ge,this.uint16[Ke+24]=ye,this.uint16[Ke+25]=me,this.uint16[Ke+26]=Se,this.uint16[Ke+27]=Ae,this.uint32[it+14]=Ze,this.float32[it+15]=Ge,this.float32[it+16]=qe,this.float32[it+17]=et,this.float32[it+18]=Je,this.uint8[rt+76]=Qe,this.uint16[Ke+39]=Ne,e}}Gc.prototype.bytesPerElement=80,Ct(Gc,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Zd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m){const _=this.length;return this.resize(_+1),this.emplace(_,e,i,a,u,f,m)}emplace(e,i,a,u,f,m,_){const b=6*e;return this.float32[b+0]=i,this.float32[b+1]=a,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=m,this.float32[b+5]=_,e}}Zd.prototype.bytesPerElement=24,Ct(Zd,"StructArrayLayout6f24");class Wl extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f){const m=this.length;return this.resize(m+1),this.emplace(m,e,i,a,u,f)}emplace(e,i,a,u,f,m){const _=5*e;return this.float32[_+0]=i,this.float32[_+1]=a,this.float32[_+2]=u,this.float32[_+3]=f,this.float32[_+4]=m,e}}Wl.prototype.bytesPerElement=20,Ct(Wl,"StructArrayLayout5f20");class Xd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,m,_)}emplace(e,i,a,u,f,m,_,b){const S=7*e;return this.float32[S+0]=i,this.float32[S+1]=a,this.float32[S+2]=u,this.float32[S+3]=f,this.float32[S+4]=m,this.float32[S+5]=_,this.float32[S+6]=b,e}}Xd.prototype.bytesPerElement=28,Ct(Xd,"StructArrayLayout7f28");class Bm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C){const k=this.length;return this.resize(k+1),this.emplace(k,e,i,a,u,f,m,_,b,S,I,C)}emplace(e,i,a,u,f,m,_,b,S,I,C,k){const M=11*e;return this.float32[M+0]=i,this.float32[M+1]=a,this.float32[M+2]=u,this.float32[M+3]=f,this.float32[M+4]=m,this.float32[M+5]=_,this.float32[M+6]=b,this.float32[M+7]=S,this.float32[M+8]=I,this.float32[M+9]=C,this.float32[M+10]=k,e}}Bm.prototype.bytesPerElement=44,Ct(Bm,"StructArrayLayout11f44");class dh extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S){const I=this.length;return this.resize(I+1),this.emplace(I,e,i,a,u,f,m,_,b,S)}emplace(e,i,a,u,f,m,_,b,S,I){const C=9*e;return this.float32[C+0]=i,this.float32[C+1]=a,this.float32[C+2]=u,this.float32[C+3]=f,this.float32[C+4]=m,this.float32[C+5]=_,this.float32[C+6]=b,this.float32[C+7]=S,this.float32[C+8]=I,e}}dh.prototype.bytesPerElement=36,Ct(dh,"StructArrayLayout9f36");class ql extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i){const a=this.length;return this.resize(a+1),this.emplace(a,e,i)}emplace(e,i,a){const u=2*e;return this.float32[u+0]=i,this.float32[u+1]=a,e}}ql.prototype.bytesPerElement=8,Ct(ql,"StructArrayLayout2f8");class Fm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,i,a,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,i,a,u)}emplace(e,i,a,u,f){const m=6*e;return this.uint32[3*e+0]=i,this.uint16[m+2]=a,this.uint16[m+3]=u,this.uint16[m+4]=f,e}}Fm.prototype.bytesPerElement=12,Ct(Fm,"StructArrayLayout1ul3ui12");class fh extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint16[1*e+0]=i,e}}fh.prototype.bytesPerElement=2,Ct(fh,"StructArrayLayout1ui2");class jm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$){const U=this.length;return this.resize(U+1),this.emplace(U,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$)}emplace(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U){const H=16*e;return this.float32[H+0]=i,this.float32[H+1]=a,this.float32[H+2]=u,this.float32[H+3]=f,this.float32[H+4]=m,this.float32[H+5]=_,this.float32[H+6]=b,this.float32[H+7]=S,this.float32[H+8]=I,this.float32[H+9]=C,this.float32[H+10]=k,this.float32[H+11]=M,this.float32[H+12]=R,this.float32[H+13]=F,this.float32[H+14]=$,this.float32[H+15]=U,e}}jm.prototype.bytesPerElement=64,Ct(jm,"StructArrayLayout16f64");class ph extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,i,a,u,f,m,_){const b=this.length;return this.resize(b+1),this.emplace(b,e,i,a,u,f,m,_)}emplace(e,i,a,u,f,m,_,b){const S=10*e,I=5*e;return this.uint16[S+0]=i,this.uint16[S+1]=a,this.uint16[S+2]=u,this.uint16[S+3]=f,this.float32[I+2]=m,this.float32[I+3]=_,this.float32[I+4]=b,e}}ph.prototype.bytesPerElement=20,Ct(ph,"StructArrayLayout4ui3f20");class Nm extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.int16[1*e+0]=i,e}}Nm.prototype.bytesPerElement=2,Ct(Nm,"StructArrayLayout1i2");class Kd extends hr{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const i=this.length;return this.resize(i+1),this.emplace(i,e)}emplace(e,i){return this.uint8[1*e+0]=i,e}}Kd.prototype.bytesPerElement=1,Ct(Kd,"StructArrayLayout1ub1");class Ky extends _l{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ky.prototype.size=40;class Yy extends uh{get(e){return new Ky(this,e)}}Ct(Yy,"CollisionBoxArray");class Jy extends _l{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Jy.prototype.size=60;class Qy extends hh{get(e){return new Jy(this,e)}}Ct(Qy,"PlacedSymbolArray");class ev extends _l{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}ev.prototype.size=80;class tv extends Gc{get(e){return new ev(this,e)}}Ct(tv,"SymbolInstanceArray");class mh extends Tn{getoffsetX(e){return this.float32[1*e+0]}}Ct(mh,"GlyphOffsetArray");class iv extends yl{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}Ct(iv,"SymbolLineVertexArray");class rv extends _l{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rv.prototype.size=12;class gh extends Fm{get(e){return new rv(this,e)}}Ct(gh,"FeatureIndexArray");class nv extends Qs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}Ct(nv,"FillExtrusionCentroidArray");class Um extends _l{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Um.prototype.size=6;class sv extends Ba{get(e){return new Um(this,e)}}Ct(sv,"FillExtrusionWallArray");const ov=wi([{name:"a_pos",components:2,type:"Int16"}],4),av=wi([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),lv=wi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class xr{constructor(e=[]){this.segments=e}_prepareSegment(e,i,a,u){let f=this.segments[this.segments.length-1];return e>xr.MAX_VERTEX_ARRAY_LENGTH&&Kt(`Max vertices per segment is ${xr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>xr.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:i,primitiveOffset:a,vertexLength:0,primitiveLength:0},u!==void 0&&(f.sortKey=u),this.segments.push(f)),f}prepareSegment(e,i,a,u){return this._prepareSegment(e,i.length,a.length,u)}get(){return this.segments}destroy(){for(const e of this.segments)for(const i in e.vaos)e.vaos[i].destroy()}static simpleSegment(e,i,a,u){return new xr([{vertexOffset:e,primitiveOffset:i,vertexLength:a,primitiveLength:u,vaos:{},sortKey:0}])}}function cv(s,e){return 256*(s=pe(Math.floor(s),0,255))+pe(Math.floor(e),0,255)}xr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Ct(xr,"SegmentVector");const uv=wi([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),O1=wi([{name:"a_pattern_b",components:4,type:"Uint16"}]),z1=wi([{name:"a_dash",components:4,type:"Uint16"}]);class _h{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,i,a,u){this.ids.push(hv(e)),this.positions.push(i,a,u)}eachPosition(e,i){const a=hv(e);let u=0,f=this.ids.length-1;for(;u<f;){const m=u+f>>1;this.ids[m]>=a?f=m:u=m+1}for(;this.ids[u]===a;)i(this.positions[3*u],this.positions[3*u+1],this.positions[3*u+2]),u++}static serialize(e,i){const a=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Vm(a,u,0,a.length-1),i&&(i.add(a.buffer),i.add(u.buffer)),{ids:a,positions:u}}static deserialize(e){const i=new _h;let a;i.ids=e.ids,i.positions=e.positions;for(const u of i.ids)u!==a&&i.uniqueIds.push(u),a=u;return i.indexed=!0,i}}function hv(s){const e=+s;return Number.isSafeInteger(e)?e:xc(String(s))}function Vm(s,e,i,a){for(;i<a;){const u=s[i+a>>1];let f=i-1,m=a+1;for(;;){do f++;while(s[f]<u);do m--;while(s[m]>u);if(f>=m)break;yh(s,f,m),yh(e,3*f,3*m),yh(e,3*f+1,3*m+1),yh(e,3*f+2,3*m+2)}m-i<a-m?(Vm(s,e,i,m),i=m+1):(Vm(s,e,m+1,a),a=m)}}function yh(s,e,i){const a=s[e];s[e]=s[i],s[i]=a}Ct(_h,"FeaturePositionMap");class No{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,i),this.initialized=!0),!!this.location}set(e,i,a){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class eo extends No{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1i(this.location,a))}}class Gr extends No{constructor(e){super(e),this.current=0}set(e,i,a){this.fetchUniformLocation(e,i)&&this.current!==a&&(this.current=a,this.gl.uniform1f(this.location,a))}}class to extends No{constructor(e){super(e),this.current=[0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]||(this.current=a,this.gl.uniform2f(this.location,a[0],a[1])))}}class vh extends No{constructor(e){super(e),this.current=[0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]||(this.current=a,this.gl.uniform3f(this.location,a[0],a[1],a[2])))}}class Yd extends No{constructor(e){super(e),this.current=[0,0,0,0]}set(e,i,a){this.fetchUniformLocation(e,i)&&(a[0]===this.current[0]&&a[1]===this.current[1]&&a[2]===this.current[2]&&a[3]===this.current[3]||(this.current=a,this.gl.uniform4f(this.location,a[0],a[1],a[2],a[3])))}}class dv extends No{constructor(e){super(e),this.current=Hi.transparent.toPremultipliedRenderColor(null)}set(e,i,a){this.fetchUniformLocation(e,i)&&(a.r===this.current.r&&a.g===this.current.g&&a.b===this.current.b&&a.a===this.current.a||(this.current=a,this.gl.uniform4f(this.location,a.r,a.g,a.b,a.a)))}}const B1=new Float32Array(16);class Hc extends No{constructor(e){super(e),this.current=B1}set(e,i,a){if(this.fetchUniformLocation(e,i)){if(a[12]!==this.current[12]||a[0]!==this.current[0])return this.current=a,void this.gl.uniformMatrix4fv(this.location,!1,a);for(let u=1;u<16;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix4fv(this.location,!1,a);break}}}}const E2=new Float32Array(9),h=new Float32Array(4);class t extends No{constructor(e){super(e),this.current=h}set(e,i,a){if(this.fetchUniformLocation(e,i)){for(let u=0;u<4;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix2fv(this.location,!1,a);break}}}}function l(s){return[cv(255*s.r,255*s.g),cv(255*s.b,255*s.a)]}function d(s,e,i,a,u,f,m,_){return!!s&&(s.kind==="composite"||s.kind==="source"?s.evaluate(new Yi(0,{brightness:f,worldview:_}),e,i,u,a,m)==="none":s.value==="none")}class g{constructor(e,i,a,u){this.value=e,this.uniformNames=i.map(f=>`u_${f}`),this.type=a,this.context=u}setUniform(e,i,a,u,f){const m=u.constantOr(this.value);i.set(e,f,m instanceof Hi?m.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):m)}getBinding(e,i){return this.type==="color"?new dv(e):new Gr(e)}}class y{constructor(e,i){this.uniformNames=i.map(a=>`u_${a}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,i){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(e,i,a,u,f){let m=null;f!=="u_pattern"&&f!=="u_dash"||(m=this.pattern),f==="u_pattern_b"&&(m=this.patternTransition),f==="u_pixel_ratio"&&(m=this.pixelRatio),m&&i.set(e,f,m)}getBinding(e,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Yd(e):new Gr(e)}}class x{constructor(e,i,a,u){this.expression=e,this.type=a,this.maxValue=0,this.paintVertexAttributes=i.map(f=>({name:`a_${f}`,type:"Float32",components:a==="color"?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,i,a,u,f,m,_,b){const S=this.paintVertexArray.length,I=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Yi(0,{brightness:m,worldview:b}),i,{},f,u,_):this.expression.kind==="constant"&&this.expression.value,C=d(this.lutExpression,i,{},u,f,m,_,b);this.paintVertexArray.resize(e),this._setPaintValue(S,e,I,C?null:this.context.lut)}updatePaintArray(e,i,a,u,f,m,_,b){const S=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:_,worldview:b},a,u,void 0,f):this.expression.kind==="constant"&&this.expression.value,I=d(this.lutExpression,a,u,f,void 0,_,void 0,b);this._setPaintValue(e,i,S,I?null:this.context.lut)}_setPaintValue(e,i,a,u){if(this.type==="color"){const f=l(a.toPremultipliedRenderColor(u));for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,f[0],f[1])}else{for(let f=e;f<i;f++)this.paintVertexArray.emplace(f,a);this.maxValue=Math.max(this.maxValue,Math.abs(a))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class T{constructor(e,i,a,u,f,m){this.expression=e,this.uniformNames=i.map(_=>`u_${_}_t`),this.type=a,this.useIntegerZoom=u,this.context=f,this.maxValue=0,this.paintVertexAttributes=i.map(_=>({name:`a_${_}`,type:"Float32",components:a==="color"?4:2,offset:0})),this.paintVertexArray=new m}populatePaintArray(e,i,a,u,f,m,_,b){const S=this.expression.evaluate(new Yi(this.context.zoom,{brightness:m,worldview:b}),i,{},f,u,_),I=this.expression.evaluate(new Yi(this.context.zoom+1,{brightness:m,worldview:b}),i,{},f,u,_),C=d(this.lutExpression,i,{},u,f,m,_,b),k=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(k,e,S,I,C?null:this.context.lut)}updatePaintArray(e,i,a,u,f,m,_,b){const S=this.expression.evaluate({zoom:this.context.zoom,brightness:_,worldview:b},a,u,void 0,f),I=this.expression.evaluate({zoom:this.context.zoom+1,brightness:_,worldview:b},a,u,void 0,f),C=d(this.lutExpression,a,u,f,void 0,_,void 0,b);this._setPaintValue(e,i,S,I,C?null:this.context.lut)}_setPaintValue(e,i,a,u,f){if(this.type==="color"){const m=l(a.toPremultipliedRenderColor(f)),_=l(u.toPremultipliedRenderColor(f));for(let b=e;b<i;b++)this.paintVertexArray.emplace(b,m[0],m[1],_[0],_[1])}else{for(let m=e;m<i;m++)this.paintVertexArray.emplace(m,a,u);this.maxValue=Math.max(this.maxValue,Math.abs(a),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,i,a,u,f){const m=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,_=pe(this.expression.interpolationFactor(m,this.context.zoom,this.context.zoom+1),0,1);i.set(e,f,_)}getBinding(e,i){return new Gr(e)}}class E{constructor(e,i,a,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=(a==="array"?z1:uv).members;for(let m=0;m<i.length;++m);this.paintVertexArray=new u,this.paintTransitionVertexArray=new Vc}populatePaintArray(e,i,a,u){const f=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(f,e,i.patterns&&i.patterns[this.layerId],a)}updatePaintArray(e,i,a,u,f,m,_){this._setPaintValues(e,i,a.patterns&&a.patterns[this.layerId],m)}_setPaintValues(e,i,a,u){if(!u||!a)return;const f=u[a[0]],m=u[a[1]];if(f){if(f){const{tl:_,br:b,pixelRatio:S}=f;for(let I=e;I<i;I++)this.paintVertexArray.emplace(I,_[0],_[1],b[0],b[1],S)}if(m){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:_,br:b}=m;for(let S=e;S<i;S++)this.paintTransitionVertexArray.emplace(S,_[0],_[1],b[0],b[1])}}}upload(e){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,O1.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class L{constructor(e,i,a=()=>!0){this.binders={},this._buffers=[],this.context=i;const u=[];for(const f in e.paint._values){const m=e.paint.get(f);if(f.endsWith("-use-theme")||!a(f)||!(m instanceof Gl&&Md(m.property.specification)))continue;const _=O(f,e.type),b=m.value,S=m.property.specification.type,I=!!m.property.useIntegerZoom,C=f==="line-dasharray"||f.endsWith("pattern"),k=e.paint.get(`${f}-use-theme`),M=f==="line-dasharray"&&e.layout.get("line-cap").value.kind!=="constant"||k&&k.value.kind!=="constant";if(b.kind!=="constant"||M)if(b.kind==="source"||M||C){const R=V(f,S,"source");this.binders[f]=C?new E(b,_,S,R,e.id):new x(b,_,S,R),u.push(`/a_${f}`)}else{const R=V(f,S,"composite");this.binders[f]=new T(b,_,S,I,i,R),u.push(`/z_${f}`)}else this.binders[f]=C?new y(b.value,_):new g(b.value,_,S,i),u.push(`/u_${f}`);k&&(this.binders[f].lutExpression=k.value)}this.cacheKey=u.sort().join("")}getMaxValue(e){const i=this.binders[e];return i instanceof x||i instanceof T?i.maxValue:0}populatePaintArrays(e,i,a,u,f,m,_,b){for(const S in this.binders){const I=this.binders[S];I.context=this.context,(I instanceof x||I instanceof T||I instanceof E)&&I.populatePaintArray(e,i,a,u,f,m,_,b)}}setConstantPatternPositions(e,i){for(const a in this.binders){const u=this.binders[a];u instanceof y&&u.setConstantPatternPositions(e,i)}}getPatternTransitionVertexBuffer(e){const i=this.binders[e];return i instanceof E?i.paintTransitionVertexBuffer:null}updatePaintArrays(e,i,a,u,f,m,_,b,S,I){let C=!1;const k=Object.keys(e),M=k.length!==0&&!b,R=M?k:i.uniqueIds;this.context.lut=f.lut;for(const F in this.binders){const $=this.binders[F];if($.context=this.context,($ instanceof x||$ instanceof T||$ instanceof E)&&$.expression&&$.expression.kind&&$.expression.kind!=="constant"&&($.expression.isStateDependent===!0||$.expression.isLightConstant===!1)){const U=f.paint.get(F);$.expression=U.value;for(const H of R){const X=e[H.toString()];i.eachPosition(H,(Q,ae,oe)=>{const ge=u.feature(Q);$.updatePaintArray(ae,oe,ge,X,m,_,S,I)})}if(!M)for(const H of a.uniqueIds){const X=e[H.toString()];a.eachPosition(H,(Q,ae,oe)=>{const ge=u.feature(Q);$.updatePaintArray(ae,oe,ge,X,m,_,S,I)})}C=!0}}return C}defines(){const e=[];for(const i in this.binders){const a=this.binders[i];(a instanceof g||a instanceof y)&&e.push(...a.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const i=[];for(const a in this.binders){const u=this.binders[a];if(u instanceof g||u instanceof y||u instanceof T)for(const f of u.uniformNames)i.push({name:f,property:a,binding:u.getBinding(e,f)})}return i}setUniforms(e,i,a,u,f){for(const{name:m,property:_,binding:b}of a)this.binders[_].setUniform(e,b,f,u.get(_),m)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const i=this.binders[e];(i instanceof x||i instanceof T||i instanceof E)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof E&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(e){for(const i in this.binders){const a=this.binders[i];(a instanceof x||a instanceof T||a instanceof E)&&a.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const i=this.binders[e];(i instanceof x||i instanceof T||i instanceof E)&&i.destroy()}}}class P{constructor(e,i,a=()=>!0){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new L(u,i,a);this.needsUpload=!1,this._featureMap=new _h,this._featureMapWithoutIds=new _h,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,i,a,u,f,m,_,b,S){for(const I in this.programConfigurations)this.programConfigurations[I].populatePaintArrays(e,i,u,f,m,_,b,S);i.id!==void 0?this._featureMap.add(i.id,a,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,a,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,i,a,u,f,m,_,b){for(const S of a)this.needsUpload=this.programConfigurations[S.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,i,S,u,f,m,_||0,b)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const z={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function O(s,e){return z[s]||[s.replace(`${e}-`,"").replace(/-/g,"_")]}const B={"line-pattern":{source:ha,composite:ha},"fill-pattern":{source:ha,composite:ha},"fill-extrusion-pattern":{source:ha,composite:ha},"line-dasharray":{source:Vc,composite:Vc}},G={color:{source:ql,composite:vl},number:{source:Tn,composite:ql}};function V(s,e,i){const a=B[s];return a&&a[i]||G[e][i]}Ct(g,"ConstantBinder"),Ct(y,"PatternConstantBinder"),Ct(x,"SourceExpressionBinder"),Ct(E,"PatternCompositeBinder"),Ct(T,"CompositeExpressionBinder"),Ct(L,"ProgramConfiguration",{omit:["_buffers"]}),Ct(P,"ProgramConfigurationSet");const W=gt/Math.PI/2,Y=64,se=[Y,32,16],ne=-W,te=W;function we(s,e,i,a=W){return i=Pi(i),[s*Math.sin(i)*a,-e*a,s*Math.cos(i)*a]}function _e(s,e,i){return we(Math.cos(Pi(s)),Math.sin(Pi(s)),e,i)}const be=63710088e-1,de=2*Math.PI*be;class le{constructor(e,i){if(isNaN(e)||isNaN(i))throw new Error(`Invalid LngLat object: (${e}, ${i})`);if(this.lng=+e,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new le(Ue(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const i=Math.PI/180,a=this.lat*i,u=e.lat*i,f=Math.sin(a)*Math.sin(u)+Math.cos(a)*Math.cos(u)*Math.cos((e.lng-this.lng)*i);return be*Math.acos(Math.min(f,1))}toBounds(e=0){const i=360*e/40075017,a=i/Math.cos(Math.PI/180*this.lat);return new Te({lng:this.lng-a,lat:this.lat-i},{lng:this.lng+a,lat:this.lat+i})}toEcef(e){return _e(this.lat,this.lng,W+e*W/be)}static convert(e){if(e instanceof le)return e;if(Array.isArray(e)&&(e.length===2||e.length===3))return new le(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&typeof e=="object"&&e!==null)return new le(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class Te{constructor(e,i){e&&(i?this.setSouthWest(e).setNorthEast(i):Array.isArray(e)&&e.length===4?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof le?new le(e.lng,e.lat):le.convert(e),this}setSouthWest(e){return this._sw=e instanceof le?new le(e.lng,e.lat):le.convert(e),this}extend(e){const i=this._sw,a=this._ne;let u,f;if(e instanceof le)u=e,f=e;else{if(!(e instanceof Te))return Array.isArray(e)?e.length===4||e.every(Array.isArray)?this.extend(Te.convert(e)):this.extend(le.convert(e)):typeof e=="object"&&e!==null&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(le.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return i||a?(i.lng=Math.min(u.lng,i.lng),i.lat=Math.min(u.lat,i.lat),a.lng=Math.max(f.lng,a.lng),a.lat=Math.max(f.lat,a.lat)):(this._sw=new le(u.lng,u.lat),this._ne=new le(f.lng,f.lat)),this}getCenter(){return new le((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new le(this.getWest(),this.getNorth())}getSouthEast(){return new le(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:i,lat:a}=le.convert(e);let u=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=a&&a<=this._ne.lat&&u}static convert(e){if(e)return e instanceof Te?e:new Te(e)}}function Me(s){return de*Math.cos(s*Math.PI/180)}function Oe(s){return(180+s)/360}function Ve(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function je(s,e){return s/Me(e)}function Ye(s){return 360*s-180}function nt(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function Fe(s,e){return s*Me(nt(e))}const Ie=85.051129;function Xe(s){return Math.cos(Pi(pe(s,-85.051129,Ie)))}function $e(s,e){const i=pe(e,0,25.5),a=Math.pow(2,i);return Xe(s)*de/(512*a)}function ot(s){return 1/Math.cos(s*Math.PI/180)}function ht(s,e=0){const i=Math.exp(Math.PI*(1-(s.y+e/gt)/(1<<s.z)*2));return 80150034*i/(i*i+1)/gt/(1<<s.z)}class yt{constructor(e,i,a=0){this.x=+e,this.y=+i,this.z=+a}static fromLngLat(e,i=0){const a=le.convert(e);return new yt(Oe(a.lng),Ve(a.lat),je(i,a.lat))}toLngLat(){return new le(Ye(this.x),nt(this.y))}toAltitude(){return Fe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/de*ot(nt(this.y))}}function dt(s,e,i,a,u,f,m,_,b){const S=(e+a)/2,I=(i+u)/2,C=new at(S,I);_(C),function(k,M,R,F,$,U){const H=R-$,X=F-U;return Math.abs((F-M)*H-(R-k)*X)/Math.hypot(H,X)}(C.x,C.y,f.x,f.y,m.x,m.y)>=b?(dt(s,e,i,S,I,f,C,_,b),dt(s,S,I,a,u,C,m,_,b)):s.push(m)}function pt(s,e,i){let a=s[0],u=a.x,f=a.y;e(a);const m=[a];for(let _=1;_<s.length;_++){const b=s[_],{x:S,y:I}=b;e(b),dt(m,u,f,S,I,a,b,e,i),u=S,f=I,a=b}return m}function Mt(s,e,i,a){if(a(e,i)){const u=e.add(i)._mult(.5);Mt(s,e,u,a),Mt(s,u,i,a)}else s.push(i)}function Lt(s,e){let i=s[0];const a=[i];for(let u=1;u<s.length;u++){const f=s[u];Mt(a,i,f,e),i=f}return a}const bt=Math.pow(2,14)-1,kt=-bt-1;function jt(s,e){const i=Math.round(s.x*e),a=Math.round(s.y*e);return s.x=pe(i,kt,bt),s.y=pe(a,kt,bt),(i<s.x||i>s.x+1||a<s.y||a>s.y+1)&&Kt("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function Xt(s,e,i){const a=s.loadGeometry(),u=s.extent,f=gt/u;if(e&&i&&i.projection.isReprojectedInTileSpace){const m=1<<e.z,{scale:_,x:b,y:S,projection:I}=i,C=k=>{const M=Ye((e.x+k.x/u)/m),R=nt((e.y+k.y/u)/m),F=I.project(M,R);k.x=(F.x*_-b)*u,k.y=(F.y*_-S)*u};for(let k=0;k<a.length;k++)if(s.type!==1)a[k]=pt(a[k],C,1);else{const M=[];for(const R of a[k])R.x<0||R.x>=u||R.y<0||R.y>=u||(C(R),M.push(R));a[k]=M}}for(const m of a)for(const _ of m)jt(_,f);return a}function ci(s,e){return{type:s.type,id:s.id,properties:s.properties,geometry:e?Xt(s):[]}}class Ti{constructor(e,i,a,u,f){this.properties={},this.extent=a,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=u,this._values=f,e.readFields(ii,this,i)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos,a=[];let u,f=1,m=0,_=0,b=0;for(;e.pos<i;){if(m<=0){const S=e.readVarint();f=7&S,m=S>>3}if(m--,f===1||f===2)_+=e.readSVarint(),b+=e.readSVarint(),f===1&&(u&&a.push(u),u=[]),u&&u.push(new at(_,b));else{if(f!==7)throw new Error(`unknown command ${f}`);u&&u.push(u[0].clone())}}return u&&a.push(u),a}bbox(){const e=this._pbf;e.pos=this._geometry;const i=e.readVarint()+e.pos;let a=1,u=0,f=0,m=0,_=1/0,b=-1/0,S=1/0,I=-1/0;for(;e.pos<i;){if(u<=0){const C=e.readVarint();a=7&C,u=C>>3}if(u--,a===1||a===2)f+=e.readSVarint(),m+=e.readSVarint(),f<_&&(_=f),f>b&&(b=f),m<S&&(S=m),m>I&&(I=m);else if(a!==7)throw new Error(`unknown command ${a}`)}return[_,S,b,I]}toGeoJSON(e,i,a){const u=this.extent*Math.pow(2,a),f=this.extent*e,m=this.extent*i,_=this.loadGeometry();function b(k){return[360*(k.x+f)/u-180,360/Math.PI*Math.atan(Math.exp((1-2*(k.y+m)/u)*Math.PI))-90]}function S(k){return k.map(b)}let I;if(this.type===1){const k=[];for(const R of _)k.push(R[0]);const M=S(k);I=k.length===1?{type:"Point",coordinates:M[0]}:{type:"MultiPoint",coordinates:M}}else if(this.type===2){const k=_.map(S);I=k.length===1?{type:"LineString",coordinates:k[0]}:{type:"MultiLineString",coordinates:k}}else{if(this.type!==3)throw new Error("unknown feature type");{const k=function(R){const F=R.length;if(F<=1)return[R];const $=[];let U,H;for(let X=0;X<F;X++){const Q=Mi(R[X]);Q!==0&&(H===void 0&&(H=Q<0),H===Q<0?(U&&$.push(U),U=[R[X]]):U&&U.push(R[X]))}return U&&$.push(U),$}(_),M=[];for(const R of k)M.push(R.map(S));I=M.length===1?{type:"Polygon",coordinates:M[0]}:{type:"MultiPolygon",coordinates:M}}}const C={type:"Feature",geometry:I,properties:this.properties};return this.id!=null&&(C.id=this.id),C}}function ii(s,e,i){s===1?e.id=i.readVarint():s===2?function(a,u){const f=a.readVarint()+a.pos;for(;a.pos<f;){const m=u._keys[a.readVarint()],_=u._values[a.readVarint()];u.properties[m]=_}}(i,e):s===3?e.type=i.readVarint():s===4&&(e._geometry=i.pos)}function Mi(s){let e=0;for(let i,a,u=0,f=s.length,m=f-1;u<f;m=u++)i=s[u],a=s[m],e+=(a.x-i.x)*(i.y+a.y);return e}Ti.types=["Unknown","Point","LineString","Polygon"];class ni{constructor(e,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Zi,this,i),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const i=this._pbf.readVarint()+this._pbf.pos;return new Ti(this._pbf,i,this.extent,this._keys,this._values)}}function Zi(s,e,i){s===15?e.version=i.readVarint():s===1?e.name=i.readString():s===5?e.extent=i.readVarint():s===2?e._features.push(i.pos):s===3?e._keys.push(i.readString()):s===4&&e._values.push(function(a){let u=null;const f=a.readVarint()+a.pos;for(;a.pos<f;){const m=a.readVarint()>>3;u=m===1?a.readString():m===2?a.readFloat():m===3?a.readDouble():m===4?a.readVarint64():m===5?a.readVarint():m===6?a.readSVarint():m===7?a.readBoolean():null}if(u==null)throw new Error("unknown feature value");return u}(i))}class Wi{constructor(e,i){this.layers=e.readFields(Ki,{},i)}}function Ki(s,e,i){if(s===3){const a=new ni(i,i.readVarint()+i.pos);a.length&&(e[a.name]=a)}}const Ii="3d_elevation_id",ai="level";class ji{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(e,i){return this._valid&&e(i(this._geometry)),this}require(e,i,a){return this.get(e,!0,i,a)}optional(e,i,a){return this.get(e,!1,i,a)}success(){return this._valid}get(e,i,a,u){const f=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&f!==void 0&&!Number.isNaN(f)?a(u?u(f):f):i&&(this._valid=!1),this}}class br{constructor(e,i){this.featureFunc=e,this.vertexFunc=i}parseFeature(e,i,a){return this.featureFunc(e,i,a)}parseVertex(e,i,a){return this.vertexFunc(e,i,a)}}const wr=new br((s,e,i)=>s.reset(e).require(Ii,a=>{i.id=a}).optional("fixed_height_relative",a=>{i.constantHeight=a},xi.decodeRelativeHeight).geometry(a=>{i.bounds=a},Wu).success(),(s,e,i)=>s.reset(e).require(Ii,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height_relative",a=>{i.height=a},xi.decodeRelativeHeight).geometry(a=>{i.position=a},xi.getPoint).success()),Ni=new br((s,e,i)=>s.reset(e).require(Ii,a=>{i.id=a}).optional("fixed_height",a=>{i.constantHeight=a},xi.decodeMetricHeight).geometry(a=>{i.bounds=a},Wu).success(),(s,e,i)=>s.reset(e).require(Ii,a=>{i.id=a}).require("elevation_idx",a=>{i.idx=a}).require("extent",a=>{i.extent=a}).require("height",a=>{i.height=a},xi.decodeMetricHeight).geometry(a=>{i.position=a},xi.getPoint).success());class xi{static getPoint(e){return _o(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?e==="1.0.1"?Ni:void 0:wr}static parse(e){const i=[],a=[],u=e.length,f=new ji;for(let m=0;m<u;m++){const _=e.feature(m),b=_.properties.version,S=xi.getVersionSchema(b);if(S===void 0){Kt(`Unknown elevation feature version number ${b||"(unknown)"}`);continue}const I=_.properties.type;if(!I)continue;const C=Ti.types[_.type];if(C==="Point"&&I==="curve_point"){const k={};S.parseVertex(f,_,k)&&i.push(k)}else if(C==="Polygon"&&I==="curve_meta"){const k={};S.parseFeature(f,_,k)&&a.push(k)}}return{vertices:i,features:a}}}class li{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const u=ir(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1])/u;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,!0}}class nr{constructor(e,i){this.pos=e,this.dir=i}intersectsPlane(e,i,a){const u=Qt(i,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*i[0]+(e[1]-this.pos[1])*i[1]+(e[2]-this.pos[2])*i[2])/u;return a[0]=this.pos[0]+this.dir[0]*f,a[1]=this.pos[1]+this.dir[1]*f,a[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,i,a){if(function(M,R){var F=M[0],$=M[1],U=M[2],H=R[0],X=R[1],Q=R[2];return Math.abs(F-H)<=D*Math.max(1,Math.abs(F),Math.abs(H))&&Math.abs($-X)<=D*Math.max(1,Math.abs($),Math.abs(X))&&Math.abs(U-Q)<=D*Math.max(1,Math.abs(U),Math.abs(Q))}(this.pos,e)||i===0)return a[0]=a[1]=a[2]=0,!1;const[u,f,m]=this.dir,_=this.pos[0]-e[0],b=this.pos[1]-e[1],S=this.pos[2]-e[2],I=u*u+f*f+m*m,C=2*(_*u+b*f+S*m),k=C*C-4*I*(_*_+b*b+S*S-i*i);if(k<0){const M=Math.max(-C/2,0),R=_+u*M,F=b+f*M,$=S+m*M,U=Math.hypot(R,F,$);return a[0]=R*i/U,a[1]=F*i/U,a[2]=$*i/U,!1}{const M=(-C-Math.sqrt(k))/(2*I);if(M<0){const R=Math.hypot(_,b,S);return a[0]=_*i/R,a[1]=b*i/R,a[2]=S*i/R,!1}return a[0]=_+u*M,a[1]=b+f*M,a[2]=S+m*M,!0}}}class kr{constructor(e,i,a,u,f){this.TL=e,this.TR=i,this.BR=a,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,i,a){const u=[-1,1,1],f=[1,1,1],m=[1,-1,1],_=[-1,-1,1],b=or(u,u,e),S=or(f,f,e),I=or(m,m,e),C=or(_,_,e);return new kr(b,S,I,C,i/a)}}function cr(s,e,i){let a=1/0,u=-1/0;const f=[];for(const m of s){Dr(f,m,e);const _=Qt(f,i);a=Math.min(a,_),u=Math.max(u,_)}return[a,u]}function dr(s,e){let i=!0;for(let a=0;a<s.planes.length;a++){const u=s.planes[a];let f=0;for(let m=0;m<e.length;m++)f+=+(Qt(u,e[m])+u[3]>=0);if(f===0)return 0;f!==e.length&&(i=!1)}return i?2:1}function ls(s,e){for(const i of s.projections){const a=cr(e,s.points[0],i.axis);if(i.projection[1]<a[0]||i.projection[0]>a[1])return 0}return 1}function Ss(s,e){let i=0;const a=[0,0,0,0];for(let u=0;u<s.length;u++)a[0]=s[u][0],a[1]=s[u][1],a[2]=s[u][2],a[3]=1,$n(a,e)>=0&&i++;return i}class fn{constructor(e,i){this.points=e||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=Ui.fromPoints(this.points),this.projections=[],this.frustumEdges=[Dr([],this.points[2],this.points[3]),Dr([],this.points[0],this.points[3]),Dr([],this.points[4],this.points[0]),Dr([],this.points[5],this.points[1]),Dr([],this.points[6],this.points[2]),Dr([],this.points[7],this.points[3])];for(const a of this.frustumEdges){const u=[0,-a[2],a[1]],f=[a[2],0,-a[0]];this.projections.push({axis:u,projection:cr(this.points,this.points[0],u)}),this.projections.push({axis:f,projection:cr(this.points,this.points[0],f)})}}static fromInvProjectionMatrix(e,i,a,u){const f=Math.pow(2,a),m=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const I=zn([],S,e),C=1/I[3]/i*f;return(k=I)[0]=(M=I)[0]*(R=[C,C,u?1/I[3]:C,C])[0],k[1]=M[1]*R[1],k[2]=M[2]*R[2],k[3]=M[3]*R[3],k;var k,M,R}),_=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const I=Si([],Di([],Dr([],m[S[0]],m[S[1]]),Dr([],m[S[2]],m[S[1]]))),C=-Qt(I,m[S[1]]);return I.concat(C)}),b=[];for(let S=0;S<m.length;S++)b.push([m[S][0],m[S][1],m[S][2]]);return new fn(b,_)}intersectsPrecise(e,i,a){for(let u=0;u<i.length;u++)if(!Ss(e,i[u]))return 0;for(let u=0;u<this.planes.length;u++)if(!Ss(e,this.planes[u]))return 0;for(const u of a)for(const f of this.frustumEdges){const m=Di([],u,f),_=vi(m);if(_===0)continue;Ot(m,m,1/_);const b=cr(this.points,this.points[0],m),S=cr(e,this.points[0],m);if(b[0]>S[1]||S[0]>b[1])return 0}return 1}containsPoint(e){for(const i of this.planes){const a=i[3];if(Qt([i[0],i[1],i[2]],e)+a<0)return!1}return!0}}class Ui{static fromPoints(e){const i=[1/0,1/0,1/0],a=[-1/0,-1/0,-1/0];for(const u of e)hi(i,i,u),Ft(a,a,u);return new Ui(i,a)}static fromTileIdAndHeight(e,i,a){const u=1<<e.canonical.z,f=e.canonical.x,m=e.canonical.y;return new Ui([f/u,m/u,i],[(f+1)/u,(m+1)/u,a])}static applyTransform(e,i){const a=e.getCorners();for(let u=0;u<a.length;++u)or(a[u],a[u],i);return Ui.fromPoints(a)}static applyTransformFast(e,i){const a=[i[12],i[13],i[14]],u=[...a];for(let f=0;f<3;f++)for(let m=0;m<3;m++){const _=i[4*m+f],b=_*e.min[m],S=_*e.max[m];a[f]+=Math.min(b,S),u[f]+=Math.max(b,S)}return new Ui(a,u)}static projectAabbCorners(e,i){const a=e.getCorners();for(let u=0;u<a.length;++u)or(a[u],a[u],i);return a}constructor(e,i){this.min=e,this.max=i,this.center=Ot([],Tt([],this.min,this.max),.5)}quadrant(e){const i=[e%2==0,e<2],a=bi(this.min),u=bi(this.max);for(let f=0;f<i.length;f++)a[f]=i[f]?this.min[f]:this.center[f],u[f]=i[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new Ui(a,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,i=this.max;return[[e[0],e[1],e[2]],[i[0],e[1],e[2]],[i[0],i[1],e[2]],[e[0],i[1],e[2]],[e[0],e[1],i[2]],[i[0],e[1],i[2]],[i[0],i[1],i[2]],[e[0],i[1],i[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?dr(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?dr(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,i){return i||this.intersects(e)?ls(e,this.getCorners()):0}intersectsPreciseFlat(e,i){return i||this.intersectsFlat(e)?ls(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let i=0;i<3;++i)if(this.min[i]>e.max[i]||e.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e.min[i]),this.max[i]=Math.max(this.max[i],e.max[i])}encapsulatePoint(e){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],e[i]),this.max[i]=Math.max(this.max[i],e[i])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}Ct(Ui,"Aabb");class Bs{constructor(e,i){this.feature=e,this.metersToTile=i,this.index=0}get(){const e=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,a=i[1],u=-i[0],f=(e.extent+1)*this.metersToTile;return[new at(Math.trunc(e.position[0]+a*f),Math.trunc(e.position[1]+u*f)),new at(Math.trunc(e.position[0]-a*f),Math.trunc(e.position[1]-u*f))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class Dn{constructor(e,i,a,u,f,m){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Yr(),Yr(),Yr(),Yr(),Yr(),Yr(),Yr()],this.id=e,this.heightRange={min:a,max:a},this.safeArea=i,this.constantHeight=a,this.constantHeight==null&&(this.constantHeight!=null||u.length!==0)){this.vertices=u,this.edges=f,this.edges=this.edges.filter(_=>{return _.a<this.vertices.length&&_.b<this.vertices.length&&!((b=this.vertices[_.a].position)[0]===(S=this.vertices[_.b].position)[0]&&b[1]===S[1]);var b,S}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const _ of this.vertices)this.vertexProps.push({dir:_o(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,_.height),this.heightRange.max=Math.max(this.heightRange.max,_.height);for(const _ of this.edges){const b=this.vertices[_.a].position,S=this.vertices[_.b].position,I=Rs(Yr(),S,b),C=zo(I),k=Oo(Yr(),I,1/C);this.edgeProps.push({vec:I,dir:k,len:C});const M=this.vertexProps[_.a].dir,R=this.vertexProps[_.b].dir;Do(M,M,k),Do(R,R,k)}for(const _ of this.vertexProps)_.dir[0]===0&&_.dir[1]===0||Ea(_.dir,_.dir);this.tessellate(m)}}pointElevation(e){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(e);if(i==null)return 0;const[a,u]=i;return qt(this.vertices[this.edges[a].a].height,this.vertices[this.edges[a].b].height,u)}computeSlopeNormal(e,i){const a=this.getClosestEdge(e);if(!a)return ei(0,0,1);const u=a[0],f=this.edges[u],m=this.edgeProps[u].vec,_=ei(m[0],m[1],(this.vertices[f.b].height-this.vertices[f.a].height)*i),b=ei(_[1],-_[0],0);Di(b,b,_);const S=vi(b);return S>0?Ot(b,b,1/S):si(b,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(this.edges.length===0)return;let i=0,a=Number.POSITIVE_INFINITY,u=0;const[f,m,_,b,S,I,C]=this._tmpVec2;Ms(C,e.x,e.y);const k=new li(C,null);for(let M=0;M<this.edges.length;M++){const R=this.edges[M],F=this.edgeProps[M].dir;k.dir=F;const $=this.vertices[R.a].position,U=this.vertices[R.b].position,H=k.intersectsPlane($,this.vertexProps[R.a].dir,f),X=k.intersectsPlane(U,this.vertexProps[R.b].dir,m);if(!H||!X)continue;Rs(_,m,f),Rs(b,C,f);const Q=ir(_,_),ae=Q>0?ir(b,_)/Q:0,oe=pe(ae,0,1),ge=Math.abs((ae-oe)*this.edgeProps[M].len);Rs(S,C,$),Ms(I,F[1],-F[0]);const ye=ge+Math.abs(ir(S,I));ye<a&&(i=M,a=ye,u=oe)}return[i,u]}tessellate(e){const i=Ut(),a=Ut(),u=Ut(),f=Ut();for(let m=this.edges.length-1;m>=0;--m){const _=this.edges[m].a,b=this.edges[m].b,{position:S,height:I,extent:C}=this.vertices[_],{position:k,height:M,extent:R}=this.vertices[b],F=this.vertexProps[_].dir,$=this.vertexProps[b].dir;if(si(i,S[0]/e,S[1]/e,I),si(a,k[0]/e,k[1]/e,M),si(u,F[1],-F[0],0),Ot(u,u,C),si(f,$[1],-$[0],0),Ot(f,f,R),this.distSqLines(ei(i[0]+.5*u[0],i[1]+.5*u[1],i[2]+.5*u[2]),ei(a[0]-.5*f[0],a[1]-.5*f[1],a[2]-.5*f[2]),ei(i[0]-.5*u[0],i[1]-.5*u[1],i[2]-.5*u[2]),ei(a[0]+.5*f[0],a[1]+.5*f[1],a[2]+.5*f[2]))<=.0025000000000000005)continue;const U=this.vertices.length,H=Do(Yr(),S,k);this.vertices.push({position:Oo(H,H,.5),height:.5*(I+M),extent:.5*(C+R)});const X=Do(Yr(),F,$);this.vertexProps.push({dir:Ea(X,X)}),this.edges.splice(m,1),this.edgeProps.splice(m,1),this.edges.push({a:_,b:U}),this.edges.push({a:U,b});const Q=Rs(Yr(),this.vertices[U].position,S),ae=zo(Q),oe={vec:Q,dir:Oo(Yr(),Q,1/ae),len:ae};this.edgeProps.push(oe),this.edgeProps.push(oe)}}distSqLines(e,i,a,u){const f=Ht(Ut(),i,e),m=Ht(Ut(),u,a),_=Ht(Ut(),e,a),b=Qt(f,f),S=Qt(f,m),I=Qt(f,_),C=Qt(m,m),k=Qt(m,_),M=b*C-S*S;if(M===0)return sr(Pn(f,a,u,Qt(_,m)/Qt(m,m)),e);const R=(b*k-S*I)/M;return sr(Pn(f,e,i,(S*k-I*C)/M),Pn(m,a,u,R))}}class cs{static parseFrom(e,i){const a=xi.parse(e);if(!a)return[];let{vertices:u,features:f}=a;const m=1/ht(i);f.sort((I,C)=>I.id-C.id),u.sort((I,C)=>I.id-C.id||I.idx-C.idx),u=u.filter((I,C,k)=>C===k.findIndex(M=>M.id===I.id&&M.idx===I.idx));const _=new Array;let b=0;const S=u.length;for(const I of f){if(I.constantHeight){_.push(new Dn(I.id,I.bounds,I.constantHeight));continue}for(;b!==S&&u[b].id<I.id;)b++;if(b===S||u[b].id!==I.id)continue;const C=new Array,k=new Array,M=b;for(;b!==S&&u[b].id===I.id;){const R=u[b];if(C.push({position:R.position,height:R.height,extent:R.extent}),b!==M&&u[b-1].idx===R.idx-1){const F=b-M;k.push({a:F-1,b:F})}b++}_.push(new Dn(I.id,I.bounds,void 0,C,k,m))}return _}static getElevationFeature(e,i){if(!i)return;const a=+e.properties[Ii];return Number.isNaN(a)?void 0:i.find(u=>u.id===a)}}class So{constructor(e,i){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(i)||(this.zScale=Math.pow(2,i.z-e.z),this.xOffset=(e.x*this.zScale-i.x)*gt,this.yOffset=(e.y*this.zScale-i.y)*gt)}constantElevation(e,i){if(e.constantHeight!=null)return this.computeBiasedHeight(e.constantHeight,i)}pointElevation(e,i,a){const u=this.constantElevation(i,a);return u??(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(e),a))}computeBiasedHeight(e,i){return i<=0?e:e+i*Pe(0,i,e>=0?e:Math.abs(.5*e))}}Ct(Dn,"ElevationFeature");class us{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new yl,this.indexArray=new en,this.segments=new xr,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Tn),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,u){}populate(e,i,a,u){const f=this.layers[0],m=[];let _=null;f.type==="circle"&&(_=f.layout.get("circle-sort-key"));for(const{feature:S,id:I,index:C,sourceLayerIndex:k}of e){const M=this.layers[0]._featureFilter.needGeometry,R=ci(S,M);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),R,a))continue;const F=_?_.evaluate(R,{},a):void 0,$={id:I,properties:S.properties,type:S.type,sourceLayerIndex:k,index:C,geometry:M?R.geometry:Xt(S,a,u),patterns:{},sortKey:F};m.push($)}_&&m.sort((S,I)=>S.sortKey-I.sortKey);let b=null;u.projection.name==="globe"&&(this.globeExtVertexArray=new $c,b=u.projection);for(const S of m){const{geometry:I,index:C,sourceLayerIndex:k}=S,M=e[C].feature;this.addFeature(S,I,C,i.availableImages,a,b,i.brightness,i.elevationFeatures),i.featureIndex.insert(M,I,C,k,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,i,a,u,f,m,_){this.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ov.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,lv.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,av.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,i,a,u,f,m,_,b){let S;this.elevationMode!=="none"&&(S=cs.getElevationFeature(e,b));for(const I of i)for(const C of I){const k=C.x,M=C.y;if(k<0||k>=gt||M<0||M>=gt)continue;if(m){const $=m.projectTilePoint(k,M,f),U=m.upVector(f,k,M);this.addGlobeExtVertex($,U),this.addGlobeExtVertex($,U),this.addGlobeExtVertex($,U),this.addGlobeExtVertex($,U)}const R=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),F=R.vertexLength;if(this.addCircleVertex(k,M,-1,-1),this.addCircleVertex(k,M,1,-1),this.addCircleVertex(k,M,1,1),this.addCircleVertex(k,M,-1,1),this.elevationMode!=="none"){const $=S?S.pointElevation(new at(k,M)):0;this.hasElevation=this.hasElevation||$!==0;for(let U=0;U<4;U++)this.elevatedLayoutVertexArray.emplaceBack($)}this.indexArray.emplaceBack(F,F+1,F+2),this.indexArray.emplaceBack(F,F+2,F+3),R.vertexLength+=4,R.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,{},u,f,_,void 0,this.worldview)}addCircleVertex(e,i,a,u){this.layoutVertexArray.emplaceBack(2*e+(a+1)/2,2*i+(u+1)/2)}addGlobeExtVertex(e,i){this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function Tr(s,e){for(let i=0;i<s.length;i++)if(js(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(js(s,e[i]))return!0;return!!Fn(s,e)}function Ur(s,e,i){return!!js(s,e)||!!da(e,s,i)}function ur(s,e){if(s.length===1)return qc(e,s[0]);for(let i=0;i<e.length;i++){const a=e[i];for(let u=0;u<a.length;u++)if(js(s,a[u]))return!0}for(let i=0;i<s.length;i++)if(qc(e,s[i]))return!0;for(let i=0;i<e.length;i++)if(Fn(s,e[i]))return!0;return!1}function Hr(s,e,i){if(s.length>1){if(Fn(s,e))return!0;for(let a=0;a<e.length;a++)if(da(e[a],s,i))return!0}for(let a=0;a<s.length;a++)if(da(s[a],e,i))return!0;return!1}function Fn(s,e){if(s.length===0||e.length===0)return!1;for(let i=0;i<s.length-1;i++){const a=s[i],u=s[i+1];for(let f=0;f<e.length-1;f++)if(Br(a,u,e[f],e[f+1]))return!0}return!1}function Br(s,e,i,a){return lr(s,i,a)!==lr(e,i,a)&&lr(s,e,i)!==lr(s,e,a)}function Fs(s,e,i){return(s.x-i.x)*(e.y-i.y)-(s.y-i.y)*(e.x-i.x)}function xh(s,e,i,a){const u=Fs(s,e,a),f=Fs(s,e,i);if(Math.sign(u)===Math.sign(f))return;const m=Fs(i,a,s),_=m+f-u;return Math.sign(m)!==Math.sign(_)?[m/(m-_),f/(f-u)]:void 0}function da(s,e,i){const a=i*i;if(e.length===1)return s.distSqr(e[0])<a;for(let u=1;u<e.length;u++)if(Wc(s,e[u-1],e[u])<a)return!0;return!1}function Wc(s,e,i){const a=e.distSqr(i);if(a===0)return s.distSqr(e);const u=((s.x-e.x)*(i.x-e.x)+(s.y-e.y)*(i.y-e.y))/a;return s.distSqr(u<0?e:u>1?i:i.sub(e)._mult(u)._add(e))}function qc(s,e){let i,a,u,f=!1;for(let m=0;m<s.length;m++){i=s[m];for(let _=0,b=i.length-1;_<i.length;b=_++)a=i[_],u=i[b],a.y>e.y!=u.y>e.y&&e.x<(u.x-a.x)*(e.y-a.y)/(u.y-a.y)+a.x&&(f=!f)}return f}function js(s,e){let i=!1;for(let a=0,u=s.length-1;a<s.length;u=a++){const f=s[a],m=s[u];f.y>e.y!=m.y>e.y&&e.x<(m.x-f.x)*(e.y-f.y)/(m.y-f.y)+f.x&&(i=!i)}return i}function fa(s,e,i,a,u){for(const m of s)if(e<=m.x&&i<=m.y&&a>=m.x&&u>=m.y)return!0;const f=[new at(e,i),new at(e,u),new at(a,u),new at(a,i)];if(s.length>2){for(const m of f)if(js(s,m))return!0}for(let m=0;m<s.length-1;m++)if(pa(s[m],s[m+1],f))return!0;return!1}function pa(s,e,i){const a=i[0],u=i[2];if(s.x<a.x&&e.x<a.x||s.x>u.x&&e.x>u.x||s.y<a.y&&e.y<a.y||s.y>u.y&&e.y>u.y)return!1;const f=lr(s,e,i[0]);return f!==lr(s,e,i[1])||f!==lr(s,e,i[2])||f!==lr(s,e,i[3])}function io(s,e,i,a,u,f){let m=e.y-s.y,_=s.x-e.x;if(f=f||0){const b=m*m+_*_;if(b===0)return!0;const S=Math.sqrt(b);m/=S,_/=S}return!((i.x-s.x)*m+(i.y-s.y)*_-f<0||(a.x-s.x)*m+(a.y-s.y)*_-f<0||(u.x-s.x)*m+(u.y-s.y)*_-f<0)}function ja(s,e,i,a,u,f,m){return!(io(s,e,a,u,f,m)||io(e,i,a,u,f,m)||io(i,s,a,u,f,m)||io(a,u,s,e,i,m)||io(u,f,s,e,i,m)||io(f,a,s,e,i,m))}function Zl(s,e,i){const a=e.paint.get(s).value;return a.kind==="constant"?a.value:i.programConfigurations.get(e.id).getMaxValue(s)}function Jd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function I2(s,e,i,a,u){if(!e[0]&&!e[1])return s;const f=at.convert(e)._mult(u);i==="viewport"&&f._rotate(-a);const m=[];for(let _=0;_<s.length;_++)m.push(s[_].sub(f));return m}function A2(s,e,i,a){const u=at.convert(s)._mult(a);return e==="viewport"&&u._rotate(-i),u}let C2,k2;function L2(s,e,i){var a=2*Math.PI*6378137/256/Math.pow(2,i);return[s*a-2*Math.PI*6378137/2,e*a-2*Math.PI*6378137/2]}Ct(us,"CircleBucket",{omit:["layers"]});class bh{constructor(e,i,a){this.z=e,this.x=i,this.y=a,this.key=Qd(0,e,e,i,a)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const i=this.z-e.z;return e.z===0||e.z<this.z&&e.x===this.x>>i&&e.y===this.y>>i}url(e,i){const a=function(f,m,_){var b=L2(256*f,256*(m=Math.pow(2,_)-m-1),_),S=L2(256*(f+1),256*(m+1),_);return b[0]+","+b[1]+","+S[0]+","+S[1]}(this.x,this.y,this.z),u=function(f,m,_){let b,S="";for(let I=f;I>0;I--)b=1<<I-1,S+=(m&b?1:0)+(_&b?2:0);return S}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",a)}toString(){return`${this.z}/${this.x}/${this.y}`}}class P2{constructor(e,i){this.wrap=e,this.canonical=i,this.key=Qd(e,i.z,i.z,i.x,i.y)}}class hs{constructor(e,i,a,u,f){this.overscaledZ=e,this.wrap=i,this.canonical=new bh(a,+u,+f),this.key=i===0&&e===a?this.canonical.key:Qd(i,e,a,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const i=this.canonical.z-e;return e>this.canonical.z?new hs(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new hs(e,this.wrap,e,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(e,i=!0){if(this.overscaledZ===e&&i)return this.key;if(e>this.canonical.z)return Qd(this.wrap*+i,e,this.canonical.z,this.canonical.x,this.canonical.y);{const a=this.canonical.z-e;return Qd(this.wrap*+i,e,e,this.canonical.x>>a,this.canonical.y>>a)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const i=this.canonical.z-e.canonical.z;return e.overscaledZ===0||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>i&&e.canonical.y===this.canonical.y>>i}children(e){if(this.overscaledZ>=e)return[new hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,a=2*this.canonical.x,u=2*this.canonical.y;return[new hs(i,this.wrap,i,a,u),new hs(i,this.wrap,i,a+1,u),new hs(i,this.wrap,i,a,u+1),new hs(i,this.wrap,i,a+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new hs(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new P2(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Qd(s,e,i,a,u){const f=1<<Math.min(i,22);let m=f*(u%f)+a%f;return s&&i<22&&(m+=f*f*((s<0?-2*s-1:2*s)%(1<<2*(22-i)))),16*(32*m+i)+(e-i)}const sO=[s=>{let e=s.canonical.x-1,i=s.wrap;return e<0&&(e=(1<<s.canonical.z)-1,i--),new hs(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>{let e=s.canonical.x+1,i=s.wrap;return e===1<<s.canonical.z&&(e=0,i++),new hs(s.overscaledZ,i,s.canonical.z,e,s.canonical.y)},s=>new hs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new hs(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];Ct(bh,"CanonicalTileID"),Ct(hs,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const oO=wi([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:fv}=oO,aO=wi([{name:"a_pos_3",components:3,type:"Int16"}]);var M2=wi([{name:"a_pos",type:"Int16",components:2}]);function pv(s){return s*W/be}const lO=[new Ui([ne,ne,ne],[te,te,te]),new Ui([ne,ne,ne],[0,0,te]),new Ui([0,ne,ne],[te,0,te]),new Ui([ne,0,ne],[0,te,te]),new Ui([0,0,ne],[te,te,te])];function R2(s,e,i,a=!0){const u=Ot([],s._camera.position,s.worldSize),f=[e,i,1,1];zn(f,f,s.pixelMatrixInverse),ea(f,f,1/f[3]);const m=Si([],Dr([],f,u)),_=s.globeMatrix,b=[_[12],_[13],_[14]],S=Dr([],b,u),I=vi(S),C=Si([],S),k=s.worldSize/(2*Math.PI),M=Qt(C,m),R=Math.asin(k/I);if(R<Math.acos(M)){if(!a)return null;const Se=[],Ae=[];Ot(Se,m,I/M),Si(Ae,Dr(Ae,Se,S)),Si(m,Tt(m,S,Ot(m,Ae,Math.tan(R)*I)))}const F=[];new nr(u,m).closestPointOnSphere(b,k,F);const $=Si([],Sr(_,0)),U=Si([],Sr(_,1)),H=Si([],Sr(_,2)),X=Qt($,F),Q=Qt(U,F),ae=Qt(H,F),oe=De(Math.asin(-Q/k));let ge=De(Math.atan2(X,ae));ge=s.center.lng+function(Se,Ae){const Ze=(Ae-Se+180)%360-180;return Ze<-180?Ze+360:Ze}(s.center.lng,ge);const ye=Oe(ge),me=pe(Ve(oe),0,1);return new yt(ye,me)}class cO{constructor(e,i,a){this.a=Dr([],e,a),this.b=Dr([],i,a),this.center=a;const u=Si([],this.a),f=Si([],this.b);this.angle=Math.acos(Qt(u,f))}}function F1(s,e){if(s.angle===0)return null;let i;return i=s.a[e]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[e]/s.a[e]/Math.sin(s.angle)-1/Math.tan(s.angle)),i<0||i>1?null:function(a,u,f,m){const _=Math.sin(f);return a*(Math.sin((1-m)*f)/_)+u*(Math.sin(m*f)/_)}(s.a[e],s.b[e],s.angle,pe(i,0,1))+s.center[e]}function xl(s){if(s.z<=1)return lO[s.z+2*s.y+s.x];const e=j1(mv(s));return Ui.fromPoints(e)}function Xl(s,e,i){return Ot(s,s,1-i),di(s,s,e,i)}function D2(s,e,i){for(const a of s)or(a,a,e),Ot(a,a,i)}function O2(s,e,i,a){const u=e/s.worldSize,f=s.globeMatrix;if(i.z<=1){const me=xl(i).getCorners();return D2(me,f,u),Ui.fromPoints(me)}const m=mv(i,a),_=j1(m,W+pv(s._tileCoverLift));D2(_,f,u);const b=Number.MAX_VALUE,S=[-b,-b,-b],I=[b,b,b];if(m.contains(s.center)){for(const Ae of _)hi(I,I,Ae),Ft(S,S,Ae);S[2]=0;const me=s.point,Se=[me.x*u,me.y*u,0];return hi(I,I,Se),Ft(S,S,Se),new Ui(I,S)}if(s._tileCoverLift>0){for(const me of _)hi(I,I,me),Ft(S,S,me);return new Ui(I,S)}const C=[f[12]*u,f[13]*u,f[14]*u],k=m.getCenter(),M=pe(s.center.lat,-85.051129,Ie),R=pe(k.lat,-85.051129,Ie),F=Oe(s.center.lng),$=Ve(M);let U=F-Oe(k.lng);const H=$-Ve(R);U>.5?U-=1:U<-.5&&(U+=1);let X=0;Math.abs(U)>Math.abs(H)?X=U>=0?1:3:(X=H>=0?0:2,di(C,C,[f[4]*u,f[5]*u,f[6]*u],-Math.sin(Pi(H>=0?m.getSouth():m.getNorth()))*W));const Q=_[X],ae=_[(X+1)%4],oe=new cO(Q,ae,C),ge=[F1(oe,0)||Q[0],F1(oe,1)||Q[1],F1(oe,2)||Q[2]],ye=Zc(s.zoom);if(ye>0){const me=function({x:Ae,y:Ze,z:Ge},qe,et,Je,Qe){const Ne=1/(1<<Ge);let it=Ae*Ne,Ke=it+Ne,rt=Ze*Ne,tt=rt+Ne,St=0;const Et=(it+Ke)/2-Je;return Et>.5?St=-1:Et<-.5&&(St=1),it=((it+St)*qe-(Je*=qe))*et+Je,Ke=((Ke+St)*qe-Je)*et+Je,rt=(rt*qe-(Qe*=qe))*et+Qe,tt=(tt*qe-Qe)*et+Qe,[[it,tt,0],[Ke,tt,0],[Ke,rt,0],[it,rt,0]]}(i,e,s._pixelsPerMercatorPixel,F,$);for(let Ae=0;Ae<_.length;Ae++)Xl(_[Ae],me[Ae],ye);const Se=Tt([],me[X],me[(X+1)%4]);Ot(Se,Se,.5),Xl(ge,Se,ye)}for(const me of _)hi(I,I,me),Ft(S,S,me);return I[2]=Math.min(Q[2],ae[2]),hi(I,I,ge),Ft(S,S,ge),new Ui(I,S)}function mv({x:s,y:e,z:i},a=!1){const u=1/(1<<i),f=new le(Ye(s*u),e===(1<<i)-1&&a?-90:nt((e+1)*u)),m=new le(Ye((s+1)*u),e===0&&a?90:nt(e*u));return new Te(f,m)}function j1(s,e=W){const i=Pi(s.getNorth()),a=Pi(s.getSouth()),u=Math.cos(i),f=Math.cos(a),m=Math.sin(i),_=Math.sin(a),b=s.getWest(),S=s.getEast();return[we(f,_,b,e),we(f,_,S,e),we(u,m,S,e),we(u,m,b,e)]}function $m(s,e,i,a){const u=1<<i.z,f=(s/gt+i.x)/u;return _e(nt((e/gt+i.y)/u),Ye(f),a)}function gv({min:s,max:e}){return 16383/Math.max(e[0]-s[0],e[1]-s[1],e[2]-s[2])}const z2=new Float64Array(16);function _v(s){const e=gv(s),i=ct(z2,[e,e,e]);return fe(i,i,Fi([],s.min))}function N1(s){const e=function(a,u){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a}(z2,s.min),i=1/gv(s);return ke(e,e,[i,i,i])}function U1(s){const e=gt/(2*Math.PI);return s/(2*Math.PI)/e}function B2(s,e){return gt/(512*Math.pow(2,s))*gv(xl(e))}function F2(s,e,i,a,u){const f=U1(i),m=[s,e,-i/(2*Math.PI)],_=Ee(new Float64Array(16));return fe(_,_,m),ke(_,_,[f,f,f]),Be(_,_,Pi(-u)),Le(_,_,Pi(-a)),_}function Zc(s){return Pe(5,6,s)}function j2(s,e){const i=_e(e.lat,e.lng),a=function(R){const F=_e(R._center.lat,R._center.lng);let $=Di([],ei(0,1,0),F);const U=lt([],-R.angle,F);$=or($,$,U),lt(U,-R._pitch,$);const H=Si([],F);return Ot(H,H,pv(R.cameraToCenterDistance/R.pixelsPerMeter)),or(H,H,U),Tt([],F,H)}(s);return m=(u=Ht([],a,i))[0],_=u[1],b=u[2],S=(f=i)[0],I=f[1],C=f[2],M=(k=Math.sqrt((m*m+_*_+b*b)*(S*S+I*I+C*C)))&&Qt(u,f)/k,Math.acos(Math.min(Math.max(M,-1),1));var u,f,m,_,b,S,I,C,k,M}function V1(s,e){return j2(s,e)>Math.PI/2*1.01}const N2=Pi(85),uO=Math.cos(N2),hO=Math.sin(N2),dO=ce(),U2=s=>{const e=[];return s.paint.get("circle-pitch-alignment")==="map"&&e.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&e.push("SCALE_WITH_MAP"),e};function V2(s,e,i,a,u,f,m,_,b){if(f&&s.queryGeometry.isAboveHorizon)return!1;f&&(b*=s.pixelToTileUnitsFactor);const S=s.tileID.canonical,I=i.projection.upVectorScale(S,i.center.lat,i.worldSize).metersToTile;for(const C of e)for(const k of C){const M=k.add(_),R=u&&i.elevation?i.elevation.exaggeration()*u.getElevationAt(M.x,M.y,!0):0,F=i.projection.projectTilePoint(M.x,M.y,S);if(R>0){const X=i.projection.upVector(S,M.x,M.y);F.x+=X[0]*I*R,F.y+=X[1]*I*R,F.z+=X[2]*I*R}const $=f?M:fO(F.x,F.y,F.z,a),U=f?s.tilespaceRays.map(X=>mO(X,R)):s.queryGeometry.screenGeometry,H=zn([],[F.x,F.y,F.z,1],a);if(!m&&f?b*=H[3]/i.cameraToCenterDistance:m&&!f&&(b*=i.cameraToCenterDistance/H[3]),f){const X=nt((k.y/gt+S.y)/(1<<S.z));b/=i.projection.pixelsPerMeter(X,1)/je(1,X)}if(Ur(U,$,b))return!0}return!1}function fO(s,e,i,a){const u=zn([],[s,e,i,1],a);return new at(u[0]/u[3],u[1]/u[3])}const $2=ei(0,0,0),pO=ei(0,0,1);function mO(s,e){const i=Ut();return $2[2]=e,s.intersectsPlane($2,pO,i),new at(i[0],i[1])}class G2 extends us{}let H2,W2,q2,Z2;function X2(s,{width:e,height:i},a,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*i*a)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*i*a);return s.width=e,s.height=i,s.data=u,s}function K2(s,e,i){const{width:a,height:u}=e;a===s.width&&u===s.height||($1(s,e,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,a),height:Math.min(s.height,u)},i,null),s.width=a,s.height=u,s.data=e.data)}function $1(s,e,i,a,u,f,m,_){if(u.width===0||u.height===0)return e;if(u.width>s.width||u.height>s.height||i.x>s.width-u.width||i.y>s.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||a.x>e.width-u.width||a.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const b=s.data,S=e.data,I=f===4&&_;for(let C=0;C<u.height;C++){const k=((i.y+C)*s.width+i.x)*f,M=((a.y+C)*e.width+a.x)*f;if(I)for(let R=0;R<u.width;R++){const F=k+R*f+3,$=M+R*f;S[$+0]=255,S[$+1]=255,S[$+2]=255,S[$+3]=b[F]}else if(m)for(let R=0;R<u.width;R++){const F=k+R*f,$=M+R*f,U=new Hi(b[F+0]/255,b[F+1]/255,b[F+2]/255,b[F+3]).toNonPremultipliedRenderColor(m).toArray();S[$+0]=U[0],S[$+1]=U[1],S[$+2]=U[2],S[$+3]=U[3]}else for(let R=0;R<u.width*f;R++)S[M+R]=b[k+R]}return e}Ct(G2,"HeatmapBucket",{omit:["layers"]});class Xc{constructor(e,i){X2(this,e,1,i)}resize(e){K2(this,new Xc(e),1)}clone(){return new Xc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f){$1(e,i,a,u,f,1,null)}}class jn{constructor(e,i){X2(this,e,4,i)}resize(e){K2(this,new jn(e),4)}replace(e,i){i?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new jn({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,i,a,u,f,m,_){$1(e,i,a,u,f,4,m,_)}}class Y2{constructor(e,i){this.width=e.width,this.height=e.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function Gm(s){const e={},i=s.resolution||256,a=s.clips?s.clips.length:1,u=s.image||new jn({width:i,height:a}),f=(m,_,b)=>{e[s.evaluationKey]=b;const S=s.expression.evaluate(e),I=S?S.toNonPremultipliedRenderColor(null):null;I&&(u.data[m+_+0]=Math.floor(255*I.r),u.data[m+_+1]=Math.floor(255*I.g),u.data[m+_+2]=Math.floor(255*I.b),u.data[m+_+3]=Math.floor(255*I.a))};if(s.clips)for(let m=0,_=0;m<a;++m,_+=4*i)for(let b=0,S=0;b<i;b++,S+=4){const I=b/(i-1),{start:C,end:k}=s.clips[m];f(_,S,C*(1-I)+k*I)}else for(let m=0,_=0;m<i;m++,_+=4)f(0,_,m/(i-1));return u}Ct(Xc,"AlphaImage"),Ct(jn,"RGBAImage");const gO=wi([{name:"a_pos",components:2,type:"Int16"}],4),_O=wi([{name:"a_road_z_offset",components:1,type:"Float32"}],4),yO=wi([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),vO=wi([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function ef(s,e,i=2){const a=e&&e.length,u=a?e[0]*i:s.length;let f=J2(s,0,u,i,!0);const m=[];if(!f||f.next===f.prev)return m;let _,b,S;if(a&&(f=function(I,C,k,M){const R=[];for(let F=0,$=C.length;F<$;F++){const U=J2(I,C[F]*M,F<$-1?C[F+1]*M:I.length,M,!1);U===U.next&&(U.steiner=!0),R.push(AO(U))}R.sort(TO);for(let F=0;F<R.length;F++)k=EO(R[F],k);return k}(s,e,f,i)),s.length>80*i){_=s[0],b=s[1];let I=_,C=b;for(let k=i;k<u;k+=i){const M=s[k],R=s[k+1];M<_&&(_=M),R<b&&(b=R),M>I&&(I=M),R>C&&(C=R)}S=Math.max(I-_,C-b),S=S!==0?32767/S:0}return Hm(f,m,i,_,b,S,0),m}function J2(s,e,i,a,u){let f;if(u===function(m,_,b,S){let I=0;for(let C=_,k=b-S;C<b;C+=S)I+=(m[k]-m[C])*(m[C+1]+m[k+1]),k=C;return I}(s,e,i,a)>0)for(let m=e;m<i;m+=a)f=iE(m/a|0,s[m],s[m+1],f);else for(let m=i-a;m>=e;m-=a)f=iE(m/a|0,s[m],s[m+1],f);return f&&tf(f,f.next)&&(Zm(f),f=f.next),f}function wh(s,e){if(!s)return s;e||(e=s);let i,a=s;do if(i=!1,a.steiner||!tf(a,a.next)&&pn(a.prev,a,a.next)!==0)a=a.next;else{if(Zm(a),a=e=a.prev,a===a.next)break;i=!0}while(i||a!==e);return e}function Hm(s,e,i,a,u,f,m){if(!s)return;!m&&f&&function(b,S,I,C){let k=b;do k.z===0&&(k.z=G1(k.x,k.y,S,I,C)),k.prevZ=k.prev,k.nextZ=k.next,k=k.next;while(k!==b);k.prevZ.nextZ=null,k.prevZ=null,function(M){let R,F=1;do{let $,U=M;M=null;let H=null;for(R=0;U;){R++;let X=U,Q=0;for(let oe=0;oe<F&&(Q++,X=X.nextZ,X);oe++);let ae=F;for(;Q>0||ae>0&&X;)Q!==0&&(ae===0||!X||U.z<=X.z)?($=U,U=U.nextZ,Q--):($=X,X=X.nextZ,ae--),H?H.nextZ=$:M=$,$.prevZ=H,H=$;U=X}H.nextZ=null,F*=2}while(R>1)}(k)}(s,a,u,f);let _=s;for(;s.prev!==s.next;){const b=s.prev,S=s.next;if(f?bO(s,a,u,f):xO(s))e.push(b.i,s.i,S.i),Zm(s),s=S.next,_=S.next;else if((s=S)===_){m?m===1?Hm(s=wO(wh(s),e),e,i,a,u,f,2):m===2&&SO(s,e,i,a,u,f):Hm(wh(s),e,i,a,u,f,1);break}}}function xO(s){const e=s.prev,i=s,a=s.next;if(pn(e,i,a)>=0)return!1;const u=e.x,f=i.x,m=a.x,_=e.y,b=i.y,S=a.y,I=Math.min(u,f,m),C=Math.min(_,b,S),k=Math.max(u,f,m),M=Math.max(_,b,S);let R=a.next;for(;R!==e;){if(R.x>=I&&R.x<=k&&R.y>=C&&R.y<=M&&Wm(u,_,f,b,m,S,R.x,R.y)&&pn(R.prev,R,R.next)>=0)return!1;R=R.next}return!0}function bO(s,e,i,a){const u=s.prev,f=s,m=s.next;if(pn(u,f,m)>=0)return!1;const _=u.x,b=f.x,S=m.x,I=u.y,C=f.y,k=m.y,M=Math.min(_,b,S),R=Math.min(I,C,k),F=Math.max(_,b,S),$=Math.max(I,C,k),U=G1(M,R,e,i,a),H=G1(F,$,e,i,a);let X=s.prevZ,Q=s.nextZ;for(;X&&X.z>=U&&Q&&Q.z<=H;){if(X.x>=M&&X.x<=F&&X.y>=R&&X.y<=$&&X!==u&&X!==m&&Wm(_,I,b,C,S,k,X.x,X.y)&&pn(X.prev,X,X.next)>=0||(X=X.prevZ,Q.x>=M&&Q.x<=F&&Q.y>=R&&Q.y<=$&&Q!==u&&Q!==m&&Wm(_,I,b,C,S,k,Q.x,Q.y)&&pn(Q.prev,Q,Q.next)>=0))return!1;Q=Q.nextZ}for(;X&&X.z>=U;){if(X.x>=M&&X.x<=F&&X.y>=R&&X.y<=$&&X!==u&&X!==m&&Wm(_,I,b,C,S,k,X.x,X.y)&&pn(X.prev,X,X.next)>=0)return!1;X=X.prevZ}for(;Q&&Q.z<=H;){if(Q.x>=M&&Q.x<=F&&Q.y>=R&&Q.y<=$&&Q!==u&&Q!==m&&Wm(_,I,b,C,S,k,Q.x,Q.y)&&pn(Q.prev,Q,Q.next)>=0)return!1;Q=Q.nextZ}return!0}function wO(s,e){let i=s;do{const a=i.prev,u=i.next.next;!tf(a,u)&&eE(a,i,i.next,u)&&qm(a,u)&&qm(u,a)&&(e.push(a.i,i.i,u.i),Zm(i),Zm(i.next),i=s=u),i=i.next}while(i!==s);return wh(i)}function SO(s,e,i,a,u,f){let m=s;do{let _=m.next.next;for(;_!==m.prev;){if(m.i!==_.i&&CO(m,_)){let b=tE(m,_);return m=wh(m,m.next),b=wh(b,b.next),Hm(m,e,i,a,u,f,0),void Hm(b,e,i,a,u,f,0)}_=_.next}m=m.next}while(m!==s)}function TO(s,e){let i=s.x-e.x;return i===0&&(i=s.y-e.y,i===0)&&(i=(s.next.y-s.y)/(s.next.x-s.x)-(e.next.y-e.y)/(e.next.x-e.x)),i}function EO(s,e){const i=function(u,f){let m=f;const _=u.x,b=u.y;let S,I=-1/0;if(tf(u,m))return m;do{if(tf(u,m.next))return m.next;if(b<=m.y&&b>=m.next.y&&m.next.y!==m.y){const F=m.x+(b-m.y)*(m.next.x-m.x)/(m.next.y-m.y);if(F<=_&&F>I&&(I=F,S=m.x<m.next.x?m:m.next,F===_))return S}m=m.next}while(m!==f);if(!S)return null;const C=S,k=S.x,M=S.y;let R=1/0;m=S;do{if(_>=m.x&&m.x>=k&&_!==m.x&&Q2(b<M?_:I,b,k,M,b<M?I:_,b,m.x,m.y)){const F=Math.abs(b-m.y)/(_-m.x);qm(m,u)&&(F<R||F===R&&(m.x>S.x||m.x===S.x&&IO(S,m)))&&(S=m,R=F)}m=m.next}while(m!==C);return S}(s,e);if(!i)return e;const a=tE(i,s);return wh(a,a.next),wh(i,i.next)}function IO(s,e){return pn(s.prev,s,e.prev)<0&&pn(e.next,s,s.next)<0}function G1(s,e,i,a,u){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-i)*u|0)|s<<8))|s<<4))|s<<2))|s<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-a)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function AO(s){let e=s,i=s;do(e.x<i.x||e.x===i.x&&e.y<i.y)&&(i=e),e=e.next;while(e!==s);return i}function Q2(s,e,i,a,u,f,m,_){return(u-m)*(e-_)>=(s-m)*(f-_)&&(s-m)*(a-_)>=(i-m)*(e-_)&&(i-m)*(f-_)>=(u-m)*(a-_)}function Wm(s,e,i,a,u,f,m,_){return!(s===m&&e===_)&&Q2(s,e,i,a,u,f,m,_)}function CO(s,e){return s.next.i!==e.i&&s.prev.i!==e.i&&!function(i,a){let u=i;do{if(u.i!==i.i&&u.next.i!==i.i&&u.i!==a.i&&u.next.i!==a.i&&eE(u,u.next,i,a))return!0;u=u.next}while(u!==i);return!1}(s,e)&&(qm(s,e)&&qm(e,s)&&function(i,a){let u=i,f=!1;const m=(i.x+a.x)/2,_=(i.y+a.y)/2;do u.y>_!=u.next.y>_&&u.next.y!==u.y&&m<(u.next.x-u.x)*(_-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next;while(u!==i);return f}(s,e)&&(pn(s.prev,s,e.prev)||pn(s,e.prev,e))||tf(s,e)&&pn(s.prev,s,s.next)>0&&pn(e.prev,e,e.next)>0)}function pn(s,e,i){return(e.y-s.y)*(i.x-e.x)-(e.x-s.x)*(i.y-e.y)}function tf(s,e){return s.x===e.x&&s.y===e.y}function eE(s,e,i,a){const u=vv(pn(s,e,i)),f=vv(pn(s,e,a)),m=vv(pn(i,a,s)),_=vv(pn(i,a,e));return u!==f&&m!==_||!(u!==0||!yv(s,i,e))||!(f!==0||!yv(s,a,e))||!(m!==0||!yv(i,s,a))||!(_!==0||!yv(i,e,a))}function yv(s,e,i){return e.x<=Math.max(s.x,i.x)&&e.x>=Math.min(s.x,i.x)&&e.y<=Math.max(s.y,i.y)&&e.y>=Math.min(s.y,i.y)}function vv(s){return s>0?1:s<0?-1:0}function qm(s,e){return pn(s.prev,s,s.next)<0?pn(s,e,s.next)>=0&&pn(s,s.prev,e)>=0:pn(s,e,s.prev)<0||pn(s,s.next,e)<0}function tE(s,e){const i=H1(s.i,s.x,s.y),a=H1(e.i,e.x,e.y),u=s.next,f=e.prev;return s.next=e,e.prev=s,i.next=u,u.prev=i,a.next=i,i.prev=a,f.next=a,a.prev=f,a}function iE(s,e,i,a){const u=H1(s,e,i);return a?(u.next=a.next,u.prev=a,a.next.prev=u,a.next=u):(u.prev=u,u.next=u),u}function Zm(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function H1(s,e,i){return{i:s,x:e,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Xm(s,e){const i=s.length;if(i<=1)return[s];const a=[];let u,f;for(let m=0;m<i;m++){const _=Wr(s[m]);_!==0&&(s[m].area=Math.abs(_),f===void 0&&(f=_<0),f===_<0?(u&&a.push(u),u=[s[m]]):u.push(s[m]))}if(u&&a.push(u),e>1)for(let m=0;m<a.length;m++)a[m].length<=e||(dd(a[m],e,1,a[m].length-1,kO),a[m]=a[m].slice(0,e));return a}function kO(s,e){return e.area-s.area}function rE(s,e,i=1){if(!s)return null;const a=typeof s=="string"?xs.from(s).getPrimary():s.getPrimary(),u=typeof s=="string"?null:s.getSecondary();for(const f of[a,u]){if(!f)continue;const m=f.id.toString();e.has(m)||e.set(m,[]),f.scaleSelf(i),e.get(m).push(f)}return{primary:a.toString(),secondary:u?u.toString():null}}function W1(s,e,i,a){const u=a.patternDependencies;let f=!1;for(const m of e){const _=m.paint.get(`${s}-pattern`);_.isConstant()||(f=!0),rE(_.constantOr(null),u,i)&&(f=!0)}return f}function q1(s,e,i,a,u,f){const m=f.patternDependencies;for(const _ of e){const b=_.paint.get(`${s}-pattern`).value;if(b.kind!=="constant"){let S=b.evaluate({zoom:a},i,{},f.availableImages);S=S&&S.name?S.name:S;const I=rE(S,m,u);if(!I)continue;const{primary:C,secondary:k}=I;C&&(i.patterns[_.id]=[C,k].filter(Boolean))}}return i}class Kl{constructor(){this.portals=[]}static isOnBorder(e,i){return e<=0&&i<=0||e>=gt&&i>=gt}static evaluate(e){if(e.length===0)return new Kl;let i=[];for(const b of e)i.push(...b.portals);if(i.length===0)return new Kl;for(const b of i){const S=b.va,I=b.vb;(Kl.isOnBorder(S.x,I.x)||Kl.isOnBorder(S.y,I.y))&&(b.type="border")}const a=i.filter(b=>b.type!=="unevaluated"),u=i.filter(b=>b.type==="unevaluated");if(u.length===0)return new Kl;u.sort((b,S)=>b.hash===S.hash?b.isTunnel===S.isTunnel?0:b.isTunnel?-1:1:b.hash<S.hash?1:-1),i=a.concat(u);let f=a.length,m=f,_=f;do if(m++,m===i.length||i[f].hash!==i[m].hash){if(m-f===2){_<f&&(i[_]=i[f],i[f]=null);const b=i[_],S=i[m-1];b.type=b.isTunnel!==S.isTunnel?"tunnel":"polygon",b.connection={a:b.connection.a,b:S.connection.a},_++}f=m}while(f!==i.length);return i.splice(_),i.sort((b,S)=>b.hash<S.hash?1:-1),{portals:i}}}Ct(Kl,"ElevationPortalGraph");class LO{constructor(e,i,a){this.outPositions=e,this.outNormals=i,this.outIndices=a,this.vertexLookup=new Map}addVertex(e,i,a){let u=e[2];a!=null&&(u*=a);const f=`${e[0]},${e[1]},${e[2]},${i[0]},${i[1]},${i[2]}`,m=this.vertexLookup.get(f);if(m!=null)return m;const _=this.outPositions.length;this.vertexLookup.set(f,_);const b=Math.trunc(16384*i[0]),S=Math.trunc(16384*i[1]),I=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(e[0],e[1],u),this.outNormals.emplaceBack(b,S,I),_}addTriangle(e,i,a){this.outIndices.emplaceBack(e,i,a)}addTriangles(e,i,a){if(e.length===0)return;const u=a.length===1,f=Ut(),m=Ut();for(let _=0;_<e.length;_+=3){const b=i[e[_+0]],S=i[e[_+1]],I=i[e[_+2]],C=u?a[0]:a[e[_+1]],k=u?a[0]:a[e[_+2]];si(f,b.x,b.y,u?a[0]:a[e[_+0]]);const M=this.addVertex(f,m);si(f,S.x,S.y,C);const R=this.addVertex(f,m);si(f,I.x,I.y,k);const F=this.addVertex(f,m);this.outIndices.emplaceBack(M,R,F)}}addQuad(e,i,a,u,f,m){const _=this.addVertex(e,f,m),b=this.addVertex(i,f,m),S=this.addVertex(a,f,m),I=this.addVertex(u,f,m);this.addTriangle(_,b,S),this.addTriangle(S,I,_)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class ro{constructor(e,i,a,u){this.unevaluatedPortals=new Kl,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Uc,this.vertexNormals=new Pm,this.indexArray=new en,this.tileToMeters=ht(e),this.bridgeProgramConfigurations=new P(i,{zoom:a,lut:u},f=>f!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new P(i,{zoom:a,lut:u},f=>f!=="fill-bridge-guard-rail-color")}addVertices(e,i){const a=this.unevalVertices.length;for(let u=0;u<e.length;u++)this.unevalVertices.push(e[u]),this.unevalHeights.push(i[u]);return a}addTriangles(e,i,a){const u=a?this.unevalTunnelTriangles:this.unevalTriangles;for(const f of e)u.push(f+i)}addRenderableRing(e,i,a,u,f,m){const _=[new at(f.min.x,f.min.y),new at(f.max.x,f.min.y),new at(f.max.x,f.max.y),new at(f.min.x,f.max.y)];for(let b=0;b<a-1;b++){const S=i+b,I=S+1,C=this.unevalVertices[S],k=this.unevalVertices[I];if(!(C.x>=f.min.x&&C.x<=f.max.x&&C.y>=f.min.y&&C.y<=f.max.y||k.x>=f.min.x&&k.x<=f.max.x&&k.y>=f.min.y&&k.y<=f.max.y||pa(C,k,_))||this.isOnBorder(C.x,k.x)||this.isOnBorder(C.y,k.y))continue;const M=ro.computeEdgeHash(this.unevalVertices[S],this.unevalVertices[I]);let R,F=this.vertexHashLookup.get(ro.computePosHash(C));F!=null?R=F.next:(F=this.vertexHashLookup.get(ro.computePosHash(k)),R=F!=null?F.prev:M),this.unevalEdges.push({polygonIdx:e,a:S,b:I,hash:M,portalHash:R,isTunnel:u,type:"unevaluated",featureInfo:m})}}addPortalCandidates(e,i,a,u,f){if(i.length!==0){this.vertexHashLookup.clear();for(const m of i){if(m.length===0)continue;const _=m[0];let b=ro.computeEdgeHash(_[_.length-2],_[_.length-1]);for(let S=0;S<_.length-1;S++){const I=_[S+0],C=_[S+1],k=_o(C.x-I.x,C.y-I.y),M=zo(k);if(M===0)continue;let R="unevaluated";const F=u.pointElevation(I),$=u.pointElevation(C);Math.abs(F)<.01&&Math.abs($)<.01?R="entrance":(this.isOnBorder(I.x,C.x)||this.isOnBorder(I.y,C.y))&&(R="border");const U=ro.computeEdgeHash(I,C);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:I,vb:C,vab:k,length:M,hash:U,isTunnel:a,type:R});const H=ro.computePosHash(I);this.vertexHashLookup.set(H,{prev:b,next:U}),b=U}}}}construct(e){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),a=k=>{k.primitiveLength=this.indexArray.length-k.primitiveOffset},u=new LO(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const f=i(),m=i(),_=i(),b=(k,M)=>{k.sort((F,$)=>F.type===M&&$.type!==M?-1:F.type!==M&&$.type===M?1:0);const R=k.findIndex(F=>F.type!==M);return R>=0?R:k.length};let S=0;this.unevalEdges.length>0&&(S=b(this.unevalEdges,"none"),this.constructBridgeStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},this.tileToMeters)),a(_);const I=i(),C=i();if(this.unevalEdges.length>0){const k=this.unevalEdges.splice(S),M=b(k,"tunnel")+S;this.unevalEdges.push(...k),this.constructTunnelStructures(u,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:S},{min:S,max:M})}a(I),u.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),a(C),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),a(m),u.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),a(f),this.maskSegments=xr.simpleSegment(0,C.primitiveOffset,0,C.primitiveLength),this.depthSegments=xr.simpleSegment(0,m.primitiveOffset,0,m.primitiveLength),this.renderableBridgeSegments=xr.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength),this.renderableTunnelSegments=xr.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.shadowCasterSegments=xr.simpleSegment(0,f.primitiveOffset,0,f.primitiveLength)}update(e,i,a,u,f,m,_,b){this.bridgeProgramConfigurations.updatePaintArrays(e,i,f,a,u,m,_,b),this.tunnelProgramConfigurations.updatePaintArrays(e,i,f,a,u,m,_,b)}upload(e){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,yO.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,vO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,i,a,u,f){const m=(_,b)=>{for(let S=0;S<b.length-1;S++){const I=b[S].featureIndex,C=b[S+1].vertexStart,k=e.feature(I);_.populatePaintArrays(C,k,I,{},a,i,u,void 0,f)}};m(this.bridgeProgramConfigurations,this.bridgeFeatureSections),m(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,i,a,u,f){const m=new Map;for(let _=u;_<f;_++){const b=a[_],S=b.a,I=b.b,C=ro.computePosHash(e[S]),k=ro.computePosHash(e[I]);let M=m.get(C);M||(M={},m.set(C,M));let R=m.get(k);R||(R={},m.set(k,R)),i[S]<=0&&i[I]<=0||(M.to=I,R.from=S)}return m}isTerminalVertex(e,i){const a=ro.computePosHash(this.unevalVertices[e]),u=i.get(a);return!u||!u.from||!u.to}constructBridgeStructures(e,i,a,u,f,m){e.clearVertexLookup();const _=this.computeVertexConnections(i,a,u,f.min,f.max),b=1/m,S=.5*b,I=(et,Je)=>si(et,i[Je].x,i[Je].y,a[Je]*b),C=Ut(),k=Ut(),M=Ut(),R=Ut(),F=Ut(),$=(et,Je)=>{const Qe=_.get(ro.computePosHash(i[Je])),Ne=Qe.from,it=Qe.to;if(!Ne||!it)return;I(C,Ne),I(k,Je),I(M,it),Qo(R),es(C,k)||(Dr(F,k,C),Si(R,F)),es(M,k)||(Dr(F,M,k),Tt(R,R,Si(F,F)));const Ke=Lo(R);return Ke>0?Ot(et,R,1/Ke):void 0};let U=Number.POSITIVE_INFINITY;this.sortSubarray(u,f.min,f.max,(et,Je)=>et.featureInfo.featureIndex-Je.featureInfo.featureIndex);const H=Ut(),X=Ut(),Q=Ut(),ae=Ut(),oe=Ut(),ge=Ut(),ye=Ut(),me=Ut(),Se=Ut(),Ae=[Ut(),Ut(),Ut(),Ut()],Ze=[Ut(),Ut(),Ut(),Ut()],Ge=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],qe=(et,Je)=>et>Je;for(let et=f.min;et<f.max;et++){const Je=u[et];if(!Je.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Ge,i,a,Je,qe))continue;const[Qe,Ne]=Ge;if(si(H,Qe.coord.x,Qe.coord.y,b*Qe.height),si(X,Ne.coord.x,Ne.coord.y,b*Ne.height),es(H,X))continue;Dr(Q,X,H),Si(Q,Q);const it=$(me,Je.a)||Q,Ke=$(Se,Je.b)||Q;si(ae,it[1],-it[0],0),Si(ae,ae),si(oe,Ke[1],-Ke[0],0),Si(oe,oe),Di(me,ae,it),Si(ge,me),Di(me,oe,Ke),Si(ye,me),Tt(Ae[0],H,Ot(me,Dr(me,ae,ge),S)),Tt(Ae[1],H,Ot(me,Tt(me,ae,ge),S)),Tt(Ae[2],H,Ot(me,ge,S)),Ae[3]=H,Tt(Ze[0],X,Ot(me,Dr(me,oe,ye),S)),Tt(Ze[1],X,Ot(me,Tt(me,oe,ye),S)),Tt(Ze[2],X,Ot(me,ye,S)),Ze[3]=X,U=this.addFeatureSection(Je.featureInfo.featureIndex,U,this.bridgeFeatureSections,e);const rt=e.addVertex(Ae[0],ae,m),tt=e.addVertex(Ae[1],ae,m),St=e.addVertex(Ze[0],oe,m),Et=e.addVertex(Ze[1],oe,m);e.addTriangle(rt,tt,St),e.addTriangle(tt,Et,St);const mt=e.addVertex(Ae[1],ge,m),_t=e.addVertex(Ae[2],ge,m),Vt=e.addVertex(Ze[1],ye,m),Rt=e.addVertex(Ze[2],ye,m);e.addTriangle(mt,_t,Vt),e.addTriangle(_t,Rt,Vt),Fi(ae,ae),Fi(oe,oe);const xt=e.addVertex(Ae[2],ae,m),Jt=e.addVertex(Ae[3],ae,m),yi=e.addVertex(Ze[2],oe,m),Bi=e.addVertex(Ze[3],oe,m);e.addTriangle(xt,Jt,yi),e.addTriangle(Jt,Bi,yi);const mi=this.isTerminalVertex(Je.a,_),Ji=this.isTerminalVertex(Je.b,_);Qe.height<.01&&mi&&e.addQuad(Ae[3],Ae[2],Ae[1],Ae[0],Fi(it,it),m),Ne.height<.01&&Ji&&e.addQuad(Ze[0],Ze[1],Ze[2],Ze[3],Ke,m)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,i,a,u,f,m){e.clearVertexLookup();let _=Number.POSITIVE_INFINITY;const b=(U,H)=>U.featureInfo.featureIndex-H.featureInfo.featureIndex;this.sortSubarray(u,f.min,f.max,b),this.sortSubarray(u,m.min,m.max,b);const S=U=>Si(U,U),I=[{coord:new at(0,0),height:0},{coord:new at(0,0),height:0}],C=(U,H)=>U<H,k=Ut(),M=Ut(),R=Ut(),F=Ut(),$=Ut();for(let U=f.min;U<f.max;U++){if(!this.prepareEdgePoints(I,i,a,u[U],C))continue;const[H,X]=I,Q=S(si($,-(X.coord.y-H.coord.y),X.coord.x-H.coord.x,0));_=this.addFeatureSection(u[U].featureInfo.featureIndex,_,this.tunnelFeatureSections,e),e.addQuad(si(k,H.coord.x,H.coord.y,H.height),si(M,X.coord.x,X.coord.y,X.height),si(R,X.coord.x,X.coord.y,u[U].isTunnel?-.1:0),si(F,H.coord.x,H.coord.y,u[U].isTunnel?-.1:0),Q)}for(let U=m.min;U<m.max;U++){const H=u[U];H.isTunnel&&([H.a,H.b]=[H.b,H.a]);const X=i[H.a],Q=i[H.b],ae=S(si($,-(Q.y-X.y),Q.x-X.x,0));_=this.addFeatureSection(H.featureInfo.featureIndex,_,this.tunnelFeatureSections,e),e.addQuad(si(k,Q.x,Q.y,0),si(M,X.x,X.y,0),si(R,X.x,X.y,a[H.a]+4),si(F,Q.x,Q.y,a[H.b]+4),ae),e.addQuad(si(k,X.x,X.y,0),si(M,Q.x,Q.y,0),si(R,Q.x,Q.y,a[H.b]+4),si(F,X.x,X.y,a[H.a]+4),ae)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,i,a,u){e.coord.x=i,e.coord.y=a,e.height=u}prepareEdgePoints(e,i,a,u,f){let m=i[u.a].x,_=i[u.a].y,b=i[u.b].x,S=i[u.b].y,I=a[u.a],C=a[u.b];const k=f(I,0),M=f(C,0);if(k&&M)return this.setElevatedPoint(e[0],m,_,I),this.setElevatedPoint(e[1],b,S,C),!0;if(!k&&!M)return!1;if(k){if(!M){const R=C/(C-I);b=qt(b,m,R),S=qt(S,_,R),C=qt(C,I,R)}}else{const R=I/(I-C);m=qt(m,b,R),_=qt(_,S,R),I=qt(I,C,R)}return this.setElevatedPoint(e[0],m,_,I),this.setElevatedPoint(e[1],b,S,C),!0}prepareEdges(e,i){if(i.length===0)return;i.sort((_,b)=>_.hash===b.hash?b.polygonIdx-_.polygonIdx:b.hash>_.hash?1:-1);let a=0,u=0,f=0,m=i[a].polygonIdx;do u++,(u===i.length||i[a].hash!==i[u].hash)&&((u-a===1||i[u-1].polygonIdx!==m)&&(f<a&&(i[f]=i[a],i[a]=null),i[f].type="none",f++),a=u,a!==i.length&&(m=i[a].polygonIdx));while(a!==i.length);if(i.splice(f),i.length!==0&&e.length!==0){i.sort((S,I)=>S.portalHash<I.portalHash?1:-1);let _=0,b=0;for(;_!==i.length&&b!==e.length;){const S=i[_],I=e[b];S.portalHash>I.hash?_++:I.hash>S.portalHash?b++:(S.type=I.type,_++)}}}isOnBorder(e,i){return e<=0&&i<=0||e>=gt&&i>=gt}addFeatureSection(e,i,a,u){return e!==i&&(i=e,a.push({featureIndex:e,vertexStart:u.getVertexCount()}),u.clearVertexLookup()),i}sortSubarray(e,i,a,u){const f=e.slice(i,a);f.sort(u),e.splice(i,f.length,...f)}static computeEdgeHash(e,i){return(e.y===i.y&&e.x>i.x||e.y>i.y)&&([e,i]=[i,e]),BigInt(ro.computePosHash(e))<<32n|BigInt(ro.computePosHash(i))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}function PO(s,e){return s>e?1:s<e?-1:0}class Z1{constructor(e=PO,i=!1){this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!i}rotateLeft(e){var i=e.right;i&&(e.right=i.left,i.left&&(i.left.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.left=e),e.parent=i}rotateRight(e){var i=e.left;i&&(e.left=i.right,i.right&&(i.right.parent=e),i.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.right=e),e.parent=i}_splay(e){for(;e.parent;){var i=e.parent;i.parent?i.left===e&&i.parent.left===i?(this.rotateRight(i.parent),this.rotateRight(i)):i.right===e&&i.parent.right===i?(this.rotateLeft(i.parent),this.rotateLeft(i)):i.left===e&&i.parent.right===i?(this.rotateRight(i),this.rotateLeft(i)):(this.rotateLeft(i),this.rotateRight(i)):i.left===e?this.rotateRight(i):this.rotateLeft(i)}}splay(e){for(var i,a,u,f,m;e.parent;)(a=(i=e.parent).parent)&&a.parent?((u=a.parent).left===a?u.left=e:u.right=e,e.parent=u):(e.parent=null,this._root=e),f=e.left,m=e.right,e===i.left?(a&&(a.left===i?(i.right?(a.left=i.right,a.left.parent=a):a.left=null,i.right=a,a.parent=i):(f?(a.right=f,f.parent=a):a.right=null,e.left=a,a.parent=e)),m?(i.left=m,m.parent=i):i.left=null,e.right=i,i.parent=e):(a&&(a.right===i?(i.left?(a.right=i.left,a.right.parent=a):a.right=null,i.left=a,a.parent=i):(m?(a.left=m,m.parent=a):a.left=null,e.right=a,a.parent=e)),f?(i.right=f,f.parent=i):i.right=null,e.left=i,i.parent=e)}replace(e,i){e.parent?e===e.parent.left?e.parent.left=i:e.parent.right=i:this._root=i,i&&(i.parent=e.parent)}minNode(e=this._root){if(e)for(;e.left;)e=e.left;return e}maxNode(e=this._root){if(e)for(;e.right;)e=e.right;return e}insert(e,i){var a=this._root,u=null,f=this._compare;if(this._noDuplicates)for(;a;){if(u=a,f(a.key,e)===0)return;a=f(a.key,e)<0?a.right:a.left}else for(;a;)u=a,a=f(a.key,e)<0?a.right:a.left;return a={key:e,data:i,left:null,right:null,parent:u},u?f(u.key,a.key)<0?u.right=a:u.left=a:this._root=a,this.splay(a),this._size++,a}find(e){for(var i=this._root,a=this._compare;i;){var u=a(i.key,e);if(u<0)i=i.right;else{if(!(u>0))return i;i=i.left}}return null}contains(e){for(var i=this._root,a=this._compare;i;){var u=a(e,i.key);if(u===0)return!0;i=u<0?i.left:i.right}return!1}remove(e){var i=this.find(e);if(!i)return!1;if(this.splay(i),i.left)if(i.right){var a=this.minNode(i.right);a.parent!==i&&(this.replace(a,a.right),a.right=i.right,a.right.parent=a),this.replace(i,a),a.left=i.left,a.left.parent=a}else this.replace(i,i.left);else this.replace(i,i.right);return this._size--,!0}removeNode(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var i=this.minNode(e.right);i.parent!==e&&(this.replace(i,i.right),i.right=e.right,i.right.parent=i),this.replace(e,i),i.left=e.left,i.left.parent=i}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0}erase(e){var i=this.find(e);if(i){this.splay(i);var a=i.left,u=i.right,f=null;a&&(a.parent=null,f=this.maxNode(a),this.splay(f),this._root=f),u&&(a?f.right=u:this._root=u,u.parent=f),this._size--}}pop(){var e=this._root,i=null;if(e){for(;e.left;)e=e.left;i={key:e.key,data:e.data},this.remove(e.key)}return i}next(e){var i=e;if(i)if(i.right)for(i=i.right;i&&i.left;)i=i.left;else for(i=e.parent;i&&i.right===e;)e=i,i=i.parent;return i}prev(e){var i=e;if(i)if(i.left)for(i=i.left;i&&i.right;)i=i.right;else for(i=e.parent;i&&i.left===e;)e=i,i=i.parent;return i}forEach(e){for(var i=this._root,a=[],u=!1,f=0;!u;)i?(a.push(i),i=i.left):a.length>0?(e(i=a.pop(),f++),i=i.right):u=!0;return this}range(e,i,a,u){const f=[],m=this._compare;let _,b=this._root;for(;f.length!==0||b;)if(b)f.push(b),b=b.left;else{if(b=f.pop(),_=m(b.key,i),_>0)break;if(m(b.key,e)>=0&&a.call(u,b))return this;b=b.right}return this}keys(){for(var e=this._root,i=[],a=[],u=!1;!u;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),a.push(e.key),e=e.right):u=!0;return a}values(){for(var e=this._root,i=[],a=[],u=!1;!u;)e?(i.push(e),e=e.left):i.length>0?(e=i.pop(),a.push(e.data),e=e.right):u=!0;return a}at(e){for(var i=this._root,a=[],u=!1,f=0;!u;)if(i)a.push(i),i=i.left;else if(a.length>0){if(i=a.pop(),f===e)return i;f++,i=i.right}else u=!0;return null}load(e=[],i=[],a=!1){if(this._size!==0)throw new Error("bulk-load: tree is not empty");const u=e.length;return a&&K1(e,i,0,u-1,this._compare),this._root=X1(null,e,i,0,u),this._size=u,this}min(){var e=this.minNode(this._root);return e?e.key:null}max(){var e=this.maxNode(this._root);return e?e.key:null}isEmpty(){return this._root===null}get size(){return this._size}static createTree(e,i,a,u,f){return new Z1(a,f).load(e,i,u)}}function X1(s,e,i,a,u){const f=u-a;if(f>0){const m=a+Math.floor(f/2),_={key:e[m],data:i[m],parent:s};return _.left=X1(_,e,i,a,m),_.right=X1(_,e,i,m+1,u),_}return null}function K1(s,e,i,a,u){if(i>=a)return;const f=s[i+a>>1];let m=i-1,_=a+1;for(;;){do m++;while(u(s[m],f)<0);do _--;while(u(s[_],f)>0);if(m>=_)break;let b=s[m];s[m]=s[_],s[_]=b,b=e[m],e[m]=e[_],e[_]=b}K1(s,e,i,_,u),K1(s,e,_+1,a,u)}const nE=11102230246251565e-32,Ns=134217729,MO=(3+8*nE)*nE;function Y1(s,e,i,a,u){let f,m,_,b,S=e[0],I=a[0],C=0,k=0;I>S==I>-S?(f=S,S=e[++C]):(f=I,I=a[++k]);let M=0;if(C<s&&k<i)for(I>S==I>-S?(m=S+f,_=f-(m-S),S=e[++C]):(m=I+f,_=f-(m-I),I=a[++k]),f=m,_!==0&&(u[M++]=_);C<s&&k<i;)I>S==I>-S?(m=f+S,b=m-f,_=f-(m-b)+(S-b),S=e[++C]):(m=f+I,b=m-f,_=f-(m-b)+(I-b),I=a[++k]),f=m,_!==0&&(u[M++]=_);for(;C<s;)m=f+S,b=m-f,_=f-(m-b)+(S-b),S=e[++C],f=m,_!==0&&(u[M++]=_);for(;k<i;)m=f+I,b=m-f,_=f-(m-b)+(I-b),I=a[++k],f=m,_!==0&&(u[M++]=_);return f===0&&M!==0||(u[M++]=f),M}function Km(s){return new Float64Array(s)}const rf=Km(4),sE=Km(8),oE=Km(12),aE=Km(16),no=Km(4);function Ym(s,e,i){e===null?(s.inOut=!1,s.otherInOut=!0):(s.isSubject===e.isSubject?(s.inOut=!e.inOut,s.otherInOut=e.otherInOut):(s.inOut=!e.otherInOut,s.otherInOut=e.isVertical()?!e.inOut:e.inOut),e&&(s.prevInResult=!lE(e,i)||e.isVertical()?e.prevInResult:e)),s.resultTransition=lE(s,i)?function(a,u){let f,m=!a.inOut,_=!a.otherInOut;switch(u){case 0:f=m&&_;break;case 1:f=m||_;break;case 3:f=m!==_;break;case 2:f=a.isSubject?m&&!_:_&&!m}return f?1:-1}(s,i):0}function lE(s,e){switch(s.type){case 0:switch(e){case 0:return!s.otherInOut;case 1:return s.otherInOut;case 2:return s.isSubject&&s.otherInOut||!s.isSubject&&!s.otherInOut;case 3:return!0}break;case 2:return e===0||e===1;case 3:return e===2;case 1:return!1}return!1}class nf{constructor(e,i,a,u,f){this.left=i,this.point=e,this.otherEvent=a,this.isSubject=u??!1,this.type=f||0,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0}isBelow(e){const i=this.point,a=this.otherEvent.point;return this.left?(i[0]-e[0])*(a[1]-e[1])-(a[0]-e[0])*(i[1]-e[1])>0:(a[0]-e[0])*(i[1]-e[1])-(i[0]-e[0])*(a[1]-e[1])>0}isAbove(e){return!this.isBelow(e)}isVertical(){return this.point[0]===this.otherEvent.point[0]}get inResult(){return this.resultTransition!==0}clone(){const e=new nf(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e}}function bl(s,e){return s[0]===e[0]&&s[1]===e[1]}function J1(s,e,i){const a=function(u,f,m,_,b,S){const I=(f-S)*(m-b),C=(u-b)*(_-S),k=I-C;if(I===0||C===0||I>0!=C>0)return k;const M=Math.abs(I+C);return Math.abs(k)>=33306690738754716e-32*M?k:-function(R,F,$,U,H,X,Q){let ae,oe,ge,ye,me,Se,Ae,Ze,Ge,qe,et,Je,Qe,Ne,it,Ke,rt,tt;const St=R-H,Et=$-H,mt=F-X,_t=U-X;Ne=St*_t,Se=Ns*St,Ae=Se-(Se-St),Ze=St-Ae,Se=Ns*_t,Ge=Se-(Se-_t),qe=_t-Ge,it=Ze*qe-(Ne-Ae*Ge-Ze*Ge-Ae*qe),Ke=mt*Et,Se=Ns*mt,Ae=Se-(Se-mt),Ze=mt-Ae,Se=Ns*Et,Ge=Se-(Se-Et),qe=Et-Ge,rt=Ze*qe-(Ke-Ae*Ge-Ze*Ge-Ae*qe),et=it-rt,me=it-et,rf[0]=it-(et+me)+(me-rt),Je=Ne+et,me=Je-Ne,Qe=Ne-(Je-me)+(et-me),et=Qe-Ke,me=Qe-et,rf[1]=Qe-(et+me)+(me-Ke),tt=Je+et,me=tt-Je,rf[2]=Je-(tt-me)+(et-me),rf[3]=tt;let Vt=function(Bi,mi){let Ji=mi[0];for(let ki=1;ki<4;ki++)Ji+=mi[ki];return Ji}(0,rf),Rt=22204460492503146e-32*Q;if(Vt>=Rt||-Vt>=Rt||(me=R-St,ae=R-(St+me)+(me-H),me=$-Et,ge=$-(Et+me)+(me-H),me=F-mt,oe=F-(mt+me)+(me-X),me=U-_t,ye=U-(_t+me)+(me-X),ae===0&&oe===0&&ge===0&&ye===0)||(Rt=11093356479670487e-47*Q+MO*Math.abs(Vt),Vt+=St*ye+_t*ae-(mt*ge+Et*oe),Vt>=Rt||-Vt>=Rt))return Vt;Ne=ae*_t,Se=Ns*ae,Ae=Se-(Se-ae),Ze=ae-Ae,Se=Ns*_t,Ge=Se-(Se-_t),qe=_t-Ge,it=Ze*qe-(Ne-Ae*Ge-Ze*Ge-Ae*qe),Ke=oe*Et,Se=Ns*oe,Ae=Se-(Se-oe),Ze=oe-Ae,Se=Ns*Et,Ge=Se-(Se-Et),qe=Et-Ge,rt=Ze*qe-(Ke-Ae*Ge-Ze*Ge-Ae*qe),et=it-rt,me=it-et,no[0]=it-(et+me)+(me-rt),Je=Ne+et,me=Je-Ne,Qe=Ne-(Je-me)+(et-me),et=Qe-Ke,me=Qe-et,no[1]=Qe-(et+me)+(me-Ke),tt=Je+et,me=tt-Je,no[2]=Je-(tt-me)+(et-me),no[3]=tt;const xt=Y1(4,rf,4,no,sE);Ne=St*ye,Se=Ns*St,Ae=Se-(Se-St),Ze=St-Ae,Se=Ns*ye,Ge=Se-(Se-ye),qe=ye-Ge,it=Ze*qe-(Ne-Ae*Ge-Ze*Ge-Ae*qe),Ke=mt*ge,Se=Ns*mt,Ae=Se-(Se-mt),Ze=mt-Ae,Se=Ns*ge,Ge=Se-(Se-ge),qe=ge-Ge,rt=Ze*qe-(Ke-Ae*Ge-Ze*Ge-Ae*qe),et=it-rt,me=it-et,no[0]=it-(et+me)+(me-rt),Je=Ne+et,me=Je-Ne,Qe=Ne-(Je-me)+(et-me),et=Qe-Ke,me=Qe-et,no[1]=Qe-(et+me)+(me-Ke),tt=Je+et,me=tt-Je,no[2]=Je-(tt-me)+(et-me),no[3]=tt;const Jt=Y1(xt,sE,4,no,oE);Ne=ae*ye,Se=Ns*ae,Ae=Se-(Se-ae),Ze=ae-Ae,Se=Ns*ye,Ge=Se-(Se-ye),qe=ye-Ge,it=Ze*qe-(Ne-Ae*Ge-Ze*Ge-Ae*qe),Ke=oe*ge,Se=Ns*oe,Ae=Se-(Se-oe),Ze=oe-Ae,Se=Ns*ge,Ge=Se-(Se-ge),qe=ge-Ge,rt=Ze*qe-(Ke-Ae*Ge-Ze*Ge-Ae*qe),et=it-rt,me=it-et,no[0]=it-(et+me)+(me-rt),Je=Ne+et,me=Je-Ne,Qe=Ne-(Je-me)+(et-me),et=Qe-Ke,me=Qe-et,no[1]=Qe-(et+me)+(me-Ke),tt=Je+et,me=tt-Je,no[2]=Je-(tt-me)+(et-me),no[3]=tt;const yi=Y1(Jt,oE,4,no,aE);return aE[yi-1]}(u,f,m,_,b,S,M)}(s[0],s[1],e[0],e[1],i[0],i[1]);return a>0?-1:a<0?1:0}function Kc(s,e){const i=s.point,a=e.point;return i[0]>a[0]?1:i[0]<a[0]?-1:i[1]!==a[1]?i[1]>a[1]?1:-1:function(u,f,m){return u.left!==f.left?u.left?1:-1:J1(m,u.otherEvent.point,f.otherEvent.point)!==0?u.isBelow(f.otherEvent.point)?-1:1:!u.isSubject&&f.isSubject?1:-1}(s,e,i)}function Yc(s,e,i){const a=new nf(e,!1,s,s.isSubject),u=new nf(e,!0,s.otherEvent,s.isSubject);return bl(s.point,s.otherEvent.point)&&console.warn("what is that, a collapsed segment?",s),a.contourId=u.contourId=s.contourId,Kc(u,s.otherEvent)>0&&(s.otherEvent.left=!0,u.left=!1),s.otherEvent.otherEvent=u,s.otherEvent=a,i.push(u),i.push(a),i}function xv(s,e){return s[0]*e[1]-s[1]*e[0]}function Q1(s,e){return s[0]*e[0]+s[1]*e[1]}function eb(s,e,i){const a=function(b,S,I,C){const k=[S[0]-b[0],S[1]-b[1]],M=[C[0]-I[0],C[1]-I[1]];function R(ge,ye,me){return[ge[0]+ye*me[0],ge[1]+ye*me[1]]}const F=[I[0]-b[0],I[1]-b[1]];let $=xv(k,M),U=$*$;const H=Q1(k,k);if(U>0){const ge=xv(F,M)/$;if(ge<0||ge>1)return null;const ye=xv(F,k)/$;return ye<0||ye>1?null:ge===0||ge===1?[R(b,ge,k)]:ye===0||ye===1?[R(I,ye,M)]:[R(b,ge,k)]}if($=xv(F,k),U=$*$,U>0)return null;const X=Q1(k,F)/H,Q=X+Q1(k,M)/H,ae=Math.min(X,Q),oe=Math.max(X,Q);return ae<=1&&oe>=0?ae===1?[R(b,ae>0?ae:0,k)]:oe===0?[R(b,oe<1?oe:1,k)]:[R(b,ae>0?ae:0,k),R(b,oe<1?oe:1,k)]:null}(s.point,s.otherEvent.point,e.point,e.otherEvent.point),u=a?a.length:0;if(u===0||u===1&&(bl(s.point,e.point)||bl(s.otherEvent.point,e.otherEvent.point))||u===2&&s.isSubject===e.isSubject)return 0;if(u===1)return!bl(s.point,a[0])&&!bl(s.otherEvent.point,a[0])&&Yc(s,a[0],i),!bl(e.point,a[0])&&!bl(e.otherEvent.point,a[0])&&Yc(e,a[0],i),1;const f=[];let m=!1,_=!1;return bl(s.point,e.point)?m=!0:Kc(s,e)===1?f.push(e,s):f.push(s,e),bl(s.otherEvent.point,e.otherEvent.point)?_=!0:Kc(s.otherEvent,e.otherEvent)===1?f.push(e.otherEvent,s.otherEvent):f.push(s.otherEvent,e.otherEvent),m&&_||m?(e.type=1,s.type=e.inOut===s.inOut?2:3,m&&!_&&Yc(f[1].otherEvent,f[0].point,i),2):_?(Yc(f[0],f[1].point,i),3):f[0]!==f[3].otherEvent?(Yc(f[0],f[1].point,i),Yc(f[1],f[2].point,i),3):(Yc(f[0],f[1].point,i),Yc(f[3].otherEvent,f[2].point,i),3)}function RO(s,e){if(s===e)return 0;if(J1(s.point,s.otherEvent.point,e.point)!==0||J1(s.point,s.otherEvent.point,e.otherEvent.point)!==0)return bl(s.point,e.point)?s.isBelow(e.otherEvent.point)?-1:1:s.point[0]===e.point[0]?s.point[1]<e.point[1]?-1:1:Kc(s,e)===1?e.isAbove(s.point)?-1:1:s.isBelow(e.point)?-1:1;if(s.isSubject!==e.isSubject)return s.isSubject?-1:1;{let i=s.point,a=e.point;if(i[0]===a[0]&&i[1]===a[1])return i=s.otherEvent.point,a=e.otherEvent.point,i[0]===a[0]&&i[1]===a[1]?0:(s.contourId??0)>(e.contourId??0)?1:-1}return Kc(s,e)===1?1:-1}class DO{constructor(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null}isExterior(){return this.holeOf==null}}function OO(s,e,i,a){let u,f=s+1,m=e[s].point;const _=e.length;for(f<_&&(u=e[f].point);f<_&&u[0]===m[0]&&u[1]===m[1];){if(!i[f])return f;f++,f<_&&(u=e[f].point)}for(f=s-1;i[f]&&f>a;)f--;return f}function zO(s,e,i){const a=new DO;if(s.prevInResult!=null){const u=s.prevInResult,f=u.outputContourId;if(u.resultTransition>0){const m=e[f];if(m.holeOf!=null){const _=m.holeOf;e[_].holeIds.push(i),a.holeOf=_,a.depth=e[f].depth}else e[f].holeIds.push(i),a.holeOf=f,a.depth=e[f].depth+1}else a.holeOf=null,a.depth=e[f].depth}else a.holeOf=null,a.depth=0;return a}const cE=Math.max,uE=Math.min;let bv=0;function hE(s,e,i,a,u,f){let m,_,b,S,I,C;for(m=0,_=s.length-1;m<_;m++){if(b=s[m],S=s[m+1],I=new nf(b,!1,void 0,e),C=new nf(S,!1,I,e),I.otherEvent=C,b[0]===S[0]&&b[1]===S[1])continue;I.contourId=C.contourId=i,f||(I.isExteriorRing=!1,C.isExteriorRing=!1),Kc(I,C)>0?C.left=!0:I.left=!0;const k=b[0],M=b[1];u[0]=uE(u[0],k),u[1]=uE(u[1],M),u[2]=cE(u[2],k),u[3]=cE(u[3],M),a.push(I),a.push(C)}}const wv=[];function dE(s,e,i){let a=s,u=e;typeof s[0][0][0]=="number"&&(a=[s]),typeof e[0][0][0]=="number"&&(u=[e]);let f=function(k,M,R){let F=null;return k.length*M.length===0&&(R===0?F=wv:R===2?F=k:(R===1||R===3)&&(F=k.length===0?M:k)),F}(a,u,i);if(f)return f===wv?null:f;const m=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],b=function(k,M,R,F,$){const U=new qu(void 0,Kc);let H,X,Q,ae,oe,ge;for(Q=0,ae=k.length;Q<ae;Q++)for(H=k[Q],oe=0,ge=H.length;oe<ge;oe++)X=oe===0,X&&bv++,hE(H[oe],!0,bv,U,R,X);for(Q=0,ae=M.length;Q<ae;Q++)for(H=M[Q],oe=0,ge=H.length;oe<ge;oe++)X=oe===0,$===2&&(X=!1),X&&bv++,hE(H[oe],!1,bv,U,F,X);return U}(a,u,m,_,i);if(f=function(k,M,R,F,$){let U=null;return(R[0]>F[2]||F[0]>R[2]||R[1]>F[3]||F[1]>R[3])&&($===0?U=wv:$===2?U=k:($===1||$===3)&&(U=k.concat(M))),U}(a,u,m,_,i),f)return f===wv?null:f;const S=function(k,M,R,F,$,U){const H=new Z1(RO),X=[],Q=Math.min(F[2],$[2]);let ae,oe,ge;for(;k.length!==0;){let ye=k.pop();if(X.push(ye),U===0&&ye.point[0]>Q||U===2&&ye.point[0]>F[2])break;if(ye.left){oe=ae=H.insert(ye),ge=H.minNode(),ae=ae!==ge?H.prev(ae):null,oe=H.next(oe);const me=ae?ae.key:null;let Se;if(Ym(ye,me,U),oe&&eb(ye,oe.key,k)===2&&(Ym(ye,me,U),Ym(oe.key,ye,U)),ae&&eb(ae.key,ye,k)===2){let Ae=ae;Ae=Ae!==ge?H.prev(Ae):null,Se=Ae?Ae.key:null,Ym(me,Se,U),Ym(ye,me,U)}}else ye=ye.otherEvent,oe=ae=H.find(ye),ae&&oe&&(ae=ae!==ge?H.prev(ae):null,oe=H.next(oe),H.remove(ye),oe&&ae&&eb(ae.key,oe.key,k))}return X}(b,0,0,m,_,i),I=function(k){let M,R;const F=function(H){let X,Q,ae,oe,ge;const ye=[];for(Q=0,ae=H.length;Q<ae;Q++)X=H[Q],(X.left&&X.inResult||!X.left&&X.otherEvent.inResult)&&ye.push(X);let me=!1;for(;!me;)for(me=!0,Q=0,ae=ye.length;Q<ae;Q++)Q+1<ae&&Kc(ye[Q],ye[Q+1])===1&&(oe=ye[Q],ye[Q]=ye[Q+1],ye[Q+1]=oe,me=!1);for(Q=0,ae=ye.length;Q<ae;Q++)X=ye[Q],X.otherPos=Q;for(Q=0,ae=ye.length;Q<ae;Q++)X=ye[Q],X.left||(ge=X.otherPos,X.otherPos=X.otherEvent.otherPos,X.otherEvent.otherPos=ge);return ye}(k),$={},U=[];for(M=0,R=F.length;M<R;M++){if($[M])continue;const H=U.length,X=zO(F[M],U,H),Q=ge=>{$[ge]=!0,ge<F.length&&F[ge]&&(F[ge].outputContourId=H)};let ae=M,oe=M;for(X.points.push(F[M].point);Q(ae),ae=F[ae].otherPos,Q(ae),X.points.push(F[ae].point),ae=OO(ae,F,$,oe),!(ae==oe||ae>=F.length)&&F[ae];);U.push(X)}return U}(S),C=[];for(let k=0;k<I.length;k++){let M=I[k];if(M.isExterior()){let R=[M.points];for(let F=0;F<M.holeIds.length;F++)R.push(I[M.holeIds[F]].points);C.push(R)}}return C}function Sv(s,e,i,a){const u=[],f=a===0?(m,_,b,S,I,C)=>{m.push(new at(C,b+(C-_)/(S-_)*(I-b)))}:(m,_,b,S,I,C)=>{m.push(new at(_+(C-b)/(I-b)*(S-_),C))};for(const m of s){const _=[];for(const b of m){if(b.length<=2)continue;const S=[];for(let k=0;k<b.length-1;k++){const M=b[k].x,R=b[k].y,F=b[k+1].x,$=b[k+1].y,U=a===0?M:R,H=a===0?F:$;U<e?H>e&&f(S,M,R,F,$,e):U>i?H<i&&f(S,M,R,F,$,i):S.push(b[k]),H<e&&U>=e&&f(S,M,R,F,$,e),H>i&&U<=i&&f(S,M,R,F,$,i)}let I=b[b.length-1];const C=a===0?I.x:I.y;C>=e&&C<=i&&S.push(I),S.length&&(I=S[S.length-1],S[0].x===I.x&&S[0].y===I.y||S.push(S[0]),_.push(S))}_.length&&u.push(_)}return u}function BO(s,e){const i=dE(tb(s),tb([e]),0);return i==null?[]:fE(i)}function FO(s,e){let a=tb(s,65536);const u=[];for(;e.valid();e.next()){const[f,m]=e.get(),_=f.x*65536,b=f.y*65536,S=m.x*65536,I=m.y*65536,C=S-_,k=I-b,M=Math.hypot(C,k);if(M===0)continue;const R=Math.trunc(k/M*3),F=-Math.trunc(C/M*3);u.push([[[_,b],[S,I],[S+R,I+F],[_+R,b+F],[_,b]]])}return u.length>0&&(a=dE(a,u,2)),fE(a,1/65536,128)}function tb(s,e=1){return[s.map(i=>i.map(a=>[a.x*e,a.y*e]))]}function fE(s,e=1,i){return s.map(a=>a.map((u,f)=>{const m=u.map(_=>{let b=_[0],S=_[1];return i&&(b=Math.round(b/i)*i,S=Math.round(S/i)*i),new at(b*e,S*e)._round()});return f>0&&m.reverse(),m}))}class ib{constructor(e,i){this.layoutVertexArray=new yl,this.indexArray=new en,this.lineIndexArray=new Qs,this.triangleSegments=new xr,this.lineSegments=new xr,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Tn)}update(e,i,a,u,f,m,_,b){this.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,b)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,_O.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,i,a,u,f,m,_){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,i,a,u,f,m,void 0,_)}}class rb{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new ib(e,!1),this.elevationBufferData=new ib(e,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,u){}populate(e,i,a,u){this.hasPattern=W1("fill",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("fill-sort-key"),m=[];for(const{feature:_,id:b,index:S,sourceLayerIndex:I}of e){const C=this.layers[0]._featureFilter.needGeometry,k=ci(_,C);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,a))continue;const M=f?f.evaluate(k,{},a,i.availableImages):void 0,R={id:b,properties:_.properties,type:_.type,sourceLayerIndex:I,index:S,geometry:C?k.geometry:Xt(_,a,u),patterns:{},sortKey:M};m.push(R)}f&&m.sort((_,b)=>_.sortKey-b.sortKey);for(const _ of m){const{geometry:b,index:S,sourceLayerIndex:I}=_;if(this.hasPattern){const C=q1("fill",this.layers,_,this.zoom,this.pixelRatio,i);this.patternFeatures.push(C)}else this.addFeature(_,b,S,a,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(e[S].feature,b,S,I,this.index)}}update(e,i,a,u,f,m,_){this.bufferData.update(e,i,a,u,f,m,_,this.worldview),this.elevationBufferData.update(e,i,a,u,f,m,_,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,i,a,u,f,m,_,this.worldview)}addFeatures(e,i,a,u,f,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,u,m,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,i,a,u,f,m=[],_,b){const S=Xm(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(e,S,u,a,b):this.addGeometry(S,this.bufferData),this.bufferData.populatePaintArrays(e,a,f,m,u,_,this.worldview),this.elevationBufferData.populatePaintArrays(e,a,f,m,u,_,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}setEvaluatedPortalGraph(e,i,a,u,f){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(i,a,u,f,this.worldview))}addElevatedRoadFeature(e,i,a,u,f){const m=new Array,_=cs.getElevationFeature(e,f);if(!_)return void this.addGeometry(i,this.bufferData);{const S=this.clipPolygonsToTile(i,1);S.length>0&&m.push({polygons:S,elevationFeature:_,elevationTileID:a})}const b={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},a),featureIndex:u};for(const S of m)if(S.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ro(S.elevationTileID,this.layers,this.zoom,this.lut));const C=S.elevationFeature.isTunnel();let k=0;e.properties.hasOwnProperty(ai)&&(k=+e.properties[ai]),this.elevatedStructures.addPortalCandidates(S.elevationFeature.id,S.polygons,C,S.elevationFeature,k)}S.elevationFeature.constantHeight==null&&(S.polygons=this.prepareElevatedPolygons(S.polygons,S.elevationFeature,S.elevationTileID));const I=new So(a,S.elevationTileID);this.addElevatedGeometry(S.polygons,I,S.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,u,b)}}addElevatedGeometry(e,i,a,u,f,m){const _={elevation:a,elevationSampler:i,bias:u,index:f,featureInfo:m},[b,S]=this.addGeometry(e,this.elevationBufferData,_);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:b,max:S}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,b),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,S))}addGeometry(e,i,a){let u=Number.POSITIVE_INFINITY,f=Number.NEGATIVE_INFINITY,m=null;a&&(m=a.elevationSampler.constantElevation(a.elevation,a.bias),m!=null&&(u=m,f=m));const _=(b,S,I)=>{if(a!=null)if(S.push(b),m!=null)i.elevatedLayoutVertexArray.emplaceBack(m),I.push(m);else{const C=a.elevationSampler.pointElevation(b,a.elevation,a.bias);i.elevatedLayoutVertexArray.emplaceBack(C),I.push(C),u=Math.min(u,C),f=Math.max(f,C)}};for(const b of e){let S=0;for(const X of b)S+=X.length;const I=i.triangleSegments.prepareSegment(S,i.layoutVertexArray,i.indexArray),C=I.vertexLength,k=[],M=[],R=[],F=[],$=[],U=i.layoutVertexArray.length;for(const X of b){if(X.length===0)continue;X!==b[0]&&M.push(k.length/2);const Q=i.lineSegments.prepareSegment(X.length,i.layoutVertexArray,i.lineIndexArray),ae=Q.vertexLength;a&&$.push(i.layoutVertexArray.length-U),_(X[0],R,F),i.layoutVertexArray.emplaceBack(X[0].x,X[0].y),i.lineIndexArray.emplaceBack(ae+X.length-1,ae),k.push(X[0].x),k.push(X[0].y);for(let oe=1;oe<X.length;oe++)_(X[oe],R,F),i.layoutVertexArray.emplaceBack(X[oe].x,X[oe].y),i.lineIndexArray.emplaceBack(ae+oe-1,ae+oe),k.push(X[oe].x),k.push(X[oe].y);Q.vertexLength+=X.length,Q.primitiveLength+=X.length}const H=ef(k,M);for(let X=0;X<H.length;X+=3)i.indexArray.emplaceBack(C+H[X],C+H[X+1],C+H[X+2]);if(H.length>0&&a&&this.elevationMode==="hd-road-base"){const X=a.elevation.isTunnel(),Q=a.elevation.safeArea,ae=this.elevatedStructures.addVertices(R,F);this.elevatedStructures.addTriangles(H,ae,X);const oe=$.length;if(oe>0){for(let ge=0;ge<oe-1;ge++)this.elevatedStructures.addRenderableRing(a.index,$[ge]+ae,$[ge+1]-$[ge],X,Q,a.featureInfo);this.elevatedStructures.addRenderableRing(a.index,$[oe-1]+ae,R.length-$[oe-1],X,Q,a.featureInfo)}}I.vertexLength+=S,I.primitiveLength+=H.length/3}return[u,f]}prepareElevatedPolygons(e,i,a){const u=1/ht(a),f=[];for(const m of e){const _=FO(m,new Bs(i,u));f.push(..._)}return f}clipPolygonsToTile(e,i){const a=-i,u=-i,f=gt+i,m=gt+i;let _=0;const b=[],S=[];for(;_<e.length;_++){const k=e[_],M=Wu(k);(M.min.x>=a&&M.max.x<=f&&M.min.y>=u&&M.max.y<=m?b:S).push(k)}if(b.length===e.length)return e;const I=[new at(a,u),new at(f,u),new at(f,m),new at(a,m),new at(a,u)],C=b;for(const k of S)C.push(...BO(k,I));return C}}let pE,mE,gE,_E;Ct(rb,"FillBucket",{omit:["layers","patternFeatures"]}),Ct(ib,"FillBufferData"),Ct(ro,"ElevatedStructures");class Tv{constructor(e,i,a,u){if(this.triangleCount=i.length/3,this.min=new at(0,0),this.max=new at(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||e.length===0)return;const[f,m]=[e[0].clone(),e[0].clone()];for(let C=1;C<e.length;++C){const k=e[C];f.x=Math.min(f.x,k.x),f.y=Math.min(f.y,k.y),m.x=Math.max(m.x,k.x),m.y=Math.max(m.y,k.y)}if(u){const C=Math.ceil(Math.max(m.x-f.x,m.y-f.y)/u);a=Math.max(a,C)}if(a===0)return;this.min=f,this.max=m;const _=this.max.sub(this.min);_.x=Math.max(_.x,1),_.y=Math.max(_.y,1);const b=Math.max(_.x,_.y)/a;this.cellsX=Math.max(1,Math.ceil(_.x/b)),this.cellsY=Math.max(1,Math.ceil(_.y/b)),this.xScale=1/b,this.yScale=1/b;const S=[];for(let C=0;C<this.triangleCount;C++){const k=e[i[3*C+0]].sub(this.min),M=e[i[3*C+1]].sub(this.min),R=e[i[3*C+2]].sub(this.min),F=wl(Math.floor(Math.min(k.x,M.x,R.x)),this.xScale,this.cellsX),$=wl(Math.floor(Math.max(k.x,M.x,R.x)),this.xScale,this.cellsX),U=wl(Math.floor(Math.min(k.y,M.y,R.y)),this.yScale,this.cellsY),H=wl(Math.floor(Math.max(k.y,M.y,R.y)),this.yScale,this.cellsY),X=new at(0,0),Q=new at(0,0),ae=new at(0,0),oe=new at(0,0);for(let ge=U;ge<=H;++ge){X.y=Q.y=ge*b,ae.y=oe.y=(ge+1)*b;for(let ye=F;ye<=$;++ye)X.x=ae.x=ye*b,Q.x=oe.x=(ye+1)*b,(ja(k,M,R,X,Q,oe)||ja(k,M,R,X,oe,ae))&&S.push({cellIdx:ge*this.cellsX+ye,triIdx:C})}}if(S.length===0)return;S.sort((C,k)=>C.cellIdx-k.cellIdx||C.triIdx-k.triIdx);let I=0;for(;I<S.length;){const C=S[I].cellIdx,k={start:this.payload.length,len:0};for(;I<S.length&&S[I].cellIdx===C;)++k.len,this.payload.push(S[I++].triIdx);this.cells[C]=k}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,i){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const a=wl(e.x-this.min.x,this.xScale,this.cellsX),u=wl(e.y-this.min.y,this.yScale,this.cellsY),f=this.cells[u*this.cellsX+a];if(f){this._lazyInitLookup();for(let m=0;m<f.len;m++){const _=this.payload[f.start+m],b=Math.floor(_/8),S=1<<_%8;if(!(this.lookup[b]&S)&&(this.lookup[b]|=S,i.push(_),i.length===this.triangleCount))return}}}query(e,i,a){if(this.triangleCount===0||this.cells.length===0||e.x>this.max.x||this.min.x>i.x||e.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const u=wl(e.x-this.min.x,this.xScale,this.cellsX),f=wl(i.x-this.min.x,this.xScale,this.cellsX),m=wl(e.y-this.min.y,this.yScale,this.cellsY),_=wl(i.y-this.min.y,this.yScale,this.cellsY);for(let b=m;b<=_;b++)for(let S=u;S<=f;S++){const I=this.cells[b*this.cellsX+S];if(I)for(let C=0;C<I.len;C++){const k=this.payload[I.start+C],M=Math.floor(k/8),R=1<<k%8;if(!(this.lookup[M]&R)&&(this.lookup[M]|=R,a.push(k),a.length===this.triangleCount))return}}}}function wl(s,e,i){return Math.max(0,Math.min(i-1,Math.floor(s*e)))}Ct(Tv,"TriangleGridIndex");class yE{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){for(const a of this.footprints)i.push({footprint:a,id:e})}updateAppearances(e,i,a,u){}populate(e,i,a,u){const f=[];for(const{feature:m,id:_,index:b,sourceLayerIndex:S}of e){const I=this.layers[0]._featureFilter.needGeometry,C=ci(m,I);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),C,a))continue;const k={id:_,properties:m.properties,type:m.type,sourceLayerIndex:S,index:b,geometry:I?C.geometry:Xt(m,a,u),patterns:{}};f.push(k)}for(const m of f){const{geometry:_,index:b,sourceLayerIndex:S}=m;this.addFeature(m,_,b,a,{},i.availableImages,i.brightness),i.featureIndex.insert(e[b].feature,_,b,S,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(e){}update(e,i,a,u,f,m,_){}destroy(){}addFeature(e,i,a,u,f,m=[],_){for(const b of Xm(i,2)){const S=[],I=[],C=[],k=new at(1/0,1/0),M=new at(-1/0,-1/0);for(const $ of b)if($.length!==0){$!==b[0]&&C.push(I.length/2);for(let U=0;U<$.length;U++)I.push($[U].x),I.push($[U].y),S.push($[U]),k.x=Math.min(k.x,$[U].x),k.y=Math.min(k.y,$[U].y),M.x=Math.max(M.x,$[U].x),M.y=Math.max(M.y,$[U].y)}const R=ef(I,C),F=new Tv(S,R,8,256);this.footprints.push({vertices:S,indices:R,grid:F,min:k,max:M})}}}Ct(yE,"ClipBucket",{omit:["layers"]});const jO=wi([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),NO=wi([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),UO=wi([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),VO=wi([{name:"a_centroid_pos",components:2,type:"Uint16"}]),$O=wi([{name:"a_join_normal_inside",components:3,type:"Int16"}]),GO=wi([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),HO=wi([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:WO}=jO,Jm=Number.MAX_SAFE_INTEGER,qO=Jm-1;function vE(s,e,i,a){return s.order<e||s.order===Jm||!(s.clipMask&i)||function(u,f){return f.length!==0&&f.find(m=>m===u)===void 0}(a,s.clipScope)}function Ev(s,e){return s.x-e.x||s.y-e.y}function xE(s,e){return Ev(s.min,e.min)===0&&Ev(s.max,e.max)===0}function nb(s,e){return!(s.min.x>e.max.x||s.max.x<e.min.x||s.min.y>e.max.y||s.max.y<e.min.y)}function Iv(s,e){if(s.length!==e.length)return!1;for(let i=0;i<s.length;i++)if(s[i].sourceId!==e[i].sourceId||!xE(s[i],e[i])||s[i].order!==e[i].order||s[i].clipMask!==e[i].clipMask||!Li(s[i].clipScope,e[i].clipScope))return!1;return!0}function bE(s,e,i){const a=1/gt,u=1/(1<<i.canonical.z),f=(e.x*a+i.canonical.x)*u+i.wrap,m=(e.y*a+i.canonical.y)*u;return{min:new at((s.x*a+i.canonical.x)*u+i.wrap,(s.y*a+i.canonical.y)*u),max:new at(f,m)}}function ZO(s,e,i){const a=1<<i.canonical.z,u=((e.x-i.wrap)*a-i.canonical.x)*gt,f=(e.y*a-i.canonical.y)*gt;return{min:new at(((s.x-i.wrap)*a-i.canonical.x)*gt,(s.y*a-i.canonical.y)*gt),max:new at(u,f)}}function sb(s,e,i,a,u,f,m){const _=s.indices,b=s.vertices,S=[];for(let I=a;I<a+u;I+=3){const C=e[i[I+0]+f],k=e[i[I+1]+f],M=e[i[I+2]+f],R=Math.min(C.x,k.x,M.x),F=Math.max(C.x,k.x,M.x),$=Math.min(C.y,k.y,M.y),U=Math.max(C.y,k.y,M.y);S.length=0,s.grid.query(new at(R,$),new at(F,U),S);for(let H=0;H<S.length;H++){const X=S[H];if(ja(b[_[3*X+0]],b[_[3*X+1]],b[_[3*X+2]],C,k,M,m))return!0}}return!1}function wE(s,e,i,a){if(!s||!i)return!1;let u=s.vertices;if(!e.canonical.equals(a.canonical)||e.wrap!==a.wrap){if(i.vertices.length<s.vertices.length)return wE(i,a,s,e);const f=e.canonical,m=a.canonical,_=Math.pow(2,m.z-f.z);u=s.vertices.map(b=>new at((b.x+f.x*gt)*_-m.x*gt,(b.y+f.y*gt)*_-m.y*gt))}return sb(i,u,s.indices,0,s.indices.length,0,0)}function SE(s,e,i,a){const u=Math.pow(2,a.z-i.z);return new at((s+i.x*gt)*u-a.x*gt,(e+i.y*gt)*u-a.y*gt)}function TE(s,e){const i=[];e.grid.queryPoint(s,i);const a=e.indices,u=e.vertices;for(let f=0;f<i.length;f++){const m=i[f];if(js([u[a[3*m+0]],u[a[3*m+1]],u[a[3*m+2]]],s))return!0}return!1}const ob=[new at(0,0),new at(gt,0),new at(gt,gt),new at(0,gt)];function EE(s,e){const i=[];let a=[];if(!e||s.length<2)return[s];if(s.length===2)return pa(s[0],s[1],ob)?[s]:[];for(let u=0;u<s.length+2;u++){const f=s[u%s.length],m=s[(u+1)%s.length],_=pa(u===0?s[s.length-1]:s[(u-1)%s.length],f,ob),b=pa(f,m,ob),S=_||b;S&&a.push(f),S&&b||a.length>0&&(a.length>1&&i.push(a),a=[])}return a.length>1&&i.push(a),i}const ab=Ti.types,XO=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],KO=["fill-extrusion-flood-light-ground-radius"],YO=Math.pow(2,13),JO=Math.pow(2,15)-1,IE=new at(0,1),Yl=2147483648;function Qm(s,e,i,a,u,f,m,_){s.emplaceBack((e<<1)+m,(i<<1)+f,(Math.floor(a*YO)<<1)+u,Math.round(_))}function eg(s,e,i){s.emplaceBack(e.x*gt,e.y*gt,i?1:0)}function Av(s,e,i,a,u,f){s.emplaceBack(e.x,e.y,(i.x<<1)+a,(i.y<<1)+u,f)}function tg(s,e,i){s.emplaceBack(e.x,e.y,e.z,i[0]*16384,i[1]*16384,i[2]*16384)}class AE{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class CE{constructor(){this.centroidXY=new at(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new at(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new at(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new at(this.max.x-this.min.x,this.max.y-this.min.y)}}class kE{constructor(){this.acc=new at(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,i){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=i.x,e.min.y=e.max.y=i.y)}appendEdge(e,i,a){this.accCount++,this.acc._add(i);let u=!!this.borders;i.x<e.min.x?(e.min.x=i.x,u=!0):i.x>e.max.x&&(e.max.x=i.x,u=!0),i.y<e.min.y?(e.min.y=i.y,u=!0):i.y>e.max.y&&(e.max.y=i.y,u=!0),((i.x===0||i.x===gt)&&i.x===a.x)!=((i.y===0||i.y===gt)&&i.y===a.y)&&this.processBorderOverlap(i,a),u&&this.checkBorderIntersection(i,a)}checkBorderIntersection(e,i){i.x<0!=e.x<0&&this.addBorderIntersection(0,qt(i.y,e.y,(0-i.x)/(e.x-i.x))),i.x>gt!=e.x>gt&&this.addBorderIntersection(1,qt(i.y,e.y,(gt-i.x)/(e.x-i.x))),i.y<0!=e.y<0&&this.addBorderIntersection(2,qt(i.x,e.x,(0-i.y)/(e.y-i.y))),i.y>gt!=e.y>gt&&this.addBorderIntersection(3,qt(i.x,e.x,(gt-i.y)/(e.y-i.y)))}addBorderIntersection(e,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const a=this.borders[e];i<a[0]&&(a[0]=i),i>a[1]&&(a[1]=i)}processBorderOverlap(e,i){if(e.x===i.x){if(e.y===i.y)return;const a=e.x===0?0:1;this.addBorderIntersection(a,i.y),this.addBorderIntersection(a,e.y)}else{const a=e.y===0?2:3;this.addBorderIntersection(a,i.x),this.addBorderIntersection(a,e.x)}}centroid(){return this.accCount===0?new at(0,0):new at(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,i)=>e+ +(i[0]!==Number.MAX_VALUE),0):0}}function LE(s,e){const i=s.add(e)._unit(),a=pe(s.x*i.x+s.y*i.y,-1,1);var u,f,m;return m=Math.acos(a),Math.min(4,Math.max(-4,Math.tan(m)))/4*JO*((u=s).x*(f=e).y-u.y*f.x<0?-1:1)}const QO=[s=>s.x<0,s=>s.x>gt,s=>s.y<0,s=>s.y>gt];function ez(s,e,i,a){const u=[4];if(a===0)return u;i._mult(a);const f=s.sub(i),m=e.sub(i),_=[s,e,f,m];for(let b=0;b<4;b++)for(const S of _)if(QO[b](S)){u.push(b);break}return u}class lb{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new Mm,this.indexArray=new en,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut},i=>KO.includes(i)),this._segments=new xr,this.hiddenByLandmarkVertexArray=new Kd,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new xr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(e,i,a,u=!1){const f=e.length;if(f>2){let m=Math.max(0,this._segments.get().length-1);const _=this._segments._prepareSegment(4*f,this.vertexArray.length,2*this._segmentToGroundQuads[m].length);let b;m!==this._segments.get().length-1&&(m++,this._segmentToGroundQuads[m]=[],this._segmentToRegionTriCounts[m]=[0,0,0,0,0]);{const S=e[0],I=e[1];b=LE(S.sub(e[f-1])._perp()._unit(),I.sub(S)._perp()._unit())}for(let S=0;S<f;S++){const I=S===f-1?0:S+1,C=e[S],k=e[I],M=e[I===f-1?0:I+1],R=k.sub(C)._perp()._unit(),F=LE(R,M.sub(k)._perp()._unit()),$=b,U=F;if(cb(C,k,i)||u&&RE(C,i)&&RE(k,i)){b=F;continue}const H=_.vertexLength;Av(this.vertexArray,C,k,1,1,$),Av(this.vertexArray,C,k,1,0,$),Av(this.vertexArray,C,k,0,1,U),Av(this.vertexArray,C,k,0,0,U),_.vertexLength+=4;const X=ez(C,k,R,a);for(const Q of X)this._segmentToGroundQuads[m].push({id:H,region:Q}),this._segmentToRegionTriCounts[m][Q]+=2,_.primitiveLength+=2;b=F}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),i=e.length;for(let a=0;a<i;a++)this._segmentToGroundQuads[a].sort((u,f)=>u.region-f.region);for(let a=0;a<i;a++){const u=this._segmentToGroundQuads[a],f=e[a],m=this._segmentToRegionTriCounts[a];m.reduce((b,S)=>b+S,0);let _=0;for(let b=0;b<=4;b++){const S=m[b];if(S!==0){let I=this.regionSegments[b];I||(I=this.regionSegments[b]=new xr);const C={vertexOffset:f.vertexOffset,primitiveOffset:f.primitiveOffset+_,vertexLength:f.vertexLength,primitiveLength:S};I.get().push(C)}_+=S}for(let b=0;b<u.length;b++){const S=u[b].id;this.indexArray.emplaceBack(S,S+1,S+3),this.indexArray.emplaceBack(S,S+3,S+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,i,a,u,f,m,_){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,i,a,u,f,m,void 0,_)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,NO.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.groundRadiusArray!=null&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,UO.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,i,a,u,f,m,_,b){this.hasData()&&this.programConfigurations.updatePaintArrays(e,i,a,u,f,m,_,b)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&Yl))}updateHiddenByLandmarkRange(e,i,a){if(!this.hasData())return;const u=i+e;if(i!==0){for(let f=e;f<u;++f)this.hiddenByLandmarkVertexArray.emplace(f,a?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,GO.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const i=this.regionSegments[e];i&&i.destroy()}}}}class Cv{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new en,this.footprintVertices=new yl,this.footprintSegments=[],this.layoutVertexArray=new Fa,this.centroidVertexArray=new nv,this.wallVertexArray=new sv,this.indexArray=new en,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut},i=>XO.includes(i)),this.segments=new xr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new lb(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,u){}populate(e,i,a,u){this.features=[],this.hasPattern=W1("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ht(a),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:f,id:m,index:_,sourceLayerIndex:b}of e){const S=this.layers[0]._featureFilter.needGeometry,I=ci(f,S);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),I,a))continue;const C={id:m,sourceLayerIndex:b,index:_,geometry:S?I.geometry:Xt(f,a,u),properties:f.properties,type:f.type,patterns:{}},k=this.layoutVertexArray.length,M=ab[C.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:f.id,feature:q1("fill-extrusion",this.layers,C,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const R of C.geometry)for(const F of EE(R,M))this.addFeature(f.id,C,[F],_,a,{},i.availableImages,u,i.brightness);else this.addFeature(f.id,C,C.geometry,_,a,{},i.availableImages,u,i.brightness);i.featureIndex.insert(f,C.geometry,_,b,this.index,k)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,i,a,u,f,m){for(const{featureId:_,feature:b}of this.features){const S=ab[b.type]==="Polygon",{geometry:I}=b;if(this.wallMode)for(const C of I)for(const k of EE(C,S))this.addFeature(_,b,[k],b.index,i,a,u,f,m);else this.addFeature(_,b,I,b.index,i,a,u,f,m)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(e,i,a,u,f,m,_){this.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,this.worldview),this.groundEffect.update(e,i,f,a,u,m,_,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,WO),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,$O.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,HO.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,VO.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,i,a,u,f,m,_,b,S){const I=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,C=[new at(0,0),new at(gt,gt)],k=b.projection,M=k.name==="globe",R=this.wallMode||ab[i.type]==="Polygon",F=new kE;F.centroidDataIndex=this.centroidData.length;const $=new CE;$.buildingId=e,i.properties&&i.properties.hasOwnProperty("building_id")&&($.buildingId=Number(i.properties.building_id));const U=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},f)<=0,H=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},f);let X;if($.height=H,$.vertexArrayOffset=this.layoutVertexArray.length,$.groundVertexArrayOffset=this.groundEffect.vertexArray.length,M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new $c),this.wallMode){if(M)return void Kt("Non zero fill-extrusion-line-width is not yet supported on globe.");if(a.length!==1)return;X=function(Se){const Ae=Se[0].x===Se[Se.length-1].x&&Se[0].y===Se[Se.length-1].y;(function(mt){let _t=0;const Vt=mt.length;for(let Rt=0;Rt<Vt;Rt++)_t+=(mt[(Rt+1)%Vt].x-mt[Rt].x)*(mt[(Rt+1)%Vt].y+mt[Rt].y);return _t>=0})(Se)||(Se=Se.reverse());const Ge={geometry:[],joinNormals:[],indices:[]},qe=[],et=[],Je=[];let Qe=Se.length;for(;Qe>=2&&Se[Qe-1].equals(Se[Qe-2]);)Qe--;if(Qe<(Ae?3:2))return Ge;let Ne,it,Ke,rt,tt,St=0;for(;St<Qe-1&&Se[St].equals(Se[St+1]);)St++;Ae&&(Ne=Se[Qe-2],tt=Se[St].sub(Ne)._unit()._perp());for(let mt=St;mt<Qe;mt++){if(Ke=mt===Qe-1?Ae?Se[St+1]:void 0:Se[mt+1],Ke&&Se[mt].equals(Ke))continue;tt&&(rt=tt),Ne&&(it=Ne),Ne=Se[mt],tt=Ke?Ke.sub(Ne)._unit()._perp():rt,rt=rt||tt;let _t=rt.add(tt);_t.x===0&&_t.y===0||_t._unit();const Vt=_t.x*tt.x+_t.y*tt.y,Rt=Vt!==0?1/Vt:1/0,xt=rt.x*tt.y-rt.y*tt.x>0;let Jt="miter";const yi=2;Jt==="miter"&&Rt>yi&&(Jt="bevel"),Jt==="bevel"&&(Rt>100&&(Jt="flipbevel"),Rt<yi&&(Jt="miter"));const Bi=(mi,Ji,ki,Fr)=>{const Ri=new at(mi.x,mi.y),Xi=new at(mi.x,mi.y);Ri.x+=Ji.x*Fr,Ri.y+=Ji.y*Fr,Xi.x-=Ji.x*Math.max(ki,1),Xi.y-=Ji.y*Math.max(ki,1),Je.push(Ji),qe.push(Ri),et.push(Xi)};if(Jt==="miter")_t._mult(Rt),Bi(Ne,_t,0,0);else if(Jt==="flipbevel")_t=tt.mult(-1),Bi(Ne,_t,0,0),Bi(Ne,_t.mult(-1),0,0);else{const mi=-Math.sqrt(Rt*Rt-1),Ji=xt?mi:0,ki=xt?0:mi;it&&Bi(Ne,rt,Ji,ki),Ke&&Bi(Ne,tt,Ji,ki)}}Ge.geometry=[...qe,...et.reverse(),qe[0]],Ge.joinNormals=[...Je,...Je.reverse(),Je[Je.length-1]];const Et=Ge.geometry.length-1;for(let mt=0;mt<Et/2;mt++)if(mt+1<Et/2){let _t=mt,Vt=mt+1,Rt=Et-1-mt,xt=Et-2-mt;_t=_t===0?Et-1:_t-1,Vt=Vt===0?Et-1:Vt-1,Rt=Rt===0?Et-1:Rt-1,xt=xt===0?Et-1:xt-1,Ge.indices.push(Rt),Ge.indices.push(Vt),Ge.indices.push(_t),Ge.indices.push(Rt),Ge.indices.push(xt),Ge.indices.push(Vt)}return Ge}(a[0]),a=[X.geometry]}const Q=(Se,Ae)=>Se<(Ae.length-1)/2||Se===Ae.length-1,ae=this.wallMode?[a]:Xm(a,500);for(let Se=ae.length-1;Se>=0;Se--){const Ae=ae[Se];(Ae.length===0||iz(Ae[0]))&&ae.splice(Se,1)}let oe;if(M)oe=BE(ae,C,f);else{oe=[];for(const Se of ae)oe.push({polygon:Se,bounds:C})}const ge=R?this.edgeRadius:0,ye=ge>0&&this.zoom<17,me=(Se,Ae)=>{if(Se.length===0)return!1;const Ze=Se[Se.length-1];return Ae.x===Ze.x&&Ae.y===Ze.y};for(const{polygon:Se,bounds:Ae}of oe){let Ze=0,Ge=0;for(const Qe of Se)R&&!Qe[0].equals(Qe[Qe.length-1])&&Qe.push(Qe[0]),Ge+=R?Qe.length-1:Qe.length;const qe=this.segments.prepareSegment((R?5:4)*Ge,this.layoutVertexArray,this.indexArray);$.footprintSegIdx<0&&($.footprintSegIdx=this.footprintSegments.length),$.polygonSegIdx<0&&($.polygonSegIdx=this.polygonSegments.length);const et={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Je=new AE;if(Je.vertexOffset=this.footprintVertices.length,Je.indexOffset=3*this.footprintIndices.length,Je.ringIndices=[],R){const Qe=[],Ne=[];Ze=qe.vertexLength;for(let Ke=0;Ke<Se.length;Ke++){const rt=Se[Ke];rt.length&&Ke!==0&&Ne.push(Qe.length/2);const tt=[];let St,Et;St=rt[1].sub(rt[0])._perp()._unit(),Je.ringIndices.push(rt.length-1);for(let mt=1;mt<rt.length;mt++){const _t=rt[mt],Vt=rt[mt===rt.length-1?1:mt+1],Rt=_t.clone();if(ge){Et=Vt.sub(_t)._perp()._unit();const xt=St.add(Et)._unit(),Jt=ge*Math.min(4,1/(St.x*xt.x+St.y*xt.y));Rt.x+=Jt*xt.x,Rt.y+=Jt*xt.y,Rt.x=Math.round(Rt.x),Rt.y=Math.round(Rt.y),St=Et}if(!U||ge!==0&&!ye||me(tt,Rt)||tt.push(Rt),Qm(this.layoutVertexArray,Rt.x,Rt.y,0,0,1,1,0),this.wallMode){const xt=Q(mt,rt);eg(this.wallVertexArray,X.joinNormals[mt],!xt)}qe.vertexLength++,this.footprintVertices.emplaceBack(_t.x,_t.y),Qe.push(_t.x,_t.y),M&&tg(this.layoutVertexExtArray,k.projectTilePoint(Rt.x,Rt.y,f),k.upVector(f,Rt.x,Rt.y))}U&&(ge===0||ye)&&(tt.length!==0&&me(tt,tt[0])&&tt.pop(),this.groundEffect.addData(tt,Ae,I))}const it=this.wallMode?X.indices:ef(Qe,Ne);for(let Ke=0;Ke<it.length;Ke+=3)this.footprintIndices.emplaceBack(Je.vertexOffset+it[Ke+0],Je.vertexOffset+it[Ke+1],Je.vertexOffset+it[Ke+2]),this.indexArray.emplaceBack(Ze+it[Ke],Ze+it[Ke+2],Ze+it[Ke+1]),qe.primitiveLength++;Je.indexCount+=it.length,Je.vertexCount+=this.footprintVertices.length-Je.vertexOffset}for(let Qe=0;Qe<Se.length;Qe++){const Ne=Se[Qe];F.startRing($,Ne[0]);let it=Ne.length>4&&DE(Ne[Ne.length-2],Ne[0],Ne[1]),Ke=ge?tz(Ne[Ne.length-2],Ne[0],Ne[1],ge):0;const rt=[];let tt,St,Et;St=Ne[1].sub(Ne[0])._perp()._unit();let mt=!0;for(let _t=1,Vt=0;_t<Ne.length;_t++){let Rt=Ne[_t-1],xt=Ne[_t];const Jt=Ne[_t===Ne.length-1?1:_t+1];if(F.appendEdge($,xt,Rt),cb(xt,Rt,Ae)){ge&&(St=Jt.sub(xt)._perp()._unit(),mt=!mt);continue}const yi=xt.sub(Rt)._perp(),Bi=yi.x/(Math.abs(yi.x)+Math.abs(yi.y)),mi=yi.y>0?1:0,Ji=Rt.dist(xt);if(Vt+Ji>32768&&(Vt=0),ge){Et=Jt.sub(xt)._perp()._unit();let Xi=ME(Rt,xt,Jt,PE(St,Et),ge);isNaN(Xi)&&(Xi=0);const gr=xt.sub(Rt)._unit();Rt=Rt.add(gr.mult(Ke))._round(),xt=xt.add(gr.mult(-Xi))._round(),Ke=Xi,St=Et,U&&this.zoom>=17&&(me(rt,Rt)||rt.push(Rt),me(rt,xt)||rt.push(xt))}const ki=qe.vertexLength,Fr=Ne.length>4&&DE(Rt,xt,Jt);let Ri=OE(Vt,it,mt);if(Qm(this.layoutVertexArray,Rt.x,Rt.y,Bi,mi,0,0,Ri),Qm(this.layoutVertexArray,Rt.x,Rt.y,Bi,mi,0,1,Ri),this.wallMode){const Xi=Q(_t-1,Ne),gr=X.joinNormals[_t-1];eg(this.wallVertexArray,gr,Xi),eg(this.wallVertexArray,gr,Xi)}if(Vt+=Ji,Ri=OE(Vt,Fr,!mt),it=Fr,Qm(this.layoutVertexArray,xt.x,xt.y,Bi,mi,0,0,Ri),Qm(this.layoutVertexArray,xt.x,xt.y,Bi,mi,0,1,Ri),this.wallMode){const Xi=Q(_t,Ne),gr=X.joinNormals[_t];eg(this.wallVertexArray,gr,Xi),eg(this.wallVertexArray,gr,Xi)}if(qe.vertexLength+=4,this.indexArray.emplaceBack(ki+0,ki+1,ki+2),this.indexArray.emplaceBack(ki+1,ki+3,ki+2),qe.primitiveLength+=2,ge){const Xi=Ze+(_t===1?Ne.length-2:_t-2),gr=_t===1?Ze:Xi+1;if(this.indexArray.emplaceBack(ki+1,Xi,ki+3),this.indexArray.emplaceBack(Xi,gr,ki+3),qe.primitiveLength+=2,tt===void 0&&(tt=ki),!cb(Jt,Ne[_t],Ae)){const Er=_t===Ne.length-1?tt:qe.vertexLength;this.indexArray.emplaceBack(ki+2,ki+3,Er),this.indexArray.emplaceBack(ki+3,Er+1,Er),this.indexArray.emplaceBack(ki+3,gr,Er+1),qe.primitiveLength+=3}mt=!mt}if(M){const Xi=this.layoutVertexExtArray,gr=k.projectTilePoint(Rt.x,Rt.y,f),Er=k.projectTilePoint(xt.x,xt.y,f),Ir=k.upVector(f,Rt.x,Rt.y),jr=k.upVector(f,xt.x,xt.y);tg(Xi,gr,Ir),tg(Xi,gr,Ir),tg(Xi,Er,jr),tg(Xi,Er,jr)}}R&&(Ze+=Ne.length-1),U&&ge&&this.zoom>=17&&(rt.length!==0&&me(rt,rt[0])&&rt.pop(),this.groundEffect.addData(rt,Ae,I,ge>0))}this.footprintSegments.push(Je),et.triangleCount=this.indexArray.length-et.triangleArrayOffset,this.polygonSegments.push(et),++$.footprintSegLen,++$.polygonSegLen}if($.vertexCount=this.layoutVertexArray.length-$.vertexArrayOffset,$.groundVertexCount=this.groundEffect.vertexArray.length-$.groundVertexArrayOffset,$.vertexCount!==0){if($.centroidXY=F.borders?IE:this.encodeCentroid(F,$),this.centroidData.push($),F.borders){this.featuresOnBorder.push(F);const Se=this.featuresOnBorder.length-1;for(let Ae=0;Ae<F.borders.length;Ae++)F.borders[Ae][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[Ae].push(Se)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,u,m,_,f,S,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,u,m,_,f,S,this.worldview),this.maxHeight=Math.max(this.maxHeight,H)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((i,a)=>this.featuresOnBorder[i].borders[e][0]-this.featuresOnBorder[a].borders[e][0])}splitToSubtiles(){const e=[];for(let _=0;_<this.centroidData.length;_++){const b=this.centroidData[_],S=+(b.min.y+b.max.y>gt),I=2*S+(+(b.min.x+b.max.x>gt)^S);for(let C=0;C<b.polygonSegLen;C++){const k=b.polygonSegIdx+C;e.push({centroidIdx:_,subtile:I,polygonSegmentIdx:k,triangleSegmentIdx:this.polygonSegments[k].triangleSegIdx})}}const i=new en;e.sort((_,b)=>_.triangleSegmentIdx===b.triangleSegmentIdx?_.subtile-b.subtile:_.triangleSegmentIdx-b.triangleSegmentIdx);let a=0,u=0,f=0;for(const _ of e){if(_.triangleSegmentIdx!==a)break;f++}const m=e.length;for(;u!==e.length;){a=e[u].triangleSegmentIdx;let _=0,b=u,S=u;for(let I=b;I<f&&e[I].subtile===_;I++)S++;for(;b!==f;){const I=e[b];_=I.subtile;const C=this.centroidData[I.centroidIdx].min.clone(),k=this.centroidData[I.centroidIdx].max.clone(),M={vertexOffset:this.segments.segments[a].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[a].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let R=b;R<S;R++){const F=e[R],$=this.polygonSegments[F.polygonSegmentIdx],U=this.centroidData[F.centroidIdx].min,H=this.centroidData[F.centroidIdx].max,X=this.indexArray.uint16;for(let Q=$.triangleArrayOffset;Q<$.triangleArrayOffset+$.triangleCount;Q++)i.emplaceBack(X[3*Q],X[3*Q+1],X[3*Q+2]);M.primitiveLength+=$.triangleCount,C.x=Math.min(C.x,U.x),C.y=Math.min(C.y,U.y),k.x=Math.max(k.x,H.x),k.y=Math.max(k.y,H.y)}M.primitiveLength>0&&this.triangleSubSegments.push({segment:M,min:C,max:k}),b=S;for(let R=b;R<f&&e[R].subtile===e[b].subtile;R++)S++}u=f;for(let I=u;I<m&&e[I].triangleSegmentIdx===e[u].triangleSegmentIdx;I++)f++}i._trim(),this.indexArray=i}getVisibleSegments(e,i,a){const u=new xr;if(this.wallMode){for(const F of this.triangleSubSegments)u.segments.push(F.segment);return u}let f=0,m=0;const _=1<<e.canonical.z;if(i){const F=i.getMinMaxForTile(e);F&&(f=F.min,m=F.max)}m+=this.maxHeight;const b=e.toUnwrapped();let S;const I=[b.canonical.x/_+b.wrap,b.canonical.y/_],C=[(b.canonical.x+1)/_+b.wrap,(b.canonical.y+1)/_],k=(F,$,U)=>[F[0]*(1-U[0])+$[0]*U[0],F[1]*(1-U[1])+$[1]*U[1]],M=[],R=[];for(const F of this.triangleSubSegments){M[0]=F.min.x/gt,M[1]=F.min.y/gt,R[0]=F.max.x/gt,R[1]=F.max.y/gt;const $=k(I,C,M),U=k(I,C,R);if(new Ui([$[0],$[1],f],[U[0],U[1],m]).intersectsPrecise(a)===0){S&&(u.segments.push(S),S=void 0);continue}const H=F.segment;S&&S.vertexOffset!==H.vertexOffset&&(u.segments.push(S),S=void 0),S?(S.vertexLength+=H.vertexLength,S.primitiveLength+=H.primitiveLength):S={vertexOffset:H.vertexOffset,primitiveLength:H.primitiveLength,vertexLength:H.vertexLength,primitiveOffset:H.primitiveOffset,sortKey:void 0,vaos:{}}}return S&&u.segments.push(S),u}encodeCentroid(e,i){const a=e.centroid(),u=i.span(),f=Math.min(7,Math.round(u.x*this.tileToMeter/10)),m=Math.min(7,Math.round(u.y*this.tileToMeter/10));return new at(pe(a.x,1,8191)<<3|f,pe(a.y,1,8191)<<3|m)}encodeBorderCentroid(e){if(!e.borders)return new at(0,0);const i=e.borders,a=Number.MAX_VALUE;if(i[0][0]!==a||i[1][0]!==a){const u=i[0][0]!==a?0:1;return new at(6|(i[0][0]!==a?0:65528),(i[u][0]+i[u][1])/2<<3|6)}{const u=i[2][0]!==a?2:3;return new at((i[u][0]+i[u][1])/2<<3|6,6|(i[2][0]!==a?0:65528))}}showCentroid(e){const i=this.centroidData[e.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const i=e.vertexArrayOffset,a=e.vertexCount+e.vertexArrayOffset,u=e.flags&Yl?IE:e.centroidXY,f=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==u.y||f!==u.x){for(let m=i;m<a;++m)this.centroidVertexArray.emplace(m,u.x,u.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Iv(this.activeReplacements,u))return;if(this.activeReplacements=u,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const m of this.centroidData)m.flags&=2147483647;const f=[];for(const m of this.activeReplacements){if(m.order<a)continue;const _=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));if(m.footprint.buildingIds)for(const b of this.centroidData)b.flags&Yl||m.min.x>b.max.x||b.min.x>m.max.x||m.min.y>b.max.y||b.min.y>m.max.y||m.footprint.buildingIds.has(b.buildingId)&&(b.flags|=Yl);else for(const b of this.centroidData)if(!(b.flags&Yl||m.min.x>b.max.x||b.min.x>m.max.x||m.min.y>b.max.y||b.min.y>m.max.y))for(let S=0;S<b.footprintSegLen;S++){const I=this.footprintSegments[b.footprintSegIdx+S];if(f.length=0,rz(this.footprintVertices,I.vertexOffset,I.vertexCount,m.footprintTileId.canonical,e.canonical,f),sb(m.footprint,f,this.footprintIndices.uint16,I.indexOffset,I.indexCount,-I.vertexOffset,-_)){b.flags|=Yl;break}}}for(const m of this.centroidData)this.writeCentroidToBuffer(m);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,i,a){let u=!1;for(let f=0;f<a.footprintSegLen;f++){const m=this.footprintSegments[a.footprintSegIdx+f];let _=0;for(const b of m.ringIndices){for(let S=_,I=b+_-1;S<b+_;I=S++){const C=this.footprintVertices.int16[2*(S+m.vertexOffset)+0],k=this.footprintVertices.int16[2*(S+m.vertexOffset)+1],M=this.footprintVertices.int16[2*(I+m.vertexOffset)+1];k>i!=M>i&&e<(this.footprintVertices.int16[2*(I+m.vertexOffset)+0]-C)*(i-k)/(M-k)+C&&(u=!u)}_=b}}return u}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+gt)*gt+(i+gt);if(this.partLookup.hasOwnProperty(f)){const m=this.partLookup[f];return m?{height:m.height,hidden:!!(m.flags&Yl)}:void 0}for(const m of this.centroidData)e>m.max.x||m.min.x>e||i>m.max.y||m.min.y>i||m.height<=a||this.footprintContainsPoint(e,i,m)&&(a=m.height,this.partLookup[f]=m,u=!!(m.flags&Yl));if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.partLookup[f]=void 0}}function PE(s,e){const i=s.add(e)._unit();return s.x*i.x+s.y*i.y}function tz(s,e,i,a){const u=e.sub(s)._perp()._unit(),f=i.sub(e)._perp()._unit();return ME(s,e,i,PE(u,f),a)}function ME(s,e,i,a,u){const f=Math.sqrt(1-a*a);return Math.min(s.dist(e)/3,e.dist(i)/3,u*f/a)}function cb(s,e,i){return s.x<i[0].x&&e.x<i[0].x||s.x>i[1].x&&e.x>i[1].x||s.y<i[0].y&&e.y<i[0].y||s.y>i[1].y&&e.y>i[1].y}function RE(s,e){return s.x<e[0].x||s.x>e[1].x||s.y<e[0].y||s.y>e[1].y}function iz(s){return s.every(e=>e.x<=0)||s.every(e=>e.x>=gt)||s.every(e=>e.y<=0)||s.every(e=>e.y>=gt)}function DE(s,e,i){if(s.x<0||s.x>=gt||e.x<0||e.x>=gt||i.x<0||i.x>=gt)return!1;const a=i.sub(e),u=a.perp(),f=s.sub(e);return(a.x*f.x+a.y*f.y)/Math.sqrt((a.x*a.x+a.y*a.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function OE(s,e,i){const a=e?2|s:-3&s;return i?1|a:-2&a}function zE(){const s=Math.PI/32,e=Math.tan(s),i=be;return i*Math.sqrt(1+2*e*e)-i}function BE(s,e,i){const a=1<<i.z,u=Ye(i.x/a),f=Ye((i.x+1)/a),m=nt(i.y/a),_=nt((i.y+1)/a);return function(b,S,I,C,k=0,M){const R=[];if(!b.length||!I||!C)return R;const F=(oe,ge)=>{for(const ye of oe)R.push({polygon:ye,bounds:ge})},$=Math.ceil(Math.log2(I)),U=Math.ceil(Math.log2(C)),H=$-U,X=[];for(let oe=0;oe<Math.abs(H);oe++)X.push(H>0?0:1);for(let oe=0;oe<Math.min($,U);oe++)X.push(0),X.push(1);let Q=b;if(Q=Sv(Q,S[0].y-k,S[1].y+k,1),Q=Sv(Q,S[0].x-k,S[1].x+k,0),!Q.length)return R;const ae=[];for(X.length?ae.push({polygons:Q,bounds:S,depth:0}):F(Q,S);ae.length;){const oe=ae.pop(),ge=oe.depth,ye=X[ge],me=oe.bounds[0],Se=oe.bounds[1],Ae=ye===0?me.x:me.y,Ze=ye===0?Se.x:Se.y,Ge=M?M(ye,Ae,Ze):.5*(Ae+Ze),qe=Sv(oe.polygons,Ae-k,Ge+k,ye),et=Sv(oe.polygons,Ge-k,Ze+k,ye);if(qe.length){const Je=[me,new at(ye===0?Ge:Se.x,ye===1?Ge:Se.y)];X.length>ge+1?ae.push({polygons:qe,bounds:Je,depth:ge+1}):F(qe,Je)}if(et.length){const Je=[new at(ye===0?Ge:me.x,ye===1?Ge:me.y),Se];X.length>ge+1?ae.push({polygons:et,bounds:Je,depth:ge+1}):F(et,Je)}}return R}(s,e,Math.ceil((f-u)/11.25),Math.ceil((m-_)/11.25),1,(b,S,I)=>{if(b===0)return .5*(S+I);{const C=nt((i.y+S/gt)/a);return(Ve(.5*(nt((i.y+I/gt)/a)+C))*a-i.y)*gt}})}function rz(s,e,i,a,u,f){const m=Math.pow(2,a.z-u.z);for(let _=0;_<i;_++){let b=s.int16[2*(_+e)+0],S=s.int16[2*(_+e)+1];b=(b+u.x*gt)*m-a.x*gt,S=(S+u.y*gt)*m-a.y*gt,f.push(new at(b,S))}}let FE,jE;Ct(Cv,"FillExtrusionBucket",{omit:["layers","features"]}),Ct(CE,"PartData"),Ct(AE,"FootprintSegment"),Ct(kE,"BorderCentroidData"),Ct(lb,"GroundEffect");class Sh extends at{constructor(e,i,a){super(e,i),this.z=a}}class NE extends Sh{constructor(e,i,a,u){super(e,i,a),this.w=u}}function UE(s,e,i,a){const u=i==="x"?"y":"x",f=(a-s[i])/(e[i]-s[i]);s[u]=Math.round(s[u]+(e[u]-s[u])*f),s[i]=a,s.hasOwnProperty("z")&&(s.z=qt(s.z,e.z,f)),s.hasOwnProperty("w")&&(s.w=qt(s.w,e.w,f))}function VE(s,e,i,a){const u=i,f=a;for(const m of["x","y"]){let _=s,b=e;_[m]>=b[m]&&(_=e,b=s),_[m]<u&&b[m]>u&&UE(_,b,m,u),_[m]<f&&b[m]>f&&UE(b,_,m,f)}}function kv(s,e,i,a,u,f){const m=[];for(let _=0;_<s.length;_++){const b=s[_];let S;const I=m.length;let C=0;for(let k=0;k<b.length-1;k++){let M=b[k],R=b[k+1],F=0;const $=C;let U,H;f&&(F=Math.hypot(R.x-M.x,R.y-M.y),C+=F,U=M,H=R),M.x<e&&R.x<e||(M.x<e?M=new at(e,M.y+(e-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x<e&&(R=new at(e,M.y+(e-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y<i&&R.y<i||(M.y<i?M=new at(M.x+(i-M.y)/(R.y-M.y)*(R.x-M.x),i)._round():R.y<i&&(R=new at(M.x+(i-M.y)/(R.y-M.y)*(R.x-M.x),i)._round()),M.x>=a&&R.x>=a||(M.x>=a?M=new at(a,M.y+(a-M.x)/(R.x-M.x)*(R.y-M.y))._round():R.x>=a&&(R=new at(a,M.y+(a-M.x)/(R.x-M.x)*(R.y-M.y))._round()),M.y>=u&&R.y>=u||(M.y>=u?M=new at(M.x+(u-M.y)/(R.y-M.y)*(R.x-M.x),u)._round():R.y>=u&&(R=new at(M.x+(u-M.y)/(R.y-M.y)*(R.x-M.x),u)._round()),S&&M.equals(S[S.length-1])||(S=[M],m.push(S),f&&f.push({progress:{min:$+$E(U,H,M)*F,max:1},parentIndex:_,prevPoint:U,nextPoint:H})),S.push(R),f&&(f[f.length-1].progress.max=$+$E(U,H,R)*F,f[f.length-1].nextPoint=H)))))}if(f&&C>0)for(let k=I;k<m.length;k++)f[k].progress.min/=C,f[k].progress.max/=C}return m}function nz(s,e,i,a,u){if(s.length<2)return void a.push(s);const f=[];for(;e.valid();){const[S,I]=e.get();for(let C=0;C<s.length-1;C++){const k=s[C],M=s[C+1],R=xh(k,M,S,I);if(R){const[F]=R,$=new at(qt(k.x,M.x,F),qt(k.y,M.y,F));f.push({t:C+F,distance:0,point:$})}}e.next()}if(f.length===0)return void a.push(s);f.sort((S,I)=>S.t-I.t);let m=0,_=0,b=[];for(a.push(b);m!==s.length;){if(_===f.length){for(;m!==s.length;)b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++;break}f[_].t<=m?(b.length!==0&&b[b.length-1].equals(f[_].point)||b.push(f[_].point),Math.trunc(f[_].t),_++):(b.length!==0&&b[b.length-1].equals(s[m])||b.push(s[m]),m++)}}function $E(s,e,i){return s.x!==e.x?(i.x-s.x)/(e.x-s.x):s.y!==e.y?(i.y-s.y)/(e.y-s.y):0}function ig(s,e){return s.x*e.x+s.y*e.y}function GE(s,e){if(s.length===1){let i=0;const a=e[i++];let u;for(;!u||a.equals(u);)if(u=e[i++],!u)return 1/0;for(;i<e.length;i++){const f=e[i],m=s[0],_=u.sub(a),b=f.sub(a),S=m.sub(a),I=ig(_,_),C=ig(_,b),k=ig(b,b),M=ig(S,_),R=ig(S,b),F=I*k-C*C,$=(k*M-C*R)/F,U=(I*R-C*M)/F,H=a.z*(1-$-U)+u.z*$+f.z*U;if(isFinite(H))return H}return 1/0}{let i=1/0;for(const a of e)i=Math.min(i,a.z);return i}}function HE(s,e,i){let a=1/0;ur(i,e)&&(a=GE(i,e[0]));for(let u=0;u<e.length;u++){const f=e[u],m=s[u];for(let _=0;_<f.length-1;_++){const b=f[_],S=[b,f[_+1],m[_+1],m[_],b];Tr(i,S)&&(a=Math.min(a,GE(i,S)))}}return a!==1/0&&a}function WE(s,e,i,a,u,f,m,_,b,S,I){return s.projection.name==="globe"?function(C,k,M,R,F,$,U,H,X,Q,ae){const oe=[],ge=[],ye=C.projection.upVectorScale(ae,C.center.lat,C.worldSize).metersToTile,me=[0,0,0,1],Se=[0,0,0,1],Ae=(Ge,qe,et,Je)=>{Ge[0]=qe,Ge[1]=et,Ge[2]=Je,Ge[3]=1},Ze=zE();M>0&&(M+=Ze),R+=Ze;for(const Ge of k){const qe=[],et=[];for(const Je of Ge){const Qe=Je.x+F.x,Ne=Je.y+F.y,it=C.projection.projectTilePoint(Qe,Ne,ae),Ke=C.projection.upVector(ae,Je.x,Je.y);let rt=M,tt=R;if(U){const St=qE(Qe,Ne,M,R,U,H,X,Q);rt+=St.base,tt+=St.top}M!==0?Ae(me,it.x+Ke[0]*ye*rt,it.y+Ke[1]*ye*rt,it.z+Ke[2]*ye*rt):Ae(me,it.x,it.y,it.z),Ae(Se,it.x+Ke[0]*ye*tt,it.y+Ke[1]*ye*tt,it.z+Ke[2]*ye*tt),or(me,me,$),or(Se,Se,$),qe.push(new Sh(me[0],me[1],me[2])),et.push(new Sh(Se[0],Se[1],Se[2]))}oe.push(qe),ge.push(et)}return[oe,ge]}(s,e,i,a,u,f,m,_,b,S,I):m?function(C,k,M,R,F,$,U,H,X){const Q=[],ae=[],oe=[0,0,0,1];for(const ge of C){const ye=[],me=[];for(const Se of ge){const Ae=Se.x+R.x,Ze=Se.y+R.y,Ge=qE(Ae,Ze,k,M,$,U,H,X);oe[0]=Ae,oe[1]=Ze,oe[2]=Ge.base,oe[3]=1,zn(oe,oe,F),oe[3]=Math.max(oe[3],1e-5);const qe=new Sh(oe[0]/oe[3],oe[1]/oe[3],oe[2]/oe[3]);oe[0]=Ae,oe[1]=Ze,oe[2]=Ge.top,oe[3]=1,zn(oe,oe,F),oe[3]=Math.max(oe[3],1e-5);const et=new Sh(oe[0]/oe[3],oe[1]/oe[3],oe[2]/oe[3]);ye.push(qe),me.push(et)}Q.push(ye),ae.push(me)}return[Q,ae]}(e,i,a,u,f,m,_,b,S):function(C,k,M,R,F){const $=[],U=[],H=F[8]*k,X=F[9]*k,Q=F[10]*k,ae=F[11]*k,oe=F[8]*M,ge=F[9]*M,ye=F[10]*M,me=F[11]*M;for(const Se of C){const Ae=[],Ze=[];for(const Ge of Se){const qe=Ge.x+R.x,et=Ge.y+R.y,Je=F[0]*qe+F[4]*et+F[12],Qe=F[1]*qe+F[5]*et+F[13],Ne=F[2]*qe+F[6]*et+F[14],it=F[3]*qe+F[7]*et+F[15],Ke=Je+H,rt=Qe+X,tt=Ne+Q,St=Math.max(it+ae,1e-5),Et=Je+oe,mt=Qe+ge,_t=Ne+ye,Vt=Math.max(it+me,1e-5);Ae.push(new Sh(Ke/St,rt/St,tt/St)),Ze.push(new Sh(Et/Vt,mt/Vt,_t/Vt))}$.push(Ae),U.push(Ze)}return[$,U]}(e,i,a,u,f)}function qE(s,e,i,a,u,f,m,_){const b=m*u.getElevationAt(s,e,!0,!0),S=f[0]!==0,I=S?f[1]===0?m*(f[0]/7-450):m*function(C,k,M){const R=Math.floor(k[0]/8),F=Math.floor(k[1]/8),$=10*(k[0]-8*R),U=10*(k[1]-8*F),H=C.getElevationAt(R,F,!0,!0),X=C.getMeterToDEM(M),Q=Math.floor(.5*($*X-1)),ae=Math.floor(.5*(U*X-1)),oe=C.tileCoordToPixel(R,F),ge=2*Q+1,ye=2*ae+1,me=function(et,Je,Qe,Ne,it){return[et.getElevationAtPixel(Je,Qe,!0),et.getElevationAtPixel(Je+it,Qe,!0),et.getElevationAtPixel(Je,Qe+it,!0),et.getElevationAtPixel(Je+Ne,Qe+it,!0)]}(C,oe.x-Q,oe.y-ae,ge,ye),Se=Math.abs(me[0]-me[1]),Ae=Math.abs(me[2]-me[3]),Ze=Math.abs(me[0]-me[2])+Math.abs(me[1]-me[3]),Ge=Math.min(.25,.5*X*(Se+Ae)/ge),qe=Math.min(.25,.5*X*Ze/ye);return H+Math.max(Ge*$,qe*U)}(u,f,_):b;return{base:b+(i===0?-1:i),top:S?Math.max(I+a,b+i+2):b+a}}class sz{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class oz{constructor(){this.tasks={},this.taskQueue=[],At(["process"],this),this.invoker=new sz(this.process),this.nextId=0}add(e,i){const a=this.nextId++,u=function({type:f,isSymbolTile:m,zoom:_}){return _=_||0,f==="message"?0:f!=="maybePrepare"||m?f!=="parseTile"||m?f==="parseTile"&&m?300-_:f==="maybePrepare"&&m?400-_:500:200-_:100-_}(i);if(u===0){try{e()}finally{}return null}return this.tasks[a]={fn:e,metadata:i,priority:u,id:a},this.taskQueue.push(a),this.invoker.trigger(),{cancel:()=>{delete this.tasks[a]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(a=>!!this.tasks[a]),!this.taskQueue.length)return;const e=this.pick();if(e===null)return;const i=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let e=null,i=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<i&&(i=f.priority,e=u)}if(e===null)return null;const a=this.taskQueue[e];return this.taskQueue.splice(e,1),a}remove(){this.invoker.remove()}}class ZE{constructor(e,i,a){this.target=e,this.parent=i,this.mapId=a,this.callbacks={},this.cancelCallbacks={},At(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new oz}send(e,i,a,u,f=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[_]=a);const b=new Set;return this.target.postMessage({id:_,type:e,hasCallback:!!a,targetMapId:u,mustQueue:f,sourceMapId:this.mapId,data:Fo(i,b)},b),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:u,sourceMapId:this.mapId})}}}receive(e){const i=e.data;if(!i)return;const a=i.id;if(a&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const u=this.cancelCallbacks[a];delete this.cancelCallbacks[a],u&&u.cancel()}else if(i.mustQueue||zr(self)){const u=this.callbacks[a],f=this.scheduler.add(()=>this.processTask(a,i),u&&u.metadata||{type:"message"});f&&(this.cancelCallbacks[a]=f)}else this.processTask(a,i)}processTask(e,i){if(delete this.cancelCallbacks[e],i.type==="<response>"){const a=this.callbacks[e];delete this.callbacks[e],a&&(i.error?a(za(i.error)):a(null,za(i.data)))}else{const a=new Set,u=i.hasCallback?(m,_)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:m?Fo(m):null,data:Fo(_,a)},a)}:()=>{},f=za(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,f,u);else if(this.parent.getWorkerSource){const m=i.type.split("."),{source:_,scope:b}=f;this.parent.getWorkerSource(i.sourceMapId,m[0],_,b)[m[1]](f,u)}else u(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var rg={workerUrl:"",workerClass:null,workerParams:void 0};function az(s){return rg.workerClass!=null?new rg.workerClass:new self.Worker(rg.workerUrl,Object.assign({name:s},rg.workerParams))}const ub="mapboxgl_preloaded_worker_pool";class Th{constructor(e){this.active={},this.name=e}acquire(e,i=Th.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;){const a=az(`${this.name||""}WorkerPool: ${e}-${this.workers.length}`);this.workers.push(a)}return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[ub]}numActive(){return Object.keys(this.active).length}}Th.workerCount=2;class sf{constructor(e,i,a="Worker",u=Th.workerCount){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ut();const f=this.workerPool.acquire(this.id,u);for(let m=0;m<f.length;m++){const _=new sf.Actor(f[m],i,this.id);_.name=`${a} ${m}`,this.actors.push(_)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,i,a){Re(this.actors,(u,f)=>{u.send(e,i,f)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let ng,hb;function Lv(){return ng||(ng=new Th),ng}sf.Actor=ZE;const db=4096;class lz{constructor(e){this.module=e,this.memoryStack=this.module.malloc(db),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>db?-1:(new Int32Array(this.module.heap32.buffer,i,e.length).set(e),i)}createFloatArray(e){const i=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>db?-1:(new Float32Array(this.module.heapF32.buffer,i,e.length).set(e),i)}readStringBuffer(e){let i="";for(;this.module.heapU8[e]!==0;)i+=String.fromCharCode(this.module.heapU8[e]),++e;return i}setStyle(e){const i=e.normalScale;this.module.setStyle(i[0],i[1],i[2],e.tileToMeters)}setAOOptions(e,i){this.module.setAOOptions(e?1:0,i)}setMetricOptions(e,i){this.module.setMetricOptions(e?1:0,i)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,i){this.module.setFacadeOptions(e,i?1:0)}setFauxFacadeOptions(e,i,a){this.module.setFauxFacadeOptions(e?1:0,i?1:0,a)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,i){this.memoryStackNextFree=this.memoryStack;for(const _ of e){const b=this.createIntArray(_.ringIndices),S=this.createFloatArray(_.coordinates);if(b===-1||S===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFeature(_.id,_.sourceId,_.minHeight,_.height,_.roofType,S,b,_.ringIndices.length-1)}for(const _ of i){let b;b=_.entrances?JSON.parse(_.entrances):[];const S=this.createFloatArray(b),I=this.createFloatArray(_.coordinates);if(S===-1||I===-1)return`building_gen: Out of stack memory: ${this.memoryStackNextFree-this.memoryStack}/4096`;this.module.addFacade(_.sourceId,_.crossPerc,_.distanceToRoad,S,b.length,I,_.coordinates.length)}if(!this.module.generateMesh()){const _=this.module.getLastError();return this.readStringBuffer(_)}const a=this.module.getMeshCount(),u=new Array(a);for(let _=0;_<a;_++){const b=this.module.getPositionsPtr(_),S=this.module.getPositionsLength(_),I=new Float32Array(this.module.heapF32.buffer,b,S),C=this.module.getNormalsPtr(_),k=this.module.getNormalsLength(_),M=new Float32Array(this.module.heapF32.buffer,C,k),R=this.module.getAOPtr(_),F=this.module.getAOLength(_),$=new Float32Array(this.module.heapF32.buffer,R,F),U=this.module.getUVPtr(_),H=this.module.getUVLength(_),X=new Float32Array(this.module.heapF32.buffer,U,H),Q=this.module.getFauxFacadePtr(_),ae=this.module.getFauxFacadeLength(_),oe=new Uint8Array(this.module.heapU8.buffer,Q,ae),ge=this.module.getIndicesPtr(_),ye=this.module.getIndicesLength(_),me=new Int16Array(this.module.heap16.buffer,ge,ye),Se=this.module.getBuildingPart(_);u[_]={positions:I,normals:M,ao:$,uv:X,isFauxFacade:oe,indices:me,buildingPart:Se}}const f=this.module.getRingCount(),m=[];for(let _=0;_<f;_++){const b=this.module.getRingPtr(_),S=this.module.getRingLength(_),I=new Float32Array(this.module.heapF32.buffer,b,S);m.push(I)}return{meshes:u,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:m}}}let sg,fb,Na,of,pb,af=null,lf=null,XE=null,Pv=null;function KE(){return zr(self)&&self.worker.dracoUrl?self.worker.dracoUrl:fb||Jr.DRACO_URL}function YE(){if(zr(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(of)return of;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return of=WebAssembly.validate(s)?Jr.MESHOPT_SIMD_URL:Jr.MESHOPT_URL,of}function cz(){return Pv}const JE=5120,QE=5121,eI=5122,tI=5123,iI=5125,rI=5126,Mv={[JE]:Int8Array,[QE]:Uint8Array,[eI]:Int16Array,[tI]:Uint16Array,[iI]:Uint32Array,[rI]:Float32Array},uz={[JE]:"DT_INT8",[QE]:"DT_UINT8",[eI]:"DT_INT16",[tI]:"DT_UINT16",[iI]:"DT_UINT32",[rI]:"DT_FLOAT32"},og={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function nI(s,e,i){const a=i.json.bufferViews.length,u=i.buffers.length;e.bufferView=a,i.json.bufferViews[a]={buffer:u,byteLength:s.byteLength},i.buffers[u]=s}const mb="KHR_draco_mesh_compression";function hz(s,e){const i=s.extensions&&s.extensions[mb];if(!i)return;const a=new Na.Decoder,u=lI(e,i.bufferView),f=new Na.Mesh;if(!a.DecodeArrayToMesh(u,u.byteLength,f))throw new Error("Failed to decode Draco mesh");const m=e.json.accessors[s.indices],_=Mv[m.componentType],b=m.count*_.BYTES_PER_ELEMENT,S=Na._malloc(b);_===Uint16Array?a.GetTrianglesUInt16Array(f,b,S):a.GetTrianglesUInt32Array(f,b,S),nI(Na.memory.buffer.slice(S,S+b),m,e),Na._free(S);for(const I of Object.keys(i.attributes)){const C=a.GetAttributeByUniqueId(f,i.attributes[I]),k=e.json.accessors[s.attributes[I]],M=uz[k.componentType],R=k.count*og[k.type]*Mv[k.componentType].BYTES_PER_ELEMENT,F=Na._malloc(R);a.GetAttributeDataArrayForAllPoints(f,C,Na[M],R,F),nI(Na.memory.buffer.slice(F,F+R),k,e),Na._free(F)}a.destroy(),f.destroy(),delete s.extensions[mb]}const Rv="EXT_meshopt_compression";function dz(s,e){if(!s.extensions||!s.extensions[Rv])return;const i=s.extensions[Rv],a=new Uint8Array(e.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),u=new Uint8Array(i.count*i.byteStride);pb.decodeGltfBuffer(u,i.count,i.byteStride,a,i.mode,i.filter),s.buffer=e.buffers.length,s.byteOffset=0,e.buffers[s.buffer]=u.buffer,delete s.extensions[Rv]}const sI=1179937895,oI=new TextDecoder("utf8");function aI(s,e){return new URL(s,e).href}function fz(s,e,i,a){return fetch(aI(s.uri,a)).then(u=>u.arrayBuffer()).then(u=>{e.buffers[i]=u})}function lI(s,e){const i=s.json.bufferViews[e];return new Uint8Array(s.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function pz(s,e,i,a){if(s.uri){const u=aI(s.uri,a);return fetch(u).then(f=>f.blob()).then(f=>createImageBitmap(f)).then(f=>{e.images[i]=f})}if(s.bufferView!==void 0){const u=lI(e,s.bufferView),f=new Blob([u],{type:s.mimeType});return createImageBitmap(f).then(m=>{e.images[i]=m})}}function cI(s,e=0,i){const a={json:null,images:[],buffers:[]};if(new Uint32Array(s,e,1)[0]===sI){const I=new Uint32Array(s,e);let C=2;const k=(I[C++]>>2)-3,M=I[C++]>>2;if(C++,a.json=JSON.parse(oI.decode(I.subarray(C,C+M))),C+=M,C<k){const R=I[C++];C++;const F=e+(C<<2);a.buffers[0]=s.slice(F,F+R)}}else a.json=JSON.parse(oI.decode(new Uint8Array(s,e)));const{buffers:u,images:f,meshes:m,extensionsUsed:_,bufferViews:b}=a.json;let S=Promise.resolve();if(u){const I=[];for(let C=0;C<u.length;C++){const k=u[C];k.uri?I.push(fz(k,a,C,i)):a.buffers[C]||(a.buffers[C]=null)}S=Promise.all(I)}return S.then(()=>{const I=[],C=_&&_.includes(mb),k=_&&_.includes(Rv);if(C&&I.push(function(){if(!Na)return sg??(sg=function(M){let R,F=null;function $(){R=new Uint8Array(F.buffer)}function U(){throw new Error("Unexpected Draco error.")}const H={a:{a:U,d:function(X,Q,ae){return R.copyWithin(X,Q,Q+ae)},c:function(X){const Q=R.length,ae=Math.max(X>>>0,Math.ceil(1.2*Q)),oe=Math.ceil((ae-Q)/65536);try{return F.grow(oe),$(),!0}catch{return!1}},b:U}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(M,H):M.then(X=>X.arrayBuffer()).then(X=>WebAssembly.instantiate(X,H))).then(X=>{const{Rb:Q,Qb:ae,P:oe,T:ge,X:ye,Ja:me,La:Se,Qa:Ae,Va:Ze,Wa:Ge,eb:qe,jb:et,f:Je,e:Qe,yb:Ne,zb:it,Ab:Ke,Bb:rt,Db:tt,Gb:St}=X.instance.exports;F=Qe;const Et=(()=>{let mt=0,_t=0,Vt=0,Rt=0;return xt=>{Vt&&(Q(Rt),Q(mt),_t+=Vt,Vt=mt=0),mt||(_t+=128,mt=ae(_t));const Jt=xt.length+7&-8;let yi=mt;Jt>=_t&&(Vt=Jt,yi=Rt=ae(Jt));for(let Bi=0;Bi<xt.length;Bi++)R[yi+Bi]=xt[Bi];return yi}})();return $(),Je(),{memory:Qe,_free:Q,_malloc:ae,Mesh:class{constructor(){this.ptr=oe()}destroy(){ge(this.ptr)}},Decoder:class{constructor(){this.ptr=me()}destroy(){et(this.ptr)}DecodeArrayToMesh(mt,_t,Vt){const Rt=Et(mt),xt=Se(this.ptr,Rt,_t,Vt.ptr);return!!ye(xt)}GetAttributeByUniqueId(mt,_t){return{ptr:Ae(this.ptr,mt.ptr,_t)}}GetTrianglesUInt16Array(mt,_t,Vt){Ze(this.ptr,mt.ptr,_t,Vt)}GetTrianglesUInt32Array(mt,_t,Vt){Ge(this.ptr,mt.ptr,_t,Vt)}GetAttributeDataArrayForAllPoints(mt,_t,Vt,Rt,xt){qe(this.ptr,mt.ptr,_t.ptr,Vt,Rt,xt)}},DT_INT8:Ne(),DT_UINT8:it(),DT_INT16:Ke(),DT_UINT16:rt(),DT_UINT32:tt(),DT_FLOAT32:St()}})}(fetch(KE())),sg.then(M=>{Na=M,sg=void 0}))}()),k&&I.push(function(){if(pb)return;const M=function(R){let F;const $=WebAssembly.instantiateStreaming(R,{}).then(X=>{F=X.instance,F.exports.__wasm_call_ctors()}),U={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},H={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:$,supported:!0,decodeGltfBuffer(X,Q,ae,oe,ge,ye){(function(me,Se,Ae,Ze,Ge,qe,et){const Je=me.exports.sbrk,Qe=Ze+3&-4,Ne=Je(Qe*Ge),it=Je(qe.length),Ke=new Uint8Array(me.exports.memory.buffer);Ke.set(qe,it);const rt=Se(Ne,Ze,Ge,it,qe.length);if(rt===0&&et&&et(Ne,Qe,Ge),Ae.set(Ke.subarray(Ne,Ne+Ze*Ge)),Je(Ne-Je(0)),rt!==0)throw new Error(`Malformed buffer data: ${rt}`)})(F,F.exports[H[ge]],X,Q,ae,oe,F.exports[U[ye]])}}}(fetch(YE()));return M.ready.then(()=>{pb=M})}()),f)for(let M=0;M<f.length;M++)I.push(pz(f[M],a,M,i));return(I.length?Promise.all(I):Promise.resolve()).then(()=>{if(C&&m)for(const{primitives:M}of m)for(const R of M)hz(R,a);if(k&&m&&b)for(const M of b)dz(M,a);return a})})}function uI(s){return fetch(s).then(e=>e.arrayBuffer()).then(e=>cI(e,0,s))}function gb(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function _b(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class yb{constructor(e,i,a,u){this.context=e,this.format=a,this.useMipmap=u&&u.useMipmap,this.texture=e.gl.createTexture(),this.update(i,{premultiply:u&&u.premultiply})}update(e,i){const a=e&&e instanceof HTMLVideoElement&&e.width===0?e.videoWidth:e.width,u=e&&e instanceof HTMLVideoElement&&e.height===0?e.videoHeight:e.height,{context:f}=this,{gl:m}=f,{x:_,y:b}=i&&i.position?i.position:{x:0,y:0},S=_+a,I=b+u;!this.size||this.size[0]===S&&this.size[1]===I||(m.bindTexture(m.TEXTURE_2D,null),m.deleteTexture(this.texture),this.texture=m.createTexture(),this.size=null),m.bindTexture(m.TEXTURE_2D,this.texture),f.pixelStoreUnpackFlipY.set(!1),f.pixelStoreUnpack.set(1),f.pixelStoreUnpackPremultiplyAlpha.set(this.format===m.RGBA8&&(!i||i.premultiply!==!1));const C=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&S>0&&I>0){const k=this.useMipmap?Math.floor(Math.log2(Math.max(S,I)))+1:1;m.texStorage2D(m.TEXTURE_2D,k,this.format,S,I),this.size=[S,I]}this.size&&(C?m.texSubImage2D(m.TEXTURE_2D,0,_,b,gb(this.format),_b(this.format),e):"data"in e&&e.data&&m.texSubImage2D(m.TEXTURE_2D,0,_,b,a,u,gb(this.format),_b(this.format),e.data)),this.useMipmap&&m.generateMipmap(m.TEXTURE_2D)}bind(e,i,a=!1){const{context:u}=this,{gl:f}=u;f.bindTexture(f.TEXTURE_2D,this.texture),e!==this.minFilter&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MAG_FILTER,e),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_MIN_FILTER,this.useMipmap&&!a?e===f.NEAREST?f.NEAREST_MIPMAP_NEAREST:f.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),i!==this.wrapS&&(f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_S,i),f.texParameteri(f.TEXTURE_2D,f.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(e,i,a,u,f){const{context:m}=this,{gl:_}=m;_.bindTexture(_.TEXTURE_2D,this.texture),i!==this.magFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,i),this.magFilter=i),e!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap?e===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),this.wrapS=a),u!==this.wrapT&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,u),this.wrapT=u),f!==this.compareMode&&(f?(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_MODE,_.COMPARE_REF_TO_TEXTURE),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_FUNC,f)):_.texParameteri(_.TEXTURE_2D,_.TEXTURE_COMPARE_MODE,_.NONE),this.compareMode=f)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class ag{constructor(e,i){this.context=e,this.texture=i}bind(e,i){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.minFilter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,e),this.minFilter=e),i!==this.wrapS&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,i),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,i),this.wrapS=i)}}const mz=wi([{name:"a_pos_3f",components:3,type:"Float32"}]),gz=wi([{name:"a_color_3f",components:3,type:"Float32"}]),_z=wi([{name:"a_color_4f",components:4,type:"Float32"}]),yz=wi([{name:"a_uv_2f",components:2,type:"Float32"}]),vz=wi([{name:"a_normal_3f",components:3,type:"Float32"}]),xz=wi([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),bz=wi([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function hI(s,e){const i=Dv(s.projection,s.zoom,s.width,s.height),a=function(f,m,_,b,S){const I=new le(_.lng-180*Jc,_.lat),C=new le(_.lng+180*Jc,_.lat),k=f.project(I.lng,I.lat),M=f.project(C.lng,C.lat),R=-Math.atan2(M.y-k.y,M.x-k.x),F=yt.fromLngLat(_);F.y=pe(F.y,-1+Jc,1-Jc);const $=F.toLngLat(),U=f.project($.lng,$.lat),H=yt.fromLngLat($);H.x+=Jc;const X=H.toLngLat(),Q=f.project(X.lng,X.lat),ae=fI(Q.x-U.x,Q.y-U.y,R),oe=yt.fromLngLat($);oe.y+=Jc;const ge=oe.toLngLat(),ye=f.project(ge.lng,ge.lat),me=fI(ye.x-U.x,ye.y-U.y,R),Se=Math.abs(ae.x)/Math.abs(me.y),Ae=Ee([]);We(Ae,Ae,-R*(1-(S?0:b)));const Ze=Ee([]);return ke(Ze,Ze,[1,1-(1-Se)*b,1]),Ze[4]=-me.x/me.y*b,We(Ze,Ze,R),K(Ze,Ae,Ze),Ze}(s.projection,0,s.center,i,e),u=dI(s);return ke(a,a,[u,u,1]),a}function dI(s){const e=s.projection,i=Dv(s.projection,s.zoom,s.width,s.height),a=vb(e,s.center),u=vb(e,le.convert(e.center));return Math.pow(2,a*i+(1-i)*u)}function Dv(s,e,i,a,u=1/0){const f=s.range;if(!f)return 0;const m=Math.min(u,Math.max(i,a)),_=Math.log2(m/1024);return Pe(f[0]+_,f[1]+_,e)}const Jc=1/4e4;function vb(s,e){const i=pe(e.lat,-85.051129,Ie),a=new le(e.lng-180*Jc,i),u=new le(e.lng+180*Jc,i),f=s.project(a.lng,i),m=s.project(u.lng,i),_=yt.fromLngLat(a),b=yt.fromLngLat(u),S=m.x-f.x,I=m.y-f.y,C=b.x-_.x,k=b.y-_.y,M=Math.sqrt((C*C+k*k)/(S*S+I*I));return Math.log2(M)}function fI(s,e,i){const a=Math.cos(i),u=Math.sin(i);return{x:s*a-e*u,y:s*u+e*a}}function pI(s,e,i){Ee(s),We(s,s,Pi(e[2])),Be(s,s,Pi(e[0])),Le(s,s,Pi(e[1])),ke(s,s,i),K(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Ov(s,e,i,a,u,f,m,_){const b=[i[0]-e[0],i[1]-e[1],0],S=[a[0]-e[0],a[1]-e[1],0];if(vi(b)<1e-12||vi(S)<1e-12)return Ps(s);const I=Di([],b,S);Si(I,I),Ht(S,a,e),b[2]=(f-u)*_,S[2]=(m-u)*_;const C=b;return Di(C,b,S),Si(C,C),go(s,I,C)}function zv(s,e,i=!1){const a=Zc(e.zoom),u=function(f,m,_){const b=m.worldSize,S=[f[12],f[13],f[14]],I=nt(S[1]/b),C=Ye(S[0]/b),k=Ee([]),M=je(1,I)*b,R=je(1,0)*b*$e(I,m.zoom),F=1/U1(b);let $=R*F;if(_){const Q=Dv(m.projection,m.zoom,m.width,m.height,1024);$=F*m.projection.pixelSpaceConversion(m.center.lat,b,Q)}const U=_e(I,C);Tt(U,U,Ot([],Si([],U),M*$*S[2]));const H=function(Q){const ae=[Q[0],Q[1],Q[2]];let oe=[0,1,0];const ge=Di([],oe,ae);return Di(oe,ae,ge),pr(oe)===0&&(oe=[0,1,0],Di(ge,ae,oe)),Si(ge,ge),Si(oe,oe),Si(ae,ae),[ge[0],ge[1],ge[2],0,oe[0],oe[1],oe[2],0,ae[0],ae[1],ae[2],0,Q[0],Q[1],Q[2],1]}(U);ke(k,k,[$,$,$*M]),fe(k,k,[-S[0],-S[1],-S[2]]);const X=K([],m.globeMatrix,H);return K(X,X,k),K(X,X,f),X}(s,e,i);if(a>0){const f=function(m,_){const b=_.worldSize,S=je(1,0)*b*$e(_.center.lat,_.zoom)/U1(b),I=je(1,_.center.lat)*b,C=Ee([]);Le(C,C,Pi(_.center.lng)),Be(C,C,Pi(_.center.lat)),fe(C,C,[0,0,W]),ke(C,C,[S,S,S*I]);const k=_.point;return fe(C,C,[-k.x,-k.y,0]),K(C,C,m),K(C,_.globeMatrix,C)}(s,e);return function(m,_,b){const S=(R,F,$)=>{const U=vi(R),H=vi(F),X=Xl(R,F,$);return Ot(X,X,1/vi(X)*qt(U,H,$))},I=S([m[0],m[1],m[2]],[_[0],_[1],_[2]],b),C=S([m[4],m[5],m[6]],[_[4],_[5],_[6]],b),k=S([m[8],m[9],m[10]],[_[8],_[9],_[10]],b),M=Xl([m[12],m[13],m[14]],[_[12],_[13],_[14]],b);return[I[0],I[1],I[2],0,C[0],C[1],C[2],0,k[0],k[1],k[2],0,M[0],M[1],M[2],1]}(u,f,a)}return u}function xb(s,e,i,a){const u=Ui.projectAabbCorners(a,i);let f=Number.MAX_VALUE;for(let _=0;_<u.length;++_){const b=u[_];b[0]=(.5*b[0]+.5)*e.width,b[1]=(.5-.5*b[1])*e.height,b[2]<f&&(f=b[2])}const m=function(_){const b=[];let S=0;for(let M=1;M<_.length;M++)(_[M][0]<_[S][0]||_[M][0]===_[S][0]&&_[M][1]<_[S][1])&&(S=M);let I,C=S;const k=new Uint8Array(_.length);do{if(k[C])break;b.push(new at(_[C][0],_[C][1])),k[C]=1,I=(C+1)%_.length;for(let M=0;M<_.length;M++){if(_[M][0]===_[I][0]&&_[M][1]===_[I][1]||_[M][0]===_[C][0]&&_[M][1]===_[C][1])continue;const R=[_[M][0]-_[C][0],_[M][1]-_[C][1]],F=[_[I][0]-_[C][0],_[I][1]-_[C][1]],$=R[0]*F[1]-R[1]*F[0];($>0||$===0&&R[0]*F[0]+R[1]*F[1]>=0&&R[0]*R[0]+R[1]*R[1]>F[0]*F[0]+F[1]*F[1])&&(I=M)}C=I}while(C!==S);return b.length>0&&b.push(b[0]),b}(u);if(Tr(s,m))return f}const Eh=64,cf={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Bv(s,e,i,a,u,f,m,_,b,S=!1){const I=i.zoom,C=i.project(a),k=$e(a.lat,I),M=1/k;Ee(s),fe(s,s,[C.x+m[0]*M,C.y+m[1]*M,m[2]]);let R=1,F=1;const $=i.worldSize;if(S){if(i.projection.name==="mercator"){let Q=0;i.elevation&&(Q=i.elevation.getAtPointOrZero(new yt(C.x/$,C.y/$),0));const ae=zn([],[C.x,C.y,Q,1],i.projMatrix)[3]/i.cameraToCenterDistance;R=ae,F=ae*$e(i.center.lat,I)}else if(i.projection.name==="globe"){const Q=zv(s,i),ae=[0,0,0,1];zn(ae,ae,K([],i.projMatrix,Q));const oe=ae[3]/i.cameraToCenterDistance,ge=Zc(I),ye=i.projection.pixelsPerMeter(a.lat,$)*$e(a.lat,I),me=i.projection.pixelsPerMeter(i.center.lat,$)*$e(i.center.lat,I);R=oe/qt(ye,Xe(i.center.lat),ge),F=oe*k/ye,R*=me,F*=me}}else R=M;ke(s,s,[R,R,F]);const U=[...s],H=e.orientation,X=[];if(pI(X,[H[0]+(u?u[0]:0),H[1]+(u?u[1]:0),H[2]+(u?u[2]:0)],f),K(s,U,X),_&&i.elevation){let Q=0;const ae=[];if(b&&i.elevation){Q=function(ge,ye,me,Se,Ae){const Ze=ye.elevation;if(!Ze)return 0;const Ge=Ui.projectAabbCorners(me,Se),qe=je(1,Ae.lat)*ye.worldSize,et=function(_t,Vt){const Rt=[0,0,1],xt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Jt of xt){const yi=_t[Jt.corners[0]],Bi=_t[Jt.corners[1]],mi=_t[Jt.corners[2]],Ji=[Bi[0]-yi[0],Bi[1]-yi[1],Vt*(Bi[2]-yi[2])],ki=Di(Ji,Ji,[mi[0]-yi[0],mi[1]-yi[1],Vt*(mi[2]-yi[2])]);Si(ki,ki),Jt.dotProductWithUp=Qt(ki,Rt)}return xt.sort((Jt,yi)=>Jt.dotProductWithUp-yi.dotProductWithUp),xt[0].corners}(Ge,qe),Je=Ge[et[0]],Qe=Ge[et[1]],Ne=Ge[et[2]],it=Ge[et[3]],Ke=Ze.getAtPointOrZero(new yt(Je[0]/ye.worldSize,Je[1]/ye.worldSize),0),rt=Ze.getAtPointOrZero(new yt(Qe[0]/ye.worldSize,Qe[1]/ye.worldSize),0),tt=Ze.getAtPointOrZero(new yt(Ne[0]/ye.worldSize,Ne[1]/ye.worldSize),0),St=Ze.getAtPointOrZero(new yt(it[0]/ye.worldSize,it[1]/ye.worldSize),0),Et=(Ke+St)/2,mt=(rt+tt)/2;return Et>mt?rt<tt?Ov(ge,Qe,it,Je,rt,St,Ke,qe):Ov(ge,Ne,Je,it,tt,Ke,St,qe):Ke<St?Ov(ge,Je,Qe,Ne,Ke,rt,tt,qe):Ov(ge,it,Ne,Qe,St,tt,rt,qe),Math.max(Et,mt)}(ae,i,e.aabb,s,a);const oe=K([],zt([],ae),X);K(s,U,oe)}else Q=i.elevation.getAtPointOrZero(new yt(C.x/$,C.y/$),0);Q!==0&&(s[14]+=Q)}}class mI{constructor(e,i,a,u,f){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=i,this.position=a!=null?new le(a[0],a[1]):new le(0,0),this.orientation=u??[0,0,0],this.nodes=f,this.uploaded=!1,this.aabb=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,i){K(e.globalMatrix,i,e.localMatrix);const a=this.nodeOverrides.get(e.name);if(a!==void 0){const m=[];f=a.orientation,Ee(u=m),Le(u,u,Pi(f[1])),We(u,u,Pi(f[2])),Be(u,u,Pi(f[0])),K(e.globalMatrix,e.globalMatrix,m)}var u,f;if(e.meshes)for(const m of e.meshes){const _=Ui.applyTransformFast(m.aabb,e.globalMatrix);this.aabb.encapsulate(_)}if(e.children)for(const m of e.children)this._applyTransformations(m,e.globalMatrix)}computeBoundsAndApplyParent(){const e=Ee([]);this.aabb=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const i of this.nodes)this._applyTransformations(i,e)}computeModelMatrix(e,i,a,u,f,m,_=!1){Bv(this.matrix,this,e.transform,this.position,i,a,u,f,m,_)}upload(e){if(!this.uploaded){for(const i of this.nodes)bb(i,e);for(const i of this.nodes)Fv(i);this.uploaded=!0}}destroy(){for(const e of this.nodes)wb(e)}}function lg(s,e,i=!1){s.uploaded||(s.gfxTexture=new yb(e,s.image,i?e.gl.R8:e.gl.RGBA8,{useMipmap:s.sampler.minFilter>=e.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function wz(s,e,i){s.indexBuffer=e.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=e.createVertexBuffer(s.vertexArray,mz.members,!1,!0),s.normalArray&&(s.normalBuffer=e.createVertexBuffer(s.normalArray,vz.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=e.createVertexBuffer(s.texcoordArray,yz.members,!1,!0)),s.colorArray&&(s.colorBuffer=e.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?gz:_z).members,!1,!0)),s.featureArray&&(s.pbrBuffer=e.createVertexBuffer(s.featureArray,bz.members,!0)),s.segments=xr.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const a=s.material;a.pbrMetallicRoughness.baseColorTexture&&lg(a.pbrMetallicRoughness.baseColorTexture,e),a.pbrMetallicRoughness.metallicRoughnessTexture&&lg(a.pbrMetallicRoughness.metallicRoughnessTexture,e),a.normalTexture&&lg(a.normalTexture,e),a.occlusionTexture&&lg(a.occlusionTexture,e,i),a.emissionTexture&&lg(a.emissionTexture,e)}function bb(s,e,i){if(s.meshes)for(const a of s.meshes)wz(a,e,i);if(s.children)for(const a of s.children)bb(a,e,i)}function Fv(s){if(s.meshes)for(const e of s.meshes)e.indexArray.destroy(),e.vertexArray.destroy(),e.colorArray&&e.colorArray.destroy(),e.normalArray&&e.normalArray.destroy(),e.texcoordArray&&e.texcoordArray.destroy(),e.featureArray&&e.featureArray.destroy();if(s.children)for(const e of s.children)Fv(e)}function Sz(s){s.pbrMetallicRoughness.baseColorTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture&&s.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),s.pbrMetallicRoughness.metallicRoughnessTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&s.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),s.normalTexture&&s.normalTexture.gfxTexture&&s.normalTexture.gfxTexture.destroy(),s.emissionTexture&&s.emissionTexture.gfxTexture&&s.emissionTexture.gfxTexture.destroy(),s.occlusionTexture&&s.occlusionTexture.gfxTexture&&s.occlusionTexture.gfxTexture.destroy()}function wb(s){if(s.meshes)for(const e of s.meshes)e.vertexBuffer&&(e.vertexBuffer.destroy(),e.indexBuffer.destroy(),e.normalBuffer&&e.normalBuffer.destroy(),e.texcoordBuffer&&e.texcoordBuffer.destroy(),e.colorBuffer&&e.colorBuffer.destroy(),e.pbrBuffer&&e.pbrBuffer.destroy(),e.segments.destroy(),e.material&&Sz(e.material));if(s.children)for(const e of s.children)wb(e)}function Ih(s,e){const i=s.json.bufferViews[e.bufferView],a=Mv[e.componentType];return new a(s.buffers[i.buffer],(e.byteOffset||0)+(i.byteOffset||0),e.count*(i.byteStride&&i.byteStride!==og[e.type]*a.BYTES_PER_ELEMENT?i.byteStride/a.BYTES_PER_ELEMENT:og[e.type]))}function Sb(s,e,i,a){const u=Mv[e.componentType],f=function(I){switch(I){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(u),m=s.json.bufferViews[e.bufferView],_=m.byteStride?m.byteStride/u.BYTES_PER_ELEMENT:og[e.type],b=i.float32,S=b.length/i.capacity;for(let I=0,C=0;I<e.count*_;I+=_,C+=S)for(let k=0;k<S;k++)b[C+k]=a[I+k]*f;i._trim()}function Tz(s,e,i){const a=s.indices,u=s.attributes,f={};f.indexArray=new en;const m=e.json.accessors[a],_=m.count/3;f.indexArray.reserve(_);const b=Ih(e,m);for(let k=0;k<_;k++)f.indexArray.emplaceBack(b[3*k],b[3*k+1],b[3*k+2]);f.indexArray._trim(),f.vertexArray=new wo;const S=e.json.accessors[u.POSITION];f.vertexArray.reserve(S.count);const I=Ih(e,S);for(let k=0;k<S.count;k++)f.vertexArray.emplaceBack(I[3*k],I[3*k+1],I[3*k+2]);if(f.vertexArray._trim(),f.aabb=new Ui(S.min,S.max),f.centroid=function(k,M){const R=[0,0,0],F=k.length;if(F>0){for(let $=0;$<F;$++){const U=3*k[$];R[0]+=M[U],R[1]+=M[U+1],R[2]+=M[U+2]}R[0]/=F,R[1]/=F,R[2]/=F}return R}(b,I),u.COLOR_0!==void 0){const k=e.json.accessors[u.COLOR_0],M=og[k.type],R=Ih(e,k);f.colorArray=M===3?new wo:new vl,f.colorArray.resize(k.count),Sb(e,k,f.colorArray,R)}if(u.NORMAL!==void 0){f.normalArray=new wo;const k=e.json.accessors[u.NORMAL];f.normalArray.resize(k.count);const M=Ih(e,k);Sb(e,k,f.normalArray,M)}if(u.TEXCOORD_0!==void 0&&i.length>0){f.texcoordArray=new ql;const k=e.json.accessors[u.TEXCOORD_0];f.texcoordArray.resize(k.count);const M=Ih(e,k);Sb(e,k,f.texcoordArray,M)}if(u._FEATURE_ID_RGBA4444!==void 0){const k=e.json.accessors[u._FEATURE_ID_RGBA4444];e.json.extensionsUsed&&e.json.extensionsUsed.includes("EXT_meshopt_compression")&&(f.featureData=Ih(e,k))}u._FEATURE_RGBA4444!==void 0&&(f.featureData=new Uint32Array(Ih(e,e.json.accessors[u._FEATURE_RGBA4444]).buffer));const C=s.material;return f.material=function(k,M){const{emissiveFactor:R=[0,0,0],alphaMode:F="OPAQUE",alphaCutoff:$=.5,normalTexture:U,occlusionTexture:H,emissiveTexture:X,doubleSided:Q,name:ae}=k,{baseColorFactor:oe=[1,1,1,1],metallicFactor:ge=1,roughnessFactor:ye=1,baseColorTexture:me,metallicRoughnessTexture:Se}=k.pbrMetallicRoughness||{},Ae=H?M[H.index]:void 0;if(H&&H.extensions&&H.extensions.KHR_texture_transform&&Ae){const Ze=H.extensions.KHR_texture_transform;Ae.offsetScale=[Ze.offset[0],Ze.offset[1],Ze.scale[0],Ze.scale[1]]}return{name:ae,pbrMetallicRoughness:{baseColorFactor:new Hi(...oe),metallicFactor:ge,roughnessFactor:ye,baseColorTexture:me?M[me.index]:void 0,metallicRoughnessTexture:Se?M[Se.index]:void 0},doubleSided:Q,emissiveFactor:new Hi(...R),alphaMode:F,alphaCutoff:$,normalTexture:U?M[U.index]:void 0,occlusionTexture:Ae,emissionTexture:X?M[X.index]:void 0,defined:k.defined===void 0}}(C!==void 0?e.json.materials[C]:{defined:!1},i),f}function gI(s,e,i){const{matrix:a,rotation:u,translation:f,scale:m,mesh:_,extras:b,children:S,name:I}=s,C={};if(C.name=I,C.localMatrix=a||function(k,M,R,F){var $=M[0],U=M[1],H=M[2],X=M[3],Q=$+$,ae=U+U,oe=H+H,ge=$*Q,ye=$*ae,me=$*oe,Se=U*ae,Ae=U*oe,Ze=H*oe,Ge=X*Q,qe=X*ae,et=X*oe,Je=F[0],Qe=F[1],Ne=F[2];return k[0]=(1-(Se+Ze))*Je,k[1]=(ye+et)*Je,k[2]=(me-qe)*Je,k[3]=0,k[4]=(ye-et)*Qe,k[5]=(1-(ge+Ze))*Qe,k[6]=(Ae+Ge)*Qe,k[7]=0,k[8]=(me+qe)*Ne,k[9]=(Ae-Ge)*Ne,k[10]=(1-(ge+Se))*Ne,k[11]=0,k[12]=R[0],k[13]=R[1],k[14]=R[2],k[15]=1,k}([],u||[0,0,0,1],f||[0,0,0],m||[1,1,1]),C.globalMatrix=xe(C.localMatrix),_!==void 0){C.meshes=i[_];const k=C.anchor=[0,0];for(const M of C.meshes){const{min:R,max:F}=M.aabb;k[0]+=R[0]+F[0],k[1]+=R[1]+F[1]}k[0]=Math.floor(k[0]/C.meshes.length/2),k[1]=Math.floor(k[1]/C.meshes.length/2)}if(b&&(b.id&&(C.id=b.id),b.lights&&(C.lights=function(k){if(!k.length)return[];const M=function(H){const X=atob(H),Q=new Uint8Array(X.length);for(let ae=0;ae<X.length;ae++)Q[ae]=X.codePointAt(ae);return Q}(k),R=[],F=M.length/24,$=new Uint16Array(M.buffer),U=new Float32Array(M.buffer);for(let H=0;H<F;H++){const X=$[2*H*6]/30,Q=$[2*H*6+1]/30,ae=$[2*H*6+10]/100,oe=U[6*H+1],ge=U[6*H+2],ye=U[6*H+3],me=U[6*H+4],Se=ye-oe,Ae=me-ge,Ze=Math.hypot(Se,Ae);R.push({pos:[oe+.5*Se,ge+.5*Ae,Q],normal:[Ae/Ze,-Se/Ze,0],width:Ze,height:X,depth:ae,points:[oe,ge,ye,me]})}return R}(b.lights)),b.MAPBOX_geometry_bloom&&(C.isGeometryBloom=b.MAPBOX_geometry_bloom)),S){const k=[];for(const M of S)k.push(gI(e.json.nodes[M],e,i));C.children=k}return C}function Ez(s){if(s.vertices.length===0||s.indices.length===0)return null;const e=new Tv(s.vertices,s.indices,8,256),[i,a]=[e.min.clone(),e.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:e,min:i,max:a}}function Iz(s){if(!s.extras||!s.extras.ground)return null;const e=s.extras.ground;if(!e||!Array.isArray(e)||e.length===0)return null;const i=e[0];if(!i||!Array.isArray(i)||i.length===0)return null;const a=[];for(const m of i){if(!Array.isArray(m)||m.length!==2)continue;const _=m[0],b=m[1];typeof _=="number"&&typeof b=="number"&&a.push(new at(_,b))}if(a.length<3)return null;a.length>1&&a[a.length-1].equals(a[0])&&a.pop();let u=0;for(let m=0;m<a.length;m++){const _=a[m],b=a[(m+1)%a.length],S=a[(m+2)%a.length];u+=(_.x-b.x)*(S.y-b.y)-(S.x-b.x)*(_.y-b.y)}u>0&&a.reverse();const f=ef(a.flatMap(m=>[m.x,m.y]),[]);return f.length===0?null:{vertices:a,indices:f}}function Az(s,e){const i=[],a=[];let u=0;const f=[];for(const m of s){u=i.length;const _=m.vertexArray.float32,b=m.indexArray.uint16;for(let S=0;S<m.vertexArray.length;S++)f[0]=_[3*S+0],f[1]=_[3*S+1],f[2]=_[3*S+2],or(f,f,e),i.push(new at(f[0],f[1]));for(let S=0;S<3*m.indexArray.length;S++)a.push(b[S]+u)}if(a.length%3!=0)return null;for(let m=0;m<a.length;m+=3){const _=i[a[m+0]],b=i[a[m+1]],S=i[a[m+2]];(_.x-b.x)*(S.y-b.y)-(S.x-b.x)*(_.y-b.y)>0&&([a[m+1],a[m+2]]=[a[m+2],a[m+1]])}return{vertices:i,indices:a}}function Tb(s){const e=function(b,S){const I=[],C=WebGL2RenderingContext;if(b.json.textures)for(const k of b.json.textures){const M={magFilter:C.LINEAR,minFilter:C.NEAREST,wrapS:C.REPEAT,wrapT:C.REPEAT};k.sampler!==void 0&&Object.assign(M,b.json.samplers[k.sampler]),I.push({image:S[k.source],sampler:M,uploaded:!1})}return I}(s,s.images),i=function(b,S){const I=[];for(const C of b.json.meshes){const k=[];for(const M of C.primitives)k.push(Tz(M,b,S));I.push(k)}return I}(s,e),{scenes:a,scene:u,nodes:f}=s.json,m=a?a[u||0].nodes:[...f.keys()],_=[];for(const b of m)_.push(gI(f[b],s,i));return function(b,S,I){const C={},k=new Set;for(let M=0;M<b.length;M++){const R=I[S[M]];if(!R.extras)continue;const F=R.extras["mapbox:footprint:version"],$=R.extras["mapbox:footprint:id"];(F||$)&&k.add(M),F==="1.0.0"&&$&&(C[$]=M)}for(let M=0;M<b.length;M++){if(k.has(M))continue;const R=b[M],F=I[S[M]];if(!F.extras)continue;let $=null;R.id in C&&($=Az(b[C[R.id]].meshes,R.localMatrix)),$||($=Iz(F)),$&&(R.footprint=Ez($))}if(k.size>0){const M=Array.from(k.values()).sort((R,F)=>R-F);for(let R=M.length-1;R>=0;R--)b.splice(M[R],1)}}(_,m,s.json.nodes),_}function Cz(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const e=s.vertexArray.float32,i=s.aabb.min[0]-1,a=s.aabb.min[1]-1,u=Eh/(s.aabb.max[0]-i+2),f=Eh/(s.aabb.max[1]-a+2);for(let m=0;m<e.length;m+=3){const _=e[m+2],b=(e[m+0]-i)*u|0,S=(e[m+1]-a)*f|0;_>s.heightmap[S*Eh+b]&&(s.heightmap[S*Eh+b]=_)}}function _I(s,e,i,a,u){i.reserve(i.length+4*s.length),a.reserve(a.length+10*s.length),u.reserve(u.length+10*s.length);let f=a.length;for(const m of s){const _=Math.min(10,Math.max(4,1.3*m.height))*e,b=[-m.normal[1],m.normal[0],0],S=Math.min(.29,.1*m.width/m.depth),I=m.width-2*m.depth*e*(S+.01),C=di([],m.pos,b,I/2),k=di([],m.pos,b,-I/2),M=[C[0],C[1],C[2]+m.height],R=[k[0],k[1],k[2]+m.height],F=di([],m.normal,b,S);Ot(F,F,_);const $=di([],m.normal,b,-S);Ot($,$,_),Tt(F,C,F),Tt($,k,$),C[2]+=.1,k[2]+=.1,a.emplaceBack(F[0],F[1],F[2]),a.emplaceBack($[0],$[1],$[2]),a.emplaceBack(C[0],C[1],C[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(M[0],M[1],M[2]),a.emplaceBack(R[0],R[1],R[2]),a.emplaceBack(C[0],C[1],C[2]),a.emplaceBack(k[0],k[1],k[2]),a.emplaceBack(F[0],F[1],F[2]),a.emplaceBack($[0],$[1],$[2]);const U=I/_/2;u.emplaceBack(-U-S,-1,U,.8),u.emplaceBack(U+S,-1,U,.8),u.emplaceBack(-U,0,U,1.3),u.emplaceBack(U,0,U,1.3),u.emplaceBack(U+S,-.8,U,.7),u.emplaceBack(U+S,-.8,U,.7),u.emplaceBack(0,0,U,1.3),u.emplaceBack(0,0,U,1.3),u.emplaceBack(U+S,-1.2,U,.8),u.emplaceBack(U+S,-1.2,U,.8),i.emplaceBack(6+f,4+f,8+f),i.emplaceBack(7+f,9+f,5+f),i.emplaceBack(0+f,1+f,2+f),i.emplaceBack(1+f,3+f,2+f),f+=10}}function kz(s,e){const i={};i.indexArray=new en,i.vertexArray=new wo,i.colorArray=new vl,_I(s,e,i.indexArray,i.vertexArray,i.colorArray);const a={defined:!0};a.emissiveFactor=Hi.black;const u={};return u.baseColorFactor=Hi.white,a.pbrMetallicRoughness=u,i.material=a,i.aabb=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const yI=wi([{name:"a_pos_3f",components:3,type:"Float32"}]),Lz=wi([{name:"a_normal_3",components:3,type:"Int16"}]),Pz=wi([{name:"a_centroid_3",components:3,type:"Int16"}]),vI=wi([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),Mz=wi([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),Rz=wi([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),Dz=wi([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),Oz=wi([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),zz=wi([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),xI=Ti.types,jv=32767;function Bz(s,e){const i=gt+e;for(const a of s)for(const u of a)if(u.x<-e||u.x>i||u.y<-e||u.y>i)return!1;return!0}function Fz(s){switch(s){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error(`Unknown roof shape: ${s}`)}}class Eb{constructor(){this.layoutVertexArray=new wo,this.layoutAttenuationArray=new vl,this.layoutColorArray=new Qs,this.indexArray=new en,this.indexArrayForConflation=new en,this.segmentsBucket=new xr}}class Ib{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new xr,this.entranceBloom=new Eb;const i=66560;this.layoutVertexArray=new wo,this.layoutVertexArray.reserve(i),this.layoutNormalArray=new Ba,this.layoutNormalArray.reserve(i),this.layoutCentroidArray=new Ba,this.layoutCentroidArray.reserve(i),this.layoutColorArray=new Qs,this.layoutColorArray.reserve(i),this.layoutFloodLightDataArray=new fh,this.layoutFloodLightDataArray.reserve(i),this.layoutAOArray=new Kd,this.layoutAOArray.reserve(i),this.indexArray=new en,this.indexArray.reserve(66560),this.indexArrayForConflation=new en,this.segmentsBucket=new xr,this.entranceBloom=new Eb,e&&(this.layoutFacadePaintArray=new Qs,this.layoutFacadeDataArray=new Vc,this.layoutFacadeVerticalRangeArray=new Qs)}reserve(e,i,a){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(i),a&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class bI{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new ql,this.footprintsIndices=new fh,this.footprintsMin=new at(1/0,1/0),this.footprintsMax=new at(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new Ib(!1),this.buildingWithFacade=new Ib(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=e.projection,this.groundEffect=new lb(e),this.groundEffect.groundRadiusArray=new Tn,this.hasAppearances=null}updateFootprints(e,i){const a=new Tv([],[],1),u={vertices:[],indices:new Uint32Array(0),grid:a,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};i.push({footprint:u,id:e})}updateAppearances(e,i,a,u){}prepare(){return function(){if(Pv!=null||XE!=null)return null;if(lf!=null)return lf;const e=fetch(Jr.BUILDING_GEN_URL);return lf=function(i){let a,u,f,m,_;function b(){a=new Uint8Array(_.buffer),u=new Int16Array(_.buffer),f=new Int32Array(_.buffer),m=new Float32Array(_.buffer)}function S(){throw new Error("Unexpected BuildingGen error.")}const I=()=>{},C={a:{a:S,f:function(k){const M=a.length,R=Math.max(k>>>0,Math.ceil(1.2*M)),F=Math.ceil((R-M)/65536);try{return _.grow(F),b(),!0}catch{return!1}},g:S,b:I,c:I,d:I,e:I}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,C):i.then(k=>k.arrayBuffer()).then(k=>WebAssembly.instantiate(k,C))).then(k=>{const M=k.instance.exports;return(0,M.g)(),_=M.f,b(),new lz({setStyle:M.h,setAOOptions:M.i,setMetricOptions:M.j,setStructuralOptions:M.k,setFacadeOptions:M.l,setFauxFacadeOptions:M.m,setFacadeClassifierOptions:M.n,addFeature:M.o,addFacade:M.p,generateMesh:M.q,getLastError:M.r,getOuterRingLength:M.s,getMeshCount:M.t,getPositionsPtr:M.u,getPositionsLength:M.v,getNormalsPtr:M.w,getNormalsLength:M.x,getAOPtr:M.y,getAOLength:M.z,getUVPtr:M.A,getUVLength:M.B,getFauxFacadePtr:M.C,getFauxFacadeLength:M.D,getIndicesPtr:M.E,getIndicesLength:M.F,getBuildingPart:M.G,getRingCount:M.H,getRingPtr:M.I,getRingLength:M.J,malloc:M.K,free:M.L,heapU8:a,heap16:u,heap32:f,heapF32:m})})}(e).then(i=>(lf=null,Pv=i,Pv)).catch(i=>{Kt("Could not load building-gen"),lf=null,XE=i}),lf}()}populate(e,i,a,u){const f=cz();if(!f)return;const m=ht(a);this.tileToMeter=m,this.brightness=i.brightness,f.setStyle({normalScale:[1,-1,m],tileToMeters:m}),f.setAOOptions(!1,.3),f.setMetricOptions(!1,16),f.setStructuralOptions(!0),f.setFacadeClassifierOptions(3);const _=new Map,b=new Map;let S=0;for(const{feature:U}of e){if(xI[U.type]!=="LineString"){_.set(U.id,U.properties.source_id);continue}const H=this.layers[0]._featureFilter.needGeometry;if(H&&!this.layers[0]._featureFilter.filter(new Yi(this.zoom),U,a))continue;const X=ci(U,H);if(!H&&!this.layers[0]._featureFilter.filter(new Yi(this.zoom),X,a))continue;const Q=H?X.geometry:Xt(U,a,u),ae=[];for(const me of Q)for(const Se of me)ae.push(Se.x),ae.push(Se.y);const oe={coordinates:ae,crossPerc:U.properties.cross_perc,distanceToRoad:U.properties.distance_to_road,entrances:U.properties.entrances,sourceId:0},ge=U.properties.source_id;let ye=b.get(ge);ye||(ye=[],b.set(ge,ye)),ye.push(oe),++S}this.maxHeight=0;const I=new Array,C=new Set,k=U=>{U!=null&&C.add(U)},M=(U,H)=>{U!=null&&I.push({buildingId:U,footprintIndex:H})},R=64*(e.length-S),F=R/2;this.buildingWithFacade.reserve(R,F,!0),this.buildingWithoutFacade.reserve(2*R,2*F,!1),this.footprintsIndices.reserve(16*(e.length-S)),this.footprintsVertices.reserve(8*(e.length-S));for(const{feature:U,id:H,index:X,sourceLayerIndex:Q}of e){if(xI[U.type]==="LineString")continue;const ae=this.layers[0]._featureFilter.needGeometry;if(ae&&!this.layers[0]._featureFilter.filter(new Yi(this.zoom),U,a))continue;let oe=null;if(U.properties&&U.properties.hasOwnProperty("building_id")&&(oe=Number(U.properties.building_id),C.has(oe)))continue;const ge=ci(U,ae);if(!ae&&!this.layers[0]._featureFilter.filter(new Yi(this.zoom),ge,a))continue;const ye=ae?ge.geometry:Xt(U,a,u),me=Xm(ye,500);let Se=!1;for(const gi of me)if(gi.length!==1){Se=!0;break}if(Se){k(oe);continue}if(!Bz(ye,163)){k(oe);continue}const Ae=this.layers[0],Ze=Fz(Ae.layout.get("building-roof-shape").evaluate(U,{},a)),Ge=Ae.layout.get("building-base").evaluate(U,{},a),qe=Ae.layout.get("building-height").evaluate(U,{},a),et=Ae.layout.get("building-flood-light-ground-radius").evaluate(U,{},a),Je=Ae.paint.get("building-ambient-occlusion-intensity"),Qe=et/this.tileToMeter;U.properties["building-part"]="roof";const Ne=Ae.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),it=Ae.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="wall";const Ke=Ae.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),rt=Ae.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="window";const tt=Ae.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),St=Ae.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);U.properties["building-part"]="door";const Et=Ae.paint.get("building-color").evaluate(U,{},this.canonical).toPremultipliedRenderColor(this.lut),mt=Ae.paint.get("building-emissive-strength").evaluate(U,{},this.canonical);let _t=Ae.layout.get("building-flood-light-wall-radius").evaluate(U,{},a);_t=pe(_t,0,2048);const Vt=_t/2048*jv,Rt=_.get(H),xt=b.get(Rt)||[],Jt=xt.length!==0&&Ae.layout.get("building-facade").evaluate(U,{},a);f.setFacadeOptions(4,!0),f.setFauxFacadeOptions(Jt,!1,1);let yi=0,Bi=0,mi=0,Ji=0,ki=0,Fr=0,Ri=0,Xi=0,gr=0,Er=0,Ir=0;if(Jt){let gi=Math.round(Ae.layout.get("building-facade-floors").evaluate(U,{},a));if(Ge===0){gi=Math.max(1,gi-(xt.length>0?1:0));let Nr=4;if(qe>100){const nn=[10,13,15];Nr=nn[U.id?U.id%nn.length:0]}else qe<=10&&(Nr=3);f.setFacadeOptions(Nr,!0),ki=(qe<15?1.3:1.61803)*Nr/m}else ki=Ge/m;Fr=qe/m,ki=Math.min(ki,Fr),mi=Ae.layout.get("building-facade-unit-width").evaluate(U,{},a)/m,Ji=(Fr-ki)/gi,f.setFauxFacadeOptions(!0,!0,mi);const gn=Ae.layout.get("building-facade-window").evaluate(U,{},a);yi=gn[0],Bi=gn[1],Ri=Math.floor(65535*Math.min(1,ki/gt)),Xi=Math.floor(65535*Math.min(1,Fr/gt)),gr=Math.floor(255*yi)<<8|Math.floor(255*Bi),Er=Math.floor(65535*Math.min(1,mi/gt)),Ir=Math.floor(65535*Math.min(1,Ji/gt))}const jr=Array(me.length),En={x:1/0,y:1/0},Nn={x:-1/0,y:-1/0},qr={x:0,y:0};let rn=0;for(let gi=0;gi<me.length;gi++){const gn=me[gi];if(gn.length>0){const Nr=[],nn=Array(gn.length+1);nn[0]=0;for(let $o=0;$o<gn.length;$o++){const Us=gn[$o];for(let ao=0;ao<Us.length;ao++){const _n=Us[Us.length-ao-1];En.x=Math.min(En.x,_n.x),En.y=Math.min(En.y,_n.y),Nn.x=Math.max(Nn.x,_n.x),Nn.y=Math.max(Nn.y,_n.y),qr.x+=_n.x,qr.y+=_n.y,rn++,Nr.push(_n.x),Nr.push(_n.y)}nn[$o+1]=Nr.length}jr[gi]={id:U.id?U.id:0,height:qe,minHeight:Ge,sourceId:0,roofType:Ze,coordinates:Nr,ringIndices:nn}}}qr.x/=rn||1,qr.y/=rn||1;const un=f.generateMesh(jr,xt);if(typeof un=="string"){Kt(`Unable to generate building ${U.id}: ${un}`),k(oe);continue}if(un.meshes.length===0||un.modifiedPolygonRings.length===0){k(oe);continue}const ui=Jt?this.buildingWithFacade:this.buildingWithoutFacade;let Ar=0;for(const gi of un.meshes)Ar+=gi.positions.length/3;const Lr=ui.segmentsBucket.prepareSegment(Ar,ui.layoutVertexArray,ui.indexArray),oo=[];let ds=null,In=0,fs=-1;const Sl=ui.layoutVertexArray.length,qn=Sl+Ar;ui.layoutVertexArray.resize(qn),ui.layoutCentroidArray.resize(qn),ui.layoutNormalArray.resize(qn),ui.layoutAOArray.resize(qn),ui.layoutColorArray.resize(qn),ui.layoutFloodLightDataArray.resize(qn),Jt&&(ui.layoutFacadePaintArray.resize(qn),ui.layoutFacadeDataArray.resize(qn),ui.layoutFacadeVerticalRangeArray.resize(qn));const u0=ui.indexArray.length;let bf=0,Ts=Sl;for(const gi of un.meshes){let gn,Nr;if(gi.buildingPart===1)gn=Ne,Nr=it;else if(gi.buildingPart===0)gn=Ke,Nr=rt;else if(gi.buildingPart===2)gn=tt,Nr=St;else{if(gi.buildingPart!==3)continue;gn=Et,Nr=mt}if(Nr=pe(Nr,0,1),gi.buildingPart===3){const Zr=new Array;for(let Xn=0;Xn<gi.positions.length;Xn+=12){const ru=gi.positions[Xn+0],Cn=gi.positions[Xn+1],Vs=gi.positions[Xn+3],_a=gi.positions[Xn+4],Il=gi.positions[Xn+2],hw=gi.positions[Xn+8]-Il,dw=1,Mg=Vs-ru,Sf=_a-Cn,$a=Math.hypot(Mg,Sf);Zr.push({pos:[ru+.5*Mg,Cn+.5*Sf,Il],normal:[Sf/$a,-Mg/$a,0],width:$a,height:hw,depth:dw,points:[ru,Cn,Vs,_a]})}const An=ui.entranceBloom.segmentsBucket.prepareSegment(10*Zr.length,ui.entranceBloom.layoutVertexArray,ui.entranceBloom.indexArray),sn=ui.entranceBloom.layoutVertexArray.length;In=ui.entranceBloom.indexArray.length,_I(Zr,.5/this.tileToMeter,ui.entranceBloom.indexArray,ui.entranceBloom.layoutVertexArray,ui.entranceBloom.layoutAttenuationArray);const Zn=ui.entranceBloom.layoutVertexArray.length-sn;fs=ui.entranceBloom.indexArray.length-In;for(let Xn=0;Xn<Zn;Xn++)ui.entranceBloom.layoutColorArray.emplaceBack(255*Et.r<<8|255*Et.g,255*Et.b<<8|51*mt);An.vertexLength+=Zn,An.primitiveLength+=fs,ds={part:gi.buildingPart,vertexOffset:sn,vertexLength:Zn}}ui.layoutVertexArray.float32.set(gi.positions,3*Ts);const nn=gi.positions.length/3;for(let Zr=0;Zr<nn;++Zr){const An=3*Zr;bf=Math.max(bf,gi.positions[An+2]);const sn=gi.normals[An+1]*jv,Zn=gi.normals[An+2]*jv,Xn=3*(Ts+Zr);ui.layoutNormalArray.int16[Xn]=gi.normals[An]*jv,ui.layoutNormalArray.int16[Xn+1]=sn,ui.layoutNormalArray.int16[Xn+2]=Zn;const ru=gi.ao[Zr];ui.layoutAOArray.uint8[Ts+Zr]=255*ru;const Cn=1+(ru-1)*Je,Vs=255*gn.b*Cn<<8|255*Nr;ui.layoutColorArray.uint16[2*(Ts+Zr)]=255*gn.r*Cn<<8|255*gn.g*Cn,ui.layoutColorArray.uint16[2*(Ts+Zr)+1]=Vs}const $o=Math.floor(qr.x),Us=Math.floor(qr.y),ao=Math.floor(qe);for(let Zr=0;Zr<nn;++Zr){const An=3*(Ts+Zr);ui.layoutCentroidArray.int16[An]=$o,ui.layoutCentroidArray.int16[An+1]=Us,ui.layoutCentroidArray.int16[An+2]=ao}if(ui.layoutFloodLightDataArray.uint16.fill(gi.buildingPart===0?Vt:0,Ts,Ts+nn),Jt){const Zr=255*tt.r<<8|255*tt.g,An=255*tt.b<<8|255*St;for(let sn=0;sn<nn;++sn){const Zn=2*(Ts+sn);ui.layoutFacadePaintArray.uint16[Zn]=Zr,ui.layoutFacadePaintArray.uint16[Zn+1]=An}for(let sn=0;sn<nn;++sn)if(gi.isFauxFacade[sn]){const Zn=Math.min(65535,Math.floor(gi.uv[2*sn]*un.outerRingLength));ui.layoutFacadeDataArray.emplace(Ts+sn,1|Zn,gr,Er,Ir),ui.layoutFacadeVerticalRangeArray.emplace(Ts+sn,Ri,Xi)}else ui.layoutFacadeDataArray.emplace(Ts+sn,0,0,0,0),ui.layoutFacadeVerticalRangeArray.emplace(Ts+sn,0,0)}const _n=Lr.vertexLength,Pg=gi.indices.length/3,El=ui.indexArray.length;ui.indexArray.resize(El+Pg);for(let Zr=0;Zr<Pg;++Zr){const An=3*Zr,sn=3*El+An;ui.indexArray.uint16[sn]=_n+gi.indices[An],ui.indexArray.uint16[sn+1]=_n+gi.indices[An+1],ui.indexArray.uint16[sn+2]=_n+gi.indices[An+2]}gi.buildingPart!==1&&gi.buildingPart!==0&&gi.buildingPart!==2&&gi.buildingPart!==3||oo.push({part:gi.buildingPart,vertexOffset:Ts,vertexLength:gi.positions.length/3}),Ts+=nn,Lr.vertexLength+=nn,Lr.primitiveLength+=gi.indices.length/3}this.maxHeight=Math.max(this.maxHeight,bf);const h0=ui.indexArray.length-u0,Tl=this.footprintsIndices.length,ec=this.footprintsVertices.length,iu=[],Vo=new at(1/0,1/0),ga=new at(-1/0,-1/0),Lg=this.groundEffect.vertexArray.length;for(const gi of un.modifiedPolygonRings){const gn=[],Nr=new at(1/0,1/0),nn=new at(-1/0,-1/0);for(let $o=0;$o<gi.length;$o+=2){const Us=gi.length-$o-2;Nr.x=Math.min(Nr.x,gi[Us]),Nr.y=Math.min(Nr.y,gi[Us+1]),nn.x=Math.max(nn.x,gi[Us]),nn.y=Math.max(nn.y,gi[Us+1]);const ao=new at(gi[Us],gi[Us+1]);gn.push(ao),iu.push(ao.x,ao.y),this.footprintsVertices.emplaceBack(ao.x,ao.y)}Vo.x=Math.min(Vo.x,Nr.x),Vo.y=Math.min(Vo.y,Nr.y),ga.x=Math.max(ga.x,nn.x),ga.y=Math.max(ga.y,nn.y),this.groundEffect.addData(gn,[Nr,nn],Qe)}const wf=this.groundEffect.vertexArray.length-Lg;this.groundEffect.groundRadiusArray.reserveForAdditional(wf);for(let gi=0;gi<wf;gi++)this.groundEffect.groundRadiusArray.emplaceBack(et);(En.x<0||Nn.x>gt||En.y<0||Nn.y>gt)&&this.featuresOnBorder.push({featureId:U.id,footprintIndex:this.footprints.length});{const gi=ef(iu,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+gi.length),this.footprintsIndices.uint16.set(gi,Tl),this.buildingIds.add(oe??U.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,Vo.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,Vo.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,ga.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,ga.y);const gn={footprintVertexOffset:ec,footprintVertexLength:this.footprintsVertices.length-ec,footprintIndexOffset:Tl,footprintIndexLength:this.footprintsIndices.length-Tl,min:Vo,max:ga,hiddenFlags:0,indicesOffset:u0,indicesLength:h0,bloomIndicesOffset:In,bloomIndicesLength:fs,groundEffectVertexOffset:Lg,groundEffectVertexLength:wf,hasFauxFacade:Jt,height:bf,promoteId:H,feature:ge,parts:oo,buildingBloom:ds},Nr=this.footprints.length;U.id!==void 0&&this.featureFootprintLookup.set(U.id,Nr),M(oe,Nr),this.footprints.push(gn)}this.programConfigurations.populatePaintArrays(ui.layoutVertexArray.length,U,X,{},i.availableImages,a,i.brightness),this.groundEffect.addPaintPropertiesData(U,X,{},i.availableImages,a,i.brightness),i.featureIndex.insert(U,ye,X,Q,this.index,Sl)}I.forEach(({buildingId:U,footprintIndex:H})=>{C.has(U)&&(this.footprints[H].hiddenFlags|=4)});const $=new Set;this.buildingIds.forEach((U,H,X)=>{C.has(U)||$.add(U)}),this.buildingIds=$,this.groundEffect.prepareBorderSegments()}update(e,i,a,u,f,m,_){this.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_),this.groundEffect.update(e,i,f,a,u,m,_),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const i=a=>{a.layoutVertexBuffer=e.createVertexBuffer(a.layoutVertexArray,yI.members),a.layoutNormalBuffer=e.createVertexBuffer(a.layoutNormalArray,Lz.members),a.layoutCentroidBuffer=e.createVertexBuffer(a.layoutCentroidArray,Pz.members),a.layoutFloodLightDataBuffer=e.createVertexBuffer(a.layoutFloodLightDataArray,zz.members),a.layoutFacadeDataArray&&a.layoutFacadeDataArray.length&&(a.layoutFacadeDataBuffer=e.createVertexBuffer(a.layoutFacadeDataArray,Rz.members)),a.layoutFacadeVerticalRangeArray&&a.layoutFacadeVerticalRangeArray.length&&(a.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(a.layoutFacadeVerticalRangeArray,Dz.members)),a.entranceBloom.layoutVertexArray.length&&(a.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(a.entranceBloom.layoutVertexArray,yI.members),a.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(a.entranceBloom.layoutAttenuationArray,Oz.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=i=>{i.layoutVertexBuffer&&(i.layoutVertexBuffer.destroy(),i.layoutNormalBuffer.destroy(),i.layoutColorBuffer.destroy(),i.segmentsBucket.destroy(),i.indexBuffer&&i.indexBuffer.destroy(),i.entranceBloom.layoutVertexBuffer&&(i.entranceBloom.layoutVertexBuffer.destroy(),i.entranceBloom.layoutColorBuffer.destroy(),i.entranceBloom.layoutAttenuationBuffer.destroy(),i.entranceBloom.indexBuffer.destroy(),i.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,i,a=!0){let u=!1;const f=a?i:0,m=0|(a?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const _ of e){const b=this.footprints[_],S=b.hiddenFlags&m|f;b.hiddenFlags!==S&&(b.hiddenFlags=S,u=!0,this.groundEffect.updateHiddenByLandmarkRange(b.groundEffectVertexOffset,b.groundEffectVertexLength,b.hiddenFlags!==0))}return u&&(this.indexArrayForConflationUploaded=!1),u}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const i=u=>{u.indexArray.length!==0&&(u.indexArrayForConflation.resize(u.indexArray.length),u.indexArrayForConflation.uint16.set(u.indexArray.uint16),u.entranceBloom.indexArrayForConflation.resize(u.entranceBloom.indexArray.length),u.entranceBloom.indexArrayForConflation.uint16.set(u.entranceBloom.indexArray.uint16))};i(this.buildingWithoutFacade),i(this.buildingWithFacade);for(const u of this.footprints){const f=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,m=u.indicesOffset+u.indicesLength;if(u.hiddenFlags!==0){for(let b=u.indicesOffset;b<m;b++)f.indexArrayForConflation.uint16[3*b+0]=0,f.indexArrayForConflation.uint16[3*b+1]=0,f.indexArrayForConflation.uint16[3*b+2]=0;const _=u.bloomIndicesOffset+u.bloomIndicesLength;for(let b=u.bloomIndicesOffset;b<_;b++)f.entranceBloom.indexArrayForConflation.uint16[3*b+0]=0,f.entranceBloom.indexArrayForConflation.uint16[3*b+1]=0,f.entranceBloom.indexArrayForConflation.uint16[3*b+2]=0}}const a=u=>{u.indexArray.length!==0&&(u.indexBuffer?u.indexBuffer.updateData(u.indexArrayForConflation):u.indexBuffer=e.createIndexBuffer(u.indexArrayForConflation,!0),u.entranceBloom.indexBuffer?u.entranceBloom.indexBuffer.updateData(u.entranceBloom.indexArrayForConflation):u.entranceBloom.indexBuffer=e.createIndexBuffer(u.entranceBloom.indexArrayForConflation,!0))};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const i=a=>{a.layoutColorBuffer?a.layoutColorBuffer.updateData(a.layoutColorArray):a.layoutColorBuffer=e.createVertexBuffer(a.layoutColorArray,vI.members,!0),a.layoutFacadePaintArray&&(a.layoutFacadePaintBuffer?a.layoutFacadePaintBuffer.updateData(a.layoutFacadePaintArray):a.layoutFacadePaintBuffer=e.createVertexBuffer(a.layoutFacadePaintArray,Mz.members,!0)),a.entranceBloom.layoutColorBuffer?a.entranceBloom.layoutColorBuffer.updateData(a.entranceBloom.layoutColorArray):a.entranceBloom.layoutColorBuffer=e.createVertexBuffer(a.entranceBloom.layoutColorArray,vI.members,!0)};i(this.buildingWithoutFacade),i(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,i){const a=e.paint.get("building-ambient-occlusion-intensity");for(const u of this.footprints){if(4&u.hiddenFlags)continue;const f=i[u.promoteId],m=u.feature;m.properties["building-part"]="roof";const _=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),b=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="wall";const S=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),I=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="window";const C=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),k=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical);m.properties["building-part"]="door";const M=e.paint.get("building-color").evaluate(m,f,this.canonical).toPremultipliedRenderColor(this.lut),R=e.paint.get("building-emissive-strength").evaluate(m,f,this.canonical),F=u.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const U of u.parts){let H,X=_;U.part===1?(X=_,H=b):U.part===0?(X=S,H=I):U.part===2?(X=C,H=k):U.part===3&&(X=M,H=R),H=pe(H,0,1);for(let Q=0;Q<U.vertexLength;Q++){const ae=U.vertexOffset+Q,oe=1+(F.layoutAOArray.uint8[ae]/255-1)*a;F.layoutColorArray.emplace(ae,X.r*oe*255<<8|X.g*oe*255,X.b*oe*255<<8|255*H),u.hasFauxFacade&&F.layoutFacadePaintArray.emplace(ae,255*C.r<<8|255*C.g,255*C.b<<8|255*k)}}const $=u.buildingBloom;if($)for(let U=0;U<$.vertexLength;U++)F.entranceBloom.layoutColorArray.emplace($.vertexOffset+U,255*M.r<<8|255*M.g,255*M.b<<8|51*R)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,i,a){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(e.toUnwrapped());if(Iv(this.activeReplacements,u))return;this.activeReplacements=u;for(const m of this.footprints)m.hiddenFlags&=-2;const f=[];for(const m of this.activeReplacements){if(m.order<a)continue;const _=Math.max(1,Math.pow(2,m.footprintTileId.canonical.z-e.canonical.z));for(const b of this.footprints)b.min.x>m.max.x||b.max.x<m.min.x||b.min.y>m.max.y||b.max.y<m.min.y||(f.length=0,Nz(this.footprintsVertices,b.footprintVertexOffset,b.footprintVertexLength,m.footprintTileId.canonical,e.canonical,f),sb(m.footprint,f,this.footprintsIndices.uint16,b.footprintIndexOffset,b.footprintIndexLength,0,-_)&&(b.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const m of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(m.groundEffectVertexOffset,m.groundEffectVertexLength,m.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(e.id!==void 0){const i=this.featureFootprintLookup.get(e.id);return this.footprints[i]}return null}getHeightAtTileCoord(e,i){let a=Number.NEGATIVE_INFINITY,u=!0;const f=4*(e+gt)*gt+(i+gt);if(this.footprintLookup.hasOwnProperty(f)){const _=this.footprintLookup[f];return _?{height:_.height,hidden:_.hiddenFlags!==0}:void 0}const m=new at(e,i);for(const _ of this.footprints)e>_.max.x||_.min.x>e||i>_.max.y||_.min.y>i||_.height<=a||jz(m,this.footprintsVertices.float32.subarray(2*_.footprintVertexOffset,2*(_.footprintVertexOffset+_.footprintVertexLength)),this.footprintsIndices.uint16.subarray(_.footprintIndexOffset,_.footprintIndexOffset+_.footprintIndexLength))&&(a=_.height,this.footprintLookup[f]=_,u=_.hiddenFlags!==0);if(a!==Number.NEGATIVE_INFINITY)return{height:a,hidden:u};this.footprintLookup[f]=void 0}}function jz(s,e,i){for(let a=0;a<i.length;a+=3){const u=i[a],f=i[a+1],m=i[a+2],_=e[2*u+0],b=e[2*u+1],S=e[2*f+0],I=e[2*f+1],C=e[2*m+0],k=e[2*m+1],M=(_-C)*(s.y-k)-(b-k)*(s.x-C),R=(S-_)*(s.y-b)-(I-b)*(s.x-_);if(M<0!=R<0&&M!==0&&R!==0)continue;const F=(C-S)*(s.y-I)-(k-I)*(s.x-S);if(F===0||F<0==M+R<=0)return!0}return!1}function Nz(s,e,i,a,u,f){const m=Math.pow(2,a.z-u.z);for(let _=0;_<i;_++){let b=s.float32[2*(_+e)+0],S=s.float32[2*(_+e)+1];b=(b+u.x*gt)*m-a.x*gt,S=(S+u.y*gt)*m-a.y*gt,f.push(new at(b,S))}}let wI,SI;Ct(bI,"BuildingBucket",{omit:["layers"]}),Ct(Ib,"BuildingGeometry"),Ct(Eb,"BuildingBloomGeometry");const Uz=wi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Vz=wi([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:$z}=Uz,Gz=wi([{name:"a_packed",components:3,type:"Float32"}]),{members:Hz}=Gz,Wz=wi([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:qz}=Wz;class TI{constructor(e,i){this.width=e,this.height=i,this.nextRow=0,this.image=new Xc({width:e,height:i}),this.positions={},this.uploaded=!1}getDash(e,i){const a=this.getKey(e,i);return this.positions[a]}trim(){const e=this.width,i=this.height=st(this.nextRow);this.image.resize({width:e,height:i})}getKey(e,i){return e.join(",")+i}getDashRanges(e,i,a){const u=[];let f=e.length%2==1?-e[e.length-1]*a:0,m=e[0]*a,_=!0;u.push({left:f,right:m,isDash:_,zeroLength:e[0]===0});let b=e[0];for(let S=1;S<e.length;S++){_=!_;const I=e[S];f=b*a,b+=I,m=b*a,u.push({left:f,right:m,isDash:_,zeroLength:I===0})}return u}addRoundDash(e,i,a){const u=i/2;for(let f=-a;f<=a;f++){const m=this.width*(this.nextRow+a+f);let _=0,b=e[_];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++_]);const I=Math.abs(S-b.left),C=Math.abs(S-b.right),k=Math.min(I,C);let M;const R=f/a*(u+1);if(b.isDash){const F=u-Math.abs(R);M=Math.sqrt(k*k+F*F)}else M=u-Math.sqrt(k*k+R*R);this.image.data[m+S]=Math.max(0,Math.min(255,M+128))}}}addRegularDash(e,i){for(let b=e.length-1;b>=0;--b){const S=e[b],I=e[b+1];S.zeroLength?e.splice(b,1):I&&I.isDash===S.isDash&&(I.left=S.left,e.splice(b,1))}const a=e[0],u=e[e.length-1];a.isDash===u.isDash&&(a.left=u.left-this.width,u.right=a.right+this.width);const f=this.width*this.nextRow;let m=0,_=e[m];for(let b=0;b<this.width;b++){b/_.right>1&&(_=e[++m]);const S=Math.abs(b-_.left),I=Math.abs(b-_.right),C=Math.min(S,I);this.image.data[f+b]=Math.max(0,Math.min(255,(_.isDash?C:-C)+i+128))}}addDash(e,i){const a=this.getKey(e,i);if(this.positions[a])return this.positions[a];const u=i==="round",f=u?7:0,m=2*f+1;if(this.nextRow+m>this.height)return Kt("LineAtlas out of space"),null;e.length===0&&e.push(1);let _=0;for(let I=0;I<e.length;I++)e[I]<0&&(Kt("Negative value is found in line dasharray, replacing values with 0"),e[I]=0),_+=e[I];if(_!==0){const I=this.width/_,C=this.getDashRanges(e,this.width,I);u?this.addRoundDash(C,I,f):this.addRegularDash(C,i==="square"?.5*I:0)}const b=this.nextRow+f;this.nextRow+=m;const S={tl:[b,f],br:[_,0]};return this.positions[a]=S,S}}Ct(TI,"LineAtlas");const Zz=Ti.types,Xz=Math.cos(Math.PI/180*37.5),Kz=Math.cos(Math.PI/180*5);class Ab{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Rm,this.layoutVertexArray2=new wo,this.patternVertexArray=new wo,this.indexArray=new en,this.programConfigurations=new P(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new xr,this.maxLineLength=0,this.zOffsetVertexArray=new wo,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:128,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,u){}populate(e,i,a,u){this.hasPattern=W1("line",this.layers,this.pixelRatio,i);const f=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ht(a);const m=this.layers[0].layout.get("line-elevation-reference");if(m==="hd-road-markup")this.elevationType="road";else{const k=this.layers[0].layout.get("line-z-offset"),M=k.isConstant()&&!k.constantOr(0);this.elevationType=m!=="sea"&&m!=="ground"&&M?"none":"offset",this.elevationType==="offset"&&m==="none"&&Kt(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const _=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&_!==void 0;const b=[];for(const{feature:k,id:M,index:R,sourceLayerIndex:F}of e){const $=this.layers[0]._featureFilter.needGeometry,U=ci(k,$);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),U,a))continue;const H=f?f.evaluate(U,{},a):void 0,X={id:M,properties:k.properties,type:k.type,sourceLayerIndex:F,index:R,geometry:$?U.geometry:Xt(k,a,u),patterns:{},sortKey:H};b.push(X)}f&&b.sort((k,M)=>k.sortKey-M.sortKey);const{lineAtlas:S,featureIndex:I}=i,C=this.addConstantDashes(S);for(const k of b){const{geometry:M,index:R,sourceLayerIndex:F}=k;if(C&&this.addFeatureDashes(k,S),this.hasPattern){const $=q1("line",this.layers,k,this.zoom,this.pixelRatio,i);this.patternFeatures.push($)}else this.addFeature(k,M,R,a,S.positions,i.availableImages,i.brightness,i.elevationFeatures);I.insert(e[R].feature,M,R,F,this.index)}}addConstantDashes(e){let i=!1;for(const a of this.layers){const u=a.paint.get("line-dasharray").value,f=a.layout.get("line-cap").value;if(u.kind!=="constant"||f.kind!=="constant")i=!0;else{const m=f.value,_=u.value;if(!_)continue;e.addDash(_,m)}}return i}addFeatureDashes(e,i){const a=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,m=u.layout.get("line-cap").value;if(f.kind==="constant"&&m.kind==="constant")continue;let _,b;if(f.kind==="constant"){if(_=f.value,!_)continue}else _=f.evaluate({zoom:a},e);b=m.kind==="constant"?m.value:m.evaluate({zoom:a},e),i.addDash(_,b),e.patterns[u.id]=[i.getKey(_,b)]}}update(e,i,a,u,f,m,_,b){this.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,b)}addFeatures(e,i,a,u,f,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,i,a,u,m,e.elevationFeatures)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Hz)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,qz)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Vz.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,$z),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,i){let a,u;if(i&&i>0?(a=`mapbox_clip_start_${i}`,u=`mapbox_clip_end_${i}`):(a="mapbox_clip_start",u="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(a)&&e.properties.hasOwnProperty(u))return{start:+e.properties[a],end:+e.properties[u]}}addFeature(e,i,a,u,f,m,_,b){const S=this.layers[0].layout,I=S.get("line-join").evaluate(e,{}),C=S.get("line-cap").evaluate(e,{}),k=S.get("line-miter-limit"),M=S.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const R=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=S.get("line-z-offset").value;const F=this.layers[0].paint.get("line-width").value;if(F.kind!=="constant"&&F.isLineProgressConstant===!1&&(this.variableWidthValue=F),this.elevationType==="road"){const $=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,i,u,b,I,C,k,M)){const[U,H]=this.clipRuntimeLinesToTile(i,1);for(let X=0;X<U.length;X++){const Q=U[X],ae=H[X],oe={progress:{min:ae.progress.min,max:ae.progress.max},nextDir:this.computeSegNextDir(ae,Q),prevDir:this.computeSegPrevDir(ae,Q)};this.addLine(Q,e,u,I,C,k,M,oe,R&&ae.parentIndex>0?ae.parentIndex:null)}this.fillNonElevatedRoadSegment($)}}else for(let $=0;$<i.length;$++)this.addLine(i[$],e,u,I,C,k,M,void 0,R&&$>0?$:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,a,f,m,u,_,void 0,this.worldview)}computeSegNextDir(e,i){return e.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(e,i){return i[1].sub(e.prevPoint).unit()}clipLinesToTile(e,i){return kv(e,-i,-i,gt+i,gt+i)}clipRuntimeLinesToTile(e,i){const a=[];return[kv(e,-i,-i,gt+i,gt+i,a),a]}addElevatedRoadFeature(e,i,a,u,f,m,_,b){const S=[],I=cs.getElevationFeature(e,u);if(I){const C=this.clipLinesToTile(i,1),k=this.prepareElevatedLines(C,I,a);for(const M of k)S.push({geometry:M,elevation:I,elevationTileID:a,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(S.length===0)return!1;for(const C of S){const k=this.layoutVertexArray.length;this.addLine(C.geometry,e,a,f,m,_,b);const M=new So(a,C.elevationTileID);if(C.elevation)for(let R=k;R<this.layoutVertexArray.length;R++){const F=new at(this.layoutVertexArray.int16[6*R]>>1,this.layoutVertexArray.int16[6*R+1]>>1),$=M.pointElevation(F,C.elevation,.05);this.updateHeightRange($),this.zOffsetVertexArray.emplaceBack($,0,0)}else this.fillNonElevatedRoadSegment(k)}return!0}prepareElevatedLines(e,i,a){if(i.constantHeight!=null)return e;const u=[],f=1/ht(a);for(const m of e)nz(m,new Bs(i,f),0,u);return u}fillNonElevatedRoadSegment(e){for(let i=e;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,i,a,u,f,m,_,b,S){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=S?this.lineFeatureClips(i,S):this.lineClips;const I=u==="none";this.patternJoinNone=this.hasPattern&&I,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const C=b&&b.progress.min>0,k=b&&b.progress.max<1;if(this.lineClips){let me={min:this.lineClips.start,max:this.lineClips.end},Se=1;if(b){const Ge=this.lineClips.end-this.lineClips.start;me=function(qe,et,Je){return{min:wn(qe.min,et,Je),max:wn(qe.max,et,Je)}}(b.progress,{min:0,max:1},me),Ge>0&&(Se=(me.max-me.min)/Ge)}const Ae=+i.properties.mapbox_clip_feature_len,Ze=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Ae)||Number.isNaN(Ze)){for(let qe=0;qe<e.length-1;qe++)this.totalDistance+=e[qe].dist(e[qe+1]);const Ge=this.totalDistance/(me.max-me.min);this.totalFeatureLength=Number.isFinite(Ge)?Ge:0,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ae,this.distance=Ze*Se,this.lineClips.start=me.min,this.lineClips.end=me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const M=Zz[i.type]==="Polygon";let R=e.length;for(;R>=2&&e[R-1].equals(e[R-2]);)R--;let F=0;for(;F<R-1&&e[F].equals(e[F+1]);)F++;if(R<(M?3:2))return;u==="bevel"&&(m=1.05);const $=this.segments.prepareSegment(10*R,this.layoutVertexArray,this.indexArray);let U,H,X,Q,ae,oe,ge,ye;b&&b.prevDir&&(oe=b.prevDir.perp()),b&&b.nextDir&&(ge=b.nextDir.perp()),this.e1=this.e2=-1,M&&(U=e[R-2],ae=e[F].sub(U)._unit()._perp());for(let me=F;me<R;me++){if(X=me===R-1?M?e[F+1]:void 0:e[me+1],X&&e[me].equals(X))continue;ae&&(Q=ae),U&&(H=U),U=e[me],ye=this.evaluateLineProgressFeatures(H?H.dist(U):0),ae=X?X.sub(U)._unit()._perp():Q,Q=Q||ae;const Se=H&&X;let Ae=Se?u:M||I?"butt":f;const Ze=Q.x*ae.x+Q.y*ae.y;if(I){const Ke=function(rt){if(rt.patternJoinNone){const tt=rt.segmentPoints.length/2,St=rt.lineSoFar-rt.segmentStart;for(let Et=0;Et<tt;++Et){const mt=rt.segmentPoints[2*Et+1],_t=Math.round(rt.segmentPoints[2*Et])+.5+.25*mt;rt.patternVertexArray.emplaceBack(_t,St,rt.segmentStart),rt.patternVertexArray.emplaceBack(_t,St,rt.segmentStart)}rt.segmentPoints.length=0}rt.e1=rt.e2=-1};if(Se&&Ze<Kz){this.updateDistance(H,U),this.addCurrentVertex(U,Q,1,1,$,ye),Ke(this),this.addCurrentVertex(U,ae,-1,-1,$,ye);continue}if(H){if(!X){this.updateDistance(H,U),this.addCurrentVertex(U,Q,1,1,$,ye),Ke(this);continue}Ae="miter"}}let Ge=Q.add(ae);Ge.x===0&&Ge.y===0||Ge._unit();const qe=Ge.x*ae.x+Ge.y*ae.y,et=qe!==0?1/qe:1/0,Je=2*Math.sqrt(2-2*qe),Qe=qe<Xz&&H&&X,Ne=Q.x*ae.y-Q.y*ae.x>0,it=this.overscaling<=16?122880/(512*this.overscaling):0;if(Se&&Ae==="round"){if(et<_)Ae="miter";else if(et<=2){const Ke=Cb(U,-10,8202);Ae=this.elevationType==="offset"&&(Ke||this.hasCrossSlope)?"miter":"fakeround"}}if(Ae==="miter"&&et>m&&(Ae="bevel"),Ae==="bevel"&&(et>2&&(Ae="flipbevel"),et<m&&(Ae="miter")),H&&!(Ae==="miter"&&Qe)&&this.updateDistance(H,U),Ae==="miter")if(Qe){const Ke=U.dist(H);if(Ke>2*it){const tt=U.sub(U.sub(H)._mult(it/Ke)._round());this.updateDistance(H,tt),this.addCurrentVertex(tt,Q,0,0,$,ye),H=tt}this.updateDistance(H,U),Ge._mult(et),this.addCurrentVertex(U,Ge,0,0,$,ye);const rt=U.dist(X);if(rt>2*it){const tt=U.add(X.sub(U)._mult(it/rt)._round());this.updateDistance(U,tt),this.addCurrentVertex(tt,ae,0,0,$,ye),U=tt}}else Ge._mult(et),this.addCurrentVertex(U,Ge,0,0,$,ye);else if(Ae==="flipbevel"){if(et>100)Ge=ae.mult(-1);else{const Ke=et*Q.add(ae).mag()/Q.sub(ae).mag();Ge._perp()._mult(Ke*(Ne?-1:1))}this.addCurrentVertex(U,Ge,0,0,$,ye),this.addCurrentVertex(U,Ge.mult(-1),0,0,$,ye)}else if(Ae==="bevel"||Ae==="fakeround"){ye!=null&&H&&this.addCurrentVertex(U,ge||Q,-1,-1,$,ye);const Ke=U.dist(H)<=2*it&&Ae!=="bevel",rt=Ge.mult(Ne?1:-1);rt._mult(et);const tt=ae.mult(Ne?-1:1),St=Q.mult(Ne?-1:1),Et=this.evaluateLineProgressFeatures(this.distance);if(ye==null&&(this.addHalfVertex(U,rt.x,rt.y,!1,!Ne,0,$,Et),Ke||this.addHalfVertex(U,rt.x+2*St.x,rt.y+2*St.y,!1,Ne,0,$,Et)),Ae==="fakeround"){const mt=Math.round(180*Je/Math.PI/20);this.addHalfVertex(U,St.x,St.y,!1,Ne,0,$,Et);for(let _t=0;_t<mt;_t++){let Vt=_t/mt;if(Vt!==.5){const xt=Vt-.5;Vt+=Vt*xt*(Vt-1)*((1.0904+Ze*(Ze*(3.55645-1.43519*Ze)-3.2452))*xt*xt+(.848013+Ze*(.215638*Ze-1.06021)))}const Rt=tt.sub(St)._mult(Vt)._add(St)._unit();this.addHalfVertex(U,Rt.x,Rt.y,!1,Ne,0,$,Et)}this.addHalfVertex(U,tt.x,tt.y,!1,Ne,0,$,Et)}Ke||ye!=null||this.addHalfVertex(U,rt.x+2*tt.x,rt.y+2*tt.y,!1,Ne,0,$,Et),ye!=null&&X&&this.addCurrentVertex(U,oe||ae,1,1,$,ye)}else if(Ae==="butt")this.addCurrentVertex(U,Ge,0,0,$,ye);else if(Ae==="square"){if(!H){const Ke=C?0:-1;this.addCurrentVertex(U,Ge,Ke,Ke,$,ye)}if(this.addCurrentVertex(U,Ge,0,0,$,ye),H){const Ke=k?0:1;this.addCurrentVertex(U,Ge,Ke,Ke,$,ye)}}else if(Ae==="round"){if(H){const Ke=!Se&&ge?ge:Q;this.addCurrentVertex(U,Ke,0,0,$,ye),!Se&&k||this.addCurrentVertex(U,Ke,1,1,$,ye,!0)}if(X){const Ke=!Se&&oe?oe:ae;!Se&&C||this.addCurrentVertex(U,Ke,-1,-1,$,ye,!0),this.addCurrentVertex(U,Ke,0,0,$,ye)}}}}addVerticesTo(e,i,a,u,f,m,_,b,S,I){const C=(i.w-e.w)/this.tessellationStep|0;let k=0;const M=this.scaledDistance;if(C>1){this.lineSoFar=e.w;const F=(i.x-e.x)/C,$=(i.y-e.y)/C,U=(i.z-e.z)/C,H=(i.w-e.w)/C;for(let X=1;X<C;++X){e.x+=F,e.y+=$,e.z+=U,this.lineSoFar+=H,k+=H;const Q=this.evaluateLineProgressFeatures(this.prevDistance+k);this.scaledDistance=(this.prevDistance+k)/this.totalDistance,this.addHalfVertex(e,a,u,I,!1,_,S,Q),this.addHalfVertex(e,f,m,I,!0,-b,S,Q)}}this.lineSoFar=i.w,this.scaledDistance=M;const R=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,a,u,I,!1,_,S,R),this.addHalfVertex(i,f,m,I,!0,-b,S,R)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Kt(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(e,i,a,u,f,m,_=!1){const b=i.x+i.y*a,S=i.y-i.x*a,I=i.y*u-i.x,C=-i.y-i.x*u;if(m!=null){const k=this.elevationType==="offset",M=-10,R=8202,F=m.zOffset,$=new NE(e.x,e.y,F,this.lineSoFar),U=!!k&&Cb(e,M,R),H=this.lineSoFar,X=this.distance;if(this.currentVertex)if(U){const Q=this.currentVertexIsOutside,ae=this.currentVertex,oe=new NE(e.x,e.y,F,this.lineSoFar);if(VE(ae,oe,M,R),!Cb(oe,M,R)){if(Q){this.e1=this.e2=-1,this.distance-=ae.dist($),this.lineSoFar=ae.w;const ge=this.evaluateLineProgressFeatures(ae.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(ae,b,S,_,!1,a,f,ge),this.addHalfVertex(ae,I,C,_,!0,-u,f,ge),this.prevDistance=this.distance}this.distance=this.prevDistance+ae.dist(oe),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(ae,oe,b,S,I,C,a,u,f,_),this.distance=X,this.scaledDistance=this.distance/this.totalDistance}}else{const Q=this.currentVertex;if(this.currentVertexIsOutside){VE(Q,$,M,R),this.e1=this.e2=-1,this.distance-=Q.dist($),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=Q.w;const ae=this.evaluateLineProgressFeatures(Q.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Q,b,S,_,!1,a,f,ae),this.addHalfVertex(Q,I,C,_,!0,-u,f,ae),this.prevDistance=this.distance,this.distance=X,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(Q,$,b,S,I,C,a,u,f,_)}else U||(this.addHalfVertex(e,b,S,_,!1,a,f,m),this.addHalfVertex(e,I,C,_,!0,-u,f,m));this.currentVertex=$,this.currentVertexIsOutside=U,this.lineSoFar=H}else this.addHalfVertex(e,b,S,_,!1,a,f,m),this.addHalfVertex(e,I,C,_,!0,-u,f,m)}addHalfVertex({x:e,y:i},a,u,f,m,_,b,S){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),m||this.segmentPoints.push(this.lineSoFar-this.segmentStart,_)),this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(i<<1)+(m?1:0),Math.round(63*a)+128,Math.round(63*u)+128,1+(_===0?0:_<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const C=qt(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,C)}const I=b.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,I),b.primitiveLength++),m?this.e2=I:this.e1=I,S!=null&&this.zOffsetVertexArray.emplaceBack(S.zOffset,S.variableWidth,S.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,i){this.prevDistance=this.distance,this.distance+=e.dist(i),this.updateScaledDistance()}}function Cb(s,e,i){return s.x<e||s.x>i||s.y<e||s.y>i}let EI,II;function AI(s,e,i){return e*(gt/(s.tileSize*Math.pow(2,i-s.tileID.overscaledZ)))}Ct(Ab,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const CI=(s,e,i)=>(1-i)*s+i*e;function kI(s,e){return 1/AI(s,1,e.tileZoom)}function LI(s,e,i,a){return s.translatePosMatrix(a||e.tileID.projMatrix,e,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const PI=s=>{const e=[];MI(s)&&e.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const i=s.paint.get("line-trim-offset");i[0]===0&&i[1]===0||e.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&e.push("RENDER_LINE_BORDER");const a=s.layout.get("line-join").constantOr("miter")==="none",u=!!s.paint.get("line-pattern").constantOr(1);return a&&u&&e.push("LINE_JOIN_NONE"),e};function MI(s){const e=s.paint.get("line-dasharray").value;return e.kind!=="constant"||e.value}let kb;const RI=()=>kb||(kb={layout:EI||(EI=new Cr({"line-cap":new vt(ze.layout_line["line-cap"]),"line-join":new vt(ze.layout_line["line-join"]),"line-miter-limit":new ft(ze.layout_line["line-miter-limit"]),"line-round-limit":new ft(ze.layout_line["line-round-limit"]),"line-sort-key":new vt(ze.layout_line["line-sort-key"]),"line-z-offset":new vt(ze.layout_line["line-z-offset"]),"line-elevation-reference":new ft(ze.layout_line["line-elevation-reference"]),"line-cross-slope":new ft(ze.layout_line["line-cross-slope"]),visibility:new ft(ze.layout_line.visibility),"line-width-unit":new ft(ze.layout_line["line-width-unit"])})),paint:II||(II=new Cr({"line-opacity":new vt(ze.paint_line["line-opacity"]),"line-color":new vt(ze.paint_line["line-color"]),"line-translate":new ft(ze.paint_line["line-translate"]),"line-translate-anchor":new ft(ze.paint_line["line-translate-anchor"]),"line-width":new vt(ze.paint_line["line-width"]),"line-gap-width":new vt(ze.paint_line["line-gap-width"]),"line-offset":new vt(ze.paint_line["line-offset"]),"line-blur":new vt(ze.paint_line["line-blur"]),"line-dasharray":new vt(ze.paint_line["line-dasharray"]),"line-pattern":new vt(ze.paint_line["line-pattern"]),"line-pattern-cross-fade":new ft(ze.paint_line["line-pattern-cross-fade"]),"line-gradient":new jc(ze.paint_line["line-gradient"]),"line-trim-offset":new ft(ze.paint_line["line-trim-offset"]),"line-trim-fade-range":new ft(ze.paint_line["line-trim-fade-range"]),"line-trim-color":new ft(ze.paint_line["line-trim-color"]),"line-emissive-strength":new vt(ze.paint_line["line-emissive-strength"]),"line-border-width":new vt(ze.paint_line["line-border-width"]),"line-border-color":new vt(ze.paint_line["line-border-color"]),"line-occlusion-opacity":new ft(ze.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},kb);class Yz extends vt{possiblyEvaluate(e,i){return i=new Yi(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(e,i)}evaluate(e,i,a,u){return i=Object.assign({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(e,i,a,u)}}let cg;function DI(s,e){return e>0?e+2*s:s}const Jz=wi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Qz=wi([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),e3=wi([{name:"a_projected_pos",components:4,type:"Float32"}],4);wi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const t3=wi([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),i3=wi([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),r3=wi([{name:"a_texb",components:2,type:"Uint16"}]),n3=wi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),s3=wi([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);wi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const OI=wi([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),o3=wi([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);wi([{name:"triangle",components:3,type:"Uint16"}]),wi([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),wi([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),wi([{type:"Float32",name:"offsetX"}]),wi([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var mn=24;function a3(s,e,i){return s.sections.forEach(a=>{a.text=function(u,f,m){const _=f.layout.get("text-transform").evaluate(m,{});return _==="uppercase"?u=u.toLocaleUpperCase():_==="lowercase"&&(u=u.toLocaleLowerCase()),jo.applyArabicShaping&&(u=jo.applyArabicShaping(u)),u}(a.text,e,i)}),s}const ug={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function l3(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}function c3(s){return s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""||s===""}const Lb=4294967296,zI=1/Lb,BI=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let Nv=class{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,e,i=this.length){for(;this.pos<i;){const a=this.readVarint(),u=a>>3,f=this.pos;this.type=7&a,s(u,e,this),this.pos===f&&this.skip(a)}return e}readMessage(s,e){return this.readFields(s,e,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Lb;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Lb;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const e=this.buf;let i,a;return a=e[this.pos++],i=127&a,a<128?i:(a=e[this.pos++],i|=(127&a)<<7,a<128?i:(a=e[this.pos++],i|=(127&a)<<14,a<128?i:(a=e[this.pos++],i|=(127&a)<<21,a<128?i:(a=e[this.pos],i|=(15&a)<<28,function(u,f,m){const _=m.buf;let b,S;if(S=_[m.pos++],b=(112&S)>>4,S<128||(S=_[m.pos++],b|=(127&S)<<3,S<128)||(S=_[m.pos++],b|=(127&S)<<10,S<128)||(S=_[m.pos++],b|=(127&S)<<17,S<128)||(S=_[m.pos++],b|=(127&S)<<24,S<128)||(S=_[m.pos++],b|=(1&S)<<31,S<128))return uf(u,b,f);throw new Error("Expected varint not more than 10 bytes")}(i,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,e=this.pos;return this.pos=s,s-e>=12&&BI?BI.decode(this.buf.subarray(e,s)):function(i,a,u){let f="",m=a;for(;m<u;){const _=i[m];let b,S,I,C=null,k=_>239?4:_>223?3:_>191?2:1;if(m+k>u)break;k===1?_<128&&(C=_):k===2?(b=i[m+1],(192&b)==128&&(C=(31&_)<<6|63&b,C<=127&&(C=null))):k===3?(b=i[m+1],S=i[m+2],(192&b)==128&&(192&S)==128&&(C=(15&_)<<12|(63&b)<<6|63&S,(C<=2047||C>=55296&&C<=57343)&&(C=null))):k===4&&(b=i[m+1],S=i[m+2],I=i[m+3],(192&b)==128&&(192&S)==128&&(192&I)==128&&(C=(15&_)<<18|(63&b)<<12|(63&S)<<6|63&I,(C<=65535||C>=1114112)&&(C=null))),C===null?(C=65533,k=1):C>65535&&(C-=65536,f+=String.fromCharCode(C>>>10&1023|55296),C=56320|1023&C),f+=String.fromCharCode(C),m+=k}return f}(this.buf,e,s)}readBytes(){const s=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,s);return this.pos=s,e}readPackedVarint(s=[],e){const i=this.readPackedEnd();for(;this.pos<i;)s.push(this.readVarint(e));return s}readPackedSVarint(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const e=this.readPackedEnd();for(;this.pos<e;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const e=7&s;if(e===0)for(;this.buf[this.pos++]>127;);else if(e===2)this.pos=this.readVarint()+this.pos;else if(e===5)this.pos+=4;else{if(e!==1)throw new Error(`Unimplemented type: ${e}`);this.pos+=8}}writeTag(s,e){this.writeVarint(s<<3|e)}realloc(s){let e=this.length||16;for(;e<this.pos+s;)e*=2;if(e!==this.length){const i=new Uint8Array(e);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=e}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*zI),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*zI),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?function(e,i){let a,u;if(e>=0?(a=e%4294967296|0,u=e/4294967296|0):(a=~(-e%4294967296),u=~(-e/4294967296),4294967295^a?a=a+1|0:(a=0,u=u+1|0)),e>=18446744073709552e3||e<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(f,m,_){_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,f>>>=7,_.buf[_.pos++]=127&f|128,_.buf[_.pos]=127&(f>>>=7)}(a,0,i),function(f,m){const _=(7&f)<<4;m.buf[m.pos++]|=_|((f>>>=3)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f|((f>>>=7)?128:0),f&&(m.buf[m.pos++]=127&f)))))}(u,i)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const e=this.pos;this.pos=function(a,u,f){for(let m,_,b=0;b<u.length;b++){if(m=u.charCodeAt(b),m>55295&&m<57344){if(!_){m>56319||b+1===u.length?(a[f++]=239,a[f++]=191,a[f++]=189):_=m;continue}if(m<56320){a[f++]=239,a[f++]=191,a[f++]=189,_=m;continue}m=_-55296<<10|m-56320|65536,_=null}else _&&(a[f++]=239,a[f++]=191,a[f++]=189,_=null);m<128?a[f++]=m:(m<2048?a[f++]=m>>6|192:(m<65536?a[f++]=m>>12|224:(a[f++]=m>>18|240,a[f++]=m>>12&63|128),a[f++]=m>>6&63|128),a[f++]=63&m|128)}return f}(this.buf,s,this.pos);const i=this.pos-e;i>=128&&FI(e,i,this),this.pos=e-1,this.writeVarint(i),this.pos+=i}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const e=s.length;this.writeVarint(e),this.realloc(e);for(let i=0;i<e;i++)this.buf[this.pos++]=s[i]}writeRawMessage(s,e){this.pos++;const i=this.pos;s(e,this);const a=this.pos-i;a>=128&&FI(i,a,this),this.pos=i-1,this.writeVarint(a),this.pos+=a}writeMessage(s,e,i){this.writeTag(s,2),this.writeRawMessage(e,i)}writePackedVarint(s,e){e.length&&this.writeMessage(s,u3,e)}writePackedSVarint(s,e){e.length&&this.writeMessage(s,h3,e)}writePackedBoolean(s,e){e.length&&this.writeMessage(s,p3,e)}writePackedFloat(s,e){e.length&&this.writeMessage(s,d3,e)}writePackedDouble(s,e){e.length&&this.writeMessage(s,f3,e)}writePackedFixed32(s,e){e.length&&this.writeMessage(s,m3,e)}writePackedSFixed32(s,e){e.length&&this.writeMessage(s,g3,e)}writePackedFixed64(s,e){e.length&&this.writeMessage(s,_3,e)}writePackedSFixed64(s,e){e.length&&this.writeMessage(s,y3,e)}writeBytesField(s,e){this.writeTag(s,2),this.writeBytes(e)}writeFixed32Field(s,e){this.writeTag(s,5),this.writeFixed32(e)}writeSFixed32Field(s,e){this.writeTag(s,5),this.writeSFixed32(e)}writeFixed64Field(s,e){this.writeTag(s,1),this.writeFixed64(e)}writeSFixed64Field(s,e){this.writeTag(s,1),this.writeSFixed64(e)}writeVarintField(s,e){this.writeTag(s,0),this.writeVarint(e)}writeSVarintField(s,e){this.writeTag(s,0),this.writeSVarint(e)}writeStringField(s,e){this.writeTag(s,2),this.writeString(e)}writeFloatField(s,e){this.writeTag(s,5),this.writeFloat(e)}writeDoubleField(s,e){this.writeTag(s,1),this.writeDouble(e)}writeBooleanField(s,e){this.writeVarintField(s,+e)}};function uf(s,e,i){return i?4294967296*e+(s>>>0):4294967296*(e>>>0)+(s>>>0)}function FI(s,e,i){const a=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));i.realloc(a);for(let u=i.pos-1;u>=s;u--)i.buf[u+a]=i.buf[u]}function u3(s,e){for(let i=0;i<s.length;i++)e.writeVarint(s[i])}function h3(s,e){for(let i=0;i<s.length;i++)e.writeSVarint(s[i])}function d3(s,e){for(let i=0;i<s.length;i++)e.writeFloat(s[i])}function f3(s,e){for(let i=0;i<s.length;i++)e.writeDouble(s[i])}function p3(s,e){for(let i=0;i<s.length;i++)e.writeBoolean(s[i])}function m3(s,e){for(let i=0;i<s.length;i++)e.writeFixed32(s[i])}function g3(s,e){for(let i=0;i<s.length;i++)e.writeSFixed32(s[i])}function _3(s,e){for(let i=0;i<s.length;i++)e.writeFixed64(s[i])}function y3(s,e){for(let i=0;i<s.length;i++)e.writeSFixed64(s[i])}function v3(s,e,i){e.glyphs=[],s===1&&i.readMessage(x3,e)}function x3(s,e,i){if(s===3){const{id:a,bitmap:u,width:f,height:m,left:_,top:b,advance:S}=i.readMessage(b3,{});e.glyphs.push({id:a,bitmap:new Xc({width:f+6,height:m+6},u),metrics:{width:f,height:m,left:_,top:b,advance:S}})}else s===4?e.ascender=i.readSVarint():s===5&&(e.descender=i.readSVarint())}function b3(s,e,i){s===1?e.id=i.readVarint():s===2?e.bitmap=i.readBytes():s===3?e.width=i.readVarint():s===4?e.height=i.readVarint():s===5?e.left=i.readSVarint():s===6?e.top=i.readSVarint():s===7&&(e.advance=i.readVarint())}const so={horizontal:1,vertical:2,horizontalOnly:3};class hg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,i){const a=new hg;return a.scale=e||1,a.fontStack=i,a}static forImage(e){const i=new hg;return i.image=e,i}}class hf{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,i,a){const u=new hf;for(let f=0;f<e.sections.length;f++){const m=e.sections[f];m.image?u.addImageSection(m,a):u.addTextSection(m,i)}return u}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(i,a){let u="";for(let f=0;f<i.length;f++){const m=i.charCodeAt(f+1)||null,_=i.charCodeAt(f-1)||null;u+=!a&&(m&&ym(m)&&!ug[i[f+1]]||_&&ym(_)&&!ug[i[f-1]])||!ug[i[f]]?i[f]:ug[i[f]]}return u}(this.text,e)}trim(){let e=0;for(let a=0;a<this.text.length&&Uv[this.text.charCodeAt(a)];a++)e++;let i=this.text.length;for(let a=this.text.length-1;a>=0&&a>=e&&Uv[this.text.charCodeAt(a)];a--)i--;this.text=this.text.substring(e,i),this.sectionIndex=this.sectionIndex.slice(e,i)}substring(e,i){const a=new hf;return a.text=this.text.substring(e,i),a.sectionIndex=this.sectionIndex.slice(e,i),a.sections=this.sections,a}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,i)=>Math.max(e,this.sections[i].scale),0)}addTextSection(e,i){this.text+=e.text,this.sections.push(hg.forText(e.scale,e.fontStack||i));const a=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(a)}addImageSection(e,i){const a=e.image?e.image.getPrimary():null;if(!a)return void Kt("Can't add FormattedSection with an empty image.");a.scaleSelf(i);const u=this.getNextImageSectionCharCode();u?(this.text+=String.fromCodePoint(u),this.sections.push(hg.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Kt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Pb(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F=1){const $=hf.fromFeature(s,u,F);C===so.vertical&&$.verticalizePunctuation(k);let U=[];const H=function(ge,ye,me,Se,Ae,Ze){if(!ge)return[];const Ge=[],qe=function(Qe,Ne,it,Ke,rt,tt){let St=0;for(let Et=0;Et<Qe.length();Et++){const mt=Qe.getSection(Et);St+=jI(Qe.getCodePoint(Et),mt,Ke,rt,Ne,tt)}return St/Math.max(1,Math.ceil(St/it))}(ge,ye,me,Se,Ae,Ze),et=ge.text.indexOf("")>=0;let Je=0;for(let Qe=0;Qe<ge.length();Qe++){const Ne=ge.getSection(Qe),it=ge.getCodePoint(Qe);if(Uv[it]||(Je+=jI(it,Ne,Se,Ae,ye,Ze)),Qe<ge.length()-1){const Ke=zy(it);(w3[it]||Ke||Ne.image)&&Ge.push(UI(Qe+1,Je,qe,Ge,S3(it,ge.getCodePoint(Qe+1),Ke&&et),!1))}}return VI(UI(ge.length(),Je,qe,Ge,0,!0))}($,S,f,e,a,M),{processBidirectionalText:X,processStyledBidirectionalText:Q}=jo;if(X&&$.sections.length===1){const ge=X($.toString(),H);for(const ye of ge){const me=new hf;me.text=ye,me.sections=$.sections;for(let Se=0;Se<ye.length;Se++)me.sectionIndex.push(0);U.push(me)}}else if(Q){const ge=Q($.text,$.sectionIndex,H);for(const ye of ge){const me=new hf;me.text=ye[0],me.sectionIndex=ye[1],me.sections=$.sections,U.push(me)}}else U=function(ge,ye){const me=[],Se=ge.text;let Ae=0;for(const Ze of ye)me.push(ge.substring(Ae,Ze)),Ae=Ze;return Ae<Se.length&&me.push(ge.substring(Ae,Se.length)),me}($,H);const ae=[],oe={positionedLines:ae,text:$.toString(),top:I[1],bottom:I[1],left:I[0],right:I[0],writingMode:C,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(ge,ye,me,Se,Ae,Ze,Ge,qe,et,Je,Qe,Ne){let it=0,Ke=0,rt=0;const tt=qe==="right"?1:qe==="left"?0:.5;let St=!1;for(const Rt of Ae){const xt=Rt.getSections();for(const Jt of xt){if(Jt.image)continue;const yi=ye[Jt.fontStack];if(yi&&(St=yi.ascender!==void 0&&yi.descender!==void 0,!St))break}if(!St)break}let Et=0;for(const Rt of Ae){Rt.trim();const xt=Rt.getMaxScale(),Jt=(xt-1)*mn,yi={positionedGlyphs:[],lineOffset:0};ge.positionedLines[Et]=yi;const Bi=yi.positionedGlyphs;let mi=0;if(!Rt.length()){Ke+=Ze,++Et;continue}let Ji=0,ki=0;for(let Ri=0;Ri<Rt.length();Ri++){const Xi=Rt.getSection(Ri),gr=Rt.getSectionIndex(Ri),Er=Rt.getCodePoint(Ri);let Ir=Xi.scale,jr=null,En=null,Nn=null,qr=mn,rn=0,un=et;un===so.vertical&&By(Er)&&(un=so.horizontal);const ui=!(un===so.horizontal||!Qe&&!fl(Er)||Qe&&(Uv[Er]||Vd(Er)));if(Xi.image){const Ar=Se.get(Xi.image.toString());if(!Ar)continue;Nn=Xi.image,ge.iconsInText=ge.iconsInText||!0,En=Ar.paddedRect;const Lr=Ar.displaySize;Ir=Ir*mn/Ne,jr={width:Lr[0],height:Lr[1],left:0,top:-3,advance:ui?Lr[1]:Lr[0],localGlyph:!1},rn=St?-jr.height*Ir:xt*mn-17-Lr[1]*Ir,qr=jr.advance;const oo=(ui?Lr[0]:Lr[1])*Ir-mn*xt;oo>0&&oo>mi&&(mi=oo)}else{const Ar=me[Xi.fontStack];if(!Ar)continue;Ar[Er]&&(En=Ar[Er]);const Lr=ye[Xi.fontStack];if(!Lr)continue;const oo=Lr.glyphs[Er];if(!oo)continue;if(jr=oo.metrics,qr=Er!==8203?mn:0,St){const ds=Lr.ascender!==void 0?Math.abs(Lr.ascender):0,In=Lr.descender!==void 0?Math.abs(Lr.descender):0,fs=(ds+In)*Ir;Ji<fs&&(Ji=fs,ki=(ds-In)/2*Ir),rn=-ds*Ir}else rn=(xt-Ir)*mn-17}ui?(ge.verticalizable=!0,Bi.push({glyph:Er,image:Nn,x:it,y:Ke+rn,vertical:ui,scale:Ir,localGlyph:jr.localGlyph,fontStack:Xi.fontStack,sectionIndex:gr,metrics:jr,rect:En}),it+=qr*Ir+Je):(Bi.push({glyph:Er,image:Nn,x:it,y:Ke+rn,vertical:ui,scale:Ir,localGlyph:jr.localGlyph,fontStack:Xi.fontStack,sectionIndex:gr,metrics:jr,rect:En}),it+=jr.advance*Ir+Je)}Bi.length!==0&&(rt=Math.max(it-Je,rt),St?$I(Bi,tt,mi,ki,Ze*xt/2):$I(Bi,tt,mi,0,Ze/2)),it=0;const Fr=Ze*xt+mi;yi.lineOffset=Math.max(mi,Jt),Ke+=Fr,++Et}const mt=Ke,{horizontalAlign:_t,verticalAlign:Vt}=Mb(Ge);(function(Rt,xt,Jt,yi,Bi,mi){const Ji=(xt-Jt)*Bi,ki=-mi*yi;for(const Fr of Rt)for(const Ri of Fr.positionedGlyphs)Ri.x+=Ji,Ri.y+=ki})(ge.positionedLines,tt,_t,Vt,rt,mt),ge.top+=-Vt*mt,ge.bottom=ge.top+mt,ge.left+=-_t*rt,ge.right=ge.left+rt,ge.hasBaseline=St}(oe,e,i,a,U,m,_,b,C,S,k,R),!function(ge){for(const ye of ge)if(ye.positionedGlyphs.length!==0)return!1;return!0}(ae))return oe}const Uv={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},w3={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jI(s,e,i,a,u,f){if(e.image){const m=a.get(e.image.toString());return m?m.displaySize[0]*e.scale*mn/f+u:0}{const m=i[e.fontStack],_=m&&m.glyphs[s];return _?_.metrics.advance*e.scale+u:0}}function NI(s,e,i,a){const u=Math.pow(s-e,2);return a?s<e?u/2:2*u:u+Math.abs(i)*i}function S3(s,e,i){let a=0;return s===10&&(a-=1e4),i&&(a+=150),s!==40&&s!==65288||(a+=50),e!==41&&e!==65289||(a+=50),a}function UI(s,e,i,a,u,f){let m=null,_=NI(e,i,u,f);for(const b of a){const S=NI(e-b.x,i,u,f)+b.badness;S<=_&&(m=b,_=S)}return{index:s,x:e,priorBreak:m,badness:_}}function VI(s){return s?VI(s.priorBreak).concat(s.index):[]}function Mb(s){let e=.5,i=.5;switch(s){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:e,verticalAlign:i}}function $I(s,e,i,a,u){if(!(e||i||a||u))return;const f=s.length-1,m=s[f],_=(m.x+m.metrics.advance*m.scale)*e;for(let b=0;b<=f;b++)s[b].x-=_,s[b].y+=i+a+u}function Rb(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function Vv(s,e,i,a){const{horizontalAlign:u,verticalAlign:f}=Mb(a),m=i[0]-s.displaySize[0]*u,_=i[1]-s.displaySize[1]*f;return{imagePrimary:s,imageSecondary:e,top:_,bottom:_+s.displaySize[1],left:m,right:m+s.displaySize[0]}}function Db(s,e,i,a,u,f){const m=s.imagePrimary;let _;if(m.content){const $=m.content,U=m.pixelRatio||1;_=[$[0]/U,$[1]/U,m.displaySize[0]-$[2]/U,m.displaySize[1]-$[3]/U]}const b=e.left*f,S=e.right*f;let I,C,k,M;i==="width"||i==="both"?(M=u[0]+b-a[3],C=u[0]+S+a[1]):(M=u[0]+(b+S-m.displaySize[0])/2,C=M+m.displaySize[0]);const R=e.top*f,F=e.bottom*f;return i==="height"||i==="both"?(I=u[1]+R-a[0],k=u[1]+F+a[2]):(I=u[1]+(R+F-m.displaySize[1])/2,k=I+m.displaySize[1]),{imagePrimary:m,imageSecondary:void 0,top:I,right:C,bottom:k,left:M,collisionPadding:_}}function GI(s){return!s.imagePrimary.stretchX}function HI(s){return!s.imagePrimary.stretchY}function WI(s){return{width:s.right-s.left,height:s.bottom-s.top}}const Jl=128;function Ah(s,e,i,a){const{expression:u}=e;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Yi(s+1,{worldview:i}),void 0,void 0,void 0,a)};if(u.kind==="source")return{kind:"source"};{const{zoomStops:f,interpolationType:m}=u;let _=0;for(;_<f.length&&f[_]<=s;)_++;_=Math.max(0,_-1);let b=_;for(;b<f.length&&f[b]<s+1;)b++;b=Math.min(f.length-1,b);const S=f[_],I=f[b];return u.kind==="composite"?{kind:"composite",minZoom:S,maxZoom:I,interpolationType:m}:{kind:"camera",minZoom:S,maxZoom:I,minSize:u.evaluate(new Yi(S,{worldview:i}),void 0,void 0,void 0,a),maxSize:u.evaluate(new Yi(I,{worldview:i}),void 0,void 0,void 0,a),interpolationType:m}}}function Ob(s,{uSize:e,uSizeT:i},{lowerSize:a,upperSize:u}){return s.kind==="source"?a/Jl:s.kind==="composite"?qt(a/Jl,u/Jl,i):e}function df(s,e,i=1){let a=0,u=0;if(s.kind==="constant")u=s.layoutSize*i;else if(s.kind!=="source"){const{interpolationType:f,minZoom:m,maxZoom:_}=s,b=f?pe(Js.interpolationFactor(f,e,m,_),0,1):0;s.kind==="camera"?u=qt(s.minSize,s.maxSize,b)*i:a=b*i}return{uSizeT:a,uSize:u}}class Ql extends at{constructor(e,i,a,u,f){super(e,i),this.angle=u,this.z=a,f!==void 0&&(this.segment=f)}clone(){return new Ql(this.x,this.y,this.z,this.angle,this.segment)}}function qI(s,e,i,a,u){if(e.segment===void 0)return!0;let f=e,m=e.segment+1,_=0;for(;_>-i/2;){if(m--,m<0)return!1;_-=s[m].dist(f),f=s[m]}_+=s[m].dist(s[m+1]),m++;const b=[];let S=0;for(;_<i/2;){const I=s[m],C=s[m+1];if(!C)return!1;let k=s[m-1].angleTo(I)-I.angleTo(C);for(k=Math.abs((k+3*Math.PI)%(2*Math.PI)-Math.PI),b.push({distance:_,angleDelta:k}),S+=k;_-b[0].distance>a;)S-=b.shift().angleDelta;if(S>u)return!1;m++,_+=I.dist(C)}return!0}function ZI(s){let e=0;for(let i=0;i<s.length-1;i++)e+=s[i].dist(s[i+1]);return e}function XI(s,e,i){return s?.6*e*i:0}function KI(s,e){return Math.max(s?s.right-s.left:0,e?e.right-e.left:0)}function T3(s,e,i,a,u,f){const m=XI(i,u,f),_=KI(i,a)*f;let b=0;const S=ZI(s)/2;for(let I=0;I<s.length-1;I++){const C=s[I],k=s[I+1],M=C.dist(k);if(b+M>S){const R=(S-b)/M,F=qt(C.x,k.x,R),$=qt(C.y,k.y,R),U=new Ql(F,$,0,k.angleTo(C),I);return!m||qI(s,U,_,m,e)?U:void 0}b+=M}}function E3(s,e,i,a,u,f,m,_,b){const S=XI(a,f,m),I=KI(a,u),C=I*m,k=s[0].x===0||s[0].x===b||s[0].y===0||s[0].y===b;return e-C<e/4&&(e=C+e/4),YI(s,k?e/2*_%e:(I/2+2*f)*m*_%e,e,S,i,C,k,!1,b)}function YI(s,e,i,a,u,f,m,_,b){const S=f/2,I=ZI(s);let C=0,k=e-i,M=[];for(let R=0;R<s.length-1;R++){const F=s[R],$=s[R+1],U=F.dist($),H=$.angleTo(F);for(;k+i<C+U;){k+=i;const X=(k-C)/U,Q=qt(F.x,$.x,X),ae=qt(F.y,$.y,X);if(Q>=0&&Q<b&&ae>=0&&ae<b&&k-S>=0&&k+S<=I){const oe=new Ql(Q,ae,0,H,R);a&&!qI(s,oe,f,a,u)||M.push(oe)}}C+=U}return _||M.length||m||(M=YI(s,C/2,i,a,u,f,m,!0,b)),M}function JI(s){let e=0,i=0;for(const m of s)e+=m.w*m.h,i=Math.max(i,m.w);s.sort((m,_)=>_.h-m.h);const a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),i),h:1/0}];let u=0,f=0;for(const m of s)for(let _=a.length-1;_>=0;_--){const b=a[_];if(!(m.w>b.w||m.h>b.h)){if(m.x=b.x,m.y=b.y,f=Math.max(f,m.y+m.h),u=Math.max(u,m.x+m.w),m.w===b.w&&m.h===b.h){const S=a.pop();S&&_<a.length&&(a[_]=S)}else m.h===b.h?(b.x+=m.w,b.w-=m.w):m.w===b.w?(b.y+=m.h,b.h-=m.h):(a.push({x:b.x+m.w,y:b.y,w:b.w-m.w,h:m.h}),b.y+=m.h,b.h-=m.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}Ct(Ql,"Anchor");class dg{static getImagePositionScale(e,i,a){if(i&&e){const{sx:u,sy:f}=e;return{x:u,y:f}}return{x:a,y:a}}constructor(e,i,a,u){this.paddedRect=e;const{pixelRatio:f,version:m,stretchX:_,stretchY:b,content:S,sdf:I,usvg:C}=i;this.pixelRatio=f,this.stretchX=_,this.stretchY=b,this.content=S,this.version=m,this.padding=a,this.sdf=I,this.usvg=C,this.scale=dg.getImagePositionScale(u,C,f)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function zb(s,e,i){const a=vs.parse(s),u=function(f,m,_=[1,1]){return{x:0,y:0,w:(f.data?f.data.width:f.width*_[0])+2*m,h:(f.data?f.data.height:f.height*_[1])+2*m}}(e,i,[a.sx,a.sy]);return{bin:u,imagePosition:new dg(u,e,i,a),imageVariant:a}}class QI{constructor(e,i,a){const u=new Map,f=new Map;this.haveRenderCallbacks=[];const m=[];this.addImages(e,u,1,m),this.addImages(i,f,2,m);const{w:_,h:b}=JI(m),S=new jn({width:_||1,height:b||1});for(const[I,C]of e.entries()){const k=u.get(I).paddedRect;jn.copy(C.data,S,{x:0,y:0},{x:k.x+1,y:k.y+1},C.data,null,C.sdf)}for(const[I,C]of i.entries()){const k=f.get(I),M=k.paddedRect;let R=k.padding;const F=M.x+R,$=M.y+R,U=C.data.width,H=C.data.height;R=R>1?R-1:R,jn.copy(C.data,S,{x:0,y:0},{x:F,y:$},C.data,a),jn.copy(C.data,S,{x:0,y:H-R},{x:F,y:$-R},{width:U,height:R},a),jn.copy(C.data,S,{x:0,y:0},{x:F,y:$+H},{width:U,height:R},a),jn.copy(C.data,S,{x:U-R,y:0},{x:F-R,y:$},{width:R,height:H},a),jn.copy(C.data,S,{x:0,y:0},{x:F+U,y:$},{width:R,height:H},a),jn.copy(C.data,S,{x:U-R,y:H-R},{x:F-R,y:$-R},{width:R,height:R},a),jn.copy(C.data,S,{x:0,y:H-R},{x:F+U,y:$-R},{width:R,height:R},a),jn.copy(C.data,S,{x:0,y:0},{x:F+U,y:$+H},{width:R,height:R},a),jn.copy(C.data,S,{x:U-R,y:0},{x:F-R,y:$+H},{width:R,height:R},a)}this.lut=a,this.image=S,this.iconPositions=u,this.patternPositions=f}addImages(e,i,a,u){for(const[f,m]of e.entries()){const{bin:_,imagePosition:b,imageVariant:S}=zb(f,m,a);i.set(f,b),u.push(_),m.hasRenderCallback&&this.haveRenderCallbacks.push(S.id)}}patchUpdatedImages(e,i,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(f=>e.hasImage(f,a)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,a);for(const f of e.getUpdatedImages(a)){for(const m of this.iconPositions.keys()){const _=vs.parse(m);if(_s.isEqual(_.id,f)){const b=e.getImage(f,a);this.patchUpdatedImage(this.iconPositions.get(m),b,i,null)}}for(const m of this.patternPositions.keys()){const _=vs.parse(m);if(_s.isEqual(_.id,f)){const b=e.getImage(f,a);this.patchUpdatedImage(this.patternPositions.get(m),b,i,u||this.lut)}}}}patchUpdatedImage(e,i,a,u=null){if(!e||!i||e.version===i.version)return;e.version=i.version;const[f,m]=e.tl,_=e.sdf;if(this.lut||_){const b={width:i.data.width,height:i.data.height},S=new jn(b);jn.copy(i.data,S,{x:0,y:0},{x:0,y:0},b,u,_),a.update(S,{position:{x:f,y:m}})}else a.update(i.data,{position:{x:f,y:m}})}}Ct(dg,"ImagePosition"),Ct(QI,"ImageAtlas",{omit:["lut"]});const fg=1e20;function eA(s,e,i,a,u,f,m,_,b){for(let S=e;S<e+a;S++)tA(s,i*f+S,f,u,m,_,b);for(let S=i;S<i+u;S++)tA(s,S*f+e,1,a,m,_,b)}function tA(s,e,i,a,u,f,m){f[0]=0,m[0]=-fg,m[1]=fg,u[0]=s[e];for(let _=1,b=0,S=0;_<a;_++){u[_]=s[e+_*i];const I=_*_;do{const C=f[b];S=(u[_]-u[C]+I-C*C)/(_-C)/2}while(S<=m[b]&&--b>-1);b++,f[b]=_,m[b]=S,m[b+1]=fg}for(let _=0,b=0;_<a;_++){for(;m[b+1]<_;)b++;const S=f[b],I=_-S;s[e+_*i]=u[S]+I*I}}const Bb={none:0,ideographs:1,all:2};class ff{constructor(e,i,a){this.requestManager=e,this.localGlyphMode=i,this.localFontFamily=a,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,i){const a=[],u=this.url||Jr.GLYPHS_URL;for(const f in e)for(const m of e[f])a.push({stack:f,id:m});Re(a,({stack:f,id:m},_)=>{let b=this.entries[f];b||(b=this.entries[f]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[m];if(S!==void 0)return void _(null,{stack:f,id:m,glyph:S});if(S=this._tinySDF(b,f,m),S)return b.glyphs[m]=S,void _(null,{stack:f,id:m,glyph:S});const I=Math.floor(m/256);if(256*I>65535)return Kt("glyphs > 65535 not supported"),void _(null,{stack:f,id:m,glyph:S});if(b.ranges[I])return void _(null,{stack:f,id:m,glyph:S});let C=b.requests[I];C||(C=b.requests[I]=[],ff.loadGlyphRange(f,I,u,this.requestManager,(k,M)=>{if(M){b.ascender=M.ascender,b.descender=M.descender;for(const R in M.glyphs)this._doesCharSupportLocalGlyph(+R)||(b.glyphs[+R]=M.glyphs[+R]);b.ranges[I]=!0}for(const R of C)R(k,M);delete b.requests[I]})),C.push((k,M)=>{k?_(k):M&&_(null,{stack:f,id:m,glyph:M.glyphs[m]||null})})},(f,m)=>{if(f)i(f);else if(m){const _={};for(const{stack:b,id:S,glyph:I}of m)_[b]===void 0&&(_[b]={}),_[b].glyphs===void 0&&(_[b].glyphs={}),_[b].glyphs[S]=I&&{id:I.id,bitmap:I.bitmap.clone(),metrics:I.metrics},_[b].ascender=this.entries[b].ascender,_[b].descender=this.entries[b].descender;i(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Bb.none&&(this.localGlyphMode===Bb.all?!!this.localFontFamily:!!this.localFontFamily&&(Nd(e)||My(e)||zc(e)||sh(e)||Oc(e)||Bc(e)||(i=e)>=131072&&i<=173791||(a=>a>=66736&&a<=66815)(e)));var i}_tinySDF(e,i,a){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(a))return;let f=e.tinySDF;if(!f){let F="400";/bold/i.test(i)?F="900":/medium/i.test(i)?F="500":/light/i.test(i)&&(F="200"),f=e.tinySDF=new ff.TinySDF({fontFamily:u,fontWeight:F,fontSize:48,buffer:6,radius:16}),f.fontWeight=F}if(this.localGlyphs[f.fontWeight][a])return this.localGlyphs[f.fontWeight][a];const m=String.fromCodePoint(a),{data:_,width:b,height:S,glyphWidth:I,glyphHeight:C,glyphLeft:k,glyphTop:M,glyphAdvance:R}=f.draw(m);return this.localGlyphs[f.fontWeight][a]={id:a,bitmap:new Xc({width:b,height:S},_),metrics:{width:I/2,height:C/2,left:k/2,top:M/2-27,advance:R/2,localGlyph:!0}}}}function iA(s,e){return s+e[1]-e[0]}function Fb(s,e,i,a,u=1){const f=[],m=s.imagePrimary,_=m.pixelRatio,b=m.paddedRect.w-2,S=m.paddedRect.h-2,I=(s.right-s.left)*u,C=(s.bottom-s.top)*u,k=m.stretchX||[[0,b]],M=m.stretchY||[[0,S]],R=k.reduce(iA,0),F=M.reduce(iA,0),$=b-R,U=S-F;let H=0,X=R,Q=0,ae=F,oe=0,ge=$,ye=0,me=U;if(m.content&&a){const Ae=m.content;H=$v(k,0,Ae[0]),Q=$v(M,0,Ae[1]),X=$v(k,Ae[0],Ae[2]),ae=$v(M,Ae[1],Ae[3]),oe=Ae[0]-H,ye=Ae[1]-Q,ge=Ae[2]-Ae[0]-X,me=Ae[3]-Ae[1]-ae}const Se=(Ae,Ze,Ge,qe)=>{const et=Gv(Ae.stretch-H,X,I,s.left*u),Je=Hv(Ae.fixed-oe,ge,Ae.stretch,R),Qe=Gv(Ze.stretch-Q,ae,C,s.top*u),Ne=Hv(Ze.fixed-ye,me,Ze.stretch,F),it=Gv(Ge.stretch-H,X,I,s.left*u),Ke=Hv(Ge.fixed-oe,ge,Ge.stretch,R),rt=Gv(qe.stretch-Q,ae,C,s.top*u),tt=Hv(qe.fixed-ye,me,qe.stretch,F),St=new at(et,Qe),Et=new at(it,Qe),mt=new at(it,rt),_t=new at(et,rt),Vt=new at(Je/_,Ne/_),Rt=new at(Ke/_,tt/_),xt=e*Math.PI/180;if(xt){const ki=Math.sin(xt),Fr=Math.cos(xt),Ri=[Fr,-ki,ki,Fr];St._matMult(Ri),Et._matMult(Ri),_t._matMult(Ri),mt._matMult(Ri)}const Jt=Ae.stretch+Ae.fixed,yi=Ge.stretch+Ge.fixed,Bi=Ze.stretch+Ze.fixed,mi=qe.stretch+qe.fixed,Ji=s.imageSecondary;return{tl:St,tr:Et,bl:_t,br:mt,texPrimary:{x:m.paddedRect.x+1+Jt,y:m.paddedRect.y+1+Bi,w:yi-Jt,h:mi-Bi},texSecondary:Ji?{x:Ji.paddedRect.x+1+Jt,y:Ji.paddedRect.y+1+Bi,w:yi-Jt,h:mi-Bi}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Vt,pixelOffsetBR:Rt,minFontScaleX:ge/_/I,minFontScaleY:me/_/C,isSDF:i}};if(m.stretchX||m.stretchY){const Ae=rA(k,$,R),Ze=rA(M,U,F);for(let Ge=0;Ge<Ae.length-1;Ge++){const qe=Ae[Ge],et=Ae[Ge+1];for(let Je=0;Je<Ze.length-1;Je++)f.push(Se(qe,Ze[Je],et,Ze[Je+1]))}}else f.push(Se({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return f}function I3(s,e){const i=s.stretchY||[[0,s.paddedRect.h-2]];return s.stretchX||s.stretchY?nA(s.stretchX||[[0,s.paddedRect.w-2]])*nA(i):1}function $v(s,e,i){let a=0;for(const u of s)a+=Math.max(e,Math.min(i,u[1]))-Math.max(e,Math.min(i,u[0]));return a}function rA(s,e,i){const a=[{fixed:-1,stretch:0}];for(const[u,f]of s){const m=a[a.length-1];a.push({fixed:u-m.stretch,stretch:m.stretch}),a.push({fixed:u-m.stretch,stretch:m.stretch+(f-u)})}return a.push({fixed:e+1,stretch:i}),a}function nA(s){return 2*s.length+1}function Gv(s,e,i,a){return s/e*i+a}function Hv(s,e,i,a){return s-e*i/a}function A3(s,e,i,a){const u=e+s.positionedLines[a].lineOffset;return a===0?i+u/2:i+(u+(e+s.positionedLines[a-1].lineOffset))/2}function sA(s,e,i,a,u,f,m,_,b){const S=[];if(e.positionedLines.length===0)return S;const I=(b!==void 0?b:a.layout.get("text-rotate").evaluate(f,{}))*Math.PI/180,C=function($){const U=$[0],H=$[1],X=U*H;return X>0?[U,-H]:X<0?[-U,H]:U===0?[H,U]:[H,-U]}(i);let k=Math.abs(e.top-e.bottom);for(const $ of e.positionedLines)k-=$.lineOffset;const M=e.positionedLines.length,R=k/M;let F=e.top-i[1];for(let $=0;$<M;++$){const U=e.positionedLines[$];F=A3(e,R,F,$);for(const H of U.positionedGlyphs){if(!H.rect)continue;const X=H.rect||{};let Q=4,ae=!0,oe=1,ge=0;if(H.image){const Et=m.get(H.image.toString());if(!Et)continue;if(Et.sdf){Kt("SDF images are not supported in formatted text and will be ignored.");continue}ae=!1,oe=Et.pixelRatio,Q=1/oe}const ye=(u||_)&&H.vertical,me=H.metrics.advance*H.scale/2,Se=H.metrics,Ae=H.rect;if(Ae===null)continue;_&&e.verticalizable&&(ge=H.image?me-H.metrics.width*H.scale/2:0);const Ze=u?[H.x+me,H.y]:[0,0];let Ge=[0,0],qe=[0,0],et=!1;u||(ye?(qe=[H.x+me+C[0],H.y+C[1]-ge],et=!0):Ge=[H.x+me+i[0],H.y+i[1]-ge]);const Je=Ae.w*H.scale/(oe*(H.localGlyph?2:1)),Qe=Ae.h*H.scale/(oe*(H.localGlyph?2:1));let Ne,it,Ke,rt;if(ye){const Et=H.y-F,mt=new at(-me,me-Et),_t=-Math.PI/2,Vt=new at(...qe);Ne=new at(-me+Ge[0],Ge[1]),Ne._rotateAround(_t,mt)._add(Vt),Ne.x+=-Et+me,Ne.y-=(Se.left-Q)*H.scale;const Rt=H.image?Se.advance*H.scale:mn*H.scale,xt=String.fromCodePoint(H.glyph);l3(xt)?Ne.x+=(1-Q)*H.scale:c3(xt)?Ne.x+=Rt-Se.height*H.scale+(-Q-1)*H.scale:Ne.x+=H.image||Se.width+2*Q===Ae.w&&Se.height+2*Q===Ae.h?(Rt-Qe)/2:(Rt-(Se.height+2*Q)*H.scale)/2,it=new at(Ne.x,Ne.y-Je),Ke=new at(Ne.x+Qe,Ne.y),rt=new at(Ne.x+Qe,Ne.y-Je)}else{const Et=(Se.left-Q)*H.scale-me+Ge[0],mt=(-Se.top-Q)*H.scale+Ge[1],_t=Et+Je,Vt=mt+Qe;Ne=new at(Et,mt),it=new at(_t,mt),Ke=new at(Et,Vt),rt=new at(_t,Vt)}if(I){let Et;Et=u?new at(0,0):et?new at(C[0],C[1]):new at(i[0],i[1]),Ne._rotateAround(I,Et),it._rotateAround(I,Et),Ke._rotateAround(I,Et),rt._rotateAround(I,Et)}const tt=new at(0,0),St=new at(0,0);S.push({tl:Ne,tr:it,bl:Ke,br:rt,texPrimary:X,texSecondary:void 0,writingMode:e.writingMode,glyphOffset:Ze,sectionIndex:H.sectionIndex,isSDF:ae,pixelOffsetTL:tt,pixelOffsetBR:St,minFontScaleX:0,minFontScaleY:0})}}return S}function C3(s,e=1,i=!1){let a=1/0,u=1/0,f=-1/0,m=-1/0;const _=s[0];for(let M=0;M<_.length;M++){const R=_[M];(!M||R.x<a)&&(a=R.x),(!M||R.y<u)&&(u=R.y),(!M||R.x>f)&&(f=R.x),(!M||R.y>m)&&(m=R.y)}const b=Math.min(f-a,m-u);let S=b/2;const I=new qu([],k3);if(b===0)return new at(a,u);for(let M=a;M<f;M+=b)for(let R=u;R<m;R+=b)I.push(new pf(M+S,R+S,S,s));let C=function(M){let R=0,F=0,$=0;const U=M[0];for(let H=0,X=U.length,Q=X-1;H<X;Q=H++){const ae=U[H],oe=U[Q],ge=ae.x*oe.y-oe.x*ae.y;F+=(ae.x+oe.x)*ge,$+=(ae.y+oe.y)*ge,R+=3*ge}return new pf(F/R,$/R,0,M)}(s),k=I.length;for(;I.length;){const M=I.pop();(M.d>C.d||!C.d)&&(C=M,i&&console.log("found best %d after %d probes",Math.round(1e4*M.d)/1e4,k)),M.max-C.d<=e||(S=M.h/2,I.push(new pf(M.p.x-S,M.p.y-S,S,s)),I.push(new pf(M.p.x+S,M.p.y-S,S,s)),I.push(new pf(M.p.x-S,M.p.y+S,S,s)),I.push(new pf(M.p.x+S,M.p.y+S,S,s)),k+=4)}return i&&(console.log(`num probes: ${k}`),console.log(`best distance: ${C.d}`)),C.p}function k3(s,e){return e.max-s.max}ff.loadGlyphRange=function(s,e,i,a,u){const f=256*e,m=f+255,_=a.transformRequest(a.normalizeGlyphsURL(i).replace("{fontstack}",s).replace("{range}",`${f}-${m}`),gs.Glyphs);Bu(_,(b,S)=>{if(b)u(b);else if(S){const I={},C=function(k){return new Nv(k).readFields(v3,{})}(S);for(const k of C.glyphs)I[k.id]=k;u(null,{glyphs:I,ascender:C.ascender,descender:C.descender})}})},ff.TinySDF=class{constructor({fontSize:s=24,buffer:e=3,radius:i=8,cutoff:a=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:m="normal",lang:_=null}={}){this.buffer=e,this.cutoff=a,this.radius=i,this.lang=_;const b=this.size=s+4*e,S=this._createCanvas(b),I=this.ctx=S.getContext("2d",{willReadFrequently:!0});I.font=`${m} ${f} ${s}px ${u}`,I.textBaseline="alphabetic",I.textAlign="left",I.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(s){const e=document.createElement("canvas");return e.width=e.height=s,e}draw(s){const{width:e,actualBoundingBoxAscent:i,actualBoundingBoxDescent:a,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(s),m=Math.ceil(i),_=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),b=Math.min(this.size-this.buffer,m+Math.ceil(a)),S=_+2*this.buffer,I=b+2*this.buffer,C=Math.max(S*I,0),k=new Uint8ClampedArray(C),M={data:k,width:S,height:I,glyphWidth:_,glyphHeight:b,glyphTop:m,glyphLeft:0,glyphAdvance:e};if(_===0||b===0)return M;const{ctx:R,buffer:F,gridInner:$,gridOuter:U}=this;this.lang&&(R.lang=this.lang),R.clearRect(F,F,_,b),R.fillText(s,F,F+m);const H=R.getImageData(F,F,_,b);U.fill(fg,0,C),$.fill(0,0,C);for(let X=0;X<b;X++)for(let Q=0;Q<_;Q++){const ae=H.data[4*(X*_+Q)+3]/255;if(ae===0)continue;const oe=(X+F)*S+Q+F;if(ae===1)U[oe]=0,$[oe]=fg;else{const ge=.5-ae;U[oe]=ge>0?ge*ge:0,$[oe]=ge<0?ge*ge:0}}eA(U,0,0,S,I,S,this.f,this.v,this.z),eA($,F,F,_,b,S,this.f,this.v,this.z);for(let X=0;X<C;X++){const Q=Math.sqrt(U[X])-Math.sqrt($[X]);k[X]=Math.round(255-255*(Q/this.radius+this.cutoff))}return M}};class pf{constructor(e,i,a,u){this.p=new at(e,i),this.h=a,this.d=function(f,m){let _=!1,b=1/0;for(let S=0;S<m.length;S++){const I=m[S];for(let C=0,k=I.length,M=k-1;C<k;M=C++){const R=I[C],F=I[M];R.y>f.y!=F.y>f.y&&f.x<(F.x-R.x)*(f.y-R.y)/(F.y-R.y)+R.x&&(_=!_),b=Math.min(b,Wc(f,R,F))}}return(_?1:-1)*Math.sqrt(b)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const L3=Object.keys,jb=Number.POSITIVE_INFINITY,P3=Math.sqrt(2);function Qc(s,e,i,a,u){const f=Rb(s)&&s.collisionPadding?s.collisionPadding:[0,0,0,0],m={top:s.top-f[1],bottom:s.bottom+f[3],left:s.left-f[0],right:s.right+f[2],scaled:!1};return a!==void 0&&function(_,b){_.top*=b,_.bottom*=b,_.left*=b,_.right*=b,_.scaled=!0}(m,a),i&&function(_,b){if(!b)return;const S=Pi(b),I=new at(_.left,_.top),C=new at(_.right,_.top),k=new at(_.left,_.bottom),M=new at(_.right,_.bottom),R=new at(0,0);I._rotateAround(S,R),C._rotateAround(S,R),k._rotateAround(S,R),M._rotateAround(S,R),_.left=Math.min(I.x,C.x,k.x,M.x),_.right=Math.max(I.x,C.x,k.x,M.x),_.top=Math.min(I.y,C.y,k.y,M.y),_.bottom=Math.max(I.y,C.y,k.y,M.y)}(m,i),u&&(m.left+=u[0],m.right+=u[0],m.top+=u[1],m.bottom+=u[1]),e?{top:Math.min(e.top,m.top),bottom:Math.max(e.bottom,m.bottom),left:Math.min(e.left,m.left),right:Math.max(e.right,m.right),scaled:e.scaled||m.scaled}:m}function oA(s,[e,i]){let a=0,u=0;if(i===jb){e<0&&(e=0);const f=e/P3;switch(s){case"top-right":case"top-left":u=f-7;break;case"bottom-right":case"bottom-left":u=7-f;break;case"bottom":u=7-e;break;case"top":u=e-7}switch(s){case"top-right":case"bottom-right":a=-f;break;case"top-left":case"bottom-left":a=f;break;case"left":a=e;break;case"right":a=-e}}else{switch(e=Math.abs(e),i=Math.abs(i),s){case"top-right":case"top-left":case"top":u=i-7;break;case"bottom-right":case"bottom-left":case"bottom":u=7-i}switch(s){case"top-right":case"bottom-right":case"right":a=-e;break;case"top-left":case"bottom-left":case"left":a=e}}return[a,u]}function M3(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R){const F=s.layers[0],$=F.appearances;if($.length===0)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const U={iconBBox:null,iconVerticalBBox:null},H={textBBox:null,textVerticalBBox:null},{baseIconRotate:X,baseTextRotate:Q,iconScaleFactor:ae}=function(ge,ye,me){const Se=ge.get("icon-rotate").evaluate(ye,{},me),Ae=ge.get("text-rotate").evaluate(ye,{},me),[Ze,Ge]=ge.get("icon-size-scale-range");return{baseIconRotate:Se,baseTextRotate:Ae,iconScaleFactor:pe(1,Ze,Ge)}}(a,u,f);e&&(U.iconBBox=Qc(e,U.iconBBox,X,m),i)&&(U.iconVerticalBBox=Qc(i,U.iconVerticalBBox,X+90,m));const oe=qv(C.horizontal);oe&&(H.textBBox=Qc(oe,H.textBBox,Q,1,M)),C.vertical&&(H.textVerticalBBox=Qc(C.vertical,H.textVerticalBBox,Q+90,1,M));for(const ge of $)ge.hasIconProperties()&&R3(U,s,F,ge,u,f,_,X,m,b,e,S,ae,I,R),ge.hasTextProperties()&&D3(H,F,ge,u,f,M,Q,k,oe,C.vertical);return{iconBBox:U.iconBBox,iconVerticalBBox:U.iconVerticalBBox,textBBox:H.textBBox,textVerticalBBox:H.textVerticalBBox}}function R3(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R){const{appearanceIconOffset:F,appearanceIconRotate:$,appearanceIconSize:U}=aA(a,i,u,f,m,_,b,S.iconScaleFactor);let H=null,X=null,Q=null;a.hasProperty("icon-image")?Q=function(ae,oe,ge,ye,me,Se,Ae,Ze){let Ge=null;const qe=oe.getAppearanceValueAndResolveTokens(ge,"icon-image",ye,me,Ze);if(qe){const et=ae.getResolvedImageFromTokens(qe),Je=ge.getUnevaluatedProperty("icon-size"),Qe=pg(et,Ah(ae.zoom,Je,ae.worldview,Ze),Je,me,ae.zoom,ye,ae.pixelRatio,Ae,ae.worldview,Ze);Ge=Se.get(Qe.iconPrimary.toString())}return Ge}(e,i,a,u,f,C,k,R):I&&(Q=I.imagePrimary),Q&&(H=Vv(Q,null,F,M),e.allowVerticalPlacement&&(X=Vv(Q,null,F,M))),H&&(s.iconBBox=Qc(H,s.iconBBox,$,U)),X&&(s.iconVerticalBBox=Qc(X,s.iconVerticalBBox,$+90,U))}function aA(s,e,i,a,u,f,m,_){const b=s.hasProperty("icon-offset")?e.getAppearanceValueAndResolveTokens(s,"icon-offset",i,a,[]):null,S=b&&Array.isArray(b)?b:u,I=s.hasProperty("icon-rotate")?e.getAppearanceValueAndResolveTokens(s,"icon-rotate",i,a,[]):null,C=typeof I=="number"?I:f,k=s.hasProperty("icon-size")?e.getAppearanceValueAndResolveTokens(s,"icon-size",i,a,[]):null;return{appearanceIconOffset:S,appearanceIconRotate:C,appearanceIconSize:typeof k=="number"?k*_:m}}function D3(s,e,i,a,u,f,m,_,b,S){const{appearanceTextOffset:I,appearanceTextRotate:C,appearanceTextSize:k}=lA(i,e,a,u,f,m,_),M=k/_;b&&(s.textBBox=Qc(b,s.textBBox,C,M,I)),S&&(s.textVerticalBBox=Qc(S,s.textVerticalBBox,C+90,M,I))}function lA(s,e,i,a,u,f,m){const _=s.hasProperty("text-offset")?e.getAppearanceValueAndResolveTokens(s,"text-offset",i,a,[]):null,b=_&&Array.isArray(_)?[_[0]*mn,_[1]*mn]:u,S=s.hasProperty("text-rotate")?e.getAppearanceValueAndResolveTokens(s,"text-rotate",i,a,[]):null,I=typeof S=="number"?S:f,C=s.hasProperty("text-size")?e.getAppearanceValueAndResolveTokens(s,"text-size",i,a,[]):null;return{appearanceTextOffset:b,appearanceTextRotate:I,appearanceTextSize:typeof C=="number"?C:m}}function Wv(s,e,i,a,u,f,m,_,b){if(!e||!e.usvg)return;const S=WI(a),I=WI(u),C=f!=="both"&&f!=="width"||!GI(a)?1:I.width/S.width,k=f!=="both"&&f!=="height"||!HI(a)?1:I.height/S.height;i.scaleSelf(C,k);const M=i.toString();m.set(M,i),_.set(M,e);const{imagePosition:R}=zb(M,e,1);b.set(M,R)}function cA(s,e,i,a,u,f,m,_,b,S){if(!s)return;const I=function(C,k,M,R,F,$,U){if(C.kind==="camera")return C.maxSize;if(C.kind==="composite"){const H=k.possiblyEvaluate(new Yi(C.maxZoom,{worldview:$}),M,U).evaluate(F,{},M,U),X=k.possiblyEvaluate(new Yi(C.minZoom,{worldview:$}),M,U).evaluate(F,{},M,U);return Math.max(H,X)}return k.possiblyEvaluate(new Yi(R,{worldview:$}),M,U).evaluate(F,{},M,U)}(e,i,a,u,f,b,S);return s.scaleSelf(I*_*m)}function pg(s,e,i,a,u,f,m,_,b,S){return{iconPrimary:cA(s.getPrimary(),e,i,a,u,f,m,_,b,S),iconSecondary:cA(s.getSecondary(),e,i,a,u,f,m,_,b,S)}}function O3(s,e,i){if(!e)return;const a=i.get(s.toString()),u=i.get(e.toString());a&&u&&(a.paddedRect.w===u.paddedRect.w&&a.paddedRect.h===u.paddedRect.h||Kt(`Mismatch in icon variant sizes: ${s.toString()} and ${e.toString()}`),a.usvg!==u.usvg&&Kt(`Mismatch in icon variant image types: ${s.id} and ${e.id}`))}function uA(s,e,i,a){if(!s)return;const u=e.get(i.toString());if(s.imagePrimary=u,a){const f=e.get(a.toString());s.imageSecondary=f}}function z3(s,e){for(const i in s.horizontal)hA(s.horizontal[i],e);hA(s.vertical,e)}function hA(s,e){if(s){for(const i of s.positionedLines)for(const a of i.positionedGlyphs)if(a.image!==null){const u=a.image.toString();a.rect=e.get(u).paddedRect}}}function Nb(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function B3(s,e,i,a,u,f,m,_,b){const S=qv(f.horizontal)||f.vertical,I=i.get("icon-text-fit-padding").evaluate(a,{},u);let C,k=e;return e&&b!=="none"&&(s.allowVerticalPlacement&&f.vertical&&(C=Db(e,f.vertical,b,I,_,m)),S&&(k=Db(e,S,b,I,_,m))),{defaultShapedIcon:k,verticallyShapedIcon:C}}function dA(s,e){return s*e/24}function F3(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H,X,Q,ae,oe,ge){let ye=m.textMaxSize.evaluate(e,{},k);ye===void 0?ye=_*m.textScaleFactor:ye*=m.textScaleFactor;const me=s.layers[0].layout,Se=dA(_,m.textScaleFactor),Ae=qv(i.horizontal)||i.vertical,Ze=s.hasAnyAppearanceProperty(["text-size","text-offset","text-rotate"]);if(($!=="none"||Ze)&&s.appearanceFeatureData&&s.featureToAppearanceIndex[e.index]<s.appearanceFeatureData.length){const mt=s.appearanceFeatureData[s.featureToAppearanceIndex[e.index]];mt&&(mt.textShaping=Ae,mt.iconTextFitPadding=me.get("icon-text-fit-padding").evaluate(e,{},k),mt.fontScale=Se,mt.textScaleFactor=m.textScaleFactor)}const Ge=M.name==="globe",qe=s.tilePixelRatio*ye/24,et=(rt=s.overscaling,s.zoom>18&&rt>2&&(rt>>=1),Math.max(gt/(512*rt),1)*me.get("symbol-spacing")),Je=me.get("text-padding")*s.tilePixelRatio,Qe=me.get("icon-padding")*s.tilePixelRatio,Ne=Pi(me.get("text-max-angle")),it=me.get("icon-rotation-alignment")==="map"&&X!=="point",Ke=et/2;var rt;s.hasAnyIconTextFit===!1&&$!=="none"&&(s.hasAnyIconTextFit=!0);const tt=e.properties?+e.properties[Ii]:null,St=tt&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(tt):65535,Et=(mt,_t,Vt)=>{if(_t.x<0||_t.x>=gt||_t.y<0||_t.y>=gt)return;let Rt=null;if(Ge){const{x:xt,y:Jt,z:yi}=M.projectTilePoint(_t.x,_t.y,Vt);Rt={anchor:new Ql(xt,Jt,yi,0,void 0),up:M.upVector(Vt,_t.x,_t.y)}}(function(xt,Jt,yi,Bi,mi,Ji,ki,Fr,Ri,Xi,gr,Er,Ir,jr,En,Nn,qr,rn,un,ui,Ar,Lr,oo,ds,In,fs,Sl,qn,u0,bf,Ts,h0){const Tl=xt.addToLineVertexArray(Jt,Bi);let ec,iu,Vo,ga,Lg,wf,gi,gn=0,Nr=0,nn=0,$o=0,Us=-1,ao=-1;const _n={};let Pg=xc("");const El=yi?yi.anchor:Jt,Zr=qn!=="none";let An=0,sn=0;if(Ri._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Cn=Ri.layout.get("text-offset").evaluate(Ar,{},In);An=Cn[0]*mn,sn=Cn[1]*mn}else An=Ri.layout.get("text-radial-offset").evaluate(Ar,{},In)*mn,sn=jb;if(xt.allowVerticalPlacement&&mi.vertical){const Cn=mi.vertical;if(En)wf=$b(Cn),Fr&&(gi=$b(Fr));else{const Vs=Ri.layout.get("text-rotate").evaluate(Ar,{},In)+90;Vo=Zv(Xi,El,Jt,gr,Er,Ir,Cn,jr,Vs,Nn,h0),Fr&&(ga=Zv(Xi,El,Jt,gr,Er,Ir,Fr,rn,Vs,null,Ts))}}if(Ji){const Cn=Ri.layout.get("icon-rotate").evaluate(Ar,{},In),Vs=Fb(Ji,Cn,oo,Zr,Lr.iconScaleFactor),_a=Fr?Fb(Fr,Cn,oo,Zr,Lr.iconScaleFactor):void 0;iu=Zv(Xi,El,Jt,gr,Er,Ir,Ji,rn,Cn,null,bf);const Il=function($a,KB,LC,YB,JB,PC,MC,QB,r$,fw){const RC=$a.layers[0],DC=RC.appearances;let Tf=KB.length;if(LC&&(Tf=Math.max(Tf,LC.length)),DC.length===0)return Tf;const[eF,tF]=YB.get("icon-size-scale-range"),iF=pe(1,eF,tF);for(const pw of DC){const OC=pw.getUnevaluatedProperties();if(OC._values["icon-image"].value!==void 0){const zC=RC.getAppearanceValueAndResolveTokens(pw,"icon-image",PC,MC,fw);if(zC){const BC=$a.getResolvedImageFromTokens(zC);if(BC){const FC=pw.hasProperty("icon-size")?OC._values["icon-size"]:JB._values["icon-size"],rF=pg(BC,Ah($a.zoom,FC,$a.worldview,fw),FC,MC,$a.zoom,PC,$a.pixelRatio,iF,$a.worldview,fw),jC=QB.get(rF.iconPrimary.toString());jC&&(Tf=Math.max(Tf,I3(jC)))}}}}return Tf}(xt,Vs,_a,Ri.layout,Ri._unevaluatedLayout,Ar,In,xt.iconAtlasPositions,0,ds);gn=4*Il;const hw=Ri.layout.get("icon-size").evaluate(Ar,{},In,ds),dw=Lr.compositeIconSizes?Lr.compositeIconSizes[0].evaluate(Ar,{},In,ds):0,Mg=Lr.compositeIconSizes?Lr.compositeIconSizes[1].evaluate(Ar,{},In,ds):0,Sf=Vb(xt.layerIds[0],xt.iconSizeData,hw,Lr.iconScaleFactor,dw,Mg);xt.addSymbols(xt.icon,Vs,Sf,ui,un,Ar,void 0,yi,Jt,Tl.lineStartIndex,Tl.lineLength,-1,ds,In,fs,Sl,xt.symbolInstances.length,Il),Us=xt.icon.placedSymbolArray.length-1,_a&&(Nr=4*Il,xt.addSymbols(xt.icon,_a,Sf,ui,un,Ar,so.vertical,yi,Jt,Tl.lineStartIndex,Tl.lineLength,-1,ds,In,fs,Sl,xt.symbolInstances.length,Il),ao=xt.icon.placedSymbolArray.length-1)}for(const Cn in mi.horizontal){const Vs=Cn,_a=mi.horizontal[Vs];ec||(Pg=xc(_a.text),En?Lg=$b(_a):ec=Zv(Xi,El,Jt,gr,Er,Ir,_a,jr,Ri.layout.get("text-rotate").evaluate(Ar,{},In),Nn,h0));const Il=_a.positionedLines.length===1;if(nn+=fA(xt,yi,Jt,_a,ki,Ri,En,Ar,Nn,Tl,mi.vertical?so.horizontal:so.horizontalOnly,Il?L3(mi.horizontal):[Vs],_n,Us,Lr,ds,In,xt.symbolInstances.length,fs),Il)break}mi.vertical&&($o+=fA(xt,yi,Jt,mi.vertical,ki,Ri,En,Ar,Nn,Tl,so.vertical,["vertical"],_n,ao,Lr,ds,In,xt.symbolInstances.length,fs));let Zn=-1;const Xn=(Cn,Vs)=>Cn?Math.max(Cn,Vs):Vs;Zn=Xn(Lg,Zn),Zn=Xn(wf,Zn),Zn=Xn(gi,Zn);const ru=Zn>-1?1:0;xt.glyphOffsetArray.length>=65535&&Kt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ar.sortKey!==void 0&&xt.addToSortKeyRanges(xt.symbolInstances.length,Ar.sortKey),xt.symbolInstances.emplaceBack(Jt.x,Jt.y,El.x,El.y,El.z,_n.right>=0?_n.right:-1,_n.center>=0?_n.center:-1,_n.left>=0?_n.left:-1,_n.vertical>=0?_n.vertical:-1,Us,ao,Pg,ec!==void 0?ec:xt.collisionBoxArray.length,ec!==void 0?ec+1:xt.collisionBoxArray.length,Vo!==void 0?Vo:xt.collisionBoxArray.length,Vo!==void 0?Vo+1:xt.collisionBoxArray.length,iu!==void 0?iu:xt.collisionBoxArray.length,iu!==void 0?iu+1:xt.collisionBoxArray.length,ga||xt.collisionBoxArray.length,ga?ga+1:xt.collisionBoxArray.length,gr,nn,$o,gn,Nr,ru,0,An,sn,Zn,0,Zr?1:0,u0)})(s,_t,Rt,mt,i,a,f,u,s.layers[0],s.collisionBoxArray,e.index,e.sourceLayerIndex,s.index,Je,H,S,0,Qe,it,U,e,m,I,C,k,R,F,$,St,Q,ae,oe)};if(X==="line")for(const mt of kv(e.geometry,0,0,gt,gt)){const _t=E3(mt,et,Ne,i.vertical||Ae,a,24,qe,s.overscaling,gt);for(const Vt of _t)Ae&&j3(s,Ae.text,Ke,Vt)||Et(mt,Vt,k)}else if(X==="line-center"){for(const mt of e.geometry)if(mt.length>1){const _t=T3(mt,Ne,i.vertical||Ae,a,24,qe);_t&&Et(mt,_t,k)}}else if(e.type==="Polygon")for(const mt of Xm(e.geometry,0)){const _t=C3(mt,16);Et(mt[0],new Ql(_t.x,_t.y,0,0,void 0),k)}else if(e.type==="LineString")for(const mt of e.geometry)Et(mt,new Ql(mt[0].x,mt[0].y,0,0,void 0),k);else if(e.type==="Point")for(const mt of e.geometry)for(const _t of mt)Et([_t],new Ql(_t.x,_t.y,0,0,void 0),k)}const Ub=255,Ch=Ub*Jl;function fA(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H){const X=sA(0,a,b,f,m,_,u,s.allowVerticalPlacement,void 0),Q=f.layout.get("text-size").evaluate(_,{},$),ae=R.compositeTextSizes?R.compositeTextSizes[0].evaluate(_,{},$):0,oe=R.compositeTextSizes?R.compositeTextSizes[1].evaluate(_,{},$):0,ge=Vb(s.layerIds[0],s.textSizeData,Q,R.textScaleFactor,ae,oe);s.addSymbols(s.text,X,ge,b,m,_,I,e,i,S.lineStartIndex,S.lineLength,M,F,$,H,!1,U,X.length);for(const ye of C)k[ye]=s.text.placedSymbolArray.length-1;return 4*X.length}function Vb(s,e,i,a,u,f){const m=e;let _=null;return m.kind==="source"?(_=[Jl*i*a],_[0]>Ch&&Kt(`${s}: Value for "text-size" is >= ${Ub}. Reduce your "text-size".`)):m.kind==="composite"&&(_=[Jl*u*a,Jl*f*a],(_[0]>Ch||_[1]>Ch)&&Kt(`${s}: Value for "text-size" is >= ${Ub}. Reduce your "text-size".`)),_}function qv(s){for(const e in s)return s[e];return null}function Zv(s,e,i,a,u,f,m,_,b,S,I){let C,k,M,R;if(C=I?I.top:m.top,k=I?I.bottom:m.bottom,M=I?I.left:m.left,R=I?I.right:m.right,Rb(m)&&m.collisionPadding){const F=m.collisionPadding;M-=F[0],C-=F[1],R+=F[2],k+=F[3]}if(b){const F=new at(M,C),$=new at(R,C),U=new at(M,k),H=new at(R,k),X=Pi(b);let Q=new at(0,0);S&&(Q=new at(S[0],S[1])),F._rotateAround(X,Q),$._rotateAround(X,Q),U._rotateAround(X,Q),H._rotateAround(X,Q),M=Math.min(F.x,$.x,U.x,H.x),R=Math.max(F.x,$.x,U.x,H.x),C=Math.min(F.y,$.y,U.y,H.y),k=Math.max(F.y,$.y,U.y,H.y)}return s.emplaceBack(e.x,e.y,e.z,i.x,i.y,M,C,R,k,_,a,u,f),s.length-1}function $b(s){Rb(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const e=s.bottom-s.top;return e>0?Math.max(10,e):null}function j3(s,e,i,a){const u=s.compareText;if(e in u){const f=u[e];for(let m=f.length-1;m>=0;m--)if(a.dist(f[m])<i)return!0}else u[e]=[];return u[e].push(a),!1}function pA(s,e){const i=s.fovAboveCenter,a=s.elevation?s.elevation.getMinElevationBelowMSL()*e:0,u=(s._camera.position[2]*s.worldSize-a)/Math.cos(s._pitch),f=Math.sin(i)*u/Math.sin(Math.max(Math.PI/2-s._pitch-i,.01));let m=Math.sin(s._pitch)*f+u;const _=u*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let b=Math.max(s.zoom-17,0);s.isOrthographic&&(b/=10),m*=1+b}return Math.min(1.01*m,_)}function mg(s,e){if(!e.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:e};const i=Math.pow(2,-s.z),a=s.x*i,u=(s.x+1)*i,f=s.y*i,m=(s.y+1)*i,_=Ye(a),b=Ye(u),S=nt(f),I=nt(m),C=e.project(_,S),k=e.project(b,S),M=e.project(b,I),R=e.project(_,I);let F=Math.min(C.x,k.x,M.x,R.x),$=Math.min(C.y,k.y,M.y,R.y),U=Math.max(C.x,k.x,M.x,R.x),H=Math.max(C.y,k.y,M.y,R.y);const X=i/16;function Q(oe,ge,ye,me,Se,Ae){const Ze=(ye+Se)/2,Ge=(me+Ae)/2,qe=e.project(Ye(Ze),nt(Ge)),et=Math.max(0,F-qe.x,$-qe.y,qe.x-U,qe.y-H);F=Math.min(F,qe.x),U=Math.max(U,qe.x),$=Math.min($,qe.y),H=Math.max(H,qe.y),et>X&&(Q(oe,qe,ye,me,Ze,Ge),Q(qe,ge,Ze,Ge,Se,Ae))}Q(C,k,a,f,u,f),Q(k,M,u,f,u,m),Q(M,R,u,m,a,m),Q(R,C,a,m,a,f),F-=X,$-=X,U+=X,H+=X;const ae=1/Math.max(U-F,H-$);return{scale:ae,x:F*ae,y:$*ae,x2:U*ae,y2:H*ae,projection:e}}function mA(s,{x:e,y:i},a=0){return new at(((e-a)*s.scale-s.x)*gt,(i*s.scale-s.y)*gt)}const N3=Ee(new Float32Array(16));class eu{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,i){return{x:0,y:0,z:0}}unproject(e,i){return new le(0,0)}projectTilePoint(e,i,a){return{x:e,y:i,z:0}}locationPoint(e,i,a,u=!0){return e._coordinatePoint(e.locationCoordinate(i,a),u)}pixelsPerMeter(e,i){return je(1,e)*i}pixelSpaceConversion(e,i,a){return 1}farthestPixelDistance(e){return pA(e,e.pixelsPerMeter)}pointCoordinate(e,i,a,u){const f=e.horizonLineFromTop(!1),m=new at(i,Math.max(f,a));return e.rayIntersectionCoordinate(e.pointRayIntersection(m,u))}pointCoordinate3D(e,i,a){const u=new at(i,a);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,i){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,i.x,i.y);const a=e.horizonLineFromTop();return i.y<a}createInversionMatrix(e,i){return N3}createTileMatrix(e,i,a){let u,f,m;const _=a.canonical,b=Ee(new Float64Array(16));if(this.isReprojectedInTileSpace){const S=mg(_,this);u=1,f=S.x+a.wrap*S.scale,m=S.y,ke(b,b,[u/S.scale,u/S.scale,e.pixelsPerMeter/i])}else u=i/e.zoomScale(_.z),f=(_.x+Math.pow(2,_.z)*a.wrap)*u,m=_.y*u;return fe(b,b,[f,m,0]),ke(b,b,[u/gt,u/gt,1]),b}upVector(e,i,a){return[0,0,1]}upVectorScale(e,i,a){return{metersToTile:1}}}class U3 extends eu{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[i,a]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(Pi(i));this.n=(u+Math.sin(Pi(a)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,i){const{n:a,c:u,r0:f}=this,m=Pi(e-this.center[0]),_=Pi(i),b=Math.sqrt(u-2*a*Math.sin(_))/a;return{x:b*Math.sin(m*a),y:b*Math.cos(m*a)-f,z:0}}unproject(e,i){const{n:a,c:u,r0:f}=this,m=f+i;let _=Math.atan2(e,Math.abs(m))*Math.sign(m);m*a<0&&(_-=Math.PI*Math.sign(e)*Math.sign(m));const b=Pi(this.center[0])*a;_=Ue(_,-Math.PI-b,Math.PI-b);const S=pe(De(_/a)+this.center[0],-180,180),I=Math.asin(pe((u-(e*e+m*m)*a*a)/(2*a),-1,1)),C=pe(De(I),-85.051129,Ie);return new le(S,C)}}const gg=1.340264,_g=-.081106,yg=893e-6,vg=.003796,Xv=Math.sqrt(3)/2;class V3 extends eu{project(e,i){i=i/180*Math.PI,e=e/180*Math.PI;const a=Math.asin(Xv*Math.sin(i)),u=a*a,f=u*u*u;return{x:.5*(e*Math.cos(a)/(Xv*(gg+3*_g*u+f*(7*yg+9*vg*u)))/Math.PI+.5),y:1-.5*(a*(gg+_g*u+f*(yg+vg*u))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=a*a,f=u*u*u;for(let I,C,k,M=0;M<12&&(C=a*(gg+_g*u+f*(yg+vg*u))-i,k=gg+3*_g*u+f*(7*yg+9*vg*u),I=C/k,a=pe(a-I,-Math.PI/3,Math.PI/3),u=a*a,f=u*u*u,!(Math.abs(I)<1e-12));++M);const m=Xv*e*(gg+3*_g*u+f*(7*yg+9*vg*u))/Math.cos(a),_=Math.asin(Math.sin(a)/Xv),b=pe(180*m/Math.PI,-180,180),S=pe(180*_/Math.PI,-85.051129,Ie);return new le(b,S)}}class $3 extends eu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){return{x:.5+e/360,y:.5-i/360,z:0}}unproject(e,i){const a=360*(e-.5),u=pe(360*(.5-i),-85.051129,Ie);return new le(a,u)}}const mf=Math.PI/2;function Kv(s){return Math.tan((mf+s)/2)}class G3 extends eu{constructor(e){super(e),this.center=e.center||[0,30];const[i,a]=this.parallels=e.parallels||[30,30];let u=Pi(i),f=Pi(a);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const m=Math.cos(u),_=Kv(u);this.n=u===f?Math.sin(u):Math.log(m/Math.cos(f))/Math.log(Kv(f)/_),this.f=m*Math.pow(Kv(u),this.n)/this.n}project(e,i){i=Pi(i),this.southernCenter&&(i=-i),e=Pi(e-this.center[0]);const a=1e-6,{n:u,f}=this;f>0?i<-mf+a&&(i=-mf+a):i>mf-a&&(i=mf-a);const m=f/Math.pow(Kv(i),u);let _=m*Math.sin(u*e),b=f-m*Math.cos(u*e);return _=.5*(_/Math.PI+.5),b=.5*(b/Math.PI+.5),{x:_,y:this.southernCenter?b:1-b,z:0}}unproject(e,i){e=(2*e-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:a,f:u}=this,f=u-i,m=Math.sign(f),_=Math.sign(a)*Math.sqrt(e*e+f*f);let b=Math.atan2(e,Math.abs(f))*m;f*a<0&&(b-=Math.PI*Math.sign(e)*m);const S=pe(De(b/a)+this.center[0],-180,180),I=pe(De(2*Math.atan(Math.pow(u/_,1/a))-mf),-85.051129,Ie);return new le(S,this.southernCenter?-I:I)}}class gA extends eu{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,i){return{x:Oe(e),y:Ve(i),z:0}}unproject(e,i){const a=Ye(e),u=nt(i);return new le(a,u)}}const _A=Pi(Ie);class H3 extends eu{project(e,i){const a=(i=Pi(i))*i,u=a*a;return{x:.5*((e=Pi(e))*(.8707-.131979*a+u*(u*(.003971*a-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+a*(.015085+u*(.028874*a-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,i){e=(2*e-.5)*Math.PI;let a=i=(2*(1-i)-1)*Math.PI,u=25,f=0,m=a*a;do{m=a*a;const S=m*m;f=(a*(1.007226+m*(.015085+S*(.028874*m-.044475-.005916*S)))-i)/(1.007226+m*(.045255+S*(.259866*m-.311325-.005916*11*S))),a=pe(a-f,-_A,_A)}while(Math.abs(f)>1e-6&&--u>0);m=a*a;const _=pe(De(e/(.8707+m*(m*(m*m*m*(.003971-.001529*m)-.013791)-.131979))),-180,180),b=De(a);return new le(_,b)}}const yA=Pi(Ie);class W3 extends eu{project(e,i){i=Pi(i),e=Pi(e);const a=Math.cos(i),u=2/Math.PI,f=Math.acos(a*Math.cos(e/2)),m=Math.sin(f)/f,_=.5*(e*u+2*a*Math.sin(e/2)/m)||0,b=.5*(i+Math.sin(i)/m)||0;return{x:.5*(_/Math.PI+.5),y:1-.5*(b/Math.PI+1),z:0}}unproject(e,i){let a=e=(2*e-.5)*Math.PI,u=i=(2*(1-i)-1)*Math.PI,f=25;const m=1e-6;let _=0,b=0;do{const S=Math.cos(u),I=Math.sin(u),C=2*I*S,k=I*I,M=S*S,R=Math.cos(a/2),F=Math.sin(a/2),$=2*R*F,U=F*F,H=1-M*R*R,X=H?1/H:0,Q=H?Math.acos(S*R)*Math.sqrt(1/H):0,ae=.5*(2*Q*S*F+2*a/Math.PI)-e,oe=.5*(Q*I+u)-i,ge=.5*X*(M*U+Q*S*R*k)+1/Math.PI,ye=X*($*C/4-Q*I*F),me=.125*X*(C*F-Q*I*M*$),Se=.5*X*(k*R+Q*U*S)+.5,Ae=ye*me-Se*ge;_=(oe*ye-ae*Se)/Ae,b=(ae*me-oe*ge)/Ae,a=pe(a-_,-Math.PI,Math.PI),u=pe(u-b,-yA,yA)}while((Math.abs(_)>m||Math.abs(b)>m)&&--f>0);return new le(De(a),De(u))}}class vA extends eu{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Pi(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,i){const{scale:a,cosPhi:u}=this;return{x:Pi(e)*u*a+.5,y:-Math.sin(Pi(i))/u*a+.5,z:0}}unproject(e,i){const{scale:a,cosPhi:u}=this,f=-(i-.5)/a,m=pe(De((e-.5)/a)/u,-180,180),_=Math.asin(pe(f*u,-1,1)),b=pe(De(_),-85.051129,Ie);return new le(m,b)}}class q3 extends gA{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,i,a){const u=$m(e,i,a);return or(u,u,_v(xl(a))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,i,a){const u=_e(i.lat,i.lng),f=Si([],u),m=a?e._centerAltitude+a:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(i),e._centerAltitude):e._centerAltitude;di(u,u,f,je(1,0)*gt*m);const _=Ee(new Float64Array(16));return K(_,e.pixelMatrix,e.globeMatrix),or(u,u,_),new at(u[0],u[1])}pixelsPerMeter(e,i){return je(1,0)*i}pixelSpaceConversion(e,i,a){const u=je(1,e)*i,f=qt(je(1,45)*i,u,a);return this.pixelsPerMeter(e,i)/f}createTileMatrix(e,i,a){const u=N1(xl(a.canonical));return K(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,i){const{center:a}=e,u=_v(xl(i));return Le(u,u,Pi(a.lng)),Be(u,u,Pi(a.lat)),ke(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,i,a,u){return R2(e,i,a,!0)||new yt(0,0)}pointCoordinate3D(e,i,a){const u=this.pointCoordinate(e,i,a,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,i){return!R2(e,i.x,i.y,!1)}farthestPixelDistance(e){const i=function(u,f){const m=u.cameraToCenterDistance,_=u._centerAltitude*f,b=u._camera,S=u._camera.forward(),I=Tt([],Ot([],S,-m),[0,0,_]),C=u.worldSize/(2*Math.PI),k=[0,0,-C],M=u.width/u.height,R=Math.tan(u.fovAboveCenter),F=Ot([],b.up(),R),$=Ot([],b.right(),R*M),U=Si([],Tt([],Tt([],S,F),$)),H=[];let X;if(new nr(I,U).closestPointOnSphere(k,C,H)){const Q=Tt([],H,k),ae=Dr([],Q,I);X=Math.cos(u.fovAboveCenter)*vi(ae)}else{const Q=Dr([],I,k),ae=Dr([],k,I);Si(ae,ae);const oe=vi(Q)-C;X=Math.sqrt(oe*(oe+2*C));const ge=Math.acos(X/(C+oe))-Math.acos(Qt(S,ae));X*=Math.cos(ge)}return 1.01*X}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),a=Zc(e.zoom);if(a>0){const u=pA(e,je(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),m=Math.max(e.width,e.height)/e.worldSize*Math.PI;return qt(i,u+f*(1-Math.cos(m)),Math.pow(a,10))}return i}upVector(e,i,a){return $m(i,a,e,1)}upVectorScale(e){return{metersToTile:pv(gv(xl(e)))}}}function xA(s){const e=s.parallels,i=!!e&&Math.abs(e[0]+e[1])<.01;switch(s.name){case"mercator":return new gA(s);case"equirectangular":return new $3(s);case"naturalEarth":return new H3(s);case"equalEarth":return new V3(s);case"winkelTripel":return new W3(s);case"albers":return i?new vA(s):new U3(s);case"lambertConformalConic":return i?new vA(s):new G3(s);case"globe":return new q3(s)}throw new Error(`Invalid projection name: ${s.name}`)}const Z3=Ti.types,X3=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function xg(s,e,i,a,u,f,m,_,b,S,I,C,k){const M=_?Math.min(Ch,Math.round(_[0])):0,R=_?Math.min(Ch,Math.round(_[1])):0;s.emplaceBack(e,i,Math.round(32*a),Math.round(32*u),f,m,(M<<1)+(b?1:0),0+(R<<1),16*S,16*I,256*C,256*k)}function bg(s,e,i){s.emplaceBack(e,i)}function wg(s,e,i,a,u,f,m){s.emplaceBack(e,i,a,u,f,m)}const Yv=(s,e,i,a)=>{for(let u=0;u<e;u++)s.emplaceBack(i[0],i[1],i[2],a[0],a[1],a[2])};function gf(s,e,i,a,u){s.emplaceBack(e,i,a,u),s.emplaceBack(e,i,a,u),s.emplaceBack(e,i,a,u),s.emplaceBack(e,i,a,u)}function K3(s){for(const e of s.sections)if(pl(e.text))return!0;return!1}class Gb{constructor(e){this.layoutVertexArray=new Dm,this.indexArray=new en,this.programConfigurations=e,this.segments=new xr,this.dynamicLayoutVertexArray=new vl,this.opacityVertexArray=new zm,this.placedSymbolArray=new Qy,this.iconTransitioningVertexArray=new Qs,this.globeExtVertexArray=new Om,this.zOffsetVertexArray=new Tn,this.orientationVertexArray=new Zd,this.symbolInstanceIndices=[]}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}getSymbolVertexData(e,i){const a=[],u=this.layoutVertexArray.uint16;for(let f=0;f<i;++f){const m=12*(e+f);a.push(...u.slice(m,m+12))}return a}updateSymbolVertexData(e,i,a,u,f,m,_,b,S,I,C,k,M){const R=this.layoutVertexArray.uint16,F=12*e;R[F]=i,R[F+1]=a,R[F+2]=u,R[F+3]=f,R[F+4]=m,R[F+5]=_,R[F+6]=b,R[F+7]=S,R[F+8]=I,R[F+9]=C,R[F+10]=k,R[F+11]=M}upload(e,i,a,u,f,m){this.isEmpty()||(a&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Jz.members,!!m),this.indexBuffer=e.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,e3.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,X3,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,r3.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Qz.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||f)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,t3.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,i3.members,!0)),this.opacityVertexBuffer.itemSize=1),(a||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Ct(Gb,"SymbolBuffers");class Hb{constructor(e,i,a){this.layoutVertexArray=new e,this.layoutAttributes=i,this.indexArray=new a,this.segments=new xr,this.collisionVertexArray=new qd,this.collisionVertexArrayExt=new vl}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,n3.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,s3.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Ct(Hb,"CollisionBuffers");class Jv{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(m=>m.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ee([]),this.placementViewportMatrix=Ee([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=Ah(this.zoom,i["text-size"],this.worldview,e.availableImages),this.iconSizeData=Ah(this.zoom,i["icon-size"],this.worldview,e.availableImages);const a=this.layers[0].layout,u=a.get("symbol-sort-key"),f=a.get("symbol-z-order");this.lut=e.lut,this.canOverlap=a.get("text-allow-overlap")||a.get("icon-allow-overlap")||a.get("text-ignore-placement")||a.get("icon-ignore-placement"),this.sortFeaturesByKey=f!=="viewport-y"&&u.constantOr(1)!==void 0,this.sortFeaturesByY=(f==="viewport-y"||f==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=a.get("text-writing-mode").map(m=>so[m]),this.stateDependentLayerIds=this.layers.filter(m=>m.isStateDependent()).map(m=>m.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const i=this.layers[0].getAppearances();if(!i||i.length===0)return!1;const a=Array.isArray(e)?e:[e];return i.some(u=>a.some(f=>u.getProperty(f)!=null))}createArrays(){this.text=new Gb(new P(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Gb(new P(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new mh,this.lineVertexArray=new iv,this.symbolInstances=new tv}calculateGlyphDependencies(e,i,a,u,f){for(const m of e){const _=m.codePointAt(0);if(_===void 0)break;if(i[_]=!0,u&&f&&_<=65535){const b=ug[m];b&&(i[b.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,i,a,u,f,m,_){if(!e.hasProperty("icon-size"))return _*m;let b=1;const S=e.getUnevaluatedProperties()._values["icon-size"],I=Ah(this.zoom,S,this.worldview,f),C=df(I,i);if(I.kind!=="constant"&&I.kind!=="camera"||(b=C.uSize),I.kind==="composite"){const{minZoom:k,maxZoom:M}=I,R=S.possiblyEvaluate(new Yi(k,{worldview:this.worldview}),u),F=S.possiblyEvaluate(new Yi(M,{worldview:this.worldview}),u),$=R.evaluate(a,{},u,f);b=$+(F.evaluate(a,{},u,f)-$)*C.uSizeT}return I.kind==="source"&&(b=S.possiblyEvaluate(new Yi(this.zoom,{worldview:this.worldview}),u).evaluate(a,{},u,f)),b*m}updateFootprints(e,i){}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Iv(this.activeReplacements,a)&&(this.activeReplacements=a,!0)}getResolvedImageFromTokens(e){return typeof e=="string"?xs.build(e):e}populate(e,i,a,u){const f=this.layers[0],m=f.layout,_=this.projection.name==="globe",b=m.get("text-font"),S=m.get("text-field"),I=m.get("icon-image"),[C,k]=m.get("icon-size-scale-range"),M=pe(i.scaleFactor||1,C,k),R=(S.value.kind!=="constant"||S.value.value instanceof Wn&&!S.value.value.isEmpty()||S.value.value.toString().length>0)&&(b.value.kind!=="constant"||b.value.value.length>0),F=I.value.kind!=="constant"||!!I.value.value||Object.keys(I.parameters).length>0,$=this.hasAnyAppearanceProperty("icon-image"),U=m.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!R&&!F&&!$)return;const H=i.iconDependencies,X=i.glyphDependencies,Q=i.availableImages,ae=new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),oe=ge=>{const ye=ge.id.toString();H.has(ye)?H.get(ye).push(ge):H.set(ye,[ge])};for(const ge of e){const{feature:ye,id:me,index:Se,sourceLayerIndex:Ae}=ge,Ze=f._featureFilter.needGeometry,Ge=ci(ye,Ze);if(!f._featureFilter.filter(ae,Ge,a))continue;if(Ze||(Ge.geometry=Xt(ye,a,u)),_&&ye.type!==1&&a.z<=5){const rt=Ge.geometry,tt=.98078528056,St=(Et,mt)=>Qt($m(Et.x,Et.y,a,1),$m(mt.x,mt.y,a,1))<tt;for(let Et=0;Et<rt.length;Et++)rt[Et]=Lt(rt[Et],St)}let qe,et;if(R){const rt=f.getValueAndResolveTokens("text-field",Ge,a,Q),tt=Wn.factory(rt);K3(tt)&&(this.hasRTLText=!0),(!this.hasRTLText||bm()==="unavailable"||this.hasRTLText&&jo.isParsed())&&(qe=a3(tt,f,Ge))}if(F){const rt=f.getValueAndResolveTokens("icon-image",Ge,a,Q);et=this.getResolvedImageFromTokens(rt)}const Je=this.layers[0];let Qe=!1;if(!et&&$){const rt=Je.getAppearances();for(const tt of rt)if(tt.getProperty("icon-image")){const St=Je.getAppearanceValueAndResolveTokens(tt,"icon-image",Ge,a,Q);if(St){et=this.getResolvedImageFromTokens(St),Qe=!0;break}}}if(!qe&&!et)continue;const Ne=this.sortFeaturesByKey?U.evaluate(Ge,{},a):void 0,it={id:me,text:qe,icon:et,index:Se,sourceLayerIndex:Ae,geometry:Ge.geometry,properties:ye.properties,type:Z3[ye.type],sortKey:Ne};if(this.features.push(it),this.featureToAppearanceIndex[Se]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:me,properties:ye.properties,usesAppearanceIconAsPlaceholder:Qe,isUsingAppearanceIconVertexData:!1,isUsingAppearanceTextVertexData:!1,layoutBasedIconVertexData:[],layoutBasedTextVertexData:[],activeAppearance:null}),et){const rt=Je._unevaluatedLayout._values,{iconPrimary:tt,iconSecondary:St}=pg(et,this.iconSizeData,rt["icon-size"],a,this.zoom,it,this.pixelRatio,M,this.worldview,Q);oe(tt),St&&(this.hasAnySecondaryIcon=!0,oe(St))}const Ke=Je.getAppearances();if(Ke.length!==0&&Ke.forEach(rt=>{if(!rt.getProperty("icon-image"))return;const tt=this.getCombinedIconPrimary(rt,Je,Ge,a,Q,it,M);tt&&oe(tt)}),qe){const rt=b.evaluate(Ge,{},a).join(","),tt=m.get("text-rotation-alignment")==="map"&&m.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(so.vertical)>=0;for(const St of qe.sections)if(St.image){const Et=St.image.getPrimary().scaleSelf(this.pixelRatio),mt=Et.id.toString(),_t=H.get(mt)||[];_t.push(Et),H.set(mt,_t)}else{const Et=_m(qe.toString()),mt=St.fontStack||rt,_t=X[mt]=X[mt]||{};this.calculateGlyphDependencies(St.text,_t,tt,this.allowVerticalPlacement,Et)}}}if(m.get("symbol-placement")==="line"&&(this.features=function(ge){const ye={},me={},Se=[];let Ae=0;function Ze(Je){Se.push(ge[Je]),Ae++}function Ge(Je,Qe,Ne){const it=me[Je];return delete me[Je],me[Qe]=it,Se[it].geometry[0].pop(),Se[it].geometry[0]=Se[it].geometry[0].concat(Ne[0]),it}function qe(Je,Qe,Ne){const it=ye[Qe];return delete ye[Qe],ye[Je]=it,Se[it].geometry[0].shift(),Se[it].geometry[0]=Ne[0].concat(Se[it].geometry[0]),it}function et(Je,Qe,Ne){const it=Ne?Qe[0][Qe[0].length-1]:Qe[0][0];return`${Je}:${it.x}:${it.y}`}for(let Je=0;Je<ge.length;Je++){const Qe=ge[Je],Ne=Qe.geometry,it=Qe.text?Qe.text.toString():null;if(!it){Ze(Je);continue}const Ke=et(it,Ne),rt=et(it,Ne,!0);if(Ke in me&&rt in ye&&me[Ke]!==ye[rt]){const tt=qe(Ke,rt,Ne),St=Ge(Ke,rt,Se[tt].geometry);delete ye[Ke],delete me[rt],me[et(it,Se[St].geometry,!0)]=St,Se[tt].geometry=null}else Ke in me?Ge(Ke,rt,Ne):rt in ye?qe(Ke,rt,Ne):(Ze(Je),ye[Ke]=Ae-1,me[rt]=Ae-1)}return Se.filter(Je=>Je.geometry)}(this.features)),m.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const ge of i.elevationFeatures)this.elevationFeatureIdToIndex.set(ge.id,this.elevationFeatures.length),this.elevationFeatures.push(ge)}}else m.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((ge,ye)=>ge.sortKey-ye.sortKey)}getCombinedIconPrimary(e,i,a,u,f,m,_){let b,S;const I=e.getUnevaluatedProperties();if(I._values["icon-image"].value!==void 0){const C=i.getAppearanceValueAndResolveTokens(e,"icon-image",a,u,f);b=this.getResolvedImageFromTokens(C)}else{const C=i.getValueAndResolveTokens("icon-image",a,u,f);b=this.getResolvedImageFromTokens(C)}if(b){const C=e.hasProperty("icon-size")?I._values["icon-size"]:i._unevaluatedLayout._values["icon-size"];S=pg(b,Ah(this.zoom,C,this.worldview,f),C,u,this.zoom,m,this.pixelRatio,_,this.worldview,f).iconPrimary}return S}updateSymbolInstanceIconVertices(e,i,a,u,f,m,_,b,S,I,C,k,M,R){if(e.placedIconSymbolIndex<0)return{vertexOffsetDelta:0,hasChanges:!1};if(i.activeAppearance===a)return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1};if(a){const F=this.getCombinedIconPrimary(a,S,u,m,_,{sortKey:void 0,text:void 0,icon:null,index:e.featureIndex,sourceLayerIndex:e.featureIndex,geometry:[],properties:i.properties,type:"Point",id:i.id},I);if(!F)return{vertexOffsetDelta:0,hasChanges:!1};const $=F.toString(),U=this.iconAtlasPositions&&this.iconAtlasPositions.get($);if(U){const{appearanceIconOffset:H,appearanceIconRotate:X}=aA(a,S,u,m,k,R,M,I);let Q=Vv(U,void 0,H,S.layout.get("icon-anchor").evaluate(u,C,m));const ae=U.sdf,oe=S.layout.get("icon-text-fit").constantOr("none");oe!=="none"&&i.textShaping&&i.iconTextFitPadding&&i.fontScale&&(Q=Db(Q,i.textShaping,oe,i.iconTextFitPadding,H,i.fontScale));const ge=this.calculateEffectiveAppearanceIconSize(a,b.zoom,u,m,_,I,M),ye=0,me=1+(Math.min(Ch,Math.round(ge*Jl))<<1),Se=Fb(Q,X,ae,oe!=="none",I);i.isUsingAppearanceIconVertexData||(i.isUsingAppearanceIconVertexData=!0,i.layoutBasedIconVertexData=this.icon.getSymbolVertexData(f,e.numIconVertices));let Ae=f;for(let Ge=0;Ge<Se.length;++Ge){const qe=Se[Ge],et=i.layoutBasedIconVertexData[0]||e.tileAnchorX,Je=i.layoutBasedIconVertexData[1]||e.tileAnchorY,Qe=16*qe.pixelOffsetTL.x,Ne=16*qe.pixelOffsetTL.y,it=16*qe.pixelOffsetBR.x,Ke=16*qe.pixelOffsetBR.y,rt=16*qe.minFontScaleX,tt=16*qe.minFontScaleY;this.icon.updateSymbolVertexData(Ae,et,Je,Math.round(32*qe.tl.x),Math.round(32*qe.tl.y),qe.texPrimary.x,qe.texPrimary.y,ye,me,Qe,Ne,rt,tt),this.icon.updateSymbolVertexData(Ae+1,et,Je,Math.round(32*qe.tr.x),Math.round(32*qe.tr.y),qe.texPrimary.x+qe.texPrimary.w,qe.texPrimary.y,ye,me,it,Ne,rt,tt),this.icon.updateSymbolVertexData(Ae+2,et,Je,Math.round(32*qe.bl.x),Math.round(32*qe.bl.y),qe.texPrimary.x,qe.texPrimary.y+qe.texPrimary.h,ye,me,Qe,Ke,rt,tt),this.icon.updateSymbolVertexData(Ae+3,et,Je,Math.round(32*qe.br.x),Math.round(32*qe.br.y),qe.texPrimary.x+qe.texPrimary.w,qe.texPrimary.y+qe.texPrimary.h,ye,me,it,Ke,rt,tt),Ae+=4}const Ze=e.numIconVertices-4*Se.length;for(let Ge=0;Ge<Ze;++Ge)this.icon.updateSymbolVertexData(Ae+Ge,0,0,0,0,0,0,0,0,0,0,0,0);return{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}}else if(i.usesAppearanceIconAsPlaceholder){if(this.layers[0].appearances&&this.layers[0].appearances.length>0)return this.icon.updateSymbolVertexData(f,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateSymbolVertexData(f+3,0,0,0,0,0,0,0,0,0,0,0,0),{vertexOffsetDelta:e.numIconVertices,hasChanges:!0}}else if(i.isUsingAppearanceIconVertexData){const $=i.layoutBasedIconVertexData.length/12;for(let U=0;U<$;++U){const H=U*12;this.icon.updateSymbolVertexData(f+U,i.layoutBasedIconVertexData[H+0],i.layoutBasedIconVertexData[H+1],i.layoutBasedIconVertexData[H+2],i.layoutBasedIconVertexData[H+3],i.layoutBasedIconVertexData[H+4],i.layoutBasedIconVertexData[H+5],i.layoutBasedIconVertexData[H+6],i.layoutBasedIconVertexData[H+7],i.layoutBasedIconVertexData[H+8],i.layoutBasedIconVertexData[H+9],i.layoutBasedIconVertexData[H+10],i.layoutBasedIconVertexData[H+11])}return i.isUsingAppearanceIconVertexData=!1,{vertexOffsetDelta:$,hasChanges:!0}}return{vertexOffsetDelta:e.numIconVertices,hasChanges:!1}}updateSymbolInstanceTextVertices(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H){const X=e.numHorizontalGlyphVertices>0||e.numVerticalGlyphVertices>0;if(!X)return{vertexOffsetDelta:X?e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices:0,hasChanges:!1};if(i.activeAppearance===a)return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1};if(a&&i.textShaping){const{appearanceTextOffset:Q,appearanceTextRotate:ae,appearanceTextSize:oe}=lA(a,_,u,m,C,M,k);i.fontScale=dA(oe,i.textScaleFactor);const ge=a.getUnevaluatedProperty("text-size");let ye=this.textSizeData,me=$,Se=U;a.hasProperty("text-size")&&(ye=Ah(this.zoom,ge,this.worldview,H),me=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,Se=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0);const Ae=i.textShaping.bottom-C[1],Ze=i.textShaping.left-C[0],Ge=i.textShaping.right-C[0];i.textShaping.top=Q[1]+(i.textShaping.top-C[1]),i.textShaping.bottom=Q[1]+Ae,i.textShaping.left=Q[0]+Ze,i.textShaping.right=Q[0]+Ge;const qe=sA(0,i.textShaping,Q,_,!1,u,S,this.allowVerticalPlacement,ae),et=oe&&ye.kind==="composite"?ge.possiblyEvaluate(new Yi(me,{}),m).evaluate(u,I,m):R,Je=oe&&ye.kind==="composite"?ge.possiblyEvaluate(new Yi(Se,{}),m).evaluate(u,I,m):F,Qe=Vb(a.name,ye,oe,b,et,Je),Ne=Array.isArray(Qe)?Qe[1]:oe,it=0,Ke=1+(Math.min(Ch,Math.round(Ne*Jl))<<1);i.isUsingAppearanceTextVertexData||(i.isUsingAppearanceTextVertexData=!0,i.layoutBasedTextVertexData=this.text.getSymbolVertexData(f,e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices));for(let rt=0;rt<qe.length&&rt<(e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices)/4;++rt){const tt=qe[rt],St=tt.glyphOffset[1],Et=e.tileAnchorX,mt=e.tileAnchorY,_t=f+4*rt;this.text.updateSymbolVertexData(_t,Et,mt,Math.round(32*tt.tl.x),Math.round(32*(St+tt.tl.y)),tt.texPrimary.x,tt.texPrimary.y,it,Ke,tt.pixelOffsetTL.x,tt.pixelOffsetTL.y,tt.minFontScaleX,tt.minFontScaleY),this.text.updateSymbolVertexData(_t+1,Et,mt,Math.round(32*tt.tr.x),Math.round(32*(St+tt.tr.y)),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y,it,Ke,tt.pixelOffsetBR.x,tt.pixelOffsetTL.y,tt.minFontScaleX,tt.minFontScaleY),this.text.updateSymbolVertexData(_t+2,Et,mt,Math.round(32*tt.bl.x),Math.round(32*(St+tt.bl.y)),tt.texPrimary.x,tt.texPrimary.y+tt.texPrimary.h,it,Ke,tt.pixelOffsetTL.x,tt.pixelOffsetBR.y,tt.minFontScaleX,tt.minFontScaleY),this.text.updateSymbolVertexData(_t+3,Et,mt,Math.round(32*tt.br.x),Math.round(32*(St+tt.br.y)),tt.texPrimary.x+tt.texPrimary.w,tt.texPrimary.y+tt.texPrimary.h,it,Ke,tt.pixelOffsetBR.x,tt.pixelOffsetBR.y,tt.minFontScaleX,tt.minFontScaleY)}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!0}}if(i.isUsingAppearanceTextVertexData){const ae=i.layoutBasedTextVertexData.length/12;for(let oe=0;oe<ae;++oe){const ge=oe*12;this.text.updateSymbolVertexData(f+oe,i.layoutBasedTextVertexData[ge+0],i.layoutBasedTextVertexData[ge+1],i.layoutBasedTextVertexData[ge+2],i.layoutBasedTextVertexData[ge+3],i.layoutBasedTextVertexData[ge+4],i.layoutBasedTextVertexData[ge+5],i.layoutBasedTextVertexData[ge+6],i.layoutBasedTextVertexData[ge+7],i.layoutBasedTextVertexData[ge+8],i.layoutBasedTextVertexData[ge+9],i.layoutBasedTextVertexData[ge+10],i.layoutBasedTextVertexData[ge+11])}return i.isUsingAppearanceTextVertexData=!1,{vertexOffsetDelta:ae,hasChanges:!0}}return{vertexOffsetDelta:e.numHorizontalGlyphVertices+e.numVerticalGlyphVertices,hasChanges:!1}}update(e,i,a,u,f,m,_){this.text.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,i,f,a,u,m,_,this.worldview)}updateRoadElevation(e){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const a=ht(e),u=1/a;let f=!1,m=!1;for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_),S=ei(1,0,0),I=ei(0,1,0),{numHorizontalGlyphVertices:C,numVerticalGlyphVertices:k,numIconVertices:M,numVerticalIconVertices:R}=b,F=C>0||k>0,$=M>0,U=this.elevationFeatures[b.elevationFeatureIndex];if(U){const H=new at(b.tileAnchorX,b.tileAnchorY),X=.075+U.pointElevation(H);b.zOffset!==X&&(i=!0,b.zOffset=X),X!==0&&(this.hasAnyZOffset=!0);const Q=U.computeSlopeNormal(H,u),ae=go(po(),ei(0,0,1),Q);ar(S,S,ae),ar(I,I,ae),S[2]*=a,I[2]*=a,S[0]===1&&S[1]===0&&S[2]===0&&I[0]===0&&I[1]===1&&I[2]===0||(f=f||F,m=m||$)}if(F&&(Yv(this.text.orientationVertexArray,C,S,I),Yv(this.text.orientationVertexArray,k,S,I)),$){const{placedIconSymbolIndex:H,verticalPlacedIconSymbolIndex:X}=b;H>=0&&Yv(this.icon.orientationVertexArray,M,S,I),X>=0&&Yv(this.icon.orientationVertexArray,R,S,I)}}f||(this.text.orientationVertexArray=void 0),m||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(f,m,_)=>{a+=m,a>f.length&&f.resize(a);for(let b=-m;b<0;b++)f.emplace(b+a,_)},i=(f,m,_)=>{u+=m,u>f.length&&f.resize(u);for(let b=-m;b<0;b++)f.emplace(b+u,_)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let a=0,u=0;for(let f=0;f<this.symbolInstances.length;f++){const m=this.symbolInstances.get(f),{numHorizontalGlyphVertices:_,numVerticalGlyphVertices:b,numIconVertices:S}=m,I=m.zOffset,C=S>0;if((_>0||b>0)&&(e(this.text.zOffsetVertexArray,_,I),e(this.text.zOffsetVertexArray,b,I)),C){const{placedIconSymbolIndex:k,verticalPlacedIconSymbolIndex:M}=m;k>=0&&i(this.icon.zOffsetVertexArray,S,I),M>=0&&i(this.icon.zOffsetVertexArray,m.numVerticalIconVertices,I)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,i,a,u,f){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.hasAppearances===null&&(this.hasAppearances=this.layers.some(m=>m.appearances&&m.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,i,a,u,f){if(!(e&&i&&a&&this.appearanceFeatureData))return!1;const m=this.icon.layoutVertexArray&&this.icon.layoutVertexArray.length>0&&this.icon.layoutVertexArray.arrayBuffer,_=this.text.layoutVertexArray&&this.text.layoutVertexArray.length>0&&this.text.layoutVertexArray.arrayBuffer;if(!m&&!_)return!1;const b=this.layers[0],S=b.layout;let I=1,C=0,k=!1;if(m){const[U,H]=S.get("icon-size-scale-range");I=pe(1,U,H)}let M=1,R=0,F=!1;if(_){const[U,H]=S.get("text-size-scale-range");M=pe(1,U,H)}const $=new Map;if(f&&a)for(const U of a){const H=f.getImage(U,b.scope);if(H){const X=new vs(U.toString());$.set(X.toString(),H)}}for(let U=0;U<this.symbolInstances.length;U++){const H=this.symbolInstances.get(U),X=this.featureToAppearanceIndex[H.featureIndex],Q=X!==void 0?this.appearanceFeatureData[X]:void 0;if(!Q)continue;const ae=Q.id,oe=i&&ae!==void 0?i[String(ae)]:void 0,ge={type:"Point",id:Q.id,properties:Q.properties,geometry:[]},ye=b.appearances&&b.appearances.find(me=>me.isActive({globals:u,feature:ge,canonical:e,featureState:oe}));if(_){const me=S.get("text-size"),Se=S.get("text-offset").evaluate(ge,oe,e),Ae=me.evaluate(ge,oe,e),Ze=S.get("text-rotate").evaluate(ge,oe,e),Ge=this.textSizeData.kind==="composite"?this.textSizeData.minZoom:0,qe=this.textSizeData.kind==="composite"?this.textSizeData.maxZoom:0,et=me.evaluate(ge,{zoom:Ge},e),Je=me.evaluate(ge,{zoom:qe},e),Qe=this.updateSymbolInstanceTextVertices(H,Q,ye,ge,R,e,b,M,$,oe,Se,Ae,Ze,et,Je,Ge,qe,a);R+=Qe.vertexOffsetDelta,F=F||Qe.hasChanges}if(m){const me=S.get("icon-offset").evaluate(ge,oe,e),Se=S.get("icon-size").evaluate(ge,oe,e,a),Ae=S.get("icon-rotate").evaluate(ge,oe,e),Ze=this.updateSymbolInstanceIconVertices(H,Q,ye,ge,C,e,a,u,b,I,oe,me,Se,Ae);C+=Ze.vertexOffsetDelta,k=k||Ze.hasChanges}Q.activeAppearance=ye}return k&&this.icon.layoutVertexBuffer&&this.icon.layoutVertexArray.arrayBuffer!==null&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray),F&&this.text.layoutVertexBuffer&&this.text.layoutVertexArray.arrayBuffer!==null&&this.text.layoutVertexArray.length===this.text.layoutVertexBuffer.length&&this.text.layoutVertexBuffer.updateData(this.text.layoutVertexArray),k||F}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=xA(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,i){const a=this.lineVertexArray.length;if(e.segment!==void 0)for(const{x:u,y:f}of i)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:a,lineLength:this.lineVertexArray.length-a}}addSymbols(e,i,a,u,f,m,_,b,S,I,C,k,M,R,F,$,U,H){const X=e.indexArray,Q=e.layoutVertexArray,ae=e.globeExtVertexArray,oe=e.segments.prepareSegment(4*H,Q,X,this.canOverlap?m.sortKey:void 0),ge=this.glyphOffsetArray.length,ye=oe.vertexLength,me=this.allowVerticalPlacement&&_===so.vertical?Math.PI/2:0,Se=m.text&&m.text.sections;for(let Ge=0;Ge<i.length;Ge++){const{tl:qe,tr:et,bl:Je,br:Qe,texPrimary:Ne,texSecondary:it,pixelOffsetTL:Ke,pixelOffsetBR:rt,minFontScaleX:tt,minFontScaleY:St,glyphOffset:Et,isSDF:mt,sectionIndex:_t}=i[Ge],Vt=oe.vertexLength,Rt=Et[1];if(xg(Q,S.x,S.y,qe.x,Rt+qe.y,Ne.x,Ne.y,a,mt,Ke.x,Ke.y,tt,St),xg(Q,S.x,S.y,et.x,Rt+et.y,Ne.x+Ne.w,Ne.y,a,mt,rt.x,Ke.y,tt,St),xg(Q,S.x,S.y,Je.x,Rt+Je.y,Ne.x,Ne.y+Ne.h,a,mt,Ke.x,rt.y,tt,St),xg(Q,S.x,S.y,Qe.x,Rt+Qe.y,Ne.x+Ne.w,Ne.y+Ne.h,a,mt,rt.x,rt.y,tt,St),b){const{x:xt,y:Jt,z:yi}=b.anchor,[Bi,mi,Ji]=b.up;wg(ae,xt,Jt,yi,Bi,mi,Ji),wg(ae,xt,Jt,yi,Bi,mi,Ji),wg(ae,xt,Jt,yi,Bi,mi,Ji),wg(ae,xt,Jt,yi,Bi,mi,Ji),gf(e.dynamicLayoutVertexArray,xt,Jt,yi,me)}else gf(e.dynamicLayoutVertexArray,S.x,S.y,S.z,me);if($){const xt=it||Ne;bg(e.iconTransitioningVertexArray,xt.x,xt.y),bg(e.iconTransitioningVertexArray,xt.x+xt.w,xt.y),bg(e.iconTransitioningVertexArray,xt.x,xt.y+xt.h),bg(e.iconTransitioningVertexArray,xt.x+xt.w,xt.y+xt.h)}X.emplaceBack(Vt,Vt+1,Vt+2),X.emplaceBack(Vt+1,Vt+2,Vt+3),oe.vertexLength+=4,oe.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Et[0]),Ge!==i.length-1&&_t===i[Ge+1].sectionIndex||e.programConfigurations.populatePaintArrays(Q.length,m,m.index,{},M,R,F,Se&&Se[_t],this.worldview)}const Ae=H-i.length;Ae!==0&&this._addNullVertices(Ae,Q,a,b,ae,e,$,oe,X);const Ze=b?b.anchor:S;e.placedSymbolArray.emplaceBack(Ze.x,Ze.y,Ze.z,S.x,S.y,ge,this.glyphOffsetArray.length-ge,ye,I,C,S.segment,a?a[0]:0,a?a[1]:0,u[0],u[1],_,0,0,0,k,0),e.symbolInstanceIndices.push(U)}_addNullVertices(e,i,a,u,f,m,_,b,S){for(let I=0;I<e;I++){for(let k=0;k<4;k++)xg(i,0,0,0,0,0,0,a,!1,0,0,0,0),u&&wg(f,0,0,0,0,0,0),gf(m.dynamicLayoutVertexArray,0,0,0,0),_&&bg(m.iconTransitioningVertexArray,0,0);const C=b.vertexLength;S.emplaceBack(C,C+1,C+2),S.emplaceBack(C+1,C+2,C+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,i,a,u,f,m,_){e.emplaceBack(i,a,u,f,m,Math.round(_.x),Math.round(_.y))}_addCollisionDebugVertices(e,i,a,u,f,m,_){const b=a.segments.prepareSegment(4,a.layoutVertexArray,a.indexArray),S=b.vertexLength,I=_.tileAnchorX,C=_.tileAnchorY;for(let M=0;M<4;M++)a.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(a.collisionVertexArrayExt,i,e.padding,_.zOffset),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,I,C,new at(e.x1,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,I,C,new at(e.x2,e.y1)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,I,C,new at(e.x2,e.y2)),this._commitLayoutVertex(a.layoutVertexArray,u,f,m,I,C,new at(e.x1,e.y2)),b.vertexLength+=4;const k=a.indexArray;k.emplaceBack(S,S+1),k.emplaceBack(S+1,S+2),k.emplaceBack(S+2,S+3),k.emplaceBack(S+3,S),b.primitiveLength+=4}_addTextDebugCollisionBoxes(e,i,a,u,f,m){for(let _=u;_<f;_++){const b=a.get(_),S=this.getSymbolInstanceTextSize(e,m,i,_);this._addCollisionDebugVertices(b,S,this.textCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}_addIconDebugCollisionBoxes(e,i,a,u,f,m){for(let _=u;_<f;_++){const b=a.get(_),S=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._addCollisionDebugVertices(b,S,this.iconCollisionBox,b.projectedAnchorX,b.projectedAnchorY,b.projectedAnchorZ,m)}}generateCollisionDebugBuffers(e,i,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Hb(Hd,OI.members,Qs),this.iconCollisionBox=new Hb(Hd,OI.members,Qs);const u=df(this.iconSizeData,e),f=df(this.textSizeData,e,a);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(f,e,i,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(f,e,i,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,i,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(u,e,i,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,i,a,u){const f=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:u),m=Ob(this.textSizeData,e,f)/mn;return this.tilePixelRatio*m}getSymbolInstanceIconSize(e,i,a){const u=this.icon.placedSymbolArray.get(a),f=Ob(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,i,a,u){e.emplaceBack(i,-a,-a,u),e.emplaceBack(i,a,-a,u),e.emplaceBack(i,a,a,u),e.emplaceBack(i,-a,a,u)}_updateTextDebugCollisionBoxes(e,i,a,u,f,m,_){for(let b=u;b<f;b++){const S=a.get(b),I=this.getSymbolInstanceTextSize(e,m,i,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,I,S.padding,m.zOffset)}}_updateIconDebugCollisionBoxes(e,i,a,u,f,m,_){for(let b=u;b<f;b++){const S=a.get(b),I=this.getSymbolInstanceIconSize(e,i,m.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,I,S.padding,m.zOffset)}}updateCollisionDebugBuffers(e,i,a,u){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const f=df(this.iconSizeData,e,u),m=df(this.textSizeData,e,a);for(let _=0;_<this.symbolInstances.length;_++){const b=this.symbolInstances.get(_);this._updateTextDebugCollisionBoxes(m,e,i,b.textBoxStartIndex,b.textBoxEndIndex,b,a),this._updateTextDebugCollisionBoxes(m,e,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b,a),this._updateIconDebugCollisionBoxes(f,e,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b,u),this._updateIconDebugCollisionBoxes(f,e,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b,u)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,i,a,u,f,m,_,b,S){const I={};if(i<a){const{x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q,featureIndex:ae}=e.get(i);I.textBox={x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q},I.textFeatureIndex=ae}if(u<f){const{x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q,featureIndex:ae}=e.get(u);I.verticalTextBox={x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q},I.verticalTextFeatureIndex=ae}if(m<_){const{x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q,featureIndex:ae}=e.get(m);I.iconBox={x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q},I.iconFeatureIndex=ae}if(b<S){const{x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q,featureIndex:ae}=e.get(b);I.verticalIconBox={x1:C,y1:k,x2:M,y2:R,padding:F,projectedAnchorX:$,projectedAnchorY:U,projectedAnchorZ:H,tileAnchorX:X,tileAnchorY:Q},I.verticalIconFeatureIndex=ae}return I}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const a=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,a.textBoxStartIndex,a.textBoxEndIndex,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a.iconBoxStartIndex,a.iconBoxEndIndex,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,i){const a=e.placedSymbolArray.get(i),u=a.vertexStartIndex+4*a.numGlyphs;for(let f=a.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(e),a=Math.cos(e),u=[],f=[],m=[];for(let _=0;_<this.symbolInstances.length;++_){m.push(_);const b=this.symbolInstances.get(_);u.push(0|Math.round(i*b.tileAnchorX+a*b.tileAnchorY)),f.push(b.featureIndex)}return m.sort((_,b)=>u[_]-u[b]||f[b]-f[_]),m}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,i){const a=this.sortKeyRanges[this.sortKeyRanges.length-1];a&&a.sortKey===i?a.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const a=this.symbolInstances.get(i);this.featureSortOrder.push(a.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:_,placedIconSymbolIndex:b,verticalPlacedIconSymbolIndex:S}=a;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),m>=0&&m!==f&&m!==u&&this.addIndicesForPlacedSymbol(this.text,m),_>=0&&this.addIndicesForPlacedSymbol(this.text,_),b>=0&&this.addIndicesForPlacedSymbol(this.icon,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const i=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let a;return this.elevationFeatures&&i<this.elevationFeatures.length&&(a=this.elevationFeatures[i]),a}}function bA(s,e){return e.replace(/{([^{}]+)}/g,(i,a)=>a in s?String(s[a]):"")}let wA,SA,Wb;Ct(Jv,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Jv.addDynamicAttributes=gf;class TA{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:ys,this.defaultValue=e}evaluate(e){if(e.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(e.formattedSection))return i.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Ct(TA,"FormatSectionOverride",{omit:["defaultValue"]});const qb=()=>Wb||(Wb={layout:wA||(wA=new Cr({"symbol-placement":new ft(ze.layout_symbol["symbol-placement"]),"symbol-spacing":new ft(ze.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ft(ze.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new vt(ze.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ft(ze.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new ft(ze.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new ft(ze.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new ft(ze.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ft(ze.layout_symbol["icon-ignore-placement"]),"icon-optional":new ft(ze.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ft(ze.layout_symbol["icon-rotation-alignment"]),"icon-size":new vt(ze.layout_symbol["icon-size"]),"icon-size-scale-range":new ft(ze.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new vt(ze.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new vt(ze.layout_symbol["icon-text-fit-padding"]),"icon-image":new vt(ze.layout_symbol["icon-image"]),"icon-image-use-theme":new ft({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new vt(ze.layout_symbol["icon-rotate"]),"icon-padding":new ft(ze.layout_symbol["icon-padding"]),"icon-keep-upright":new ft(ze.layout_symbol["icon-keep-upright"]),"icon-offset":new vt(ze.layout_symbol["icon-offset"]),"icon-anchor":new vt(ze.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ft(ze.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ft(ze.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ft(ze.layout_symbol["text-rotation-alignment"]),"text-field":new vt(ze.layout_symbol["text-field"]),"text-font":new vt(ze.layout_symbol["text-font"]),"text-size":new vt(ze.layout_symbol["text-size"]),"text-size-scale-range":new ft(ze.layout_symbol["text-size-scale-range"]),"text-max-width":new vt(ze.layout_symbol["text-max-width"]),"text-line-height":new vt(ze.layout_symbol["text-line-height"]),"text-letter-spacing":new vt(ze.layout_symbol["text-letter-spacing"]),"text-justify":new vt(ze.layout_symbol["text-justify"]),"text-radial-offset":new vt(ze.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ft(ze.layout_symbol["text-variable-anchor"]),"text-anchor":new vt(ze.layout_symbol["text-anchor"]),"text-max-angle":new ft(ze.layout_symbol["text-max-angle"]),"text-writing-mode":new ft(ze.layout_symbol["text-writing-mode"]),"text-rotate":new vt(ze.layout_symbol["text-rotate"]),"text-padding":new ft(ze.layout_symbol["text-padding"]),"text-keep-upright":new ft(ze.layout_symbol["text-keep-upright"]),"text-transform":new vt(ze.layout_symbol["text-transform"]),"text-offset":new vt(ze.layout_symbol["text-offset"]),"text-allow-overlap":new ft(ze.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ft(ze.layout_symbol["text-ignore-placement"]),"text-optional":new ft(ze.layout_symbol["text-optional"]),visibility:new ft(ze.layout_symbol.visibility)})),paint:SA||(SA=new Cr({"icon-opacity":new vt(ze.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new vt(ze.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new vt(ze.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new vt(ze.paint_symbol["text-emissive-strength"]),"icon-color":new vt(ze.paint_symbol["icon-color"]),"icon-halo-color":new vt(ze.paint_symbol["icon-halo-color"]),"icon-halo-width":new vt(ze.paint_symbol["icon-halo-width"]),"icon-halo-blur":new vt(ze.paint_symbol["icon-halo-blur"]),"icon-translate":new ft(ze.paint_symbol["icon-translate"]),"icon-translate-anchor":new ft(ze.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new ft(ze.paint_symbol["icon-image-cross-fade"]),"text-opacity":new vt(ze.paint_symbol["text-opacity"]),"text-occlusion-opacity":new vt(ze.paint_symbol["text-occlusion-opacity"]),"text-color":new vt(ze.paint_symbol["text-color"],{runtimeType:ns,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new vt(ze.paint_symbol["text-halo-color"]),"text-halo-width":new vt(ze.paint_symbol["text-halo-width"]),"text-halo-blur":new vt(ze.paint_symbol["text-halo-blur"]),"text-translate":new ft(ze.paint_symbol["text-translate"]),"text-translate-anchor":new ft(ze.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new ft(ze.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new ft(ze.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new ft(ze.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new ft(ze.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new vt(ze.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},Wb);class Qv extends as{constructor(e,i,a,u){super(e,qb(),i,a,u,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=Ee([]),this.hasOcclusionOpacityProperties=e.paint!==void 0&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){e!=="icon-occlusion-opacity"&&e!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,i){super.recalculate(e,i),this.appearances&&this.appearances.forEach(u=>{u.recalculate(e,i,this.iconImageUseTheme)}),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const a=this.layout.get("text-writing-mode");if(a){const u=[];for(const f of a)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,i,a,u){return this._saturation===e&&this._contrast===i&&this._brightnessMin===a&&this._brightnessMax===u||(this._colorAdjustmentMatrix=function(f,m,_,b){f=Rn(f),m=Mr(m);const S=ce(),I=f/3,C=1-2*I,k=[C,I,I,0,I,C,I,0,I,I,C,0,0,0,0,1],M=.5-.5*m,R=b-_;return K(S,[R,0,0,0,0,R,0,0,0,0,R,0,_,_,_,1],[m,0,0,0,0,m,0,0,0,0,m,0,M,M,M,1]),K(S,S,k),S}(e,i,a,u),this._saturation=e,this._contrast=i,this._brightnessMin=a,this._brightnessMax=u),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,i,a,u){const f=this.layout.get(e).evaluate(i,{},a,u),m=this._unevaluatedLayout._values[e];return m.isDataDriven()||ih(m.value)||!f?f:bA(i.properties,f)}getAppearanceValueAndResolveTokens(e,i,a,u,f){const m=e.getProperty(i);if(!m)return;const _=m.evaluate(a,{},u,f),b=e.getUnevaluatedProperties()._values[i];return b.isDataDriven()||ih(b.value)||!_||typeof _!="string"?_:bA(a.properties,_)}createBucket(e){return new Jv(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of qb().paint.overridableProperties){if(!Qv.hasPaintOverride(this.layout,e))continue;const i=this.paint.get(e),a=new TA(i),u=new Dd(a,i.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let f=null;f=i.value.kind==="constant"||i.value.kind==="source"?new rh("source",u):new Vl("composite",u,i.value.zoomStops,i.value.interpolationType),this.paint._values[e]=new Gl(i.property,f,i.parameters)}}_handleOverridablePaintPropertyUpdate(e,i,a){return!(!this.layout||i.isDataDriven()||a.isDataDriven())&&Qv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,i){const a=e.get("text-field"),u=qb().paint.properties[i];let f=!1;const m=_=>{for(const b of _)if(u.overrides&&u.overrides.hasOverride(b))return void(f=!0)};if(a.value.kind==="constant"&&a.value.value instanceof Wn)m(a.value.value.sections);else if(a.value.kind==="source"){const _=S=>{f||(S instanceof Ra&&cn(S.value)===wc?m(S.value.sections):S instanceof Dt?m(S.sections):S.eachChild(_))},b=a.value;b._styleExpression&&_(b._styleExpression.expression)}return f}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,i,a){return{config:new L(this,{zoom:i,lut:a}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let EA,IA,AA,CA;var Zb=wi([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function e0(s,e,i,a,u,f,m,_){const b=[s,e,1,i,a,1,u,f,1],S=[m,_,1],I=re([],b),[C,k,M]=Ls(S,S,I);return he(b,b,[C,0,0,0,k,0,0,0,M])}function kA(s,e,i,a,u,f,m,_){const b=function(S,I,C,k,M,R,F,$){const U=e0(0,0,1,0,1,1,0,1),H=e0(S,I,C,k,M,R,F,$);return he(H,H,re([],U))}(s,e,i,a,u,f,m,_);return[b[2]/b[8]/gt,b[5]/b[8]/gt]}function t0(s){return[s[0],Math.min(Math.max(s[1],-85.051129),Ie)]}class LA extends Ma{constructor(e,i,a,u){super(),this.id=e,this.dispatcher=a,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(u),this.options=i,this._dirty=!1}load(e,i){if(this._loaded=i||!1,this.fire(new Pa("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=nd(this.map._requestManager.transformRequest(this.url,gs.Image),(a,u)=>{this._imageRequest=null,this._loaded=!0,a?this.fire(new Nu(a)):u&&(this.image=u instanceof HTMLImageElement?Zs.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new ag(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof ag||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=e[0][1],a=e[0][1];for(const f of e)f[1]>a&&(a=f[1]),f[1]<i&&(i=f[1]);const u=(a+i)/2;if(u>Ie?this.onNorthPole=!0:u<-85.051129&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const f=e.map(yt.fromLngLat);this.tileID=function(m){let _=1/0,b=1/0,S=-1/0,I=-1/0;for(const F of m)_=Math.min(_,F.x),b=Math.min(b,F.y),S=Math.max(S,F.x),I=Math.max(I,F.y);const C=Math.max(S-_,I-b),k=Math.max(0,Math.floor(-Math.log2(C))),M=Math.pow(2,k);let R=Math.floor((_+S)/2*M);return R>1&&(R-=1),new bh(k,R,Math.floor((b+I)/2*M))}(f),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new Pa("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof ag||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const U in this.tiles){const H=this.tiles[U];H.state!=="loaded"&&(H.state="loaded",H.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=mg(new bh(0,0,0),this.map.transform.projection),a=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(U){const H=U[1].x-U[0].x,X=U[1].y-U[0].y,Q=U[2].x-U[1].x,ae=U[2].y-U[1].y,oe=U[3].x-U[2].x,ge=U[3].y-U[2].y,ye=U[0].x-U[3].x,me=U[0].y-U[3].y,Se=H*ae-Q*X,Ae=Q*ge-oe*ae,Ze=oe*me-ye*ge,Ge=ye*X-H*me;return Se>0&&Ae>0&&Ze>0&&Ge>0||Se<0&&Ae<0&&Ze<0&&Ge<0}(a))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const u=mg(this.tileID,this.map.transform.projection),[f,m,_,b]=this.coordinates.map(U=>{const H=u.projection.project(U[0],U[1]);return mA(u,H)._round()});this.perspectiveTransform=kA(f.x,f.y,m.x,m.y,_.x,_.y,b.x,b.y);const S=this._boundsArray=new Fa;S.emplaceBack(f.x,f.y,0,0),S.emplaceBack(m.x,m.y,gt,0),S.emplaceBack(b.x,b.y,0,gt),S.emplaceBack(_.x,_.y,gt,gt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(S,Zb.members),this.boundsSegments=xr.simpleSegment(0,0,4,2);const I=[],C=[t0((k=this.coordinates)[0]),t0(k[1]),t0(k[2]),t0(k[3])];var k;const[M,R,F,$]=function(U){let H=U[0][0],X=H,Q=U[0][1],ae=Q;for(let oe=1;oe<U.length;oe++)U[oe][0]<H?H=U[oe][0]:U[oe][0]>X&&(X=U[oe][0]),U[oe][1]<Q?Q=U[oe][1]:U[oe][1]>ae&&(ae=U[oe][1]);return[H,Q,X-H,ae-Q]}(C);{const U=new Fa,[H,X,Q,ae]=function(Qe){let Ne=Qe[0].x,it=Ne,Ke=Qe[0].y,rt=Ke;for(let tt=1;tt<Qe.length;tt++)Qe[tt].x<Ne?Ne=Qe[tt].x:Qe[tt].x>it&&(it=Qe[tt].x),Qe[tt].y<Ke?Ke=Qe[tt].y:Qe[tt].y>rt&&(rt=Qe[tt].y);return[Ne,Ke,it-Ne,rt-Ke]}(a),oe=Qe=>[(Qe.x-H)/Q,(Qe.y-X)/ae],[ge,ye,me,Se]=a.map(oe),Ae=function(Qe,Ne,it,Ke,rt,tt,St,Et){const mt=e0(0,0,1,0,1,1,0,1);return he(mt,mt,re([],e0(Qe,Ne,it,Ke,rt,tt,St,Et)))}(ge[0],ge[1],ye[0],ye[1],me[0],me[1],Se[0],Se[1]);this.elevatedGlobePerspectiveTransform=kA(ge[0],ge[1],ye[0],ye[1],me[0],me[1],Se[0],Se[1]);const Ze=(Qe,Ne)=>{I.push(Qe.lng);const it=Math.round((Qe.lng-M)/F*gt),Ke=Math.round((Qe.lat-R)/$*gt),rt=oe(Ne),tt=Ls([],[rt[0],rt[1],1],Ae),St=Math.round(tt[0]/tt[2]*gt),Et=Math.round(tt[1]/tt[2]*gt);U.emplaceBack(it,Ke,St,Et)},Ge=a[3].x-a[0].x,qe=a[3].y-a[0].y,et=a[2].x-a[1].x,Je=a[2].y-a[1].y;for(let Qe=0;Qe<65;Qe++){const Ne=Qe/64,it=[a[0].x+Ne*Ge,a[0].y+Ne*qe],Ke=[a[1].x+Ne*et,a[1].y+Ne*Je],rt=Ke[0]-it[0],tt=Ke[1]-it[1];for(let St=0;St<65;St++){const Et=St/64,mt={x:it[0]+rt*Et,y:it[1]+tt*Et};Ze(i.projection.unproject(mt.x,mt.y),mt)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(U,Zb.members)}{this.maxLongitudeTriangleSize=0;let U=[],H=new en;const X=(Q,ae,oe)=>{H.emplaceBack(Q,ae,oe);const ge=I[Q],ye=I[ae],me=I[oe],Se=Math.min(Math.min(ge,ye),me),Ae=Math.max(Math.max(ge,ye),me)-Se;Ae>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ae),U.push(Se+Ae/2)};for(let Q=0;Q<64;Q++)for(let ae=0;ae<64;ae++){const oe=65*Q+ae,ge=oe+1,ye=oe+65,me=ye+1;X(oe,ye,ge),X(ge,ye,me)}[U,H]=function(Q,ae){const oe=Array.from({length:Q.length},(me,Se)=>Se);oe.sort((me,Se)=>Q[me]-Q[Se]);const ge=[],ye=new en;for(let me=0;me<oe.length;me++){const Se=oe[me];ge.push(Q[Se]);const Ae=3*Se,Ze=Ae+1;ye.emplaceBack(ae.uint16[Ae],ae.uint16[Ze],ae.uint16[Ze+1])}return[ge,ye]}(U,H),this.elevatedGlobeTrianglesCenterLongitudes=U,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(H)}this.elevatedGlobeSegments=xr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,F/gt,0,$/gt,0,0,R,M,0])}prepare(){const e=Object.keys(this.tiles).length!==0;if(this.tileID&&!e)return;const i=this.map.painter.context,a=i.gl;!this._dirty||this.texture instanceof ag||(this.texture?this.texture.update(this.image):(this.texture=new yb(i,this.image,a.RGBA8),this.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(i)}loadTile(e,i){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},i(null)):(e.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const a=this.elevatedGlobeTrianglesCenterLongitudes;let u=(f=e+180)+360*Math.round((a[0]-f)/360);var f;const m=new xr,_=(C,k)=>{m.segments.push({vertexOffset:0,primitiveOffset:C,vertexLength:i.segments[0].vertexLength,primitiveLength:k,sortKey:void 0,vaos:{}})},b=.51*this.maxLongitudeTriangleSize;if(Math.abs(a[0]-u)<=b){const C=er(a,0,a.length,u+b);return C===a.length||_(C,Qi(a,C+1,a.length,u+360-b)-C),m}u<a[0]&&(u+=360);const S=Qi(a,0,a.length,u-b);if(S===a.length)return _(0,a.length),m;_(0,S-0);const I=er(a,S+1,a.length,u+b);return I!==a.length&&_(I,a.length-I),m}}const Xb=1024,Y3=(Math.pow(Xb,2)-1)/268170240;class PA extends as{constructor(e,i,a,u){super(e,{layout:AA||(AA=new Cr({visibility:new ft(ze.layout_raster.visibility)})),paint:CA||(CA=new Cr({"raster-opacity":new ft(ze.paint_raster["raster-opacity"]),"raster-color":new jc(ze.paint_raster["raster-color"]),"raster-color-mix":new ft(ze.paint_raster["raster-color-mix"]),"raster-color-range":new ft(ze.paint_raster["raster-color-range"]),"raster-hue-rotate":new ft(ze.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ft(ze.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ft(ze.paint_raster["raster-brightness-max"]),"raster-saturation":new ft(ze.paint_raster["raster-saturation"]),"raster-contrast":new ft(ze.paint_raster["raster-contrast"]),"raster-resampling":new ft(ze.paint_raster["raster-resampling"]),"raster-fade-duration":new ft(ze.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new ft(ze.paint_raster["raster-emissive-strength"]),"raster-array-band":new ft(ze.paint_raster["raster-array-band"]),"raster-elevation":new ft(ze.paint_raster["raster-elevation"]),"raster-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof LA&&(e._source.onNorthPole||e._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(e){e!=="raster-color"&&e!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[a,u]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(a)&&isNaN(u)||a===this._curRampRange[0]&&u===this._curRampRange[1]||(this.colorRamp=Gm({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:a,end:u}],resolution:Xb}),this.colorRampTexture=null,this._curRampRange=[a,u])}is3D(e){return this.paint.get("raster-elevation")>0}}let MA,RA,DA,OA,zA;class BA extends as{constructor(e,i,a,u){super(e,{layout:MA||(MA=new Cr({visibility:new ft(ze["layout_raster-particle"].visibility)})),paint:RA||(RA=new Cr({"raster-particle-array-band":new ft(ze["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new ft(ze["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new jc(ze["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new ft(ze["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new ft(ze["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new ft(ze["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new ft(ze["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new ft(ze["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},i,a,u),this._updateColorRamp(),this.lastInvalidatedAt=Zs.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){e!=="raster-particle-color"&&e!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),e==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Gm({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Zs.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class J3 extends as{constructor(e,i){super(e,{},i,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(e){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function Kb(s,e,i){const a=[0,0,1],u=Ps([]);return mo(u,u,i?-Pi(s)+Math.PI:Pi(s)),Mo(u,u,-Pi(e)),ar(a,a,u),Si(a,a)}const FA={None:0,Model:1,Symbol:2,FillExtrusion:4};class i0{constructor(e,i,a,u){this.message=(e?`${e}: `:"")+a,u&&(this.identifier=u),i!=null&&i.__line__&&(this.line=i.__line__)}}function Yb(s,e){const i=s.indexOf("://")===-1;try{return new URL(s,i&&e?"http://example.com":void 0),!0}catch{return!1}}class jA{constructor(e,i){this.feature=e,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class NA{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new jm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let u=Math.floor(a[i+2]);const f=1.05*(a[i+2]-u);return u/=100,[a[i]%1*1.05,a[i+1]%1*1.05,f,u]}tileCoordinatesForInstance(e){const i=16*e,a=this.instancedDataArray.float32;let u=a[i+0];return u=u>gt?u-gt:u,new at(Math.trunc(u),Math.trunc(a[i+1]))}translationForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+4],a[i+5],a[i+6]]}rotationScaleForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+10],a[i+11],a[i+12],a[i+13],a[i+14],a[i+15]]}transformForInstance(e){const i=16*e,a=this.instancedDataArray.float32;return[a[i+7],a[i+8],a[i+9],a[i+4],a[i+10],a[i+11],a[i+12],a[i+5],a[i+13],a[i+14],a[i+15],a[i+6],0,0,0,1]}}class Jb{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,i){}updateAppearances(e,i,a,u){}populate(e,i,a,u){this.tileToMeter=ht(a);const f=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);const m=this.layers[0].paint.get("model-elevation-reference")==="hd-road-markup"?i.elevationFeatures:void 0;for(const{feature:_,id:b,index:S,sourceLayerIndex:I}of e){const C=b??(_.properties&&_.properties.hasOwnProperty("id")?_.properties.id:void 0),k=ci(_,f);if(!this.layers[0]._featureFilter.filter(new Yi(this.zoom,{worldview:this.worldview,activeFloors:i.activeFloors}),k,a))continue;const M={id:C,sourceLayerIndex:I,index:S,geometry:f?k.geometry:Xt(_,a,u),properties:_.properties,type:_.type,patterns:{}},R=this.addFeature(M,M.geometry,k,m,a);R&&i.featureIndex.insert(_,M.geometry,S,I,this.index,this.instancesPerModel[R].instancedDataArray.length,256)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,i=this.layers[0].scope;let a=0;for(const u of this.modelUris){const f=e.getModel(u,i);if(!f)continue;const m=this.instancesPerModel[u];if(m){const _=.5*wt(f.aabb.max,f.aabb.min)*m.maxScale+m.maxXYTranslationDistance,b=Math.min(gt,Math.max(_/this.tileToMeter,256));a=Math.max(b,a)}}return a}update(e,i,a,u){for(const f in this.instancesPerModel){const m=this.instancesPerModel[f];for(const _ in e)m.idToFeaturesIndex.hasOwnProperty(_)&&(this.evaluate(m.features[m.idToFeaturesIndex[_]],e[_],m,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];for(const u of a.features){const f=this.layers[0],m=u.feature,_=this.canonical,b=f.paint.get("model-rotation").evaluate(m,{},_),S=f.paint.get("model-scale").evaluate(m,{},_),I=f.paint.get("model-translation").evaluate(m,{},_);es(u.rotation,b)&&es(u.scale,S)&&es(u.translation,I)||(this.evaluate(u,u.featureStates,a,!0),e=!0)}}return e}updateReplacement(e,i,a,u){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const f=i.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Iv(this.activeReplacements,f))return!1;this.activeReplacements=f;let m=!1;for(const _ in this.instancesPerModel){const b=this.instancesPerModel[_],S=b.instancedDataArray;for(const I of b.features){const C=I.instancedDataOffset,k=I.instancedDataCount;for(let M=0;M<k;M++){const R=16*(M+C);let F=S.float32[R+0];const $=F>gt;F=$?F-gt:F;const U=Math.floor(F),H=Math.floor(S.float32[R+1]);let X=!1;for(const Q of this.activeReplacements)if(!vE(Q,a,FA.Model,u)&&!(Q.min.x>U||U>Q.max.x||Q.min.y>H||H>Q.max.y)&&(X=TE(SE(U,H,e.canonical,Q.footprintTileId.canonical),Q.footprint),X))break;S.float32[R]=X?F+gt:F,m=m||X!==$}}}return m}isEmpty(){for(const e in this.instancesPerModel)if(this.instancesPerModel[e].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const i in this.instancesPerModel){const a=this.instancesPerModel[i];a.instancedDataArray.length<0||a.instancedDataArray.length===0||(a.instancedDataBuffer?a.instancedDataBuffer.updateData(a.instancedDataArray):a.instancedDataBuffer=e.createVertexBuffer(a.instancedDataArray,xz.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const i=this.layers[0].modelManager;if(e&&i&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)i.removeModel(a,"",!0)}addFeature(e,i,a,u,f){const m=this.layers[0],_=m.layout.get("model-id"),b=m.layout.get("model-allow-density-reduction"),S=_.evaluate(a,{},this.canonical);if(!S)return Kt(`modelId is not evaluated for layer ${m.id} and it is not going to get rendered.`),S;(Yb(S,!1)||this.styleDefinedModelURLs[S]!==void 0)&&(this.modelUris.includes(S)||this.modelUris.push(S)),this.instancesPerModel[S]||(this.instancesPerModel[S]=new NA);const I=this.instancesPerModel[S],C=I.instancedDataArray,k=new jA(a,C.length);let M;u&&(M=cs.getElevationFeature(e,u));for(const R of i)for(const F of R){if(F.x<0||F.x>=gt||F.y<0||F.y>=gt)continue;if(this.lookupDim!==0&&b){const U=(this.lookupDim-1)/gt,H=this.lookupDim*(F.y*U|0)+F.x*U|0;if(this.lookup){if(this.lookup[H]!==0)continue;this.lookup[H]=1}}this.instanceCount++;const $=C.length;if(C.resize($+1),u){I.instancesRoadElevation||(I.instancesRoadElevation=[]);const U=M?M.pointElevation(new at(F.x,F.y)):0;I.instancesRoadElevation.push(U)}I.instancesEvaluatedElevation.push(0),C.float32[16*$]=F.x,C.float32[16*$+1]=F.y}return k.instancedDataCount=I.instancedDataArray.length-k.instancedDataOffset,k.instancedDataCount>0&&(e.id&&(I.idToFeaturesIndex[e.id]=I.features.length),I.features.push(k),this.evaluate(k,{},I,!1)),S}getModelUris(){return this.modelUris}evaluate(e,i,a,u){const f=this.layers[0],m=e.feature,_=this.canonical,b=e.rotation=f.paint.get("model-rotation").evaluate(m,i,_),S=e.scale=f.paint.get("model-scale").evaluate(m,i,_),I=e.translation=f.paint.get("model-translation").evaluate(m,i,_),C=Object.assign({},f.paint.get("model-color").evaluate(m,i,_));C.a=f.paint.get("model-color-mix-intensity").evaluate(m,i,_);const k=[];this.maxVerticalOffset<I[2]&&(this.maxVerticalOffset=I[2]);const M=I[0]*I[0]+I[1]*I[1],R=M>0?Math.sqrt(M):0;a.maxScale=Math.max(Math.max(a.maxScale,S[0]),Math.max(S[1],S[2])),a.maxXYTranslationDistance=Math.max(a.maxXYTranslationDistance,R),this.maxScale=Math.max(Math.max(this.maxScale,S[0]),Math.max(S[1],S[2])),pI(k,b,S);const F=Math.round(100*C.a)+C.b/1.05;for(let $=0;$<e.instancedDataCount;++$){const U=e.instancedDataOffset+$,H=16*U,X=a.instancedDataArray.float32;let Q=0;u&&(Q=X[H+6]-a.instancesEvaluatedElevation[U]);const ae=0|X[H+1];X[H]=(0|X[H])+C.r/1.05,X[H+1]=ae+C.g/1.05,X[H+2]=F,X[H+3]=1/(_.z>10?this.tileToMeter:ht(_,ae)),X[H+4]=I[0],X[H+5]=I[1],X[H+6]=I[2]+(a.instancesRoadElevation?a.instancesRoadElevation[U]:0)+Q,X[H+7]=k[0],X[H+8]=k[1],X[H+9]=k[2],X[H+10]=k[4],X[H+11]=k[5],X[H+12]=k[6],X[H+13]=k[8],X[H+14]=k[9],X[H+15]=k[10],a.instancesEvaluatedElevation[U]=I[2]}}}let UA,VA;Ct(Jb,"ModelBucket",{omit:["layers"]}),Ct(NA,"PerModelAttributes"),Ct(jA,"ModelFeature");class _f{constructor(e,i,a){this._demTile=e,this._dem=this._demTile.dem,this._scale=i,this._offset=a}static create(e,i,a){const u=a||e.findDEMTileFor(i);if(!u||!u.dem)return;const f=u.dem,m=u.tileID,_=1<<i.canonical.z-m.canonical.z;return new _f(u,f.dim/gt/_,[(i.canonical.x/_-m.canonical.x)*f.dim,(i.canonical.y/_-m.canonical.y)*f.dim])}tileCoordToPixel(e,i){const a=i*this._scale+this._offset[1];return new at(Math.floor(e*this._scale+this._offset[0]),Math.floor(a))}getElevationAt(e,i,a,u){const f=e*this._scale+this._offset[0],m=i*this._scale+this._offset[1],_=Math.floor(f),b=Math.floor(m),S=this._dem;return u=!!u,a?qt(qt(S.get(_,b,u),S.get(_,b+1,u),m-b),qt(S.get(_+1,b,u),S.get(_+1,b+1,u),m-b),f-_):S.get(_,b,u)}getElevationAtPixel(e,i,a){return this._dem.get(e,i,!!a)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*je(1,e)*this._dem.stride}}const Qb=new Float32Array(262144),kh=new Uint8Array(262144);function $A(s){let e=0;if(s.meshes)for(const i of s.meshes)e=Math.max(e,i.aabb.max[2]);if(s.children)for(const i of s.children)e=Math.max(e,$A(i));return e}function GA(s,e,i){if(s.meshes)for(const a of s.meshes){if(a.aabb.min[0]===1/0)continue;const u=Ui.applyTransform(a.aabb,s.globalMatrix);i.insert(e,u.min[0],u.min[1],u.max[0],u.max[1])}if(s.children)for(const a of s.children)GA(a,e,i)}const HA=["","wall","door","roof","window","lamp","logo"];class WA{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:$A(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const i=new Ui([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const a of this.node.meshes)this.node.lightMeshIndex!==e&&(a.transformedAabb=Ui.applyTransformFast(a.aabb,this.node.globalMatrix),i.encapsulate(a.transformedAabb)),e++;this.aabb=i}return this.aabb}}class r0{constructor(e,i,a,u,f,m,_,b){this.id=a,this.layers=e,this.layerIds=this.layers.map(S=>S.fqid),this.stateDependentLayerIds=this.layers.filter(S=>S.isStateDependent()).map(S=>S.id),this.modelTraits|=cf.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,u&&(this.modelTraits|=cf.HasMapboxMeshFeatures),f&&(this.modelTraits|=cf.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=m,this.worldview=b,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const S of i)this.nodesInfo.push(new WA(S)),GA(S,_.featureIndexArray.length,_.grid),_.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,_.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,i){for(const a of this.getNodesInfo()){const u=a.node;u.footprint&&i.push({footprint:u.footprint,id:e})}}updateAppearances(e,i,a,u){}update(e){const i=Object.keys(e).length!==0;if(i&&!this.stateDependentLayers.length)return;const a=i?this.stateDependentLayers:this.layers;if(!Li(e,this.states))for(const u of a)this.evaluate(u,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const a of i){const u=a.node;this.uploaded?this.updatePbrBuffer(u):bb(u,e,!0)}for(const a of i)Fv(a.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let i=!1;if(!e.meshes)return i;for(const a of e.meshes)a.pbrBuffer&&(a.pbrBuffer.updateData(a.featureArray),i=!0);return i}needsReEvaluation(e,i,a){const u=e.transform.projectionOptions,f=e.style.getBrightness(),m=this.brightness!==f;if(!this.uploaded||this.dirty||u.name!==this.projection.name||Sg(a.paint.get("model-color").value,m)||Sg(a.paint.get("model-color-mix-intensity").value,m)||Sg(a.paint.get("model-roughness").value,m)||Sg(a.paint.get("model-emissive-strength").value,m)||Sg(a.paint.get("model-height-based-emissive-strength-multiplier").value,m)){this.projection=u,this.brightness=f;const _=this.getNodesInfo();for(const b of _)b.state=null;return!0}return!1}evaluateTransform(e,i){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const a=this.getNodesInfo(),u=this.id.canonical;for(const f of a){const m=f.feature;f.evaluatedTranslation=i.paint.get("model-translation").evaluate(m,{},u),f.evaluatedScale=i.paint.get("model-scale").evaluate(m,{},u)}}evaluate(e,i){const a=this.getNodesInfo();for(const u of a){if(!u.node.meshes)continue;const f=u.feature,m=i&&i[f.id];if(Li(m,u.state))continue;u.state=structuredClone(m);const _=u.node.meshes&&u.node.meshes[0].featureData,b=u.evaluatedColor[2],S=u.evaluatedRMEA[2],I=this.id.canonical;if(u.hasTranslucentParts=!1,_){for(let C=0;C<HA.length;C++){const k=HA[C];k.length&&(f.properties.part=k);const M=e.paint.get("model-color").evaluate(f,m,I).toPremultipliedRenderColor(null),R=e.paint.get("model-color-mix-intensity").evaluate(f,m,I);u.evaluatedColor[C]=[M.r,M.g,M.b,R],u.evaluatedRMEA[C][0]=e.paint.get("model-roughness").evaluate(f,m,I),u.evaluatedRMEA[C][2]=e.paint.get("model-emissive-strength").evaluate(f,m,I),u.evaluatedRMEA[C][3]=M.a,u.emissionHeightBasedParams[C]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(f,m,I),!u.hasTranslucentParts&&M.a<1&&(u.hasTranslucentParts=!0)}delete f.properties.part,eB(u,b!==u.evaluatedColor[2]||S!==u.evaluatedRMEA[2],this.modelTraits)}else u.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(f,m,I);u.evaluatedTranslation=e.paint.get("model-translation").evaluate(f,m,I),u.evaluatedScale=e.paint.get("model-scale").evaluate(f,m,I),this.updatePbrBuffer(u.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,i,a,u){const f=e.findDEMTileFor(a);if(f&&(f.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(f.dem&&f.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=f.tileID.overscaledZ;const m=_f.create(e,a,f);if(!m)return;this.modelTraits&cf.HasMapboxMeshFeatures&&this.updateDEM(e,m,a,u);for(const _ of this.getNodesInfo()){const b=_.node;if(!b.footprint||!b.footprint.vertices||!b.footprint.vertices.length)continue;const S=b.footprint.vertices;let I=m.getElevationAt(S[0].x,S[0].y,!0,!0);for(let C=1;C<S.length;C++)I=Math.min(I,m.getElevationAt(S[C].x,S[C].y,!0,!0));b.elevation=I}}this.terrainTile=f.tileID.canonical,this.terrainExaggeration=i}}updateDEM(e,i,a,u){let f=i._dem._modifiedForSources[u];if(f===void 0&&(i._dem._modifiedForSources[u]=[],f=i._dem._modifiedForSources[u]),f.includes(a.canonical))return;const m=i._dem.dim;f.push(a.canonical);let _=!1;for(const b of this.getNodesInfo()){const S=b.node;if(!S.footprint||!S.footprint.grid)continue;const I=S.footprint.grid,C=i.tileCoordToPixel(I.min.x,I.min.y),k=i.tileCoordToPixel(I.max.x,I.max.y),M=Math.min(Math.min(m-k.y,C.x),Math.min(C.y,m-k.x));if(M<0)continue;const R=pe(M,2,5);let F=Math.max(0,C.x-R),$=Math.max(0,C.y-R),U=Math.min(k.x+R,m-1),H=Math.min(k.y+R,m-1);for(let oe=$;oe<=H;++oe)for(let ge=F;ge<=U;++ge)kh[oe*m+ge]=255;let X=0,Q=0;for(let oe=0;oe<I.cellsY;++oe)for(let ge=0;ge<I.cellsX;++ge){if(!I.cells[oe*I.cellsX+ge])continue;const ye=i.tileCoordToPixel(I.min.x+ge/I.xScale,I.min.y+oe/I.yScale),me=i.tileCoordToPixel(I.min.x+(ge+1)/I.xScale,I.min.y+(oe+1)/I.yScale);for(let Se=ye.y;Se<=Math.min(me.y+1,m-1);++Se)for(let Ae=ye.x;Ae<=Math.min(me.x+1,m-1);++Ae)kh[Se*m+Ae]===255&&(kh[Se*m+Ae]=0,X+=i.getElevationAtPixel(Ae,Se),Q++)}const ae=X/Q;F=Math.max(1,C.x-R),$=Math.max(1,C.y-R),U=Math.min(k.x+R,m-2),H=Math.min(k.y+R,m-2),_=!0;for(let oe=$;oe<=H;++oe)for(let ge=F;ge<=U;++ge)kh[oe*m+ge]===0&&(Qb[oe*m+ge]=i._dem.set(ge,oe,ae));for(let oe=1;oe<R;++oe){F=Math.max(1,C.x-oe),$=Math.max(1,C.y-oe),U=Math.min(k.x+oe,m-2),H=Math.min(k.y+oe,m-2);for(let ge=$;ge<=H;++ge)for(let ye=F;ye<=U;++ye){const me=ge*m+ye;if(kh[me]===255){let Se=0,Ae=0,Ze=-1,Ge=-1;for(let qe=-1;qe<=1;++qe)for(let et=-1;et<=1;++et){const Je=(ge+qe)*m+ye+et;if(kh[Je]>=oe)continue;const Qe=Qb[Je],Ne=Math.abs(Qe);Ne>Ae&&(Se=Qe,Ae=Ne,Ze=et,Ge=qe)}if(Ae>.1){const qe=1-(oe+.5*Math.abs(Ze*Ge))/R;let et=i._dem.get(ye,ge)+Se*qe;const Je=i._dem.get(ye+Ze,ge+Ge),Qe=i._dem.get(ye-Ze,ge-Ge,!0);(et-Je)*(et-Qe)>0&&(et=(Je+Qe)/2),Qb[me]=i._dem.set(ye,ge,et),kh[me]=oe}}}}}_&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=Zs.now())}setFilter(e){this.filter=e?Em(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new Yi(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const i of e)Fv(i.node),wb(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const a=i.getReplacementRegionsForTile(e.toUnwrapped());for(const u of this.getNodesInfo()){const f=u.node.footprint;u.hiddenByReplacement=!!f&&!a.find(m=>m.footprint===f)}}getHeightAtTileCoord(e,i){const a=[],u=[0,0,0],f=Ee([]);for(const m of this.getNodesInfo()){const _=m.node.meshes[0],b=_.transformedAabb;if(e<b.min[0]||i<b.min[1]||e>b.max[0]||i>b.max[1])continue;if(m.node.hidden===!0)return{height:1/0,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};ve(f,m.node.globalMatrix),u[0]=e,u[1]=i,or(u,u,f);const S=(u[0]-_.aabb.min[0])/(_.aabb.max[0]-_.aabb.min[0])*Eh|0,I=Math.min(63,(u[1]-_.aabb.min[1])/(_.aabb.max[1]-_.aabb.min[1])*Eh|0)*Eh+Math.min(63,S),C=_.heightmap[I];if(!(C<0&&m.node.footprint))return m.hiddenByReplacement?void 0:{height:C,maxHeight:m.feature.properties.height,hidden:!1,verticalScale:m.evaluatedScale[2]};if(m.node.footprint.grid.query(new at(e,i),new at(e,i),a),a.length>0)return{height:void 0,maxHeight:m.feature.properties.height,hidden:m.hiddenByReplacement,verticalScale:m.evaluatedScale[2]}}}}function Sg(s,e){return s instanceof rh&&!s.isLightConstant&&e}function Q3(s,e,i,a,u,f,m,_){let b=(61440&e|(61440&e)>>4)>>8,S=(3840&e|(3840&e)>>4)>>4,I=240&e|(240&e)>>4;i[3]>0&&(b=qt(b,255*i[0],i[3]),S=qt(S,255*i[1],i[3]),I=qt(I,255*i[2],i[3]));const C=b<<8|S,k=I<<8|Math.floor(255*a[3]),M=function(oe){const ge=pe(oe,0,2);return Math.min(Math.round(.5*ge*255),255)}(a[2])<<8|15*a[0]<<4|15*a[1],R=pe(u[0],0,1),F=pe(u[1],0,1),$=pe(u[2],0,1),U=pe(u[3],0,1);let H,X,Q,ae;if(R!==F&&m!==f&&F!==R){const oe=m-f;X=1/(oe*(F-R)),Q=-(f+oe*R)/(oe*(F-R));const ge=pe(u[4],-1,1);ae=Math.pow(10,ge),H=255*$<<8|255*U}else H=65535,X=0,Q=1,ae=1;if(s.emplaceBack(C,k,M,H,X,Q,ae),_){const oe=_.length;_.clear();for(let ge=0;ge<oe;ge++)_.emplaceBack(C,k,M,H,X,Q,ae)}}function eB(s,e,i){const a=s.node;let u=0;const f=i&cf.HasMeshoptCompression;for(const m of a.meshes){if(a.lights&&a.lightMeshIndex===u||!m.featureData)continue;m.featureArray=new ph,m.featureArray.reserve(m.featureData.length);let _=e;for(const b of m.featureData){const S=f?65535&b:b>>16&65535,I=f?b>>16&65535:65535&b,C=(15&I)<8?15&I:0,k=s.evaluatedRMEA[C],M=s.evaluatedColor[C],R=s.emissionHeightBasedParams[C];let F;if(_&&C===2&&a.lights&&(F=new ph,F.resize(10*a.lights.length)),Q3(m.featureArray,S,M,k,R,m.aabb.min[2],m.aabb.max[2],F),F&&_){_=!1;const $=a.meshes[a.lightMeshIndex];$.featureArray=F,$.featureArray._trim()}}m.featureArray._trim(),u++}}Ct(r0,"Tiled3dModelBucket",{omit:["layers"]}),Ct(WA,"Tiled3dModelFeature");const tB=["id","tile","layer","source","sourceLayer","state"];class Lh{constructor(e,i,a,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=i,this._x=a,this._y=u,this.properties=e?e.properties:{},this.id=f}clone(){const e=new Lh(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return this._geometry===void 0&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of tB)this[i]!==void 0&&(e[i]=this[i]);return e}}class Ph extends Ma{constructor(e,i,a,u){super(),this.id=e,this.type="model",this.models=[],this._options=i,this._modelsInfo=new Map}loadGLTFFromURI(e){return uI(this.map._requestManager.transformRequest(e,gs.Model).url)}load(){for(const e in this._options.models){const i=this._options.models[e],a=this._modelsInfo.get(e);if(a){a.modelSpec=i;const u=a.model;u&&(u.position=i.position!=null?new le(i.position[0],i.position[1]):new le(0,0),u.orientation=i.orientation!=null?i.orientation:[0,0,0],Ph.applyModelSpecification(u,i),u.computeBoundsAndApplyParent(),this.models.push(u))}else this._modelsInfo.set(e,{modelSpec:i,model:null}),this.loadGLTFFromURI(i.uri).then(u=>{if(!u)return;const f=this._modelsInfo.get(e);if(!f)return;const m=Tb(u),_=f.modelSpec,b=new mI(e,_.uri,_.position,_.orientation,m);Ph.applyModelSpecification(b,_),b.computeBoundsAndApplyParent(),this.models.push(b),f.model=b,this.loaded()&&this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(u=>{this.fire(new Nu(new Error(`Could not load model ${e} from ${i.uri}: ${u.message}`)))})}this.loaded()&&this.fire(new Pa("data",{dataType:"source",sourceDataType:"metadata"}))}static applyModelSpecification(e,i){i.nodeOverrides&&Ph.convertNodeOverrides(e,i.nodeOverrides),i.materialOverrides&&Ph.convertMaterialOverrides(e,i.materialOverrides),i.nodeOverrideNames&&(e.nodeOverrideNames=[...i.nodeOverrideNames]),i.materialOverrideNames&&(e.materialOverrideNames=[...i.materialOverrideNames]),i.featureProperties&&(e.featureProperties=i.featureProperties)}static convertNodeOverrides(e,i){if(Array.isArray(i)&&i.every(a=>typeof a=="string")){e.nodeOverrideNames=[];for(const a of i)e.nodeOverrideNames.push(a)}else Object.entries(i).forEach(([a,u])=>{const f={orientation:[0,0,0]};if(u.hasOwnProperty("orientation")){const m=u.orientation;m&&(f.orientation=m)}e.nodeOverrides.set(a,f)})}static convertMaterialOverrides(e,i){if(Array.isArray(i)&&i.every(a=>typeof a=="string")){e.materialOverrideNames=[];for(const a of i)e.materialOverrideNames.push(a)}else Object.entries(i).forEach(([a,u])=>{const f={color:new Hi(1,1,1),colorMix:0,emissionStrength:0,opacity:1},m=u["model-color"];m!==void 0&&(f.color.r=m[0],f.color.g=m[1],f.color.b=m[2]);const _=u["model-color-mix-intensity"];_!==void 0&&(f.colorMix=_);const b=u["model-emissive-strength"];b!==void 0&&(f.emissionStrength=b);const S=u["model-opacity"];S!==void 0&&(f.opacity=S),e.materialOverrides.set(a,f)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){if(this._modelsInfo.size===0)return!0;for(const e of this._modelsInfo.values())if(e.model==null)return!1;return!0}getModels(){return this.models}loadTile(e,i){}serialize(){return this._options}setProperty(e,i){return!1}reload(){const e=Hl(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this.load()}setModels(e){this.models=[];const i=new Map;for(const a in e){const u=e[a];if(this._modelsInfo.has(a)){const f=this._modelsInfo.get(a);f&&f.modelSpec.uri===u.uri&&i.set(a,f)}}this._modelsInfo=i,this._options.models=e,this.load()}}function ew(s,e,i,a){const u=1<<s.z;e.lat=nt((a/gt+s.y)/u),e.lng=Ye((i/gt+s.x)/u)}function iB(s,e,i,a){const u=s.getNodesInfo()[e];if(!u||u.hiddenByReplacement||!u.node.meshes)return;let f=Number.MAX_VALUE;const m=u.node,_=i.tile,b=a.calculatePosMatrix(_.tileID.toUnwrapped(),a.worldSize),S=u.evaluatedScale;let I=0;a.elevation&&m.elevation&&(I=m.elevation*a.elevation.exaggeration()),fe(b,b,[(m.anchor?m.anchor[0]:0)*(S[0]-1),(m.anchor?m.anchor[1]:0)*(S[1]-1),I]),ke(b,b,S);const C=i.queryGeometry,k=C.isPointQuery()?C.screenBounds:C.screenGeometry,M=function(F){const $=K([],b,F.globalMatrix);K($,a.expandedFarZProjMatrix,$);for(let U=0;U<F.meshes.length;++U){const H=F.meshes[U];if(U===F.lightMeshIndex)continue;const X=xb(k,a,$,H.aabb);X!=null&&(f=Math.min(X,f))}if(F.children)for(const U of F.children)M(U)};if(M(m),f===Number.MAX_VALUE)return;const R=new le(0,0);return ew(_.tileID.canonical,R,u.node.anchor[0],u.node.anchor[1]),{intersectionZ:f,position:R,feature:u.feature}}const rB={circle:class extends as{constructor(s,e,i,a){super(s,{layout:C2||(C2=new Cr({"circle-sort-key":new vt(ze.layout_circle["circle-sort-key"]),"circle-elevation-reference":new ft(ze.layout_circle["circle-elevation-reference"]),visibility:new ft(ze.layout_circle.visibility)})),paint:k2||(k2=new Cr({"circle-radius":new vt(ze.paint_circle["circle-radius"]),"circle-color":new vt(ze.paint_circle["circle-color"]),"circle-blur":new vt(ze.paint_circle["circle-blur"]),"circle-opacity":new vt(ze.paint_circle["circle-opacity"]),"circle-translate":new ft(ze.paint_circle["circle-translate"]),"circle-translate-anchor":new ft(ze.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ft(ze.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ft(ze.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new vt(ze.paint_circle["circle-stroke-width"]),"circle-stroke-color":new vt(ze.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new vt(ze.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new ft(ze.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}createBucket(s){return new us(s)}queryRadius(s){const e=s;return Zl("circle-radius",this,e)+Zl("circle-stroke-width",this,e)+Jd(this.paint.get("circle-translate"))}queryIntersectsFeature(s,e,i,a,u,f,m,_){const b=A2(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),S=this.paint.get("circle-radius").evaluate(e,i)+this.paint.get("circle-stroke-width").evaluate(e,i);return V2(s,a,f,m,_,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",b,S)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,e,i){const a=U2(this);return{config:new L(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends as{createBucket(s){return new G2(s)}constructor(s,e,i,a){super(s,{layout:H2||(H2=new Cr({visibility:new ft(ze.layout_heatmap.visibility)})),paint:W2||(W2=new Cr({"heatmap-radius":new vt(ze.paint_heatmap["heatmap-radius"]),"heatmap-weight":new vt(ze.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ft(ze.paint_heatmap["heatmap-intensity"]),"heatmap-color":new jc(ze.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ft(ze.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Gm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(s){return Zl("heatmap-radius",this,s)}queryIntersectsFeature(s,e,i,a,u,f,m,_){const b=this.paint.get("heatmap-radius").evaluate(e,i);return V2(s,a,f,m,_,!0,!0,new at(0,0),b)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,e,i){return s==="heatmap"?{config:new L(this,{zoom:e,lut:i}),overrideFog:!1}:{}}},hillshade:class extends as{constructor(s,e,i,a){super(s,{layout:q2||(q2=new Cr({visibility:new ft(ze.layout_hillshade.visibility)})),paint:Z2||(Z2=new Cr({"hillshade-illumination-direction":new ft(ze.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ft(ze.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ft(ze.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ft(ze.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ft(ze.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ft(ze.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new ft(ze.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}},fill:class extends as{constructor(s,e,i,a){super(s,{layout:pE||(pE=new Cr({"fill-sort-key":new vt(ze.layout_fill["fill-sort-key"]),visibility:new ft(ze.layout_fill.visibility),"fill-elevation-reference":new ft(ze.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new vt(ze.layout_fill["fill-construct-bridge-guard-rail"])})),paint:mE||(mE=new Cr({"fill-antialias":new ft(ze.paint_fill["fill-antialias"]),"fill-opacity":new vt(ze.paint_fill["fill-opacity"]),"fill-color":new vt(ze.paint_fill["fill-color"]),"fill-outline-color":new vt(ze.paint_fill["fill-outline-color"]),"fill-translate":new ft(ze.paint_fill["fill-translate"]),"fill-translate-anchor":new ft(ze.paint_fill["fill-translate-anchor"]),"fill-pattern":new vt(ze.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new ft(ze.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new ft(ze.paint_fill["fill-emissive-strength"]),"fill-z-offset":new vt(ze.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new vt(ze.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new vt(ze.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){const s=this.paint.get("fill-pattern"),e=s&&s.constantOr(1),i=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(s,e,i){return{config:new L(this,{zoom:e,lut:i}),overrideFog:!1}}recalculate(s,e){super.recalculate(s,e);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new rb(s)}queryRadius(){return Jd(this.paint.get("fill-translate"))}queryIntersectsFeature(s,e,i,a,u,f){return!s.queryGeometry.isAboveHorizon&&ur(I2(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),a)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const e=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?e&&!s:e}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends as{constructor(s,e,i,a){super(s,{layout:FE||(FE=new Cr({visibility:new ft(ze["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new ft(ze["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:jE||(jE=new Cr({"fill-extrusion-opacity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new vt(ze["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ft(ze["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ft(ze["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new vt(ze["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new ft(ze["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new vt(ze["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new vt(ze["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new ft(ze["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new ft(ze["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new ft(ze["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new ft(ze["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new vt(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new vt(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new ft(ze["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new ft(ze["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new ft(ze["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new ft(ze["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new vt(ze["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new vt(ze["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new ft(ze["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Cv(s)}queryRadius(){return Jd(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,e,i,a,u,f,m,_,b){const S=A2(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),I=this.paint.get("fill-extrusion-height").evaluate(e,i),C=this.paint.get("fill-extrusion-base").evaluate(e,i),k=[0,0],M=_&&f.elevation,R=f.elevation?f.elevation.exaggeration():1,F=s.tile.getBucket(this);if(M&&F instanceof Cv){const Q=F.centroidVertexArray,ae=b+1;ae<Q.length&&(k[0]=Q.geta_centroid_pos0(ae),k[1]=Q.geta_centroid_pos1(ae))}if(k[0]===0&&k[1]===1)return!1;f.projection.name==="globe"&&(a=BE([a],[new at(0,0),new at(gt,gt)],s.tileID.canonical).map(Q=>Q.polygon).flat());const $=M?_:null,[U,H]=WE(f,a,C,I,S,m,$,k,R,f.center.lat,s.tileID.canonical),X=s.queryGeometry;return HE(U,H,X.isPointQuery()?X.screenBounds:X.screenGeometry)}},building:class extends as{constructor(s,e,i,a){super(s,{layout:wI||(wI=new Cr({visibility:new ft(ze.layout_building.visibility),"building-facade":new vt(ze.layout_building["building-facade"]),"building-facade-floors":new vt(ze.layout_building["building-facade-floors"]),"building-facade-unit-width":new vt(ze.layout_building["building-facade-unit-width"]),"building-facade-window":new vt(ze.layout_building["building-facade-window"]),"building-roof-shape":new vt(ze.layout_building["building-roof-shape"]),"building-height":new vt(ze.layout_building["building-height"]),"building-base":new vt(ze.layout_building["building-base"]),"building-flood-light-wall-radius":new vt(ze.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new vt(ze.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new vt(ze.layout_building["building-flip-roof-orientation"])})),paint:SI||(SI=new Cr({"building-opacity":new ft(ze.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new ft(ze.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new ft(ze.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new ft(ze.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new ft(ze.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new ft(ze.paint_building["building-vertical-scale"]),"building-cast-shadows":new ft(ze.paint_building["building-cast-shadows"]),"building-color":new vt(ze.paint_building["building-color"]),"building-emissive-strength":new vt(ze.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new ft(ze.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new ft(ze.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new ft(ze.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new ft(ze.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new ft(ze.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new bI(s)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(s){return!0}queryRadius(s){return 0}queryIntersectsFeature(s,e,i,a,u,f,m,_,b,S){let I=this.layout.get("building-height").evaluate(e,i);const C=this.layout.get("building-base").evaluate(e,i),k=s.tile.getBucket(this).getFootprint(e);if(k){if(k.hiddenFlags!==0)return!1;I=k.height}const[M,R]=WE(f,a,C,I,new at(0,0),m,null,[0,0],1,f.center.lat,s.tileID.canonical),F=s.queryGeometry;return HE(M,R,F.isPointQuery()?F.screenBounds:F.screenGeometry)}},line:class extends as{constructor(s,e,i,a){const u=RI();super(s,u,e,i,a),u.layout&&(this.layout=new os(u.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ku,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(s,e){super.recalculate(s,e),this.paint._values["line-floorwidth"]=(()=>{if(cg)return cg;const i=RI();return cg=new Yz(i.paint.properties["line-width"].specification),cg.useIntegerZoom=!0,cg})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Ab(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,e,i){const a=PI(this);return{config:new L(this,{zoom:e,lut:i}),defines:a,overrideFog:!1}}queryRadius(s){const e=s,i=DI(Zl("line-width",this,e),Zl("line-gap-width",this,e)),a=Zl("line-offset",this,e);return i/2+Math.abs(a)+Jd(this.paint.get("line-translate"))}queryIntersectsFeature(s,e,i,a,u,f){if(s.queryGeometry.isAboveHorizon)return!1;const m=I2(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,s.pixelToTileUnitsFactor),_=s.pixelToTileUnitsFactor/2*DI(this.paint.get("line-width").evaluate(e,i),this.paint.get("line-gap-width").evaluate(e,i)),b=this.paint.get("line-offset").evaluate(e,i);return b&&(a=function(S,I){const C=[],k=new at(0,0);for(let M=0;M<S.length;M++){const R=S[M],F=[];for(let $=0;$<R.length;$++){const U=R[$],H=R[$+1],X=$===0?k:U.sub(R[$-1])._unit()._perp(),Q=$===R.length-1?k:H.sub(U)._unit()._perp(),ae=X._add(Q)._unit();ae._mult(1/(ae.x*Q.x+ae.y*Q.y)),F.push(ae._mult(I)._add(U))}C.push(F)}return C}(a,b*s.pixelToTileUnitsFactor)),function(S,I,C){for(let k=0;k<I.length;k++){const M=I[k];if(S.length>=3){for(let R=0;R<M.length;R++)if(js(S,M[R]))return!0}if(Hr(S,M,C))return!0}return!1}(m,a,_)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:Qv,background:class extends as{constructor(s,e,i,a){super(s,{layout:EA||(EA=new Cr({visibility:new ft(ze.layout_background.visibility)})),paint:IA||(IA=new Cr({"background-pitch-alignment":new ft(ze.paint_background["background-pitch-alignment"]),"background-color":new ft(ze.paint_background["background-color"]),"background-pattern":new ft(ze.paint_background["background-pattern"]),"background-opacity":new ft(ze.paint_background["background-opacity"]),"background-emissive-strength":new ft(ze.paint_background["background-emissive-strength"]),"background-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,e,i){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:PA,"raster-particle":BA,sky:class extends as{constructor(s,e,i,a){super(s,{layout:DA||(DA=new Cr({visibility:new ft(ze.layout_sky.visibility)})),paint:OA||(OA=new Cr({"sky-type":new ft(ze.paint_sky["sky-type"]),"sky-atmosphere-sun":new ft(ze.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ft(ze.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ft(ze.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ft(ze.paint_sky["sky-gradient-radius"]),"sky-gradient":new jc(ze.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ft(ze.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ft(ze.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ft(ze.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Gm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(s,e){if(this.paint.get("sky-type")==="atmosphere"){const a=this.paint.get("sky-atmosphere-sun"),u=!a,f=s.style.light,m=f.properties.get("position");return u&&f.properties.get("anchor")==="viewport"&&Kt("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Kb(m.azimuthal,90-m.polar,e):Kb(a[0],90-a[1],e)}const i=this.paint.get("sky-gradient-center");return Kb(i[0],90-i[1],e)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends as{constructor(s,e,i,a){super(s,{paint:zA||(zA=new Cr({}))},e,null)}},model:class extends as{constructor(s,e,i,a){super(s,{layout:UA||(UA=new Cr({visibility:new ft(ze.layout_model.visibility),"model-id":new vt(ze.layout_model["model-id"]),"model-allow-density-reduction":new ft(ze.layout_model["model-allow-density-reduction"])})),paint:VA||(VA=new Cr({"model-opacity":new vt(ze.paint_model["model-opacity"]),"model-rotation":new vt(ze.paint_model["model-rotation"]),"model-scale":new vt(ze.paint_model["model-scale"]),"model-translation":new vt(ze.paint_model["model-translation"]),"model-color":new vt(ze.paint_model["model-color"]),"model-color-mix-intensity":new vt(ze.paint_model["model-color-mix-intensity"]),"model-type":new ft(ze.paint_model["model-type"]),"model-cast-shadows":new ft(ze.paint_model["model-cast-shadows"]),"model-receive-shadows":new ft(ze.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new ft(ze.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new vt(ze.paint_model["model-emissive-strength"]),"model-roughness":new vt(ze.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new vt(ze.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new ft(ze.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new ft(ze.paint_model["model-front-cutoff"]),"model-elevation-reference":new ft(ze.paint_model["model-elevation-reference"]),"model-color-use-theme":new vt({type:"string",default:"default","property-type":"data-driven"})}))},e,i,a),this.layer=s,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Jb(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof r0?8191:0}queryRenderedFeatures(s,e,i){const a=e.getSource();if(!(a&&a instanceof Ph))return{};const u=a,f={};f[this.id]=[];const m=f[this.id];let _=0;for(const b of u.models){const S=e.getFeatureState(this.sourceLayer,b.id),I={type:"Unknown",id:b.id,properties:b.featureProperties},C=this.paint.get("model-rotation").evaluate(I,S),k=this.paint.get("model-scale").evaluate(I,S),M=this.paint.get("model-translation").evaluate(I,S),R=this.paint.get("model-elevation-reference");let F=[];Bv(F,b,i,b.position,C,k,M,R==="ground",R==="ground",!1),i.projection.name==="globe"&&(F=zv(F,i));const $=K([],i.projMatrix,F),U=xb(s.isPointQuery()?s.screenBounds:s.screenGeometry,i,$,b.aabb);if(U!=null){const H=new Lh(void 0,0,0,0,b.id);H.layer=this.layer,H.properties=structuredClone(b.featureProperties),H.properties.layer=this.id,H.properties.uri=b.uri,H.properties.orientation=b.orientation,H.sourceLayer=this.sourceLayer,H.geometry={type:"Point",coordinates:[b.position.lng,b.position.lat]},H.state=S,H.source=this.source,m.push({featureIndex:_,feature:H,intersectionZ:U})}++_}return f}queryIntersectsFeature(s,e,i,a,u,f,m,_,b,S){if(!this.modelManager)return!1;const I=this.modelManager,C=s.tile.getBucket(this);if(!(C&&C instanceof Jb))return!1;for(const k in C.instancesPerModel){const M=C.instancesPerModel[k],R=e.id!==void 0?e.id:e.properties&&e.properties.hasOwnProperty("id")?e.properties.id:void 0;if(M.idToFeaturesIndex.hasOwnProperty(R)){const F=M.features[M.idToFeaturesIndex[R]],$=I.getModel(k,S||this.scope);if(!$)return!1;let U=[];const H=new le(0,0),X=C.canonical;let Q=Number.MAX_VALUE;for(let ae=0;ae<F.instancedDataCount;++ae){const oe=16*(F.instancedDataOffset+ae),ge=M.instancedDataArray.float32,ye=[ge[oe+4],ge[oe+5],ge[oe+6]];ew(X,H,Math.floor(ge[oe]),Math.floor(ge[oe+1])),Bv(U,$,f,H,F.rotation,F.scale,ye,!1,!1,!1),f.projection.name==="globe"&&(U=zv(U,f));const me=K([],f.projMatrix,U),Se=s.queryGeometry,Ae=xb(Se.isPointQuery()?Se.screenBounds:Se.screenGeometry,f,me,$.aabb);Ae!=null&&(Q=Math.min(Ae,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(s,e,i){return!(!this.layout||e.isDataDriven()||i.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const e=this._transitionablePaint._values[s];return e!=null&&e.value!=null&&e.value.expression!=null&&e.value.expression instanceof Vl}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends as{constructor(s,e,i,a){super(s,{layout:gE||(gE=new Cr({"clip-layer-types":new ft(ze.layout_clip["clip-layer-types"]),"clip-layer-scope":new ft(ze.layout_clip["clip-layer-scope"]),visibility:new ft(ze.layout_clip.visibility)})),paint:_E||(_E=new Cr({}))},e,i,a)}recalculate(s,e){super.recalculate(s,e)}createBucket(s){return new yE(s)}is3D(s){return!0}}},tw=new Hi(0,0,0);function nB(s,e,i){s===1&&e.icons.push(function(a,u){return function(f){if(f.usvg_tree.height||(f.usvg_tree.height=f.usvg_tree.width),!f.metadata)return f;const{metadata:m}=f;if(m.content_area){const{content_area:_}=m;_.left==null&&(_.left=0),_.top==null&&(_.top=_.left),_.width==null&&(_.width=f.usvg_tree.width),_.height==null&&(_.height=_.width)}if(m.text_placeholder){const{text_placeholder:_}=m;_.top==null&&(_.top=_.left),_.height==null&&(_.height=_.width)}return m.stretch_x&&m.stretch_x.length&&qA(m,"x"),m.stretch_y&&m.stretch_y.length&&qA(m,"y"),f}(a.readFields(sB,{name:void 0},u))}(i,i.readVarint()+i.pos))}function qA(s,e){const i=[],a=s[`stretch_${e}`];let u=null;for(let f=0;f<a.length;f++)u===null?u=i.length===0?a[0]:i[i.length-1][1]+a[f]:(i.push([u,u+a[f]]),u=null);s[`stretch_${e}_areas`]=i}function sB(s,e,i){s===1?e.name=i.readString():s===2?e.metadata=function(a,u){return a.readFields(oB,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},u)}(i,i.readVarint()+i.pos):s===3&&(e.usvg_tree=function(a,u){return a.readFields(cB,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},u)}(i,i.readVarint()+i.pos),e.data="usvg_tree")}function oB(s,e,i){s===1?e.stretch_x=i.readPackedVarint():s===2?e.stretch_y=i.readPackedVarint():s===3?e.content_area=ZA(i,i.readVarint()+i.pos):s===4?e.variables.push(function(a,u){return a.readFields(lB,{name:void 0},u)}(i,i.readVarint()+i.pos)):s===5&&(e.text_placeholder=ZA(i,i.readVarint()+i.pos))}function ZA(s,e){return s.readFields(aB,{},e)}function aB(s,e,i){s===1?e.left=i.readVarint():s===2?e.width=i.readVarint():s===3?e.top=i.readVarint():s===4&&(e.height=i.readVarint())}function lB(s,e,i){s===1?e.name=i.readString():s===2&&(e.rgb_color=o0(i.readVarint()),e.value="rgb_color")}function cB(s,e,i){s===1?e.width=e.height=i.readVarint():s===2?e.height=i.readVarint():s===3?e.children.push(n0(i,i.readVarint()+i.pos)):s===4?e.linear_gradients.push(function(a,u){return a.readFields(gB,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},u)}(i,i.readVarint()+i.pos)):s===5?e.radial_gradients.push(function(a,u){return a.readFields(yB,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},u)}(i,i.readVarint()+i.pos)):s===7?e.clip_paths.push(function(a,u){return a.readFields(vB,{children:[]},u)}(i,i.readVarint()+i.pos)):s===8&&e.masks.push(function(a,u){const f=a.readFields(xB,{left:0,width:20,mask_type:1,children:[]},u);return f.height==null&&(f.height=f.width),f.top==null&&(f.top=f.left),f}(i,i.readVarint()+i.pos))}function n0(s,e){return s.readFields(uB,{},e)}function uB(s,e,i){s===1?(e.group=function(a,u){return a.readFields(hB,{opacity:255,children:[]},u)}(i,i.readVarint()+i.pos),e.node="group"):s===2&&(e.path=function(a,u){return a.readFields(fB,{paint_order:1,commands:[],step:1,diffs:[],rule:1},u)}(i,i.readVarint()+i.pos),e.node="path")}function hB(s,e,i){s===1?e.transform=s0(i,i.readVarint()+i.pos):s===2?e.opacity=i.readVarint():s===5?e.clip_path_idx=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(n0(i,i.readVarint()+i.pos))}function s0(s,e){return s.readFields(dB,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},e)}function dB(s,e,i){s===1?e.sx=i.readFloat():s===2?e.ky=i.readFloat():s===3?e.kx=i.readFloat():s===4?e.sy=i.readFloat():s===5?e.tx=i.readFloat():s===6&&(e.ty=i.readFloat())}function fB(s,e,i){s===1?e.fill=function(a,u){return a.readFields(pB,{rgb_color:tw,paint:"rgb_color",opacity:255},u)}(i,i.readVarint()+i.pos):s===2?e.stroke=function(a,u){return a.readFields(mB,{rgb_color:tw,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},u)}(i,i.readVarint()+i.pos):s===3?e.paint_order=i.readVarint():s===5?i.readPackedVarint(e.commands):s===6?e.step=i.readFloat():s===7?i.readPackedSVarint(e.diffs):s===8&&(e.rule=i.readVarint())}function pB(s,e,i){s===1?(e.rgb_color=o0(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5&&(e.opacity=i.readVarint())}function o0(s){return new Hi((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function mB(s,e,i){s===1?(e.rgb_color=o0(i.readVarint()),e.paint="rgb_color"):s===2?(e.linear_gradient_idx=i.readVarint(),e.paint="linear_gradient_idx"):s===3?(e.radial_gradient_idx=i.readVarint(),e.paint="radial_gradient_idx"):s===5?i.readPackedFloat(e.dasharray):s===6?e.dashoffset=i.readFloat():s===7?e.miterlimit=i.readFloat():s===8?e.opacity=i.readVarint():s===9?e.width=i.readFloat():s===10?e.linecap=i.readVarint():s===11&&(e.linejoin=i.readVarint())}function gB(s,e,i){s===1?e.transform=s0(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(XA(i,i.readVarint()+i.pos)):s===4?e.x1=i.readFloat():s===5?e.y1=i.readFloat():s===6?e.x2=i.readFloat():s===7&&(e.y2=i.readFloat())}function XA(s,e){return s.readFields(_B,{offset:0,opacity:255,rgb_color:tw},e)}function _B(s,e,i){s===1?e.offset=i.readFloat():s===2?e.opacity=i.readVarint():s===3&&(e.rgb_color=o0(i.readVarint()))}function yB(s,e,i){s===1?e.transform=s0(i,i.readVarint()+i.pos):s===2?e.spread_method=i.readVarint():s===3?e.stops.push(XA(i,i.readVarint()+i.pos)):s===4?e.cx=i.readFloat():s===5?e.cy=i.readFloat():s===6?e.r=i.readFloat():s===7?e.fx=i.readFloat():s===8?e.fy=i.readFloat():s===9&&(e.fr=i.readFloat())}function vB(s,e,i){s===1?e.transform=s0(i,i.readVarint()+i.pos):s===2?e.clip_path_idx=i.readVarint():s===3&&e.children.push(n0(i,i.readVarint()+i.pos))}function xB(s,e,i){s===1?e.left=e.top=i.readFloat():s===2?e.width=e.height=i.readFloat():s===3?e.top=i.readFloat():s===4?e.height=i.readFloat():s===5?e.mask_type=i.readVarint():s===6?e.mask_idx=i.readVarint():s===7&&e.children.push(n0(i,i.readVarint()+i.pos))}class bB{static calculate(e={},i=[]){const a=new Map,u=new Map;if(Object.keys(e).length===0)return a;i.forEach(f=>{u.set(f.name,f.rgb_color||new Hi(0,0,0))});for(const[f,m]of Object.entries(e))u.has(f)?a.set(u.get(f).toString(),m):console.warn(`Ignoring unknown image variable "${f}"`);return a}}function yf(s,e=255,i){const a=e/255,u=s.toString(),f=i.has(u)?i.get(u).clone():s.clone();return f.a*=a,f.toString()}function Tg(s,e){if(!Ml()){const i=document.createElement("canvas");return i.width=s,i.height=e,i}return new OffscreenCanvas(s,e)}let iw,Eg=null;function rw(s,e,i,a,u){for(const f of a.children)KA(s,e,i,f,u)}function KA(s,e,i,a,u){a.group?(s.save(),function(f,m,_,b,S){const I=b.mask_idx!=null?_.masks[b.mask_idx]:null,C=b.clip_path_idx!=null?_.clip_paths[b.clip_path_idx]:null;if(b.transform&&(m=vf(b.transform).preMultiplySelf(m)),!function(R,F,$){return R.opacity!==255||F||$}(b,C!=null,I!=null))return void rw(f,m,_,b,S);const k=Tg(f.canvas.width,f.canvas.height),M=k.getContext("2d");rw(M,m,_,b,S),C&&rC(M,m,_,C),I&&nC(M,m,_,I,S),f.globalAlpha=b.opacity/255,f.drawImage(k,0,0)}(s,e,i,a.group,u),s.restore()):a.path&&(s.save(),function(f,m,_,b,S){f.setTransform(m),b.paint_order===1?(YA(f,_,b,S),QA(f,_,b,S)):(QA(f,_,b,S),YA(f,_,b,S))}(s,e,i,a.path,u),s.restore())}function YA(s,e,i,a){const u=i.fill;if(!u)return;const f=u.opacity/255;switch(s.save(),s.beginPath(),sC(i,s),u.paint){case"rgb_color":s.fillStyle=yf(u.rgb_color,u.opacity,a);break;case"linear_gradient_idx":{const m=e.linear_gradients[u.linear_gradient_idx];m.transform&&s.setTransform(vf(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=eC(s,m,f,a);break}case"radial_gradient_idx":{const m=e.radial_gradients[u.radial_gradient_idx];m.transform&&s.setTransform(vf(m.transform).preMultiplySelf(s.getTransform())),s.fillStyle=tC(s,m,f,a)}}s.fill(JA(i)),s.restore()}function JA(s){return s.rule===1?"nonzero":s.rule===2?"evenodd":void 0}function QA(s,e,i,a){const u=i.stroke;if(!u)return;const f=oC(i);s.lineWidth=u.width,s.miterLimit=u.miterlimit,s.setLineDash(u.dasharray),s.lineDashOffset=u.dashoffset;const m=u.opacity/255;switch(u.paint){case"rgb_color":s.strokeStyle=yf(u.rgb_color,u.opacity,a);break;case"linear_gradient_idx":s.strokeStyle=eC(s,e.linear_gradients[u.linear_gradient_idx],m,a,!0);break;case"radial_gradient_idx":s.strokeStyle=tC(s,e.radial_gradients[u.radial_gradient_idx],m,a,!0)}switch(u.linejoin){case 2:case 1:s.lineJoin="miter";break;case 3:s.lineJoin="round";break;case 4:s.lineJoin="bevel"}switch(u.linecap){case 1:s.lineCap="butt";break;case 2:s.lineCap="round";break;case 3:s.lineCap="square"}s.stroke(f)}function eC(s,e,i,a,u=!1){if(e.stops.length===1){const k=e.stops[0];return yf(k.rgb_color,k.opacity*i,a)}const{x1:f,y1:m,x2:_,y2:b}=e;let S=new DOMPoint(f,m),I=new DOMPoint(_,b);if(u){const k=vf(e.transform);S=k.transformPoint(S),I=k.transformPoint(I)}const C=s.createLinearGradient(S.x,S.y,I.x,I.y);for(const k of e.stops)C.addColorStop(k.offset,yf(k.rgb_color,k.opacity*i,a));return C}function tC(s,e,i,a,u=!1){if(e.stops.length===1){const U=e.stops[0];return yf(U.rgb_color,U.opacity*i,a)}const f=vf(e.transform),{fx:m,fy:_,fr:b,cx:S,cy:I,r:C}=e;let k=new DOMPoint(m,_),M=new DOMPoint(S,I),R=b,F=C;if(u){k=f.transformPoint(k),M=f.transformPoint(M);const U=(f.a+f.d)/2;R=b*U,F=e.r*U}const $=s.createRadialGradient(k.x,k.y,R,M.x,M.y,F);for(const U of e.stops)$.addColorStop(U.offset,yf(U.rgb_color,U.opacity*i,a));return $}function iC(s,e,i,a){const u=a.transform?vf(a.transform).preMultiplySelf(e):e,f=Tg(s.canvas.width,s.canvas.height),m=f.getContext("2d");for(const b of a.children)if(b.group)iC(m,u,i,b.group);else if(b.path){const S=b.path,I=new Path2D;I.addPath(oC(S),u),m.fill(I,JA(S))}const _=a.clip_path_idx!=null?i.clip_paths[a.clip_path_idx]:null;_&&rC(m,u,i,_),s.globalCompositeOperation="source-over",s.drawImage(f,0,0)}function rC(s,e,i,a){const u=Tg(s.canvas.width,s.canvas.height);iC(u.getContext("2d"),e,i,a),s.globalCompositeOperation="destination-in",s.drawImage(u,0,0)}function nC(s,e,i,a,u){if(a.children.length===0)return;const f=a.mask_idx!=null?i.masks[a.mask_idx]:null;f&&nC(s,e,i,f,u);const m=s.canvas.width,_=s.canvas.height,b=Tg(m,_),S=b.getContext("2d"),I=a.width,C=a.height,k=a.left,M=a.top,R=new Path2D,F=new Path2D;F.rect(k,M,I,C),R.addPath(F,e),S.clip(R);for(const H of a.children)KA(S,e,i,H,u);const $=S.getImageData(0,0,m,_),U=$.data;if(a.mask_type===1)for(let H=0;H<U.length;H+=4)U[H+3]=U[H+3]/255*(.2126*U[H]+.7152*U[H+1]+.0722*U[H+2]);S.putImageData($,0,0),s.globalCompositeOperation="destination-in",s.drawImage(b,0,0)}function vf(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function sC(s,e){const i=s.step;let a=s.diffs[0]*i,u=s.diffs[1]*i;e.moveTo(a,u);for(let f=0,m=2;f<s.commands.length;f++)switch(s.commands[f]){case 1:a+=s.diffs[m++]*i,u+=s.diffs[m++]*i,e.moveTo(a,u);break;case 2:a+=s.diffs[m++]*i,u+=s.diffs[m++]*i,e.lineTo(a,u);break;case 3:{const _=a+s.diffs[m++]*i,b=u+s.diffs[m++]*i;a=_+s.diffs[m++]*i,u=b+s.diffs[m++]*i,e.quadraticCurveTo(_,b,a,u);break}case 4:{const _=a+s.diffs[m++]*i,b=u+s.diffs[m++]*i,S=_+s.diffs[m++]*i,I=b+s.diffs[m++]*i;a=S+s.diffs[m++]*i,u=I+s.diffs[m++]*i,e.bezierCurveTo(_,b,S,I,a,u);break}case 5:e.closePath();break}return e}function oC(s){return sC(s,new Path2D)}class a0{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const i=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,i),i}put(e,i){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,i)}delete(e){this.cache.delete(e)}}Ct(a0,"LRUCache");class nw{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new jn(e,e.data)}getFromCache(e,i,a){return this.cacheMap.has(a)||this.cacheMap.set(a,new a0(150)),this.cacheMap.get(a).get(Hl(e.toString(),i))}setInCache(e,i,a,u){this.cacheDependenciesMap.has(u)||this.cacheDependenciesMap.set(u,new Map),this.cacheMap.has(u)||this.cacheMap.set(u,new a0(150));const f=this.cacheDependenciesMap.get(u),m=Hl(e.id.toString(),a);f.get(m)||f.set(m,new Set);const _=this.cacheMap.get(u),b=e.toString();f.get(m).add(b),_.put(Hl(e.toString(),a),i)}removeImagesFromCacheByIds(e,i,a=0){if(!this.cacheMap.has(a)||!this.cacheDependenciesMap.has(a))return;const u=this.cacheMap.get(a),f=this.cacheDependenciesMap.get(a);for(const m of e){const _=Hl(m.toString(),i);if(f.has(_)){for(const b of f.get(_))u.delete(b);f.delete(_)}}}rasterize(e,i,a,u){const f=this.getFromCache(e,a,u);if(f)return f.clone();const m=function(b,S){const I=bB.calculate(S.params,b.metadata?b.metadata.variables:[]),C=b.usvg_tree,k=C.width,M=C.height,R=Math.max(1,Math.round(k*S.sx)),F=Math.max(1,Math.round(M*S.sy)),$=new DOMMatrix([R/k,0,0,F/M,0,0]);return Eg===null&&(Eg=Tg(10,10),iw=Eg.getContext("2d",{willReadFrequently:!0})),Eg.width=R,Eg.height=F,rw(iw,$,C,C,I),iw.getImageData(0,0,R,F)}(i.icon,e),_=nw._getImage(m);return this.setInCache(e,_,a,u),_.clone()}}class aC{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,i){const a=this.toIdx(e,i);return{min:this.minimums[a],max:this.maximums[a]}}isLeaf(e,i){return this.leaves[this.toIdx(e,i)]}toIdx(e,i){return i*this.size+e}}function lC(s,e,i,a){let u=0,f=Number.MAX_VALUE;for(let m=0;m<3;m++)if(Math.abs(a[m])<1e-15){if(i[m]<s[m]||i[m]>e[m])return null}else{const _=1/a[m];let b=(s[m]-i[m])*_,S=(e[m]-i[m])*_;if(b>S){const I=b;b=S,S=I}if(b>u&&(u=b),S<f&&(f=S),u>f)return null}return u}function cC(s,e,i,a,u,f,m,_,b,S,I){const C=a-s,k=u-e,M=f-i,R=m-s,F=_-e,$=b-i,U=I[1]*$-I[2]*F,H=I[2]*R-I[0]*$,X=I[0]*F-I[1]*R,Q=C*U+k*H+M*X;if(Math.abs(Q)<1e-15)return null;const ae=1/Q,oe=S[0]-s,ge=S[1]-e,ye=S[2]-i,me=(oe*U+ge*H+ye*X)*ae;if(me<0||me>1)return null;const Se=ge*M-ye*k,Ae=ye*C-oe*M,Ze=oe*k-ge*C,Ge=(I[0]*Se+I[1]*Ae+I[2]*Ze)*ae;return Ge<0||me+Ge>1?null:(R*Se+F*Ae+$*Ze)*ae}function uC(s,e,i){return(s-e)/(i-e)}function hC(s,e,i,a,u,f,m,_,b){const S=1<<i,I=f-a,C=m-u,k=(s+1)/S*I+a,M=(e+0)/S*C+u,R=(e+1)/S*C+u;_[0]=(s+0)/S*I+a,_[1]=M,b[0]=k,b[1]=R}class dC{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(f){const m=Math.ceil(Math.log2(f.dim/8)),_=[];let b=Math.ceil(Math.pow(2,m));const S=1/b,I=(M,R,F,$,U)=>{const H=$?1:0,X=(M+1)*F-H,Q=R*F,ae=(R+1)*F-H;U[0]=M*F,U[1]=Q,U[2]=X,U[3]=ae};let C=new aC(b);const k=[];for(let M=0;M<b*b;M++){I(M%b,Math.floor(M/b),S,!1,k);const R=tu(k[0],k[1],f),F=tu(k[2],k[1],f),$=tu(k[2],k[3],f),U=tu(k[0],k[3],f);C.minimums.push(Math.min(R,F,$,U)),C.maximums.push(Math.max(R,F,$,U)),C.leaves.push(1)}for(_.push(C),b/=2;b>=1;b/=2){const M=_[_.length-1];C=new aC(b);for(let R=0;R<b*b;R++){I(R%b,Math.floor(R/b),2,!0,k);const F=M.getElevation(k[0],k[1]),$=M.getElevation(k[2],k[1]),U=M.getElevation(k[2],k[3]),H=M.getElevation(k[0],k[3]),X=M.isLeaf(k[0],k[1]),Q=M.isLeaf(k[2],k[1]),ae=M.isLeaf(k[2],k[3]),oe=M.isLeaf(k[0],k[3]),ge=Math.min(F.min,$.min,U.min,H.min),ye=Math.max(F.max,$.max,U.max,H.max),me=X&&Q&&ae&&oe;C.maximums.push(ye),C.minimums.push(ge),C.leaves.push(ye-ge<=5&&me?1:0)}_.push(C)}return _}(this.dem),a=i.length-1,u=i[a];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(i,0,0,a,0)}raycastRoot(e,i,a,u,f,m,_=1){return lC([e,i,-100],[a,u,this.maximums[0]*_],f,m)}raycast(e,i,a,u,f,m,_=1){if(!this.nodeCount)return null;const b=this.raycastRoot(e,i,a,u,f,m,_);if(b==null)return null;const S=[],I=[],C=[],k=[],M=[{idx:0,t:b,nodex:0,nodey:0,depth:0}];for(;M.length>0;){const{idx:R,t:F,nodex:$,nodey:U,depth:H}=M.pop();if(this.leaves[R]){hC($,U,H,e,i,a,u,C,k);const Q=1<<H,ae=($+0)/Q,oe=($+1)/Q,ge=(U+0)/Q,ye=(U+1)/Q,me=tu(ae,ge,this.dem)*_,Se=tu(oe,ge,this.dem)*_,Ae=tu(oe,ye,this.dem)*_,Ze=tu(ae,ye,this.dem)*_,Ge=cC(C[0],C[1],me,k[0],C[1],Se,k[0],k[1],Ae,f,m),qe=cC(k[0],k[1],Ae,C[0],k[1],Ze,C[0],C[1],me,f,m),et=Math.min(Ge!==null?Ge:Number.MAX_VALUE,qe!==null?qe:Number.MAX_VALUE);if(et!==Number.MAX_VALUE)return et;{const Je=di([],f,m,F);if(fC(me,Se,Ze,Ae,uC(Je[0],C[0],k[0]),uC(Je[1],C[1],k[1]))>=Je[2])return F}continue}let X=0;for(let Q=0;Q<this._siblingOffset.length;Q++){hC(($<<1)+this._siblingOffset[Q][0],(U<<1)+this._siblingOffset[Q][1],H+1,e,i,a,u,C,k),C[2]=-100,k[2]=this.maximums[this.childOffsets[R]+Q]*_;const ae=lC(C,k,f,m);if(ae!=null){const oe=ae;S[Q]=oe;let ge=!1;for(let ye=0;ye<X&&!ge;ye++)oe>=S[I[ye]]&&(I.splice(ye,0,Q),ge=!0);ge||(I[X]=Q),X++}}for(let Q=0;Q<X;Q++){const ae=I[Q];M.push({idx:this.childOffsets[R]+ae,t:S[ae],nodex:($<<1)+this._siblingOffset[ae][0],nodey:(U<<1)+this._siblingOffset[ae][1],depth:H+1})}}return null}_addNode(e,i,a){return this.minimums.push(e),this.maximums.push(i),this.leaves.push(a),this.childOffsets.push(0),this.nodeCount++}_construct(e,i,a,u,f){if(e[u].isLeaf(i,a)===1)return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const m=u-1,_=e[m];let b=0,S=0;for(let I=0;I<this._siblingOffset.length;I++){const C=2*i+this._siblingOffset[I][0],k=2*a+this._siblingOffset[I][1],M=_.getElevation(C,k),R=_.isLeaf(C,k),F=this._addNode(M.min,M.max,R);R&&(b|=1<<I),S||(S=F)}for(let I=0;I<this._siblingOffset.length;I++)b&1<<I||this._construct(e,2*i+this._siblingOffset[I][0],2*a+this._siblingOffset[I][1],m,S+I)}}function fC(s,e,i,a,u,f){return qt(qt(s,i,f),qt(e,a,f),u)}function tu(s,e,i){const a=i.dim,u=pe(s*a-.5,0,a-1),f=pe(e*a-.5,0,a-1),m=Math.floor(u),_=Math.floor(f),b=Math.min(m+1,a-1),S=Math.min(_+1,a-1);return fC(i.get(m,_),i.get(b,_),i.get(m,S),i.get(b,S),u-m,f-_)}const wB={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function SB(s,e,i){return(256*s*256+256*e+i)/10-1e4}function TB(s,e,i){return 256*s+e+i/256-32768}class l0{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,i,a,u=!1){if(this.uid=e,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(a&&a!=="mapbox"&&a!=="terrarium")return void Kt(`"${a}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const f=this.dim=i.height-2,m=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=u,this._modifiedForSources={},!u){for(let b=0;b<f;b++)m[this._idx(-1,b)]=m[this._idx(0,b)],m[this._idx(f,b)]=m[this._idx(f-1,b)],m[this._idx(b,-1)]=m[this._idx(b,0)],m[this._idx(b,f)]=m[this._idx(b,f-1)];m[this._idx(-1,-1)]=m[this._idx(0,0)],m[this._idx(f,-1)]=m[this._idx(f-1,0)],m[this._idx(-1,f)]=m[this._idx(0,f-1)],m[this._idx(f,f)]=m[this._idx(f-1,f-1)]}const _=a==="terrarium"?TB:SB;for(let b=0;b<m.length;++b){const S=4*b;this.floatView[b]=_(this.pixels[S],this.pixels[S+1],this.pixels[S+2])}this._timestamp=Zs.now()}_buildQuadTree(){this._tree=new dC(this)}get(e,i,a=!1){a&&(e=pe(e,-1,this.dim),i=pe(i,-1,this.dim));const u=this._idx(e,i);return this.floatView[u]}set(e,i,a){const u=this._idx(e,i),f=this.floatView[u];return this.floatView[u]=a,a-f}static getUnpackVector(e){return wB[e]}_idx(e,i){if(e<-1||e>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(e+1)}static pack(e,i){const a=[0,0,0,0],u=l0.getUnpackVector(i);let f=Math.floor((e+u[3])/u[2]);return a[2]=f%256,f=Math.floor(f/256),a[1]=f%256,f=Math.floor(f/256),a[0]=f,a}getPixels(){return new Y2({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,i,a){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=i*this.dim,f=i*this.dim+this.dim,m=a*this.dim,_=a*this.dim+this.dim;switch(i){case-1:u=f-1;break;case 1:f=u+1}switch(a){case-1:m=_-1;break;case 1:_=m+1}const b=-i*this.dim,S=-a*this.dim;for(let I=m;I<_;I++)for(let C=u;C<f;C++){const k=4*this._idx(C,I),M=4*this._idx(C+b,I+S);this.pixels[k+0]=e.pixels[M+0],this.pixels[k+1]=e.pixels[M+1],this.pixels[k+2]=e.pixels[M+2],this.pixels[k+3]=e.pixels[M+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function EB(s,e,i){s===1?e.headerLength=i.readFixed32():s===2?e.x=i.readVarint():s===3?e.y=i.readVarint():s===4?e.z=i.readVarint():s===5&&e.layers.push(function(a,u){return a.readFields(LB,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},u)}(i,i.readVarint()+i.pos))}function IB(s,e,i){s===1?(e.delta_filter=function(a,u){return a.readFields(AB,{blockSize:0},u)}(i,i.readVarint()+i.pos),e.filter="delta_filter"):s===2?(i.readVarint(),e.filter="zigzag_filter"):s===3?(i.readVarint(),e.filter="bitshuffle_filter"):s===4&&(i.readVarint(),e.filter="byteshuffle_filter")}function AB(s,e,i){s===1&&(e.blockSize=i.readVarint())}function CB(s,e,i){s===1?(i.readVarint(),e.codec="gzip_data"):s===2?(i.readVarint(),e.codec="jpeg_image"):s===3?(i.readVarint(),e.codec="webp_image"):s===4&&(i.readVarint(),e.codec="png_image")}function kB(s,e,i){let a=0,u=0;s===1?e.firstByte=i.readFixed64():s===2?e.lastByte=i.readFixed64():s===3?e.filters.push(function(f,m){return f.readFields(IB,{},m)}(i,i.readVarint()+i.pos)):s===4?e.codec=function(f,m){return f.readFields(CB,{},m)}(i,i.readVarint()+i.pos):s===5?u=i.readFloat():s===6?a=i.readFloat():s===7?e.bands.push(i.readString()):s===8?e.offset=i.readDouble():s===9&&(e.scale=i.readDouble()),e.offset===0&&(e.offset=u),e.scale===0&&(e.scale=a)}function LB(s,e,i){s===1?e.version=i.readVarint():s===2?e.name=i.readString():s===3?e.units=i.readString():s===4?e.tileSize=i.readVarint():s===5?e.buffer=i.readVarint():s===6?e.pixelFormat=i.readVarint():s===7&&e.dataIndex.push(function(a,u){return a.readFields(kB,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},u)}(i,i.readVarint()+i.pos))}function PB(s,e,i){if(s===2)(function(a,u,f){a.readFields(MB,f,u)})(i,i.readVarint()+i.pos,e);else if(s===3)throw new Error("Not implemented")}function MB(s,e,i){if(s===1){let a=0;const u=i.readVarint()+i.pos;for(;i.pos<u;)e[a++]=i.readVarint()}}function RB(s,e){if(e.length!==4)throw new Error(`Expected data of dimension 4 but got ${e.length}.`);let i=e[3];for(let a=2;a>=1;a--){const u=a===1?1:0,f=a===2?1:0;for(let m=0;m<e[0];m++){const _=e[1]*m;for(let b=u;b<e[1];b++){const S=e[2]*(b+_);for(let I=f;I<e[2];I++){const C=e[3]*(I+S);for(let k=0;k<e[3];k++){const M=C+k;s[M]+=s[M-i]}}}}i*=e[a]}return s}function DB(s){for(let e=0,i=s.length;e<i;e++)s[e]=s[e]>>>1^-(1&s[e]);return s}function OB(s,e){switch(e){case"uint32":return s;case"uint16":for(let i=0;i<s.length;i+=2){const a=s[i],u=s[i+1];s[i]=(240&a)>>4|(61440&a)>>8|(240&u)<<4|61440&u,s[i+1]=15&a|(3840&a)>>4|(15&u)<<8|(3840&u)<<4}return s;case"uint8":for(let i=0;i<s.length;i+=4){const a=s[i],u=s[i+1],f=s[i+2],m=s[i+3];s[i+0]=(192&a)>>6|(192&u)>>4|(192&f)>>2|192&m,s[i+1]=(48&a)>>4|(48&u)>>2|48&f|(48&m)<<2,s[i+2]=(12&a)>>2|12&u|(12&f)<<2|(12&m)<<4,s[i+3]=3&a|(3&u)<<2|(3&f)<<4|(3&m)<<6}return s;default:throw new Error(`Invalid pixel format, "${e}"`)}}Ct(l0,"DEMData"),Ct(dC,"DemMinMaxQuadTree",{omit:["dem"]});var Uo=Uint8Array,Ig=Uint16Array,zB=Int32Array,pC=new Uo([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),mC=new Uo([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),BB=new Uo([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),gC=function(s,e){for(var i=new Ig(31),a=0;a<31;++a)i[a]=e+=1<<s[a-1];var u=new zB(i[30]);for(a=1;a<30;++a)for(var f=i[a];f<i[a+1];++f)u[f]=f-i[a]<<5|a;return{b:i,r:u}},_C=gC(pC,2),yC=_C.b,FB=_C.r;yC[28]=258,FB[258]=28;for(var jB=gC(mC,0).b,vC=new Ig(32768),tn=0;tn<32768;++tn){var xf=(43690&tn)>>1|(21845&tn)<<1;vC[tn]=((65280&(xf=(61680&(xf=(52428&xf)>>2|(13107&xf)<<2))>>4|(3855&xf)<<4))>>8|(255&xf)<<8)>>1}var Ag=function(s,e,i){for(var a=s.length,u=0,f=new Ig(e);u<a;++u)s[u]&&++f[s[u]-1];var m,_=new Ig(e);for(u=1;u<e;++u)_[u]=_[u-1]+f[u-1]<<1;m=new Ig(1<<e);var b=15-e;for(u=0;u<a;++u)if(s[u])for(var S=u<<4|s[u],I=e-s[u],C=_[s[u]-1]++<<I,k=C|(1<<I)-1;C<=k;++C)m[vC[C]>>b]=S;return m},Cg=new Uo(288);for(tn=0;tn<144;++tn)Cg[tn]=8;for(tn=144;tn<256;++tn)Cg[tn]=9;for(tn=256;tn<280;++tn)Cg[tn]=7;for(tn=280;tn<288;++tn)Cg[tn]=8;var xC=new Uo(32);for(tn=0;tn<32;++tn)xC[tn]=5;var NB=Ag(Cg,9),UB=Ag(xC,5),sw=function(s){for(var e=s[0],i=1;i<s.length;++i)s[i]>e&&(e=s[i]);return e},Ua=function(s,e,i){var a=e/8|0;return(s[a]|s[a+1]<<8)>>(7&e)&i},ow=function(s,e){var i=e/8|0;return(s[i]|s[i+1]<<8|s[i+2]<<16)>>(7&e)},VB=function(s){return(s+7)/8|0},$B=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Va=function(s,e,i){var a=new Error(e||$B[s]);if(a.code=s,Error.captureStackTrace&&Error.captureStackTrace(a,Va),!i)throw a;return a},GB=new Uo(0),HB=typeof TextDecoder<"u"&&new TextDecoder;try{HB.decode(GB,{stream:!0})}catch{}const WB={gzip_data:"gzip"};class ma extends Error{constructor(e){super(e),this.name="MRTError"}}const qB={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},bC={uint32:1,uint16:2,uint8:4},ZB={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let aw;class c0{constructor(e=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const i=this.layers[e];if(!i)throw new ma(`Layer '${e}' not found`);return i}getHeaderLength(e){const i=new Uint8Array(e),a=new DataView(e);if(i[0]!==13)throw new ma("File is not a valid MRT.");return a.getUint32(1,!0)}parseHeader(e){const i=new Uint8Array(e),a=this.getHeaderLength(e);if(i.length<a)throw new ma(`Expected header with length >= ${a} but got buffer of length ${i.length}`);const u=new aw(i.subarray(0,a)).readFields(EB,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==u.x||this.y!==u.y||this.z!==u.z))throw new ma(`Invalid attempt to parse header ${u.z}/${u.x}/${u.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=u.x,this.y=u.y,this.z=u.z;for(const f of u.layers)this.layers[f.name]=new wC(f,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const i=[],a=this.getLayer(e.layerName);for(let u of e.blockIndices){const f=a.dataIndex[u],m=f.firstByte-e.firstByte,_=f.lastByte-e.firstByte;if(a._blocksInProgress.has(u))continue;const b={layerName:a.name,firstByte:m,lastByte:_,pixelFormat:a.pixelFormat,blockIndex:u,blockShape:[f.bands.length].concat(a.bandShape),buffer:a.buffer,codec:f.codec.codec,filters:f.filters.map(S=>S.filter)};a._blocksInProgress.add(u),i.push(b)}return new SC(i,()=>{i.forEach(u=>a._blocksInProgress.delete(u.blockIndex))},(u,f)=>{if(i.forEach(m=>a._blocksInProgress.delete(m.blockIndex)),u)throw u;f.forEach(m=>{this.getLayer(m.layerName).processDecodedData(m)})})}}class wC{constructor({version:e,name:i,units:a,tileSize:u,pixelFormat:f,buffer:m,dataIndex:_},b){if(this.version=e,this.version!==1)throw new ma(`Cannot parse raster layer encoded with MRT version ${e}`);this.name=i,this.units=a,this.tileSize=u,this.buffer=m,this.pixelFormat=qB[f],this.dataIndex=_,this.bandShape=[u+2*m,u+2*m,bC[this.pixelFormat]],this._decodedBlocks=new a0(b?b.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return bC[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:e})=>e).flat()}processDecodedData(e){const i=e.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,e.data)}getBlockForBand(e){let i=0;switch(typeof e){case"string":for(const[a,u]of this.dataIndex.entries()){for(const[f,m]of u.bands.entries())if(m===e)return{bandIndex:i+f,blockIndex:a,blockBandIndex:f};i+=u.bands.length}break;case"number":for(const[a,u]of this.dataIndex.entries()){if(e>=i&&e<i+u.bands.length)return{bandIndex:e,blockIndex:a,blockBandIndex:e-i};i+=u.bands.length}break;default:throw new ma(`Invalid band \`${JSON.stringify(e)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let i=1/0,a=-1/0;const u=[],f=new Set;for(const m of e){const{blockIndex:_}=this.getBlockForBand(m);if(_<0)throw new ma(`Invalid band: ${JSON.stringify(m)}`);const b=this.dataIndex[_];u.includes(_)||u.push(_),f.add(_),i=Math.min(i,b.firstByte),a=Math.max(a,b.lastByte)}if(f.size>this.cacheSize)throw new ma(`Number of blocks to decode (${f.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:a,blockIndices:u}}hasBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0}hasDataForBand(e){const{blockIndex:i}=this.getBlockForBand(e);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(e){const{blockIndex:i,blockBandIndex:a}=this.getBlockForBand(e);if(i<0)throw new ma(`Band not found: ${JSON.stringify(e)}`);const u=this._decodedBlocks.get(i.toString());if(!u)throw new ma(`Data for band ${JSON.stringify(e)} of layer "${this.name}" not decoded.`);const f=this.dataIndex[i],m=this.bandShape.reduce((S,I)=>S*I,1),_=a*m,b=u.subarray(_,_+m);return{data:b,bytes:new Uint8Array(b.buffer).subarray(b.byteOffset,b.byteOffset+b.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:f.offset,scale:f.scale}}}c0.setPbf=function(s){aw=s};class SC{constructor(e,i,a){this.tasks=e,this._onCancel=i,this._onComplete=a,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,i){this._finalized||(this._onComplete(e,i),this._finalized=!0)}}c0.performDecoding=function(s,e){const i=new Uint8Array(s);return Promise.all(e.tasks.map(a=>{const{layerName:u,firstByte:f,lastByte:m,pixelFormat:_,blockShape:b,blockIndex:S,filters:I,codec:C}=a,k=i.subarray(f,m+1),M=new Uint32Array(b[0]*b[1]*b[2]);let R;if(C!=="gzip_data")throw new ma(`Unhandled codec: ${C}`);return R=function(F,$){if(!globalThis.DecompressionStream&&$==="gzip_data")return Promise.resolve((ae=function(ye){ye[0]==31&&ye[1]==139&&ye[2]==8||Va(6,"invalid gzip data");var me=ye[3],Se=10;4&me&&(Se+=2+(ye[10]|ye[11]<<8));for(var Ae=(me>>3&1)+(me>>4&1);Ae>0;Ae-=!ye[Se++]);return Se+(2&me)}(U=F),ae+8>U.length&&Va(6,"invalid gzip data"),function(ye,me,Se,Ae){var Ze=ye.length;if(!Ze||me.f&&!me.l)return Se||new Uo(0);var Ge=!Se,qe=Ge||me.i!=2,et=me.i;Ge&&(Se=new Uo(3*Ze));var Je=function(fs){var Sl=Se.length;if(fs>Sl){var qn=new Uo(Math.max(2*Sl,fs));qn.set(Se),Se=qn}},Qe=me.f||0,Ne=me.p||0,it=me.b||0,Ke=me.l,rt=me.d,tt=me.m,St=me.n,Et=8*Ze;do{if(!Ke){Qe=Ua(ye,Ne,1);var mt=Ua(ye,Ne+1,3);if(Ne+=3,!mt){var _t=ye[(Ri=VB(Ne)+4)-4]|ye[Ri-3]<<8,Vt=Ri+_t;if(Vt>Ze){et&&Va(0);break}qe&&Je(it+_t),Se.set(ye.subarray(Ri,Vt),it),me.b=it+=_t,me.p=Ne=8*Vt,me.f=Qe;continue}if(mt==1)Ke=NB,rt=UB,tt=9,St=5;else if(mt==2){var Rt=Ua(ye,Ne,31)+257,xt=Ua(ye,Ne+10,15)+4,Jt=Rt+Ua(ye,Ne+5,31)+1;Ne+=14;for(var yi=new Uo(Jt),Bi=new Uo(19),mi=0;mi<xt;++mi)Bi[BB[mi]]=Ua(ye,Ne+3*mi,7);Ne+=3*xt;var Ji=sw(Bi),ki=(1<<Ji)-1,Fr=Ag(Bi,Ji);for(mi=0;mi<Jt;){var Ri,Xi=Fr[Ua(ye,Ne,ki)];if(Ne+=15&Xi,(Ri=Xi>>4)<16)yi[mi++]=Ri;else{var gr=0,Er=0;for(Ri==16?(Er=3+Ua(ye,Ne,3),Ne+=2,gr=yi[mi-1]):Ri==17?(Er=3+Ua(ye,Ne,7),Ne+=3):Ri==18&&(Er=11+Ua(ye,Ne,127),Ne+=7);Er--;)yi[mi++]=gr}}var Ir=yi.subarray(0,Rt),jr=yi.subarray(Rt);tt=sw(Ir),St=sw(jr),Ke=Ag(Ir,tt),rt=Ag(jr,St)}else Va(1);if(Ne>Et){et&&Va(0);break}}qe&&Je(it+131072);for(var En=(1<<tt)-1,Nn=(1<<St)-1,qr=Ne;;qr=Ne){var rn=(gr=Ke[ow(ye,Ne)&En])>>4;if((Ne+=15&gr)>Et){et&&Va(0);break}if(gr||Va(2),rn<256)Se[it++]=rn;else{if(rn==256){qr=Ne,Ke=null;break}var un=rn-254;rn>264&&(un=Ua(ye,Ne,(1<<(Lr=pC[mi=rn-257]))-1)+yC[mi],Ne+=Lr);var ui=rt[ow(ye,Ne)&Nn],Ar=ui>>4;if(ui||Va(3),Ne+=15&ui,jr=jB[Ar],Ar>3){var Lr=mC[Ar];jr+=ow(ye,Ne)&(1<<Lr)-1,Ne+=Lr}if(Ne>Et){et&&Va(0);break}qe&&Je(it+131072);var oo=it+un;if(it<jr){var ds=0-jr,In=Math.min(jr,oo);for(ds+it<0&&Va(3);it<In;++it)Se[it]=Ae[ds+it]}for(;it<oo;++it)Se[it]=Se[it-jr]}}me.l=Ke,me.p=qr,me.b=it,me.f=Qe,Ke&&(Qe=1,me.m=tt,me.d=rt,me.n=St)}while(!Qe);return it!=Se.length&&Ge?function(fs,Sl,qn){return(qn==null||qn>fs.length)&&(qn=fs.length),new Uo(fs.subarray(0,qn))}(Se,0,it):Se.subarray(0,it)}(U.subarray(ae,-8),{i:2},new Uo(((X=U)[(Q=X.length)-4]|X[Q-3]<<8|X[Q-2]<<16|X[Q-1]<<24)>>>0),H)));var U,H,X,Q,ae;const oe=WB[$];if(!oe)throw new Error(`Unhandled codec: ${$}`);const ge=new globalThis.DecompressionStream(oe);return new Response(new Blob([F]).stream().pipeThrough(ge)).arrayBuffer().then(ye=>new Uint8Array(ye))}(k,C).then(F=>(function($,U){$.readFields(PB,U)}(new aw(F),M),new ZB[_](M.buffer))),R.then(F=>{for(let $=I.length-1;$>=0;$--)switch(I[$]){case"delta_filter":RB(F,b);break;case"zigzag_filter":DB(F);break;case"bitshuffle_filter":OB(F,_);break;default:throw new ma(`Unhandled filter "${I[$]}"`)}return{layerName:u,blockIndex:S,data:F}}).catch(F=>{throw F})}))},Ct(SC,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Ct(c0,"MapboxRasterTile"),Ct(wC,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class TC{constructor(e){this._stringToNumber={},this._numberToString=[];for(let i=0;i<e.length;i++){const a=e[i];this._stringToNumber[a]=i,this._numberToString[i]=a}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class EC{constructor(e,i){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new $l(gt,16,0),this.featureIndexArray=new gh,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,i,a,u,f,m=0,_=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(a,u,f,m);const S=this.grid;for(let I=0;I<i.length;I++){const C=i[I],k=[1/0,1/0,-1/0,-1/0];for(let M=0;M<C.length;M++){const R=C[M];k[0]=Math.min(k[0],R.x),k[1]=Math.min(k[1],R.y),k[2]=Math.max(k[2],R.x),k[3]=Math.max(k[3],R.y)}_!==0&&(k[0]-=_,k[1]-=_,k[2]+=_,k[3]+=_),k[0]<gt&&k[1]<gt&&k[2]>=0&&k[3]>=0&&S.insert(b,k[0],k[1],k[2],k[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Wi(new Nv(this.rawTileData)).layers,this.sourceLayerCoder=new TC(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,i){const{tilespaceGeometry:a,transform:u,tileTransform:f,pixelPosMatrix:m,availableImages:_,worldview:b}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const S=i.queryRadius?i.queryRadius:0,I=a.bufferedTilespaceBounds,C=this.grid.query(I.min.x,I.min.y,I.max.x,I.max.y,(F,$,U,H)=>fa(a.bufferedTilespaceGeometry,F-S,$-S,U+S,H+S));C.sort(XB);let k=null;u.elevation&&C.length>0&&(k=_f.create(u.elevation,this.tileID));const M={};let R;for(let F=0;F<C.length;F++){const $=C[F];if($===R)continue;R=$;const U=this.featureIndexArray.get($);let H=null;this.is3DTile?this.loadMatchingModelFeature(M,U,e,a,u,b):this.loadMatchingFeature(M,U,e,_,b,(X,Q,ae,oe=0)=>(H||(H=Xt(X,this.tileID.canonical,f)),Q.queryIntersectsFeature(a,X,ae,H,this.z,u,m,k,oe,i.scope)))}return M}loadMatchingFeature(e,i,a,u,f,m){const{featureIndex:_,bucketIndex:b,sourceLayerIndex:S,layoutVertexArrayOffset:I}=i,C=this.bucketLayerIDs[b],k=a.layers,M=Object.keys(k);if(M.length&&!pi(M,C))return;const R=a.sourceCache,F=this.sourceLayerCoder.decode(S),$=this.vtLayers[F].feature(_),U=this.getId($,F);for(let H=0;H<C.length;H++){const X=C[H];if(!k[X])continue;const{styleLayer:Q,targets:ae}=k[X];let oe={};U!==void 0&&(oe=R.getFeatureState(Q.sourceLayer,U));const ge=!m||m($,Q,oe,I);if(!ge)continue;const ye=new Lh($,this.z,this.x,this.y,U);ye.tile=this.tileID.canonical,ye.state=oe;let me=this.serializedLayersCache.get(X);me||(me=Q.serialize(),me.id=X,this.serializedLayersCache.set(X,me)),ye.source=me.source,ye.sourceLayer=me["source-layer"],ye.layer=Object.assign({},me),ye.layer.paint=IC(me.paint,Q.paint,$,oe,u),ye.layer.layout=IC(me.layout,Q.layout,$,oe,u);let Se=!1;for(const Ae of ae){this.updateFeatureProperties(ye,Ae);const{filter:Ze}=Ae;if(Ze){if($.properties=ye.properties,Ze.needGeometry){const Ge=ci($,!0);if(!Ze.filter(new Yi(this.tileID.overscaledZ,{worldview:f}),Ge,this.tileID.canonical))continue}else if(!Ze.filter(new Yi(this.tileID.overscaledZ,{worldview:f}),$))continue}Se=!0,Ae.targetId&&this.addFeatureVariant(ye,Ae)}Se&&this.appendToResult(e,X,_,ye,ge)}}loadMatchingModelFeature(e,i,a,u,f,m){const{featureIndex:_,bucketIndex:b}=i,S=this.bucketLayerIDs[b],I=a.layers,C=Object.keys(I);if(!C.length||pi(C,S))for(let k=0;k<S.length;k++){const M=S[k],{styleLayer:R,targets:F}=I[M];if(R.type!=="model")continue;const $=u.tile,U=$.getBucket(R);if(!(U&&U instanceof r0))continue;const H=iB(U,_,u,f);if(!H)continue;const{z:X,x:Q,y:ae}=$.tileID.canonical,{feature:oe,intersectionZ:ge,position:ye}=H;let me={};oe.id!==void 0&&(me=a.sourceCache.getFeatureState(R.sourceLayer,oe.id));const Se=new Lh({},X,Q,ae,oe.id);Se.tile=this.tileID.canonical,Se.state=me,Se.properties=oe.properties,Se.geometry={type:"Point",coordinates:[ye.lng,ye.lat]};let Ae=this.serializedLayersCache.get(M);Ae||(Ae=R.serialize(),Ae.id=M,this.serializedLayersCache.set(M,Ae)),Se.source=Ae.source,Se.sourceLayer=Ae["source-layer"],Se.layer=Object.assign({},Ae);let Ze=!1;for(const Ge of F){this.updateFeatureProperties(Se,Ge);const{filter:qe}=Ge;if(qe){if(oe.properties=Se.properties,qe.needGeometry){if(!qe.filter(new Yi(this.tileID.overscaledZ,{worldview:m}),oe,this.tileID.canonical))continue}else if(!qe.filter(new Yi(this.tileID.overscaledZ,{worldview:m}),oe))continue}Ze=!0,Ge.targetId&&this.addFeatureVariant(Se,Ge)}Ze&&this.appendToResult(e,M,_,Se,ge)}}updateFeatureProperties(e,i,a){if(i.properties){const u={};for(const f in i.properties){const m=i.properties[f].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,a);m!=null&&(u[f]=m)}e.properties=u}}addFeatureVariant(e,i,a){const u={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(u.properties=e.properties),e.variants=e.variants||{},e.variants[i.targetId]=e.variants[i.targetId]||[],e.variants[i.targetId].push(u)}appendToResult(e,i,a,u,f){let m=e[i];m===void 0&&(m=e[i]=[]),m.push({featureIndex:a,feature:u,intersectionZ:f})}lookupSymbolFeatures(e,i,a,u,f,m){const _={};this.loadVTLayers();for(const b of e)this.loadMatchingFeature(_,{bucketIndex:i,sourceLayerIndex:a,featureIndex:b,layoutVertexArrayOffset:0},u,f,m);return _}loadFeature(e){const{featureIndex:i,sourceLayerIndex:a}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(a),f=this.vtFeatures[u];if(f[i])return f[i];const m=this.vtLayers[u].feature(i);return f[i]=m,m}hasLayer(e){for(const i of this.bucketLayerIDs)for(const a of i)if(e===a)return!0;return!1}getId(e,i){let a=e.id;if(this.promoteId){const u=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(u!=null)if(Array.isArray(u)){if(!this.promoteIdExpression){const f=dl(u);if(f.result!=="success"){const m=f.value.map(_=>`${_.key}: ${_.message}`).join(", ");return void Kt(`Failed to create expression for promoteId: ${m}`)}this.promoteIdExpression=f.value}a=this.promoteIdExpression.evaluate({zoom:0},e)}else a=e.properties[u];typeof a=="boolean"&&(a=Number(a))}return a}}function IC(s,e,i,a,u){return Nt(s,(f,m)=>{const _=e instanceof os?e.get(m):null;return _&&_.evaluate?_.evaluate(i,a,void 0,u):_})}function XB(s,e){return e-s}Ct(EC,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const AC=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class lw{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,a]=new Uint8Array(e,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const u=a>>4;if(u!==1)throw new Error(`Got v${u} data when expected v1.`);const f=AC[15&a];if(!f)throw new Error("Unrecognized array type.");const[m]=new Uint16Array(e,2,1),[_]=new Uint32Array(e,4,1);return new lw(_,m,f,e)}constructor(e,i=64,a=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=a,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=AC.indexOf(this.ArrayType),m=2*e*this.ArrayType.BYTES_PER_ELEMENT,_=e*this.IndexArrayType.BYTES_PER_ELEMENT,b=(8-_%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${a}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+m+_+b),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+_+b,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=e)}add(e,i){const a=this._pos>>1;return this.ids[a]=a,this.coords[this._pos++]=e,this.coords[this._pos++]=i,a}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return cw(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,i,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:m,nodeSize:_}=this,b=[0,f.length-1,0],S=[];for(;b.length;){const I=b.pop()||0,C=b.pop()||0,k=b.pop()||0;if(C-k<=_){for(let $=k;$<=C;$++){const U=m[2*$],H=m[2*$+1];U>=e&&U<=a&&H>=i&&H<=u&&S.push(f[$])}continue}const M=k+C>>1,R=m[2*M],F=m[2*M+1];R>=e&&R<=a&&F>=i&&F<=u&&S.push(f[M]),(I===0?e<=R:i<=F)&&(b.push(k),b.push(M-1),b.push(1-I)),(I===0?a>=R:u>=F)&&(b.push(M+1),b.push(C),b.push(1-I))}return S}within(e,i,a){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:m}=this,_=[0,u.length-1,0],b=[],S=a*a;for(;_.length;){const I=_.pop()||0,C=_.pop()||0,k=_.pop()||0;if(C-k<=m){for(let $=k;$<=C;$++)kC(f[2*$],f[2*$+1],e,i)<=S&&b.push(u[$]);continue}const M=k+C>>1,R=f[2*M],F=f[2*M+1];kC(R,F,e,i)<=S&&b.push(u[M]),(I===0?e-a<=R:i-a<=F)&&(_.push(k),_.push(M-1),_.push(1-I)),(I===0?e+a>=R:i+a>=F)&&(_.push(M+1),_.push(C),_.push(1-I))}return b}}function cw(s,e,i,a,u,f){if(u-a<=i)return;const m=a+u>>1;CC(s,e,m,a,u,f),cw(s,e,i,a,m-1,1-f),cw(s,e,i,m+1,u,1-f)}function CC(s,e,i,a,u,f){for(;u>a;){if(u-a>600){const S=u-a+1,I=i-a+1,C=Math.log(S),k=.5*Math.exp(2*C/3),M=.5*Math.sqrt(C*k*(S-k)/S)*(I-S/2<0?-1:1);CC(s,e,i,Math.max(a,Math.floor(i-I*k/S+M)),Math.min(u,Math.floor(i+(S-I)*k/S+M)),f)}const m=e[2*i+f];let _=a,b=u;for(kg(s,e,a,i),e[2*u+f]>m&&kg(s,e,a,u);_<b;){for(kg(s,e,_,b),_++,b--;e[2*_+f]<m;)_++;for(;e[2*b+f]>m;)b--}e[2*a+f]===m?kg(s,e,a,b):(b++,kg(s,e,b,u)),b<=i&&(a=b+1),i<=b&&(u=b-1)}}function kg(s,e,i,a){uw(s,i,a),uw(e,2*i,2*a),uw(e,2*i+1,2*a+1)}function uw(s,e,i){const a=s[e];s[e]=s[i],s[i]=a}function kC(s,e,i,a){const u=s-i,f=e-a;return u*u+f*f}o.$=Lp,o.A=vs,o.B=Hl,o.C=2,o.D=sf,o.E=Ma,o.F=dg,o.G=JI,o.H=hd,o.I=_s,o.J=Vy,o.K=Yt,o.L=Zt,o.M=om,o.N=Md,o.O=wy,o.P=at,o.Q=ih,o.R=gs,o.S=$d,o.T=yb,o.U=dl,o.V=i0,o.W=Od,o.X=Cc,o.Y=Ac,o.Z=Xu,o._=bs,o.a=function(s){return Jr.API_CDN_URL_REGEX.test(s)},o.a$=nt,o.a0=$u,o.a1=K_,o.a2=Tm,o.a3=class extends i0{},o.a4=Rd,o.a5=sm,o.a6=ze,o.a7=function(s){const e=s.value;return e?$u(e)?Yb(e,!0)?[]:[new i0(s.key,e,`invalid url "${e}"`)]:[new i0(s.key,e,`string expected, "${Yt(e)}" found`)]:[]},o.a8=Fc,o.a9=Cr,o.aA=pe,o.aB=K,o.aC=zn,o.aD=W,o.aE=js,o.aF=Oe,o.aG=pt,o.aH=function(s,e){const i={};for(let a=0;a<e.length;a++){const u=e[a];u in s&&(i[u]=s[u])}return i},o.aI=Te,o.aJ=Ve,o.aK=class{constructor(s){this.entries={},this.scheduler=s}request(s,e,i,a){const u=this.entries[s]=this.entries[s]||{callbacks:[]};if(u.result){const[f,m]=u.result;return this.scheduler?this.scheduler.add(()=>{a(f,m)},e):a(f,m),()=>{}}return u.callbacks.push(a),u.cancel||(u.cancel=i((f,m)=>{u.result=[f,m];for(const _ of u.callbacks)this.scheduler?this.scheduler.add(()=>{_(f,m)},e):_(f,m);setTimeout(()=>delete this.entries[s],3e3)})),()=>{u.result||(u.callbacks=u.callbacks.filter(f=>f!==a),u.callbacks.length||(u.cancel(),delete this.entries[s]))}}},o.aL=function(s,e,i){const a=JSON.stringify(s.request);return s.data&&(this.deduped.entries[a]={result:[null,s.data]}),this.deduped.request(a,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},u=>{const f=Bu(s.request,(m,_,b)=>{m?u(m):_&&u(null,{rawData:_,vectorTile:i?void 0:new Wi(new Nv(_)),responseHeaders:new Map(b.entries())})});return()=>{f.cancel(),u()}},e)},o.aM=function(s){return s?{cacheControl:s.get("Cache-Control"),expires:s.get("Expires")}:{cacheControl:void 0,expires:void 0}},o.aN=Ou,o.aO=function(s){ra++,ra>wp&&(s.getActor().send("enforceCacheSizeLimit",G_),ra=0)},o.aP=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log2(s)))},o.aQ=hs,o.aR=PA,o.aS=BA,o.aT=le,o.aU=LA,o.aV=function(s,e){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(let a=0;a<s.length;a++){const u=document.createElement("source");a1(s[a])||(i.crossOrigin="Anonymous"),u.src=s[a],i.appendChild(u)}return{cancel:()=>{}}},o.aW=ag,o.aX=Ph,o.aY=At,o.aZ=mg,o.a_=Ye,o.aa=ft,o.ab=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return Or(s.expression.evaluate(e))}interpolate(s,e,i){return{x:qt(s.x,e.x,i),y:qt(s.y,e.y,i),z:qt(s.z,e.z,i),azimuthal:qt(s.azimuthal,e.azimuthal,i),polar:qt(s.polar,e.polar,i)}}},o.ac=Yi,o.ad=Vl,o.ae=yt,o.af=or,o.ag=vi,o.ah=Pe,o.ai=os,o.aj=Zc,o.ak=qt,o.al=gt,o.am=Ip,o.an=Pi,o.ao=Hi,o.ap=class{constructor(s){this.specification=s}possiblyEvaluate(s,e){return function([i,a]){const u=Or([1,i,a]);return{x:u.x,y:u.y,z:u.z}}(s.expression.evaluate(e))}interpolate(s,e,i){return{x:qt(s.x,e.x,i),y:qt(s.y,e.y,i),z:qt(s.z,e.z,i)}}},o.aq=function(s,e,i=0,a=!0){const u=new at(i,i),f=s.sub(u),m=e.add(u),_=[f,new at(m.x,f.y),m,new at(f.x,m.y)];return a&&_.push(f.clone()),_},o.ar=function(s,e){const i=[];for(let a=0;a<s.length;a++){const u=Ue(a-1,-1,s.length-1),f=Ue(a+1,-1,s.length-1),m=s[a],_=s[f],b=s[u].sub(m).unit(),S=_.sub(m).unit(),I=S.angleWithSep(b.x,b.y),C=b.add(S).unit().mult(-1*e/Math.sin(I/2));i.push(m.add(C))}return i},o.as=mA,o.at=fa,o.au=function(s,e,i=0){return ei(((e.x-i)*s.scale-s.x)*gt,(e.y*s.scale-s.y)*gt,Fe(e.z,e.y))},o.av=Dr,o.aw=Si,o.ax=nr,o.ay=AI,o.az=function(s){let e=1/0,i=1/0,a=-1/0,u=-1/0;for(const f of s)e=Math.min(e,f.x),i=Math.min(i,f.y),a=Math.max(a,f.x),u=Math.max(u,f.y);return{min:new at(e,i),max:new at(a,u)}},o.b=function(s){return Jr.API_FONTS_REGEX.test(s)},o.b$=SE,o.b0=en,o.b1=Fa,o.b2=ut,o.b3=Yy,o.b4=Jv,o.b5=function(){jo.isLoading()||jo.isLoaded()||bm()!=="deferred"||wm()},o.b6=Em,o.b7=ci,o.b8=Lh,o.b9=vr,o.bA=Ee,o.bB=We,o.bC=ce,o.bD=function(s,e){const{x:i,y:a}=s.point,u=F2(i,a,s.worldSize/s._pixelsPerMercatorPixel,0,0);return K(u,u,N1(xl(e)))},o.bE=J,o.bF=Qo,o.bG=wt,o.bH=di,o.bI=Di,o.bJ=Qt,o.bK=df,o.bL=so,o.bM=Ob,o.bN=function(s,e,i,a,u){const f=5*e+2;s.float32[f+0]=i,s.float32[f+1]=a,s.float32[f+2]=u},o.bO=gf,o.bP=_o,o.bQ=Oo,o.bR=Do,o.bS=Aa,o.bT=Ue,o.bU=function(s,e,i,a){var u=new j(4);return u[0]=s,u[1]=e,u[2]=i,u[3]=a,u},o.bV=class{isDataAvailableAtPoint(s){const e=this._source();if(this.isUsingMockSource()||!e||s.y<0||s.y>1)return!1;const i=e.getSource().maxzoom,a=1<<i,u=Math.floor(s.x),f=Math.floor((s.x-u)*a),m=Math.floor(s.y*a),_=this.findDEMTileFor(new hs(i,u,i,f,m));return!(!_||!_.dem)}getAtPointOrZero(s,e=0){return this.getAtPoint(s,e)||0}getAtPoint(s,e,i=!0){if(this.isUsingMockSource())return null;e==null&&(e=null);const a=this._source();if(!a||s.y<0||s.y>1)return e;const u=a.getSource().maxzoom,f=1<<u,m=Math.floor(s.x),_=s.x-m,b=new hs(u,m,u,Math.floor(_*f),Math.floor(s.y*f)),S=this.findDEMTileFor(b);if(!S||!S.dem)return e;const I=S.dem,C=1<<S.tileID.canonical.z,k=(_*C-S.tileID.canonical.x)*I.dim,M=(s.y*C-S.tileID.canonical.y)*I.dim,R=Math.floor(k),F=Math.floor(M);return(i?this.exaggeration():1)*qt(qt(I.get(R,F),I.get(R,F+1),M-F),qt(I.get(R+1,F),I.get(R+1,F+1),M-F),k-R)}static getAtTileOffset(s,e,i,a){const u=1<<s.canonical.z;return a?a.pointElevation(e):i?i.getAtPointOrZero(new yt(s.wrap+(s.canonical.x+e.x/gt)/u,(s.canonical.y+e.y/gt)/u)):0}static getAtTileOffsetFunc(s,e,i,a){return(u,f,m)=>{const _=this.getAtTileOffset(s,u,f,m),b=a.upVector(s.canonical,u.x,u.y);return Ot(b,b,_*a.upVectorScale(s.canonical,e,i).metersToTile),b}}getForTilePoints(s,e,i,a){if(this.isUsingMockSource())return!1;const u=_f.create(this,s,a);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],i)}),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(s);if(!e||!e.dem)return null;const i=e.dem.tree,a=e.tileID,u=1<<s.canonical.z-a.canonical.z;let f=s.canonical.x/u-a.canonical.x,m=s.canonical.y/u-a.canonical.y,_=0;for(let b=0;b<s.canonical.z-a.canonical.z&&!i.leaves[_];b++){f*=2,m*=2;const S=2*Math.floor(m)+Math.floor(f);_=i.childOffsets[_]+S,f%=1,m%=1}return{min:this.exaggeration()*i.minimums[_],max:this.exaggeration()*i.maximums[_]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,e,i){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let e=!1,i=Number.MAX_VALUE,a=Number.MIN_VALUE;for(const u of s){const f=this.getMinMaxForTile(u.tileID);f&&(i=Math.min(i,f.min),a=Math.max(a,f.max),e=!0)}return e?{min:i,max:a}:null}},o.bW=kv,o.bX=Tr,o.bY=mn,o.bZ=vE,o.b_=FA,o.ba=Ab,o.bb=rb,o.bc=Xt,o.bd=yl,o.be=fh,o.bf=M2,o.bg=xr,o.bh=ef,o.bi=Zb,o.bj=function(s,e){const i=Zc(e.zoom);if(i===0)return xl(s);const a=mv(s),u=j1(a),f=Oe(a.getWest())*e.worldSize,m=Oe(a.getEast())*e.worldSize,_=Ve(a.getNorth())*e.worldSize,b=Ve(a.getSouth())*e.worldSize,S=[f,_,0],I=[m,_,0],C=[f,b,0],k=[m,b,0],M=ve([],e.globeMatrix);return or(S,S,M),or(I,I,M),or(C,C,M),or(k,k,M),u[0]=Xl(u[0],C,i),u[1]=Xl(u[1],k,i),u[2]=Xl(u[2],I,i),u[3]=Xl(u[3],S,i),Ui.fromPoints(u)},o.bk=_v,o.bl=ve,o.bm=$m,o.bn=Xl,o.bo=Ba,o.bp=aO,o.bq=ct,o.br=fe,o.bs=c0,o.bt=Nv,o.bu=Bu,o.bv=function(s,e){const i=[];for(const a in s)a in e||i.push(a);return i},o.bw=Re,o.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.by=Li,o.bz=xe,o.c=Gn,o.c$=function(s,e,i){let a=0;for(let u=0;u<2;++u)s[u]>0&&(a+=(s[u]-0)*(s[u]-0)),e[u]<0&&(a+=(0-e[u])*(0-e[u]));return a},o.c0=TE,o.c1=Mb,o.c2=oA,o.c3=Nb,o.c4=lw,o.c5=Ot,o.c6=Lo,o.c7=Ps,o.c8=function(s,e,i){i*=.5;var a=e[0],u=e[1],f=e[2],m=e[3],_=Math.sin(i),b=Math.cos(i);return s[0]=a*b+u*_,s[1]=u*b-a*_,s[2]=f*b+m*_,s[3]=m*b-f*_,s},o.c9=Mo,o.cA=Ut,o.cB=fn,o.cC=dI,o.cD=bh,o.cE=O2,o.cF=function(s,e,i,a,u,f,m,_,b){if(b.name==="globe")return O2(s,e,new bh(i,a,u),!1);const S=mg({z:i,x:a,y:u},b);return new Ui([(f+S.x/S.scale)*e,e*(S.y/S.scale),m],[(f+S.x2/S.scale)*e,e*(S.y2/S.scale),_])},o.cG=function(s,e,i){return s[0]=Math.min(e[0],i[0]),s[1]=Math.min(e[1],i[1]),s[2]=Math.min(e[2],i[2]),s[3]=Math.min(e[3],i[3]),s},o.cH=function(s,e,i){return s[0]=Math.max(e[0],i[0]),s[1]=Math.max(e[1],i[1]),s[2]=Math.max(e[2],i[2]),s[3]=Math.max(e[3],i[3]),s},o.cI=function(s){const e=Math.round((s+45+360)%360/90)%4;return q[e]},o.cJ=Ie,o.cK=ea,o.cL=6,o.cM=function(s){const e=Ee(new Float64Array(16));K(e,s.pixelMatrix,s.globeMatrix);const i=[0,ne,0],a=[0,te,0];return or(i,i,e),or(a,a,e),[i[0]>0&&i[0]<=s.width&&i[1]>0&&i[1]<=s.height&&!V1(s,new le(s.center.lat,90)),a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!V1(s,new le(s.center.lat,-90))]},o.cN=function(s,e){const{scale:i}=s.tileTransform,a=i*gt/(s.tileSize*Math.pow(2,e.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return function(u,f,m){var _=f[1],b=f[2],S=f[3],I=m[0],C=m[1];return u[0]=f[0]*I,u[1]=_*I,u[2]=b*C,u[3]=S*C,u}(new Float32Array(4),e.inverseAdjustmentMatrix,[a,a])},o.cO=Dv,o.cP=_i,o.cQ=hI,o.cR=function(s){const e=hI(s,!0);return J([],[e[0],e[1],e[4],e[5]])},o.cS=ke,o.cT=kr,o.cU=Be,o.cV=function(s){const{x:e,y:i}=s.point,{lng:a,lat:u}=s._center;return F2(e,i,s.worldSize,a,u)},o.cW=Gt,o.cX=De,o.cY=Qd,o.cZ=pa,o.c_=5,o.ca=Sr,o.cb=function(s,e){return s[0]=-e[0],s[1]=-e[1],s[2]=-e[2],s[3]=e[3],s},o.cc=zt,o.cd=function(s,e,i,a,u){var f=1/Math.tan(e/2);if(s[0]=f/i,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=f,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,u!=null&&u!==1/0){var m=1/(a-u);s[10]=(u+a)*m,s[14]=2*u*a*m}else s[10]=-1,s[14]=-2*a;return s},o.ce=function(s,e,i,a,u,f,m){var _=1/(e-i),b=1/(a-u),S=1/(f-m);return s[0]=-2*_,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*b,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*S,s[11]=0,s[12]=(e+i)*_,s[13]=(u+a)*b,s[14]=(m+f)*S,s[15]=1,s},o.cf=je,o.cg=function(s,e,i){s[4*e+0]=i[0],s[4*e+1]=i[1],s[4*e+2]=i[2],s[4*e+3]=i[3]},o.ch=eo,o.ci=vh,o.cj=Gr,o.ck=to,o.cl=Hc,o.cm=xA,o.cn=function(){var s=new j(4);return j!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},o.co=function(s,e,i){var a=e[0],u=e[1],f=e[2],m=e[3],_=Math.sin(i),b=Math.cos(i);return s[0]=a*b+f*_,s[1]=u*b+m*_,s[2]=a*-_+f*b,s[3]=u*-_+m*b,s},o.cp=function(s,e){return s[0]===e[0]&&s[1]===e[1]&&s[2]===e[2]&&s[3]===e[3]},o.cq=es,o.cr=function(s){var e=s[0],i=s[1],a=s[2],u=s[3];return Math.sqrt(e*e+i*i+a*a+u*u)},o.cs=ia,o.ct=ar,o.cu=P2,o.cv=3,o.cw=2,o.cx=7,o.cy=6,o.cz=Pn,o.d=function(s){return Jr.API_TILEJSON_REGEX.test(s)},o.d$=class{constructor(s,e,i,a){this.context=s,this.format=a,this.size=i,this.texture=s.gl.createTexture();const[u,f,m]=this.size,{gl:_}=s;_.bindTexture(_.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in e&&e.data&&_.texImage3D(_.TEXTURE_3D,0,this.format,u,f,m,0,gb(this.format),_b(this.format),e.data)}bind(s,e){const{context:i}=this,{gl:a}=i;a.bindTexture(a.TEXTURE_3D,this.texture),s!==this.minFilter&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MAG_FILTER,s),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_MIN_FILTER,s),this.minFilter=s),e!==this.wrapS&&(a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_S,e),a.texParameteri(a.TEXTURE_3D,a.TEXTURE_WRAP_T,e),this.wrapS=e)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},o.d0=function(s){return s*s*s*s*s},o.d1=Me,o.d2=45,o.d3=Yd,o.d4=function(s,e,i){const a=Math.sqrt(s*s+e*e+i*i),u=a>0?Math.acos(i/a)*Mu:0;let f=s!==0||e!==0?Math.atan2(-e,-s)*Mu+90:0;return f<0&&(f+=360),[a,f,u]},o.d5=ei,o.d6=Or,o.d7=ht,o.d8=Tt,o.d9=Ui,o.dA=function(s){return s({pluginStatus:ss,pluginURL:gl}),xm.on("pluginStateChange",s),s},o.dB=dv,o.dC=class extends No{constructor(s){super(s),this.current=E2}set(s,e,i){if(this.fetchUniformLocation(s,e)){for(let a=0;a<9;a++)if(i[a]!==this.current[a]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dD=ee,o.dE=function(s,e,i){const a=Zc(i.zoom),u=s.style.map._antialias,f=s.terrain&&s.terrain.exaggeration()>0;return a===0&&!u&&!f},o.dF=function(s){const e=s.pixelsPerMeter,i=e/je(1,s.center.lat),a=Ee(new Float64Array(16));return fe(a,a,[s.point.x,s.point.y,0]),ke(a,a,[i,i,e]),Float32Array.from(a)},o.dG=mv,o.dH=function(s){const e=80.051129;s=pe(s,-80.051129,e)/e*90;const i=Math.pow(Math.abs(Math.sin(Pi(s))),3);return Math.round(i*(se.length-1))},o.dI=function(s,e,i,a){const u=e.getNorth(),f=e.getSouth(),m=e.getWest(),_=e.getEast(),b=1<<s.z,S=_-m,I=u-f,C=S/Y,k=-I/se[i],M=[0,C,0,k,0,0,u,m,0];if(s.z>0){const R=180/a;he(M,M,[R/S+1,0,0,0,R/I+1,0,-.5*R/C,.5*R/k,1])}return M[2]=b,M[5]=s.x,M[8]=s.y,M},o.dJ=xl,o.dK=function(s,e,i){const a=Ee(new Float64Array(16)),u=(e/(1<<s)-.5)*Math.PI*2;return Le(a,i.globeMatrix,u),Float32Array.from(a)},o.dL=Y2,o.dM=pv,o.dN=function(s,e){return[Math.pow(s[0],2.2)*e,Math.pow(s[1],2.2)*e,Math.pow(s[2],2.2)*e]},o.dO=ie,o.dP=function(s,e){var i=Math.sin(e),a=Math.cos(e);return s[0]=a,s[1]=i,s[2]=0,s[3]=-i,s[4]=a,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},o.dQ=Ls,o.dR=B2,o.dS=Mr,o.dT=Rn,o.dU=Xb,o.dV=function(s,e){const i=[0,0,0];return or(i,i,_v(xl(e.canonical))),or(i,i,s),i},o.dW=s=>({u_matrix:new Hc(s),u_texsize:new to(s),u_pixels_to_tile_units:new t(s),u_device_pixel_ratio:new Gr(s),u_width_scale:new Gr(s),u_floor_width_scale:new Gr(s),u_image:new eo(s),u_units_to_pixels:new to(s),u_tile_units_to_pixels:new Gr(s),u_alpha_discard_threshold:new Gr(s),u_trim_offset:new to(s),u_trim_fade_range:new to(s),u_trim_gradient_mix_range:new to(s),u_trim_color:new Yd(s),u_zbias_factor:new Gr(s),u_tile_to_meter:new Gr(s),u_ground_shadow_factor:new vh(s),u_pattern_transition:new Gr(s)}),o.dX=s=>({u_matrix:new Hc(s),u_pixels_to_tile_units:new t(s),u_device_pixel_ratio:new Gr(s),u_width_scale:new Gr(s),u_floor_width_scale:new Gr(s),u_units_to_pixels:new to(s),u_dash_image:new eo(s),u_gradient_image:new eo(s),u_image_height:new Gr(s),u_texsize:new to(s),u_tile_units_to_pixels:new Gr(s),u_alpha_discard_threshold:new Gr(s),u_trim_offset:new to(s),u_trim_fade_range:new to(s),u_trim_gradient_mix_range:new to(s),u_trim_color:new Yd(s),u_zbias_factor:new Gr(s),u_tile_to_meter:new Gr(s),u_ground_shadow_factor:new vh(s)}),o.dY=s=>({u_camera_to_center_distance:new Gr(s),u_extrude_scale:new t(s),u_device_pixel_ratio:new Gr(s),u_matrix:new Hc(s),u_inv_rot_matrix:new Hc(s),u_merc_center:new to(s),u_tile_id:new vh(s),u_zoom_transition:new Gr(s),u_up_dir:new vh(s),u_emissive_strength:new Gr(s)}),o.dZ=Wd,o.d_=o3,o.da=Ht,o.db=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},o.dc=uI,o.dd=Tb,o.de=mI,o.df=Yb,o.dg=function(s,e){return s.readFields(nB,{icons:[]},e)},o.dh=Lv,o.di=ff,o.dj=Bb,o.dk=zu,o.dl=jy,o.dm=Du,o.dn=xc,o.dp=oi,o.dq=function(s){const e=s.indexOf(ch);return e>=0?s.slice(0,e):s},o.dr=function(s){return s.indexOf(ch)>=0},o.ds=function(s){const e=s.lastIndexOf(ch);return e>=0?s.slice(e+1):""},o.dt=function(s){const e=[],i=s.id;return i===void 0&&e.push({message:`layers.${i}: missing required property "id"`}),s.render===void 0&&e.push({message:`layers.${i}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&e.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),e},o.du=function(s,e,i,a){return s.type==="custom"?new J3(s,e):new rB[s.type](s,e,i,a)},o.dv=Wt,o.dw=function(s){const e=s.indexOf(ch);return e>=0?s.slice(e+1):""},o.dx=class extends Lh{constructor(s,e){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=e.target,this.namespace=e.namespace,e.properties&&(this.properties=e.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},o.dy=xm,o.dz=La,o.e=Jr,o.e$=si,o.e0=U2,o.e1=(s,e,i,a,u,f)=>{const m=s.transform,_=m.projection.name==="globe";let b;if(f.paint.get("circle-pitch-alignment")==="map")if(_){const I=B2(m.zoom,e.canonical)*m._pixelsPerMercatorPixel;b=Float32Array.from([I,0,0,I])}else b=m.calculatePixelsToTileUnitsMatrix(i);else b=new Float32Array([m.pixelsToGLUnits[0],0,0,m.pixelsToGLUnits[1]]);const S={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(m.projection),u_matrix:s.translatePosMatrix(e.projMatrix,i,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Zs.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:dO,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:f.paint.get("circle-emissive-strength")};if(_){S.u_inv_rot_matrix=a,S.u_merc_center=u,S.u_tile_id=[e.canonical.x,e.canonical.y,1<<e.canonical.z],S.u_zoom_transition=Zc(m.zoom);const I=u[0]*gt,C=u[1]*gt;S.u_up_dir=m.projection.upVector(new bh(0,0,0),I,C)}return S},o.e2=PI,o.e3=xs,o.e4=(s,e,i,a,u,f,m,_,b,S)=>{const I=s.transform,C=I.pitch<15?CI(.07,.7,pe((14-I.zoom)/5,0,1)):.07,k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:LI(s,e,i,a),u_texsize:e.imageAtlasTexture?e.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:I.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:u,u_width_scale:f,u_floor_width_scale:m,u_image:0,u_tile_units_to_pixels:kI(e,I),u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:_,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:C,u_tile_to_meter:ht(e.tileID.canonical,0),u_ground_shadow_factor:b,u_pattern_transition:S}},o.e5=(s,e,i,a,u,f,m,_,b,S)=>{const I=s.transform,C=I.calculatePixelsToTileUnitsMatrix(e),k=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",M=I.pitch<15?CI(.07,.7,pe((14-I.zoom)/5,0,1)):.07;return{u_matrix:LI(s,e,i,a),u_pixels_to_tile_units:C,u_device_pixel_ratio:f,u_width_scale:m,u_floor_width_scale:_,u_units_to_pixels:[1/I.pixelsToGLUnits[0],1/I.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:MI(i)&&e.lineAtlasTexture?e.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:kI(e,s.transform),u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_gradient_mix_range:[1,1],u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(k?null:i.lut).toArray01(),u_zbias_factor:M,u_tile_to_meter:ht(e.tileID.canonical,0),u_ground_shadow_factor:S}},o.e6=st,o.e7=Gm,o.e8=Fe,o.e9=sO,o.eA=function(s,e){var i=2*Math.acos(e[3]),a=Math.sin(i/2);return a>D?(s[0]=e[0]/a,s[1]=e[1]/a,s[2]=e[2]/a):(s[0]=1,s[1]=0,s[2]=0),i},o.eB=ew,o.eC=Bv,o.eD=zv,o.eE=[1,1,1],o.eF=_f,o.eG=Po,o.eH=function(s,e,i,a){var u=e[0],f=e[1],m=e[2],_=e[3];return s[0]=u+a*(i[0]-u),s[1]=f+a*(i[1]-f),s[2]=m+a*(i[2]-m),s[3]=_+a*(i[3]-_),s},o.eI=cf,o.eJ=Qs,o.eK=ql,o.eL=function(s,e,i,a,u,f,m,_,b,S,I,C,k,M,R,F){var $=new j(16);return $[0]=s,$[1]=e,$[2]=i,$[3]=a,$[4]=u,$[5]=f,$[6]=m,$[7]=_,$[8]=b,$[9]=S,$[10]=I,$[11]=C,$[12]=k,$[13]=M,$[14]=R,$[15]=F,$},o.eM=be,o.eN=dh,o.eO=Bm,o.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new at(1/0,1/0),max:new at(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,e=!1){const i=bE(new at(0,0),new at(gt,gt),s),a=[];if(e&&!nb(i,this._globalClipBounds))return a;for(const u of this._activeRegions){if(u.hiddenByOverlap||!nb(i,u))continue;const f=ZO(u.min,u.max,s);a.push({min:f.min,max:f.max,sourceId:this._sourceIds[u.priority],footprint:u.footprint,footprintTileId:u.tileId,order:u.order,clipMask:u.clipMask,clipScope:u.clipScope})}return a}setSources(s){this._setSources(s.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const i=[];for(const a of e.cache.getVisibleCoordinates()){const u=e.cache.getTile(a).buckets[e.layer];u&&u.updateFootprints(a.toUnwrapped(),i)}return i},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(s){const e=s.getFootprints();if(e.length===0)return;const i=s.getOrder(),a=s.getClipMask(),u=s.getClipScope();for(const f of e){if(!f.footprint)continue;const m=bE(f.footprint.min,f.footprint.max,f.id);this._activeRegions.push({min:m.min,max:m.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:f.id,footprint:f.footprint,order:i,clipMask:a,clipScope:u})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,i)=>e.priority-i.priority||Ev(e.min,i.min)||Ev(e.max,i.max)||e.order-i.order||e.clipMask-i.clipMask||function(a,u){const f=(m,_)=>m+_;return a.length-u.length||a.reduce(f,"").localeCompare(u.reduce(f,""))}(e.clipScope,i.clipScope));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let e=0;for(;!s&&e!==this._activeRegions.length;){const i=this._activeRegions[e],a=this._prevRegions[e];s=i.priority!==a.priority||!xE(i,a)||i.order!==a.order||i.clipMask!==a.clipMask||!Li(i.clipScope,a.clipScope),this._activeRegions[e].hiddenByOverlap=a.hiddenByOverlap,++e}}if(s){++this._updateTime;for(const i of this._activeRegions)i.order!==Jm&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const e=i=>{const a=this._activeRegions;if(i>=a.length)return i;const u=a[i].priority;for(;i<a.length&&a[i].priority===u;)++i;return i};if(this._sourceIds.length>1){let i=0,a=e(i);for(;i!==a;){let u=i;const f=i;for(;u!==a;){const m=this._activeRegions[u];m.hiddenByOverlap=!1;for(let _=0;_<f;_++){const b=this._activeRegions[_];if(!b.hiddenByOverlap&&m.order===Jm&&nb(m,b)&&(m.hiddenByOverlap=wE(m.footprint,m.tileId,b.footprint,b.tileId),m.hiddenByOverlap))break}++u}i=a,a=e(i)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let e=s.length-1;e>=0;e--)this._addSource(s[e]);this._computeReplacement()}},o.eQ=Jm,o.eR=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,e){const i=new yl,a=new en,u=[],f=s+1+2,m=e[0]+1,_=e[0]+1+(1+e.length),b=(S,I,C)=>{let k=S===f-1?S-2:S===0?S:S-1;return k+=C?24575:0,[k,I]};for(let S=0;S<f;++S)i.emplaceBack(...b(S,0,!0));for(let S=0;S<m;++S)for(let I=0;I<f;++I)i.emplaceBack(...b(I,S,(I===0||I===f-1)&&!0));for(let S=0;S<e.length;++S){const I=e[S];for(let C=0;C<f;++C)i.emplaceBack(...b(C,I,!0))}for(let S=0;S<e.length;++S){const I=a.length,C=e[S]+1+2,k=new en;for(let F=0;F<C-1;F++){const $=F===C-2,U=$?f*(_-e.length+S-F):f;for(let H=0;H<f-1;H++){const X=F*f+H;F===0||$||H===0||H===f-2?(k.emplaceBack(X+1,X,X+U),k.emplaceBack(X+U,X+U+1,X+1)):(a.emplaceBack(X+1,X,X+U),a.emplaceBack(X+U,X+U+1,X+1))}}const M=xr.simpleSegment(0,I,i.length,a.length-I);for(let F=0;F<k.uint16.length;F+=3)a.emplaceBack(k.uint16[F],k.uint16[F+1],k.uint16[F+2]);const R=xr.simpleSegment(0,I,i.length,a.length-I);u.push({withoutSkirts:M,withSkirts:R})}return{vertices:i,indices:a,segments:u}}_createGrid(s){const e=this._fillGridMeshWithLods(Y,se);this._gridSegments=e.segments,this._gridBuffer=s.createVertexBuffer(e.vertices,M2.members),this._gridIndexBuffer=s.createIndexBuffer(e.indices,!0)}_createPoles(s){const e=new en;for(let m=0;m<=Y;m++)e.emplaceBack(0,m+1,m+2);this._poleIndexBuffer=s.createIndexBuffer(e,!0);const i=new Wl,a=new Wl,u=new Wl,f=new Wl;this._poleSegments=[];for(let m=0,_=0;m<5;m++){const b=360/(1<<m);i.emplaceBack(0,-W,0,.5,0),a.emplaceBack(0,-W,0,.5,1),u.emplaceBack(0,-W,0,.5,.5),f.emplaceBack(0,-W,0,.5,.5);for(let S=0;S<=Y;S++){let I=S/Y,C=0;const k=qt(0,b,I),[M,R,F]=we(uO,hO,k,W);i.emplaceBack(M,R,F,I,C),a.emplaceBack(M,R,F,I,1-C);const $=Pi(k);I=.5+.5*Math.sin($),C=.5+.5*Math.cos($),u.emplaceBack(M,R,F,I,C),f.emplaceBack(M,R,F,I,1-C)}this._poleSegments.push(xr.simpleSegment(_,0,66,64)),_+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(i,fv,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(a,fv,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(u,fv,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(f,fv,!1)}getGridBuffers(s,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,e){return[e?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,e?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},o.eS=qO,o.eT=ue,o.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eV=Ce,o.eW=ot,o.eX=function(s,e,i){return s[0]=e[0]/i[0],s[1]=e[1]/i[1],s[2]=e[2]/i[2],s},o.eY=ko,o.eZ=_e,o.e_=pr,o.ea=Cv,o.eb=zE,o.ec=Yl,o.ed=450,o.ee=7,o.ef=$e,o.eg=function(s,e){if(s===e){var i=e[1],a=e[2],u=e[3],f=e[6],m=e[7],_=e[11];s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=i,s[6]=e[9],s[7]=e[13],s[8]=a,s[9]=f,s[11]=e[14],s[12]=u,s[13]=m,s[14]=_}else s[0]=e[0],s[1]=e[4],s[2]=e[8],s[3]=e[12],s[4]=e[1],s[5]=e[5],s[6]=e[9],s[7]=e[13],s[8]=e[2],s[9]=e[6],s[10]=e[10],s[11]=e[14],s[12]=e[3],s[13]=e[7],s[14]=e[11],s[15]=e[15];return s},o.eh=Y3,o.ei=wi,o.ej=Nm,o.ek=256,o.el=N1,o.em=wo,o.en=Le,o.eo=function(s,e){return s[0]=e[0],s[1]=e[1],s[2]=e[2],s[3]=e[4],s[4]=e[5],s[5]=e[6],s[6]=e[8],s[7]=e[9],s[8]=e[10],s},o.ep=Wl,o.eq=yy,o.er=Xd,o.es=function(s,e,i,a,u){return pe((s-e)/(i-e)*(u-a)+a,a,u)},o.et=mo,o.eu=function(s,e){var i=e[0],a=e[1],u=e[2],f=e[3],m=e[4],_=e[5],b=e[6],S=e[7],I=e[8],C=I*m-_*S,k=-I*f+_*b,M=S*f-m*b,R=i*C+a*k+u*M;return R?(s[0]=C*(R=1/R),s[1]=(-I*a+u*S)*R,s[2]=(_*a-u*m)*R,s[3]=k*R,s[4]=(I*i-u*b)*R,s[5]=(-_*i+u*f)*R,s[6]=M*R,s[7]=(-S*i+a*b)*R,s[8]=(m*i-a*f)*R,s):null},o.ev=2,o.ew=Fi,o.ex=po,o.ey=Pt,o.ez=function(s,e){var i=new j(3);Pt(i,e);var a=1/i[0],u=1/i[1],f=1/i[2],m=e[0]*a,_=e[1]*u,b=e[2]*f,S=e[4]*a,I=e[5]*u,C=e[6]*f,k=e[8]*a,M=e[9]*u,R=e[10]*f,F=m+I+R,$=0;return F>0?($=2*Math.sqrt(F+1),s[3]=.25*$,s[0]=(C-M)/$,s[1]=(k-b)/$,s[2]=(_-S)/$):m>I&&m>R?($=2*Math.sqrt(1+m-I-R),s[3]=(C-M)/$,s[0]=.25*$,s[1]=(_+S)/$,s[2]=(k+b)/$):I>R?($=2*Math.sqrt(1+I-m-R),s[3]=(k-b)/$,s[0]=(_+S)/$,s[1]=.25*$,s[2]=(C+M)/$):($=2*Math.sqrt(1+R-m-I),s[3]=(_-S)/$,s[0]=(k+b)/$,s[1]=(C+M)/$,s[2]=.25*$),s},o.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,(e,i)=>String.fromCharCode(+("0x"+i))))},o.f0=function([s,e,i]){const a=Math.hypot(s,e,i),u=Math.atan2(s,i),f=.5*Math.PI-Math.acos(-e/a);return new le(De(u),De(f))},o.f1=ta,o.f2=vb,o.f3=function(s){const e=s.navigator?s.navigator.userAgent:null;return!!function(i){if(Ci==null){const a=i.navigator?i.navigator.userAgent:null;Ci=!!i.safari||!(!a||!(/\b(iPad|iPhone|iPod)\b/.test(a)||a.match("Safari")&&!a.match("Chrome")))}return Ci}(s)&&!(!e||!(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.f4=function(s,e){G_=s,wp=e},o.f5=V1,o.f6=j2,o.f7=function(s){const e=[0,0,0],i=Ee(new Float64Array(16));return K(i,s.pixelMatrix,s.globeMatrix),or(e,e,i),new at(e[0],e[1])},o.f8=function(){const s=ng;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(ub),ng=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.f9=function(){Lv().acquire(ub)},o.fA=l0,o.fB=Ti,o.fC=function(s){let e=0;if(new Uint32Array(s,0,1)[0]!==sI){const i=new Uint32Array(s,0,7),[,,a,u,f,m]=i;e=i.byteLength+u+f+m+f,(a!==s.byteLength||e>=s.byteLength)&&Kt("Invalid b3dm header information.")}return cI(s,e)},o.fD=function(s,e){const i=Tb(s);for(const a of i){for(const u of a.meshes)Cz(u);a.lights&&(a.lightMeshIndex=a.meshes.length,a.meshes.push(kz(a.lights,e)))}return i},o.fE=r0,o.fF=zr,o.fG=ZE,o.fH=jo,o.fI=ws,o.fJ=function(s){Ks(),Sn!=null&&Sn.then(e=>{e.keys().then(i=>{for(let a=0;a<i.length-s;a++)e.delete(i[a]).catch(u=>Kt(u.message))}).catch(i=>Kt(i.message))}).catch(e=>Kt(e.message))},o.fa=bm,o.fb=function(s,e,i=!1){if(ss===ws.deferred||ss===ws.loading||ss===ws.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");gl=Zs.resolveURL(s),ss=ws.deferred,ml=e,vm(),i||wm()},o.fc=function(s){of=Zs.resolveURL(s),af||(af=new sf(Lv(),new Ma)),af.broadcast("setMeshoptUrl",of)},o.fd=YE,o.fe=function(s){fb=Zs.resolveURL(s),af||(af=new sf(Lv(),new Ma)),af.broadcast("setDracoUrl",fb)},o.ff=KE,o.fg=rg,o.fh=function(s){const e=ka();if(!e)return;const i=e.delete($_);s&&i.then(()=>s()).catch(s)},o.fi=Th,o.fj=Ct,o.fk=Xc,o.fl=2,o.fm=TC,o.fn=EC,o.fo=TI,o.fp=Ii,o.fq="hd_road_elevation",o.fr=cs,o.fs=Nt,o.ft=Kl,o.fu=zb,o.fv=1,o.fw=function(s,e,i,a,u,f,m,_=1,b,S,I,C){s.createArrays(),s.tilePixelRatio=gt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const k=s.layers[0].layout,M=s.layers[0]._unevaluatedLayout._values,R={};R.scaleFactor=_,R.textSizeScaleRange=k.get("text-size-scale-range"),R.iconSizeScaleRange=k.get("icon-size-scale-range");const[F,$]=R.textSizeScaleRange,[U,H]=R.iconSizeScaleRange;R.textScaleFactor=pe(R.scaleFactor,F,$),R.iconScaleFactor=pe(R.scaleFactor,U,H);const X=M["text-size"],Q=M["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ae}=s.textSizeData;R.compositeTextSizes=[X.possiblyEvaluate(new Yi(Se,{worldview:I}),f),X.possiblyEvaluate(new Yi(Ae,{worldview:I}),f)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Se,maxZoom:Ae}=s.iconSizeData;R.compositeIconSizes=[Q.possiblyEvaluate(new Yi(Se,{worldview:I}),f,C),Q.possiblyEvaluate(new Yi(Ae,{worldview:I}),f,C)]}R.layoutTextSize=X.possiblyEvaluate(new Yi(m+1,{worldview:I}),f),R.layoutIconSize=Q.possiblyEvaluate(new Yi(m+1,{worldview:I}),f,C),R.textMaxSize=X.possiblyEvaluate(new Yi(18,{worldview:I}),f);const ae=k.get("symbol-placement"),oe=k.get("text-rotation-alignment")==="map"&&ae!=="point",ge=k.get("text-size");let ye=!1;const me=[];for(const Se of s.features){const Ae=k.get("text-font").evaluate(Se,{},f).join(","),Ze=ge.evaluate(Se,{},f)*R.textScaleFactor,Ge=R.layoutTextSize.evaluate(Se,{},f)*R.textScaleFactor,qe=R.layoutIconSize.evaluate(Se,{},f,C)*R.iconScaleFactor,et={horizontal:{},vertical:void 0},Je=Se.text;let Qe,Ne=[0,0];if(Je){const ki=Je.toString(),Fr=k.get("text-letter-spacing").evaluate(Se,{},f)*mn,Ri=k.get("text-line-height").evaluate(Se,{},f)*mn,Xi=k1(ki)?Fr:0,gr=k.get("text-anchor").evaluate(Se,{},f),Er=k.get("text-variable-anchor");if(!Er){const qr=k.get("text-radial-offset").evaluate(Se,{},f);if(qr)Ne=oA(gr,[qr*mn,jb]);else{const rn=k.get("text-offset").evaluate(Se,{},f);Ne=[rn[0]*mn,rn[1]*mn]}}let Ir=oe?"center":k.get("text-justify").evaluate(Se,{},f);const jr=ae==="point",En=jr?k.get("text-max-width").evaluate(Se,{},f)*mn:1/0,Nn=qr=>{s.allowVerticalPlacement&&_m(ki)&&(et.vertical=Pb(Je,e,i,u,Ae,En,Ri,gr,qr,Xi,Ne,so.vertical,!0,Ge,Ze,b))};if(!oe&&Er){const qr=Ir==="auto"?Er.map(un=>Nb(un)):[Ir];let rn=!1;for(let un=0;un<qr.length;un++){const ui=qr[un];if(!et.horizontal[ui])if(rn)et.horizontal[ui]=et.horizontal[0];else{const Ar=Pb(Je,e,i,u,Ae,En,Ri,"center",ui,Xi,Ne,so.horizontal,!1,Ge,Ze,b);Ar&&(et.horizontal[ui]=Ar,rn=Ar.positionedLines.length===1)}}Nn("left")}else{if(Ir==="auto"&&(Ir=Nb(gr)),jr||k.get("text-writing-mode").indexOf("horizontal")>=0||!_m(ki)){const qr=Pb(Je,e,i,u,Ae,En,Ri,gr,Ir,Xi,Ne,so.horizontal,!1,Ge,Ze,b);qr&&(et.horizontal[Ir]=qr)}Nn(jr?"left":Ir)}}let it,Ke,rt,tt,St,Et,mt=!1;const _t=k.get("icon-text-fit").evaluate(Se,{},f);if(Se.icon&&Se.icon.hasPrimary()){const ki=pg(Se.icon,s.iconSizeData,M["icon-size"],f,s.zoom,Se,b,R.iconScaleFactor,I,C);it=ki.iconPrimary,rt=ki.iconSecondary;const Fr=it.toString();if(Ke=a.get(Fr),Ke&&(St=k.get("icon-offset").evaluate(Se,{},f),Et=k.get("icon-anchor").evaluate(Se,{},f),Qe=Vv(u.get(Fr),rt?u.get(rt.toString()):void 0,St,Et),mt=Ke.sdf,s.sdfIcons===void 0?s.sdfIcons=Ke.sdf:s.sdfIcons!==Ke.sdf&&Kt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ke.pixelRatio!==s.pixelRatio||k.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),rt){const Ri=rt.toString();tt=a.get(Ri)}}ye=ye||!(!Se.icon||!Se.icon.hasSecondary());const Vt=qv(et.horizontal)||et.vertical;s.iconsInText||(s.iconsInText=!!Vt&&Vt.iconsInText);const Rt=Ge*R.textScaleFactor/mn,{defaultShapedIcon:xt,verticallyShapedIcon:Jt}=B3(s,Qe,k,Se,f,et,Rt,St,_t);_t!=="none"&&Qe&&(GI(Qe)||HI(Qe))&&(Wv(0,Ke,it,Qe,xt,_t,S,a,u),Wv(0,tt,rt,Qe,xt,_t,S,a,u),Jt&&(Wv(0,Ke,it,Qe,Jt,_t,S,a,u),Wv(0,tt,rt,Qe,Jt,_t,S,a,u))),Qe=xt;const{iconBBox:yi,iconVerticalBBox:Bi,textBBox:mi,textVerticalBBox:Ji}=M3(s,Qe,Jt,k,Se,f,qe,St,R,u,Et,et,Ge,Ne,C);me.push({feature:Se,shapedTextOrientations:et,shapedText:Vt,shapedIcon:Qe,iconPrimary:it,iconSecondary:rt,iconOffset:St,iconAnchor:Et,verticallyShapedIcon:Jt,layoutTextSize:Ge,layoutIconSize:qe,textOffset:Ne,isSDFIcon:mt,iconTextFit:_t,iconCollisionBounds:yi,iconVerticalCollisionBounds:Bi,textCollisionBounds:mi,textVerticalCollisionBounds:Ji})}return{featureData:me,sizes:R,hasAnySecondaryIcon:ye,textAlongLine:oe,symbolPlacement:ae}},o.fx=QI,o.fy=function(s,e,i,a,u,f,m,_,b,S){s.iconAtlasPositions=S.iconPositions;const{featureData:I,hasAnySecondaryIcon:C,sizes:k,textAlongLine:M,symbolPlacement:R}=e;for(const F of I){const{shapedIcon:$,verticallyShapedIcon:U,feature:H,shapedTextOrientations:X,shapedText:Q,layoutTextSize:ae,textOffset:oe,isSDFIcon:ge,iconPrimary:ye,iconSecondary:me,iconTextFit:Se,iconOffset:Ae,iconCollisionBounds:Ze,iconVerticalCollisionBounds:Ge,textCollisionBounds:qe}=F;uA($,S.iconPositions,ye,me),uA(U,S.iconPositions,ye,me),z3(X,S.iconPositions),O3(ye,me,S.iconPositions),(Q||$)&&F3(s,H,X,$,U,b,k,ae,0,oe,ge,a,u,m,_,C,Se,Ae,M,R,Ze,Ge,qe)}i&&s.generateCollisionDebugBuffers(f,s.collisionBoxArray,k.textScaleFactor)},o.fz=Wi,o.g=function(s,e){return La(Object.assign(s,{method:"GET"}),e)},o.h=function(s){return s.indexOf("mapbox:")===0},o.i=function(s){return Jr.API_STYLE_REGEX.test(s)&&!Gn(s)},o.j=el,o.k=_c,o.l=function(s){return decodeURIComponent(atob(s).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.m=function(s,e){return La(Object.assign(s,{type:"json"}),e)},o.n=nd,o.o=Zs,o.p=function(s,e){return La(Object.assign(s,{method:"POST"}),e)},o.q=jn,o.r=Ml,o.s=function(s){try{const e=self[s];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=function(){return hb||(hb=new Th("ImageRasterizer")),hb},o.u=function(){return function s(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)}()},o.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},o.w=Kt,o.x=nw,o.y=Nu,o.z=Pa}),w(["./shared"],function(o){function D(De){const q=De?De.url.toString():void 0;return q?performance.getEntriesByName(q):[]}function j(De){if(typeof De=="number"||typeof De=="boolean"||typeof De=="string"||De==null)return JSON.stringify(De);if(Array.isArray(De)){let ee="[";for(const ue of De)ee+=`${j(ue)},`;return`${ee}]`}let q="{";for(const ee of Object.keys(De).sort())q+=`${ee}:${j(De[ee])},`;return`${q}}`}function J(De){let q="";for(const ee of o.bx)q+=`/${j(De[ee])}`;return q}function ie(De,q){return function ee(ue){return typeof ue=="string"&&ue===q||(Array.isArray(ue)?ue.some(ee):!(!ue||typeof ue!="object")&&Object.values(ue).some(ee))}(De)}class re{constructor(q){this.keyCache={},this._layers={},this._layerConfigs={},q&&this.replace(q)}replace(q,ee){this._layerConfigs={},this._layers={},this.update(q,[],ee)}update(q,ee,ue){this._options=ue;for(const pe of q)this._layerConfigs[pe.id]=pe,(this._layers[pe.id]=o.du(pe,this.scope,null,this._options)).compileFilter(ue),this.keyCache[pe.id]&&delete this.keyCache[pe.id];for(const pe of ee)delete this.keyCache[pe],delete this._layerConfigs[pe],delete this._layers[pe];this.familiesBySource={};const Ce=function(pe,Pe){const Ue={};for(let He=0;He<pe.length;He++){const ut=pe[He];let st=Pe&&Pe[ut.id];st||(ut.type==="symbol"?st=ut.id:(st=J(ut),ut.type==="line"&&ut.paint&&ie(ut.paint["line-width"],"line-progress")&&(st+=`/${j(ut.paint["line-width"])}`))),Pe&&(Pe[ut.id]=st);let At=Ue[st];At||(At=Ue[st]=[]),At.push(ut)}const Re=[];for(const He in Ue)Re.push(Ue[He]);return Re}(Object.values(this._layerConfigs),this.keyCache);for(const pe of Ce){const Pe=pe.map(At=>this._layers[At.id]),Ue=Pe[0];if(Ue.visibility==="none")continue;const Re=Ue.source||"";let He=this.familiesBySource[Re];He||(He=this.familiesBySource[Re]={});const ut=Ue.sourceLayer||"_geojsonTileLayer";let st=He[ut];st||(st=He[ut]=[]),st.push(Pe)}}}const he=1*o.fl;class ce{constructor(q){const ee={},ue=[];for(const Ue in q){const Re=q[Ue],He=ee[Ue]={};for(const ut in Re.glyphs){const st=Re.glyphs[+ut];if(!st||st.bitmap.width===0||st.bitmap.height===0)continue;const At=st.metrics.localGlyph?he:1,Nt={x:0,y:0,w:st.bitmap.width+2*At,h:st.bitmap.height+2*At};ue.push(Nt),He[ut]=Nt}}const{w:Ce,h:pe}=o.G(ue),Pe=new o.fk({width:Ce||1,height:pe||1});for(const Ue in q){const Re=q[Ue];for(const He in Re.glyphs){const ut=Re.glyphs[+He];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const st=ee[Ue][He],At=ut.metrics.localGlyph?he:1;o.fk.copy(ut.bitmap,Pe,{x:0,y:0},{x:st.x+At,y:st.y+At},ut.bitmap)}}this.image=Pe,this.positions=ee}}function xe(De,q,ee){De[q]?ee&&(De[q].center=ee):De[q]={floorIds:new Set,center:ee||[0,0],floors:{}}}function Ee(De,q,ee,ue){for(const Ce of q)xe(De,Ce),De[Ce].floors[ee]=ue,De[Ce].floorIds.add(ee)}function ve(De){return{id:De.properties.id.toString(),center:De.properties.center.toString().split(";").map(Number)}}function K(De){return{id:De.properties.id.toString(),isDefault:!!De.properties.is_default&&De.properties.is_default,connections:De.properties.connected_floor_ids?new Set(De.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:De.properties.conflicted_floor_ids?new Set(De.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:De.properties.building_ids?new Set(De.properties.building_ids.toString().split(";")):new Set,name:De.properties.name.toString(),zIndex:De.properties.z_index}}function fe(De,q){return q.every(ee=>De.properties&&De.properties[ee]!=null)}function ke(De){return fe(De,["type","id","name"])&&De.properties.type==="building"}function Be(De){return fe(De,["type","id","name","z_index"])&&De.properties.type==="floor"}o.fj(ce,"GlyphAtlas");class Le{constructor(q){this.tileID=new o.aQ(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.lut=q.lut,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.scope=q.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=q.showCollisionBoxes,this.collectResourceTiming=!!q.request&&q.request.collectResourceTiming,this.promoteId=q.promoteId,this.isSymbolTile=q.isSymbolTile,this.tileTransform=o.aZ(q.tileID.canonical,q.projection),this.projection=q.projection,this.worldview=q.worldview,this.localizableLayerIds=q.localizableLayerIds,this.brightness=q.brightness,this.extraShadowCaster=!!q.extraShadowCaster,this.tessellationStep=q.tessellationStep,this.scaleFactor=q.scaleFactor,this.worldview=q.worldview,this.indoor=q.indoor}parse(q,ee,ue,Ce,pe,Pe){this.status="parsing",this.data=q,this.collisionBoxArray=new o.b3;const Ue=new o.fm(Object.keys(q.layers).sort()),Re=new o.fn(this.tileID,this.promoteId);Re.bucketLayerIDs=[];const He={},ut=new o.fo(256,256),st={featureIndex:Re,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:ut,availableImages:ue,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const oi=this.indoor.indoorState.activeFloorsVisible,pi=function(ti,Kt,lr){const Wr=function(vr,Ci){if(!vr)return o.w("No source layers defined in indoor specification"),Ci;if(vr.size===0)return Ci;const Sr=vr.difference(Ci);for(const Qi of Sr)o.w(`Missing source layer required in indoor specification: ${Qi}`);return Ci.intersection(Ci)}(Kt.sourceLayers,new Set(Object.keys(ti.layers))),Or=Kt.indoorState,zr=function(vr,Ci,Sr,Qi){const er=new Set,Mr=new Set,Rn=new Set,wn=new Map,Jr={},el=Gn=>{const Ds=wn.get(Gn)||new Set;for(const yo of er)if((wn.get(yo)||new Set).has(Gn)||Ds.has(yo))return!0;return!1};for(const Gn of Ci){const Ds=vr.layers[Gn];if(Ds)for(let yo=0;yo<Ds.length;yo++){const Bo=Ds.feature(yo);if(ke(Bo)){const{id:Os,center:is}=ve(Bo);xe(Jr,Os,is),er.add(Os);continue}if(Be(Bo)){const{id:Os,isDefault:is,connections:Ca,conflicts:Ml,buildings:Zs,name:Ru,zIndex:Du}=K(Bo);Ee(Jr,Zs,Os,{name:Ru,zIndex:Du}),wn.set(Os,Ml),(Os===Qi||Ca.has(Qi))&&er.add(Os),Mr.add(Os),is&&Rn.add(Os)}}else o.w(`indoor source layer not found: ${Gn}`)}if(Sr)for(const Gn of Sr)Mr.has(Gn)&&(el(Gn)||er.add(Gn));for(const Gn of Rn)er.has(Gn)||el(Gn)||er.add(Gn);return{buildings:Jr,activeFloors:er}}(ti,Wr,Or.lastActiveFloors,Or.selectedFloorId);return lr.send("setIndoorData",zr),zr}(q,this.indoor,pe);st.activeFloors=oi?pi.activeFloors:void 0}const At=[],Nt=ee.familiesBySource[this.source];for(const oi in Nt){const pi=q.layers[oi];if(!pi)continue;let ti=!1,Kt=!1,lr=!1;for(const Ci of Nt[oi])Ci[0].type==="symbol"?ti=!0:Kt=!0,Ci[0].is3D()&&Ci[0].type!=="model"&&(lr=!0);if(this.extraShadowCaster&&!lr||this.isSymbolTile===!0&&!ti||this.isSymbolTile===!1&&!Kt)continue;pi.version===1&&o.w(`Vector tile source "${this.source}" layer "${oi}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wr=Ue.encode(oi),Or=[],zr=this.localizableLayerIds&&this.localizableLayerIds.has(oi);let vr=!1;for(let Ci=0,Sr=0;Ci<pi.length;Ci++){const Qi=pi.feature(Ci),er=Re.getId(Qi,oi),Mr=Qi.properties?Qi.properties.worldview:null;if(zr&&this.worldview&&typeof Mr=="string")if(Mr==="all")Qi.properties.$localized=!0;else{if(!Mr.split(",").includes(this.worldview))continue;Qi.properties.$localized=!0,Qi.properties.worldview=this.worldview}!vr&&Qi.properties&&Qi.properties.hasOwnProperty(o.fp)&&(vr=!0),Or.push({feature:Qi,id:er,index:Sr,sourceLayerIndex:Wr}),Sr++}vr&&!st.elevationFeatures&&q.layers.hasOwnProperty(o.fq)&&(st.elevationFeatures=o.fr.parseFrom(q.layers[o.fq],this.canonical));for(const Ci of Nt[oi]){const Sr=Ci[0];if(this.extraShadowCaster&&(!Sr.is3D()||Sr.type==="model")||this.isSymbolTile!==void 0&&Sr.type==="symbol"!==this.isSymbolTile||Sr.minzoom&&this.zoom<Math.floor(Sr.minzoom)||Sr.maxzoom&&this.zoom>=Sr.maxzoom||Sr.visibility==="none")continue;We(Ci,this.zoom,st.brightness,ue,this.worldview);const Qi=He[Sr.id]=Sr.createBucket({index:Re.bucketLayerIDs.length,layers:Ci,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wr,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce,worldview:this.worldview,localizable:zr,availableImages:ue});Re.bucketLayerIDs.push(Ci.map(Mr=>o.B(Mr.id,Mr.scope)));let er=Qi.prepare?Qi.prepare():null;er!=null?(er=er.then(()=>Qi.populate(Or,st,this.tileID.canonical,this.tileTransform)),At.push(er)):Qi.populate(Or,st,this.tileID.canonical,this.tileTransform)}}const Wt=()=>{let oi,pi,ti,Kt,lr,Wr;ut.trim();const Or={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},zr=()=>{if(oi)return this.status="done",Pe(oi);if(this.extraShadowCaster)this.status="done",Pe(null,{buckets:Object.values(He).filter(Ci=>!Ci.isEmpty()),featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:st.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(pi&&ti&&Kt){const Ci=new ce(pi),Sr=new Map;for(const[Mr,Rn]of ti.entries()){const{imagePosition:wn}=o.fu(Mr,Rn,o.fv);Sr.set(Mr,wn)}const Qi={};for(const Mr in He){const Rn=He[Mr];Rn instanceof o.b4&&(We(Rn.layers,this.zoom,st.brightness,ue,this.worldview),Qi[Mr]=o.fw(Rn,pi,Ci.positions,ti,Sr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,lr,this.worldview,ue))}const er={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(pe,ti,lr,()=>{er.iconsPending=!1,vr(Qi,Ci,er)}),this.rasterizeIfNeeded(pe,Kt,Wr,()=>{er.patternsPending=!1,vr(Qi,Ci,er)})}},vr=(Ci,Sr,Qi,er)=>{if(Qi.iconsPending||Qi.patternsPending)return;const Mr=new o.fx(ti,Kt,this.lut);for(const Rn in He){const wn=He[Rn];if(Rn in Ci)o.fy(wn,Ci[Rn],this.showCollisionBoxes,ue,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,ti,Mr);else if(wn.hasPattern&&(wn instanceof o.ba||wn instanceof o.bb||wn instanceof o.ea)){We(wn.layers,this.zoom,st.brightness,ue,this.worldview);const Jr=Object.fromEntries(Mr.patternPositions);wn.addFeatures(st,this.tileID.canonical,Jr,ue,this.tileTransform,this.brightness)}}this.status="done",Pe(null,{buckets:Object.values(He).filter(Rn=>!Rn.isEmpty()),featureIndex:Re,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Sr.image,lineAtlas:ut,imageAtlas:Mr,brightness:st.brightness})};if(!this.extraShadowCaster){const Ci=o.fs(st.glyphDependencies,er=>Object.keys(er).map(Number));Object.keys(Ci).length?pe.send("getGlyphs",{uid:this.uid,stacks:Ci},(er,Mr)=>{oi||(oi=er,pi=Mr,zr())},void 0,!1,Or):pi={};const Sr=Array.from(st.iconDependencies.keys()).map(er=>o.I.parse(er));Sr.length?pe.send("getImages",{images:Sr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(er,Mr)=>{oi||(oi=er,ti=new Map,lr=this.updateImageMapAndGetImageTaskQueue(ti,Mr,st.iconDependencies),zr())},void 0,!1,Or):(ti=new Map,lr=new Map);const Qi=Array.from(st.patternDependencies.keys()).map(er=>o.I.parse(er));Qi.length?pe.send("getImages",{images:Qi,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(er,Mr)=>{oi||(oi=er,Kt=new Map,Wr=this.updateImageMapAndGetImageTaskQueue(Kt,Mr,st.patternDependencies),zr())},void 0,!1,Or):(Kt=new Map,Wr=new Map)}if(st.elevationFeatures&&st.elevationFeatures.length>0){const Ci=[];for(const Qi of Object.values(He))if(Qi instanceof o.bb){const er=Qi.getUnevaluatedPortalGraph();er&&Ci.push(er)}const Sr=o.ft.evaluate(Ci);for(const Qi of Object.values(He))if(Qi instanceof o.bb){const er=q.layers[Ue.decode(Qi.sourceLayerIndex)];Qi.setEvaluatedPortalGraph(Sr,er,this.tileID.canonical,st.availableImages,st.brightness)}}zr()};At.length>0?Promise.allSettled(At).then(Wt).catch(Pe):Wt()}updateParameters(q){this.scaleFactor=q.scaleFactor,this.showCollisionBoxes=q.showCollisionBoxes,this.projection=q.projection,this.brightness=q.brightness,this.tileTransform=o.aZ(q.tileID.canonical,q.projection),this.extraShadowCaster=q.extraShadowCaster,this.lut=q.lut,this.worldview=q.worldview,this.indoor=q.indoor}rasterizeIfNeeded(q,ee,ue,Ce){Array.from(ee.values()).some(pe=>pe.usvg)?this.rasterize(q,ee,ue,Ce):Ce()}updateImageMapAndGetImageTaskQueue(q,ee,ue){const Ce=new Map;for(const pe of ee.keys()){const Pe=ue.get(pe)||[];for(const Ue of Pe){const Re=Ue.toString(),He=ee.get(Ue.id.toString());He.usvg?Ce.has(Re)||(Ce.set(Re,Ue),q.set(Re,Object.assign({},He))):q.set(Re,He)}}return Ce}rasterize(q,ee,ue,Ce){this.rasterizeTask=q.send("rasterizeImages",{scope:this.scope,tasks:ue},(pe,Pe)=>{if(!pe)for(const[Ue,Re]of Pe.entries()){const He=Object.assign(ee.get(Ue),{data:Re});ee.set(Ue,He)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function We(De,q,ee,ue,Ce){const pe=new o.ac(q,{brightness:ee,worldview:Ce});for(const Pe of De)Pe.recalculate(pe,ue)}class ct extends o.E{constructor(q,ee,ue,Ce,pe,Pe,Ue){super(),this.actor=q,this.layerIndex=ee,this.availableImages=ue,this.availableModels=Ce,this.loadVectorData=Pe||o.aL,this.loading={},this.loaded={},this.deduped=new o.aK(q.scheduler),this.isSpriteLoaded=pe,this.scheduler=q.scheduler,this.brightness=Ue}loadTile(q,ee){const ue=q.uid,Ce=q&&q.request,pe=Ce&&Ce.collectResourceTiming,Pe=this.loading[ue]=new Le(q);Pe.abort=this.loadVectorData(q,(Ue,Re)=>{const He=!this.loading[ue];if(delete this.loading[ue],Pe.cancelRasterize(),He||Ue||!Re)return Pe.status="done",He||(this.loaded[ue]=Pe),ee(Ue);const ut=Re.rawData,st={},At=o.aM(Re.responseHeaders);At&&At.expires&&(st.expires=At.expires),At&&At.cacheControl&&(st.cacheControl=At.cacheControl),Pe.vectorTile=Re.vectorTile||new o.fz(new o.bt(ut));const Nt=()=>{Pe.parse(Pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Wt,oi)=>{if(Wt||!oi)return ee(Wt);const pi={};if(pe){const ti=D(Ce);ti.length>0&&(pi.resourceTiming=JSON.parse(JSON.stringify(ti)))}ee(null,Object.assign({rawTileData:ut.slice(0),responseHeaders:Re.responseHeaders},oi,st,pi))})};this.isSpriteLoaded?Nt():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(Nt,{type:"parseTile",isSymbolTile:q.isSymbolTile,zoom:q.tileZoom}):Nt()}),this.loaded=this.loaded||{},this.loaded[ue]=Pe})}reloadTile(q,ee){const ue=this.loaded,Ce=q.uid;if(ue&&ue[Ce]){const pe=ue[Ce];pe.updateParameters(q);const Pe=(Ue,Re)=>{const He=pe.reloadCallback;He&&(delete pe.reloadCallback,pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He)),ee(Ue,Re)};pe.status==="parsing"?pe.reloadCallback=Pe:pe.status==="done"&&(pe.vectorTile?pe.parse(pe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Pe):Pe())}else ee(null,void 0)}abortTile(q,ee){const ue=q.uid,Ce=this.loading[ue];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ue]),ee()}removeTile(q,ee){const ue=this.loaded,Ce=q.uid;ue&&ue[Ce]&&delete ue[Ce],ee()}}class lt{loadTile(q,ee){const{uid:ue,encoding:Ce,rawImageData:pe,padding:Pe}=q,Ue=ImageBitmap&&pe instanceof ImageBitmap?this.getImageData(pe,Pe):pe;ee(null,new o.fA(ue,Ue,Ce,Pe<1))}reloadTile(q,ee){ee(null,null)}abortTile(q,ee){ee()}removeTile(q,ee){ee()}getImageData(q,ee){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const ue=this.offscreenCanvasContext.getImageData(-ee,-ee,q.width+2*ee,q.height+2*ee);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),ue}}o.bs.setPbf(o.bt);class Pt{constructor(q){this._mrt=new o.bs(q.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=q.uid,this.tileID=q.tileID,this.source=q.source}parse(q,ee){const ue=this._mrt;this.status="parsing",this._entireBuffer=q;try{ue.parseHeader(q),this._isHeaderLoaded=!0;const Ce=[];for(const pe in ue.layers){const Pe=ue.getLayer(pe),Ue=Pe.getDataRange(Pe.getBandList()),Re=ue.createDecodingTask(Ue),He=q.slice(Ue.firstByte,Ue.lastByte+1),ut=o.bs.performDecoding(He,Re).then(st=>Re.complete(null,st)).catch(st=>Re.complete(st,null));Ce.push(ut)}Promise.allSettled(Ce).then(()=>ee(null,ue)).catch(pe=>ee(pe))}catch(Ce){ee(Ce)}}}class zt{constructor(q){this.actor=q,this.loading={},this.loaded={}}loadTile(q,ee){const ue=q.uid,Ce=q.request,pe=this.loading[ue]=new Pt(q),{cancel:Pe}=o.bu(Ce,(Ue,Re,He)=>{const ut=!this.loading[ue];if(delete this.loading[ue],ut||Ue||!Re)return pe.status="done",ut||(this.loaded[ue]=pe),ee(Ue);pe.parse(Re,(st,At)=>{if(st||!At)return ee(st);ee(null,At,He)}),this.loaded[ue]=pe});pe.abort=Pe}reloadTile(q,ee){ee(null,void 0)}abortTile(q,ee){const ue=q.uid,Ce=this.loading[ue];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[ue]),ee()}removeTile(q,ee){const ue=q.uid;this.loaded[ue]&&delete this.loaded[ue],ee()}decodeRasterArray(q,ee){o.bs.performDecoding(q.buffer,q.task).then(ue=>ee(null,ue)).catch(ue=>ee(ue))}}const _i=o.fB.prototype.toGeoJSON;class Ut{constructor(q){this._feature=q,this.extent=o.al,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(this._feature.type===1){const q=[];for(const ee of this._feature.geometry)q.push([new o.P(ee[0],ee[1])]);return q}{const q=[];for(const ee of this._feature.geometry){const ue=[];for(const Ce of ee)ue.push(new o.P(Ce[0],Ce[1]));q.push(ue)}return q}}toGeoJSON(q,ee,ue){return _i.call(this,q,ee,ue)}}class bi{constructor(q,ee){this.name=q,this.extent=o.al,this.length=ee.length,this._jsonFeatures=ee}feature(q){return new Ut(this._jsonFeatures[q])}}class vi{constructor(q){this.layers={},this.extent=o.al;for(const ee of Object.keys(q))this.layers[ee]=new bi(ee,q[ee])}}const ei=64/4096;class si{constructor(){this.features=new Map}clear(){this.features.clear()}load(q=[],ee){for(const ue of q){const Ce=ue.id;if(Ce==null)continue;let pe=this.features.get(Ce);pe&&this.updateCache(pe,ee),ue.geometry?(pe=Ht(ue),this.updateCache(pe,ee),this.features.set(Ce,pe)):this.features.delete(Ce),this.updateCache(pe,ee)}}updateCache(q,ee){for(const{canonical:ue,uid:Ce}of Object.values(ee)){const{z:pe,x:Pe,y:Ue}=ue;Tt(q,Math.pow(2,pe),Pe,Ue)&&delete ee[Ce]}}getTile(q,ee,ue){const Ce=Math.pow(2,q),pe=[];for(const Pe of this.features.values())Tt(Pe,Ce,ee,ue)&&pe.push(Ot(Pe,Ce,ee,ue));return{features:pe}}getFeatures(){return[...this.features.values()]}}function Tt({minX:De,minY:q,maxX:ee,maxY:ue},Ce,pe,Pe){return De<(pe+1+ei)/Ce&&q<(Pe+1+ei)/Ce&&ee>(pe-ei)/Ce&&ue>(Pe-ei)/Ce}function Ht(De){const{id:q,geometry:ee,properties:ue}=De;if(!ee)return;if(ee.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:pe}=ee,Pe={id:q,type:1,geometry:[],tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Ue=Pe.geometry;if(Ce==="Point")Gt(pe,Ue,Pe);else if(Ce==="MultiPoint")for(const Re of pe)Gt(Re,Ue,Pe);else if(Ce==="LineString")Pe.type=2,hi(pe,Ue,Pe);else if(Ce==="MultiLineString")Pe.type=2,Ft(pe,Ue,Pe);else if(Ce==="Polygon")Pe.type=3,Ft(pe,Ue,Pe,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Pe.type=3;for(const Re of pe)Ft(Re,Ue,Pe,!0)}return Pe}function Gt([De,q],ee,ue){const Ce=o.aF(De);let pe=o.aJ(q);pe=pe<0?0:pe>1?1:pe,ee.push(Ce,pe),ue.minX=Math.min(ue.minX,Ce),ue.minY=Math.min(ue.minY,pe),ue.maxX=Math.max(ue.maxX,Ce),ue.maxY=Math.max(ue.maxY,pe)}function hi(De,q,ee,ue=!1,Ce=!1){const pe=[];for(const Pe of De)Gt(Pe,pe,ee);q.push(pe),ue&&function(Pe,Ue){let Re=0;for(let He=0,ut=Pe.length,st=ut-2;He<ut;st=He,He+=2)Re+=(Pe[He]-Pe[st])*(Pe[He+1]+Pe[st+1]);if(Re>0===Ue)for(let He=0,ut=Pe.length;He<ut/2;He+=2){const st=Pe[He],At=Pe[He+1];Pe[He]=Pe[ut-2-He],Pe[He+1]=Pe[ut-1-He],Pe[ut-2-He]=st,Pe[ut-1-He]=At}}(pe,Ce)}function Ft(De,q,ee,ue=!1){for(let Ce=0;Ce<De.length;Ce++)hi(De[Ce],q,ee,ue,Ce===0)}function Ot(De,q,ee,ue){const{id:Ce,type:pe,geometry:Pe,tags:Ue}=De,Re=[];if(pe===1)(function(He,ut,st,At,Nt){for(let Wt=0;Wt<He.length;Wt+=2){const oi=Math.round(o.al*(He[Wt+0]*ut-st)),pi=Math.round(o.al*(He[Wt+1]*ut-At));Nt.push([oi,pi])}})(Pe,q,ee,ue,Re);else if(pe===2)for(const He of Pe)di(He,q,ee,ue,Re);else if(pe===3)for(const He of Pe)wt(He,q,ee,ue,Re);return{id:Ce,type:pe,geometry:Re,tags:Ue}}function di(De,q,ee,ue,Ce){const Pe=o.al+128;let Ue;for(let Re=0;Re<De.length-2;Re+=2){let He=Math.round(o.al*(De[Re+0]*q-ee)),ut=Math.round(o.al*(De[Re+1]*q-ue)),st=Math.round(o.al*(De[Re+2]*q-ee)),At=Math.round(o.al*(De[Re+3]*q-ue));const Nt=st-He,Wt=At-ut;He<-128&&st<-128||(He<-128?(ut+=Math.round(Wt*((-128-He)/Nt)),He=-128):st<-128&&(At=ut+Math.round(Wt*((-128-He)/Nt)),st=-128),ut<-128&&At<-128||(ut<-128?(He+=Math.round(Nt*((-128-ut)/Wt)),ut=-128):At<-128&&(st=He+Math.round(Nt*((-128-ut)/Wt)),At=-128),He>=Pe&&st>=Pe||(He>=Pe?(ut+=Math.round(Wt*((Pe-He)/Nt)),He=Pe):st>=Pe&&(At=ut+Math.round(Wt*((Pe-He)/Nt)),st=Pe),ut>=Pe&&At>=Pe||(ut>=Pe?(He+=Math.round(Nt*((Pe-ut)/Wt)),ut=Pe):At>=Pe&&(st=He+Math.round(Nt*((Pe-ut)/Wt)),At=Pe),Ue&&He===Ue[Ue.length-1][0]&&ut===Ue[Ue.length-1][1]||(Ue=[[He,ut]],Ce.push(Ue)),Ue.push([st,At])))))}}function wt(De,q,ee,ue,Ce){const pe=(ee-ei)/q,Pe=(ue-ei)/q,Ue=(ee+1+ei)/q,Re=(ue+1+ei)/q;function He(At,Nt){let Wt=0;return At<pe?Wt|=1:At>Ue&&(Wt|=2),Nt<Pe?Wt|=4:Nt>Re&&(Wt|=8),Wt}let ut=[];for(let At=1;At<=8;At*=2){let Nt=De[De.length-2],Wt=De[De.length-1],oi=!(He(Nt,Wt)&At);for(let pi=0;pi<De.length;pi+=2){const ti=De[pi],Kt=De[pi+1],lr=!(He(ti,Kt)&At);lr!==oi&&(8&At?ut.push(Nt+(ti-Nt)*(Re-Wt)/(Kt-Wt),Re):4&At?ut.push(Nt+(ti-Nt)*(Pe-Wt)/(Kt-Wt),Pe):2&At?ut.push(Ue,Wt+(Kt-Wt)*(Ue-Nt)/(ti-Nt)):1&At&&ut.push(pe,Wt+(Kt-Wt)*(pe-Nt)/(ti-Nt))),lr&&ut.push(ti,Kt),Nt=ti,Wt=Kt,oi=lr}if(!(De=ut).length||At===8)break;ut=[]}const st=[];for(let At=0;At<ut.length;At+=2)st.push([Math.round(o.al*(ut[At]*q-ee)),Math.round(o.al*(ut[At+1]*q-ue))]);st.length&&Ce.push(st)}function sr({name:De,features:q},ee){ee.writeStringField(1,De),ee.writeVarintField(5,o.al);const ue=new Map,Ce=new Map,pe={keys:ue,values:Ce,feature:null};for(const Pe of q)pe.feature=Pe,ee.writeMessage(2,pr,pe);for(const Pe of ue.keys())ee.writeStringField(3,Pe);for(const Pe of Ce.keys())ee.writeMessage(4,Pn,Pe)}function pr(De,q){const ee=De.feature;ee.id!==void 0&&Number.isSafeInteger(+ee.id)&&q.writeVarintField(1,+ee.id),ee.tags&&q.writeMessage(2,Fi,De),q.writeVarintField(3,ee.type),q.writeMessage(4,Di,ee)}function Fi({keys:De,values:q,feature:ee},ue){for(const Ce of Object.keys(ee.tags)){let pe=ee.tags[Ce];if(pe===null)continue;let Pe=De.get(Ce);Pe===void 0&&(Pe=De.size,De.set(Ce,Pe)),ue.writeVarint(Pe);const Ue=typeof pe;Ue!=="string"&&Ue!=="boolean"&&Ue!=="number"&&(pe=JSON.stringify(pe));let Re=q.get(pe);Re===void 0&&(Re=q.size,q.set(pe,Re)),ue.writeVarint(Re)}}function Si(De,q){return(q<<3)+(7&De)}function Qt(De){return De<<1^De>>31}function Di(De,q){const{geometry:ee,type:ue}=De;let Ce=0,pe=0;if(ue===1){q.writeVarint(Si(1,ee.length));for(const Pe of ee){const Ue=Pe[0]-Ce,Re=Pe[1]-pe;q.writeVarint(Qt(Ue)),q.writeVarint(Qt(Re)),Ce+=Ue,pe+=Re}}else for(const Pe of ee){if(Pe.length===0)continue;q.writeVarint(Si(1,1));const Ue=Pe.length-(ue===3?1:0);for(let Re=0;Re<Ue;Re++){Re===1&&q.writeVarint(Si(2,Ue-1));const He=Pe[Re][0]-Ce,ut=Pe[Re][1]-pe;q.writeVarint(Qt(He)),q.writeVarint(Qt(ut)),Ce+=He,pe+=ut}ue===3&&q.writeVarint(Si(7,1))}}function Pn(De,q){const ee=typeof De;ee==="string"?q.writeStringField(1,De):ee==="boolean"?q.writeBooleanField(7,De):ee==="number"&&(De%1!=0?q.writeDoubleField(3,De):De<0?q.writeSVarintField(6,De):q.writeVarintField(5,De))}const or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:De=>De},Ls=Math.fround||(ar=new Float32Array(1),De=>(ar[0]=+De,ar[0]));var ar;class Qo{constructor(q){this.options=Object.assign(Object.create(or),q),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(q){const{log:ee,minZoom:ue,maxZoom:Ce}=this.options;ee&&console.time("total time");const pe=`prepare ${q.length} points`;ee&&console.time(pe),this.points=q;const Pe=[];for(let Re=0;Re<q.length;Re++){const He=q[Re];if(!He.geometry)continue;const[ut,st]=He.geometry.coordinates,At=Ls(ko(ut)),Nt=Ls(Lo(st));Pe.push(At,Nt,1/0,Re,-1,1),this.options.reduce&&Pe.push(0)}let Ue=this.trees[Ce+1]=this._createTree(Pe);ee&&console.timeEnd(pe);for(let Re=Ce;Re>=ue;Re--){const He=+Date.now();Ue=this.trees[Re]=this._createTree(this._cluster(Ue,Re)),ee&&console.log("z%d: %d clusters in %dms",Re,Ue.numItems,+Date.now()-He)}return ee&&console.timeEnd("total time"),this}getClusters(q,ee){let ue=((q[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,q[1]));let pe=q[2]===180?180:((q[2]+180)%360+360)%360-180;const Pe=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)ue=-180,pe=180;else if(ue>pe){const st=this.getClusters([ue,Ce,180,Pe],ee),At=this.getClusters([-180,Ce,pe,Pe],ee);return st.concat(At)}const Ue=this.trees[this._limitZoom(ee)],Re=Ue.range(ko(ue),Lo(Pe),ko(pe),Lo(Ce)),He=Ue.data,ut=[];for(const st of Re){const At=this.stride*st;ut.push(He[At+5]>1?es(He,At,this.clusterProps):this.points[He[At+3]])}return ut}getChildren(q){const ee=this._getOriginId(q),ue=this._getOriginZoom(q),Ce="No cluster with the specified id.",pe=this.trees[ue];if(!pe)throw new Error(Ce);const Pe=pe.data;if(ee*this.stride>=Pe.length)throw new Error(Ce);const Ue=this.options.radius/(this.options.extent*Math.pow(2,ue-1)),Re=pe.within(Pe[ee*this.stride],Pe[ee*this.stride+1],Ue),He=[];for(const ut of Re){const st=ut*this.stride;Pe[st+4]===q&&He.push(Pe[st+5]>1?es(Pe,st,this.clusterProps):this.points[Pe[st+3]])}if(He.length===0)throw new Error(Ce);return He}getLeaves(q,ee,ue){const Ce=[];return this._appendLeaves(Ce,q,ee=ee||10,ue=ue||0,0),Ce}getTile(q,ee,ue){const Ce=this.trees[this._limitZoom(q)],pe=Math.pow(2,q),{extent:Pe,radius:Ue}=this.options,Re=Ue/Pe,He=(ue-Re)/pe,ut=(ue+1+Re)/pe,st={features:[]};return this._addTileFeatures(Ce.range((ee-Re)/pe,He,(ee+1+Re)/pe,ut),Ce.data,ee,ue,pe,st),ee===0&&this._addTileFeatures(Ce.range(1-Re/pe,He,1,ut),Ce.data,pe,ue,pe,st),ee===pe-1&&this._addTileFeatures(Ce.range(0,He,Re/pe,ut),Ce.data,-1,ue,pe,st),st.features.length?st:null}getClusterExpansionZoom(q){let ee=this._getOriginZoom(q)-1;for(;ee<=this.options.maxZoom;){const ue=this.getChildren(q);if(ee++,ue.length!==1)break;q=ue[0].properties.cluster_id}return ee}_appendLeaves(q,ee,ue,Ce,pe){const Pe=this.getChildren(ee);for(const Ue of Pe){const Re=Ue.properties;if(Re&&Re.cluster?pe+Re.point_count<=Ce?pe+=Re.point_count:pe=this._appendLeaves(q,Re.cluster_id,ue,Ce,pe):pe<Ce?pe++:q.push(Ue),q.length===ue)break}return pe}_createTree(q){const ee=new o.c4(q.length/this.stride|0,this.options.nodeSize,Float32Array);for(let ue=0;ue<q.length;ue+=this.stride)ee.add(q[ue],q[ue+1]);return ee.finish(),ee.data=q,ee}_addTileFeatures(q,ee,ue,Ce,pe,Pe){for(const Ue of q){const Re=Ue*this.stride,He=ee[Re+5]>1;let ut,st,At;if(He)ut=Dr(ee,Re,this.clusterProps),st=ee[Re],At=ee[Re+1];else{const oi=this.points[ee[Re+3]];ut=oi.properties;const[pi,ti]=oi.geometry.coordinates;st=ko(pi),At=Lo(ti)}const Nt={type:1,geometry:[[Math.round(this.options.extent*(st*pe-ue)),Math.round(this.options.extent*(At*pe-Ce))]],tags:ut};let Wt;Wt=He||this.options.generateId?ee[Re+3]:this.points[ee[Re+3]].id,Wt!==void 0&&(Nt.id=Wt),Pe.features.push(Nt)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,ee){const{radius:ue,extent:Ce,reduce:pe,minPoints:Pe}=this.options,Ue=ue/(Ce*Math.pow(2,ee)),Re=q.data,He=[],ut=this.stride;for(let st=0;st<Re.length;st+=ut){if(Re[st+2]<=ee)continue;Re[st+2]=ee;const At=Re[st],Nt=Re[st+1],Wt=q.within(Re[st],Re[st+1],Ue),oi=Re[st+5];let pi=oi;for(const ti of Wt){const Kt=ti*ut;Re[Kt+2]>ee&&(pi+=Re[Kt+5])}if(pi>oi&&pi>=Pe){let ti,Kt=At*oi,lr=Nt*oi,Wr=-1;const Or=(st/ut<<5)+(ee+1)+this.points.length;for(const zr of Wt){const vr=zr*ut;if(Re[vr+2]<=ee)continue;Re[vr+2]=ee;const Ci=Re[vr+5];Kt+=Re[vr]*Ci,lr+=Re[vr+1]*Ci,Re[vr+4]=Or,pe&&(ti||(ti=this._map(Re,st,!0),Wr=this.clusterProps.length,this.clusterProps.push(ti)),pe(ti,this._map(Re,vr)))}Re[st+4]=Or,He.push(Kt/pi,lr/pi,1/0,Or,-1,pi),pe&&He.push(Wr)}else{for(let ti=0;ti<ut;ti++)He.push(Re[st+ti]);if(pi>1)for(const ti of Wt){const Kt=ti*ut;if(!(Re[Kt+2]<=ee)){Re[Kt+2]=ee;for(let lr=0;lr<ut;lr++)He.push(Re[Kt+lr])}}}}return He}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,ee,ue){if(q[ee+5]>1){const Pe=this.clusterProps[q[ee+6]];return ue?Object.assign({},Pe):Pe}const Ce=this.points[q[ee+3]].properties,pe=this.options.map(Ce);return ue&&pe===Ce?Object.assign({},pe):pe}}function es(De,q,ee){return{type:"Feature",id:De[q+3],properties:Dr(De,q,ee),geometry:{type:"Point",coordinates:[(ue=De[q],360*(ue-.5)),Po(De[q+1])]}};var ue}function Dr(De,q,ee){const ue=De[q+5],Ce=ue>=1e4?`${Math.round(ue/1e3)}k`:ue>=1e3?Math.round(ue/100)/10+"k":ue,pe=De[q+6],Pe=pe===-1?{}:Object.assign({},ee[pe]);return Object.assign(Pe,{cluster:!0,cluster_id:De[q+3],point_count:ue,point_count_abbreviated:Ce})}function ko(De){return De/360+.5}function Lo(De){const q=Math.sin(De*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function Po(De){const q=(180-360*De)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function ea(De,q,ee,ue){let Ce=ue;const pe=q+(ee-q>>1);let Pe,Ue=ee-q;const Re=De[q],He=De[q+1],ut=De[ee],st=De[ee+1];for(let At=q+3;At<ee;At+=3){const Nt=ta(De[At],De[At+1],Re,He,ut,st);if(Nt>Ce)Pe=At,Ce=Nt;else if(Nt===Ce){const Wt=Math.abs(At-pe);Wt<Ue&&(Pe=At,Ue=Wt)}}Ce>ue&&(Pe-q>3&&ea(De,q,Pe,ue),De[Pe+2]=Ce,ee-Pe>3&&ea(De,Pe,ee,ue))}function ta(De,q,ee,ue,Ce,pe){let Pe=Ce-ee,Ue=pe-ue;if(Pe!==0||Ue!==0){const Re=((De-ee)*Pe+(q-ue)*Ue)/(Pe*Pe+Ue*Ue);Re>1?(ee=Ce,ue=pe):Re>0&&(ee+=Pe*Re,ue+=Ue*Re)}return Pe=De-ee,Ue=q-ue,Pe*Pe+Ue*Ue}function $n(De,q,ee,ue){const Ce={id:De??null,type:q,geometry:ee,tags:ue,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(q==="Point"||q==="MultiPoint"||q==="LineString")zn(Ce,ee);else if(q==="Polygon")zn(Ce,ee[0]);else if(q==="MultiLineString")for(const pe of ee)zn(Ce,pe);else if(q==="MultiPolygon")for(const pe of ee)zn(Ce,pe[0]);return Ce}function zn(De,q){for(let ee=0;ee<q.length;ee+=3)De.minX=Math.min(De.minX,q[ee]),De.minY=Math.min(De.minY,q[ee+1]),De.maxX=Math.max(De.maxX,q[ee]),De.maxY=Math.max(De.maxY,q[ee+1])}function po(De,q,ee,ue){if(!q.geometry)return;const Ce=q.geometry.coordinates;if(Ce&&Ce.length===0)return;const pe=q.geometry.type,Pe=Math.pow(ee.tolerance/((1<<ee.maxZoom)*ee.extent),2);let Ue=[],Re=q.id;if(ee.promoteId?Re=q.properties[ee.promoteId]:ee.generateId&&(Re=ue||0),pe==="Point")Ps(Ce,Ue);else if(pe==="MultiPoint")for(const He of Ce)Ps(He,Ue);else if(pe==="LineString")Mo(Ce,Ue,Pe,!1);else if(pe==="MultiLineString"){if(ee.lineMetrics){for(const He of Ce)Ue=[],Mo(He,Ue,Pe,!1),De.push($n(Re,"LineString",Ue,q.properties));return}mo(Ce,Ue,Pe,!1)}else if(pe==="Polygon")mo(Ce,Ue,Pe,!0);else{if(pe!=="MultiPolygon"){if(pe==="GeometryCollection"){for(const He of q.geometry.geometries)po(De,{id:Re,geometry:He,properties:q.properties},ee,ue);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of Ce){const ut=[];mo(He,ut,Pe,!0),Ue.push(ut)}}De.push($n(Re,pe,Ue,q.properties))}function Ps(De,q){q.push(Mn(De[0]),Ro(De[1]),0)}function Mo(De,q,ee,ue){let Ce,pe,Pe=0;for(let Re=0;Re<De.length;Re++){const He=Mn(De[Re][0]),ut=Ro(De[Re][1]);q.push(He,ut,0),Re>0&&(Pe+=ue?(Ce*ut-He*pe)/2:Math.sqrt(Math.pow(He-Ce,2)+Math.pow(ut-pe,2))),Ce=He,pe=ut}const Ue=q.length-3;q[2]=1,ea(q,0,Ue,ee),q[Ue+2]=1,q.size=Math.abs(Pe),q.start=0,q.end=q.size}function mo(De,q,ee,ue){for(let Ce=0;Ce<De.length;Ce++){const pe=[];Mo(De[Ce],pe,ee,ue),q.push(pe)}}function Mn(De){return De/360+.5}function Ro(De){const q=Math.sin(De*Math.PI/180),ee=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return ee<0?0:ee>1?1:ee}function ts(De,q,ee,ue,Ce,pe,Pe,Ue){if(ue/=q,pe>=(ee/=q)&&Pe<ue)return De;if(Pe<ee||pe>=ue)return null;const Re=[];for(const He of De){const ut=He.geometry;let st=He.type;const At=Ce===0?He.minX:He.minY,Nt=Ce===0?He.maxX:He.maxY;if(At>=ee&&Nt<ue){Re.push(He);continue}if(Nt<ee||At>=ue)continue;let Wt=[];if(st==="Point"||st==="MultiPoint")ia(ut,Wt,ee,ue,Ce);else if(st==="LineString")go(ut,Wt,ee,ue,Ce,!1,Ue.lineMetrics);else if(st==="MultiLineString")_o(ut,Wt,ee,ue,Ce,!1);else if(st==="Polygon")_o(ut,Wt,ee,ue,Ce,!0);else if(st==="MultiPolygon")for(const oi of ut){const pi=[];_o(oi,pi,ee,ue,Ce,!0),pi.length&&Wt.push(pi)}if(Wt.length){if(Ue.lineMetrics&&st==="LineString"){for(const oi of Wt)Re.push($n(He.id,st,oi,He.tags));continue}st!=="LineString"&&st!=="MultiLineString"||(Wt.length===1?(st="LineString",Wt=Wt[0]):st="MultiLineString"),st!=="Point"&&st!=="MultiPoint"||(st=Wt.length===3?"Point":"MultiPoint"),Re.push($n(He.id,st,Wt,He.tags))}}return Re.length?Re:null}function ia(De,q,ee,ue,Ce){for(let pe=0;pe<De.length;pe+=3){const Pe=De[pe+Ce];Pe>=ee&&Pe<=ue&&Ms(q,De[pe],De[pe+1],De[pe+2])}}function go(De,q,ee,ue,Ce,pe,Pe){let Ue=Yr(De);const Re=Ce===0?Do:Rs;let He,ut,st=De.start;for(let pi=0;pi<De.length-3;pi+=3){const ti=De[pi],Kt=De[pi+1],lr=De[pi+2],Wr=De[pi+3],Or=De[pi+4],zr=Ce===0?ti:Kt,vr=Ce===0?Wr:Or;let Ci=!1;Pe&&(He=Math.sqrt(Math.pow(ti-Wr,2)+Math.pow(Kt-Or,2))),zr<ee?vr>ee&&(ut=Re(Ue,ti,Kt,Wr,Or,ee),Pe&&(Ue.start=st+He*ut)):zr>ue?vr<ue&&(ut=Re(Ue,ti,Kt,Wr,Or,ue),Pe&&(Ue.start=st+He*ut)):Ms(Ue,ti,Kt,lr),vr<ee&&zr>=ee&&(ut=Re(Ue,ti,Kt,Wr,Or,ee),Ci=!0),vr>ue&&zr<=ue&&(ut=Re(Ue,ti,Kt,Wr,Or,ue),Ci=!0),!pe&&Ci&&(Pe&&(Ue.end=st+He*ut),q.push(Ue),Ue=Yr(De)),Pe&&(st+=He)}let At=De.length-3;const Nt=De[At],Wt=De[At+1],oi=Ce===0?Nt:Wt;oi>=ee&&oi<=ue&&Ms(Ue,Nt,Wt,De[At+2]),At=Ue.length-3,pe&&At>=3&&(Ue[At]!==Ue[0]||Ue[At+1]!==Ue[1])&&Ms(Ue,Ue[0],Ue[1],Ue[2]),Ue.length&&q.push(Ue)}function Yr(De){const q=[];return q.size=De.size,q.start=De.start,q.end=De.end,q}function _o(De,q,ee,ue,Ce,pe){for(const Pe of De)go(Pe,q,ee,ue,Ce,pe,!1)}function Ms(De,q,ee,ue){De.push(q,ee,ue)}function Do(De,q,ee,ue,Ce,pe){const Pe=(pe-q)/(ue-q);return Ms(De,pe,ee+(Ce-ee)*Pe,1),Pe}function Rs(De,q,ee,ue,Ce,pe){const Pe=(pe-ee)/(Ce-ee);return Ms(De,q+(ue-q)*Pe,pe,1),Pe}function Oo(De,q){const ee=[];for(let ue=0;ue<De.length;ue++){const Ce=De[ue],pe=Ce.type;let Pe;if(pe==="Point"||pe==="MultiPoint"||pe==="LineString")Pe=zo(Ce.geometry,q);else if(pe==="MultiLineString"||pe==="Polygon"){Pe=[];for(const Ue of Ce.geometry)Pe.push(zo(Ue,q))}else if(pe==="MultiPolygon"){Pe=[];for(const Ue of Ce.geometry){const Re=[];for(const He of Ue)Re.push(zo(He,q));Pe.push(Re)}}ee.push($n(Ce.id,pe,Pe,Ce.tags))}return ee}function zo(De,q){const ee=[];ee.size=De.size,De.start!==void 0&&(ee.start=De.start,ee.end=De.end);for(let ue=0;ue<De.length;ue+=3)ee.push(De[ue]+q,De[ue+1],De[ue+2]);return ee}function Ea(De,q){if(De.transformed)return De;const ee=1<<De.z,ue=De.x,Ce=De.y;for(const pe of De.features){const Pe=pe.geometry,Ue=pe.type;if(pe.geometry=[],Ue===1)for(let Re=0;Re<Pe.length;Re+=2)pe.geometry.push(ir(Pe[Re],Pe[Re+1],q,ee,ue,Ce));else for(let Re=0;Re<Pe.length;Re++){const He=[];for(let ut=0;ut<Pe[Re].length;ut+=2)He.push(ir(Pe[Re][ut],Pe[Re][ut+1],q,ee,ue,Ce));pe.geometry.push(He)}}return De.transformed=!0,De}function ir(De,q,ee,ue,Ce,pe){return[Math.round(ee*(De*ue-Ce)),Math.round(ee*(q*ue-pe))]}function ln(De,q,ee,ue,Ce){const pe=q===Ce.maxZoom?0:Ce.tolerance/((1<<q)*Ce.extent),Pe={features:[],numPoints:0,numSimplified:0,numFeatures:De.length,source:null,x:ee,y:ue,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Ue of De)Ia(Pe,Ue,pe,Ce);return Pe}function Ia(De,q,ee,ue){const Ce=q.geometry,pe=q.type,Pe=[];if(De.minX=Math.min(De.minX,q.minX),De.minY=Math.min(De.minY,q.minY),De.maxX=Math.max(De.maxX,q.maxX),De.maxY=Math.max(De.maxY,q.maxY),pe==="Point"||pe==="MultiPoint")for(let Ue=0;Ue<Ce.length;Ue+=3)Pe.push(Ce[Ue],Ce[Ue+1]),De.numPoints++,De.numSimplified++;else if(pe==="LineString")Aa(Pe,Ce,De,ee,!1,!1);else if(pe==="MultiLineString"||pe==="Polygon")for(let Ue=0;Ue<Ce.length;Ue++)Aa(Pe,Ce[Ue],De,ee,pe==="Polygon",Ue===0);else if(pe==="MultiPolygon")for(let Ue=0;Ue<Ce.length;Ue++){const Re=Ce[Ue];for(let He=0;He<Re.length;He++)Aa(Pe,Re[He],De,ee,!0,He===0)}if(Pe.length){let Ue=q.tags||null;if(pe==="LineString"&&ue.lineMetrics){Ue={};for(const He in q.tags)Ue[He]=q.tags[He];Ue.mapbox_clip_start=Ce.start/Ce.size,Ue.mapbox_clip_end=Ce.end/Ce.size}const Re={geometry:Pe,type:pe==="Polygon"||pe==="MultiPolygon"?3:pe==="LineString"||pe==="MultiLineString"?2:1,tags:Ue};q.id!==null&&(Re.id=q.id),De.features.push(Re)}}function Aa(De,q,ee,ue,Ce,pe){const Pe=ue*ue;if(ue>0&&q.size<(Ce?Pe:ue))return void(ee.numPoints+=q.length/3);const Ue=[];for(let Re=0;Re<q.length;Re+=3)(ue===0||q[Re+2]>Pe)&&(ee.numSimplified++,Ue.push(q[Re],q[Re+1])),ee.numPoints++;Ce&&function(Re,He){let ut=0;for(let st=0,At=Re.length,Nt=At-2;st<At;Nt=st,st+=2)ut+=(Re[st]-Re[Nt])*(Re[st+1]+Re[Nt+1]);if(ut>0===He)for(let st=0,At=Re.length;st<At/2;st+=2){const Nt=Re[st],Wt=Re[st+1];Re[st]=Re[At-2-st],Re[st+1]=Re[At-1-st],Re[At-2-st]=Nt,Re[At-1-st]=Wt}}(Ue,pe),De.push(Ue)}const Bn={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class gc{constructor(q,ee){const ue=(ee=this.options=function(pe,Pe){for(const Ue in Pe)pe[Ue]=Pe[Ue];return pe}(Object.create(Bn),ee)).debug;if(ue&&console.time("preprocess data"),ee.maxZoom<0||ee.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ee.promoteId&&ee.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(pe,Pe){const Ue=[];if(pe.type==="FeatureCollection")for(let Re=0;Re<pe.features.length;Re++)po(Ue,pe.features[Re],Pe,Re);else po(Ue,pe.type==="Feature"?pe:{geometry:pe},Pe);return Ue}(q,ee);this.tiles={},this.tileCoords=[],ue&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ee.indexMaxZoom,ee.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(pe,Pe){const Ue=Pe.buffer/Pe.extent;let Re=pe;const He=ts(pe,1,-1-Ue,Ue,0,-1,2,Pe),ut=ts(pe,1,1-Ue,2+Ue,0,-1,2,Pe);return(He||ut)&&(Re=ts(pe,1,-Ue,1+Ue,0,-1,2,Pe)||[],He&&(Re=Oo(He,1).concat(Re)),ut&&(Re=Re.concat(Oo(ut,-1)))),Re}(Ce,ee),Ce.length&&this.splitTile(Ce,0,0,0),ue&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(q,ee,ue,Ce,pe,Pe,Ue){const Re=[q,ee,ue,Ce],He=this.options,ut=He.debug;for(;Re.length;){Ce=Re.pop(),ue=Re.pop(),ee=Re.pop(),q=Re.pop();const st=1<<ee,At=Qa(ee,ue,Ce);let Nt=this.tiles[At];if(!Nt&&(ut>1&&console.time("creation"),Nt=this.tiles[At]=ln(q,ee,ue,Ce,He),this.tileCoords.push({z:ee,x:ue,y:Ce}),ut)){ut>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ee,ue,Ce,Nt.numFeatures,Nt.numPoints,Nt.numSimplified),console.timeEnd("creation"));const Ci=`z${ee}`;this.stats[Ci]=(this.stats[Ci]||0)+1,this.total++}if(Nt.source=q,pe==null){if(ee===He.indexMaxZoom||Nt.numPoints<=He.indexMaxPoints)continue}else{if(ee===He.maxZoom||ee===pe)continue;if(pe!=null){const Ci=pe-ee;if(ue!==Pe>>Ci||Ce!==Ue>>Ci)continue}}if(Nt.source=null,q.length===0)continue;ut>1&&console.time("clipping");const Wt=.5*He.buffer/He.extent,oi=.5-Wt,pi=.5+Wt,ti=1+Wt;let Kt=null,lr=null,Wr=null,Or=null,zr=ts(q,st,ue-Wt,ue+pi,0,Nt.minX,Nt.maxX,He),vr=ts(q,st,ue+oi,ue+ti,0,Nt.minX,Nt.maxX,He);q=null,zr&&(Kt=ts(zr,st,Ce-Wt,Ce+pi,1,Nt.minY,Nt.maxY,He),lr=ts(zr,st,Ce+oi,Ce+ti,1,Nt.minY,Nt.maxY,He),zr=null),vr&&(Wr=ts(vr,st,Ce-Wt,Ce+pi,1,Nt.minY,Nt.maxY,He),Or=ts(vr,st,Ce+oi,Ce+ti,1,Nt.minY,Nt.maxY,He),vr=null),ut>1&&console.timeEnd("clipping"),Re.push(Kt||[],ee+1,2*ue,2*Ce),Re.push(lr||[],ee+1,2*ue,2*Ce+1),Re.push(Wr||[],ee+1,2*ue+1,2*Ce),Re.push(Or||[],ee+1,2*ue+1,2*Ce+1)}}getTile(q,ee,ue){q=+q,ee=+ee,ue=+ue;const Ce=this.options,{extent:pe,debug:Pe}=Ce;if(q<0||q>24)return null;const Ue=1<<q,Re=Qa(q,ee=ee+Ue&Ue-1,ue);if(this.tiles[Re])return Ea(this.tiles[Re],pe);Pe>1&&console.log("drilling down to z%d-%d-%d",q,ee,ue);let He,ut=q,st=ee,At=ue;for(;!He&&ut>0;)ut--,st>>=1,At>>=1,He=this.tiles[Qa(ut,st,At)];return He&&He.source?(Pe>1&&(console.log("found parent tile z%d-%d-%d",ut,st,At),console.time("drilling down")),this.splitTile(He.source,ut,st,At,q,ee,ue),Pe>1&&console.timeEnd("drilling down"),this.tiles[Re]?Ea(this.tiles[Re],pe):null):null}}function Qa(De,q,ee){return 32*((1<<De)*ee+q)+De}function at(De,q){const ee=De.tileID.canonical;if(!this._geoJSONIndex)return void q(null,null);const ue=this._geoJSONIndex.getTile(ee.z,ee.x,ee.y);if(!ue)return void q(null,null);const Ce=He=>He.tags&&"3d_elevation_id"in He.tags&&"source"in He.tags&&He.tags.source==="elevation",pe=ue.features.filter(He=>Ce(He));let Pe={_geojsonTileLayer:ue.features};pe.length>0&&(Pe={_geojsonTileLayer:ue.features.filter(He=>!Ce(He)),hd_road_elevation:pe});const Ue=new vi(Pe),Re=function(He){const ut=new o.bt;for(const st of Object.keys(He))ut.writeMessage(3,sr,{name:st,features:He[st]});return ut.finish()}(Pe).buffer;q(null,{vectorTile:Ue,rawData:Re})}class Li extends ct{constructor(q,ee,ue,Ce,pe,Pe,Ue){super(q,ee,ue,Ce,pe,at,Ue),Pe&&(this.loadGeoJSON=Pe),this._dynamicIndex=new si}loadData(q,ee){const ue=q&&q.request,Ce=ue&&ue.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(q,(pe,Pe)=>{if(pe||!Pe)return ee(pe);if(typeof Pe!="object")return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{try{if(q.filter){const Re=o.U(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Re.result==="error")throw new Error(Re.value.map(He=>`${He.key}: ${He.message}`).join(", "));Pe.features=Pe.features.filter(He=>Re.value.evaluate({zoom:0},He))}q.dynamic?(Pe.type==="Feature"&&(Pe={type:"FeatureCollection",features:[Pe]}),q.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Pe.features,this.loaded),q.cluster&&(Pe.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=q.cluster?new Qo(function({superclusterOptions:Re,clusterProperties:He}){if(!He||!Re)return Re;const ut={},st={},At={accumulated:null,zoom:0},Nt={properties:null},Wt=Object.keys(He);for(const oi of Wt){const[pi,ti]=He[oi],Kt=o.U(ti),lr=o.U(typeof pi=="string"?[pi,["accumulated"],["get",oi]]:pi);ut[oi]=Kt.value,st[oi]=lr.value}return Re.map=oi=>{Nt.properties=oi;const pi={};for(const ti of Wt)pi[ti]=ut[ti].evaluate(At,Nt);return pi},Re.reduce=(oi,pi)=>{Nt.properties=pi;for(const ti of Wt)At.accumulated=oi[ti],oi[ti]=st[ti].evaluate(At,Nt)},Re}(q)).load(Pe.features):q.dynamic?this._dynamicIndex:function(Re,He){return new gc(Re,He)}(Pe,q.geojsonVtOptions)}catch(Re){return ee(Re)}const Ue={};if(Ce){const Re=D(ue);Re&&(Ue.resourceTiming={},Ue.resourceTiming[q.source]=JSON.parse(JSON.stringify(Re)))}ee(null,Ue)}})}reloadTile(q,ee){const ue=this.loaded;return ue&&ue[q.uid]?q.partial?ee(null,void 0):super.reloadTile(q,ee):this.loadTile(q,ee)}loadGeoJSON(q,ee){if(q.request)o.m(q.request,ee);else{if(typeof q.data!="string")return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ee(null,JSON.parse(q.data))}catch{return ee(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(q,ee){try{ee(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(ue){ee(ue)}}getClusterChildren(q,ee){try{ee(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(ue){ee(ue)}}getClusterLeaves(q,ee){try{ee(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(ue){ee(ue)}}}class bp{constructor(q,ee,ue){this.tileID=new o.aQ(q.tileID.overscaledZ,q.tileID.wrap,q.tileID.canonical.z,q.tileID.canonical.x,q.tileID.canonical.y),this.tileZoom=q.tileZoom,this.uid=q.uid,this.zoom=q.zoom,this.canonical=q.tileID.canonical,this.pixelRatio=q.pixelRatio,this.tileSize=q.tileSize,this.source=q.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=q.projection,this.brightness=ee,this.worldview=ue}parse(q,ee,ue,Ce){this.status="parsing";const pe=new o.aQ(ue.tileID.overscaledZ,ue.tileID.wrap,ue.tileID.canonical.z,ue.tileID.canonical.x,ue.tileID.canonical.y),Pe=[],Ue=ee.familiesBySource[ue.source],Re=new o.fn(pe,ue.promoteId);Re.bucketLayerIDs=[],Re.is3DTile=!0,o.fC(q).then(He=>{if(!He)return Ce(new Error("Could not parse tile"));const ut=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,st=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),At=new o.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Nt in Ue)for(const Wt of Ue[Nt]){const oi=Wt[0];Re.bucketLayerIDs.push(Wt.map(Kt=>o.B(Kt.id,Kt.scope))),oi.recalculate(At,[]);const pi=o.fD(He,1/o.d7(ue.tileID.canonical)),ti=new o.fE(Wt,pi,pe,ut,st,this.brightness,Re,this.worldview);ut||(ti.needsUpload=!0),Pe.push(ti),ti.evaluate(oi)}this.status="done",Ce(null,{buckets:Pe,featureIndex:Re,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>Ce(new Error(He.message)))}}class Mu{constructor(q,ee,ue,Ce,pe,Pe,Ue,Re){this.actor=q,this.layerIndex=ee,this.availableImages=ue,this.availableModels=Ce,this.brightness=Ue,this.loading={},this.loaded={},this.worldview=Re}loadTile(q,ee){const ue=q.uid,Ce=this.loading[ue]=new bp(q,this.brightness,this.worldview);o.bu(q.request,(pe,Pe)=>{const Ue=!this.loading[ue];return delete this.loading[ue],Ue||pe?(Ce.status="done",Ue||(this.loaded[ue]=Ce),ee(pe)):Pe&&Pe.byteLength!==0?void Ce.parse(Pe,this.layerIndex,q,(Re,He)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[ue]=Ce,Re||!He?ee(Re):ee(null,He)}):(Ce.status="done",this.loaded[ue]=Ce,ee())})}reloadTile(q,ee){const ue=this.loaded,Ce=q.uid;if(ue&&ue[Ce]){const pe=ue[Ce];pe.projection=q.projection,pe.brightness=q.brightness;const Pe=(Ue,Re)=>{pe.reloadCallback&&(delete pe.reloadCallback,this.loadTile(q,ee)),ee(Ue,Re)};pe.status==="parsing"?pe.reloadCallback=Pe:pe.status==="done"&&this.loadTile(q,ee)}}abortTile(q,ee){const ue=q.uid;this.loading[ue]&&delete this.loading[ue],ee()}removeTile(q,ee){const ue=this.loaded,Ce=q.uid;ue&&ue[Ce]&&delete ue[Ce],ee()}}class Pi{constructor(q){this.self=q,this.actor=new o.fG(q,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cm({name:"mercator"}),this.workerSourceTypes={vector:ct,geojson:Li,"raster-dem":lt,"raster-array":zt,"batched-model":Mu},this.workerSources={},this.self.registerWorkerSource=(ee,ue)=>{if(this.workerSourceTypes[ee])throw new Error(`Worker source with name "${ee}" already registered.`);this.workerSourceTypes[ee]=ue},this.self.registerRTLTextPlugin=ee=>{if(o.fH.isParsed())throw new Error("RTL text plugin already registered.");o.fH.setState({pluginStatus:o.fI.parsed,pluginURL:o.fH.getPluginURL()}),o.fH.applyArabicShaping=ee.applyArabicShaping,o.fH.processBidirectionalText=ee.processBidirectionalText,o.fH.processStyledBidirectionalText=ee.processStyledBidirectionalText;for(const ue of this.rtlPluginParsingListeners)ue(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(q,ee,ue){delete this.layerIndexes[q],delete this.availableImages[q],delete this.availableModels[q],delete this.workerSources[q],ue()}checkIfReady(q,ee,ue){ue()}setReferrer(q,ee){this.referrer=ee}spriteLoaded(q,ee){this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={});const{scope:ue,isLoaded:Ce}=ee;if(this.isSpriteLoaded[q][ue]=Ce,this.workerSources[q]&&this.workerSources[q][ue])for(const pe in this.workerSources[q][ue]){const Pe=this.workerSources[q][ue][pe];for(const Ue in Pe){const Re=Pe[Ue];Re instanceof ct&&(Re.isSpriteLoaded=Ce,Re.fire(new o.z("isSpriteLoaded")))}}}setImages(q,ee,ue){this.availableImages[q]||(this.availableImages[q]={});const{scope:Ce,images:pe}=ee;if(this.availableImages[q][Ce]=pe,this.workerSources[q]&&this.workerSources[q][Ce]){for(const Pe in this.workerSources[q][Ce]){const Ue=this.workerSources[q][Ce][Pe];for(const Re in Ue)Ue[Re].availableImages=pe}ue()}else ue()}setModels(q,{scope:ee,models:ue},Ce){if(this.availableModels[q]||(this.availableModels[q]={}),this.availableModels[q][ee]=ue,this.workerSources[q]&&this.workerSources[q][ee]){for(const pe in this.workerSources[q][ee]){const Pe=this.workerSources[q][ee][pe];for(const Ue in Pe)Pe[Ue].availableModels=ue}Ce()}else Ce()}setProjection(q,ee){this.projections[q]=o.cm(ee)}setBrightness(q,ee,ue){this.brightness=ee,ue()}setWorldview(q,ee,ue){this.worldview=ee,ue()}setLayers(q,ee,ue){this.getLayerIndex(q,ee.scope).replace(ee.layers,ee.options),ue()}updateLayers(q,ee,ue){this.getLayerIndex(q,ee.scope).update(ee.layers,ee.removedIds,ee.options),ue()}loadTile(q,ee,ue){ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,ee.type,ee.source,ee.scope).loadTile(ee,ue)}decodeRasterArray(q,ee,ue){this.getWorkerSource(q,ee.type,ee.source,ee.scope).decodeRasterArray(ee,ue)}reloadTile(q,ee,ue){ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,ee.type,ee.source,ee.scope).reloadTile(ee,ue)}abortTile(q,ee,ue){this.getWorkerSource(q,ee.type,ee.source,ee.scope).abortTile(ee,ue)}removeTile(q,ee,ue){this.getWorkerSource(q,ee.type,ee.source,ee.scope).removeTile(ee,ue)}removeSource(q,ee,ue){if(!(this.workerSources[q]&&this.workerSources[q][ee.scope]&&this.workerSources[q][ee.scope][ee.type]&&this.workerSources[q][ee.scope][ee.type][ee.source]))return;const Ce=this.workerSources[q][ee.scope][ee.type][ee.source];delete this.workerSources[q][ee.scope][ee.type][ee.source],Ce.removeSource!==void 0?Ce.removeSource(ee,ue):ue()}loadWorkerSource(q,ee,ue){try{this.self.importScripts(ee.url),ue()}catch(Ce){ue(Ce)}}syncRTLPluginState(q,ee,ue){if(o.fH.isParsed())ue(null,!0);else if(o.fH.isParsing())this.rtlPluginParsingListeners.push(ue);else try{o.fH.setState(ee);const Ce=o.fH.getPluginURL();!o.fH.isLoaded()||o.fH.isParsed()||o.fH.isParsing()||Ce==null||(o.fH.setState({pluginStatus:o.fI.parsing,pluginURL:o.fH.getPluginURL()}),this.self.importScripts(Ce),o.fH.isParsed()?ue(null,!0):this.rtlPluginParsingListeners.push(ue))}catch(Ce){ue(Ce)}}setDracoUrl(q,ee){this.dracoUrl=ee}getAvailableImages(q,ee){this.availableImages[q]||(this.availableImages[q]={});let ue=this.availableImages[q][ee];return ue||(ue=[]),ue}getAvailableModels(q,ee){this.availableModels[q]||(this.availableModels[q]={});let ue=this.availableModels[q][ee];return ue||(ue={}),ue}getLayerIndex(q,ee){this.layerIndexes[q]||(this.layerIndexes[q]={});let ue=this.layerIndexes[q][ee];return ue||(ue=this.layerIndexes[q][ee]=new re,ue.scope=ee),ue}getWorkerSource(q,ee,ue,Ce){const pe=this.workerSources;return pe[q]||(pe[q]={}),pe[q][Ce]||(pe[q][Ce]={}),pe[q][Ce][ee]||(pe[q][Ce][ee]={}),this.isSpriteLoaded[q]||(this.isSpriteLoaded[q]={}),pe[q][Ce][ee][ue]||(pe[q][Ce][ee][ue]=new this.workerSourceTypes[ee]({send:(Pe,Ue,Re,He,ut,st)=>this.actor.send(Pe,Ue,Re,q,ut,st),scheduler:this.actor.scheduler},this.getLayerIndex(q,Ce),this.getAvailableImages(q,Ce),this.getAvailableModels(q,Ce),this.isSpriteLoaded[q][Ce],void 0,this.brightness,this.worldview)),pe[q][Ce][ee][ue]}rasterizeImagesWorker(q,ee,ue){const Ce=new Map;for(const[pe,{image:Pe,imageVariant:Ue}]of ee.tasks.entries()){const Re=this.imageRasterizer.rasterize(Ue,Pe,ee.scope,q);Ce.set(pe,Re)}ue(void 0,Ce)}removeRasterizedImages(q,ee,ue){this.imageRasterizer.removeImagesFromCacheByIds(ee.imageIds,ee.scope,q),ue()}enforceCacheSizeLimit(q,ee){o.fJ(ee)}getWorkerPerformanceMetrics(q,ee,ue){ue(void 0,void 0)}}return o.fF(self)&&(self.worker=new Pi(self)),Pi}),w(["./shared"],function(o){var D="3.18.1";const j={create:"create",load:"load",fullLoad:"fullLoad"},J={mark(h){performance.mark(h)},measure(h,t,l){performance.measure(h,t,l)}};function ie(h){const t=h.name.split("?")[0];return o.a(t)&&t.includes("mapbox-gl.js")?"javascript":o.a(t)&&t.includes("mapbox-gl.css")?"css":o.b(t)?"fontRange":o.c(t)?"sprite":o.i(t)?"style":o.d(t)?"tilejson":"other"}var re,he={},ce=function(){if(re)return he;function h(d){return!t(d)}function t(d){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var y,x,T=new Blob([""],{type:"text/javascript"}),E=URL.createObjectURL(T);try{x=new Worker(E),y=!0}catch{y=!1}return x&&x.terminate(),URL.revokeObjectURL(E),y}()?function(){var y=document.createElement("canvas");y.width=y.height=1;var x=y.getContext("2d");if(!x)return!1;var T=x.getImageData(0,0,1,1);return T&&T.width===y.width}()?(l[g=d&&d.failIfMajorPerformanceCaveat]===void 0&&(l[g]=function(y){var x,T=function(E){var L=document.createElement("canvas"),P=Object.create(h.webGLContextAttributes);return P.failIfMajorPerformanceCaveat=E,L.getContext("webgl2",P)}(y);if(!T)return!1;try{x=T.createShader(T.VERTEX_SHADER)}catch{return!1}return!(!x||T.isContextLost())&&(T.shaderSource(x,"void main() {}"),T.compileShader(x),T.getShaderParameter(x,T.COMPILE_STATUS)===!0)}(g)),l[g]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var g}re=1,he.supported=h,he.notSupportedReason=t;var l={};return h.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},he}();function xe(h,t,l){const d=document.createElement(h);return t!=null&&(d.className=t),l&&l.appendChild(d),d}function Ee(h,t,l){const d=document.createElementNS("http://www.w3.org/2000/svg",h);for(const g of Object.keys(t))d.setAttributeNS(null,g,String(t[g]));return l&&l.appendChild(d),d}const ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,K=ve&&ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let fe;function ke(){ve&&K&&(fe=ve[K],ve[K]="none")}function Be(){ve&&K&&(ve[K]=fe)}function Le(h){h.preventDefault(),h.stopPropagation(),window.removeEventListener("click",Le,!0)}function We(){window.addEventListener("click",Le,!0),window.setTimeout(()=>{window.removeEventListener("click",Le,!0)},0)}function ct(h,t){const l=h.getBoundingClientRect();return zt(h,l,t)}function lt(h,t){const l=h.getBoundingClientRect(),d=[];for(let g=0;g<t.length;g++)d.push(zt(h,l,t[g]));return d}function Pt(h){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&h.button===2&&h.ctrlKey?0:h.button}function zt(h,t,l){const d=h.offsetWidth===t.width?1:h.offsetWidth/t.width;return new o.P((l.clientX-t.left)*d,(l.clientY-t.top)*d)}const _i="01",Ut="NO_ACCESS_TOKEN";class bi{constructor(t,l,d){this._transformRequestFn=t,this._customAccessToken=l,this._silenceAuthErrors=!!d,this._createSkuToken()}_createSkuToken(){const t=function(){let l="";for(let d=0;d<10;d++)l+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",_i,l].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,l){return this._transformRequestFn&&this._transformRequestFn(t,l)||{url:t}}normalizeStyleURL(t,l){if(!o.h(t))return t;const d=ei(t);return d.params.push(`sdk=js-${D}`),d.path=`/styles/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeGlyphsURL(t,l){if(!o.h(t))return t;const d=ei(t);return d.path=`/fonts/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeModelURL(t,l){if(!o.h(t))return t;const d=ei(t);return d.path=`/models/v1${d.path}`,this._makeAPIURL(d,this._customAccessToken||l)}normalizeSourceURL(t,l,d,g){if(!o.h(t))return t;const y=ei(t);return y.path=`/v4/${y.authority}.json`,y.params.push("secure"),d&&y.params.push(`language=${d}`),g&&y.params.push(`worldview=${g}`),this._makeAPIURL(y,this._customAccessToken||l)}normalizeIconsetURL(t,l){const d=ei(t);return o.h(t)?(d.path=`/styles/v1${d.path}/iconset.pbf`,this._makeAPIURL(d,this._customAccessToken||l)):si(d)}normalizeSpriteURL(t,l,d,g){const y=ei(t);return o.h(t)?(y.path=`/styles/v1${y.path}/sprite${l}${d}`,this._makeAPIURL(y,this._customAccessToken||g)):(y.path+=`${l}${d}`,si(y))}normalizeTileURL(t,l,d){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!o.h(t))return t;const g=ei(t);g.path=g.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${l||d&&g.authority!=="raster"&&d===512?"@2x":""}${o.k.supported?".webp":"$1"}`),g.authority==="raster"?g.path=`/${o.e.RASTER_URL_PREFIX}${g.path}`:g.authority==="rasterarrays"?g.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${g.path}`:g.authority==="3dtiles"?g.path=`/${o.e.TILES3D_URL_PREFIX}${g.path}`:(g.path=g.path.replace(/^.+\/v4\//,"/"),g.path=`/${o.e.TILE_URL_VERSION}${g.path}`);const y=this._customAccessToken||function(x){for(const T of x){const E=T.match(/^access_token=(.*)$/);if(E)return E[1]}return null}(g.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&y&&this._skuToken&&g.params.push(`sku=${this._skuToken}`),this._makeAPIURL(g,y)}canonicalizeTileURL(t,l){const d=ei(t);if(!d.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!d.path.match(/\.[\w]+$/))return t;let g="mapbox://";d.path.match(/^\/raster\/v1\//)?g+=`raster/${d.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:d.path.match(/^\/rasterarrays\/v1\//)?g+=`rasterarrays/${d.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:g+=`tiles/${d.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let y=d.params;return l&&(y=y.filter(x=>!x.match(/^access_token=/))),y.length&&(g+=`?${y.join("&")}`),g}canonicalizeTileset(t,l){const d=!!l&&o.h(l),g=[];for(const y of t.tiles||[])o.j(y)?g.push(this.canonicalizeTileURL(y,d)):g.push(y);return g}_makeAPIURL(t,l){const d="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",g=ei(o.e.API_URL);if(t.protocol=g.protocol,t.authority=g.authority,t.protocol==="http"){const y=t.params.indexOf("secure");y>=0&&t.params.splice(y,1)}if(g.path!=="/"&&(t.path=`${g.path}${t.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return si(t);if(l=l||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!l)throw new Error(`An API access token is required to use Mapbox GL. ${d}`);if(l[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${d}`)}return t.params=t.params.filter(y=>y.indexOf("access_token")===-1),t.params.push(`access_token=${l||""}`),si(t)}}const vi=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function ei(h){const t=h.match(vi);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function si(h){const t=h.params.length?`?${h.params.join("&")}`:"";return`${h.protocol}://${h.authority}${h.path}${t}`}const Tt="mapbox.eventData";function Ht(h){if(!h)return null;const t=h.split(".");if(!t||t.length!==3)return null;try{return JSON.parse(o.l(t[1]))}catch{return null}}class Gt{constructor(t){this.type=t,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const l=Ht(o.e.ACCESS_TOKEN);let d="";return d=l&&l.u?o.f(l.u):o.e.ACCESS_TOKEN||"",t?`${Tt}.${t}:${d}`:`${Tt}:${d}`}fetchEventData(){const t=o.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),g=this.getStorageKey("uuidTimestamp");if(t)try{const y=localStorage.getItem(l);y&&(this.eventData=JSON.parse(y));const x=localStorage.getItem(d);x&&(this.anonId=x);const T=localStorage.getItem(g);T&&(this.anonIdTimestamp=Number(T));const E=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<E)&&this.refreshUUID()}catch{o.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=o.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=o.s("localStorage"),l=this.getStorageKey(),d=this.getStorageKey("uuid"),g=this.getStorageKey("uuidTimestamp"),y=this.anonId,x=this.anonIdTimestamp;if(t&&y)try{localStorage.setItem(d,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(l,JSON.stringify(this.eventData)),x&&localStorage.setItem(g,x.toString())}catch{o.w("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,l,d,g){if(!o.e.EVENTS_URL)return;const y=ei(o.e.EVENTS_URL);y.params.push(`access_token=${g||o.e.ACCESS_TOKEN||""}`);const x={event:this.type,created:new Date(t).toISOString()},T=l?Object.assign(x,l):x,E={url:si(y),headers:{"Content-Type":"text/plain"},body:JSON.stringify([T])};this.pendingRequest=o.p(E,L=>{this.pendingRequest=null,d(L),this.saveEventData(),this.processRequests(g)})}queueRequest(t,l){this.queue.push(t),this.processRequests(l)}}class hi extends Gt{constructor(t){super("metrics"),t&&(this.data=t)}postMetricsEvent(t){if(!o.e.EVENTS_URL||!t&&!o.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID();const l=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:l},t)}processRequests(t){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:l,payload:d}=this.queue.shift();this.postEvent(l,d,()=>{},t)}}const Ft=new class extends Gt{constructor(h){super("appUserTurnstile"),this._customAccessToken=h}postTurnstileEvent(h,t){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(h)&&h.some(l=>o.h(l)||o.j(l))&&this.queueRequest(Date.now(),t)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const t=Ht(o.e.ACCESS_TOKEN),l=t?t.u:o.e.ACCESS_TOKEN;let d=l!==this.eventData.tokenU;o.v(this.anonId)||(this.refreshUUID(),d=!0);const g=this.queue.shift();if(this.eventData.lastSuccess){const y=new Date(this.eventData.lastSuccess),x=new Date(g),T=(g-this.eventData.lastSuccess)/864e5;d=d||T>=1||T<-1||y.getDate()!==x.getDate()}else d=!0;d?this.postEvent(g,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:_i,"enabled.telemetry":!1,userId:this.anonId},y=>{y||(this.eventData.lastSuccess=g,this.eventData.tokenU=l)},h):this.processRequests()}},Ot=Ft.postTurnstileEvent.bind(Ft),di=new class extends Gt{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(h,t,l,d){this.skuToken=t,this.errorCb=d,o.e.EVENTS_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},l):this.errorCb(new Error(Ut)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),o.v(this.anonId)||this.refreshUUID(),this.postEvent(l,{sdkIdentifier:"mapbox-gl-js",sdkVersion:D,skuId:_i,skuToken:this.skuToken,userId:this.anonId},d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h))}remove(){this.errorCb=null}},wt=di.postMapLoadEvent.bind(di),sr=new class extends Gt{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(h){let t=this.mapInstanceIdMap.get(h);return t||(t=o.u(),this.mapInstanceIdMap.set(h,t)),t}getEventId(h){const t=this.eventIdPerMapInstanceMap.get(h)||0;return this.eventIdPerMapInstanceMap.set(h,t+1),t}postStyleLoadEvent(h,t){const{map:l,style:d,importedStyles:g}=t;if(!o.e.EVENTS_URL||!h&&!o.e.ACCESS_TOKEN)return;const y=this.getMapInstanceId(l),x={mapInstanceId:y,eventId:this.getEventId(y),style:d};g.length&&(x.importedStyles=g),this.queueRequest({timestamp:Date.now(),payload:x},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,payload:l}=this.queue.shift();this.postEvent(t,l,()=>{},h)}},pr=sr.postStyleLoadEvent.bind(sr),Fi=new hi({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),Si=Fi.postMetricsEvent.bind(Fi),Qt=new hi({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),Di=Qt.postMetricsEvent.bind(Qt),Pn=new class extends Gt{constructor(){super("gljs.performance")}postPerformanceEvent(h,t){o.e.EVENTS_URL&&(h||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:t},h)}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:t,performanceData:l}=this.queue.shift(),d=function(g){const y=performance.getEntriesByType("resource"),x=performance.getEntriesByType("mark"),T=function(B){const G={};if(B){for(const V in B)if(V!=="other")for(const W of B[V]){const Y=`${V}ResolveRangeMin`,se=`${V}ResolveRangeMax`,ne=`${V}RequestCount`,te=`${V}RequestCachedCount`;G[Y]=Math.min(G[Y]||1/0,W.startTime),G[se]=Math.max(G[se]||-1/0,W.responseEnd);const we=_e=>{G[_e]===void 0&&(G[_e]=0),++G[_e]};W.transferSize!==void 0&&W.transferSize===0&&we(te),we(ne)}}return G}(function(B,G){const V={};if(B)for(const W of B){const Y=G(W);V[Y]===void 0&&(V[Y]=[]),V[Y].push(W)}return V}(y,ie)),E=window.devicePixelRatio,L=navigator.connection||navigator.mozConnection||navigator.webkitConnection,P=L?L.effectiveType:void 0,z={counters:[],metadata:[],attributes:[]},O=(B,G,V)=>{V!=null&&B.push({name:G,value:V.toString()})};for(const B in T)O(z.counters,B,T[B]);if(g.interactionRange[0]!==1/0&&g.interactionRange[1]!==-1/0&&(O(z.counters,"interactionRangeMin",g.interactionRange[0]),O(z.counters,"interactionRangeMax",g.interactionRange[1])),x)for(const B of Object.values(j)){const G=x.find(V=>V.name===B);G&&O(z.counters,B,G.startTime)}return O(z.counters,"visibilityHidden",g.visibilityHidden),O(z.attributes,"style",function(B){if(B)for(const G of B){const V=G.name.split("?")[0];if(o.i(V)){const W=V.split("/").slice(-2);if(W.length===2)return`mapbox://styles/${W[0]}/${W[1]}`}}}(y)),O(z.attributes,"terrainEnabled",g.terrainEnabled?"true":"false"),O(z.attributes,"fogEnabled",g.fogEnabled?"true":"false"),O(z.attributes,"projection",g.projection),O(z.attributes,"zoom",g.zoom),O(z.metadata,"devicePixelRatio",E),O(z.metadata,"connectionEffectiveType",P),O(z.metadata,"navigatorUserAgent",navigator.userAgent),O(z.metadata,"screenWidth",window.screen.width),O(z.metadata,"screenHeight",window.screen.height),O(z.metadata,"windowWidth",window.innerWidth),O(z.metadata,"windowHeight",window.innerHeight),O(z.metadata,"mapWidth",g.width/E),O(z.metadata,"mapHeight",g.height/E),O(z.metadata,"webglRenderer",g.renderer),O(z.metadata,"webglVendor",g.vendor),O(z.metadata,"sdkVersion",D),O(z.metadata,"sdkIdentifier","mapbox-gl-js"),z}(l);for(const g of d.metadata);for(const g of d.counters);for(const g of d.attributes);this.postEvent(t,d,()=>{},h)}},or=Pn.postPerformanceEvent.bind(Pn),Ls=new class extends Gt{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(h,t,l,d){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const g=ei(o.e.API_URL+o.e.SESSION_PATH);g.params.push(`sku=${t||""}`),g.params.push(`access_token=${d||o.e.ACCESS_TOKEN||""}`);const y={url:si(g),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(y,x=>{this.pendingRequest=null,l(x),this.saveEventData(),this.processRequests(d)})}getSessionAPI(h,t,l,d){this.skuToken=t,this.errorCb=d,o.e.SESSION_PATH&&o.e.API_URL&&(l||o.e.ACCESS_TOKEN?this.queueRequest({id:h,timestamp:Date.now()},l):this.errorCb(new Error(Ut)))}processRequests(h){if(this.pendingRequest||this.queue.length===0)return;const{id:t,timestamp:l}=this.queue.shift();t&&this.success[t]||this.getSession(l,this.skuToken,d=>{d?this.errorCb(d):t&&(this.success[t]=!0)},h)}remove(){this.errorCb=null}},ar=Ls.getSessionAPI.bind(Ls),Qo=new Set;function es(h,t){t?Qo.add(h):Qo.delete(h)}class Dr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(t,l){this._updatedSourceCaches[t]=l,this.setDirty()}discardSourceCacheUpdate(t){delete this._updatedSourceCaches[t]}updateLayer(t){const l=t.scope;this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._updatedLayers[l].add(t.id),this.setDirty()}removeLayer(t){const l=t.scope;this._removedLayers[l]=this._removedLayers[l]||{},this._updatedLayers[l]=this._updatedLayers[l]||new Set,this._removedLayers[l][t.id]=t,this._updatedLayers[l].delete(t.id),this._updatedPaintProps.delete(t.fqid),this.setDirty()}getRemovedLayer(t){return this._removedLayers[t.scope]?this._removedLayers[t.scope][t.id]:null}discardLayerRemoval(t){this._removedLayers[t.scope]&&delete this._removedLayers[t.scope][t.id]}getLayerUpdatesByScope(){const t={};for(const l in this._updatedLayers)t[l]=t[l]||{},t[l].updatedIds=Array.from(this._updatedLayers[l].values());for(const l in this._removedLayers)t[l]=t[l]||{},t[l].removedIds=Object.keys(this._removedLayers[l]);return t}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(t){this._updatedPaintProps.add(t.fqid),this.setDirty()}getUpdatedImages(t){return this._updatedImages[t]?Array.from(this._updatedImages[t].values()):[]}updateImage(t,l){this._updatedImages[l]=this._updatedImages[l]||new Set,this._updatedImages[l].add(o.I.toString(t)),this.setDirty()}resetUpdatedImages(t){this._updatedImages[t]&&this._updatedImages[t].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function ko(h){const{userImage:t}=h;return!!(t&&t.render&&t.render())&&(h.data.replace(new Uint8Array(t.data.buffer)),!0)}class Lo extends o.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,t!=="raster"&&o.r()&&(this.imageRasterizerDispatcher=new o.D(o.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new o.q({width:1,height:1}))}removeScope(t){this.loaded.delete(t),this.imageProviders.delete(t),this.images.delete(t),this.updatedImages.delete(t),this.callbackDispatchedThisFrame.delete(t),this.patterns.delete(t),this.atlasImage.delete(t);const l=this.atlasTexture.get(t);l&&(l.destroy(),this.atlasTexture.delete(t))}addImageProvider(t,l){this.imageProviders.has(l)||this.imageProviders.set(l,new Map),this.imageProviders.get(l).set(t.id,t)}removeImageProvider(t,l){this.imageProviders.has(l)&&this.imageProviders.get(l).delete(t)}getPendingImageProviders(){const t=[];for(const l of this.imageProviders.values())for(const d of l.values())d.hasPendingRequests()&&t.push(d);return t}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.x),this._imageRasterizer}isLoaded(){for(const t of this.loaded.keys())if(!this.loaded.get(t))return!1;return!0}setLoaded(t,l){if(this.loaded.get(l)!==t&&(this.loaded.set(l,t),t)){for(const{ids:d,callback:g}of this.requestors)this._notify(d,l,g);this.requestors=[]}}hasImage(t,l){return!!this.getImage(t,l)}getImage(t,l){return this.images.get(l).get(t.toString())}addImage(t,l,d){this._validate(t,d)&&this.images.get(l).set(t.toString(),d)}_validate(t,l){let d=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchX" value`))),d=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "stretchY" value`))),d=!1),this._validateContent(l.content,l)||(this.fire(new o.y(new Error(`Image "${t.name}" has invalid "content" value`))),d=!1),d}_validateStretch(t,l){if(!t)return!0;let d=0;for(const g of t){if(g[0]<d||g[1]<g[0]||l<g[1])return!1;d=g[1]}return!0}_validateContent(t,l){return t?t.length!==4||!l.usvg&&(t[0]<0||l.data.width<t[0]||t[1]<0||l.data.height<t[1]||t[2]<0||l.data.width<t[2]||t[3]<0||l.data.height<t[3])?!1:!(t[2]<t[0]||t[3]<t[1]):!0}updateImage(t,l,d){const g=this.images.get(l).get(t.toString());d.version=g.version+1,this.images.get(l).set(t.toString(),d),this.updatedImages.get(l).add(t),this.removeFromImageRasterizerCache(t,l)}clearUpdatedImages(t){this.updatedImages.get(t).clear()}removeFromImageRasterizerCache(t,l){this.spriteFormat!=="raster"&&(o.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:l}):this.imageRasterizer.removeImagesFromCacheByIds([t],l))}removeImage(t,l){const d=this.images.get(l),g=d.get(t.toString());d.delete(t.toString()),this.patterns.get(l).delete(t.toString()),this.removeFromImageRasterizerCache(t,l),g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(l=>o.I.from(l))}getImages(t,l,d){const g=[],y=[],x=this.imageProviders.get(l);for(const P of t){if(!P.iconsetId){g.push(P);continue}const z=x.get(P.iconsetId);z&&(this.getImage(P,l)?y.push(P):z.addPendingRequest(P))}if(g.length===0)return void this._notify(y,l,d);let T=!0;const E=!!this.loaded.get(l),L=this.images.get(l);if(!E)for(const P of g)L.has(P.toString())||(T=!1);E||T?this._notify(g,l,d):this.requestors.push({ids:g,scope:l,callback:d})}rasterizeImages(t,l){const d=new Map,{tasks:g,scope:y}=t;for(const[x,T]of g.entries()){const E=this.getImage(T.id,y);E&&d.set(x,{image:E,imageVariant:T})}this._rasterizeImages(y,d,l)}_rasterizeImages(t,l,d){if(o.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:l,scope:t},d);else{const g=new Map;for(const[y,{image:x,imageVariant:T}]of l.entries())g.set(y,this.imageRasterizer.rasterize(T,x,t,0));d(void 0,g)}}getUpdatedImages(t){return this.updatedImages.get(t)||new Set}_notify(t,l,d){const g=this.images.get(l),y=new Map;for(const x of t){if(!g.get(x.toString())){if(x.iconsetId)continue;this.fire(new o.z("styleimagemissing",{id:x.name}))}const T=g.get(x.toString());if(!T){o.w(`Image "${x.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const E={data:T.usvg?null:T.data.clone(),pixelRatio:T.pixelRatio,sdf:T.sdf,usvg:T.usvg,version:T.version,stretchX:T.stretchX,stretchY:T.stretchY,content:T.content,hasRenderCallback:!!(T.userImage&&T.userImage.render)};T.usvg&&Object.assign(E,{width:T.icon.usvg_tree.width,height:T.icon.usvg_tree.height}),y.set(o.I.toString(x),E)}d(null,y)}getPixelSize(t){const{width:l,height:d}=this.atlasImage.get(t);return{width:l,height:d}}getPattern(t,l,d){const g=t.toString(),y=this.patterns.get(l),x=y.get(g),T=this.getImage(t,l);if(!T)return null;if(x){if(x.position.version===T.version)return x.position;x.position.version=T.version}else{if(T.usvg&&!T.data){const E=this.getPatternInFlightId(g,l);if(this.patternsInFlight.has(E))return null;this.patternsInFlight.add(E);const L=new o.A(t).scaleSelf(o.o.devicePixelRatio),P=new Map([[L.toString(),{image:T,imageVariant:L}]]);return this._rasterizeImages(l,P,(z,O)=>this.storePatternImage(L,l,T,d,O)),null}this.storePattern(t,l,T)}return this._updatePatternAtlas(l,d),y.get(g).position}getPatternInFlightId(t,l){return o.B(t,l)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(t,l,d,g,y){const x=t.toString(),T=y?y.get(x):void 0;T&&(d.data=T,this.storePattern(t.id,l,d),this._updatePatternAtlas(l,g),this.patternsInFlight.delete(this.getPatternInFlightId(t.id.toString(),l)))}storePattern(t,l,d){const g={w:d.data.width+2*o.C,h:d.data.height+2*o.C,x:0,y:0},y=new o.F(g,d,o.C);this.patterns.get(l).set(t.toString(),{bin:g,position:y})}destroyAtlasTextures(){for(const t of this.atlasTexture.values())t&&t.destroy();this.atlasTexture.clear()}bind(t,l){const d=t.gl;let g=this.atlasTexture.get(l);g?this.dirty&&(g.update(this.atlasImage.get(l)),this.dirty=!1):(g=new o.T(t,this.atlasImage.get(l),d.RGBA8),this.atlasTexture.set(l,g)),g.bind(d.LINEAR,d.CLAMP_TO_EDGE)}_updatePatternAtlas(t,l){const d=this.patterns.get(t),g=Array.from(d.values()).map(({bin:L})=>L),{w:y,h:x}=o.G(g),T=this.atlasImage.get(t);T.resize({width:y||1,height:x||1});const E=this.images.get(t);for(const[L,{bin:P,position:z}]of d.entries()){let O=z.padding;const B=P.x+O,G=P.y+O,V=E.get(L).data,W=V.width,Y=V.height;O=O>1?O-1:O,o.q.copy(V,T,{x:0,y:0},{x:B,y:G},{width:W,height:Y},l),o.q.copy(V,T,{x:0,y:Y-O},{x:B,y:G-O},{width:W,height:O},l),o.q.copy(V,T,{x:0,y:0},{x:B,y:G+Y},{width:W,height:O},l),o.q.copy(V,T,{x:W-O,y:0},{x:B-O,y:G},{width:O,height:Y},l),o.q.copy(V,T,{x:0,y:0},{x:B+W,y:G},{width:O,height:Y},l),o.q.copy(V,T,{x:W-O,y:Y-O},{x:B-O,y:G-O},{width:O,height:O},l),o.q.copy(V,T,{x:0,y:Y-O},{x:B+W,y:G-O},{width:O,height:O},l),o.q.copy(V,T,{x:0,y:0},{x:B+W,y:G+Y},{width:O,height:O},l),o.q.copy(V,T,{x:W-O,y:0},{x:B-O,y:G+Y},{width:O,height:O},l)}this.dirty=!0}beginFrame(){for(const t of this.images.keys())this.callbackDispatchedThisFrame.set(t,new Set)}dispatchRenderCallbacks(t,l){const d=this.images.get(l);for(const g of t){if(this.callbackDispatchedThisFrame.get(l).has(g.toString()))continue;this.callbackDispatchedThisFrame.get(l).add(g.toString());const y=d.get(g.toString());ko(y)&&this.updateImage(g,l,y)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Po(h){const t=h.value,l=h.valueSpec,d=h.style,g=h.styleSpec,y=h.key,x=h.arrayElementValidator||ir;if(!Array.isArray(t))return[new o.V(y,t,`array expected, ${o.K(t)} found`)];if(l.length&&t.length!==l.length)return[new o.V(y,t,`array length ${l.length} expected, length ${t.length} found`)];if(l["min-length"]&&t.length<l["min-length"])return[new o.V(y,t,`array length at least ${l["min-length"]} expected, length ${t.length} found`)];let T={type:l.value,values:l.values,minimum:l.minimum,maximum:l.maximum,function:void 0};g.$version<7&&(T.function=l.function),o.H(l.value)&&(T=l.value);let E=[];for(let L=0;L<t.length;L++)E=E.concat(x({array:t,arrayIndex:L,value:t[L],valueSpec:T,style:d,styleSpec:g,key:`${y}[${L}]`},!0));return E}function ea(h){const t=h.key,l=h.value,d=h.valueSpec;if(!o.L(l))return[new o.V(t,l,`number expected, ${o.K(l)} found`)];if(l!=l)return[new o.V(t,l,"number expected, NaN found")];if("minimum"in d){let g=d.minimum;if(Array.isArray(d.minimum)&&(g=d.minimum[h.arrayIndex]),l<g)return[new o.V(t,l,`${l} is less than the minimum value ${g}`)]}if("maximum"in d){let g=d.maximum;if(Array.isArray(d.maximum)&&(g=d.maximum[h.arrayIndex]),l>g)return[new o.V(t,l,`${l} is greater than the maximum value ${g}`)]}return[]}function ta(h){const t=h.key,l=h.value;if(!o.H(l))return[new o.V(t,l,`object expected, ${o.K(l)} found`)];const d=h.valueSpec,g=o.J(l.type);let y,x,T,E={};const L=g!=="categorical"&&l.property===void 0,P=!L,z=function(V){const W=V.stops;return Array.isArray(W)&&Array.isArray(W[0])&&o.H(W[0][0])}(l),O=ln({key:h.key,value:h.value,valueSpec:h.styleSpec.function,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{stops:function(V){if(g==="identity")return[new o.V(V.key,V.value,'identity function may not have a "stops" property')];let W=[];const Y=V.value;return W=W.concat(Po({key:V.key,value:Y,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:B})),Array.isArray(Y)&&Y.length===0&&W.push(new o.V(V.key,Y,"array must have at least one stop")),W},default:function(V){return ir({key:V.key,value:V.value,valueSpec:d,style:V.style,styleSpec:V.styleSpec})}}});return g==="identity"&&L&&O.push(new o.V(h.key,h.value,'missing required property "property"')),g==="identity"||l.stops||O.push(new o.V(h.key,h.value,'missing required property "stops"')),g==="exponential"&&d.expression&&!o.M(d)&&O.push(new o.V(h.key,h.value,"exponential functions not supported")),h.styleSpec.$version>=8&&(P&&!o.N(d)?O.push(new o.V(h.key,h.value,"property functions not supported")):L&&!o.O(d)&&O.push(new o.V(h.key,h.value,"zoom functions not supported"))),g!=="categorical"&&!z||l.property!==void 0||O.push(new o.V(h.key,h.value,'"property" property is required')),O;function B(V){let W=[];const Y=V.value,se=V.key;if(!Array.isArray(Y))return[new o.V(se,Y,`array expected, ${o.K(Y)} found`)];if(Y.length!==2)return[new o.V(se,Y,`array length 2 expected, length ${Y.length} found`)];if(z){if(!o.H(Y[0]))return[new o.V(se,Y,`object expected, ${o.K(Y[0])} found`)];const ne=Y[0];if(ne.zoom===void 0)return[new o.V(se,Y,"object stop key must have zoom")];if(ne.value===void 0)return[new o.V(se,Y,"object stop key must have value")];const te=o.J(ne.zoom);if(typeof te!="number")return[new o.V(se,ne.zoom,"stop zoom values must be numbers")];if(T&&T>te)return[new o.V(se,ne.zoom,"stop zoom values must appear in ascending order")];te!==T&&(T=te,x=void 0,E={}),W=W.concat(ln({key:`${se}[0]`,value:Y[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:ea,value:G}}))}else W=W.concat(G({key:`${se}[0]`,value:Y[0],style:V.style,styleSpec:V.styleSpec},Y));return o.Q(o.S(Y[1]))?W.concat([new o.V(`${se}[1]`,Y[1],"expressions are not allowed in function stops.")]):W.concat(ir({key:`${se}[1]`,value:Y[1],valueSpec:d,style:V.style,styleSpec:V.styleSpec}))}function G(V,W){const Y=o.K(V.value),se=o.J(V.value),ne=V.value!==null?V.value:W;if(y){if(Y!==y)return[new o.V(V.key,ne,`${Y} stop domain type must match previous stop domain type ${y}`)]}else y=Y;if(Y!=="number"&&Y!=="string"&&Y!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new o.V(V.key,ne,"stop domain value must be a number, string, or boolean")];if(Y!=="number"&&g!=="categorical"){let te=`number expected, ${Y} found`;return o.N(d)&&g===void 0&&(te+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(V.key,ne,te)]}return g!=="categorical"||Y!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?g!=="categorical"&&Y==="number"&&typeof se=="number"&&typeof x=="number"&&x!==void 0&&se<x?[new o.V(V.key,ne,"stop domain values must appear in ascending order")]:(x=se,g==="categorical"&&se in E?[new o.V(V.key,ne,"stop domain values must be unique")]:(E[se]=!0,[])):[new o.V(V.key,ne,`integer expected, found ${String(se)}`)]}}function $n(h){const t=(h.expressionContext==="property"?o.W:o.U)(o.S(h.value),h.valueSpec);if(t.result==="error")return t.value.map(d=>new o.V(`${h.key}${d.key}`,h.value,d.message));const l=t.value.expression||t.value._styleExpression.expression;if(h.expressionContext==="property"&&h.propertyKey==="text-font"&&!l.outputDefined())return[new o.V(h.key,h.value,`Invalid data expression for "${h.propertyKey}". Output values must be contained as literals within the expression.`)];if(h.expressionContext==="property"&&h.propertyType==="layout"&&!o.Z(l))return[new o.V(h.key,h.value,'"feature-state" data expressions are not supported with layout properties.')];if(h.expressionContext==="filter")return zn(l,h);if(h.expressionContext==="appearance")return po(l,h);if(h.expressionContext&&h.expressionContext.indexOf("cluster")===0){if(!o.X(l,["zoom","feature-state"]))return[new o.V(h.key,h.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(h.expressionContext==="cluster-initial"&&!o.Y(l))return[new o.V(h.key,h.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zn(h,t){const l=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)l.delete(g);if(l.size===0)return[];const d=[];return h instanceof o._&&l.has(h.name)?[new o.V(t.key,t.value,`["${h.name}"] expression is not supported in a filter for a ${t.object.type} layer with id: ${t.object.id}`)]:(h.eachChild(g=>{d.push(...zn(g,t))}),d)}function po(h,t){const l=new Set;if(t.valueSpec&&t.valueSpec.expression)for(const g of t.valueSpec.expression.parameters)l.add(g);if(l.size===0)return[];const d=[];return h instanceof o._&&!l.has(h.name)?[new o.V(t.key,t.value,`["${h.name}"] is not an allowed parameter`)]:(h.eachChild(g=>{d.push(...po(g,t))}),d)}function Ps(h){const t=h.key,l=h.value,d=h.valueSpec,g=[];return Array.isArray(d.values)?d.values.indexOf(o.J(l))===-1&&g.push(new o.V(t,l,`expected one of [${d.values.join(", ")}], ${JSON.stringify(l)} found`)):Object.keys(d.values).indexOf(o.J(l))===-1&&g.push(new o.V(t,l,`expected one of [${Object.keys(d.values).join(", ")}], ${JSON.stringify(l)} found`)),g}function Mo(h){return o.a2(o.S(h.value))?$n(Object.assign({},h,{expressionContext:"filter",valueSpec:h.styleSpec[`filter_${h.layerType||"fill"}`]})):mo(h)}function mo(h){const t=h.value,l=h.key;if(!Array.isArray(t))return[new o.V(l,t,`array expected, ${o.K(t)} found`)];if(t.length<1)return[new o.V(l,t,"filter array must have at least 1 element")];const d=h.styleSpec;let g=Ps({key:`${l}[0]`,value:t[0],valueSpec:d.filter_operator});const y=()=>{t.length>=2&&(o.a0(t[1])||g.push(new o.V(`${l}[1]`,t[1],`string expected, ${o.K(t[1])} found`)));for(let x=2;x<t.length;x++)o.J(t[1])==="$type"?g=g.concat(Ps({key:`${l}[${x}]`,value:t[x],valueSpec:d.geometry_type})):o.a0(t[x])||o.L(t[x])||o.$(t[x])||g.push(new o.V(`${l}[${x}]`,t[x],`string, number, or boolean expected, ${o.K(t[x])} found.`))};switch(o.J(t[0])){case"<":case"<=":case">":case">=":t.length>=2&&o.J(t[1])==="$type"&&g.push(new o.V(l,t,`"$type" cannot be use with operator "${t[0]}"`)),t.length!==3&&g.push(new o.V(l,t,`filter array for operator "${t[0]}" must have 3 elements`)),y();break;case"==":case"!=":t.length!==3&&g.push(new o.V(l,t,`filter array for operator "${t[0]}" must have 3 elements`)),y();break;case"in":case"!in":y();break;case"any":case"all":case"none":for(let x=1;x<t.length;x++)g=g.concat(mo({key:`${l}[${x}]`,value:t[x],style:h.style,styleSpec:h.styleSpec}));break;case"has":case"!has":t.length!==2?g.push(new o.V(l,t,`filter array for "${t[0]}" operator must have 2 elements`)):o.a0(t[1])||g.push(new o.V(`${l}[1]`,t[1],`string expected, ${o.K(t[1])} found`))}return g}function Mn(h,t){const l=h.key,d=h.style,g=h.layer,y=h.styleSpec,x=h.value,T=h.objectKey,E=y[`${t}_${h.layerType}`];if(!E)return[];const L=T.match(/^(.*)-use-theme$/);if(L&&E[L[1]])return o.Q(o.S(x))?[].concat(ir({key:l,value:x,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:T})):ir({key:l,value:x,valueSpec:{type:"string"},style:d,styleSpec:y});const P=T.match(/^(.*)-transition$/);if(t==="paint"&&P&&E[P[1]]&&E[P[1]].transition)return ir({key:l,value:x,valueSpec:y.transition,style:d,styleSpec:y});const z=h.valueSpec||E[T];if(!z)return[new o.a3(l,x,`unknown property "${T}"`)];let O;if(o.a0(x)&&o.N(z)&&!z.tokens&&(O=/^{([^}]+)}$/.exec(x))){const G=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(l,x,`"${T}" does not support interpolation syntax
Use an identity property function instead: ${G}.`)]}const B=[];if(h.layerType==="symbol")T!=="text-field"||!d||d.glyphs||d.imports||B.push(new o.V(l,x,'use of "text-field" requires a style "glyphs" property')),T==="text-font"&&o.a4(o.S(x))&&o.J(x.type)==="identity"&&B.push(new o.V(l,x,'"text-font" does not support identity functions'));else if(h.layerType==="model"&&t==="paint"&&g&&g.layout&&g.layout.hasOwnProperty("model-id")&&o.N(z)&&(o.a5(z)||o.O(z))){const G=o.W(o.S(x),z).value,V="expression"in G&&G.expression||"_styleExpression"in G&&G._styleExpression&&G._styleExpression.expression;V&&!o.X(V,["measure-light"])&&(T==="model-emissive-strength"&&o.Y(V)&&o.Z(V)||B.push(new o.V(l,x,`${T} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return B.concat(ir({key:h.key,value:x,valueSpec:z,style:d,styleSpec:y,expressionContext:"property",propertyType:t,propertyKey:T}))}function Ro(h){return Mn(h,"paint")}function ts(h){return Mn(h,"layout")}function ia(h){let t=[];const l=h.value,d=h.key,g=h.style,y=h.styleSpec;if(!o.H(l))return[new o.V(d,l,"object expected")];l.type||l.ref||t.push(new o.V(d,l,'either "type" or "ref" is required'));let x=o.J(l.type);const T=o.J(l.ref);if(l.id){const E=o.J(l.id);for(let L=0;L<h.arrayIndex;L++){const P=g.layers[L];o.J(P.id)===E&&t.push(new o.V(d,l.id,`duplicate layer id "${E}", previously used at line ${P.id.__line__}`))}}if("ref"in l){let E;["type","source","source-layer","filter","layout"].forEach(L=>{L in l&&t.push(new o.V(d,l[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{o.J(L.id)===T&&(E=L)}),E?E.ref?t.push(new o.V(d,l.ref,"ref cannot reference another ref layer")):x=o.J(E.type):typeof T=="string"&&t.push(new o.V(d,l.ref,`ref layer "${T}" not found`))}else if(x!=="background"&&x!=="sky"&&x!=="slot")if(l.source)if(o.a0(l.source)){const E=g.sources&&g.sources[l.source],L=E&&o.J(E.type);E?L==="vector"&&x==="raster"?t.push(new o.V(d,l.source,`layer "${l.id}" requires a raster source`)):L==="raster"&&x!=="raster"?t.push(new o.V(d,l.source,`layer "${l.id}" requires a vector source`)):L!=="vector"||l["source-layer"]?L==="raster-dem"&&x!=="hillshade"?t.push(new o.V(d,l.source,"raster-dem source can only be used with layer type 'hillshade'.")):L!=="raster-array"||["raster","raster-particle"].includes(x)?x==="line"&&l.paint&&(l.paint["line-gradient"]||l.paint["line-trim-offset"])&&L==="geojson"&&!E.lineMetrics?t.push(new o.V(d,l,`layer "${l.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):x==="raster-particle"&&L!=="raster-array"&&t.push(new o.V(d,l.source,`layer "${l.id}" requires a 'raster-array' source.`)):t.push(new o.V(d,l.source,"raster-array source can only be used with layer type 'raster'.")):t.push(new o.V(d,l,`layer "${l.id}" must specify a "source-layer"`)):t.push(new o.V(d,l.source,`source "${l.source}" not found`))}else t.push(new o.V(`${d}.source`,l.source,'"source" must be a string'));else t.push(new o.V(d,l,'missing required property "source"'));return t=t.concat(ln({key:d,value:l,valueSpec:y.layer,style:h.style,styleSpec:h.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ir({key:`${d}.type`,value:l.type,valueSpec:y.layer.type,style:h.style,styleSpec:h.styleSpec,object:l,objectKey:"type"}),filter:E=>Mo(Object.assign({layerType:x},E)),layout:E=>ln({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":L=>ts(Object.assign({layerType:x},L))}}),paint:E=>ln({layer:l,key:E.key,value:E.value,valueSpec:{},style:E.style,styleSpec:E.styleSpec,objectElementValidators:{"*":L=>Ro(Object.assign({layerType:x,layer:l},L))}}),appearances(E){const L=Po({key:E.key,value:E.value,valueSpec:E.valueSpec,style:E.style,styleSpec:E.styleSpec,arrayElementValidator:O=>function(B){const{key:G,layer:V,layerType:W}=B,Y=o.J(B.value),se=o.J(Y.name),ne=o.J(Y.condition),te=ln({key:G,value:Y,valueSpec:B.styleSpec.appearance,style:B.style,styleSpec:B.styleSpec,objectElementValidators:{condition:we=>function(_e){const be=[];return be.push(...$n({key:_e.key,value:_e.object.condition,valueSpec:o.a6.appearance.condition,expressionContext:"appearance"})),be}(Object.assign({layer:V,layerType:W},we)),properties:we=>function(_e){const be=[],{styleSpec:de,layer:le,layerType:Te}=_e,Me=de[`paint_${Te}`],Oe=de[`layout_${Te}`],Ve=_e.object[_e.objectKey];for(const je in Ve){const Ye=je in Me?"paint":je in Oe?"layout":void 0;if(!Ye){be.push(new o.V(_e.key,je,`unknown property "${je}" for layer type "${Te}"`));continue}const nt=Object.assign({},_e,{key:`${_e.key}.${je}`,object:Ve,objectKey:je,layer:le,layerType:Te,value:Ve[je],valueSpec:Ye==="paint"?Me[je]:Oe[je]});be.push(...Mn(nt,Ye))}return be}(Object.assign({layer:V,layerType:W},we))}});return se!=="hidden"&&ne===void 0&&te.push(new o.V(B.key,"name",'Appearance with name different than "hidden" must have a condition')),te}(Object.assign({layerType:x,layer:l},O))}),P=Array.isArray(E.value)?E.value:[],z=new Set;return P.forEach((O,B)=>{const G=o.J(O.name);if(G)if(z.has(G)){const V=o.J(l.id);L.push(new o.V(E.key,G,`Duplicated appearance name "${G}" for layer "${V}"`))}else z.add(G)}),L}}})),t}function go({key:h,value:t}){return o.a0(t)?[]:[new o.V(h,t,`string expected, ${o.K(t)} found`)]}const Yr={promoteId:function h({key:t,value:l}){if(o.a0(l))return go({key:t,value:l});if(Array.isArray(l)){const g=[],y=o.S(l),x=o.U(y);return x.result==="error"&&x.value.forEach(T=>{g.push(new o.V(`${t}${T.key}`,null,`${T.message}`))}),o.X(x.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||g.push(new o.V(`${t}`,null,"promoteId expression should be only feature dependent")),g}if(!o.H(l))return[new o.V(t,l,`string, expression or object expected, "${o.K(l)}" found`)];const d=[];for(const g in l)d.push(...h({key:`${t}.${g}`,value:l[g]}));return d}};function _o(h){const t=h.value,l=h.key,d=h.styleSpec,g=h.style;if(!o.H(t))return[new o.V(l,t,`object expected, ${o.K(t)} found`)];if(!("type"in t))return[new o.V(l,t,'"type" is required')];const y=o.J(t.type);let x=[];switch(["vector","raster","raster-dem","raster-array"].includes(y)&&("url"in t||"tiles"in t||x.push(new o.a3(l,t,'Either "url" or "tiles" is required.'))),y){case"vector":case"raster":case"raster-dem":case"raster-array":return x=x.concat(ln({key:l,value:t,valueSpec:d[`source_${y.replace("-","_")}`],style:h.style,styleSpec:d,objectElementValidators:Yr})),x;case"geojson":if(x=ln({key:l,value:t,valueSpec:d.source_geojson,style:g,styleSpec:d,objectElementValidators:Yr}),"cluster"in t&&"clusterProperties"in t){if(!o.H(t.clusterProperties))return[new o.V(`${l}.clusterProperties`,t,`object expected, ${o.K(t)} found`)];for(const T in t.clusterProperties){const E=t.clusterProperties[T];if(!Array.isArray(E))return[new o.V(`${l}.clusterProperties.${T}`,E,"array expected")];const[L,P]=E,z=typeof L=="string"?[L,["accumulated"],["get",T]]:L;x.push(...$n({key:`${l}.${T}.map`,value:P,expressionContext:"cluster-map"})),x.push(...$n({key:`${l}.${T}.reduce`,value:z,expressionContext:"cluster-reduce"}))}}return x;case"video":return ln({key:l,value:t,valueSpec:d.source_video,style:g,styleSpec:d});case"image":return ln({key:l,value:t,valueSpec:d.source_image,style:g,styleSpec:d});case"canvas":return[new o.V(l,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ps({key:`${l}.type`,value:t.type,valueSpec:{values:Ms(d)}})}}function Ms(h){return h.source.reduce((t,l)=>{const d=h[l];return d.type.type==="enum"&&(t=t.concat(Object.keys(d.type.values||{}))),t},[])}function Do(h){const t=h.value,l=h.styleSpec,d=l.light,g=h.style;if(t===void 0)return[];if(!o.H(t))return[new o.V("light",t,`object expected, ${o.K(t)} found`)];let y=[];for(const x in t){const T=x.match(/^(.*)-transition$/),E=x.match(/^(.*)-use-theme$/);y=y.concat(E&&d[E[1]]?ir({key:x,value:t[x],valueSpec:{type:"string"},style:g,styleSpec:l}):T&&d[T[1]]&&d[T[1]].transition?ir({key:x,value:t[x],valueSpec:l.transition,style:g,styleSpec:l}):d[x]?ir({key:x,value:t[x],valueSpec:d[x],style:g,styleSpec:l}):[new o.V(x,t[x],`unknown property "${x}"`)])}return y}function Rs(h){const t=h.value;if(!t)return[];const l=h.key;if(!o.H(t))return[new o.V(l,t,`object expected, ${o.K(t)} found`)];let d=[];const g=h.styleSpec,y=g["light-3d"],x=h.style,T=h.style.lights;for(const P of["type","id"])if(!(P in t))return d=d.concat([new o.V(l,t,`missing property "${P}"`)]),d;if(!o.a0(t.type))return d=d.concat([new o.V(`${l}.type`,t.type,"string expected")]),d;if(T)for(let P=0;P<h.arrayIndex;P++){const z=o.J(t.type),O=T[P];o.J(O.type)===z&&d.push(new o.V(l,t.id,`duplicate light type "${t.type}", previously defined at line ${O.id.__line__}`))}const E=`properties_light_${t.type}`;if(!(E in g))return d=d.concat([new o.V(`${l}.type`,t,`Invalid light type ${t.type}`)]),d;const L=g[E];for(const P in t)if(P==="properties"){const z=t[P];if(!o.H(z))return d=d.concat([new o.V("properties",z,`object expected, ${o.K(z)} found`)]),d;for(const O in z){const B=O.match(/^(.*)-transition$/),G=O.match(/^(.*)-use-theme$/);d=d.concat(G&&L[G[1]]?ir({key:P,value:z[O],valueSpec:{type:"string"},style:x,styleSpec:g}):B&&L[B[1]]&&L[B[1]].transition?ir({key:P,value:t[P],valueSpec:g.transition,style:x,styleSpec:g}):L[O]?ir({key:O,value:z[O],valueSpec:L[O],style:x,styleSpec:g}):[new o.a3(h.key,z[O],`unknown property "${O}"`)])}}else d=d.concat(y[P]?ir({key:P,value:t[P],valueSpec:y[P],style:x,styleSpec:g}):[new o.a3(P,t[P],`unknown property "${P}"`)]);return d}function Oo(h){const t=h.value,l=h.key,d=h.style,g=h.styleSpec,y=g.terrain;if(t==null)return[];if(!o.H(t))return[new o.V("terrain",t,`object expected, ${o.K(t)} found`)];let x=[];for(const T in t){const E=T.match(/^(.*)-transition$/),L=T.match(/^(.*)-use-theme$/);x=x.concat(L&&y[L[1]]?ir({key:T,value:t[T],valueSpec:{type:"string"},style:d,styleSpec:g}):E&&y[E[1]]&&y[E[1]].transition?ir({key:T,value:t[T],valueSpec:g.transition,style:d,styleSpec:g}):y[T]?ir({key:T,value:t[T],valueSpec:y[T],style:d,styleSpec:g}):[new o.a3(T,t[T],`unknown property "${T}"`)])}if(t.source)if(o.a0(t.source)){const T=d.sources&&d.sources[t.source],E=T&&o.J(T.type);T?E!=="raster-dem"&&x.push(new o.V(`${l}.source`,t.source,`terrain cannot be used with a source of type ${E}, it only be used with a "raster-dem" source type`)):x.push(new o.V(`${l}.source`,t.source,`source "${t.source}" not found`))}else x.push(new o.V(`${l}.source`,t.source,"source must be a string"));else x.push(new o.V(l,t,'terrain is missing required property "source"'));return x}function zo(h){const t=h.value,l=h.style,d=h.styleSpec,g=d.fog;if(t===void 0)return[];if(!o.H(t))return[new o.V("fog",t,`object expected, ${o.K(t)} found`)];let y=[];for(const x in t){const T=x.match(/^(.*)-transition$/),E=x.match(/^(.*)-use-theme$/);y=y.concat(E&&g[E[1]]?ir({key:x,value:t[x],valueSpec:{type:"string"},style:l,styleSpec:d}):T&&g[T[1]]&&g[T[1]].transition?ir({key:x,value:t[x],valueSpec:d.transition,style:l,styleSpec:d}):g[x]?ir({key:x,value:t[x],valueSpec:g[x],style:l,styleSpec:d}):[new o.a3(x,t[x],`unknown property "${x}"`)])}return y}const Ea={"*":()=>[],array:Po,boolean:function(h){const t=h.value,l=h.key;return o.$(t)?[]:[new o.V(l,t,`boolean expected, ${o.K(t)} found`)]},number:ea,color:function({key:h,value:t}){return o.a0(t)?o.a1.parseCSSColor(t)===null?[new o.V(h,t,`color expected, "${t}" found`)]:[]:[new o.V(h,t,`color expected, ${o.K(t)} found`)]},enum:Ps,filter:Mo,function:ta,layer:ia,object:ln,source:_o,model:o.a7,light:Do,"light-3d":Rs,terrain:Oo,fog:zo,string:go,formatted:function(h){return go(h).length===0?[]:$n(h)},resolvedImage:function(h){return go(h).length===0?[]:$n(h)},projection:function(h){const t=h.value,l=h.styleSpec,d=l.projection,g=h.style;if(o.H(t)){let y=[];for(const x in t)y=y.concat(ir({key:x,value:t[x],valueSpec:d[x],style:g,styleSpec:l}));return y}return o.a0(t)?[]:[new o.V("projection",t,`object or string expected, ${o.K(t)} found`)]},import:function(h){const t=h.key,{value:l,styleSpec:d}=h;if(!o.H(l))return[new o.V(t,l,"import must be an object")];const{data:g,...y}=l;Object.defineProperty(y,"__line__",{value:l.__line__,enumerable:!1});let x=ln(Object.assign({},h,{value:y,valueSpec:d.import}));return o.J(y.id)===""&&x.push(new o.V(`${h.key}.id`,y,"import id can't be an empty string")),g&&(x=x.concat(Aa(g,d,{key:`${h.key}.data`}))),x},iconset:function(h){const t=h.value,l=h.key,d=h.styleSpec,g=h.style;if(!o.H(t))return[new o.V(l,t,"object expected")];if(!t.type)return[new o.V(l,t,'"type" is required')];const y=o.J(t.type);let x=[];if(x=x.concat(ln({key:l,value:t,valueSpec:d[`iconset_${y}`],style:g,styleSpec:d})),function(T,E){return!(T!=="source"||!E.source)}(y,t)){const T=g.sources&&g.sources[t.source],E=T&&o.J(T.type);T?E!=="raster-array"&&x.push(new o.V(l,t.source,`iconset cannot be used with a source of type ${String(E)}, it only be used with a "raster-array" source type`)):x.push(new o.V(l,t.source,`source "${t.source}" not found`))}return x}};function ir(h,t=!1){const l=h.value,d=h.valueSpec,g=h.styleSpec;if(d.expression){if(o.a4(o.J(l)))return ta(h);if(o.Q(o.S(l)))return $n(h)}if(d.type&&Ea[d.type]){const y=Ea[d.type](h);return t===!0&&y.length>0&&Array.isArray(h.value)?$n(h):y}return ln(Object.assign({},h,{valueSpec:d.type?g[d.type]:d}))}function ln(h){const t=h.key,l=h.value,d=h.valueSpec||{},g=h.objectElementValidators||{},y=h.style,x=h.styleSpec;if(!o.H(l))return[new o.V(t,l,`object expected, ${o.K(l)} found`)];let T=[];for(const E in l){const L=E.split(".")[0];let P;g[L]?P=g[L]:d[L]?P=ir:g["*"]?P=g["*"]:d["*"]&&(P=ir),P?T=T.concat(P({key:(t&&`${t}.`)+E,value:l[E],valueSpec:d[L]||d["*"],style:y,styleSpec:x,object:l,objectKey:E},l)):T.push(new o.a3(t,l[E],`unknown property "${E}"`))}for(const E in d){if(g[E])continue;const L=d[E];L.required&&L.default===void 0&&l[E]===void 0&&T.push(new o.V(t,l,`missing required property "${E}"`))}return T}function Ia({key:h,value:t}){const l=go({key:h,value:t});if(l.length)return l;const d=t;return d.indexOf("{fontstack}")===-1&&l.push(new o.V(h,t,'"glyphs" url must include a "{fontstack}" token')),d.indexOf("{range}")===-1&&l.push(new o.V(h,t,'"glyphs" url must include a "{range}" token')),l}function Aa(h,t=o.a6,l={}){return ln({key:l.key||"",value:h,valueSpec:Object.assign(t.$root,{"*":{type:"*"}}),styleSpec:t,style:h,objectElementValidators:{glyphs:Ia}})}function Bn(h,t=o.a6){return pe(Aa(h,t))}const gc=h=>pe(_o(h)),Qa=h=>pe(Do(h)),at=h=>pe(Rs(h)),Li=h=>pe(Oo(h)),bp=h=>pe(zo(h)),Mu=h=>pe(function(t){const l=t.value,d=t.style,g=t.styleSpec,y=g.snow;if(l===void 0)return[];if(!o.H(l))return[new o.V("snow",l,`object expected, ${o.K(l)} found`)];let x=[];for(const T in l){const E=T.match(/^(.*)-transition$/);x=x.concat(E&&y[E[1]]&&y[E[1]].transition?ir({key:T,value:l[T],valueSpec:g.transition,style:d,styleSpec:g}):y[T]?ir({key:T,value:l[T],valueSpec:y[T],style:d,styleSpec:g}):[new o.a3(T,l[T],`unknown property "${T}"`)])}return x}(h)),Pi=h=>pe(function(t){const l=t.value,d=t.style,g=t.styleSpec,y=g.rain;if(l===void 0)return[];if(!o.H(l))return[new o.V("rain",l,`object expected, ${o.K(l)} found`)];let x=[];for(const T in l){const E=T.match(/^(.*)-transition$/);x=x.concat(E&&y[E[1]]&&y[E[1]].transition?ir({key:T,value:l[T],valueSpec:g.transition,style:d,styleSpec:g}):y[T]?ir({key:T,value:l[T],valueSpec:y[T],style:d,styleSpec:g}):[new o.a3(T,l[T],`unknown property "${T}"`)])}return x}(h)),De=h=>pe(ia(h)),q=h=>pe(Mo(h)),ee=h=>pe(Ro(h)),ue=h=>pe(ts(h)),Ce=h=>pe(o.a7(h));function pe(h){return h.slice().sort((t,l)=>t.line&&l.line?t.line-l.line:0)}function Pe(h,t){let l=!1;if(t&&t.length)for(const d of t)d instanceof o.a3?o.w(d.message):(h.fire(new o.y(new Error(d.message))),l=!0);return l}const Ue=o.a6.light;let Re;class He extends o.E{constructor(t,l="flat"){super(),this._transitionable=new o.a8(Re||(Re=new o.a9({anchor:new o.aa(Ue.anchor),position:new o.ab(Ue.position),color:new o.aa(Ue.color),intensity:new o.aa(Ue.intensity)}))),this.setLight(t,l),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(t,l,d={}){this._validate(Qa,t,d)||(this._transitionable.setTransitionOrValue(t),this.id=l)}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,d){return(!d||d.validate!==!1)&&Pe(this,t.call(Bn,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}const ut=o.a6.terrain;let st=class extends o.E{constructor(h,t,l,d,g){super(),this.scope=l,this._transitionable=new o.a8(new o.a9({source:new o.aa(ut.source),exaggeration:new o.aa(ut.exaggeration)}),l,d),this._transitionable.setTransitionOrValue(h,d),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=t,this.worldview=g}get(){return this._transitionable.serialize()}set(h,t){this._transitionable.setTransitionOrValue(h,t)}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}getExaggeration(h){return this._transitioning.possiblyEvaluate(new o.ac(h,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const h=this._transitionable._values.exaggeration;if(!h)return null;const t=h.value.expression;if(!t)return null;let l=-1,d=-1,g=1;for(const y of t.zoomStops)g=t.evaluate(new o.ac(y,{worldview:this.worldview})),g>.01?(l=y,d=-1):d=y;return g<.01&&l>0&&d>l?[l,d]:null}isZoomDependent(){const h=this._transitionable._values.exaggeration;return h!=null&&h.value!=null&&h.value.expression!=null&&h.value.expression instanceof o.ad}};const At=.05;function Nt(h,t,l,d){const g=o.ah(45,65,l),[y,x]=Wt(h,d);let T=1-Math.min(1,Math.exp((t-y)/(x-y)*-6));return T*=T*T,T=Math.min(1,1.00747*T),T*g*h.alpha}function Wt(h,t){const l=.5/Math.tan(.5*t);return[h.range[0]+l,h.range[1]+l]}function oi(h,t,l,d,g){const y=o.af([],[t,l,d],g.mercatorFogMatrix);return Nt(h,o.ag(y),g.pitch,g._fov)}function pi(h,t,l,d,g,y,x){const T=[[l,d,0],[g,d,0],[g,y,0],[l,y,0]];let E=Number.MAX_VALUE,L=-Number.MAX_VALUE;for(const P of T){const z=o.af([],P,t),O=o.ag(z);E=Math.min(E,O),L=Math.max(L,O)}return[Nt(h,E,x.pitch,x._fov),Nt(h,L,x.pitch,x._fov)]}const ti=o.a6.fog;class Kt extends o.E{constructor(t,l,d,g){super();const y=new o.a9({range:new o.aa(ti.range),color:new o.aa(ti.color),"color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.aa(ti["high-color"]),"high-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.aa(ti["space-color"]),"space-color-use-theme":new o.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.aa(ti["horizon-blend"]),"star-intensity":new o.aa(ti["star-intensity"]),"vertical-range":new o.aa(ti["vertical-range"])});this._transitionable=new o.a8(y,d,new Map(g)),this.set(t,g),this._transitioning=this._transitionable.untransitioned(),this._transform=l,this.properties=new o.ai(y),this.scope=d}get state(){const t=this._transform,l=t.projection.name==="globe",d=o.aj(t.zoom),g=this.properties.get("range"),y=[.5,3];return{range:l?[o.ak(y[0],g[0],d),o.ak(y[1],g[1],d)]:g,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(t,l,d={}){if(this._validate(bp,t,d))return;const g=Object.assign({},t);for(const y of Object.keys(ti))g[y]===void 0&&(g[y]=ti[y].default);this._options=g,this._transitionable.setTransitionOrValue(this._options,l)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.ah(45,65,t))*l.a}getOpacityAtLatLng(t,l){return this._transform.projection.supportsFog?function(d,g,y){const x=o.ae.fromLngLat(g),T=y.elevation?y.elevation.getAtPointOrZero(x):0;return oi(d,x.x,x.y,T,y)}(this.state,t,l):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const l=this._transform.calculateFogTileMatrix(t.toUnwrapped());return pi(this.state,l,0,0,o.al,o.al,this._transform)}getOpacityForBounds(t,l,d,g,y){return this._transform.projection.supportsFog?pi(this.state,t,l,d,g,y,this._transform):[1,1]}getFovAdjustedRange(t){return this._transform.projection.supportsFog?Wt(this.state,t):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const l=[4,5,6,7];for(const d of l){const g=t.points[d];let y;if(g[2]>=0)y=g;else{const x=t.points[d-4];y=o.am(x,g,x[2]/(x[2]-g[2]))}if(oi(this.state,y[0],y[1],0,this._transform)>=At)return!0}return!1}updateConfig(t){this._transitionable.setTransitionOrValue(this._options,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(t,l,d){return(!d||d.validate!==!1)&&Pe(this,t.call(Bn,Object.assign({value:l,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}}let lr,Wr,Or,zr=class extends o.E{constructor(h,t,l,d){super();const g=lr||(lr=new o.a9({density:new o.aa(o.a6.snow.density),intensity:new o.aa(o.a6.snow.intensity),color:new o.aa(o.a6.snow.color),opacity:new o.aa(o.a6.snow.opacity),vignette:new o.aa(o.a6.snow.vignette),"vignette-color":new o.aa(o.a6.snow["vignette-color"]),"center-thinning":new o.aa(o.a6.snow["center-thinning"]),direction:new o.aa(o.a6.snow.direction),"flake-size":new o.aa(o.a6.snow["flake-size"])}));this._transitionable=new o.a8(g,l,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(g),this.scope=l}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),l=this.properties.get("direction"),d=o.an(l[0]),g=-Math.max(o.an(l[1]),.01),y=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],x=this.properties.get("vignette"),T=this.properties.get("vignette-color");return T.a=x,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:T}}get(){return this._transitionable.serialize()}set(h,t,l={}){if(this._validate(Mu,h,l))return;const d=Object.assign({},h),g=o.a6.snow;for(const y of Object.keys(g))d[y]===void 0&&(d[y]=g[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,l){return(!l||l.validate!==!1)&&Pe(this,h.call(Bn,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}},vr=class extends o.E{constructor(h,t,l,d){super();const g=Wr||(Wr=new o.a9({density:new o.aa(o.a6.rain.density),intensity:new o.aa(o.a6.rain.intensity),color:new o.aa(o.a6.rain.color),opacity:new o.aa(o.a6.rain.opacity),vignette:new o.aa(o.a6.rain.vignette),"vignette-color":new o.aa(o.a6.rain["vignette-color"]),"center-thinning":new o.aa(o.a6.rain["center-thinning"]),direction:new o.aa(o.a6.rain.direction),"droplet-size":new o.aa(o.a6.rain["droplet-size"]),"distortion-strength":new o.aa(o.a6.rain["distortion-strength"])}));this._transitionable=new o.a8(g,l,new Map(d)),this.set(h,d),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ai(g),this.scope=l}get state(){const h=this.properties.get("opacity"),t=this.properties.get("color"),l=this.properties.get("direction"),d=o.an(l[0]),g=-Math.max(o.an(l[1]),.01),y=[Math.cos(d)*Math.cos(g),Math.sin(d)*Math.cos(g),Math.sin(g)],x=this.properties.get("vignette-color");return x.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.ao(t.r,t.g,t.b,t.a*h),direction:y,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:x}}get(){return this._transitionable.serialize()}set(h,t,l={}){if(this._validate(Pi,h,l))return;const d=Object.assign({},h),g=o.a6.rain;for(const y of Object.keys(g))d[y]===void 0&&(d[y]=g[y].default);this._options=d,this._transitionable.setTransitionOrValue(this._options,t)}updateConfig(h){this._transitionable.setTransitionOrValue(this._options,new Map(h))}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}_validate(h,t,l){return(!l||l.validate!==!1)&&Pe(this,h.call(Bn,Object.assign({value:t,style:{glyphs:!0,sprite:!0},styleSpec:o.a6})))}};class Ci extends o.E{constructor(t,l,d,g){super(),this.scope=d,this._options=t,this.properties=new o.ai(l),this._transitionable=new o.a8(l,d,new Map(g)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(t){this._transitionable.setTransitionOrValue(this._options.properties,new Map(t))}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(t,l){this._options=t,this._transitionable.setTransitionOrValue(t.properties,l)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}const Sr=()=>Or||(Or=new o.a9({color:new o.aa(o.a6.properties_light_ambient.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_ambient.intensity)}));let Qi;const er=()=>Qi||(Qi=new o.a9({direction:new o.ap(o.a6.properties_light_directional.direction),color:new o.aa(o.a6.properties_light_directional.color),"color-use-theme":new o.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.aa(o.a6.properties_light_directional.intensity),"cast-shadows":new o.aa(o.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new o.aa(o.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.aa(o.a6.properties_light_directional["shadow-intensity"]),"shadow-draw-before-layer":new o.aa(o.a6.properties_light_directional["shadow-draw-before-layer"])}));class Mr{constructor(t,l,d){this.screenBounds=t,this.cameraPoint=d.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=l,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,d)}static createFromScreenPoints(t,l){let d,g;if(t instanceof o.P||typeof t[0]=="number"){const y=o.P.convert(t);d=[y],g=l.isPointAboveHorizon(y)}else{const y=o.P.convert(t[0]),x=o.P.convert(t[1]),T=y.add(x)._div(2);d=[y,x],g=o.aq(y,x).every(E=>l.isPointAboveHorizon(E))&&l.isPointAboveHorizon(T)}return new Mr(d,g,l)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(t){return o.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.aq(l,d,0,!1);return this.cameraPoint.y>d.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<d.x?g.splice(3,0,this.cameraPoint):this.cameraPoint.x>=d.x?g[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(g[3]=this.cameraPoint)),o.ar(g,t)}bufferedCameraGeometryGlobe(t){const l=this.screenBounds[0],d=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],g=o.aq(l,d,t),y=this.cameraPoint.clone();switch(3*((y.y>l.y)+(y.y>d.y))+((y.x>l.x)+(y.x>d.x))){case 0:g[0]=y,g[4]=y.clone();break;case 1:g.splice(1,0,y);break;case 2:g[1]=y;break;case 3:g.splice(4,0,y);break;case 5:g.splice(2,0,y);break;case 6:g[3]=y;break;case 7:g.splice(3,0,y);break;case 8:g[2]=y}return g}containsTile(t,l,d,g=0){const y=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/l._pixelsPerMercatorPixel+1,x=d?this._bufferedCameraMercator(y,l):this._bufferedScreenMercator(y,l);let T=t.tileID.wrap+(x.unwrapped?g:0);const E=x.polygon.map(W=>o.as(t.tileTransform,W,T));if(!o.at(E,0,0,o.al,o.al))return;T=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?g:0);const L=this.screenGeometryMercator.polygon.map(W=>o.au(t.tileTransform,W,T)),P=L.map(W=>new o.P(W[0],W[1])),z=l.getFreeCameraOptions().position||new o.ae(0,0,0),O=o.au(t.tileTransform,z,T),B=L.map(W=>{const Y=o.av(W,W,O);return o.aw(Y,Y),new o.ax(O,Y)}),G=o.ay(t,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:P,tilespaceRays:B,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(V=o.az(E),V.min.x=o.aA(V.min.x,0,o.al),V.min.y=o.aA(V.min.y,0,o.al),V.max.x=o.aA(V.max.x,0,o.al),V.max.y=o.aA(V.max.y,0,o.al),V),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:G};var V}_bufferedScreenMercator(t,l){const d=Jr(t);if(this._screenRaycastCache[d])return this._screenRaycastCache[d];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(t),l):{polygon:this.bufferedScreenGeometry(t).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._screenRaycastCache[d]=g,g}}_bufferedCameraMercator(t,l){const d=Jr(t);if(this._cameraRaycastCache[d])return this._cameraRaycastCache[d];{let g;return g=l.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(t),l):{polygon:this.bufferedCameraGeometry(t).map(y=>l.pointCoordinate3D(y)),unwrapped:!0},this._cameraRaycastCache[d]=g,g}}_projectAndResample(t,l){const d=function(y,x){const T=o.aB([],x.pixelMatrix,x.globeMatrix),E=[0,-o.aD,0,1],L=[0,o.aD,0,1],P=[0,0,0,1];o.aC(E,E,T),o.aC(L,L,T),o.aC(P,P,T);const z=new o.P(E[0]/E[3],E[1]/E[3]),O=new o.P(L[0]/L[3],L[1]/L[3]),B=o.aE(y,z)&&E[3]<P[3],G=o.aE(y,O)&&L[3]<P[3];if(!B&&!G)return null;const V=function(be,de,le){for(let Te=1;Te<be.length;Te++){const Me=wn(de.pointCoordinate3D(be[Te-1]).x),Oe=wn(de.pointCoordinate3D(be[Te]).x);if(le<0){if(Me<Oe)return{idx:Te,t:-Me/(Oe-1-Me)}}else if(Oe<Me)return{idx:Te,t:(1-Me)/(Oe+1-Me)}}return null}(y,x,B?-1:1);if(!V)return null;const{idx:W,t:Y}=V;let se=W>1?Rn(y.slice(0,W),x):[],ne=W<y.length?Rn(y.slice(W),x):[];se=se.map(be=>new o.P(wn(be.x),be.y)),ne=ne.map(be=>new o.P(wn(be.x),be.y));const te=[...se];te.length===0&&te.push(ne[ne.length-1]);const we=o.ak(te[te.length-1].y,(ne.length===0?se[0]:ne[0]).y,Y);let _e;return _e=B?[new o.P(0,we),new o.P(0,0),new o.P(1,0),new o.P(1,we)]:[new o.P(1,we),new o.P(1,1),new o.P(0,1),new o.P(0,we)],te.push(..._e),ne.length===0?te.push(se[0]):te.push(...ne),{polygon:te.map(be=>new o.ae(be.x,be.y)),unwrapped:!1}}(t,l);if(d)return d;const g=function(y,x){let T=!1,E=-1/0,L=0;for(let z=0;z<y.length-1;z++)y[z].x>E&&(E=y[z].x,L=z);for(let z=0;z<y.length-1;z++){const O=(L+z)%(y.length-1),B=y[O],G=y[O+1];Math.abs(B.x-G.x)>.5&&(B.x<G.x?(B.x+=1,O===0&&(y[y.length-1].x+=1)):(G.x+=1,O+1===y.length-1&&(y[0].x+=1)),T=!0)}const P=o.aF(x.center.lng);return T&&P<Math.abs(P-1)&&y.forEach(z=>{z.x-=1}),{polygon:y,unwrapped:T}}(Rn(t,l).map(y=>new o.P(wn(y.x),y.y)),l);return{polygon:g.polygon.map(y=>new o.ae(y.x,y.y)),unwrapped:g.unwrapped}}}function Rn(h,t){return o.aG(h,l=>{const d=t.pointCoordinate3D(l);l.x=d.x,l.y=d.y},1/256)}function wn(h){return h<0?1+h%1:h%1}function Jr(h){return 100*h|0}function el(h,t,l,d,g){const y=function(T,E){if(T)return g(T);if(E){if(h.url&&E.tiles&&h.tiles&&delete h.tiles,E.variants){if(!Array.isArray(E.variants))return g(new Error("variants must be an array"));for(const P of E.variants){if(P==null||typeof P!="object"||P.constructor!==Object)return g(new Error("variant must be an object"));if(!Array.isArray(P.capabilities))return g(new Error("capabilities must be an array"));if(P.capabilities.length===1&&P.capabilities[0]==="meshopt"){E=Object.assign(E,P);break}}}const L=o.aH(Object.assign({},E,h),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);L.tiles=t.canonicalizeTileset(L,h.url),g(null,L)}},x=function(T,E,L){if(!T)return null;if(!E&&!L)return T;L=L||T.worldview_default;const P=Object.values(T.language||{});if(P.length===0)return null;const z=Object.values(T.worldview||{});if(z.length===0)return null;const O=P.every(G=>G===E),B=z.every(G=>G===L);return O&&B?T:E in(T.language_options||{})||L in(T.worldview_options||{})?null:T.language_options&&T.worldview_options?T:null}(h.data,l,d);return x?o.o.frame(()=>y(null,x)):h.url?o.m(t.transformRequest(t.normalizeSourceURL(h.url,null,l,d),o.R.Source),y):o.o.frame(()=>{const{data:T,...E}=h;y(null,E)})}function Gn(h,t){const l=Math.pow(2,t.z),d=Math.floor(o.aF(h.getWest())*l),g=Math.floor(o.aJ(h.getNorth())*l),y=Math.ceil(o.aF(h.getEast())*l),x=Math.ceil(o.aJ(h.getSouth())*l);return t.x>=d&&t.x<y&&t.y>=g&&t.y<x}class Ds{constructor(t,l,d){this.bounds=t?o.aI.convert(this.validateBounds(t)):null,this.minzoom=l||0,this.maxzoom=d||24}validateBounds(t){return Array.isArray(t)&&t.length===4?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const l of t)this.extraBounds.push(o.aI.convert(this.validateBounds(l)))}}contains(t){if(t.z>this.maxzoom||t.z<this.minzoom||this.bounds&&!Gn(this.bounds,t))return!1;if(!this.extraBounds)return!0;for(const l of this.extraBounds)if(Gn(l,t))return!0;return!1}static fromTileJSON(t){if(!t.bounds&&!t.extra_bounds)return null;const l=new Ds(t.bounds,t.minzoom,t.maxzoom);return l.addExtraBounds(t.extra_bounds),l}}class yo extends o.E{constructor(t,l,d,g){if(super(),this.id=t,this.dispatcher=d,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,o.aH(l,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},l),this._collectResourceTiming=!!l.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new o.aK}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,d=this.map.getWorldview();this._tileJSONRequest=el(this._options,this.map._requestManager,l,d,(g,y)=>{if(this._tileJSONRequest=null,this._loaded=!0,g)l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),d&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${d}`),this.fire(new o.y(g));else if(y){if(Object.assign(this,y),this.hasWorldviews=!!y.worldview_options,y.worldview_default&&(this.worldviewDefault=y.worldview_default),y.vector_layers){this.vectorLayers=y.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const x of y.vector_layers)this.vectorLayerIds.push(x.id),y.worldview&&y.worldview[x.source]&&this.localizableLayerIds.add(x.id)}this.tileBounds=Ds.fromTileJSON(y),Ot(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(g)})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,l){const d=t.tileID.canonical.url(this.tiles,this.scheme),g=this.map._requestManager.normalizeTileURL(d),y=this.map._requestManager.transformRequest(g,o.R.Tile),x=this.map.style?this.map.style.getLut(this.scope):null,T=x?{image:x.image.clone()}:null,E={request:y,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:T,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.getIndoorTileOptions(this.id,this.scope)};if(this.hasWorldviews&&o.h(d)&&(E.localizableLayerIds=this.localizableLayerIds),E.request.collectResourceTiming=this._collectResourceTiming,t.actor&&t.state!=="expired")t.state==="loading"?t.reloadCallback=l:t.request=t.actor.send("reloadTile",E,L.bind(this));else if(t.actor=this._tileWorkers[g]=this._tileWorkers[g]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",E,L.bind(this),void 0,!0);else{const P=o.aL.call({deduped:this._deduped},E,(z,O)=>{if(z||!O)L.call(this,z);else{const B=o.aM(O.responseHeaders);E.data={rawData:O.rawData.slice(0),expires:B.expires,cacheControl:B.cacheControl},t.actor&&t.actor.send("loadTile",E,L.bind(this),void 0,!0)}},!0);t.request={cancel:P}}function L(P,z){return delete t.request,t.aborted?l(null):P&&P instanceof o.aN&&P.status!==404?l(P):(z&&z.resourceTiming&&(t.resourceTiming=z.resourceTiming),this.map._refreshExpiredTiles&&z&&t.setExpiryData(z),t.loadVectorData(z,this.map.painter),o.aO(this.dispatcher),l(null,z),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,l){t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope}),t.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Bo extends o.E{constructor(t,l,d,g){super(),this.id=t,this.dispatcher=d,this.setEventedParent(g),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},l),Object.assign(this,o.aH(l,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const l=this.map.getWorldview();this._tileJSONRequest=el(this._options,this.map._requestManager,null,l,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?this.fire(new o.y(d)):g&&(Object.assign(this,g),g.raster_layers&&(this.rasterLayers=g.raster_layers,this.rasterLayerIds=this.rasterLayers.map(y=>y.id)),this.tileBounds=Ds.fromTileJSON(g),Ot(g.tiles),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(d)})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}reload(){this.cancelTileJSONRequest();const t=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(t){return this._options.tiles=t,this.reload(),this}setUrl(t){return this.url=t,this._options.url=t,this.reload(),this}onRemove(t){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(t,l){const d=o.o.devicePixelRatio>=2,g=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),d,this.tileSize);t.request=o.n(this.map._requestManager.transformRequest(g,o.R.Tile),(y,x,T)=>{if(delete t.request,t.aborted)return t.state="unloaded",l(null);if(y)return t.state="errored",l(y);if(!x)return l(null);const E=o.aM(T);this.map._refreshExpiredTiles&&t.setExpiryData(E),t.setTexture(x,this.map.painter),t.state="loaded",o.aO(this.dispatcher),l(null)})}abortTile(t,l){t.request&&(t.request.cancel(),delete t.request),l&&l()}unloadTile(t,l){t.texture&&t.texture instanceof o.T?(t.destroy(!1),t.texture&&t.texture instanceof o.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),l&&l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Os([h,t],l,d,{scaled:g=!0}={}){const{tileSize:y,buffer:x}=d,{x:T,y:E,z:L}=l;if(!isFinite(T)||!isFinite(E)||!isFinite(L))throw new Error("Invalid MRT header");const P=2**L,z=P*o.aF(h),O=P*o.aJ(t);return function([B,G],V,{scaled:W=!0}={}){if(!V)throw new Error("bandView is undefined");const{data:Y,tileSize:se,buffer:ne,offset:te,scale:we,dimension:_e}=V;if(B<-ne||B>se+ne||G<-ne||G>se+ne)throw new Error(`Point (${B}, ${G}) out of bounds for tileSize=${se}, buffer=${ne}`);const be=(G+ne)*(se+2*ne)+(B+ne);if(new Uint32Array(Y.buffer)[be]===4294967295)return null;let de=[];de=W?[]:new V.data.constructor(_e);for(let le=0;le<_e;le++)de[le]=Math.round(1e12*(Y[_e*be+le]*we+te))/1e12;return de}([Math.min(Math.max(-x,Math.floor((z-T)*y)),y-1+x),Math.min(Math.max(-x,Math.floor((O-E)*y)),y-1+x)],d,{scaled:g})}class is extends Bo{constructor(t,l,d,g){super(t,l,d,g),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},l)}triggerRepaint(t){const l=this.map.painter._terrain,d=this.map.style.getSourceCache(this.id);l&&l.enabled&&d&&l._clearRenderCacheForTile(d.id,t.tileID),this.map.triggerRepaint()}loadTile(t,l){const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,o.R.Tile),y={request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=g,t.actor||(t.actor=this.dispatcher.getActor());const x=(T,E,L)=>{if(delete t.request,t.aborted)return t.state="unloaded",l(null);if(T)return T.name==="AbortError"?void 0:(t.state="errored",l(T));if(this.map._refreshExpiredTiles&&E){const P=o.aM(L);t.setExpiryData(P)}if(this.partial&&t.state!=="expired")t.state="empty";else if(!this.partial){if(!E)return l(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=E}l(null)};t.request=this.partial?t.fetchHeader(void 0,x.bind(this)):t.actor.send("loadTile",y,x.bind(this),void 0,!0)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(t,l){const d=t.texturePerLayer;if(t.flushAllQueues(),d.size){t.destroy(!1);for(const g of d.values())this.map.painter.saveTileTexture(g)}else t.destroy()}prepareTile(t,l,d,g){t._isHeaderLoaded&&(t.state!=="empty"&&(t.state="reloading"),t.fetchBandForRender(l,d,g,(y,x)=>{if(y)return t.state="errored",this.fire(new o.y(y)),void this.triggerRepaint(t);x&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(d,x,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(t){if(!this.rasterLayers)return 0;const l=this.rasterLayers.find(({id:y})=>y===t),d=l&&l.fields,g=d&&d.bands&&d.bands;return g?g[0]:0}getTextureDescriptor(t,l,d){if(!t)return;const g=l.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!g)return;let y=null;l instanceof o.aR?y=l.paint.get("raster-array-band"):l instanceof o.aS&&(y=l.paint.get("raster-particle-array-band"));const x=y||this.getInitialBand(g);if(x==null)return;if(!t.textureDescriptorPerLayer.get(l.id))return void this.prepareTile(t,g,l.id,x);if(t.updateNeeded(l.id,x)&&!d)return;const T=t.textureDescriptorPerLayer.get(l.id);return Object.assign({},T,{texture:t.texturePerLayer.get(l.id)})}getImages(t,l){const d=new Map;for(const g of t)for(const y of l){const[x,T]=y.split("/"),E=g.getLayer(x);if(!E||!E.hasBand(T)||!E.hasDataForBand(T))continue;const{bytes:L,tileSize:P,buffer:z}=E.getBandView(T),O=P+2*z,B={data:new o.q({width:O,height:O},L),pixelRatio:2,sdf:!1,usvg:!1,version:0};d.set(y,B)}return d}queryRasterArrayValueByBandId(t,l,d){const g=l._mrt;return new Promise(y=>{const x={},T=new Set;for(const[E,L]of Object.entries(g.layers)){if(d.layerName&&E!==d.layerName)continue;const P={};x[E]=P;for(const{bands:z}of L.dataIndex)for(const O of z)d.bands&&!d.bands.includes(O)||(T.add(o.B(E,O)),l.fetchBand(E,null,O,B=>{o.o.frame(()=>{P[O]=B?null:Os([t.lng,t.lat],g,L.getBandView(O)),T.delete(o.B(E,O)),T.size===0&&y(x)})},!1))}T.size===0&&y(x)})}_loadTileForQuery(t,l){if(this._loadTileLoaded[t.uid])return void l(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(l);this._loadTilePending[t.uid]=[l];const d=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),g=this.map._requestManager.transformRequest(d,o.R.Tile);t.actor.send("loadTile",{request:g,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(y,x,T)=>{if(y)return this._loadTilePending[t.uid].forEach(E=>E(y,null)),void delete this._loadTilePending[t.uid];if(!x)return this._loadTilePending[t.uid].forEach(E=>E(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&x){const E=o.aM(T);t.setExpiryData(E)}t._mrt=x,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(E=>E(null,x)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(t,l,d){return new Promise((g,y)=>{this._loadTileForQuery(l,(x,T)=>{x?y(x):g(T?this.queryRasterArrayValueByBandId(t,l,d):null)})})}queryRasterArrayValue(t,l){const d=o.aT.convert(t),g=this.findLoadedParent(d);return g&&g._mrt?l.bands||!this.partial?this.queryRasterArrayValueByBandId(d,g,l):this.queryRasterArrayValueByAllBands(d,g,l):Promise.resolve(null)}findLoadedParent(t){const l=o.ae.fromLngLat(t,this.map.transform.tileSize),d=this.maxzoom+1,g=1<<d,y=Math.floor(l.x),x=Math.floor((l.x-y)*g),T=Math.floor(l.y*g),E=this.map.style.getSourceCache(this.id),L=new o.aQ(d,y,d,x,T);return E.findLoadedParent(L,this.minzoom)}}const Ca={vector:yo,raster:Bo,"raster-dem":class extends Bo{constructor(h,t,l,d){super(h,t,l,d),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function d(g,y){g&&(h.state="errored",t(g)),y&&(h.dem=y,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",t(null))}h.request=o.n(this.map._requestManager.transformRequest(l,o.R.Tile),(function(g,y,x){if(delete h.request,h.aborted)h.state="unloaded",t(null);else if(g)h.state="errored",t(g);else if(y){const T=o.aM(x);this.map._refreshExpiredTiles&&h.setExpiryData(T);const E=ImageBitmap&&y instanceof ImageBitmap&&o.r(),L=1-(y.width-o.aP(y.width))/2;L<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const P=E?y:o.o.getImageData(y,L),z={uid:h.uid,tileID:h.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:P,encoding:this.encoding,padding:L};h.actor&&h.state!=="expired"||(h.actor=this.dispatcher.getActor(),h.actor.send("loadTile",z,d.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(h){const t=h.canonical,l=Math.pow(2,t.z),d=(t.x-1+l)%l,g=t.x===0?h.wrap-1:h.wrap,y=(t.x+1+l)%l,x=t.x+1===l?h.wrap+1:h.wrap,T={};return T[new o.aQ(h.overscaledZ,g,t.z,d,t.y).key]={backfilled:!1},T[new o.aQ(h.overscaledZ,x,t.z,y,t.y).key]={backfilled:!1},t.y>0&&(T[new o.aQ(h.overscaledZ,g,t.z,d,t.y-1).key]={backfilled:!1},T[new o.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y-1).key]={backfilled:!1},T[new o.aQ(h.overscaledZ,x,t.z,y,t.y-1).key]={backfilled:!1}),t.y+1<l&&(T[new o.aQ(h.overscaledZ,g,t.z,d,t.y+1).key]={backfilled:!1},T[new o.aQ(h.overscaledZ,h.wrap,t.z,t.x,t.y+1).key]={backfilled:!1},T[new o.aQ(h.overscaledZ,x,t.z,y,t.y+1).key]={backfilled:!1}),T}},"raster-array":is,geojson:class extends o.E{constructor(h,t,l,d){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(d),this._data=t.data,this._options=Object.assign({},t),this._collectResourceTiming=t.collectResourceTiming,t.maxzoom!==void 0&&(this.maxzoom=t.maxzoom),t.minzoom!==void 0&&(this.minzoom=t.minzoom),t.type&&(this.type=t.type),t.attribution&&(this.attribution=t.attribution),this.promoteId=t.promoteId;const g=o.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:t.cluster||!1,geojsonVtOptions:{buffer:(t.buffer!==void 0?t.buffer:128)*g,tolerance:(t.tolerance!==void 0?t.tolerance:.375)*g,extent:o.al,maxZoom:this.maxzoom,lineMetrics:t.lineMetrics||!1,generateId:t.generateId||!1},superclusterOptions:{maxZoom:t.clusterMaxZoom!==void 0?t.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,t.clusterMinPoints||2),extent:o.al,radius:(t.clusterRadius!==void 0?t.clusterRadius:50)*g,log:!1,generateId:t.generateId||!1},clusterProperties:t.clusterProperties,filter:t.filter,dynamic:t.dynamic},t.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}updateData(h){if(!this._options.dynamic)return this.fire(new o.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof h!="string"&&(h.type==="Feature"&&(h={type:"FeatureCollection",features:[h]}),h.type!=="FeatureCollection"))return this.fire(new o.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof h!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const t=new Map;for(const l of this._data.features)t.set(l.id,l);for(const l of h.features)t.set(l.id,l);this._data.features=[...t.values()]}else this._data=h;return this._updateWorkerData(!0),this}getClusterExpansionZoom(h,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterChildren(h,t){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id,scope:this.scope},t),this}getClusterLeaves(h,t,l,d){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:h,limit:t,offset:l},d),this}_updateWorkerData(h=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.z("dataloading",{dataType:"source"})),this._loaded=!1;const t=Object.assign({append:h},this.workerOptions);t.scope=this.scope;const l=this._data;typeof l=="string"?(t.request=this.map._requestManager.transformRequest(o.o.resolveURL(l),o.R.Source),t.request.collectResourceTiming=this._collectResourceTiming):t.data=JSON.stringify(l),this._pendingLoad=this.actor.send(`${this.type}.loadData`,t,(d,g)=>{if(this._loaded=!0,this._pendingLoad=null,d)this.fire(new o.y(d));else{const y={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(y.resourceTiming=g.resourceTiming[this.id]),h&&(this._partialReload=!0),this.fire(new o.z("data",y)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(h),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const h=o.B(this.id,this.scope);this.map.style.clearSource(h),this._updateWorkerData()}loadTile(h,t){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor;const d=this.map.style?this.map.style.getLut(this.scope):null,g=d?{image:d.image.clone()}:null,y=this._partialReload,x={type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:g,scope:this.scope,pixelRatio:o.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:h.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:y,worldview:this.map.getWorldview(),indoor:this.map.getIndoorTileOptions(this.id,this.scope)};h.request=this.actor.send(l,x,(T,E)=>y&&!E?(h.state="loaded",t(null)):(delete h.request,h.destroy(!1),h.aborted?t(null):T?t(T):(h.loadVectorData(E,this.map.painter,l==="reloadTile"),t(null))),void 0,l==="loadTile")}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h,t){this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id,scope:this.scope}),h.destroy()}onRemove(h){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aU{constructor(h,t,l,d){super(h,t,l,d),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const t of h.urls)this.urls.push(this.map._requestManager.transformRequest(t,o.R.Source).url);o.aV(this.urls,(t,l)=>{this._loaded=!0,t?this.fire(new o.y(t)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const t=this.video.seekable;h<t.start(0)||h>t.end(0)?this.fire(new o.y(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${t.start(0)} and ${t.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const h=this.map.painter.context,t=h.gl;this.texture?this.video.paused||(this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),t.texSubImage2D(t.TEXTURE_2D,0,0,0,t.RGBA,t.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(h,this.video,t.RGBA8),this.texture.bind(t.LINEAR,t.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aU,model:o.aX,"batched-model":class extends o.E{constructor(h,t,l,d){super(),this.type="batched-model",this.id=h,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=l,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(d)}onAdd(h){this.map=h,this.load()}reload(){this.cancelTileJSONRequest();const h=o.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(h))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(h){this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"}));const t=Array.isArray(this.map._language)?this.map._language.join():this.map._language,l=this.map.getWorldview();this._tileJSONRequest=el(this._options,this.map._requestManager,t,l,(d,g)=>{this._tileJSONRequest=null,this._loaded=!0,d?(t&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${t}`),l&&l.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${l}`),this.fire(new o.y(d))):g&&(Object.assign(this,g),g.bounds&&(this.tileBounds=new Ds(g.bounds,this.minzoom,this.maxzoom)),Ot(g.tiles,this.map._requestManager._customAccessToken),this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))),h&&h(d)})}hasTransition(){return!1}hasTile(h){return!this.tileBounds||this.tileBounds.contains(h.canonical)}loaded(){return this._loaded}loadTile(h,t){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme)),d={request:this.map._requestManager.transformRequest(l,o.R.Tile),data:void 0,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,tileSize:this.tileSize*h.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:h.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.o.devicePixelRatio,promoteId:this.promoteId};if(h.actor&&h.state!=="expired")if(h.state==="loading")h.reloadCallback=t;else{if(h.buckets){const y=Object.values(h.buckets);for(const x of y)x.dirty=!0;return void(h.state="loaded")}h.request=h.actor.send("reloadTile",d,g.bind(this))}else h.actor=this.dispatcher.getActor(),h.request=h.actor.send("loadTile",d,g.bind(this),void 0,!0);function g(y,x){return h.aborted?t(null):y&&y.status!==404?t(y):(this.map._refreshExpiredTiles&&x&&h.setExpiryData(x),h.loadModelData(x,this.map.painter),h.state="loaded",void t(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends o.aU{constructor(h,t,l,d){super(h,t,l,d),t.coordinates?Array.isArray(t.coordinates)&&t.coordinates.length===4&&!t.coordinates.some(g=>!Array.isArray(g)||g.length!==2||g.some(y=>typeof y!="number"))||this.fire(new o.y(new o.V(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.y(new o.V(`sources.${h}`,null,'missing required property "coordinates"'))),t.animate&&typeof t.animate!="boolean"&&this.fire(new o.y(new o.V(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),t.canvas?typeof t.canvas=="string"||t.canvas instanceof HTMLCanvasElement||this.fire(new o.y(new o.V(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.y(new o.V(`sources.${h}`,null,'missing required property "canvas"'))),this.options=t,this.animate=t.animate===void 0||t.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(h){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const t=this.map.painter.context;this.texture?!h&&!this._playing||this.texture instanceof o.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(t,this.canvas,t.gl.RGBA8,{premultiply:!0}),this._prepareData(t)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends o.E{constructor(h,t,l,d){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=t,this.setEventedParent(d),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ds(this._implementation.bounds,this.minzoom,this.maxzoom)),t.update=this._update.bind(this),t.clearTiles=this._clearTiles.bind(this),t.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,o.aH(t,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this.map=h,this._loaded=!1,this.fire(new o.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:t,y:l,z:d}=h.canonical;return this._implementation.hasTile({x:t,y:l,z:d})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,t){const{x:l,y:d,z:g}=h.tileID.canonical,y=new AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:d,z:g},{signal:y.signal})).then((function(x){return delete h.request,h.aborted?(h.state="unloaded",t(null)):x===void 0?(h.state="errored",t(null)):x===null?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",t(null)):function(T){return T instanceof ImageData||T instanceof HTMLCanvasElement||T instanceof ImageBitmap||T instanceof HTMLImageElement}(x)?(this.loadTileData(h,x),h.state="loaded",void t(null)):(h.state="errored",t(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(x=>{x.name!=="AbortError"&&(h.state="errored",t(x))}),h.request.cancel=()=>y.abort()}loadTileData(h,t){h.setTexture(t,this.map.painter)}unloadTile(h,t){if(h.texture&&h.texture instanceof o.T?(h.destroy(!1),h.texture&&h.texture instanceof o.T&&this.map.painter.saveTileTexture(h.texture)):h.destroy(),this._implementation.unloadTile){const{x:l,y:d,z:g}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:d,z:g})}t&&t()}abortTile(h,t){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){const h=o.B(this.id,this.scope);this.map.style.clearSource(h)}_update(){this.fire(new o.z("data",{dataType:"source",sourceDataType:"content"}))}}},Ml=function(h,t,l,d){const g=new Ca[t.type](h,t,l,d);if(g.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${g.id}`);return o.aY(["load","abort","unload","serialize","prepare"],g),g};function Zs(h,t,l=""){return`${l}:${t.id||""}:${t.layer.id}:${function(d){if("layerId"in d)return`layer:${d.layerId}`;{const{featuresetId:g,importId:y}=d;return`featureset:${g}${y?`:import:${y}`:""}`}}(h.target)}`}function Ru(h,t,l,d=""){if(h.uniqueFeatureID){const g=Zs(h,t,d);if(l.has(g))return!0;l.add(g)}return!1}function Du(h,t,l,d,g=!1,y=void 0){const x=t.sourceCache.transform,T=t.sourceCache.tilesIn(h,t.has3DLayers,g);T.sort(wp);const E=[];for(const L of T){const P=L.tile.queryRenderedFeatures(t,L,l,d,x,g,y);Object.keys(P).length&&E.push({wrappedTileID:L.tile.tileID.wrapped().key,queryResults:P})}for(const L in t.layers){const P=t.layers[L];if(P.styleLayer){const z=P.styleLayer.queryRenderedFeatures(h,t.sourceCache,d);Object.keys(z).length&&E.push({wrappedTileID:0,queryResults:z})}}return E.length===0?{}:function(L){const P={},z={};for(const O of L){const B=O.queryResults,G=O.wrappedTileID,V=z[G]=z[G]||{};for(const W in B){const Y=B[W],se=V[W]=V[W]||{},ne=P[W]=P[W]||[];for(const te of Y)se[te.featureIndex]||(se[te.featureIndex]=!0,ne.push(te))}}return P}(E)}function $_(h,t,l,d,g,y){const x={},T=d.queryRenderedSymbols(h),E=[];for(const L of Object.keys(T).map(Number))E.push(g[L]);E.sort(wp);for(const L of E){const P=L.featureIndex.lookupSymbolFeatures(T[L.bucketInstanceId],L.bucketIndex,L.sourceLayerIndex,t,l,y);for(const z in P){const O=x[z]=x[z]||[],B=P[z];B.sort((G,V)=>{const W=L.featureSortOrder;if(W){const Y=W.indexOf(G.featureIndex);return W.indexOf(V.featureIndex)-Y}return V.featureIndex-G.featureIndex});for(const G of B)O.push(G)}}return x}function G_(h,t){const l=h.getRenderableIds().map(y=>h.getTileByID(y)),d=[],g={};for(let y=0;y<l.length;y++){const x=l[y],T=x.tileID.canonical.key;g[T]||(g[T]=!0,x.querySourceFeatures(d,t))}return d}function wp(h,t){const l=h.tileID,d=t.tileID;return l.overscaledZ-d.overscaledZ||l.canonical.y-d.canonical.y||l.wrap-d.wrap||l.canonical.x-d.canonical.x}function Sp(h,t){const l={};if(!t)return l;for(const d of h){const g=d.layerIds.map(y=>t.getLayer(y)).filter(Boolean);if(g.length!==0){d.layers=g,d.stateDependentLayerIds&&(d.stateDependentLayers=d.stateDependentLayerIds.map(y=>g.filter(x=>x.id===y)[0]));for(const y of g)l[y.fqid]=d}}return l}const Sn=32,Xs=33,ka=new Uint16Array(8184);for(let h=0;h<2046;h++){let t=h+2,l=0,d=0,g=0,y=0,x=0,T=0;for(1&t?g=y=x=Sn:l=d=T=Sn;(t>>=1)>1;){const L=l+g>>1,P=d+y>>1;1&t?(g=l,y=d,l=x,d=T):(l=g,d=y,g=x,y=T),x=L,T=P}const E=4*h;ka[E+0]=l,ka[E+1]=d,ka[E+2]=g,ka[E+3]=y}const Ks=new Uint16Array(2178),ra=new Uint8Array(1089),_c=new Uint16Array(1089);function yc(h){return h===0?-.03125:h===32?.03125:0}const Rl={type:2,extent:o.al,loadGeometry:()=>[[new o.P(0,0),new o.P(o.al+1,0),new o.P(o.al+1,o.al+1),new o.P(0,o.al+1),new o.P(0,0)]]};class tl{constructor(t,l,d,g,y,x){this.tileID=t,this.uid=o.b2(),this.uses=0,this.tileSize=l,this.tileZoom=d,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=y,g&&g.style&&(this._lastUpdatedBrightness=g.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",g&&g.transform&&(this.projection=g.transform.projection),this.worldview=x,this._hasAppearances=null}registerFadeDuration(t){const l=t+this.timeAdded;l<o.o.now()||this.fadeEndTime&&l<this.fadeEndTime||(this.fadeEndTime=l)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,l,d){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=Sp(t.buckets,l.style),this.hasSymbolBuckets=!1;for(const g in this.buckets){const y=this.buckets[g];if(y instanceof o.b4){if(this.hasSymbolBuckets=!0,!d)break;y.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const g in this.buckets){const y=this.buckets[g];if(y instanceof o.b4&&y.hasRTLText){this.hasRTLText=!0,o.b5();break}}this.queryPadding=0;for(const g in this.buckets){const y=this.buckets[g],x=l.style.getOwnLayer(g);if(!x)continue;const T=x.queryRadius(y);this.queryPadding=Math.max(this.queryPadding,T)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new o.b3}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(t,l,d){t&&(t.resourceTiming&&(this.resourceTiming=t.resourceTiming),this.buckets=Object.assign({},this.buckets,Sp(t.buckets,l.style)),t.featureIndex&&(this.latestFeatureIndex=t.featureIndex))}getBucket(t){return this.buckets[t.fqid]}upload(t,l){for(const y in this.buckets){const x=this.buckets[y];if(x.uploadPending()){let T={},E=[],L={zoom:0,pitch:0,brightness:0,worldview:""};if(l){if(l.style){E=l.style.listImages();const P=x.layers[0],z=P.sourceLayer||"_geojsonTileLayer",O=l.style.getLayerSourceCache(P);O&&(T=O._state.getState(z,void 0))}L={zoom:l.transform.zoom||0,pitch:l.transform.pitch||0,brightness:l.style.getBrightness()||0,worldview:l.worldview||""}}x.upload(t,this.tileID.canonical,T,E,L)}}const d=t.gl,g=this.imageAtlas;g&&!g.uploaded&&(this.imageAtlasTexture=new o.T(t,g.image,d.RGBA8,{useMipmap:!!g.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(t,this.glyphAtlasImage,d.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(t,this.lineAtlas.image,d.R8),this.lineAtlas.uploaded=!0)}prepare(t,l,d){if(this.imageAtlas&&this.imageAtlasTexture&&l){const y=l.style.getLut(d);this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture,d,y)}if(!l||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const g=l.style.getBrightness();this._hasAppearances===null&&(this._hasAppearances=this.hasAppearances(l)),(this._lastUpdatedBrightness||g||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&g&&Math.abs(this._lastUpdatedBrightness-g)<.001||(this.updateBuckets(l,this._lastUpdatedBrightness!==g),this._lastUpdatedBrightness=g))}evaluateQueryRenderedFeaturePadding(){let t=0;for(const l in this.buckets){const d=this.buckets[l];d.evaluateQueryRenderedFeaturePadding&&(t=Math.max(t,d.evaluateQueryRenderedFeaturePadding()))}return t}queryRenderedFeatures(t,l,d,g,y,x,T){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const E=this.evaluateQueryRenderedFeaturePadding(),L=function(P,z){const O=o.bq([],[.5*P.width,.5*-P.height,1]);return o.br(O,O,[1,-1,0]),o.aB(O,O,P.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(O)}(y,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:l,pixelPosMatrix:L,transform:g,availableImages:d,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:E,scope:T})}querySourceFeatures(t,l){const d=this.latestFeatureIndex;if(!d||!d.rawTileData)return;const g=d.loadVTLayers(),y=l?l.sourceLayer:"",x=g._geojsonTileLayer||g[y];if(!x)return;const T=o.b6(l&&l.filter),{z:E,x:L,y:P}=this.tileID.canonical,z={z:E,x:L,y:P};for(let O=0;O<x.length;O++){const B=x.feature(O);if(T.needGeometry){const W=o.b7(B,!0);if(!T.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),W,this.tileID.canonical))continue}else if(!T.filter(new o.ac(this.tileID.overscaledZ,{worldview:this.worldview}),B))continue;const G=d.getId(B,y),V=new o.b8(B,E,L,P,G);V.tile=z,t.push(V)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const l=this.expirationTime;if(t.cacheControl){const d=o.b9(t.cacheControl);d["max-age"]&&(this.expirationTime=Date.now()+1e3*d["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const d=Date.now();let g=!1;if(this.expirationTime>d)g=!1;else if(l)if(this.expirationTime<l)g=!0;else{const y=this.expirationTime-l;y?this.expirationTime=d+Math.max(y,3e4):g=!0}else g=!0;g?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(t){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&t&&this.updateBuckets(t)}hasAppearances(t){for(const l in this.buckets)if(t.style.hasLayer(l)&&this.buckets[l].layers.some(d=>d.appearances&&d.appearances.length>0))return!0;return!1}updateBuckets(t,l){if(!this.latestFeatureIndex||!t.style)return;const d=t.style.listImages(),g=t.style.getBrightness();for(const y in this.buckets){if(!t.style.hasLayer(y))continue;const x=this.buckets[y],T=x.layers[0],E=T.sourceLayer||"_geojsonTileLayer",L=t.style.getLayerSourceCache(T);let P={};L&&(P=L._state.getState(E,void 0));const z=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},O=Object.keys(P).length>0&&!l;x.hasAppearances=x.layers.some(V=>V.appearances&&V.appearances.length>0);const B=O?x.stateDependentLayers:x.layers;if(O&&x.stateDependentLayers.length!==0||l){const V=this.latestFeatureIndex.loadVTLayers();x.update(P,V[E],d,z,B,l,g)}if(O&&x.stateDependentLayers.length!==0||l||x.hasAppearances){const V={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};x.updateAppearances(this.tileID.canonical,P,d,V,t.imageManager)}(x instanceof o.ba||x instanceof o.bb)&&t._terrain&&t._terrain.enabled&&L&&x.uploadPending()&&t._terrain._clearRenderCacheForTile(L.id,this.tileID);const G=t&&t.style&&t.style.getOwnLayer(y);G&&(this.queryPadding=Math.max(this.queryPadding,G.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=o.o.now()+t}setTexture(t,l){const d=l.context,g=d.gl;this.texture=this.texture||l.getTileTexture(t.width),this.texture&&this.texture instanceof o.T?this.texture.update(t):(this.texture=new o.T(d,t,g.RGBA8,{useMipmap:!0}),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE))}setDependencies(t,l){const d={};for(const g of l)d[g]=!0;this.dependencies[t]=d}hasDependency(t,l){for(const d of t){const g=this.dependencies[d];if(g){for(const y of l)if(g[y])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,l){if(!l||l.name==="mercator"||this._tileDebugBuffer)return;const d=o.bc(Rl,this.tileID.canonical,this.tileTransform)[0],g=new o.bd,y=new o.be;for(let x=0;x<d.length;x++){const{x:T,y:E}=d[x];g.emplaceBack(T,E),y.emplaceBack(x)}y.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(y),this._tileDebugBuffer=t.createVertexBuffer(g,o.bf.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,g.length,y.length)}_makeTileBoundsBuffers(t,l){if(this._tileBoundsBuffer||!l||l.name==="mercator")return;const d=o.bc(Rl,this.tileID.canonical,this.tileTransform)[0];let g,y;if(this.isRaster){const x=function(T,E){const L=o.aZ(T,E),P=Math.pow(2,T.z);for(let W=0;W<Xs;W++)for(let Y=0;Y<Xs;Y++){const se=o.a_((T.x+(Y+yc(Y))/Sn)/P),ne=o.a$((T.y+(W+yc(W))/Sn)/P),te=E.project(se,ne),we=W*Xs+Y;Ks[2*we+0]=Math.round((te.x*L.scale-L.x)*o.al),Ks[2*we+1]=Math.round((te.y*L.scale-L.y)*o.al)}ra.fill(0),_c.fill(0);for(let W=2045;W>=0;W--){const Y=4*W,se=ka[Y+0],ne=ka[Y+1],te=ka[Y+2],we=ka[Y+3],_e=se+te>>1,be=ne+we>>1,de=_e+be-ne,le=be+se-_e,Te=ne*Xs+se,Me=we*Xs+te,Oe=be*Xs+_e,Ve=Math.hypot((Ks[2*Te+0]+Ks[2*Me+0])/2-Ks[2*Oe+0],(Ks[2*Te+1]+Ks[2*Me+1])/2-Ks[2*Oe+1])>=16;ra[Oe]=ra[Oe]||(Ve?1:0),W<1022&&(ra[Oe]=ra[Oe]||ra[(ne+le>>1)*Xs+(se+de>>1)]||ra[(we+le>>1)*Xs+(te+de>>1)])}const z=new o.b1,O=new o.b0;let B=0;function G(W,Y){const se=Y*Xs+W;return _c[se]===0&&(z.emplaceBack(Ks[2*se+0],Ks[2*se+1],W*o.al/Sn,Y*o.al/Sn),_c[se]=++B),_c[se]-1}function V(W,Y,se,ne,te,we){const _e=W+se>>1,be=Y+ne>>1;if(Math.abs(W-te)+Math.abs(Y-we)>1&&ra[be*Xs+_e])V(te,we,W,Y,_e,be),V(se,ne,te,we,_e,be);else{const de=G(W,Y),le=G(se,ne),Te=G(te,we);O.emplaceBack(de,le,Te)}}return V(0,0,Sn,Sn,Sn,0),V(Sn,Sn,0,0,0,Sn),{vertices:z,indices:O}}(this.tileID.canonical,l);g=x.vertices,y=x.indices}else{g=new o.b1,y=new o.b0;for(const{x:T,y:E}of d)g.emplaceBack(T,E,0,0);const x=o.bh(g.int16.subarray(0,4*g.length),void 0,4);for(let T=0;T<x.length;T+=3)y.emplaceBack(x[T],x[T+1],x[T+2])}this._tileBoundsBuffer=t.createVertexBuffer(g,o.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(y),this._tileBoundsSegments=o.bg.simpleSegment(0,0,g.length,y.length)}_makeGlobeTileDebugBuffers(t,l){const d=l.projection;if(!d||d.name!=="globe"||l.freezeTileCoverage)return;const g=this.tileID.canonical,y=o.bj(g,l),x=o.bk(y),T=o.aj(l.zoom);let E;T>0&&(E=o.bl(new Float64Array(16),l.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,g,l,x,E,T),this._makeGlobeTileDebugTextBuffer(t,g,l,x,E,T)}_globePoint(t,l,d,g,y,x,T){let E=o.bm(t,l,d);if(x){const L=1<<d.z,P=o.aF(g.center.lng),z=o.aJ(g.center.lat),O=(d.x+.5)/L-P;let B=0;O>.5?B=-1:O<-.5&&(B=1);let G=(t/o.al+d.x)/L+B,V=(l/o.al+d.y)/L;G=(G-P)*g._pixelsPerMercatorPixel+P,V=(V-z)*g._pixelsPerMercatorPixel+z;const W=[G*g.worldSize,V*g.worldSize,0];o.af(W,W,x),E=o.bn(E,W,T)}return o.af(E,E,y)}_makeGlobeTileDebugBorderBuffer(t,l,d,g,y,x){const T=new o.bd,E=new o.be,L=new o.bo,P=(O,B,G,V,W)=>{const Y=(G-O)/(W-1),se=(V-B)/(W-1),ne=T.length;for(let te=0;te<W;te++){const we=O+te*Y,_e=B+te*se;T.emplaceBack(we,_e);const be=this._globePoint(we,_e,l,d,g,y,x);L.emplaceBack(be[0],be[1],be[2]),E.emplaceBack(ne+te)}},z=o.al;P(0,0,z,0,16),P(z,0,z,z,16),P(z,z,0,z,16),P(0,z,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(E),this._tileDebugBuffer=t.createVertexBuffer(T,o.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(L,o.bp.members),this._tileDebugSegments=o.bg.simpleSegment(0,0,T.length,E.length)}_makeGlobeTileDebugTextBuffer(t,l,d,g,y,x){const T=o.al/4,E=new o.bd,L=new o.b0,P=new o.bo,z=25;L.reserve(32),E.reserve(z),P.reserve(z);const O=(B,G)=>z*B+G;for(let B=0;B<z;B++){const G=B*T;for(let V=0;V<z;V++){const W=V*T;E.emplaceBack(W,G);const Y=this._globePoint(W,G,l,d,g,y,x);P.emplaceBack(Y[0],Y[1],Y[2])}}for(let B=0;B<4;B++)for(let G=0;G<4;G++){const V=O(B,G),W=O(B,G+1),Y=O(B+1,G),se=O(B+1,G+1);L.emplaceBack(V,W,Y),L.emplaceBack(Y,W,se)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(L),this._tileDebugTextBuffer=t.createVertexBuffer(E,o.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(P,o.bp.members),this._tileDebugTextSegments=o.bg.simpleSegment(0,0,z,32)}destroy(t=!0){for(const l in this.buckets)this.buckets[l].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof o.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bs.setPbf(o.bt);class rd extends tl{constructor(t,l,d,g,y){super(t,l,d,g,y),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(t){return this._mrt&&this._mrt.getLayer(t)}setTexturePerLayer(t,l,d){const g=d.context,y=g.gl;let x=this.texturePerLayer.get(t)||d.getTileTexture(l.width);x&&x instanceof o.T?x.update(l,{premultiply:!1}):x=new o.T(g,l,y.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,x)}flushQueues(t){const l=this._workQueuePerLayer.get(t)||[],d=this._fetchQueuePerLayer.get(t)||[];for(;l.length;)l.pop()();for(;d.length;)d.pop()()}flushAllQueues(){for(const t of this._workQueuePerLayer.keys()){const l=this._workQueuePerLayer.get(t)||[];for(;l.length;)l.pop()()}for(const t of this._fetchQueuePerLayer.keys()){const l=this._fetchQueuePerLayer.get(t)||[];for(;l.length;)l.pop()()}}fetchHeader(t=16384,l){const d=this._mrt=new o.bs(30),g=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=o.bu(g,(y,x,T)=>{if(y)l(y);else try{const E=d.getHeaderLength(x);if(E>t)return void(this.request=this.fetchHeader(E,l));d.parseHeader(x),this._isHeaderLoaded=!0;let L=0;for(const P of Object.values(d.layers))L=Math.max(L,P.dataIndex[P.dataIndex.length-1].lastByte);x.byteLength>=L&&(this.entireBuffer=x),l(null,this.entireBuffer||x,T)}catch(E){l(E)}}),this.request}fetchBandForRender(t,l,d,g){this.fetchBand(t,l,d,y=>{if(y)return void g(y);this.updateTextureDescriptor(t,l,d);const x=this.textureDescriptorPerLayer.get(l);g(null,x?x.img:null)})}fetchBand(t,l,d,g,y=!0){const x=this._mrt;if(!this._isHeaderLoaded||!x)return void g(new Error("Tile header is not ready"));const T=this.actor;if(!T)return void g(new Error("Can't fetch tile band without an actor"));let E;const L=o.B(String(d),o.B(this.tileID.key,t));let P=this._taskQueue.get(L);P?P.add(g):(P=new Set,P.add(g),this._taskQueue.set(L,P));const z=(V,W)=>{E.complete(V,W),V?g(V):(P.forEach(Y=>Y(null,W)),this._taskQueue.delete(L))},O=(V,W)=>{if(V)return g(V);const Y=T.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:W,task:E},z,void 0,!0);if(l!==null){const se=this._workQueuePerLayer.get(l)||[];se.push(()=>{Y&&Y.cancel(),E.cancel()}),this._workQueuePerLayer.has(l)||this._workQueuePerLayer.set(l,se)}};let B;try{B=x.getLayer(t)}catch(V){if(this.state==="reloading")return;throw V}if(!B)return void g(new Error(`Unknown sourceLayer "${t}"`));if(B.hasDataForBand(d))return P.forEach(V=>V(null,null)),void this._taskQueue.delete(L);const G=B.getDataRange([d]);if(E=x.createDecodingTask(G),!E||E.tasks.length)if(l!==null&&this.flushQueues(l),this.entireBuffer)O(null,this.entireBuffer.slice(G.firstByte,G.lastByte+1));else{const V=Object.assign({},this.requestParams,{headers:{Range:`bytes=${G.firstByte}-${G.lastByte}`}}),W=o.bu(V,O);if(l!==null){const Y=this._fetchQueuePerLayer.get(l)||[];Y.push(()=>{W.cancel(),E.cancel()}),this._fetchQueuePerLayer.has(l)||this._fetchQueuePerLayer.set(l,Y)}}}updateNeeded(t,l){return(!this.textureDescriptorPerLayer.get(t)||this.textureDescriptorPerLayer.get(t).band!==l||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(t,l,d){if(!this._mrt)return;const g=this._mrt.getLayer(t);if(!g||!g.hasBand(d)||!g.hasDataForBand(d))return;const{bytes:y,tileSize:x,buffer:T,offset:E,scale:L}=g.getBandView(d),P=x+2*T,z=new o.q({width:P,height:P},y),O=this.texturePerLayer.get(l);O&&O instanceof o.T&&O.update(z,{premultiply:!1}),this.textureDescriptorPerLayer.set(l,{layer:t,band:d,img:z,buffer:T,offset:E,tileSize:x,format:g.pixelFormat,mix:[L,256*L,65536*L,16777216*L]})}destroy(t=!1){if(super.destroy(t),delete this._mrt,!t)for(const l of this.texturePerLayer.values())l&&l instanceof o.T&&l.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class H_{constructor(t,l){this.max=t,this.onRemove=l,this.reset()}reset(){for(const t in this.data)for(const l of this.data[t])l.timeout&&clearTimeout(l.timeout),this.onRemove(l.value);return this.data={},this.order=[],this}add(t,l,d){const g=t.wrapped().key;this.data[g]===void 0&&(this.data[g]=[]);const y={value:l,timeout:void 0};if(d!==void 0&&(y.timeout=setTimeout(()=>{this.remove(t,y)},d)),this.data[g].push(y),this.order.push(g),this.order.length>this.max){const x=this._getAndRemoveByKey(this.order[0]);x&&this.onRemove(x)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const l=this.data[t].shift();return l.timeout&&clearTimeout(l.timeout),this.data[t].length===0&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),l.value}getByKey(t){const l=this.data[t];return l?l[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,l){if(!this.has(t))return this;const d=t.wrapped().key,g=l===void 0?0:this.data[d].indexOf(l),y=this.data[d][g];return this.data[d].splice(g,1),y.timeout&&clearTimeout(y.timeout),this.data[d].length===0&&delete this.data[d],this.onRemove(y.value),this.order.splice(this.order.indexOf(d),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const l=this._getAndRemoveByKey(this.order[0]);l&&this.onRemove(l)}return this}filter(t){const l=[];for(const d in this.data)for(const g of this.data[d])t(g.value)||l.push(g);for(const d of l)this.remove(d.value.tileID,d)}}class W_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,l,d){const g=String(l);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][g]=this.stateChanges[t][g]||{},Object.assign(this.stateChanges[t][g],d),this.deletedStates[t]===null){this.deletedStates[t]={};for(const y in this.state[t])y!==g&&(this.deletedStates[t][y]=null)}else if(this.deletedStates[t]&&this.deletedStates[t][g]===null){this.deletedStates[t][g]={};for(const y in this.state[t][g])d[y]||(this.deletedStates[t][g][y]=null)}else for(const y in d)this.deletedStates[t]&&this.deletedStates[t][g]&&this.deletedStates[t][g][y]===null&&delete this.deletedStates[t][g][y]}removeFeatureState(t,l,d){if(this.deletedStates[t]===null)return;const g=String(l);if(this.deletedStates[t]=this.deletedStates[t]||{},d&&l!==void 0)this.deletedStates[t][g]!==null&&(this.deletedStates[t][g]=this.deletedStates[t][g]||{},this.deletedStates[t][g][d]=null);else if(l!==void 0)if(this.stateChanges[t]&&this.stateChanges[t][g])for(d in this.deletedStates[t][g]={},this.stateChanges[t][g])this.deletedStates[t][g][d]=null;else this.deletedStates[t][g]=null;else this.deletedStates[t]=null}getState(t,l){const d=this.state[t]||{},g=this.stateChanges[t]||{},y=this.deletedStates[t];if(y===null)return{};if(l!==void 0){const T=String(l),E=Object.assign({},d[T],g[T]);if(y){const L=y[l];if(L===null)return{};for(const P in L)delete E[P]}return E}const x=Object.assign({},d,g);if(y)for(const T in y)delete x[T];return x}initializeTileState(t,l){t.refreshFeatureState(l)}coalesceChanges(t,l){const d={};for(const g in this.stateChanges){this.state[g]=this.state[g]||{};const y={};for(const x in this.stateChanges[g])this.state[g][x]||(this.state[g][x]={}),Object.assign(this.state[g][x],this.stateChanges[g][x]),y[x]=this.state[g][x];d[g]=y}for(const g in this.deletedStates){this.state[g]=this.state[g]||{};const y={};if(this.deletedStates[g]===null)for(const x in this.state[g])y[x]={},this.state[g][x]={};else for(const x in this.deletedStates[g]){if(this.deletedStates[g][x]===null)this.state[g][x]={};else if(this.state[g][x])for(const T of Object.keys(this.deletedStates[g][x]))delete this.state[g][x][T];y[x]=this.state[g][x]}d[g]=d[g]||{},Object.assign(d[g],y)}if(this.stateChanges={},this.deletedStates={},Object.keys(d).length!==0)for(const g in t)t[g].refreshFeatureState(l)}}class gs extends o.E{constructor(t,l,d){super(),this.id=t,this._onlySymbols=d,l.on("data",g=>{g.dataType==="source"&&g.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&g.dataType==="source"&&g.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),l.on("error",()=>{this._sourceErrored=!0}),this._source=l,this._tiles={},this._cache=new H_(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=l.minTileCacheSize,this._maxTileCacheSize=l.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new W_,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(t){this.map=t,this._minTileCacheSize=this._minTileCacheSize===void 0&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const t in this._tiles)if(!this._tiles[t].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,l){return t.isSymbolTile=this._onlySymbols,t.isExtraShadowCaster=this._shadowCasterTiles[t.tileID.key],this._source.loadTile(t,l)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t)}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t)}serialize(){return this._source.serialize()}prepare(t){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const l in this._tiles){const d=this._tiles[l];d.upload(t,this.map?this.map.painter:void 0),d.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(t=>t.tileID).sort(Ou).map(t=>t.key)}getRenderableIds(t,l){const d=[];for(const g in this._tiles)this._isIdRenderable(+g,t,l)&&d.push(this._tiles[g]);return t?d.sort((g,y)=>{const x=g.tileID,T=y.tileID,E=new o.P(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),L=new o.P(T.canonical.x,T.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-T.overscaledZ||L.y-E.y||L.x-E.x}).map(g=>g.tileID.key):d.map(g=>g.tileID).sort(Ou).map(g=>g.key)}hasRenderableParent(t){const l=this.findLoadedParent(t,0);return!!l&&this._isIdRenderable(l.tileID.key)}_isIdRenderable(t,l,d){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(l||!this._tiles[t].holdingForFade())&&(d||!this._shadowCasterTiles[t])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)this._tiles[t].state!=="errored"&&this._reloadTile(+t,"reloading")}}_reloadTile(t,l){const d=this._tiles[t];d&&(d.state!=="loading"&&(d.state=l),this._loadTile(d,this._tileLoaded.bind(this,d,t,l)))}_tileLoaded(t,l,d,g,y){if(g){if(t.state="errored",g.status!==404)this._source.fire(new o.y(g,{tile:t}));else{if(this._source.fire(new o.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const T=this.map.painter.terrain;this.update(this.transform,T.getScaledDemTileSize(),!0),T.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=o.o.now(),d==="expired"&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(l,t),this._source.type==="raster-dem"&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let x=new Map;y&&y.responseHeaders&&(x=y.responseHeaders),this._source.fire(new o.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:x}))}_backfillDEM(t){const l=this.getRenderableIds();for(let g=0;g<l.length;g++){const y=l[g];if(t.neighboringTiles&&t.neighboringTiles[y]){const x=this.getTileByID(y);d(t,x),d(x,t)}}function d(g,y){if(!g.dem||g.dem.borderReady)return;g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0;let x=y.tileID.canonical.x-g.tileID.canonical.x;const T=y.tileID.canonical.y-g.tileID.canonical.y,E=Math.pow(2,g.tileID.canonical.z),L=y.tileID.key;x===0&&T===0||Math.abs(T)>1||(Math.abs(x)>1&&(Math.abs(x+E)===1?x+=E:Math.abs(x-E)===1&&(x-=E)),y.dem&&g.dem&&(g.dem.backfillBorder(y.dem,x,T),g.neighboringTiles&&g.neighboringTiles[L]&&(g.neighboringTiles[L].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,l,d,g){for(const y in this._tiles){let x=this._tiles[y];if(g[y]||!x.hasData()||x.tileID.overscaledZ<=l||x.tileID.overscaledZ>d)continue;let T=x.tileID;for(;x&&x.tileID.overscaledZ>l+1;){const L=x.tileID.scaledTo(x.tileID.overscaledZ-1);x=this._tiles[L.key],x&&x.hasData()&&(T=L)}let E=T;for(;E.overscaledZ>l;)if(E=E.scaledTo(E.overscaledZ-1),t[E.key]){g[T.key]=T;break}}}findLoadedParent(t,l){if(t.key in this._loadedParentTiles){const d=this._loadedParentTiles[t.key];return d&&d.tileID.overscaledZ>=l?d:null}for(let d=t.overscaledZ-1;d>=l;d--){const g=t.scaledTo(d),y=this._getLoadedTile(g);if(y)return y}}_getLoadedTile(t){const l=this._tiles[t.key];return l&&l.hasData()?l:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,l){l=l||this._source.tileSize;const d=Math.ceil(t.width/l)+1,g=Math.ceil(t.height/l)+1,y=Math.floor(d*g*5),x=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,y):y,T=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,x):x;this._cache.setMaxSize(T)}handleWrapJump(t){const l=Math.round((t-(this._prevLng===void 0?t:this._prevLng))/360);if(this._prevLng=t,l){const d={};for(const g in this._tiles){const y=this._tiles[g];y.tileID=y.tileID.unwrapTo(y.tileID.wrap+l),d[y.tileID.key]=y}this._tiles=d;for(const g in this._timers)clearTimeout(this._timers[g]),delete this._timers[g];for(const g in this._tiles)this._setTileReloadTimer(+g,this._tiles[g])}}update(t,l,d,g,y){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!d)return;this.updateCacheSize(t,l),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const x=this._source.type==="batched-model";let T,E=this._source.maxzoom;const L=this.map&&this.map.painter?this.map.painter._terrain:null;if(L&&L.sourceCache===this&&L.attenuationRange()){const O=L.attenuationRange()[0],B=Math.floor(O)-Math.log2(L.getDemUpscale());E>B&&(E=B)}if(this.used||this.usedForTerrain){if(this._source.tileID)T=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aQ(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=t.clone();O.tileCoverLift=this.tileCoverLift,T=O.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.minzoom<=1&&t.projection.name==="globe"&&(T.push(new o.aQ(1,0,1,0,0)),T.push(new o.aQ(1,0,1,1,0)),T.push(new o.aQ(1,0,1,0,1)),T.push(new o.aQ(1,0,1,1,1)))}else if(T=t.coveringTiles({tileSize:l||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:E,roundZoom:this._source.roundZoom&&!d,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:x}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);T=T.filter(B=>O(B))}}else T=[];if(T.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!zu(this._source.type)){const O=t.coveringZoomLevel({tileSize:l||this._source.tileSize,roundZoom:this._source.roundZoom&&!d}),B=Math.min(O,this._source.maxzoom);if(x){const G=t.extendTileCover(T,B);for(const V of G)T.push(V)}else if(y){const G=t.extendTileCoverToNearPlane(T,this.transform.getFrustum(B),B);for(const V of G)T.push(V)}else if(this.castsShadows&&g){const G=t.extendTileCover(T,B,g,16);for(const V of G)this._shadowCasterTiles[V.key]=!0,T.push(V)}}const P=this._updateRetainedTiles(T);if(zu(this._source.type)&&T.length!==0){const O={},B={},G=Object.keys(P);for(const W of G){const Y=P[W],se=this._tiles[W];if(!se||se.fadeEndTime&&se.fadeEndTime<=o.o.now())continue;const ne=this.findLoadedParent(Y,Math.max(Y.overscaledZ-gs.maxOverzooming,this._source.minzoom));ne&&(this._addTile(ne.tileID),O[ne.tileID.key]=ne.tileID),B[W]=Y}const V=T[T.length-1].overscaledZ;for(const W in this._tiles){const Y=this._tiles[W];if(P[W]||!Y.hasData())continue;let se=Y.tileID;for(;se.overscaledZ>V;){se=se.scaledTo(se.overscaledZ-1);const ne=this._tiles[se.key];if(ne&&ne.hasData()&&B[se.key]){P[W]=Y.tileID;break}}}for(const W in O)P[W]||(this._coveredTiles[W]=!0,P[W]=O[W])}for(const O in P)this._tiles[O].clearFadeHold();const z=o.bv(this._tiles,P);for(const O of z){const B=this._tiles[O];B.hasSymbolBuckets&&!B.holdingForFade()?B.setHoldDuration(this.map._fadeDuration):B.hasSymbolBuckets&&!B.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const l={};if(t.length===0)return l;const d={},g=t.reduce((L,P)=>Math.min(L,P.overscaledZ),1/0),y=t[0].overscaledZ,x=Math.max(y-gs.maxOverzooming,this._source.minzoom),T=Math.max(y+gs.maxUnderzooming,this._source.minzoom),E={};for(const L of t){const P=this._addTile(L);l[L.key]=L,P.hasData()||g<this._source.maxzoom&&(E[L.key]=L)}this._retainLoadedChildren(E,g,T,l);for(const L of t){let P=this._tiles[L.key];if(P.hasData())continue;if(L.canonical.z>=this._source.maxzoom){const O=L.children(this._source.maxzoom)[0],B=this.getTile(O);if(B&&B.hasData()){l[O.key]=O;continue}}else{const O=L.children(this._source.maxzoom);if(l[O[0].key]&&l[O[1].key]&&l[O[2].key]&&l[O[3].key])continue}let z=P.wasRequested();for(let O=L.overscaledZ-1;O>=x;--O){const B=L.scaledTo(O);if(d[B.key]||(d[B.key]=!0,P=this.getTile(B),!P&&z&&(P=this._addTile(B)),P&&(l[B.key]=B,z=P.wasRequested(),P.hasData())))break}}return l}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const l=[];let d,g=this._tiles[t].tileID;for(;g.overscaledZ>0;){if(g.key in this._loadedParentTiles){d=this._loadedParentTiles[g.key];break}l.push(g.key);const y=g.scaledTo(g.overscaledZ-1);if(d=this._getLoadedTile(y),d)break;g=y}for(const y of l)this._loadedParentTiles[y]=d}}_addTile(t){let l=this._tiles[t.key];if(l)return l.isExtraShadowCaster!==!0||this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),l;l=this._cache.getAndRemove(t),l&&(this._setTileReloadTimer(t.key,l),l.tileID=t,this._state.initializeTileState(l,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,l)));const d=!!l;if(!d){const g=this.map?this.map.painter:null,y=this._source.tileSize*t.overscaleFactor();l=this._source.type==="raster-array"?new rd(t,y,this.transform.tileZoom,g,this._isRaster):new tl(t,y,this.transform.tileZoom,g,this._isRaster,this._source.worldview),this._loadTile(l,this._tileLoaded.bind(this,l,t.key,l.state))}return l.uses++,this._tiles[t.key]=l,d||this._source.fire(new o.z("dataloading",{tile:l,coord:l.tileID,dataType:"source"})),l}_setTileReloadTimer(t,l){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const d=l.getExpiryTimeout();d&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},d))}_removeTile(t){const l=this._tiles[t];l&&(l.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),l.uses>0||(l.hasData()&&l.state!=="reloading"||l.state==="empty"?this._cache.add(l.tileID,l,l.getExpiryTimeout()):(l.aborted=!0,this._abortTile(l),this._unloadTile(l))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,l,d){const g=[],y=this.transform;if(!y)return g;const x=y.projection.name==="globe",T=o.aF(y.center.lng);for(const E in this._tiles){const L=this._tiles[E];if(d&&L.clearQueryDebugViz(),L.holdingForFade())continue;let P;if(x){const z=L.tileID.canonical;if(z.z===0){const O=[Math.abs(o.aA(T,...La(z,-1))-T),Math.abs(o.aA(T,...La(z,1))-T)];P=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.aA(T,...La(z,-1))-T),Math.abs(o.aA(T,...La(z,0))-T),Math.abs(o.aA(T,...La(z,1))-T)];P=[O.indexOf(Math.min(...O))-1]}}else P=[0];for(const z of P){const O=t.containsTile(L,y,l,z);O&&g.push(O)}}return g}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(t){return this._getRenderableCoordinates(t)}_getRenderableCoordinates(t,l){const d=this.getRenderableIds(t,l).map(y=>this._tiles[y].tileID),g=this.transform.projection.name==="globe";for(const y of d)y.projMatrix=this.transform.calculateProjMatrix(y.toUnwrapped()),y.expandedProjMatrix=g?this.transform.calculateProjMatrix(y.toUnwrapped(),!1,!0):y.projMatrix;return d}sortCoordinatesByDistance(t){const l=t.slice(),d=this.transform._camera.position,g=this.transform._camera.forward(),y={};for(const x of l){const T=1/(1<<x.canonical.z);y[x.key]=((x.canonical.x+.5)*T+x.wrap-d[0])*g[0]+((x.canonical.y+.5)*T-d[1])*g[1]-d[2]*g[2]}return l.sort((x,T)=>y[x.key]-y[T.key]),l}hasTransition(){if(this._source.hasTransition())return!0;if(zu(this._source.type))for(const t in this._tiles){const l=this._tiles[t];if(l.fadeEndTime!==void 0&&l.fadeEndTime>=o.o.now())return!0}return!1}setFeatureState(t,l,d){this._state.updateState(t=t||"_geojsonTileLayer",l,d)}removeFeatureState(t,l,d){this._state.removeFeatureState(t=t||"_geojsonTileLayer",l,d)}getFeatureState(t,l){return this._state.getState(t=t||"_geojsonTileLayer",l)}setDependencies(t,l,d){const g=this._tiles[t];g&&g.setDependencies(l,d)}reloadTilesForDependencies(t,l){for(const d in this._tiles)this._tiles[d].hasDependency(t,l)&&this._reloadTile(+d,"reloading");this._cache.filter(d=>!d.hasDependency(t,l))}_preloadTiles(t,l){if(!this._sourceLoaded){const E=()=>{this._sourceLoaded&&(this._source.off("data",E),this._preloadTiles(t,l))};return void this._source.on("data",E)}const d=new Map,g=Array.isArray(t)?t:[t],y=this.map.painter.terrain,x=this.usedForTerrain&&y?y.getScaledDemTileSize():this._source.tileSize;for(const E of g){const L=E.coveringTiles({tileSize:x,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const P of L)d.set(P.key,P);this.usedForTerrain&&E.updateElevation(!1)}const T=Array.from(d.values());o.bw(T,(E,L)=>{const P=new tl(E,this._source.tileSize*E.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(P,z=>{this._source.type==="raster-dem"&&P.dem&&this._backfillDEM(P),L(z,P)})},l)}}function Ou(h,t){const l=Math.abs(2*h.wrap)-+(h.wrap<0),d=Math.abs(2*t.wrap)-+(t.wrap<0);return h.overscaledZ-t.overscaledZ||d-l||t.canonical.y-h.canonical.y||t.canonical.x-h.canonical.x}function zu(h){return h==="raster"||h==="image"||h==="video"||h==="custom"}function La(h,t){const l=1<<h.z;return[h.x/l+t,(h.x+1)/l+t]}gs.maxOverzooming=10,gs.maxUnderzooming=3;class Bu{constructor(t){this.style=t,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const t=!1,l=!1;for(const d in this.style._mergedLayers){const g=this.style._mergedLayers[d];if(g.type==="fill-extrusion"||g.type==="building")this.layers.push({layer:g,visible:t,visibilityChanged:l});else if(g.type==="model"){const y=this.style.getLayerSource(g);y&&y.type==="batched-model"&&this.layers.push({layer:g,visible:t,visibilityChanged:l})}}}onNewFrame(t){this.layersGotHidden=!1;for(const l of this.layers){const d=l.layer;let g=!1;d.type==="fill-extrusion"?g=!d.isHidden(t)&&d.paint.get("fill-extrusion-opacity")>0:d.type==="building"?g=!d.isHidden(t)&&d.paint.get("building-opacity")>0:d.type==="model"&&(g=!d.isHidden(t)&&d.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!g&&l.visible,l.visible=g}}updateZOffset(t,l){this.currentBuildingBuckets=[];for(const g of this.layers){const y=g.layer,x=this.style.getLayerSourceCache(y);let T=1;y.type==="fill-extrusion"?T=g.visible?y.paint.get("fill-extrusion-vertical-scale"):0:y.type==="building"&&(T=g.visible?y.paint.get("building-vertical-scale"):0);let E=x?x.getTile(l):null;if(!E&&x)for(const L in x._tiles){const P=x._tiles[L];if(l.canonical.isChildOf(P.tileID.canonical)){E=P;break}}this.currentBuildingBuckets.push({bucket:E?E.getBucket(y):null,tileID:E?E.tileID:l,verticalScale:T})}t.hasAnyZOffset=!1;let d=!1;for(let g=0;g<t.symbolInstances.length;g++){const y=t.symbolInstances.get(g),x=y.zOffset,T=this._getHeightAtTileOffset(l,y.tileAnchorX,y.tileAnchorY);y.zOffset=T!==Number.NEGATIVE_INFINITY?T:x,d||x===y.zOffset||(d=!0),t.hasAnyZOffset||y.zOffset===0||(t.hasAnyZOffset=!0)}d&&(t.zOffsetBuffersNeedUpload=!0,t.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,l,d,g){let y=l,x=d;if(t.canonical.z!==g.canonical.z){const T=g.canonical,E=1/(1<<t.canonical.z-T.z);y=(l+t.canonical.x*o.al)*E-T.x*o.al|0,x=(d+t.canonical.y*o.al)*E-T.y*o.al|0}return{tileX:y,tileY:x}}_getHeightAtTileOffset(t,l,d){let g,y;for(let x=0;x<this.layers.length;++x){const T=this.layers[x].layer;if(T.type!=="fill-extrusion"&&T.type!=="building")continue;const{bucket:E,tileID:L,verticalScale:P}=this.currentBuildingBuckets[x];if(!E)continue;const{tileX:z,tileY:O}=this._mapCoordToOverlappingTile(t,l,d,L),B=E.getHeightAtTileCoord(z,O);B&&B.height!==void 0&&(B.hidden?g=B.height:y=Math.max(B.height*P,y||0))}if(y!==void 0)return y;for(let x=0;x<this.layers.length;++x){const T=this.layers[x];if(T.layer.type!=="model"||!T.visible)continue;const{bucket:E,tileID:L}=this.currentBuildingBuckets[x];if(!E)continue;const{tileX:P,tileY:z}=this._mapCoordToOverlappingTile(t,l,d,L),O=E.getHeightAtTileCoord(P,z);if(O&&!O.hidden)return O.height===void 0&&g!==void 0?Math.min(O.maxHeight,g)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function a1(h,t){const l={};for(const d in h)d!=="ref"&&(l[d]=h[d]);return o.bx.forEach(d=>{d in t&&(l[d]=t[d])}),l}function Tp(h){h=h.slice();const t=Object.create(null);for(let l=0;l<h.length;l++)t[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=a1(h[l],t[h[l].ref]));return h}const Oi={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function vc(h,t,l){l.push({command:Oi.addSource,args:[h,t[h]]})}function nd(h,t,l){t.push({command:Oi.removeSource,args:[h]}),l[h]=!0}function q_(h,t,l,d){nd(h,l,d),vc(h,t,l)}function Z_(h,t,l){let d;for(d in h[l])if(h[l].hasOwnProperty(d)&&d!=="data"&&!o.by(h[l][d],t[l][d]))return!1;for(d in t[l])if(t[l].hasOwnProperty(d)&&d!=="data"&&!o.by(h[l][d],t[l][d]))return!1;return!0}function Fu(h,t,l,d,g,y){let x;for(x in t=t||{},h=h||{})h.hasOwnProperty(x)&&(o.by(h[x],t[x])||l.push({command:y,args:[d,x,t[x],g]}));for(x in t)t.hasOwnProperty(x)&&!h.hasOwnProperty(x)&&(o.by(h[x],t[x])||l.push({command:y,args:[d,x,t[x],g]}))}function il(h){return h.id}function ju(h,t){return h[t.id]=t,h}function sd(h,t,l){const d=t.createTileMatrix(h,h.worldSize,l.toUnwrapped());return o.aB(new Float32Array(16),h.projMatrix,d)}function l1(h,t,l){if(t.projection.name===l.projection.name)return h.projMatrix;const d=l.clone();return d.setProjection(t.projection),sd(d,t.getProjection(),h)}function xc(h,t,l){return t.name===l.projection.name?h.projMatrix:sd(l,t,h)}class Pa{constructor(t,l){this.reset(t,l)}reset(t,l){this.points=t||[],this._distances=[0];for(let d=1;d<this.points.length;d++)this._distances[d]=this._distances[d-1]+this.points[d].dist(this.points[d-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(this.points.length===1)return this.points[0];t=o.aA(t,0,1);let l=1,d=this._distances[l];const g=t*this.paddedLength+this.padding;for(;d<g&&l<this._distances.length;)d=this._distances[++l];const y=l-1,x=this._distances[y],T=d-x,E=T>0?(g-x)/T:0;return this.points[y].mult(1-E).add(this.points[l].mult(E))}}class Nu{constructor(t,l,d){const g=this.boxCells=[],y=this.circleCells=[];this.xCellCount=Math.ceil(t/d),this.yCellCount=Math.ceil(l/d);for(let x=0;x<this.xCellCount*this.yCellCount;x++)g.push([]),y.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=l,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,l,d,g,y){this._forEachCell(l,d,g,y,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(l),this.bboxes.push(d),this.bboxes.push(g),this.bboxes.push(y)}insertCircle(t,l,d,g){this._forEachCell(l-g,d-g,l+g,d+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(l),this.circles.push(d),this.circles.push(g)}_insertBoxCell(t,l,d,g,y,x){this.boxCells[y].push(x)}_insertCircleCell(t,l,d,g,y,x){this.circleCells[y].push(x)}_query(t,l,d,g,y,x){if(d<0||t>this.width||g<0||l>this.height)return!y&&[];const T=[];if(t<=0&&l<=0&&this.width<=d&&this.height<=g){if(y)return!0;for(let E=0;E<this.boxKeys.length;E++)T.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const L=this.circles[3*E],P=this.circles[3*E+1],z=this.circles[3*E+2];T.push({key:this.circleKeys[E],x1:L-z,y1:P-z,x2:L+z,y2:P+z})}return x?T.filter(x):T}return this._forEachCell(t,l,d,g,this._queryCell,T,{hitTest:y,seenUids:{box:{},circle:{}}},x),y?T.length>0:T}_queryCircle(t,l,d,g,y){const x=t-d,T=t+d,E=l-d,L=l+d;if(T<0||x>this.width||L<0||E>this.height)return!g&&[];const P=[];return this._forEachCell(x,E,T,L,this._queryCellCircle,P,{hitTest:g,circle:{x:t,y:l,radius:d},seenUids:{box:{},circle:{}}},y),g?P.length>0:P}query(t,l,d,g,y){return this._query(t,l,d,g,!1,y)}hitTest(t,l,d,g,y){return this._query(t,l,d,g,!0,y)}hitTestCircle(t,l,d,g){return this._queryCircle(t,l,d,!0,g)}_queryCell(t,l,d,g,y,x,T,E){const L=T.seenUids,P=this.boxCells[y];if(P!==null){const O=this.bboxes;for(const B of P)if(!L.box[B]){L.box[B]=!0;const G=4*B;if(t<=O[G+2]&&l<=O[G+3]&&d>=O[G+0]&&g>=O[G+1]&&(!E||E(this.boxKeys[B]))){if(T.hitTest)return x.push(!0),!0;x.push({key:this.boxKeys[B],x1:O[G],y1:O[G+1],x2:O[G+2],y2:O[G+3]})}}}const z=this.circleCells[y];if(z!==null){const O=this.circles;for(const B of z)if(!L.circle[B]){L.circle[B]=!0;const G=3*B;if(this._circleAndRectCollide(O[G],O[G+1],O[G+2],t,l,d,g)&&(!E||E(this.circleKeys[B]))){if(T.hitTest)return x.push(!0),!0;{const V=O[G],W=O[G+1],Y=O[G+2];x.push({key:this.circleKeys[B],x1:V-Y,y1:W-Y,x2:V+Y,y2:W+Y})}}}}}_queryCellCircle(t,l,d,g,y,x,T,E){const L=T.circle,P=T.seenUids,z=this.boxCells[y];if(z!==null){const B=this.bboxes;for(const G of z)if(!P.box[G]){P.box[G]=!0;const V=4*G;if(this._circleAndRectCollide(L.x,L.y,L.radius,B[V+0],B[V+1],B[V+2],B[V+3])&&(!E||E(this.boxKeys[G])))return x.push(!0),!0}}const O=this.circleCells[y];if(O!==null){const B=this.circles;for(const G of O)if(!P.circle[G]){P.circle[G]=!0;const V=3*G;if(this._circlesCollide(B[V],B[V+1],B[V+2],L.x,L.y,L.radius)&&(!E||E(this.circleKeys[G])))return x.push(!0),!0}}}_forEachCell(t,l,d,g,y,x,T,E){const L=this._convertToXCellCoord(t),P=this._convertToYCellCoord(l),z=this._convertToXCellCoord(d),O=this._convertToYCellCoord(g);for(let B=L;B<=z;B++)for(let G=P;G<=O;G++)if(y.call(this,t,l,d,g,this.xCellCount*G+B,x,T,E))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,l,d,g,y,x){const T=g-t,E=y-l,L=d+x;return L*L>T*T+E*E}_circleAndRectCollide(t,l,d,g,y,x,T){const E=(x-g)/2,L=Math.abs(t-(g+E));if(L>E+d)return!1;const P=(T-y)/2,z=Math.abs(l-(y+P));if(z>P+d)return!1;if(L<=E||z<=P)return!0;const O=L-E,B=z-P;return O*O+B*B<=d*d}}const X_=Math.tan(85*Math.PI/180);function Dl(h,t,l,d,g,y,x){const T=o.bC();if(l)if(y.name==="globe"){const E=o.bD(g,t);o.aB(T,T,E)}else{const E=o.bE([],x);T[0]=E[0],T[1]=E[1],T[4]=E[2],T[5]=E[3],d||o.bB(T,T,g.angle)}else o.aB(T,g.labelPlaneMatrix,h);return T}function Ma(h,t,l,d,g,y,x){const T=Dl(h,t,l,d,g,y,x);return y.name==="globe"&&l||(T[2]=T[6]=T[10]=T[14]=0),T}function _s(h,t,l,d,g,y,x){if(l){if(y.name==="globe"){const T=Dl(h,t,l,d,g,y,x);return o.bl(T,T),o.aB(T,h,T),T}{const T=o.bz(h),E=o.bA([]);return E[0]=x[0],E[1]=x[1],E[4]=x[2],E[5]=x[3],o.aB(T,T,E),d||o.bB(T,T,-g.angle),T}}return g.glCoordMatrix}function vo(h,t,l,d){const g=[h,t,l,1];l?o.aC(g,g,d):ad(g,g,d);const y=g[3];return g[0]/=y,g[1]/=y,g[2]/=y,g}function od(h,t){return Math.min(.5+h/t*.5,1.5)}function K_(h,t){const l=h[0]/h[3],d=h[1]/h[3];return l>=-t[0]&&l<=t[0]&&d>=-t[1]&&d<=t[1]}function Hi(h,t,l,d,g,y,x,T,E,L,P=1){const z=l.transform,O=d?h.textSizeData:h.iconSizeData,B=o.bK(O,l.transform.zoom,P),G=z.projection.name==="globe",V=[256/l.width*2+1,256/l.height*2+1],W=d?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;W.clear();let Y=null;G&&(Y=d?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const se=h.lineVertexArray,ne=d?h.text.placedSymbolArray:h.icon.placedSymbolArray,te=l.transform.width/l.transform.height;let we,_e=!1;for(let be=0;be<ne.length;be++){const de=ne.get(be),{numGlyphs:le,writingMode:Te}=de;if(Te!==o.bL.vertical||_e||we===o.bL.horizontal||(_e=!0),we=Te,(de.hidden||Te===o.bL.vertical)&&!_e){rs(le,W);continue}_e=!1;const Me=new o.P(de.tileAnchorX,de.tileAnchorY),Oe=h.elevationType==="road",Ve=!!z.elevation||Oe;let{x:je,y:Ye,z:nt}=z.projection.projectTilePoint(Me.x,Me.y,L.canonical),Fe=null;if(Ve){const kt=Oe?h.getElevationFeatureForText(be):null;Fe={getElevation:E,elevation:z.elevation,elevationFeature:kt};const[jt,Xt,ci]=E(Me,z.elevation,kt);je+=jt,Ye+=Xt,nt+=ci}const Ie=[je,Ye,nt,1];if(o.aC(Ie,Ie,t),!K_(Ie,V)){rs(le,W);continue}const Xe=Ie[3],$e=od(l.transform.getCameraToCenterDistance(z.projection),Xe),ot=o.bM(O,B,de),ht=x?ot/$e:ot*$e,yt=vo(je,Ye,nt,g);if(yt[3]<=0){rs(le,W);continue}let dt={};const pt=o.an(h.layers[0].layout.get("text-max-angle")),Mt=Math.cos(pt),Lt=x?null:Fe,bt=J_(de,ht,!1,T,t,g,y,h.glyphOffsetArray,se,W,Y,yt,Me,dt,te,Lt,z.projection,L,x,Mt);_e=bt.useVertical,Lt&&bt.needsFlipping&&(dt={}),(bt.notEnoughRoom||_e||bt.needsFlipping&&J_(de,ht,!0,T,t,g,y,h.glyphOffsetArray,se,W,Y,yt,Me,dt,te,Lt,z.projection,L,x,Mt).notEnoughRoom)&&rs(le,W)}d?(h.text.dynamicLayoutVertexBuffer.updateData(W),Y&&h.text.globeExtVertexBuffer&&h.text.globeExtVertexBuffer.updateData(Y)):(h.icon.dynamicLayoutVertexBuffer.updateData(W),Y&&h.icon.globeExtVertexBuffer&&h.icon.globeExtVertexBuffer.updateData(Y))}function Ep(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W){const{lineStartIndex:Y,glyphStartIndex:se,segment:ne}=T,te=se+T.numGlyphs,we=Y+T.lineLength,_e=t.getoffsetX(se),be=t.getoffsetX(te-1),de=Ol(h*_e,l,d,g,y,x,ne,Y,we,E,L,P,z,O,!0,B,G,V,W);if(!de)return null;const le=Ol(h*be,l,d,g,y,x,ne,Y,we,E,L,P,z,O,!0,B,G,V,W);return le?{first:de,last:le}:null}function Y_(h,t,l,d){return h===o.bL.horizontal&&Math.abs(d)>Math.abs(l)?{useVertical:!0}:h===o.bL.vertical?d>0?{needsFlipping:!0}:null:t!==0&&function(g,y){return g===0||Math.abs(y/g)>X_}(l,d)?t===1?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null}function J_(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se,ne){const te=t/24,we=h.lineOffsetX*te,_e=h.lineOffsetY*te,{lineStartIndex:be,glyphStartIndex:de,numGlyphs:le,segment:Te,writingMode:Me,flipState:Oe}=h,Ve=be+h.lineLength,je=Ye=>{if(P){const[Xe,$e,ot]=Ye.up,ht=L.length;o.bN(P,ht+0,Xe,$e,ot),o.bN(P,ht+1,Xe,$e,ot),o.bN(P,ht+2,Xe,$e,ot),o.bN(P,ht+3,Xe,$e,ot)}const[nt,Fe,Ie]=Ye.point;o.bO(L,nt,Fe,Ie,Ye.angle)};if(le>1){const Ye=Ep(te,T,we,_e,l,z,O,h,E,y,B,V,!1,W,Y,se,ne);if(!Ye)return{notEnoughRoom:!0};if(d&&!l){let[nt,Fe,Ie]=Ye.first.point,[Xe,$e,ot]=Ye.last.point;[nt,Fe]=vo(nt,Fe,Ie,x),[Xe,$e]=vo(Xe,$e,ot,x);const ht=Y_(Me,Oe,(Xe-nt)*G,$e-Fe);if(h.flipState=ht&&ht.needsFlipping?1:2,ht)return ht}je(Ye.first);for(let nt=de+1;nt<de+le-1;nt++){const Fe=Ol(te*T.getoffsetX(nt),we,_e,l,z,O,Te,be,Ve,E,y,B,V,!1,!1,W,Y,se,ne);if(!Fe)return L.length-=4*(nt-de),{notEnoughRoom:!0};je(Fe)}je(Ye.last)}else{if(d&&!l){const nt=vo(O.x,O.y,0,g),Fe=be+Te+1,Ie=new o.P(E.getx(Fe),E.gety(Fe)),Xe=vo(Ie.x,Ie.y,0,g),$e=Xe[3]>0?Xe:Ip(O,Ie,nt,1,g,void 0,W,Y.canonical),ot=Y_(Me,Oe,($e[0]-nt[0])*G,$e[1]-nt[1]);if(h.flipState=ot&&ot.needsFlipping?1:2,ot)return ot}const Ye=Ol(te*T.getoffsetX(de),we,_e,l,z,O,Te,be,Ve,E,y,B,V,!1,!1,W,Y,se,ne);if(!Ye)return{notEnoughRoom:!0};je(Ye)}return{}}function qt(h,t,l,d,g){const{x:y,y:x,z:T}=d.projectTilePoint(h.x,h.y,t);if(!g)return vo(y,x,T,l);const[E,L,P]=g.getElevation(h,g.elevation,g.elevationFeature);return vo(y+E,x+L,T+P,l)}function Ip(h,t,l,d,g,y,x,T){const E=qt(h.sub(t)._unit()._add(h),T,g,x,y);return o.av(E,l,E),o.aw(E,E),o.bH(E,l,E,d)}function Ol(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se){const ne=d?h-t:h+t;let te=ne>0?1:-1,we=0;d&&(te*=-1,we=Math.PI),te<0&&(we+=Math.PI);let _e=T+x+(te>0?0:1)|0,be=g,de=g,le=0,Te=0;const Me=Math.abs(ne),Oe=[],Ve=[];let je=y,Ye=je,nt=o.bF([]);const Fe=()=>Ip(Ye,je,de,Me-le+1,P,O,V,W.canonical);for(;le+Te<=Me;){if(_e+=te,_e<T||_e>=E)return null;if(de=be,Ye=je,Oe.push(de),B&&Ve.push(Ye),je=new o.P(L.getx(_e),L.gety(_e)),be=z[_e],!be){const Lt=qt(je,W.canonical,P,V,O);be=Lt[3]>0?z[_e]=Lt:Fe()}le+=Te;const pt=o.av([],be,de),Mt=o.bG(de,be);if(l&&Mt>0&&Te>0&&o.bJ(nt,pt)/(Te*Mt)<se)return null;Te=Mt,nt=pt}G&&O&&(z[_e]&&(be=Fe(),Te=o.bG(de,be),nt=o.av([],be,de)),z[_e]=be);const Ie=(Me-le)/Te,Xe=je.sub(Ye)._mult(Ie)._add(Ye),$e=o.bH([],de,nt,Ie);let ot=[0,0,1],ht=nt[0],yt=nt[1];if(Y&&(ot=V.upVector(W.canonical,Xe.x,Xe.y),ot[0]!==0||ot[1]!==0||ot[2]!==1)){const pt=[ot[2],0,-ot[0]],Mt=o.bI([],ot,pt);o.aw(pt,pt),o.aw(Mt,Mt),ht=o.bJ(nt,pt),yt=o.bJ(nt,Mt)}if(l){const pt=o.bI([],ot,nt);o.aw(pt,pt),o.bH($e,$e,pt,l*te)}const dt=we+Math.atan2(yt,ht);return Oe.push($e),B&&Ve.push(Xe),{point:$e,angle:dt,path:Oe,tilePath:Ve,up:ot}}function rs(h,t){const l=t.length,d=l+4*h;t.resize(d),t.float32.fill(-1/0,4*l,4*d)}function ad(h,t,l){const d=t[0],g=t[1];return h[0]=l[0]*d+l[4]*g+l[12],h[1]=l[1]*d+l[5]*g+l[13],h[3]=l[3]*d+l[7]*g+l[15],h}const ys=100;class Bt{constructor(t,l,d=new Nu(t.width+200,t.height+200,25),g=new Nu(t.width+200,t.height+200,25)){this.transform=t,this.grid=d,this.ignoredGrid=g,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+ys,this.screenBottomBoundary=t.height+ys,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=l}placeCollisionBox(t,l,d,g,y,x,T,E,L,P,z){let O=d.projectedAnchorX,B=d.projectedAnchorY,G=d.projectedAnchorZ;const V=d.tileAnchorX,W=d.tileAnchorY,Y=d.elevation,se=d.tileID,ne=t.getProjection();if(Y&&se){const[Ve,je,Ye]=ne.upVector(se.canonical,d.tileAnchorX,d.tileAnchorY),nt=ne.upVectorScale(se.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=Ve*Y*nt,B+=je*Y*nt,G+=Ye*Y*nt}const te=t.projection.name==="globe",we=t.projection.name==="globe"?o.aj(this.transform.zoom):0;if(se&&te&&we<1&&!x){const Ve=1<<se.canonical.z,je=o.bP(V,W);o.bQ(je,je,1/o.al),o.bR(je,je,o.bP(se.canonical.x,se.canonical.y)),o.bQ(je,je,1/Ve),o.bS(je,je,o.bP(g[0],g[1])),je[0]=o.bT(je[0],-.5,.5),o.bQ(je,je,o.al);const Ye=o.bU(je[0],je[1],o.al/(2*Math.PI),1);o.aC(Ye,Ye,y),O=o.ak(O,Ye[0],we),B=o.ak(B,Ye[1],we),G=o.ak(G,Ye[2],we)}const _e=this.projectAndGetPerspectiveRatio(P,O,B,G,d.tileID,ne.name==="globe"||!!Y||this.transform.pitch>0,ne),be=L*_e.perspectiveRatio,de=(d.x1*l+T.x-d.padding)*be+_e.point.x,le=(d.y1*l+T.y-d.padding)*be+_e.point.y,Te=(d.x2*l+T.x+d.padding)*be+_e.point.x,Me=(d.y2*l+T.y+d.padding)*be+_e.point.y,Oe=_e.perspectiveRatio<=.55||_e.occluded;return!this.isInsideGrid(de,le,Te,Me)||!E&&this.grid.hitTest(de,le,Te,Me,z)||Oe?{box:[],offscreen:!1,occluded:_e.occluded}:{box:[de,le,Te,Me],offscreen:this.isOffscreen(de,le,Te,Me),occluded:!1}}placeCollisionCircles(t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W){const Y=[],se=this.transform.elevation,ne=t.getProjection(),te=t.elevationType==="road",we=!!se||te,_e=o.bV.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ne),be=new o.P(d.tileAnchorX,d.tileAnchorY),de=new o.P(d.tileAnchorX,d.tileAnchorY);let{x:le,y:Te,z:Me}=ne.projectTilePoint(de.x,de.y,W.canonical),Oe=null;if(we){const Mt=te?t.getElevationFeatureForText(g):null;Oe={getElevation:_e,elevation:se,elevationFeature:Mt};const[Lt,bt,kt]=_e(be,se,Mt);le+=Lt,Te+=bt,Me+=kt}const Ve=ne.name==="globe",je=this.projectAndGetPerspectiveRatio(E,le,Te,Me,W,Ve||!!se||this.transform.pitch>0,ne),{perspectiveRatio:Ye}=je,nt=(O?T/Ye:T*Ye)/o.bY,Fe=vo(le,Te,Me,L),Ie=d.lineOffsetX*nt,Xe=d.lineOffsetY*nt,$e=o.an(t.layers[0].layout.get("text-max-angle")),ot=Math.cos($e),ht=je.signedDistanceFromCamera>0?Ep(nt,x,Ie,Xe,te&&d.flipState===1,Fe,de,d,y,L,{},we&&!O?Oe:null,O&&we,ne,W,O,ot):null;let yt=!1,dt=!1,pt=!0;if(ht&&!je.occluded){const Mt=.5*G*Ye+V,Lt=new o.P(-100,-100),bt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),kt=new Pa,{first:jt,last:Xt}=ht,ci=jt.path.length;let Ti=[];for(let ni=ci-1;ni>=1;ni--)Ti.push(jt.path[ni]);for(let ni=1;ni<Xt.path.length;ni++)Ti.push(Xt.path[ni]);const ii=2.5*Mt;P&&(Ti=Ti.map(([ni,Zi,Wi],Ki)=>(we&&!Ve&&(Wi=_e(Ki<ci-1?jt.tilePath[ci-1-Ki]:Xt.tilePath[Ki-ci+2],se,Oe.elevationFeature)[2]),vo(ni,Zi,Wi,P))),Ti.some(ni=>ni[3]<=0)&&(Ti=[]));let Mi=[];if(Ti.length>0){let ni=1/0,Zi=-1/0,Wi=1/0,Ki=-1/0;for(const Ii of Ti)ni=Math.min(ni,Ii[0]),Wi=Math.min(Wi,Ii[1]),Zi=Math.max(Zi,Ii[0]),Ki=Math.max(Ki,Ii[1]);Zi>=Lt.x&&ni<=bt.x&&Ki>=Lt.y&&Wi<=bt.y&&(Mi=[Ti.map(Ii=>new o.P(Ii[0],Ii[1]))],(ni<Lt.x||Zi>bt.x||Wi<Lt.y||Ki>bt.y)&&(Mi=o.bW(Mi,Lt.x,Lt.y,bt.x,bt.y)))}for(const ni of Mi){kt.reset(ni,.25*Mt);let Zi=0;Zi=kt.length<=.5*Mt?1:Math.ceil(kt.paddedLength/ii)+1;for(let Wi=0;Wi<Zi;Wi++){const Ki=Wi/Math.max(Zi-1,1),Ii=kt.lerp(Ki),ai=Ii.x+ys,ji=Ii.y+ys;Y.push(ai,ji,Mt,0);const br=ai-Mt,wr=ji-Mt,Ni=ai+Mt,xi=ji+Mt;if(pt=pt&&this.isOffscreen(br,wr,Ni,xi),dt=dt||this.isInsideGrid(br,wr,Ni,xi),!l&&this.grid.hitTestCircle(ai,ji,Mt,B)&&(yt=!0,!z))return{circles:[],offscreen:!1,collisionDetected:yt,occluded:!1}}}}return{circles:!z&&yt||!dt?[]:Y,offscreen:pt,collisionDetected:yt,occluded:je.occluded}}queryRenderedSymbols(t){if(t.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const l=[];let d=1/0,g=1/0,y=-1/0,x=-1/0;for(const P of t){const z=new o.P(P.x+ys,P.y+ys);d=Math.min(d,z.x),g=Math.min(g,z.y),y=Math.max(y,z.x),x=Math.max(x,z.y),l.push(z)}const T=this.grid.query(d,g,y,x).concat(this.ignoredGrid.query(d,g,y,x)),E={},L={};for(const P of T){const z=P.key;if(E[z.bucketInstanceId]===void 0&&(E[z.bucketInstanceId]={}),E[z.bucketInstanceId][z.featureIndex])continue;const O=[new o.P(P.x1,P.y1),new o.P(P.x2,P.y1),new o.P(P.x2,P.y2),new o.P(P.x1,P.y2)];o.bX(l,O)&&(E[z.bucketInstanceId][z.featureIndex]=!0,L[z.bucketInstanceId]===void 0&&(L[z.bucketInstanceId]=[]),L[z.bucketInstanceId].push(z.featureIndex))}return L}insertCollisionBox(t,l,d,g,y){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:d,featureIndex:g,collisionGroupID:y},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,l,d,g,y){const x=l?this.ignoredGrid:this.grid,T={bucketInstanceId:d,featureIndex:g,collisionGroupID:y};for(let E=0;E<t.length;E+=4)x.insertCircle(T,t[E],t[E+1],t[E+2])}projectAndGetPerspectiveRatio(t,l,d,g,y,x,T){const E=[l,d,g,1];let L=!1;g||this.transform.pitch>0?(o.aC(E,E,t),this.fogState&&y&&T.name!=="globe"&&(L=function(O,B,G,V,W,Y){const se=Y.calculateFogTileMatrix(W),ne=[B,G,V];return o.af(ne,ne,se),Nt(O,o.ag(ne),Y.pitch,Y._fov)}(this.fogState,l,d,g,y.toUnwrapped(),this.transform)>.9)):ad(E,E,t);const P=E[3];return{point:new o.P((E[0]/P+1)/2*this.transform.width+ys,(-E[1]/P+1)/2*this.transform.height+ys),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(T)/P*.5,1.5),signedDistanceFromCamera:P,occluded:x&&E[2]>P||L}}isOffscreen(t,l,d,g){return d<ys||t>=this.screenRightBoundary||g<ys||l>this.screenBottomBoundary}isInsideGrid(t,l,d,g){return d>=0&&t<this.gridRightBoundary&&g>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const t=o.bA([]);return o.br(t,t,[-100,-100,0]),t}}class $i{constructor(t,l,d,g){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?l:-l))):g&&d?1:0,this.placed=d}isHidden(){return this.opacity===0&&!this.placed}}class zi{constructor(t,l,d,g,y,x=!1){this.text=new $i(t?t.text:null,l,d,y),this.icon=new $i(t?t.icon:null,l,g,y),this.clipped=x}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ns{constructor(t,l,d,g=!1){this.text=t,this.icon=l,this.skipFade=d,this.clipped=g}}class bc{constructor(){this.invProjMatrix=o.bC(),this.viewportMatrix=o.bC(),this.circles=[]}}class qi{constructor(t,l,d,g,y){this.bucketInstanceId=t,this.featureIndex=l,this.sourceLayerIndex=d,this.bucketIndex=g,this.tileID=y}}class ld{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const l=++this.maxGroupID;this.collisionGroups[t]={ID:l,predicate:d=>d.collisionGroupID===l}}return this.collisionGroups[t]}}function wc(h,t,l,d,g){const{horizontalAlign:y,verticalAlign:x}=o.c1(h),T=-(y-.5)*t,E=-(x-.5)*l,L=o.c2(h,d);return new o.P(T+L[0]*g,E+L[1]*g)}function zl(h,t,l,d,g){const y=new o.P(h,t);return l&&y._rotate(d?g:-g),y}class Hn{constructor(t,l,d,g,y,x){this.transform=t.clone(),this.projection=t.projection.name,this.collisionIndex=new Bt(this.transform,y),this.buildingIndex=x,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new ld(d),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,l,d,g,y=1){const x=d.getBucket(l),T=d.latestFeatureIndex;if(!x||!T||l.fqid!==x.layerIds[0])return;const E=x.layers[0].layout,L=x.layers[0].paint,P=d.collisionBoxArray,z=Math.pow(2,this.transform.zoom-d.tileID.overscaledZ),O=d.tileSize/o.al,B=d.tileID.toUnwrapped();this.transform.setProjection(x.projection);const G=(V=d.tileID,W=x.getProjection(),Y=this.transform,W.name===this.projection?Y.calculateProjMatrix(V.toUnwrapped()):sd(Y,W,V));var V,W,Y;const se=E.get("text-pitch-alignment")==="map",ne=E.get("text-rotation-alignment")==="map";l.compileFilter(l.options);const te=l.dynamicFilter(),we=l.dynamicFilterNeedsFeature(),_e=this.transform.calculatePixelsToTileUnitsMatrix(d),be=Ma(G,d.tileID.canonical,se,ne,this.transform,x.getProjection(),_e);let de=null;const le=x.getProjection().createInversionMatrix(this.transform,d.tileID.canonical);if(se){const Ie=_s(G,d.tileID.canonical,se,ne,this.transform,x.getProjection(),_e);de=o.aB([],this.transform.labelPlaneMatrix,Ie)}let Te=null;te&&d.latestFeatureIndex&&(Te={unwrappedTileID:B,dynamicFilter:te,dynamicFilterNeedsFeature:we}),this.retainedQueryData[x.bucketInstanceId]=new qi(x.bucketInstanceId,T,x.sourceLayerIndex,x.index,d.tileID);const[Me,Oe]=x.layers[0].layout.get("text-size-scale-range"),Ve=o.aA(y,Me,Oe),[je,Ye]=E.get("icon-size-scale-range"),nt=o.aA(y,je,Ye),Fe={bucket:x,layout:E,paint:L,posMatrix:G,invMatrix:le,mercatorCenter:[o.aF(this.transform.center.lng),o.aJ(this.transform.center.lat)],textLabelPlaneMatrix:be,labelToScreenMatrix:de,clippingData:Te,scale:z,textPixelRatio:O,holdingForFade:d.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:o.bK(x.textSizeData,this.transform.zoom,Ve),partiallyEvaluatedIconSize:o.bK(x.iconSizeData,this.transform.zoom,nt),collisionGroup:this.collisionGroups.get(x.sourceID),latestFeatureIndex:d.latestFeatureIndex};if(g)for(const Ie of x.sortKeyRanges){const{sortKey:Xe,symbolInstanceStart:$e,symbolInstanceEnd:ot}=Ie;t.push({sortKey:Xe,symbolInstanceStart:$e,symbolInstanceEnd:ot,parameters:Fe})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:Fe})}attemptAnchorPlacement(t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se,ne,te,we){const{textOffset0:_e,textOffset1:be,crossTileID:de}=V,le=[_e,be],Te=wc(t,x,T,le,E),Me=this.collisionIndex.placeCollisionBox(Y,E,l,d,g,y,zl(Te.x,Te.y,L,P,this.transform.angle),G,z,O,B.predicate);if(ne){const Oe=Y.getSymbolInstanceIconSize(we,this.transform.zoom,V.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(Y,Oe,ne,d,g,y,zl(Te.x,Te.y,L,P,this.transform.angle),G,z,O,B.predicate).box.length===0)return}if(Me.box.length>0){let Oe;return this.prevPlacement&&this.prevPlacement.variableOffsets[de]&&this.prevPlacement.placements[de]&&this.prevPlacement.placements[de].text&&(Oe=this.prevPlacement.variableOffsets[de].anchor),this.variableOffsets[de]={textOffset:le,width:x,height:T,anchor:t,textScale:E,prevAnchor:Oe},this.markUsedJustification(Y,t,V,se),Y.allowVerticalPlacement&&(this.markUsedOrientation(Y,se,V),this.placedOrientations[de]=se),{shift:Te,placedGlyphBoxes:Me}}}placeLayerBucketPart(t,l,d,g,y=1){const{bucket:x,layout:T,paint:E,posMatrix:L,textLabelPlaneMatrix:P,labelToScreenMatrix:z,clippingData:O,textPixelRatio:B,mercatorCenter:G,invMatrix:V,holdingForFade:W,collisionBoxArray:Y,partiallyEvaluatedTextSize:se,partiallyEvaluatedIconSize:ne,collisionGroup:te,latestFeatureIndex:we}=t.parameters,_e=T.get("text-optional"),be=T.get("icon-optional"),de=T.get("text-allow-overlap"),le=T.get("icon-allow-overlap"),Te=T.get("text-rotation-alignment")==="map",Me=T.get("icon-rotation-alignment")==="map",Oe=T.get("text-pitch-alignment")==="map",Ve=E.get("symbol-z-offset"),je=T.get("symbol-elevation-reference")==="sea",Ye=T.get("symbol-placement"),[nt,Fe]=T.get("text-size-scale-range"),[Ie,Xe]=T.get("icon-size-scale-range"),$e=o.aA(y,nt,Fe),ot=o.aA(y,Ie,Xe),ht=T.get("text-variable-anchor"),yt=Te&&Ye!=="point",dt=Me&&Ye!=="point",pt=ht&&x.hasTextData(),Mt=x.hasIconTextFit()&&pt&&x.hasIconData();this.transform.setProjection(x.projection);const Lt=pt||yt,bt=dt||Mt;let kt=de&&(le||!x.hasIconData()||be),jt=le&&(de||!x.hasTextData()||_e);const Xt=!Ve.isConstant();!x.collisionArrays&&Y&&x.deserializeCollisionBoxes(Y),d&&g&&x.updateCollisionDebugBuffers(this.transform.zoom,Y,$e,ot);const ci=(ii,Mi,ni)=>{const{crossTileID:Zi,numVerticalGlyphVertices:Wi}=ii;let Ki=null;if(O&&O.dynamicFilterNeedsFeature||Xt){const Tr=this.retainedQueryData[x.bucketInstanceId];Ki=we.loadFeature({featureIndex:ii.featureIndex,bucketIndex:Tr.bucketIndex,sourceLayerIndex:Tr.sourceLayerIndex,layoutVertexArrayOffset:0});const Ur=Ki.properties?Ki.properties.worldview:null;if(x.localizable&&x.worldview&&typeof Ur=="string")if(Ur==="all")Ki.properties.$localized=!0;else{if(!Ur.split(",").includes(x.worldview))return;Ki.properties.$localized=!0,Ki.properties.worldview=x.worldview}}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:x.worldview},Ki,this.retainedQueryData[x.bucketInstanceId].tileID.canonical,new o.P(ii.tileAnchorX,ii.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Zi]=new ns(!1,!1,!1,!0),void l.add(Zi);const Ii=Ve.evaluate(Ki,{});if(l.has(Zi))return;if(W)return void(this.placements[Zi]=new ns(!1,!1,!1));let ai=!1,ji=!1,br=!0,wr=!1,Ni=!1,xi=null,li={box:null,offscreen:null,occluded:null},nr={box:null},kr=null,cr=null,dr=null,ls=0,Ss=0,fn=0;ni.textFeatureIndex?ls=ni.textFeatureIndex:ii.useRuntimeCollisionCircles&&(ls=ii.featureIndex),ni.verticalTextFeatureIndex&&(Ss=ni.verticalTextFeatureIndex);const Ui=x.elevationFeatures?x.elevationFeatures[ii.elevationFeatureIndex]:void 0,Bs=Tr=>{Tr.tileID=this.retainedQueryData[x.bucketInstanceId].tileID;const Ur=this.transform.elevation;Tr.elevation=je?Ii:Ii+o.bV.getAtTileOffset(Tr.tileID,new o.P(Tr.tileAnchorX,Tr.tileAnchorY),Ur,Ui),Tr.elevation+=ii.zOffset},Dn=ni.textBox;if(Dn){Bs(Dn);const Tr=ur=>{let Hr=o.bL.horizontal;if(x.allowVerticalPlacement&&!ur&&this.prevPlacement){const Fn=this.prevPlacement.placedOrientations[Zi];Fn&&(this.placedOrientations[Zi]=Fn,Hr=Fn,this.markUsedOrientation(x,Hr,ii))}return Hr},Ur=(ur,Hr)=>{if(x.allowVerticalPlacement&&Wi>0&&ni.verticalTextBox){for(const Fn of x.writingModes)if(Fn===o.bL.vertical?(li=Hr(),nr=li):li=ur(),li&&li.box&&li.box.length)break}else li=ur()};if(ht){let ur=ht;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Zi]){const Br=this.prevPlacement.variableOffsets[Zi];ur.indexOf(Br.anchor)>0&&(ur=ur.filter(Fs=>Fs!==Br.anchor),ur.unshift(Br.anchor))}const Hr=(Br,Fs,xh)=>{const da=x.getSymbolInstanceTextSize(se,ii,this.transform.zoom,Mi),Wc=(Br.x2-Br.x1)*da+2*Br.padding,qc=(Br.y2-Br.y1)*da+2*Br.padding,js=ii.hasIconTextFit&&!le?Fs:null;js&&Bs(js);let fa={box:[],offscreen:!1,occluded:!1};const pa=de?2*ur.length:ur.length;for(let io=0;io<pa;++io){const ja=this.attemptAnchorPlacement(ur[io%ur.length],Br,G,V,Lt,Wc,qc,da,Te,Oe,B,L,te,io>=ur.length,ii,Mi,x,xh,js,se,ne);if(ja&&(fa=ja.placedGlyphBoxes,fa&&fa.box&&fa.box.length)){ai=!0,xi=ja.shift;break}}return fa};Ur(()=>Hr(Dn,ni.iconBox,o.bL.horizontal),()=>{const Br=ni.verticalTextBox;return Br&&Bs(Br),x.allowVerticalPlacement&&!(li&&li.box&&li.box.length)&&Wi>0&&Br?Hr(Br,ni.verticalIconBox,o.bL.vertical):{box:null,offscreen:null,occluded:null}}),li&&(ai=li.box,br=li.offscreen,wr=li.occluded);const Fn=Tr(!(!li||!li.box));if(!ai&&this.prevPlacement){const Br=this.prevPlacement.variableOffsets[Zi];Br&&(this.variableOffsets[Zi]=Br,this.markUsedJustification(x,Br.anchor,ii,Fn))}}else{const ur=(Hr,Fn)=>{const Br=x.getSymbolInstanceTextSize(se,ii,this.transform.zoom,Mi),Fs=this.collisionIndex.placeCollisionBox(x,Br,Hr,G,V,Lt,new o.P(0,0),de,B,L,te.predicate);return Fs&&Fs.box&&Fs.box.length&&(this.markUsedOrientation(x,Fn,ii),this.placedOrientations[Zi]=Fn),Fs};Ur(()=>ur(Dn,o.bL.horizontal),()=>{const Hr=ni.verticalTextBox;return x.allowVerticalPlacement&&Wi>0&&Hr?(Bs(Hr),ur(Hr,o.bL.vertical)):{box:null,offscreen:null,occluded:null}}),Tr(!!(li&&li.box&&li.box.length))}}if(kr=li,ai=kr&&kr.box&&kr.box.length>0,br=kr&&kr.offscreen,wr=kr&&kr.occluded,ii.useRuntimeCollisionCircles){const Tr=ii.centerJustifiedTextSymbolIndex>=0?ii.centerJustifiedTextSymbolIndex:ii.verticalPlacedTextSymbolIndex,Ur=x.text.placedSymbolArray.get(Tr),ur=o.bM(x.textSizeData,se,Ur),Hr=T.get("text-padding");cr=this.collisionIndex.placeCollisionCircles(x,de,Ur,Tr,x.lineVertexArray,x.glyphOffsetArray,ur,L,P,z,d,Oe,te.predicate,ii.collisionCircleDiameter*ur/o.bY,Hr,this.retainedQueryData[x.bucketInstanceId].tileID),ai=de||cr.circles.length>0&&!cr.collisionDetected,br=br&&cr.offscreen,wr=cr.occluded}if(ni.iconFeatureIndex&&(fn=ni.iconFeatureIndex),ni.iconBox){const Tr=Ur=>{Bs(Ur);const ur=ii.hasIconTextFit&&xi?zl(xi.x,xi.y,Te,Oe,this.transform.angle):new o.P(0,0),Hr=x.getSymbolInstanceIconSize(ne,this.transform.zoom,ii.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(x,Hr,Ur,G,V,bt,ur,le,B,L,te.predicate)};nr&&nr.box&&nr.box.length&&ni.verticalIconBox?(dr=Tr(ni.verticalIconBox),ji=dr.box.length>0):(dr=Tr(ni.iconBox),ji=dr.box.length>0),br=br&&dr.offscreen,Ni=dr.occluded}const cs=_e||ii.numHorizontalGlyphVertices===0&&Wi===0,So=be||ii.numIconVertices===0;if(cs||So?So?cs||(ji=ji&&ai):ai=ji&&ai:ji=ai=ji&&ai,ai&&kr&&kr.box&&this.collisionIndex.insertCollisionBox(kr.box,T.get("text-ignore-placement"),x.bucketInstanceId,nr&&nr.box&&Ss?Ss:ls,te.ID),ji&&dr&&this.collisionIndex.insertCollisionBox(dr.box,T.get("icon-ignore-placement"),x.bucketInstanceId,fn,te.ID),cr&&(ai&&this.collisionIndex.insertCollisionCircles(cr.circles,T.get("text-ignore-placement"),x.bucketInstanceId,ls,te.ID),d)){const Tr=x.bucketInstanceId;let Ur=this.collisionCircleArrays[Tr];Ur===void 0&&(Ur=this.collisionCircleArrays[Tr]=new bc);for(let ur=0;ur<cr.circles.length;ur+=4)Ur.circles.push(cr.circles[ur+0]),Ur.circles.push(cr.circles[ur+1]),Ur.circles.push(cr.circles[ur+2]),Ur.circles.push(cr.collisionDetected?1:0)}const us=x.projection.name!=="globe";kt=kt&&(us||!wr),jt=jt&&(us||!Ni),this.placements[Zi]=new ns(ai||kt,ji||jt,br||x.justReloaded),l.add(Zi)},Ti=this.retainedQueryData[x.bucketInstanceId].tileID;if(x.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(x,Ti),x.elevationType==="road"&&x.updateRoadElevation(Ti.canonical),x.updateZOffset(),x.sortFeaturesByY){const ii=x.getSortedSymbolIndexes(this.transform.angle);for(let Mi=ii.length-1;Mi>=0;--Mi){const ni=ii[Mi];ci(x.symbolInstances.get(ni),ni,x.collisionArrays[ni])}x.hasAnyZOffset&&o.w(`${x.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(x.hasAnyZOffset){const ii=x.getSortedIndexesByZOffset();for(let Mi=0;Mi<ii.length;++Mi){const ni=ii[Mi];ci(x.symbolInstances.get(ni),ni,x.collisionArrays[ni])}}else for(let ii=t.symbolInstanceStart;ii<t.symbolInstanceEnd;ii++)ci(x.symbolInstances.get(ii),ii,x.collisionArrays[ii]);if(d&&x.bucketInstanceId in this.collisionCircleArrays){const ii=this.collisionCircleArrays[x.bucketInstanceId];o.bl(ii.invProjMatrix,L),ii.viewportMatrix=this.collisionIndex.getViewportMatrix()}x.justReloaded=!1}markUsedJustification(t,l,d,g){const{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:T,verticalPlacedTextSymbolIndex:E,crossTileID:L}=d,P=o.c3(l),z=g===o.bL.vertical?E:P==="left"?y:P==="center"?x:P==="right"?T:-1;y>=0&&(t.text.placedSymbolArray.get(y).crossTileID=z>=0&&y!==z?0:L),x>=0&&(t.text.placedSymbolArray.get(x).crossTileID=z>=0&&x!==z?0:L),T>=0&&(t.text.placedSymbolArray.get(T).crossTileID=z>=0&&T!==z?0:L),E>=0&&(t.text.placedSymbolArray.get(E).crossTileID=z>=0&&E!==z?0:L)}markUsedOrientation(t,l,d){const g=l===o.bL.horizontal||l===o.bL.horizontalOnly?l:0,y=l===o.bL.vertical?l:0,{leftJustifiedTextSymbolIndex:x,centerJustifiedTextSymbolIndex:T,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:L}=d,P=t.text.placedSymbolArray;x>=0&&(P.get(x).placedOrientation=g),T>=0&&(P.get(T).placedOrientation=g),E>=0&&(P.get(E).placedOrientation=g),L>=0&&(P.get(L).placedOrientation=y)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let d=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const g=l?l.symbolFadeChange(t):1,y=l?l.opacities:{},x=l?l.variableOffsets:{},T=l?l.placedOrientations:{};for(const E in this.placements){const L=this.placements[E],P=y[E];P?(this.opacities[E]=new zi(P,g,L.text,L.icon,null,L.clipped),d=d||L.text!==P.text.placed||L.icon!==P.icon.placed):(this.opacities[E]=new zi(null,g,L.text,L.icon,L.skipFade,L.clipped),d=d||L.text||L.icon)}for(const E in y){const L=y[E];if(!this.opacities[E]){const P=new zi(L,g,!1,!1);P.isHidden()||(this.opacities[E]=P,d=d||L.text.placed||L.icon.placed)}}for(const E in x)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=x[E]);for(const E in T)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=T[E]);d?this.lastPlacementChangeTime=t:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:t)}updateLayerOpacities(t,l,d,g){g&&(this.lastReplacementSourceUpdateTime=g.updateTime);const y=new Set;for(const x of l){const T=x.getBucket(t);T&&x.latestFeatureIndex&&t.fqid===T.layerIds[0]&&(this.updateBucketOpacities(T,y,x,x.collisionBoxArray,d,g,x.tileID,t.scope),T.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(T,x.tileID),T.elevationType==="road"&&T.updateRoadElevation(x.tileID.canonical),T.updateZOffset())}}updateBucketOpacities(t,l,d,g,y,x,T,E){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const L=t.layers[0].layout,P=t.layers[0].paint,z=!!t.layers[0].dynamicFilter(),O=new zi(null,0,!1,!1,!0),B=L.get("text-allow-overlap"),G=L.get("icon-allow-overlap"),V=L.get("text-variable-anchor"),W=L.get("text-rotation-alignment")==="map",Y=L.get("text-pitch-alignment")==="map",se=P.get("symbol-z-offset"),ne=L.get("symbol-elevation-reference")==="sea",te=!se.isConstant(),we=new zi(null,0,B&&(G||!t.hasIconData()||L.get("icon-optional")),G&&(B||!t.hasTextData()||L.get("text-optional")),!0);!t.collisionArrays&&g&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(g);const _e=(de,le,Te)=>{for(let Me=0;Me<le/4;Me++)de.opacityVertexArray.emplaceBack(Te)};let be=0;x&&t.updateReplacement(T,x);for(let de=0;de<t.symbolInstances.length;de++){const le=t.symbolInstances.get(de),{numHorizontalGlyphVertices:Te,numVerticalGlyphVertices:Me,crossTileID:Oe,numIconVertices:Ve,tileAnchorX:je,tileAnchorY:Ye}=le;let nt=null;const Fe=this.retainedQueryData[t.bucketInstanceId];te&&le&&Fe&&(nt=d.latestFeatureIndex.loadFeature({featureIndex:le.featureIndex,bucketIndex:Fe.bucketIndex,sourceLayerIndex:Fe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ie=se.evaluate(nt,{}),Xe=l.has(Oe);let $e=this.opacities[Oe];Xe?$e=O:$e||($e=we,this.opacities[Oe]=$e),l.add(Oe);const ot=Te>0||Me>0,ht=Ve>0,yt=this.placedOrientations[Oe],dt=yt===o.bL.vertical,pt=yt===o.bL.horizontal||yt===o.bL.horizontalOnly;!ot&&!ht||$e.isHidden()||be++;let Mt=!1;if((ot||ht)&&x)for(const Lt of t.activeReplacements){if(o.bZ(Lt,y,o.b_.Symbol,E)||Lt.min.x>je||je>Lt.max.x||Lt.min.y>Ye||Ye>Lt.max.y)continue;const bt=o.b$(je,Ye,T.canonical,Lt.footprintTileId.canonical);if(Mt=o.c0(bt,Lt.footprint),Mt)break}if(ot){const Lt=Mt?vs:Wn($e.text);_e(t.text,Te,dt?vs:Lt),_e(t.text,Me,pt?vs:Lt);const bt=$e.text.isHidden(),{leftJustifiedTextSymbolIndex:kt,centerJustifiedTextSymbolIndex:jt,rightJustifiedTextSymbolIndex:Xt,verticalPlacedTextSymbolIndex:ci}=le,Ti=t.text.placedSymbolArray,ii=bt||dt?1:0;kt>=0&&(Ti.get(kt).hidden=ii),jt>=0&&(Ti.get(jt).hidden=ii),Xt>=0&&(Ti.get(Xt).hidden=ii),ci>=0&&(Ti.get(ci).hidden=bt||pt?1:0);const Mi=this.variableOffsets[Oe];Mi&&this.markUsedJustification(t,Mi.anchor,le,yt);const ni=this.placedOrientations[Oe];ni&&(this.markUsedJustification(t,"left",le,ni),this.markUsedOrientation(t,ni,le))}if(ht){const Lt=Mt?vs:Wn($e.icon),{placedIconSymbolIndex:bt,verticalPlacedIconSymbolIndex:kt}=le,jt=t.icon.placedSymbolArray,Xt=$e.icon.isHidden()?1:0;bt>=0&&(_e(t.icon,Ve,dt?vs:Lt),jt.get(bt).hidden=Xt),kt>=0&&(_e(t.icon,le.numVerticalIconVertices,pt?vs:Lt),jt.get(kt).hidden=Xt)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const Lt=t.collisionArrays[de];if(Lt){let bt=new o.P(0,0),kt=!0;if(Lt.textBox||Lt.verticalTextBox){if(V){const Xt=this.variableOffsets[Oe];Xt?(bt=wc(Xt.anchor,Xt.width,Xt.height,Xt.textOffset,Xt.textScale),W&&bt._rotate(Y?this.transform.angle:-this.transform.angle)):kt=!1}z&&(kt=!$e.clipped),Lt.textBox&&Vr(t.textCollisionBox.collisionVertexArray,$e.text.placed,!kt||dt,Ie,ne,bt.x,bt.y),Lt.verticalTextBox&&Vr(t.textCollisionBox.collisionVertexArray,$e.text.placed,!kt||pt,Ie,ne,bt.x,bt.y)}const jt=kt&&!!(!pt&&Lt.verticalIconBox);Lt.iconBox&&Vr(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,jt,Ie,ne,le.hasIconTextFit?bt.x:0,le.hasIconTextFit?bt.y:0),Lt.verticalIconBox&&Vr(t.iconCollisionBox.collisionVertexArray,$e.icon.placed,!jt,Ie,ne,le.hasIconTextFit?bt.x:0,le.hasIconTextFit?bt.y:0)}}}if(t.fullyClipped=be===0,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const de=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=de.invProjMatrix,t.placementViewportMatrix=de.viewportMatrix,t.collisionCircleArray=de.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(t){return this.fadeDuration===0?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,l){const d=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*d>t}isStale(){return this.stale}setStale(){this.stale=!0}}function Vr(h,t,l,d,g,y,x){h.emplaceBack(t?1:0,l?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,l?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,l?1:0,y||0,x||0,d,g?1:0),h.emplaceBack(t?1:0,l?1:0,y||0,x||0,d,g?1:0)}const c1=Math.pow(2,25),Uu=Math.pow(2,24),Ap=Math.pow(2,17),Vu=Math.pow(2,16),cd=Math.pow(2,9),Cp=Math.pow(2,8),ud=Math.pow(2,1);function Wn(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;const t=h.placed?1:0,l=Math.floor(127*h.opacity);return l*c1+t*Uu+l*Ap+t*Vu+l*cd+t*Cp+l*ud+t}const vs=0;class xs{constructor(t){this._sortAcrossTiles=t.layout.get("symbol-z-order")!=="viewport-y"&&t.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(t,l,d,g,y,x){const T=this._bucketParts;for(;this._currentTileIndex<t.length;)if(l.getBucketParts(T,g,t[this._currentTileIndex],this._sortAcrossTiles,x),this._currentTileIndex++,y())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((E,L)=>E.sortKey-L.sortKey));this._currentPartIndex<T.length;){const E=T[this._currentPartIndex];if(l.placeLayerBucketPart(E,this._seenCrossTileIDs,d,E.symbolInstanceStart===0,x),this._currentPartIndex++,y())return!0}return!1}}class kp{startNewPlacement(t,l,d,g,y,x,T,E){return this.placement=new Hn(t,g,y,x,T,E),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=!1,this._showCollisionBoxes=d,this._fadeDuration=g,this._done=!1,this._inProgressLayer=null,this}requestFullPlacement(){this._forceFullPlacement=!0}isFullPlacementRequested(){return this._forceFullPlacement}setStale(){this.placement&&(this.placement.stale=!0)}isStale(){return!!this.placement&&this.placement.stale}isDone(){return this._done}continuePlacement(t,l,d,g,y){const x=o.o.now(),T=()=>{const E=o.o.now()-x;return!this.isFullPlacementRequested()&&this._fadeDuration!==0&&E>2};for(;this._currentPlacementIndex>=0;){const E=l[t[this._currentPlacementIndex]],L=this.placement.collisionIndex.transform.zoom;if(E.type==="symbol"&&E.visibility!=="none"&&(!E.minzoom||E.minzoom<=L)&&(!E.maxzoom||E.maxzoom>L)){const P=E,z=P.layout.get("symbol-z-elevate"),O=P.layout.get("symbol-sort-key").constantOr(1)!==void 0,B=P.layout.get("symbol-z-order"),G=B==="viewport-y"||B==="auto"&&!(B!=="viewport-y"&&O),V=P.layout.get("text-allow-overlap")||P.layout.get("icon-allow-overlap")||P.layout.get("text-ignore-placement")||P.layout.get("icon-ignore-placement"),W=G&&V,Y=this._inProgressLayer=this._inProgressLayer||new xs(P),se=o.B(E.source,E.scope);if(Y.continuePlacement(z||W?g[se]:d[se],this.placement,this._showCollisionBoxes,E,T,y))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._forceFullPlacement=!1,this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const rl=512/o.al/2;class cn{constructor(t,l,d){this.tileID=t,this.bucketInstanceId=d,this.index=new o.c4(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const g=t.canonical.x*o.al,y=t.canonical.y*o.al;for(let x=0;x<l.length;x++){const{key:T,crossTileID:E,tileAnchorX:L,tileAnchorY:P}=l.get(x),z=Math.floor((g+L)*rl),O=Math.floor((y+P)*rl);this.index.add(z,O),this.keys.push(T),this.crossTileIDs.push(E)}this.index.finish()}findMatches(t,l,d){const g=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),y=rl/Math.pow(2,l.canonical.z-this.tileID.canonical.z),x=l.canonical.x*o.al,T=l.canonical.y*o.al;for(let E=0;E<t.length;E++){const L=t.get(E);if(L.crossTileID)continue;const{key:P,tileAnchorX:z,tileAnchorY:O}=L,B=Math.floor((x+z)*y),G=Math.floor((T+O)*y),V=this.index.range(B-g,G-g,B+g,G+g).sort((W,Y)=>W-Y);for(const W of V){const Y=this.crossTileIDs[W];if(this.keys[W]===P&&!d.has(Y)){d.add(Y),L.crossTileID=Y;break}}}}}class na{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ra{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const l=Math.round((t-this.lng)/360);if(l!==0)for(const d in this.indexes){const g=this.indexes[d],y={};for(const x in g){const T=g[x];T.tileID=T.tileID.unwrapTo(T.tileID.wrap+l),y[T.tileID.key]=T}this.indexes[d]=y}this.lng=t}addBucket(t,l,d){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let y=0;y<l.symbolInstances.length;y++)l.symbolInstances.get(y).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]=new Set);const g=this.usedCrossTileIDs[t.overscaledZ];for(const y in this.indexes){const x=this.indexes[y];if(Number(y)>t.overscaledZ)for(const T in x){const E=x[T];E.tileID.isChildOf(t)&&E.findMatches(l.symbolInstances,t,g)}else{const T=x[t.scaledTo(Number(y)).key];T&&T.findMatches(l.symbolInstances,t,g)}}for(let y=0;y<l.symbolInstances.length;y++){const x=l.symbolInstances.get(y);x.crossTileID||(x.crossTileID=d.generate(),g.add(x.crossTileID))}return this.indexes[t.overscaledZ]===void 0&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new cn(t,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(t,l){for(const d of l.crossTileIDs)this.usedCrossTileIDs[t].delete(d)}removeStaleBuckets(t){let l=!1;for(const d in this.indexes){const g=this.indexes[d];for(const y in g)t[g[y].bucketInstanceId]||(this.removeBucketCrossTileIDs(d,g[y]),delete g[y],l=!0)}return l}}class Qr{constructor(){this.layerIndexes={},this.crossTileIDs=new na,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,l,d,g){let y=this.layerIndexes[t.fqid];y===void 0&&(y=this.layerIndexes[t.fqid]=new Ra);let x=!1;const T={};g.name!=="globe"&&y.handleWrapJump(d);for(const E of l){const L=E.getBucket(t);L&&t.fqid===L.layerIds[0]&&(L.bucketInstanceId||(L.bucketInstanceId=++this.maxBucketInstanceId),y.addBucket(E.tileID,L,this.crossTileIDs)&&(x=!0),T[L.bucketInstanceId]=!0)}return y.removeStaleBuckets(T)&&(x=!0),x}pruneUnusedLayers(t){const l={};t.forEach(d=>{l[d]=!0});for(const d in this.layerIndexes)l[d]||delete this.layerIndexes[d]}}const nl=771;class ri{constructor(t,l,d,g){this.blendFunction=t,this.blendColor=l.toNonPremultipliedRenderColor(null),this.mask=d,this.blendEquation=g}}ri.Replace=[1,0,1,0],ri.disabled=new ri(ri.Replace,o.ao.transparent,[!1,!1,!1,!1]),ri.unblended=new ri(ri.Replace,o.ao.transparent,[!0,!0,!0,!0]),ri.alphaBlended=new ri([1,nl,1,nl],o.ao.transparent,[!0,!0,!0,!0]),ri.alphaBlendedNonPremultiplied=new ri([770,nl,770,nl],o.ao.transparent,[!0,!0,!0,!0]),ri.multiply=new ri([774,0,774,0],o.ao.transparent,[!0,!0,!0,!0]),ri.additive=new ri([1,1,1,1],o.ao.transparent,[!0,!0,!0,!0]);class Dt{constructor(t,l,d){this.func=t,this.mask=l,this.range=d}}Dt.ReadOnly=!1,Dt.ReadWrite=!0,Dt.disabled=new Dt(519,Dt.ReadOnly,[0,1]);const Sc=7680;class Yt{constructor(t,l,d,g,y,x){this.test=t,this.ref=l,this.mask=d,this.fail=g,this.depthFail=y,this.pass=x}}Yt.disabled=new Yt({func:519,mask:0},0,0,Sc,Sc,Sc);const hd=1029,$u=2305;class Zt{constructor(t,l,d){this.enable=t,this.mode=l,this.frontFace=d}}function Lp(h,t){const l=o.ca(h,3);o.cc(h,t),o.cg(h,3,l)}function Pp(h,t){const l=o.c7([]);return o.c8(l,l,-t),o.c9(l,l,-h),l}function sa(h,t){const l=[h[0],h[1],0],d=[t[0],t[1],0];if(o.ag(l)>=1e-15){const x=o.aw([],l);o.c5(d,x,o.bJ(d,x)),t[0]=d[0],t[1]=d[1]}const g=o.bI([],t,h);if(o.c6(g)<1e-15)return null;const y=Math.atan2(-g[1],g[0]);return Pp(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),y)}Zt.disabled=new Zt(!1,hd,$u),Zt.backCCW=new Zt(!0,hd,$u),Zt.backCW=new Zt(!0,hd,2304),Zt.frontCW=new Zt(!0,1028,2304),Zt.frontCCW=new Zt(!0,1028,$u);class Q_{constructor(t,l){this.position=t,this.orientation=l}get position(){return this._position}set position(t){if(t){const l=t instanceof o.ae?t:new o.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(l.x=o.bT(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(t,l,d){if(this.orientation=null,!this.position)return;const g=this.position,y=d||(this._elevation?this._elevation.getAtPointOrZero(o.ae.fromLngLat(t)):0),x=o.ae.fromLngLat(t,y),T=[x.x-g.x,x.y-g.y,x.z-g.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=sa(T,l)}setPitchBearing(t,l){this.orientation=Pp(o.an(t),o.an(-l))}}class Tc{constructor(t,l){this._transform=o.bA([]),this.orientation=l,this.position=t}get mercatorPosition(){const t=this.position;return new o.ae(t[0],t[1],t[2])}get position(){const t=o.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var l;t&&o.cg(this._transform,3,[(l=t)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||o.c7([]),t&&Lp(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,l){this._orientation=Pp(t,l),Lp(this._transform,this._orientation)}forward(){const t=o.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=o.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=o.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,l){const d=new Float64Array(16);return o.bl(d,this.getWorldToCamera(t,l)),d}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,l,d){const g=this.position;o.c5(g,g,-t);const y=new Float64Array(16);return o.bq(y,[d,d,d]),o.br(y,y,g),y[10]*=l,y}getWorldToCamera(t,l){const d=new Float64Array(16),g=new Float64Array(4),y=this.position;return o.cb(g,this._orientation),o.c5(y,y,-t),o.cc(d,g),o.br(d,d,y),d[1]*=-1,d[5]*=-1,d[9]*=-1,d[13]*=-1,d[8]*=l,d[9]*=l,d[10]*=l,d[11]*=l,d}getCameraToClipPerspective(t,l,d,g){const y=new Float64Array(16);return o.cd(y,t,l,d,g),y}getCameraToClipOrthographic(t,l,d,g,y,x){const T=new Float64Array(16);return o.ce(T,t,l,d,g,y,x),T}getDistanceToElevation(t,l=!1){const d=t===0?0:o.cf(t,l?o.a$(this.position[1]):this.position[1]),g=this.forward();return(d-this.position[2])/g[2]}clone(){return new Tc([...this.position],[...this.orientation])}}const bs=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t});class Mp{constructor(t=0,l=0,d=0,g=0){if(isNaN(t)||t<0||isNaN(l)||l<0||isNaN(d)||d<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=l,this.left=d,this.right=g}interpolate(t,l,d){return l.top!=null&&t.top!=null&&(this.top=o.ak(t.top,l.top,d)),l.bottom!=null&&t.bottom!=null&&(this.bottom=o.ak(t.bottom,l.bottom,d)),l.left!=null&&t.left!=null&&(this.left=o.ak(t.left,l.left,d)),l.right!=null&&t.right!=null&&(this.right=o.ak(t.right,l.right,d)),this}getCenter(t,l){const d=o.aA((this.left+t-this.right)/2,0,t),g=o.aA((this.top+l-this.bottom)/2,0,l);return new o.P(d,g)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new Mp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const oa=15;class dd{constructor(t,l,d,g,y,x,T){this.tileSize=512,this._renderWorldCopies=y===void 0||y,this._minZoom=t||0,this._maxZoom=l||22,this._minPitch=d??0,this._maxPitch=g??60,this.setProjection(x),this.setMaxBounds(T),this.width=0,this.height=0,this._center=new o.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Mp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Tc,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const t=new dd(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.mercatorFromTransition=this.mercatorFromTransition,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t.frustumCorners=this.frustumCorners,t._allowWorldUnderZoom=this._allowWorldUnderZoom,t}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<oa}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(t,l=!1){const d=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||d)&&this._updateCameraOnTerrain(),(t||d)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return o.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=o.cm(this.projectionOptions);const d=this.getProjection(),g=!o.by(l,d);return g&&this._calcMatrices(),this.mercatorFromTransition=!1,g}setOrthographicProjectionAtLowPitch(t){return this._orthographicProjectionAtLowPitch!==t&&(this._orthographicProjectionAtLowPitch=t,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cm({name:"mercator"});const l=t!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(t){t===void 0?t=!0:t===null&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bT(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const l=-t*Math.PI/180;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=o.cn(),o.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const l=o.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=o.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const t=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/t)}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const l=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(t){this._tileCoverLift!==t&&(this._tileCoverLift=t)}_updateCameraOnTerrain(){const t=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,l=this.elevation&&t===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||t===Number.NEGATIVE_INFINITY&&(!l||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const d=this._elevation;l||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&d.exaggeration()&&this._centerAltitudeValidForExaggeration!==d.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*d.exaggeration(),this._centerAltitudeValidForExaggeration=d.exaggeration()):(this._centerAltitude=t||0,this._centerAltitudeValidForExaggeration=d.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const t=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(t)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],d=this.horizonLineFromTop();let g=0,y=0;for(let x=0;x<l.length;x++){const T=new o.P(l[x][0]*this.width,d+l[x][1]*(this.height-d)),E=t.pointCoordinate(T);if(!E)continue;const L=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);g+=E[3]*L,y+=L}return y===0?NaN:g/y}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const t=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),d=this.pixelsPerMeter/this.worldSize*l,g=this._mercatorZfromZoom(t),y=this._mercatorZfromZoom(this._maxZoom),x=Math.max(g-d,y);this._setZoom(this._zoomFromMercatorZ(x))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}equals(t){const l=this.elevation,d=t.elevation,g=l!=null!=(d!=null)||l&&d&&l.exaggeration()!==d.exaggeration();return this.width===t.width&&this.height===t.height&&this.center.lng===t.center.lng&&this.center.lat===t.center.lat&&this.zoom===t.zoom&&this.bearing===t.bearing&&this.pitch===t.pitch&&this.fov===t.fov&&this.projection.name===t.projection.name&&this._edgeInsets.equals(t.padding)&&!g}computeZoomRelativeTo(t){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let d;d=t.z<this._camera.position[2]?[l.x,l.y,l.z]:[t.x,t.y,t.z];const g=o.ag(o.av([],this._camera.position,d));return o.aA(this._zoomFromMercatorZ(g),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height||!t.position&&!t.orientation)return;this._updateCameraState();let l=!1;if(t.orientation&&!o.cp(t.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(t.orientation)),t.position){const d=[t.position.x,t.position.y,t.position.z];o.cq(d,this._camera.position)||(this._setCameraPosition(d),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,l=new Q_;return l.position=new o.ae(t[0],t[1],t[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(t){if(!o.cr(t))return!1;o.cs(t,t);const l=o.ct([],[0,0,-1],t),d=o.ct([],[0,-1,0],t);if(d[2]<0)return!1;const g=sa(l,d);return!!g&&(this._camera.orientation=g,!0)}_setCameraPosition(t){const l=this.zoomScale(this.minZoom)*this.tileSize,d=this.zoomScale(this.maxZoom)*this.tileSize,g=this.cameraToCenterDistance;t[2]=o.aA(t[2],g/d,g/l),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,l,d){this._unmodified=!1,this._edgeInsets.interpolate(t,l,d),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const l=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(t){const l=[new o.cu(0,t)];if(this.renderWorldCopies){const d=this.pointCoordinate(new o.P(0,0)),g=this.pointCoordinate(new o.P(this.width,0)),y=this.pointCoordinate(new o.P(this.width,this.height)),x=this.pointCoordinate(new o.P(0,this.height)),T=Math.floor(Math.min(d.x,g.x,y.x,x.x)),E=Math.floor(Math.max(d.x,g.x,y.x,x.x)),L=1;for(let P=T-L;P<=E+L;P++)P!==0&&l.push(new o.cu(P,t))}return l}isLODDisabled(t){return(!t||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,l,d,g){let y=[];const x=d!=null,T=!x;if(T&&this.zoom<l||x&&d[0]===0&&d[1]===0)return y;const E=new Set,L=(z,O,B,G,V)=>{const W=o.cY(O,z,B,G,V);E.has(W)||(y.push(new o.aQ(z,O,B,G,V)),E.add(W))};for(let z=0;z<t.length;z++){const O=t[z];if(T&&O.canonical.z!==l||x&&g!==void 0&&g>O.canonical.z)continue;const B=O.canonical,G=O.overscaledZ,V=O.wrap,W=1<<B.z,Y=B.x+1<W,se=B.x>0,ne=B.y+1<W,te=B.y>0,we=O.wrap-(se?0:1),_e=O.wrap+(Y?0:1),be=se?B.x-1:W-1,de=Y?B.x+1:0;if(x)d[0]<0?(L(G,_e,B.z,de,B.y),d[1]<0&&ne&&(L(G,V,B.z,B.x,B.y+1),L(G,_e,B.z,de,B.y+1)),d[1]>0&&te&&(L(G,V,B.z,B.x,B.y-1),L(G,_e,B.z,de,B.y-1))):d[0]>0?(L(G,we,B.z,be,B.y),d[1]<0&&ne&&(L(G,V,B.z,B.x,B.y+1),L(G,we,B.z,be,B.y+1)),d[1]>0&&te&&(L(G,V,B.z,B.x,B.y-1),L(G,we,B.z,be,B.y-1))):d[1]<0&&ne?L(G,V,B.z,B.x,B.y+1):te&&L(G,V,B.z,B.x,B.y-1);else{const le=O.visibleQuadrants;1&le&&(L(G,we,B.z,be,B.y),te&&(L(G,V,B.z,B.x,B.y-1),L(G,we,B.z,be,B.y-1))),2&le&&(L(G,_e,B.z,de,B.y),te&&(L(G,V,B.z,B.x,B.y-1),L(G,_e,B.z,de,B.y-1))),4&le&&(L(G,we,B.z,be,B.y),ne&&(L(G,V,B.z,B.x,B.y+1),L(G,we,B.z,be,B.y+1))),8&le&&(L(G,_e,B.z,de,B.y),ne&&(L(G,V,B.z,B.x,B.y+1),L(G,_e,B.z,de,B.y+1)))}}const P=[];for(const z of y)y.some(O=>z.isChildOf(O))||P.push(z);if(y=P.filter(z=>!t.some(O=>!!(z.overscaledZ<l&&O.isChildOf(z))||z.equals(O)||z.isChildOf(O))),T){const z=1<<l,O=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),B=[z*O.x,z*O.y],G=4,V=G*G;y=y.filter(W=>{const Y=W.canonical.x+.5-B[0],se=W.canonical.y+.5-B[1];return Y*Y+se*se<V})}return y}extendTileCoverToNearPlane(t,l,d){const g=[],y=new Set;for(const se of t)y.add(se.key);const x=(se,ne,te,we,_e)=>{const be=o.cY(ne,se,te,we,_e);y.has(be)||(g.push(new o.aQ(se,ne,te,we,_e)),y.add(be))},T=t.reduce((se,ne)=>Math.max(se,ne.overscaledZ),d),E=1<<d,L=[new o.P(0,0),new o.P(o.al,0),new o.P(o.al,o.al),new o.P(0,o.al)],P=new o.P(0,0),z=new o.P(0,0),O=(se,ne)=>{const te=Math.floor(se[0]),we=Math.floor(se[1]),_e=(se[0]-te)*o.al,be=(se[1]-we)*o.al,de=Math.floor(ne[0]),le=Math.floor(ne[1]),Te=(ne[0]-de)*o.al,Me=(ne[1]-le)*o.al;for(let Oe=-1;Oe<=1;Oe++){const Ve=te+Oe;if(!(Ve<0||Ve>=E)){P.x=_e-Oe*o.al,z.x=Te-(Ve-de)*o.al;for(let je=-1;je<=1;je++){const Ye=we+je;P.y=be-je*o.al,z.y=Me-(Ye-le)*o.al,o.cZ(P,z,L)&&x(T,0,d,Ve,Ye)}}}},B=l.points,G=B[o.cv],V=B[o.cw],W=this._projectToGround(G,B[o.cx]),Y=this._projectToGround(V,B[o.cy]);return O(G,W),O(V,Y),g}_projectToGround(t,l){return o.cz(o.cA(),t,l,t[2]/(t[2]-l[2]))}coveringTiles(t){let l=this.coveringZoomLevel(t);const d=l,g=this.elevation&&this.elevation.exaggeration(),y=g&&!t.isTerrainDEM,x=this.projection.name==="mercator";if(t.minzoom!==void 0&&l<t.minzoom)return[];t.maxzoom!==void 0&&l>t.maxzoom&&(l=t.maxzoom);const T=this.locationCoordinate(this.center),E=this.center.lat,L=1<<l,P=[L*T.x,L*T.y,0],z=this.projection.name==="globe",O=!z,B=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,O),G=z?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=L*o.cf(1,this.center.lat),W=this._camera.position[2]/o.cf(1,this.center.lat),Y=[L*G.x,L*G.y,W*(O?1:V)],se=z||g,ne=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),te=this.isLODDisabled(!0)?l:0;let we;if(this._elevation&&t.isTerrainDEM)we=1e4*this._elevation.exaggeration();else if(this._elevation){const Ie=this._elevation.getMinMaxForVisibleTiles();we=Ie?Ie.max:this._centerAltitude}else we=this._centerAltitude;const _e=t.isTerrainDEM?-we:this._elevation?this._elevation.getMinElevationBelowMSL():0,be=this.projection.isReprojectedInTileSpace?o.cC(this):1,de=Ie=>{const $e=new o.ae(Ie.x+25e-6,Ie.y,Ie.z),ot=new o.ae(Ie.x,Ie.y+25e-6,Ie.z),ht=Ie.toLngLat(),yt=$e.toLngLat(),dt=ot.toLngLat(),pt=this.locationCoordinate(ht),Mt=this.locationCoordinate(yt),Lt=this.locationCoordinate(dt),bt=Math.hypot(Mt.x-pt.x,Mt.y-pt.y),kt=Math.hypot(Lt.x-pt.x,Lt.y-pt.y);return Math.sqrt(bt*kt)*be/25e-6},le=Ie=>{const Xe=we,$e=_e;return{aabb:o.cF(this,L,0,0,0,Ie,$e,Xe,this.projection),zoom:0,x:0,y:0,minZ:$e,maxZ:Xe,wrap:Ie,fullyVisible:!1}},Te=[];let Me=[];const Oe=l,Ve=t.reparseOverscaled?d:l,je=(W-this._centerAltitude)*V,Ye=Ie=>{if(!this._elevation||!Ie.tileID||!x)return;const Xe=this._elevation.getMinMaxForTile(Ie.tileID),$e=Ie.aabb;Xe?($e.min[2]=Xe.min,$e.max[2]=Xe.max,$e.center[2]=($e.min[2]+$e.max[2])/2):(Ie.shouldSplit=Fe(Ie),Ie.shouldSplit||($e.min[2]=$e.max[2]=$e.center[2]=this._centerAltitude))},nt=(Ie,Xe)=>{if(.707*Xe<Ie)return 1;const $e=Xe/Ie;return $e/(1.4144271570014144+(Math.pow(1.1,$e-1.4144271570014144+1)-1)/(1.1-1)-1)},Fe=Ie=>{if(Ie.zoom<te)return!0;if(Ie.zoom===Oe)return!1;if(Ie.shouldSplit!=null)return Ie.shouldSplit;const Xe=Ie.aabb.distanceX(Y),$e=Ie.aabb.distanceY(Y);let ot=je,ht=1;if(z){ot=Ie.aabb.distanceZ(Y);const kt=Math.pow(2,Ie.zoom),jt=o.a$((Ie.y+1)/kt),Xt=o.a$(Ie.y/kt),ci=Math.min(Math.max(E,jt),Xt),Ti=o.d1(ci)/o.d1(E);if(ht=ci===E?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ti/this._mercatorScaleRatio),this.zoom<=o.c_&&Ie.zoom===Oe-1&&Ti>=.9)return!0}else if(y&&(ot=Ie.aabb.distanceZ(Y)*V),this.projection.isReprojectedInTileSpace&&d<=5){const kt=Math.pow(2,Ie.zoom),jt=de(new o.ae((Ie.x+.5)/kt,(Ie.y+.5)/kt));ht=jt>.85?1:jt}if(!x&&!z){const kt=Math.sqrt(Xe*Xe+$e*$e+ot*ot);let jt=(1<<Oe-Ie.zoom)*ne*ht;return jt*=nt(Math.max(ot,je),kt),kt<jt}let yt=Number.MAX_VALUE,dt=0;const pt=Ie.aabb.getCorners(),Mt=[];for(const kt of pt){o.av(Mt,kt,Y),z||(y?Mt[2]*=V:Mt[2]=je);const jt=o.bJ(Mt,this._camera.forward());jt<yt&&(yt=jt,dt=Math.abs(Mt[2]))}let Lt=(1<<Oe-Ie.zoom)*ne*ht;if(Lt*=nt(Math.max(dt,je),yt),yt<Lt)return!0;const bt=Ie.aabb.closestPoint(P);return bt[0]===P[0]&&bt[1]===P[1]};if(this.renderWorldCopies)for(let Ie=1;Ie<=3;Ie++)Te.push(le(-Ie)),Te.push(le(Ie));for(Te.push(le(0));Te.length>0;){const Ie=Te.pop(),Xe=Ie.x,$e=Ie.y;let ot=Ie.fullyVisible;const ht=()=>this.projection.name==="globe"&&(Ie.y===0||Ie.y===(1<<Ie.zoom)-1);if(!ot){let yt=se?Ie.aabb.intersects(B):Ie.aabb.intersectsFlat(B);if(yt===0&&ht()){const dt=new o.cD(Ie.zoom,Xe,$e);yt=o.cE(this,L,dt,!0).intersects(B)}if(yt===0)continue;ot=yt===2}if(Ie.zoom===Oe||!Fe(Ie)){const yt=Ie.zoom===Oe?Ve:Ie.zoom;if(t.minzoom&&t.minzoom>yt)continue;let dt=0;if(!ot){let bt=se?Ie.aabb.intersectsPrecise(B):Ie.aabb.intersectsPreciseFlat(B);if(bt===0&&ht()){const kt=new o.cD(Ie.zoom,Xe,$e);bt=o.cE(this,L,kt,!0).intersectsPrecise(B)}if(bt===0)continue;if(t.calculateQuadrantVisibility)if(B.containsPoint(Ie.aabb.center))dt=15;else for(let kt=0;kt<4;kt++)Ie.aabb.quadrant(kt).intersects(B)!==0&&(dt|=1<<kt)}const pt=P[0]-(.5+Xe+(Ie.wrap<<Ie.zoom))*(1<<l-Ie.zoom),Mt=P[1]-.5-$e,Lt=Ie.tileID?Ie.tileID:new o.aQ(yt,Ie.wrap,Ie.zoom,Xe,$e);t.calculateQuadrantVisibility&&(Lt.visibleQuadrants=dt),Me.push({tileID:Lt,distanceSq:pt*pt+Mt*Mt});continue}for(let yt=0;yt<4;yt++){const dt=(Xe<<1)+yt%2,pt=($e<<1)+(yt>>1),Mt={aabb:x?Ie.aabb.quadrant(yt):o.cF(this,L,Ie.zoom+1,dt,pt,Ie.wrap,Ie.minZ,Ie.maxZ,this.projection),zoom:Ie.zoom+1,x:dt,y:pt,wrap:Ie.wrap,fullyVisible:ot,tileID:void 0,shouldSplit:void 0,minZ:Ie.minZ,maxZ:Ie.maxZ};y&&!z&&(Mt.tileID=new o.aQ(Ie.zoom+1===Oe?Ve:Ie.zoom+1,Ie.wrap,Ie.zoom+1,dt,pt),Ye(Mt)),Te.push(Mt)}}if(this.fogCullDistSq){const Ie=this.fogCullDistSq,Xe=this.horizonLineFromTop();Me=Me.filter($e=>{const ot=[0,0,0,1],ht=[o.al,o.al,0,1],yt=this.calculateFogTileMatrix($e.tileID.toUnwrapped());o.aC(ot,ot,yt),o.aC(ht,ht,yt);const dt=o.cG([],ot,ht),pt=o.cH([],ot,ht),Mt=o.c$(dt,pt);if(Mt===0)return!0;let Lt=!1;const bt=this._elevation;if(bt&&Mt>Ie&&Xe!==0){const kt=this.calculateProjMatrix($e.tileID.toUnwrapped());let jt;t.isTerrainDEM||(jt=bt.getMinMaxForTile($e.tileID)),jt||(jt={min:_e,max:we});const Xt=o.cI(this.rotation),ci=[Xt[0]*o.al,Xt[1]*o.al,jt.max];o.af(ci,ci,kt),Lt=(1-ci[1])*this.height*.5<Xe}return Mt<Ie||Lt})}return Me.sort((Ie,Xe)=>Ie.distanceSq-Xe.distanceSq).map(Ie=>Ie.tileID)}resize(t,l){this.width=t,this.height=l,this.pixelsToGLUnits=[2/t,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log2(t)}project(t){const l=o.aA(t.lat,-o.cJ,o.cJ),d=this.projection.project(t.lng,l);return new o.P(d.x*this.worldSize,d.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,l){let d,g;const y=this.centerPoint;if(this.projection.name==="globe"){const T=this.worldSize;d=(l.x-y.x)/T,g=(l.y-y.y)/T}else{const T=this.pointCoordinate(l),E=this.pointCoordinate(y);d=T.x-E.x,g=T.y-E.y}const x=this.locationCoordinate(t);this.setLocation(new o.ae(x.x-d,x.y-g))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t,l){return this.projection.locationPoint(this,t,l)}locationPoint3D(t,l){return this.projection.locationPoint(this,t,l,!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t,l){return this.coordinateLocation(this.pointCoordinate3D(t,l))}locationCoordinate(t,l){const d=l?o.cf(l,t.lat):void 0,g=this.projection.project(t.lng,t.lat);return new o.ae(g.x,g.y,d)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(t,l){const d=l??this._centerAltitude,g=[t.x,t.y,0,1],y=[t.x,t.y,1,1];o.aC(g,g,this.pixelMatrixInverse),o.aC(y,y,this.pixelMatrixInverse);const x=y[3];o.cK(g,g,1/g[3]),o.cK(y,y,1/x);const T=g[2],E=y[2];return{p0:g,p1:y,t:T===E?0:(d-T)/(E-T)}}screenPointToMercatorRay(t){const l=[t.x,t.y,0,1],d=[t.x,t.y,1,1];return o.aC(l,l,this.pixelMatrixInverse),o.aC(d,d,this.pixelMatrixInverse),o.cK(l,l,1/l[3]),o.cK(d,d,1/d[3]),l[2]=o.cf(l[2],this._center.lat)*this.worldSize,d[2]=o.cf(d[2],this._center.lat)*this.worldSize,o.cK(l,l,1/this.worldSize),o.cK(d,d,1/this.worldSize),new o.ax([l[0],l[1],l[2]],o.aw([],o.av([],d,l)))}rayIntersectionCoordinate(t){const{p0:l,p1:d,t:g}=t,y=o.cf(l[2],this._center.lat),x=o.cf(d[2],this._center.lat);return new o.ae(o.ak(l[0],d[0],g)/this.worldSize,o.ak(l[1],d[1],g)/this.worldSize,o.ak(y,x,g))}pointCoordinate(t,l=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,l)}pointCoordinate3D(t,l){if(!this.elevation)return this.pointCoordinate(t,l);let d=this.projection.pointCoordinate3D(this,t.x,t.y);if(d)return new o.ae(d[0],d[1],d[2]);let g=0,y=this.horizonLineFromTop();if(t.y>y)return this.pointCoordinate(t,l);const x=.02*y,T=t.clone();for(let E=0;E<10&&y-g>x;E++){T.y=o.ak(g,y,.66);const L=this.projection.pointCoordinate3D(this,T.x,T.y);L?(y=T.y,d=L):g=T.y}return d?new o.ae(d[0],d[1],d[2]):this.pointCoordinate(t)}isPointAboveHorizon(t){return this.projection.isPointAboveHorizon(this,t)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=o.cL)return!this.isPointAboveHorizon(t);const l=this.pointCoordinate(t);return l.y>=0&&l.y<=1}_coordinatePoint(t,l){const d=l&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,g=[t.x*this.worldSize,t.y*this.worldSize,d+t.toAltitude(),1];return o.aC(g,g,this.pixelMatrix),g[3]>0?new o.P(g[0]/g[3],g[1]/g[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:l}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,g=this.width-this._edgeInsets.right,y=this.pointLocation3D(new o.P(l,t)),x=this.pointLocation3D(new o.P(g,t)),T=this.pointLocation3D(new o.P(g,d)),E=this.pointLocation3D(new o.P(l,d));let L=Math.min(y.lng,x.lng,T.lng,E.lng),P=Math.max(y.lng,x.lng,T.lng,E.lng),z=Math.min(y.lat,x.lat,T.lat,E.lat),O=Math.max(y.lat,x.lat,T.lat,E.lat);const B=Math.pow(2,-this.zoom)/16*270,G=this.projection.name==="globe"?1:4,V=(W,Y,se,ne,te)=>{const we=(W+se)/2,_e=(Y+ne)/2,be=new o.P(we,_e),{lng:de,lat:le}=this.pointLocation3D(be),Te=Math.max(0,L-de,z-le,de-P,le-O);L=Math.min(L,de),P=Math.max(P,de),z=Math.min(z,le),O=Math.max(O,le),(te<G||Te>B)&&(V(W,Y,we,_e,te+1),V(we,_e,se,ne,te+1))};if(V(l,t,g,t,1),V(g,t,g,d,1),V(g,d,l,d,1),V(l,d,l,t,1),this.projection.name==="globe"){const[W,Y]=o.cM(this);W?(O=90,P=180,L=-180):Y&&(z=-90,P=180,L=-180)}return new o.aI(new o.aT(L,z),new o.aT(P,O))}_getBoundsRectangular(t,l){const{top:d,left:g}=this._edgeInsets,y=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,T=new o.P(g,d),E=new o.P(x,d),L=new o.P(x,y),P=new o.P(g,y);let z=this.pointCoordinate(T,t),O=this.pointCoordinate(E,t);const B=this.pointCoordinate(L,l),G=this.pointCoordinate(P,l),V=(W,Y)=>(Y.y-W.y)/(Y.x-W.x);return z.y>1&&O.y>=0?z=new o.ae((1-G.y)/V(G,z)+G.x,1):z.y<0&&O.y<=1&&(z=new o.ae(-G.y/V(G,z)+G.x,0)),O.y>1&&z.y>=0?O=new o.ae((1-B.y)/V(B,O)+B.x,1):O.y<0&&z.y<=1&&(O=new o.ae(-B.y/V(B,O)+B.x,0)),new o.aI().extend(this.coordinateLocation(z)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(G)).extend(this.coordinateLocation(B))}_getBoundsRectangularTerrain(){const t=this.elevation;if(!t.visibleDemTiles.length||t.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=t.visibleDemTiles.reduce((d,g)=>{if(g.dem){const y=g.dem.tree;d.min=Math.min(d.min,y.minimums[0]),d.max=Math.max(d.max,y.maximums[0])}return d},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*t.exaggeration(),l.max*t.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(t=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,d=this.height/2-l*(1-this._horizonShift);return t?Math.max(0,d):d}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-o.cJ,this.maxLat=o.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aF(this.minLng)*this.tileSize,this.worldMaxX=o.aF(this.maxLng)*this.tileSize,this.worldMinY=o.aJ(this.maxLat)*this.tileSize,this.worldMaxY=o.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,l){return this.projection.createTileMatrix(this,l,t)}calculateDistanceTileData(t){const l=t.key,d=this._distanceTileDataCache;if(d[l])return d[l];const g=t.canonical,y=1/this.height,x=this.cameraWorldSize,T=x/this.zoomScale(g.z),E=(g.x+Math.pow(2,g.z)*t.wrap)*T,L=g.y*T,P=this.point;P.x*=x/this.worldSize,P.y*=x/this.worldSize;const z=this.angle,O=Math.sin(-z),B=-Math.cos(-z);return d[l]={bearing:[O,B],center:[(P.x-E)*y,(P.y-L)*y],scale:T/o.al*y},d[l]}calculateFogTileMatrix(t){const l=t.key,d=this._fogTileMatrixCache;if(d[l])return d[l];const g=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return o.aB(g,this.worldToFogMatrix,g),d[l]=new Float32Array(g),d[l]}calculateProjMatrix(t,l=!1,d=!1){const g=t.key;let y;if(y=d?this._expandedProjMatrixCache:l?this._alignedProjMatrixCache:this._projMatrixCache,y[g])return y[g];const x=this.calculatePosMatrix(t,this.worldSize);let T;return T=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:d?this.expandedFarZProjMatrix:l?this.alignedProjMatrix:this.projMatrix,o.aB(x,T,x),y[g]=new Float32Array(x),y[g]}calculatePixelsToTileUnitsMatrix(t){const l=t.tileID.key,d=this._pixelsToTileUnitsCache;if(d[l])return d[l];const g=o.cN(t,this);return d[l]=g,d[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const t=1/this.worldSize,l=o.bq([],[t,t,t]);return o.aB(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const t=this._elevation;this._updateCameraState();const l=o.cf(1,this._center.lat)*this.worldSize,d=this._computeCameraPosition(l),g=this._camera.forward(),y=o.cf(1,this._center.lat);d[2]/=y,g[2]/=y,o.aw(g,g);const x=t.raycast(d,g,t.exaggeration());if(x){const T=o.bH([],d,g,x),E=new o.ae(T[0],T[1],o.cf(T[2],o.a$(T[1]))),L=(E.z+o.ag([E.x-d[0],E.y-d[1],E.z-d[2]*y]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(L),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(t=!1){if(!this._elevation)return;const l=this._elevation,d=o.cf(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(d),y=l.getAtPointOrZero(new o.ae(...g)),x=this.pixelsPerMeter/this.worldSize*y,T=this._minimumHeightOverTerrain(),E=g[2]-x;if(E<=T)if(E<0||t){const L=this.locationCoordinate(this._center,this._centerAltitude),P=[g[0],g[1],L.z-g[2]],z=o.ag(P);P[2]-=(T-E)/this._pixelsPerMercatorPixel;const O=o.ag(P);if(O===0)return;o.c5(P,P,z/O*this._pixelsPerMercatorPixel),this._camera.position=[g[0],g[1],L.z*this._pixelsPerMercatorPixel-P[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const O=this.center;return O.lat=o.aA(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(O.lng=o.aA(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const l=this._unmodified,{x:d,y:g}=this.point;let y=0,x=d,T=g;const E=this.width/2,L=this.height/2,P=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(g-L<P&&(T=P+L),g+L>z&&(T=z-L),z-P<this.height&&(y=Math.max(y,this.height/(z-P)),T=(z+P)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,B=this.worldMaxX*this.scale,G=this.worldSize/2-(O+B)/2;x=(d+G+this.worldSize)%this.worldSize-G,x-E<O&&(x=O+E),x+E>B&&(x=B-E),B-O<this.width&&(y=Math.max(y,this.width/(B-O)),x=(B+O)/2)}x===d&&T===g||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(x,T))),y&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(y)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,l=this.projection.name==="globe",d=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cf(1,this.center.lat)/o.cf(1,o.d2));const g=o.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const y=this.projection.zAxisUnit==="meters"?d:1,x=this._camera.getWorldToCamera(this.worldSize,y);let T;const E=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(E[8]=2*-t.x/this.width,E[9]=2*t.y/this.height,this.isOrthographic){let le=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Te=le*this.aspect,Me=-Te,Oe=-le;Te-=t.x,Me-=t.x,le+=t.y,Oe+=t.y,T=this._camera.getCameraToClipOrthographic(Me,Te,Oe,le,this._nearZ,this._farZ),((Ve,je,Ye,nt)=>{for(let Fe=0;Fe<16;Fe++)Ve[Fe]=o.ak(je[Fe],Ye[Fe],nt)})(T,T,E,o.d0(this.pitch>=oa?1:this.pitch/oa))}else T=E;const L=o.cP([],E,x);let P=o.cP([],T,x);if(this.projection.isReprojectedInTileSpace){const le=this.locationCoordinate(this.center),Te=o.bA([]);o.br(Te,Te,[le.x*this.worldSize,le.y*this.worldSize,0]),o.aB(Te,Te,o.cQ(this)),o.br(Te,Te,[-le.x*this.worldSize,-le.y*this.worldSize,0]),o.aB(P,P,Te),o.aB(L,L,Te),this.inverseAdjustmentMatrix=o.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cS([],P,[this.worldSize,this.worldSize,this.worldSize/y,1]),this.projMatrix=P,this.invProjMatrix=o.bl(new Float64Array(16),this.projMatrix),l){const le=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);le[8]=2*-t.x/this.width,le[9]=2*t.y/this.height,this.expandedFarZProjMatrix=o.cP([],le,x)}else this.expandedFarZProjMatrix=this.projMatrix;const z=o.bl([],T);this.frustumCorners=o.cT.fromInvProjectionMatrix(z,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!l);const O=new Float32Array(16);o.bA(O),o.cS(O,O,[1,-1,1]),o.cU(O,O,this._pitch),o.bB(O,O,this.angle);const B=o.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bz(B);const G=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;B[8]=2*-t.x/this.width,B[9]=2*(t.y+G)/this.height,this.skyboxMatrix=o.aB(O,B,O);const V=this.point,W=V.x,Y=V.y,se=this.width%2/2,ne=this.height%2/2,te=Math.cos(this.angle),we=Math.sin(this.angle),_e=W-Math.round(W)+te*se+we*ne,be=Y-Math.round(Y)+te*ne+we*se,de=new Float64Array(P);if(o.br(de,de,[_e>.5?_e-1:_e,be>.5?be-1:be,0]),this.alignedProjMatrix=de,P=o.bC(),o.cS(P,P,[this.width/2,-this.height/2,1]),o.br(P,P,[1,-1,0]),this.labelPlaneMatrix=P,P=o.bC(),o.cS(P,P,[1,-1,1]),o.br(P,P,[-1,-1,0]),o.cS(P,P,[2/this.width,2/this.height,1]),this.glCoordMatrix=P,this.pixelMatrix=o.aB(new Float64Array(16),this.labelPlaneMatrix,L),this._calcFogMatrices(),this._distanceTileDataCache={},P=o.bl(new Float64Array(16),this.pixelMatrix),!P)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=P,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cV(this);const le=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.af(le,le,x),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=P;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,d=this._camera.position,g=1/this.height/this._pixelsPerMercatorPixel,y=[t,t,l];o.c5(y,y,g),o.c5(d,d,-1),o.cW(d,d,y);const x=o.bC();o.br(x,x,d),o.cS(x,x,y),this.mercatorFogMatrix=x,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,l,g)}_computeCameraPosition(t){const l=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,d=this._camera.forward(),g=this.point,y=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-t/this.worldSize*this._centerAltitude;return[g.x/this.worldSize-d[0]*y,g.y/this.worldSize-d[1]*y,t/this.worldSize*this._centerAltitude-d[2]*y]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),d=this._camera.position[2],g=t[2];let y=1;this.projection.wrap&&(this.center=this.center.wrap()),g>0&&(y=Math.min((l-d)/g,1)),this._camera.position=o.bH([],this._camera.position,t,y),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,l=this._camera.forward(),{pitch:d,bearing:g}=this._camera.getPitchBearing(),y=o.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,x=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.an(this._maxPitch)),T=Math.max((t[2]-y)/Math.cos(d),x),E=this._zoomFromMercatorZ(T);o.bH(t,t,l,T),this._pitch=o.aA(d,o.an(this.minPitch),o.an(this.maxPitch)),this.angle=o.bT(g,-Math.PI,Math.PI),this._setZoom(o.aA(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,t)*this.tileSize))}zoomFromMercatorZAdjusted(t){let l=0,d=o.cL,g=0,y=1/0;for(;d-l>1e-6&&d>l;){const x=l+.5*(d-l),T=this.tileSize*Math.pow(2,x),E=this.getCameraToCenterDistance(this.projection,x,T),L=this.scaleZoom(E/(Math.max(0,t)*this.tileSize)),P=Math.abs(x-L);P<y&&(y=P,g=x),x<L?l=x:d=x}return g}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,l){const d=Math.min(t.x,l.x),g=Math.max(t.x,l.x),y=Math.min(t.y,l.y),x=Math.max(t.y,l.y);if(y<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const T=[new o.P(d,y),new o.P(g,x),new o.P(d,x),new o.P(g,y)],E=this.renderWorldCopies?-3:0,L=this.renderWorldCopies?4:1;for(const P of T){const z=this.pointRayIntersection(P);if(z.t<0)return!0;const O=this.rayIntersectionCoordinate(z);if(O.x<E||O.y<0||O.x>L||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(t,l){const d=o.ag(o.av([],this._camera.position,t)),g=this._zoomFromMercatorZ(d)+l;return d-this._mercatorZfromZoom(g)}getCameraPoint(){if(this.projection.name==="globe"){const t=function([l,d,g],y){const x=[l,d,g,1];o.aC(x,x,y);const T=x[3]=Math.max(x[3],1e-6);return x[0]/=T,x[1]/=T,x[2]/=T,x}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,t))}}getCameraToCenterDistance(t,l=this.zoom,d=this.worldSize){const g=o.cO(t,l,this.width,this.height,1024),y=t.pixelSpaceConversion(this.center.lat,d,g);let x=.5/Math.tan(.5*this._fov)*this.height*y;return this.isOrthographic&&(x=o.ak(1,x,o.d0(this.pitch>=oa?1:this.pitch/oa))),x}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.aB(t,t,this.globeMatrix),t}getFrustum(t){return o.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,this.projection.zAxisUnit==="meters")}}const xo=(h,t)=>{if(t>0&&h.terrain&&o.w("Cutoff is currently disabled on terrain"),t<=0||h.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const l=h.transform,d=Math.max(Math.abs(l._zoom-(h.minCutoffZoom-1)),1),g=l.isLODDisabled(!1)?o.ah(60,45,l.pitch):o.ah(30,15,l.pitch),y=l._farZ-l._nearZ,x=t*l.height,T=((1-(E=g))*l.cameraToCenterDistance+E*(l._farZ+x))*d;var E;return{shouldRenderCutoff:g<1,uniformValues:{u_cutoff_params:[l._nearZ,l._farZ,(T-l._nearZ)/y,(T-x-l._nearZ)/y]}}},sl=2048;class u1{constructor(t,l){this.aabb=t,this.lastCascade=l}}class Gu{add(t,l){const d=this.receivers[t.key];d!==void 0?(d.aabb.min[0]=Math.min(d.aabb.min[0],l.min[0]),d.aabb.min[1]=Math.min(d.aabb.min[1],l.min[1]),d.aabb.min[2]=Math.min(d.aabb.min[2],l.min[2]),d.aabb.max[0]=Math.max(d.aabb.max[0],l.max[0]),d.aabb.max[1]=Math.max(d.aabb.max[1],l.max[1]),d.aabb.max[2]=Math.max(d.aabb.max[2],l.max[2])):this.receivers[t.key]=new u1(l,null)}clear(){this.receivers={}}get(t){return this.receivers[t.key]}computeRequiredCascades(t,l,d){const g=o.d9.fromPoints(t.points);let y=0;for(const x in this.receivers){const T=this.receivers[x];if(!T||!g.intersectsAabb(T.aabb))continue;T.aabb.min=g.closestPoint(T.aabb.min),T.aabb.max=g.closestPoint(T.aabb.max);const E=T.aabb.getCorners();for(let L=0;L<d.length;L++){let P=!0;for(const z of E){const O=[z[0]*l,z[1]*l,z[2]];if(o.af(O,O,d[L].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){P=!1;break}}if(T.lastCascade=L,y=Math.max(y,L),P)break}}return y+1}}class Hu{constructor(t){this.painter=t,this._enabled=!1,this._drawShadowAfterLayer=-1,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new Gu,this._depthMode=new Dt(t.context.gl.LEQUAL,Dt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const t of this._cascades)t.texture.destroy(),t.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,l){const d=this.painter;if(this._enabled=!1,this._drawShadowAfterLayer=-1,this._receivers.clear(),!l||!l.properties)return;const g=l.properties.get("shadow-intensity"),y=l.properties.get("shadow-draw-before-layer");if(!l.shadowsEnabled()||g<=0)return;let x=-1,T=0;for(const Y of d.style.order){const se=d.style._mergedLayers[Y];se.hasShadowPass()&&!se.isHidden(t.zoom)&&(x=T),y&&y===Y&&(this._drawShadowAfterLayer=T>0?T-1:0),T+=1}if(this._enabled=x>=0,!this.enabled)return;this._drawShadowAfterLayer<0&&(this._drawShadowAfterLayer=x);const E=d.context,L=sl,P=sl;if(this._cascades.length===0||sl!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<2;++Y){const se=d._shadowMapDebug,ne=E.gl,te=E.createFramebuffer(L,P,se?1:0,"texture"),we=new o.T(E,{width:L,height:P,data:null},ne.DEPTH_COMPONENT16);if(te.depthAttachment.set(we.texture),se){const _e=new o.T(E,{width:L,height:P,data:null},ne.RGBA8);te.colorAttachment0.set(_e.texture)}this._cascades.push({framebuffer:te,texture:we,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cB,scale:0})}}this.shadowDirection=ey(l);let z=0;if(t.elevation){const Y=t.elevation,se=[1e4,-1e4];Y.visibleDemTiles.filter(ne=>ne.dem).forEach(ne=>{const te=ne.dem.tree;se[0]=Math.min(se[0],te.minimums[0]),se[1]=Math.max(se[1],te.maximums[0])}),se[0]!==1e4&&(z=(se[1]-se[0])*Y.exaggeration())}const O=1.5*t.cameraToCenterDistance,B=3*O,G=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const se=this._cascades[Y];let ne=t.height/50,te=1;Y===0?te=O:(ne=O,te=B);const[we,_e]=ty(t,this.shadowDirection,ne,te,sl,z);se.scale=t.scale,se.matrix=we,se.boundingSphereRadius=_e,o.bl(G,se.matrix),se.frustum=o.cB.fromInvProjectionMatrix(G,1,0,!0),se.far=te}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=g,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=sl,this._uniformValues.u_shadowmap_0=11,this._uniformValues.u_shadowmap_1=12,this._groundShadowTiles=d.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const W=d.transform.elevation;for(const Y of this._groundShadowTiles){let se={min:0,max:0};if(W){const ne=W.getMinMaxForTile(Y);ne&&(se=ne)}this.addShadowReceiver(Y.toUnwrapped(),se.min,se.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(t){this._enabled=t}drawShadowPass(t,l){if(!this.enabled)return;const d=this.painter,g=d.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(d.transform.getFrustum(0),d.transform.worldSize,this._cascades),g.viewport.set([0,0,sl,sl]);for(let y=0;y<this._numCascadesToRender;++y){d.currentShadowCascade=y,g.bindFramebuffer.set(this._cascades[y].framebuffer.framebuffer),g.clear({color:o.ao.white,depth:1});for(const x of t.order){const T=t._mergedLayers[x];if(!T.hasShadowPass()||T.isHidden(d.transform.zoom))continue;const E=t.getLayerSourceCache(T),L=E?l[E.id]:void 0;(T.type==="model"||L&&L.length)&&d.renderLayer(d,E,T,L)}}d.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const t=this.painter,l=t.style,d=t.context,g=d.gl,y=l.directionalLight,x=l.ambientLight;if(!y||!x)return;const T=[],E=xo(t,t.longestCutoffRange);E.shouldRenderCutoff&&T.push("RENDER_CUTOFF"),T.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&T.push("NORMAL_OFFSET");const L=bo(l,y,x),P=new Dt(g.LEQUAL,Dt.ReadOnly,t.depthRangeFor3D),z=new Yt({func:g.EQUAL,mask:255},0,255,g.KEEP,g.KEEP,g.KEEP);for(const O of this._groundShadowTiles){const B=O.toUnwrapped(),G=t.isTileAffectedByFog(O),V=t.getOrCreateProgram("groundShadow",{defines:T,overrideFog:G});this.setupShadows(B,V),t.uploadCommonUniforms(d,V,B,null,E);const W=bs(t.transform.calculateProjMatrix(B),L);V.draw(t,g.TRIANGLES,P,z,ri.multiply,Zt.disabled,W,"ground_shadow",t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments,null,t.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?ri.unblended:ri.disabled}getShadowPassDepthMode(){return this._depthMode}getGroundShadowLayerIndex(){return this._drawShadowAfterLayer}calculateShadowPassMatrixFromTile(t){const l=this.painter.transform,d=l.calculatePosMatrix(t,l.worldSize);return o.aB(d,this._cascades[this.painter.currentShadowCascade].matrix,d),Float32Array.from(d)}calculateShadowPassMatrixFromMatrix(t){const l=o.bz(t);return o.aB(l,this._cascades[this.painter.currentShadowCascade].matrix,t),l}setupShadows(t,l,d){if(!this.enabled)return;const g=this.painter.transform,y=this.painter.context,x=y.gl,T=this._uniformValues,E=new Float64Array(16),L=g.calculatePosMatrix(t,g.worldSize);for(let P=0;P<this._cascades.length;P++)o.aB(E,this._cascades[P].matrix,L),T[P===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(E),y.activeTexture.set(x.TEXTURE0+11+P),this._cascades[P].texture.bindExtraParam(x.LINEAR,x.LINEAR,x.CLAMP_TO_EDGE,x.CLAMP_TO_EDGE,x.GREATER);if(this.useNormalOffset=!!d,this.useNormalOffset){const P=o.d7(t.canonical),z=2/g.tileSize*o.al/sl,O=z*this._cascades[0].boundingSphereRadius,B=z*this._cascades[this._cascades.length-1].boundingSphereRadius,G=(d==="vector-tile"?1:3)*function(V){const W=o.aA((V-22)/-22,0,1);return .125*(1-W)+4*W}(g.zoom);T.u_shadow_normal_offset=[P,O*G,B*G],T.u_shadow_bias=[1e-4,.0012,.012]}else T.u_shadow_bias=[36e-5,.0012,.012];l.setShadowUniformValues(y,T)}setupShadowsFromMatrix(t,l,d=!1){if(!this.enabled)return;const g=this.painter.context,y=g.gl,x=this._uniformValues,T=new Float64Array(16);for(let E=0;E<2;E++)o.aB(T,this._cascades[E].matrix,t),x[E===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(T),g.activeTexture.set(y.TEXTURE0+11+E),this._cascades[E].texture.bindExtraParam(y.LINEAR,y.LINEAR,y.CLAMP_TO_EDGE,y.CLAMP_TO_EDGE,y.GREATER);this.useNormalOffset=d,d?(x.u_shadow_normal_offset=[1,3,3],x.u_shadow_bias=[6e-5,.0012,.012]):x.u_shadow_bias=[36e-5,.0012,.012],l.setShadowUniformValues(g,x)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,l,d,g){if(g[2]>=0)return{};const y=function(E,L,P){const z=P/(1<<E.canonical.z);return new o.d9([E.canonical.x*z+E.wrap*P,E.canonical.y*z+E.wrap*P,0],[(E.canonical.x+1)*z+E.wrap*P,(E.canonical.y+1)*z+E.wrap*P,L])}(t,l,d).getCorners(),x=l/-g[2];g[0]<0?(o.d8(y[0],y[0],[g[0]*x,0,0]),o.d8(y[3],y[3],[g[0]*x,0,0])):g[0]>0&&(o.d8(y[1],y[1],[g[0]*x,0,0]),o.d8(y[2],y[2],[g[0]*x,0,0])),g[1]<0?(o.d8(y[0],y[0],[0,g[1]*x,0]),o.d8(y[1],y[1],[0,g[1]*x,0])):g[1]>0&&(o.d8(y[2],y[2],[0,g[1]*x,0]),o.d8(y[3],y[3],[0,g[1]*x,0]));const T={};return T.vertices=y,T.planes=[fd(y[1],y[0],y[4]),fd(y[2],y[1],y[5]),fd(y[3],y[2],y[6]),fd(y[0],y[3],y[7])],T}addShadowReceiver(t,l,d){this._receivers.add(t,o.d9.fromTileIdAndHeight(t,l,d))}getMaxCascadeForTile(t){const l=this._receivers.get(t);return l&&l.lastCascade?l.lastCascade:0}}function fd(h,t,l){const d=o.av([],l,t),g=o.av([],h,t),y=o.bI([],d,g),x=o.ag(y);return x===0?[0,0,1,0]:(o.c5(y,y,1/x),[y[0],y[1],y[2],-o.bJ(y,t)])}function ey(h){const t=h.properties.get("direction"),l=o.d4(t.x,t.y,t.z);l[2]=o.aA(l[2],0,75);const d=o.d6([l[0],l[1],l[2]]);return o.d5(d.x,d.y,d.z)}function bo(h,t,l){const d=t.properties.get("color-use-theme")==="none",g=t.properties.get("color"),y=t.properties.get("intensity"),x=t.properties.get("direction"),T=[x.x,x.y,x.z],E=l.properties.get("color-use-theme")==="none",L=l.properties.get("color"),P=l.properties.get("intensity"),z=Math.max(o.bJ([0,0,1],T),0),O=[0,0,0];o.c5(O,L.toPremultipliedRenderColor(E?null:h.getLut(t.scope)).toArray01Linear().slice(0,3),P);const B=[0,0,0];return o.c5(B,g.toPremultipliedRenderColor(d?null:h.getLut(l.scope)).toArray01Linear().slice(0,3),z*y),o.db([O[0]>0?O[0]/(O[0]+B[0]):0,O[1]>0?O[1]/(O[1]+B[1]):0,O[2]>0?O[2]/(O[2]+B[2]):0])}function ty(h,t,l,d,g,y){const x=h.zoom,T=h.scale,E=h.worldSize,L=1/E,P=h.aspect,z=Math.sqrt(1+P*P)*Math.tan(.5*h.fovX),O=z*z,B=d-l,G=d+l;let V,W;O>B/G?(V=d,W=d*z):(V=.5*G*(1+O),W=.5*Math.sqrt(B*B+2*(d*d+l*l)*O+G*G*O*O));const Y=h.projection.pixelsPerMeter(h.center.lat,E),se=h._camera.getCameraToWorldMercator(),ne=[0,0,-V*L];o.af(ne,ne,se);let te=W*L;const we=function(ot){return ot[0]/=T,ot[1]/=T,ot[2]=o.cf(ot[2],h._center.lat),ot},_e=h._edgeInsets;if(!(_e.left===0&&_e.top===0&&_e.right===0&&_e.bottom===0||_e.left===_e.right&&_e.top===_e.bottom)){const ot=h._camera.getWorldToCamera(h.worldSize,h.projection.zAxisUnit==="meters"?Y:1),ht=h._camera.getCameraToClipPerspective(h._fov,h.width/h.height,l,d);ht[8]=2*-h.centerOffset.x/h.width,ht[9]=2*h.centerOffset.y/h.height;const yt=new Float64Array(16);o.cP(yt,ht,ot);const dt=new Float64Array(16);o.bl(dt,yt);const pt=o.cB.fromInvProjectionMatrix(dt,E,x,!0);for(const Mt of pt.points){const Lt=we(Mt);te=Math.max(te,o.c6(o.da([],ne,Lt)))}}te*=g/(g-1);const be=Math.acos(t[2]),de=Math.atan2(-t[0],-t[1]),le=new Tc;le.position=ne,le.setPitchBearing(be,de);const Te=le.getWorldToCamera(E,Y),Me=te*E,Oe=Math.min(h._mercatorZfromZoom(17)*E*-2,-2*Me),Ve=le.getCameraToClipOrthographic(-Me,Me,-Me,Me,Oe,(Me+y*Y)/t[2]),je=new Float64Array(16);o.aB(je,Ve,Te);const Ye=o.d5(Math.floor(1e6*ne[0])/1e6*E,Math.floor(1e6*ne[1])/1e6*E,0),nt=.5*g,Fe=[0,0,0];o.af(Fe,Ye,je),o.c5(Fe,Fe,nt);const Ie=[Math.floor(Fe[0]),Math.floor(Fe[1]),Math.floor(Fe[2])],Xe=[0,0,0];o.av(Xe,Fe,Ie),o.c5(Xe,Xe,-1/nt);const $e=new Float64Array(16);return o.bA($e),o.br($e,$e,Xe),o.aB(je,$e,je),[je,Me]}class pd extends o.E{constructor(t){super(),this.requestManager=t,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,l){return o.dc(this.requestManager.transformRequest(l,o.R.Model).url).then(d=>{if(!d)return;const g=o.dd(d),y=new o.de(t,l,void 0,void 0,g);return y.computeBoundsAndApplyParent(),y}).catch(d=>{if(d&&d.status===404)return null;this.fire(new o.y(new Error(`Could not load model ${t} from ${l}: ${d.message}`)))})}load(t,l,d={forceReload:!1}){this.models[l]||(this.models[l]={});const g=Object.keys(t),y=[],x=[];for(const T of g){const E=t[T];this.hasURLBeenRequested(E)&&!d.forceReload||(this.modelByURL[E]={modelId:T,scope:l},y.push(this.loadModel(T,E)),x.push(T)),this.models[l][T]||(this.models[l][T]={model:null,numReferences:1})}this.numModelsLoading[l]=(this.numModelsLoading[l]||0)+x.length,Promise.allSettled(y).then(T=>{for(let E=0;E<T.length;E++){const{status:L}=T[E];if(L==="rejected")continue;const{value:P}=T[E];this.models[l][x[E]]||(this.models[l][x[E]]={model:null,numReferences:1}),this.models[l][x[E]].model=P}this.numModelsLoading[l]-=x.length,this.fire(new o.z("data",{dataType:"style"}))}).catch(T=>{this.fire(new o.y(new Error(`Could not load models: ${T.message}`)))})}isLoaded(){for(const t in this.numModelsLoading)if(this.numModelsLoading[t]>0)return!1;return!0}hasModel(t,l,d={exactIdMatch:!1}){return!!(d.exactIdMatch?this.getModel(t,l):this.getModelByURL(this.modelUris[l][t]))}getModel(t,l){return this.models[l]||(this.models[l]={}),this.models[l][t]?this.models[l][t].model:void 0}getModelByURL(t){if(!t)return null;const l=this.modelByURL[t];return l?this.models[l.scope][l.modelId].model:null}hasModelBeenAdded(t,l){return this.models[l]&&this.models[l][t]!==void 0}getModelURIs(t){return this.modelUris[t]||{}}addModel(t,l,d){this.models[d]||(this.models[d]={}),this.modelUris[d]||(this.modelUris[d]={});const g=this.requestManager.normalizeModelURL(l);if((this.hasModel(t,d,{exactIdMatch:!0})||this.hasModelBeenAdded(t,d))&&this.modelUris[d][t]===g)this.models[d][t].numReferences++;else if(this.hasURLBeenRequested(g)){const{scope:y,modelId:x}=this.modelByURL[g];this.models[y][x].numReferences++}else this.modelUris[d][t]=g,this.load({[t]:this.modelUris[d][t]},d)}addModelURLs(t,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d=this.modelUris[l];for(const g in t)d[g]=this.requestManager.normalizeModelURL(t[g])}reloadModels(t){this.load(this.modelUris[t],t,{forceReload:!0})}addModelsFromBucket(t,l){this.models[l]||(this.models[l]={}),this.modelUris[l]||(this.modelUris[l]={});const d={};for(const g of t)this.hasModel(g,l,{exactIdMatch:!0})||this.hasURLBeenRequested(g)?this.models[l][g].numReferences++:this.modelUris[l][g]&&!this.hasURLBeenRequested(g)?d[g]=this.modelUris[l][g]:!this.hasURLBeenRequested(g)&&o.df(g,!1)&&(this.modelUris[l][g]=this.requestManager.normalizeModelURL(g),d[g]=this.modelUris[l][g]);this.load(d,l)}hasURLBeenRequested(t){return this.modelByURL[t]!==void 0}removeModel(t,l,d=!1,g=!1){if(this.models[l]&&this.models[l][t]&&(this.models[l][t].numReferences--,this.models[l][t].numReferences===0||g)){const y=this.modelUris[l][t];d||delete this.modelUris[l][t],delete this.modelByURL[y];const x=this.models[l][t].model;if(!x)return;delete this.models[l][t],x.destroy()}}destroy(){for(const t of Object.keys(this.models))for(const l of Object.keys(this.models[t])){const d=this.models[t][l].model;delete this.models[t][l],d&&d.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(t){return this.models[t]||(this.models[t]={}),Object.keys(this.models[t])}upload(t,l){this.models[l]||(this.models[l]={});for(const d in this.models[l])this.models[l][d].model&&this.models[l][d].model.upload(t.context)}}const Wu=o.a6.colorTheme,ol=new o.a9({data:new o.aa(Wu.data)});function h1(h){if(!h.metadata||!h.metadata.content_area)return;const t=o.o.devicePixelRatio,{left:l,top:d,width:g,height:y}=h.metadata.content_area,x=l*t,T=d*t;return[x,T,x+g*t,T+y*t]}function iy(h){if(h)return h.map(([t,l])=>[t*o.o.devicePixelRatio,l*o.o.devicePixelRatio])}class d1{constructor(t,l,d){this.id=t,this.scope=l,this.sourceCache=d,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(t){this.missingRequests.has(t.name)||this.pendingRequests.has(t.name)||this.pendingRequests.add(t.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const l=this.sourceCache.getVisibleCoordinates();if(l.length===0)return t;const d=this.sourceCache.getSource();if(!(d instanceof is))return t;const g=l.map(x=>this.sourceCache.getTile(x)),y=d.getImages(g,Array.from(this.pendingRequests));for(const[x,T]of y)t.set(o.I.from({name:x,iconsetId:this.id}),T),this.pendingRequests.delete(x);for(const x of this.pendingRequests)this.missingRequests.add(x);return this.pendingRequests.clear(),t}}class Rp{constructor(){o.aY(["_onIndoorUpdate"],this)}onAdd(t){return this._map=t,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.style&&this._map.style.indoorManager.on("selector-update",l=>this._onIndoorUpdate(l)),this._container}_createButton(t,l){const d=xe("button",t,this._container);return d.type="button",d.addEventListener("click",l),d}_createSeparator(){return xe("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(t,l){this._map&&(t.setAttribute("aria-label",l),t.textContent=l)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.style&&(this._map.style.indoorManager.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(t){if(!t||!t.floors)return this._model=t,void(this._container.style.display="none");const l=this._model;this._model=t,this._container.style.display="inline-block",this._container.style.borderRadius="8px",l&&Array.from(this._container.children).forEach(d=>d.remove()),t.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(t.floors,t.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const t=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const l=this._map;this._model&&l&&l._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});xe("span","mapboxgl-ctrl-icon",t).setAttribute("aria-hidden","true"),t.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&t.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(t),this._createSeparator()}_updateBuildingsButtonState(){const t=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");t&&this._model&&(this._model.activeFloorsVisible?t.classList.remove("mapboxgl-ctrl-level-button-selected"):t.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(t,l){for(let d=0;d<t.length;d++){const g=t[d],y=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(g.id)}),x=(g.name||"").trim(),T=g.zIndex.toString(),E=x?Array.from(x).slice(0,3).join(""):T;this._setButtonTitle(y,E),this._model&&g.id===this._model.selectedFloorId&&l&&y.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(y),d<t.length-1&&this._createSeparator()}}}class f1 extends o.E{constructor(t){super(),this._style=t,this._buildings={},this._indoorControl=null,this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},o.aY(["_updateUI"],this),this._style.on("style.load",()=>{this._style.isIndoorEnabled()&&(this._style.map.on("load",this._updateUI),this._style.map.on("move",this._updateUI),this._style.map.on("idle",this._updateUI),this._updateUI())})}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null,this._removeIndoorControl()}selectFloor(t){t===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=t,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(t){this._activeFloorsVisible=t,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(t){for(const[l,d]of Object.entries(t.buildings))if(this._buildings[l])for(const g of d.floorIds)this._buildings[l].floors[g]||(this._buildings[l].floors[g]=d.floors[g]);else this._buildings[l]=d;for(const l of t.activeFloors)this._activeFloors.add(l);this._updateIndoorSelector()}getIndoorTileOptions(t,l){const d=this._style.getIndoorSourceLayers(t,l);return d&&this._indoorState?{sourceLayers:d,indoorState:this._indoorState}:null}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Rp,this._style.map.addControl(this._indoorControl,"right"))}_removeIndoorControl(){this._indoorControl&&(this._indoorControl.onRemove(),this._indoorControl=null)}_updateUI(){const t=this._style.map.transform,l=function(d,g,y,x){let T=null,E=Number.MAX_SAFE_INTEGER;if(x<16)return null;for(const[L,P]of Object.entries(d)){const z=P.center;if(z){const O=g.distanceTo(o.aT.convert(z));O<E&&y.contains(z)&&(E=O,T=L)}}return T}(this._buildings,t.center,t.getBounds(),t.zoom);l!==this._closestBuildingId&&(this._closestBuildingId=l,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,l=this._closestBuildingId,d=l&&t?t[l]:void 0;if(!d)return this._removeIndoorControl(),void this.fire(new o.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));this._addIndoorControl();let g=null;for(const x of d.floorIds)if(this._activeFloors&&this._activeFloors.has(x)){g=x;break}const y=Array.from(d.floorIds).map(x=>({id:x,name:d.floors[x].name,zIndex:d.floors[x].zIndex})).sort((x,T)=>T.zIndex-x.zIndex).filter((x,T,E)=>T===0||x.zIndex!==E[T-1].zIndex);this.fire(new o.z("selector-update",{selectedFloorId:g,activeFloorsVisible:this._activeFloorsVisible,floors:y}))}_updateActiveFloors(){const t=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:t,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}const Da=(h,t)=>Pe(h,t&&t.filter(l=>l.identifier!=="source.canvas")),ry=o.aH(Oi,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),ny=o.aH(Oi,["setCenter","setZoom","setBearing","setPitch"]),md=new Set(["background","sky","slot","custom"]),Dp={version:8,layers:[],sources:{}},al={duration:300,delay:0};class zs extends o.E{constructor(t,l={}){super(),this.map=t,this.scope=l.scope||"",this.globalId=null,this.fragments=[],this.importDepth=l.importDepth||0,this.importsCache=l.importsCache||new Map,this.resolvedImports=l.resolvedImports||new Set,this.transition=Object.assign({},al),this._buildingIndex=new Bu(this),this.crossTileSymbolIndex=new Qr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=l.styleChanges||new Dr,this._hasDataDrivenEmissive=!1,this.indoorManager=new f1(this),this.dispatcher=l.dispatcher?l.dispatcher:new o.D(o.dh(),this),l.imageManager?this.imageManager=l.imageManager:(this.imageManager=new Lo(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=l.glyphManager?l.glyphManager:new o.di(t._requestManager,l.localFontFamily?o.dj.all:l.localIdeographFontFamily?o.dj.ideographs:o.dj.none,l.localFontFamily||l.localIdeographFontFamily),l.modelManager?this.modelManager=l.modelManager:(this.modelManager=new pd(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=l.configOptions?l.configOptions:new Map,this._configDependentLayers=l.configDependentLayers?l.configDependentLayers:new Set,this._indoorDependentLayers=l.indoorDependentLayers?l.indoorDependentLayers:new Set,this._config=l.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:l.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=l.initialConfig,this.dispatcher.broadcast("setReferrer",o.dk());const d=this;this._rtlTextPluginCallback=zs.registerForPluginStateChange(g=>{d.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:g.pluginStatus,pluginURL:g.pluginURL},(y,x)=>{if(o.dl(y),x&&x.every(T=>T))for(const T in d._sourceCaches){const E=d._sourceCaches[T],L=E.getSource().type;L!=="vector"&&L!=="geojson"||E.reload()}})}),this.on("data",g=>{if(g.dataType!=="source"||g.sourceDataType!=="metadata")return;const y=this.getOwnSource(g.sourceId);if(y&&y.vectorLayerIds)for(const x in this._layers){const T=this._layers[x];T.source===y.id&&this._validateLayer(T)}})}load(t){return t?(typeof t=="string"?this.loadURL(t):this.loadJSON(t),this):this}_getGlobalId(t){if(!t)return null;if(typeof t=="string"){if(o.h(t))return t;const l=o.dm(t);if(!l.startsWith("http"))try{return new URL(l,location.href).toString()}catch{return l}return l}return`json://${o.dn(JSON.stringify(t))}`}_diffStyle(t,l,d){this.globalId=this._getGlobalId(t);const g=(y,x)=>{try{x(null,this.setState(y,d))}catch(T){x(T,!1)}};if(typeof t=="string"){const y=this.map._requestManager.normalizeStyleURL(t),x=this.map._requestManager.transformRequest(y,o.R.Style);o.m(x,(T,E)=>{T?this.fire(new o.y(T)):E&&g(E,l)})}else typeof t=="object"&&g(t,l)}loadURL(t,l={}){this.fire(new o.z("dataloading",{dataType:"style"}));const d=typeof l.validate=="boolean"?l.validate:!o.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,l.accessToken),this.resolvedImports.add(t);const g=this.importsCache.get(t);if(g)return this._load(g,d);const y=this.map._requestManager.transformRequest(t,o.R.Style);this._request=o.m(y,(x,T)=>{if(this._request=null,x)this.fire(new o.y(x));else if(T)return this.importsCache.set(t,T),this._load(T,d)})}loadJSON(t,l={}){this.fire(new o.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=o.o.frame(()=>{this._request=null,this._load(t,l.validate!==!1)})}loadEmpty(){this.fire(new o.z("dataloading",{dataType:"style"})),this._load(Dp,!1)}_loadImports(t,l,d){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const g=[];for(const y of t){const x=this._createFragmentStyle(y),T=new Promise(P=>{x.once("style.import.load",P),x.once("error",P)}).then(()=>this.mergeAll());if(g.push(T),this.resolvedImports.has(y.url)){x.loadEmpty();continue}const E=y.data||this.importsCache.get(y.url);E?(x.loadJSON(E,{validate:l}),this._isInternalStyle(E)&&(x.globalId=null)):y.url?x.loadURL(y.url,{validate:l}):x.loadEmpty();const L={style:x,id:y.id,config:y.config};if(d){const P=this.fragments.findIndex(({id:z})=>z===d);this.fragments=this.fragments.slice(0,P).concat(L).concat(this.fragments.slice(P))}else this.fragments.push(L)}return Promise.allSettled(g)}getImportGlobalIds(t=this,l=new Set){for(const d of t.fragments)d.style.globalId&&l.add(d.style.globalId),this.getImportGlobalIds(d.style,l);return[...l.values()]}_createFragmentStyle(t){const l=this.scope?o.B(t.id,this.scope):t.id;let d;const g=this._initialConfig&&this._initialConfig[l];(t.config||g)&&(d=Object.assign({},t.config,g));const y=new zs(this.map,{scope:l,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:d,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return y.setEventedParent(this.map,{style:y}),y}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(t){return this.isRootStyle()&&(t.fragment||!!t.schema&&t.fragment!==!1)}_load(t,l){if(this._isInternalStyle(t)){const y=Object.assign({},Dp,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(y,l)}if(this.updateConfig(this._config,t.schema),l&&Da(this,Bn(t)))return;this._loaded=!0,this.stylesheet=o.dp(t);const d=()=>{for(const E in t.sources)this.addSource(E,t.sources[E],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const E in t.iconsets)this.addIconset(E,t.iconsets[E]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const y=Tp(this.stylesheet.layers);if(this._order=y.map(E=>E.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const E=this.stylesheet.lights[0];this.light=new He(E.properties,E.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new He(this.stylesheet.light)),this._layers={};for(const E of y){const L=o.du(E,this.scope,this._styleColorTheme.lut,this.options);L.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(L.fqid),L.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(L.fqid),this._hasAppearances=this._hasAppearances||L.getAppearances().length!==0,L.setEventedParent(this,{layer:{id:L.id}}),this._layers[L.id]=L;const P=this.getOwnLayerSourceCache(L),z=!!this.directionalLight&&this.directionalLight.shadowsEnabled();P&&L.canCastShadows()&&z&&(P.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const x=this.stylesheet.terrain;x&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(x,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.z("data",{dataType:"style"}));const T=this.isRootStyle();t.imports?this._loadImports(t.imports,l).then(()=>{this._reloadImports(),this.fire(new o.z(T?"style.load":"style.import.load"))}).catch(E=>{this.fire(new o.y(new Error("Failed to load imports",E))),this.fire(new o.z(T?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.z(T?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const g=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(g){const y=this._evaluateColorThemeData(g);this._loadColorTheme(y).then(()=>{d()}).catch(x=>{o.w(`Couldn't load color theme from the stylesheet: ${x}`),d()})}else this._styleColorTheme.lut=null,d()}isRootStyle(){return this.importDepth===0}hasAppearances(){return this._hasAppearances||this.fragments.some(t=>t.style.hasAppearances())}mergeAll(){let t,l,d,g,y,x,T,E,L,P;const z={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(t=O.light),O.stylesheet.lights)for(const B of O.stylesheet.lights)B.type==="ambient"&&O.ambientLight!=null&&(l=O.ambientLight),B.type==="directional"&&O.directionalLight!=null&&(d=O.directionalLight);g=this._prioritizeTerrain(g,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(y=O.fog),O.stylesheet.snow&&O.snow!=null&&(x=O.snow),O.stylesheet.rain&&O.rain!=null&&(T=O.rain),O.stylesheet.camera!=null&&(P=O.stylesheet.camera),O.stylesheet.projection!=null&&(E=O.stylesheet.projection),O.stylesheet.transition!=null&&(L=O.stylesheet.transition),z[O.scope]=O._styleColorTheme}}),this.light=t,this.ambientLight=l,this.directionalLight=d,this.fog=y,this.snow=x,this.rain=T,this._styleColorThemeForScope=z,g===null?delete this.terrain:this.terrain=g,this.camera=P||{"camera-projection":"perspective"},this.projection=E||{name:"mercator"},this.transition=Object.assign({},al,L),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(t){const l=d=>{for(const g of d.fragments)l(g.style);t(d)};l(this)}_prioritizeTerrain(t,l,d){const g=t&&t.drapeRenderMode===0;return d===null?l&&l.drapeRenderMode===0?l:g?t:null:l!=null&&(!t||g||l&&l.drapeRenderMode===1)?l:t}mergeTerrain(){let t;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(l=>{t=this._prioritizeTerrain(t,l.terrain,l.stylesheet.terrain)}),t===null?delete this.terrain:this.terrain=t}mergeProjection(){let t;this.forEachFragmentStyle(l=>{l.stylesheet.projection!=null&&(t=l.stylesheet.projection)}),this.projection=t||{name:"mercator"}}mergeSources(){const t={},l={},d={};this.forEachFragmentStyle(g=>{for(const y in g._sourceCaches){const x=o.B(y,g.scope);t[x]=g._sourceCaches[y]}for(const y in g._otherSourceCaches){const x=o.B(y,g.scope);l[x]=g._otherSourceCaches[y]}for(const y in g._symbolSourceCaches){const x=o.B(y,g.scope);d[x]=g._symbolSourceCaches[y]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=l,this._mergedSymbolSourceCaches=d}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const l of Object.values(t.stylesheet.indoor)){const d=l,g=o.B(d.sourceId,t.scope);this._mergedIndoor[g]=new Set(d.sourceLayers||[])}})}mergeLayers(){const t={},l=[],d={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(x=>{for(const T of x._order){const E=x._layers[T];if(E.type==="slot"){const L=o.dq(T);if(t[L])continue;t[L]=[]}E.slot&&t[E.slot]?t[E.slot].push(E):l.push(E)}}),this._mergedOrder=[];let g=-1;const y=(x=[])=>{for(const T of x)if(T.type==="slot"){const E=o.dq(T.id);t[E]&&y(t[E]),this._mergedSlots.push(E)}else{const E=o.B(T.id,T.scope);this._mergedOrder.push(E),d[E]=T,T.is3D(!!this.terrain)&&(this._has3DLayers=!0,g=this._mergedOrder.length-1),T.type==="circle"&&(this._hasCircleLayers=!0),T.type==="symbol"&&(this._hasSymbolLayers=!0),T.type==="clip"&&(this._clipLayerPresent=!0)}};if(y(l),this._has3DLayers){const x={};for(let T=0;T<this._mergedOrder.length;++T){const E=this._mergedOrder[T];x[E]=T===g?1:T<g?d[E].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((T,E)=>x[T]-x[E])}this._mergedLayers=d,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(t){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,t),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(l,d,g){const y=Object.assign({},d);for(const T of Object.keys(Wu))y[T]===void 0&&(y[T]=Wu[T].default);const x=new o.a8(ol,l,new Map(g));return x.setTransitionOrValue(y,g),x.untransitioned().possiblyEvaluate(new o.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const l=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((d,g)=>{const y="data:image/png;base64,";if(!t||t.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void d();let x=t;x.startsWith(y)||(x=y+x);const T=o.I.from("mapbox-reserved-lut"),E=new Image;E.src=x,E.onerror=()=>{this._styleColorTheme.lutLoading=!1,g(new Error("Failed to load image data"))},E.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==l)return void d();this._styleColorTheme.lutLoading=!1;const{width:L,height:P,data:z}=o.o.getImageData(E);if(P>32)return void g(new Error("The height of the image must be less than or equal to 32 pixels."));if(L!==P*P)return void g(new Error("The width of the image must be equal to the height squared."));this.getImage(T)&&this.removeImage(T),this.addImage(T,{data:new o.q({width:L,height:P},z),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(T,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:t},d()):g(new Error("Missing LUT image."))}})}getLut(t){const l=this._styleColorThemeForScope[t];return l?l.lut:null}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(l,d,g){let y,x,T;const E=o.o.devicePixelRatio>1?"@2x":"";let L=o.m(d.transformRequest(d.normalizeSpriteURL(l,E,".json"),o.R.SpriteJSON),(O,B)=>{L=null,T||(T=O,y=B,z())}),P=o.n(d.transformRequest(d.normalizeSpriteURL(l,E,".png"),o.R.SpriteImage),(O,B)=>{P=null,T||(T=O,x=B,z())});function z(){if(T)g(T);else if(y&&x){const O=o.o.getImageData(x),B={};for(const G in y){const{width:V,height:W,x:Y,y:se,sdf:ne,pixelRatio:te,stretchX:we,stretchY:_e,content:be}=y[G],de=new o.q({width:V,height:W});o.q.copy(O,de,{x:Y,y:se},{x:0,y:0},{width:V,height:W},null),B[G]={data:de,pixelRatio:te!==void 0?te:1,sdf:ne!==void 0&&ne,stretchX:we,stretchY:_e,content:be,usvg:!1,version:0}}g(null,B)}}return{cancel(){L&&(L.cancel(),L=null),P&&(P.cancel(),P=null)}}}(t,this.map._requestManager,(l,d)=>{if(this._spriteRequest=null,l)this.fire(new o.y(l));else if(d){const g=new Map;for(const y in d)g.set(o.I.from(y),d[y]);this.addImages(g)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))})}addIconset(t,l){if(l.type==="sprite")return void this._loadSprite(l.url);const d=this.getOwnSourceCache(l.source);if(!d)return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${t}" does not exist and cannot be used as an iconset source`)));const g=d.getSource();if(g.type!=="raster-array")return void this.fire(new o.y(new Error(`Source "${l.source}" as specified by iconset "${t}" is not a "raster-array" source and cannot be used as an iconset source`)));g.partial=!1;const y=new d1(t,this.scope,d);this.imageManager.addImageProvider(y,this.scope)}removeIconset(t){this.imageManager.removeImageProvider(t,this.scope)}_loadIconset(t){if(!o.h(t)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(t);const l=this.map._spriteFormat==="auto";var d,g;this._spriteRequest=(g=(y,x)=>{if(this._spriteRequest=null,y)l?this._loadSprite(t):this.fire(new o.y(y));else if(x){const T=new Map;for(const E in x)T.set(o.I.from(E),x[E]);this.addImages(T)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.z("data",{dataType:"style"}))},o.bu((d=this.map._requestManager).transformRequest(d.normalizeIconsetURL(t),o.R.Iconset),(y,x)=>{if(y)return void g(y);const T={},E=o.dg(new o.bt(x));for(const L of E.icons){const P={version:1,pixelRatio:o.o.devicePixelRatio,content:h1(L),stretchX:L.metadata?iy(L.metadata.stretch_x_areas):void 0,stretchY:L.metadata?iy(L.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:L};T[L.name]=P}g(null,T)}))}_validateLayer(t){const l=this.getOwnSource(t.source);if(!l)return;const d=t.sourceLayer;d&&(l.type==="geojson"||l.vectorLayerIds&&l.vectorLayerIds.indexOf(d)===-1)&&this.fire(new o.y(new Error(`Source layer "${d}" does not exist on source "${l.id}" as specified by style layer "${t.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:t}of this.fragments)if(!t.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((t,l)=>{const d=this.fragments[l];return d&&d.style&&(t.data=d.style.serialize()),t})}_serializeSources(){const t={};for(const l in this._sourceCaches){const d=this._sourceCaches[l].getSource();t[d.id]||(t[d.id]=d.serialize())}return t}_serializeLayers(t){const l=[];for(const d of t){const g=this._layers[d];g&&g.type!=="custom"&&l.push(g.serialize())}return l}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const t in this._mergedLayers){const l=this._mergedLayers[t];if(l._transitionablePaint&&l._transitionablePaint._values){const d=l._transitionablePaint._values["line-emissive-strength"];if(d&&d.value&&d.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(t){return t?this.order:this._mergedOrder}isLayerDraped(t){return!!this.terrain&&t.isDraped(this.getLayerSourceCache(t))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const l=this.getOwnLayer(t);if(l)return l;this.fire(new o.y(new Error(`The layer '${t}' does not exist in the map's style.`)))}_checkSource(t){const l=this.getOwnSource(t);if(l)return l;this.fire(new o.y(new Error(`The source '${t}' does not exist in the map's style.`)))}precompilePrograms(t,l){const d=this.map.painter;if(d)for(let g=t.minzoom||0;g<(t.maxzoom||25.5);g++){const y=t.getProgramIds();if(y)for(const x of y){const T=t.getDefaultProgramParams(x,l.zoom,this._styleColorTheme.lut);T&&(d.style=this,this.fog&&(d._fogVisible=!0,T.overrideFog=!0,d.getOrCreateProgram(x,T)),d._fogVisible=!1,T.overrideFog=!1,d.getOrCreateProgram(x,T),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(T.overrideRtt=!0,d.getOrCreateProgram(x,T)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const l=this.calculateLightsBrightness();t.brightness=l||0,l!==this._brightness&&(this._brightness=l,this.dispatcher.broadcast("setBrightness",l)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const d=this._changes.isDirty();let g=!1;if(this._changes.isDirty()){const T=this._changes.getLayerUpdatesByScope();for(const E in T){const{updatedIds:L,removedIds:P}=T[E];(L||P)&&(this._updateWorkerLayers(E,L,P),g=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const y={};for(const T in this._mergedSourceCaches){const E=this._mergedSourceCaches[T];y[T]=E.used,E.used=!1,E.tileCoverLift=0}for(const T of this._mergedOrder){const E=this._mergedLayers[T];if(E.visibility!=="none"&&E.recalculate(t,this._availableImages),!E.isHidden(t.zoom)){const L=this.getLayerSourceCache(E);L&&(L.used=!0,L.tileCoverLift=Math.max(L.tileCoverLift,E.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(E,t)}):this.precompilePrograms(E,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&g&&this.mergeLayers();const x=this.imageManager.getPendingImageProviders();for(const T of x)T.sourceCache.used=!0;for(const T in y){const E=this._mergedSourceCaches[T];y[T]!==E.used&&E.getSource().fire(new o.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:E.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),d&&this.fire(new o.z("data",{dataType:"style"}))}updateImageProviders(){const t=this.imageManager.getPendingImageProviders();for(const l of t){const d=l.resolvePendingRequests(),g=this.getFragmentStyle(l.scope);g&&g.addImages(d)}}_updateTilesForChangedImages(){const t={};for(const l in this._mergedSourceCaches){const d=this._mergedSourceCaches[l].getSource().scope;t[d]=t[d]||this._changes.getUpdatedImages(d),t[d].length!==0&&this._mergedSourceCaches[l].reloadTilesForDependencies(["icons","patterns"],t[d])}for(const l in t)this._changes.resetUpdatedImages(l)}_updateWorkerLayers(t,l,d){const g=this.getFragmentStyle(t);g&&this.dispatcher.broadcast("updateLayers",{layers:l?g._serializeLayers(l):[],scope:t,removedIds:d||[],options:g.options})}setState(t,l){if(this._checkLoaded(),Da(this,Bn(t)))return!1;(t=o.dp(t)).layers=Tp(t.layers);const d=function(x,T){if(!x)return[{command:Oi.setStyle,args:[T]}];let E=[];try{if(!o.by(x.version,T.version))return[{command:Oi.setStyle,args:[T]}];if(o.by(x.center,T.center)||E.push({command:Oi.setCenter,args:[T.center]}),o.by(x.zoom,T.zoom)||E.push({command:Oi.setZoom,args:[T.zoom]}),o.by(x.bearing,T.bearing)||E.push({command:Oi.setBearing,args:[T.bearing]}),o.by(x.pitch,T.pitch)||E.push({command:Oi.setPitch,args:[T.pitch]}),o.by(x.sprite,T.sprite)||E.push({command:Oi.setSprite,args:[T.sprite]}),o.by(x.glyphs,T.glyphs)||E.push({command:Oi.setGlyphs,args:[T.glyphs]}),o.by(x.imports,T.imports)||function(B=[],G=[],V){G=G||[];const W=(B=B||[]).map(il),Y=G.map(il),se=B.reduce(ju,{}),ne=G.reduce(ju,{}),te=W.slice();let we,_e,be,de;for(we=0,_e=0;we<W.length;we++)be=W[we],ne.hasOwnProperty(be)?_e++:(V.push({command:Oi.removeImport,args:[be]}),te.splice(te.indexOf(be,_e),1));for(we=0,_e=0;we<Y.length;we++)be=Y[Y.length-1-we],te[te.length-1-we]!==be&&(se.hasOwnProperty(be)?(V.push({command:Oi.removeImport,args:[be]}),te.splice(te.lastIndexOf(be,te.length-_e),1)):_e++,de=te[te.length-we],V.push({command:Oi.addImport,args:[ne[be],de]}),te.splice(te.length-we,0,be));for(const le of G){const Te=se[le.id];Te&&(delete Te.data,o.by(Te,le)||V.push({command:Oi.updateImport,args:[le.id,le]}))}}(x.imports,T.imports,E),o.by(x.transition,T.transition)||E.push({command:Oi.setTransition,args:[T.transition]}),o.by(x.light,T.light)||E.push({command:Oi.setLight,args:[T.light]}),o.by(x.fog,T.fog)||E.push({command:Oi.setFog,args:[T.fog]}),o.by(x.snow,T.snow)||E.push({command:Oi.setSnow,args:[T.snow]}),o.by(x.rain,T.rain)||E.push({command:Oi.setRain,args:[T.rain]}),o.by(x.projection,T.projection)||E.push({command:Oi.setProjection,args:[T.projection]}),o.by(x.lights,T.lights)||E.push({command:Oi.setLights,args:[T.lights]}),o.by(x.camera,T.camera)||E.push({command:Oi.setCamera,args:[T.camera]}),o.by(x.iconsets,T.iconsets)||function(B,G,V){let W;for(W in G=G||{},B=B||{})B.hasOwnProperty(W)&&(G.hasOwnProperty(W)||V.push({command:Oi.removeIconset,args:[W]}));for(W in G){if(!G.hasOwnProperty(W))continue;const Y=G[W];B.hasOwnProperty(W)?o.by(B[W],Y)||(V.push({command:Oi.removeIconset,args:[W]}),V.push({command:Oi.addIconset,args:[W,Y]})):V.push({command:Oi.addIconset,args:[W,Y]})}}(x.iconsets,T.iconsets,E),!o.by(x["color-theme"],T["color-theme"]))return[{command:Oi.setStyle,args:[T]}];const L={},P=[];(function(B,G,V,W){let Y;for(Y in G=G||{},B=B||{})B.hasOwnProperty(Y)&&(G.hasOwnProperty(Y)||nd(Y,V,W));for(Y in G){if(!G.hasOwnProperty(Y))continue;const se=G[Y];B.hasOwnProperty(Y)?o.by(B[Y],se)||(B[Y].type==="geojson"&&se.type==="geojson"&&Z_(B,G,Y)?V.push({command:Oi.setGeoJSONSourceData,args:[Y,se.data]}):q_(Y,G,V,W)):vc(Y,G,V)}})(x.sources,T.sources,P,L);const z=[];x.layers&&x.layers.forEach(B=>{B.source&&L[B.source]?E.push({command:Oi.removeLayer,args:[B.id]}):z.push(B)});let O=x.terrain;O&&L[O.source]&&(E.push({command:Oi.setTerrain,args:[void 0]}),O=void 0),E=E.concat(P),o.by(O,T.terrain)||E.push({command:Oi.setTerrain,args:[T.terrain]}),function(B,G,V){G=G||[];const W=(B=B||[]).map(il),Y=G.map(il),se=B.reduce(ju,{}),ne=G.reduce(ju,{}),te=W.slice(),we=Object.create(null);let _e,be,de,le,Te,Me,Oe;for(_e=0,be=0;_e<W.length;_e++)de=W[_e],ne.hasOwnProperty(de)?be++:(V.push({command:Oi.removeLayer,args:[de]}),te.splice(te.indexOf(de,be),1));for(_e=0,be=0;_e<Y.length;_e++)de=Y[Y.length-1-_e],te[te.length-1-_e]!==de&&(se.hasOwnProperty(de)?(V.push({command:Oi.removeLayer,args:[de]}),te.splice(te.lastIndexOf(de,te.length-be),1)):be++,Me=te[te.length-_e],V.push({command:Oi.addLayer,args:[ne[de],Me]}),te.splice(te.length-_e,0,de),we[de]=!0);for(_e=0;_e<Y.length;_e++)if(de=Y[_e],le=se[de],Te=ne[de],!we[de]&&!o.by(le,Te))if(o.by(le.source,Te.source)&&o.by(le["source-layer"],Te["source-layer"])&&o.by(le.type,Te.type)){for(Oe in Fu(le.layout,Te.layout,V,de,null,Oi.setLayoutProperty),Fu(le.paint,Te.paint,V,de,null,Oi.setPaintProperty),o.by(le.slot,Te.slot)||V.push({command:Oi.setSlot,args:[de,Te.slot]}),o.by(le.filter,Te.filter)||V.push({command:Oi.setFilter,args:[de,Te.filter]}),o.by(le.minzoom,Te.minzoom)&&o.by(le.maxzoom,Te.maxzoom)||V.push({command:Oi.setLayerZoomRange,args:[de,Te.minzoom,Te.maxzoom]}),le)le.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?Fu(le[Oe],Te[Oe],V,de,Oe.slice(6),Oi.setPaintProperty):o.by(le[Oe],Te[Oe])||V.push({command:Oi.setLayerProperty,args:[de,Oe,Te[Oe]]}));for(Oe in Te)Te.hasOwnProperty(Oe)&&!le.hasOwnProperty(Oe)&&Oe!=="layout"&&Oe!=="paint"&&Oe!=="filter"&&Oe!=="metadata"&&Oe!=="minzoom"&&Oe!=="maxzoom"&&Oe!=="slot"&&(Oe.indexOf("paint.")===0?Fu(le[Oe],Te[Oe],V,de,Oe.slice(6),Oi.setPaintProperty):o.by(le[Oe],Te[Oe])||V.push({command:Oi.setLayerProperty,args:[de,Oe,Te[Oe]]}))}else V.push({command:Oi.removeLayer,args:[de]}),Me=te[te.lastIndexOf(de)+1],V.push({command:Oi.addLayer,args:[Te,Me]})}(z,T.layers,E)}catch(L){console.warn("Unable to compute style diff:",L),E=[{command:Oi.setStyle,args:[T]}]}return E}(this.serialize(),t).filter(x=>!(x.command in ny));if(d.length===0)return!1;const g=d.filter(x=>!(x.command in ry));if(g.length>0)throw new Error(`Unimplemented: ${g.map(x=>x.command).join(", ")}.`);const y=[];return d.forEach(x=>{y.push(this[x.command](...x.args))}),l&&Promise.all(y).then(l).catch(l),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(t.size===0)return this;for(const[l,d]of t.entries()){if(this.getImage(l))return this.fire(new o.y(new Error(`An image with the name "${l.name}" already exists.`)));this.imageManager.addImage(l,this.scope,d),this._changes.updateImage(l,this.scope)}return this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this}addImage(t,l){return this.getImage(t)?this.fire(new o.y(new Error(`An image with the name "${t.name}" already exists.`))):(this.imageManager.addImage(t,this.scope,l),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this)}updateImage(t,l,d=!1){this.imageManager.updateImage(t,this.scope,l),d&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})))}getImage(t){return this.imageManager.getImage(t,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new o.z("data",{dataType:"style"})),this}addModel(t,l,d={}){return this._checkLoaded(),this._validate(Ce,`models.${t}`,l,null,d)||(this.modelManager.addModel(t,l,this.getActualScope()),this.fire(new o.z("data",{dataType:"style"}))),this}hasModel(t){return this.modelManager.hasModel(t,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new o.z("data",{dataType:"style"})),this):this.fire(new o.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,l,d={}){if(this._checkLoaded(),this.getOwnSource(t)!==void 0)throw new Error(`There is already a source with ID "${t}".`);if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(gc,`sources.${t}`,l,null,d))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const g=Ml(t,l,this.dispatcher,this);g.scope=this.scope,g.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(g.id),source:g.serialize(),sourceId:g.id}));const y=x=>{const T=(x?"symbol:":"other:")+g.id,E=o.B(T,this.scope),L=this._sourceCaches[T]=new gs(E,g,x);(x?this._symbolSourceCaches:this._otherSourceCaches)[g.id]=L,L.onAdd(this.map)};y(!1),l.type!=="vector"&&l.type!=="geojson"||y(!0),g.onAdd&&g.onAdd(this.map),d.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const l=this.getOwnSource(t);if(!l)throw new Error("There is no source with this ID");for(const g in this._layers)if(this._layers[g].source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while layer "${g}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const g=Object.entries(this.stylesheet.iconsets).find(([y,x])=>x.type==="source"&&x.source===t);if(g)return this.fire(new o.y(new Error(`Source "${t}" cannot be removed while iconset "${g[0]}" is using it.`)))}const d=this.getOwnSourceCaches(t);for(const g of d){const y=o.dq(g.id);delete this._sourceCaches[y],this._changes.discardSourceCacheUpdate(g.id),g.fire(new o.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:g.getSource().id})),g.setEventedParent(null),g.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(t,l){this._checkLoaded(),this.getOwnSource(t).setData(l),this._changes.setDirty()}getOwnSource(t){const l=this.getOwnSourceCache(t);return l&&l.getSource()}getOwnSources(){const t=[];for(const l in this._otherSourceCaches){const d=this.getOwnSourceCache(l);d&&t.push(d.getSource())}return t}areTilesLoaded(){const t=this._mergedSourceCaches;for(const l in t){const d=t[l]._tiles;for(const g in d){const y=d[g];if(y.state!=="loaded"&&y.state!=="errored")return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const l=this._getTransitionParameters();for(const y of t){if(this._validate(at,"lights",y))return;switch(y.type){case"ambient":if(this.ambientLight){const x=this.ambientLight;x.set(y),x.updateTransitions(l)}else this.ambientLight=new Ci(y,Sr(),this.scope,this.options);break;case"directional":if(this.directionalLight){const x=this.directionalLight;x.set(y),x.updateTransitions(l)}else this.directionalLight=new Ci(y,er(),this.scope,this.options)}}const d=Object.assign(l,{worldview:this.map.getWorldview()}),g=new o.ac(this.z||0,d);this.ambientLight&&this.ambientLight.recalculate(g),this.directionalLight&&this.directionalLight.recalculate(g),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,l=this.ambientLight;if(!t||!l)return;const d=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),g=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),y=t.properties.get("intensity"),x=t.properties.get("direction"),T=1-o.d4(x.x,x.y,x.z)[2]/90,E=d(g)*y*T,L=l.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),P=l.properties.get("intensity"),z=d(L)*P;return Number(((E+z)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const t=[];return this.directionalLight&&t.push(this.directionalLight.get()),this.ambientLight&&t.push(this.ambientLight.get()),t}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(t==null||t===""&&this.isRootStyle())return this;if(o.dr(t)){const l=o.ds(t),d=this.fragments.find(({id:y})=>y===l);if(!d)return;const g=o.dq(t);return d.style.getFragmentStyle(g)}{const l=this.fragments.find(({id:d})=>d===t);return l?l.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const l={},d=(g,y="")=>`${g}::${y}`;this._featuresetSelectors={};for(const g in t){const y=this._featuresetSelectors[g]=[];for(const x of t[g].selectors){if(x.featureNamespace){const E=this.getOwnLayer(x.layer);if(!E){o.w(`Layer is undefined for selector: ${x.layer}`);continue}const L=d(E.source,E.sourceLayer);if(L in l&&l[L]!==x.featureNamespace){o.w(`"featureNamespace ${x.featureNamespace} of featureset ${g}'s selector is not associated to the same source, skip this selector`);continue}l[L]=x.featureNamespace}let T;if(x.properties)for(const E in x.properties){const L=o.U(x.properties[E]);L.result==="success"&&(T=T||{},T[E]=L.value)}y.push({layerId:x.layer,namespace:x.featureNamespace,properties:T,uniqueFeatureID:x._uniqueFeatureID})}}}getFeaturesetDescriptors(t){const l=this.getFragmentStyle(t);if(!l||!l.stylesheet.featuresets)return[];const d=[];for(const g in l.stylesheet.featuresets)d.push({featuresetId:g,importId:l.scope?l.scope:void 0});return d}getFeaturesetLayers(t,l){const d=this.getFragmentStyle(l),g=d.stylesheet.featuresets;if(!g||!g[t])return this.fire(new o.y(new Error(`The featureset '${t}' does not exist in the map's style and cannot be queried.`))),[];const y=[];for(const x of g[t].selectors){const T=d.getOwnLayer(x.layer);T&&y.push(T)}return y}getConfigProperty(t,l){const d=this.getFragmentStyle(t);if(!d)return null;const g=o.B(l,d.scope),y=d.options.get(g),x=y?y.value||y.default:null;return x?x.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,l){const d=o.B(t,l);return this._mergedIndoor[d]}setIndoorData(t,l){this.indoorManager.setIndoorData(l)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,l,d){const g=this.getFragmentStyle(t);if(!g)return;const y=g.stylesheet.schema;if(!y||!y[l])return;const x=o.U(d);if(x.result!=="success")return void Da(this,x.value);const T=x.value.expression,E=o.B(l,g.scope),L=g.options.get(E);if(!L)return;let P;const{minValue:z,maxValue:O,stepValue:B,type:G,values:V}=y[l],W=o.U(y[l].default);W.result==="success"&&(P=W.value.expression),P?(this.options.set(E,Object.assign({},L,{value:T,default:P,minValue:z,maxValue:O,stepValue:B,type:G,values:V})),this.updateConfigDependencies(l)):this.fire(new o.y(new Error(`No schema defined for the config option "${l}" in the "${t}" fragment.`)))}getConfig(t){const l=this.getFragmentStyle(t);if(!l)return null;const d=l.stylesheet.schema;if(!d)return null;const g={};for(const y in d){const x=o.B(y,l.scope),T=l.options.get(x),E=T?T.value||T.default:null;g[y]=E?E.serialize():null}return g}setConfig(t,l){const d=this.getFragmentStyle(t);d&&(d.updateConfig(l,d.stylesheet.schema),this.updateConfigDependencies())}getSchema(t){const l=this.getFragmentStyle(t);return l?l.stylesheet.schema:null}setSchema(t,l){const d=this.getFragmentStyle(t);d&&(d.stylesheet.schema=l,d.updateConfig(d._config,l),this.updateConfigDependencies())}updateConfig(t,l){if(this._config=t,t||l)if(l)for(const d in l){let g,y;const x=o.U(l[d].default);if(x.result==="success"&&(g=x.value.expression),t&&t[d]!==void 0){const O=o.U(t[d]);O.result==="success"&&(y=O.value.expression)}const{minValue:T,maxValue:E,stepValue:L,type:P,values:z}=l[d];if(g){const O=o.B(d,this.scope);this.options.set(O,{default:g,value:y,minValue:T,maxValue:E,stepValue:L,type:P,values:z})}else this.fire(new o.y(new Error(`No schema defined for config option "${d}".`)))}else this.fire(new o.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(t,l=()=>!0){for(const d of t){const g=this.getLayer(d);g&&l(g)&&(g.possiblyEvaluateVisibility(),this._updateLayer(g),this._changes.setDirty())}}updateConfigDependencies(t){this._updateLayers(this._configDependentLayers,l=>!t||l.expressionDependencies.configDependencies.has(t)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(l=>{const d=l._styleColorTheme.colorThemeOverride?l._styleColorTheme.colorThemeOverride:l._styleColorTheme.colorTheme;if(d){const g=l._evaluateColorThemeData(d);(!l._styleColorTheme.lut&&g!==""||l._styleColorTheme.lut&&g!==l._styleColorTheme.lut.data)&&l.setColorTheme(d)}}),this._changes.setDirty()}addLayer(t,l,d={}){this._checkLoaded();const g=t.id;if(this._layers[g])return void this.fire(new o.y(new Error(`Layer with id "${g}" already exists on this map`)));let y;if(t.type==="custom"){if(Da(this,o.dt(t)))return;y=o.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof t.source=="object"&&(this.addSource(g,t.source),t=o.dp(t),t=Object.assign(t,{source:g})),this._validate(De,`layers.${g}`,t,{arrayIndex:-1},d))return;y=o.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(y),y.setEventedParent(this,{layer:{id:g}})}const x=o.B(y.source,y.scope);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(x),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(x);let T=this._order.length;if(l){const z=this._order.indexOf(l);if(z===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));y.slot&&y.slot!==this._layers[l].slot?o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`):T=z}this._order.splice(T,0,g),this._handleLayerOrderChange(),this._layers[g]=y;const E=this.getOwnLayerSourceCache(y),L=!!this.directionalLight&&this.directionalLight.shadowsEnabled();E&&y.canCastShadows()&&L&&(E.castsShadows=!0);const P=this._changes.getRemovedLayer(y);if(P&&y.source&&E&&y.type!=="custom"){this._changes.discardLayerRemoval(y);const z=o.B(y.source,y.scope);P.type!==y.type?this._changes.updateSourceCache(z,"clear"):(this._changes.updateSourceCache(z,"reload"),E.pause())}this._updateLayer(y),y.onAdd&&y.onAdd(this.map),y.scope=this.scope,this.mergeLayers()}moveLayer(t,l){this._checkLoaded();const d=this._checkLayer(t);if(!d||t===l)return;const g=this._order.indexOf(t);this._order.splice(g,1);let y=this._order.length;if(l){const x=this._order.indexOf(l);if(x===-1)return void this.fire(new o.y(new Error(`Layer with id "${l}" does not exist on this map.`)));d.slot&&d.slot!==this._layers[l].slot?o.w(`Layer with id "${l}" has a different slot. Layers can only be rearranged within the same slot.`):y=x}this._order.splice(y,0,t),this._changes.setDirty(),this._handleLayerOrderChange(),this.mergeLayers()}removeLayer(t){this._checkLoaded();const l=this._checkLayer(t);if(!l)return;l.setEventedParent(null);const d=this._order.indexOf(t);this._order.splice(d,1),delete this._layers[t],this._changes.setDirty(),this._handleLayerOrderChange(),this._configDependentLayers.delete(l.fqid),this._indoorDependentLayers.delete(l.fqid),this._changes.removeLayer(l);const g=this.getOwnLayerSourceCache(l);if(g&&g.castsShadows){let y=!1;for(const x in this._layers)if(this._layers[x].source===l.source&&this._layers[x].canCastShadows()){y=!0;break}g.castsShadows=y}l.onRemove&&l.onRemove(this.map),this.mergeLayers()}getOwnLayer(t){return this._layers[t]}hasLayer(t){return t in this._mergedLayers}hasLayerType(t){for(const l in this._layers)if(this._layers[l].type===t)return!0;return!1}setLayerZoomRange(t,l,d){this._checkLoaded();const g=this._checkLayer(t);g&&(g.minzoom===l&&g.maxzoom===d||(l!=null&&(g.minzoom=l),d!=null&&(g.maxzoom=d),this._updateLayer(g)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(t,l){this._checkLoaded();const d=this._checkLayer(t);d&&d.slot!==l&&(d.slot=l,this._updateLayer(d))}setFilter(t,l,d={}){this._checkLoaded();const g=this._checkLayer(t);if(g&&!o.by(g.filter,l))return l==null?(g.filter=void 0,void this._updateLayer(g)):void(this._validate(q,`layers.${g.id}.filter`,l,{layerType:g.type},d)||(g.filter=o.dp(l),this._updateLayer(g)))}getFilter(t){const l=this._checkLayer(t);if(l)return o.dp(l.filter)}setLayoutProperty(t,l,d,g={}){this._checkLoaded();const y=this._checkLayer(t);if(y&&!o.by(y.getLayoutProperty(l),d)){if(d!=null&&(!g||g.validate!==!1)&&Da(y,ue.call(Bn,{key:`layers.${t}.layout.${l}`,layerType:y.type,objectKey:l,value:d,styleSpec:o.a6,style:{glyphs:!0,sprite:!0}})))return;y.setLayoutProperty(l,d),y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),this._updateLayer(y)}}setLayerProperty(t,l,d,g={}){this._checkLoaded();const y=this._checkLayer(t);y&&(l==="appearances"?(y.setAppearances(d),this._changes.setDirty()):y.isPaintProperty(l)?this.setPaintProperty(t,l,d,g):this.setLayoutProperty(t,l,d,g))}getLayoutProperty(t,l){const d=this._checkLayer(t);if(d)return d.getLayoutProperty(l)}setPaintProperty(t,l,d,g={}){this._checkLoaded();const y=this._checkLayer(t);if(!y||o.by(y.getPaintProperty(l),d)||d!=null&&(!g||g.validate!==!1)&&Da(y,ee.call(Bn,{key:`layers.${t}.paint.${l}`,layerType:y.type,objectKey:l,value:d,styleSpec:o.a6})))return;const x=y.setPaintProperty(l,d);y.expressionDependencies.configDependencies.size!==0&&this._configDependentLayers.add(y.fqid),y.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(y.fqid),x&&this._updateLayer(y),this._changes.updatePaintProperties(y)}getPaintProperty(t,l){const d=this._checkLayer(t);if(d)return d.getPaintProperty(l)}setFeatureState(t,l){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:L}=t.target,P=this.getFragmentStyle(L),z=P.getFeaturesetLayers(E);for(const{source:O,sourceLayer:B}of z)P.setFeatureState({id:t.id,source:O,sourceLayer:B},l)}else if("layerId"in t.target){const{layerId:E}=t.target,L=this.getLayer(E);this.setFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},l)}return}const d=t.source,g=t.sourceLayer,y=this._checkSource(d);if(!y)return;const x=y.type;if(x==="geojson"&&g)return void this.fire(new o.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(x==="vector"&&!g)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided.")));const T=this.getOwnSourceCaches(d);for(const E of T)E.setFeatureState(g,t.id,l)}removeFeatureState(t,l){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:E,importId:L}=t.target,P=this.getFragmentStyle(L),z=P.getFeaturesetLayers(E);for(const{source:O,sourceLayer:B}of z)P.removeFeatureState({id:t.id,source:O,sourceLayer:B},l)}else if("layerId"in t.target){const{layerId:E}=t.target,L=this.getLayer(E);this.removeFeatureState({id:t.id,source:L.source,sourceLayer:L.sourceLayer},l)}return}const d=t.source,g=this._checkSource(d);if(!g)return;const y=g.type,x=y==="vector"?t.sourceLayer:void 0;if(y==="vector"&&!x)return void this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&typeof t.id!="string"&&typeof t.id!="number")return void this.fire(new o.y(new Error("A feature id is required to remove its specific state property.")));const T=this.getOwnSourceCaches(d);for(const E of T)E.removeFeatureState(x,t.id,l)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let y;if("featuresetId"in t.target){const{featuresetId:x,importId:T}=t.target,E=this.getFragmentStyle(T),L=E.getFeaturesetLayers(x);for(const{source:P,sourceLayer:z}of L){const O=E.getFeatureState({id:t.id,source:P,sourceLayer:z});if(O&&!y)y=O;else if(!o.by(y,O))return void this.fire(new o.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:x}=t.target,T=this.getLayer(x);y=this.getFeatureState({id:t.id,source:T.source,sourceLayer:T.sourceLayer})}return y}const l=t.source,d=t.sourceLayer,g=this._checkSource(l);if(g){if(g.type!=="vector"||d)return t.id===void 0&&this.fire(new o.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(l)[0].getFeatureState(d,t.id);this.fire(new o.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(t){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,t),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),l=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return o.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,featuresets:this.stylesheet.featuresets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:l,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,indoor:this.stylesheet.indoor,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},d=>d!==void 0)}_updateFilteredLayers(t){for(const l of Object.values(this._mergedLayers))t(l)&&this._updateLayer(l)}_updateLayer(t){this._changes.updateLayer(t);const l=this.getLayerSourceCache(t),d=o.B(t.source,t.scope),g=this._changes.getUpdatedSourceCaches();t.source&&!g[d]&&l&&l.getSource().type!=="raster"&&(this._changes.updateSourceCache(d,"reload"),l.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const l=T=>this._mergedLayers[T].is3D(!!this.terrain),d=this.order,g={},y=[];for(let T=d.length-1;T>=0;T--){const E=d[T];if(l(E)){g[E]=T;for(const L of t){const P=L[E];if(P)for(const z of P)y.push(z)}}}y.sort((T,E)=>E.intersectionZ-T.intersectionZ);const x=[];for(let T=d.length-1;T>=0;T--){const E=d[T];if(l(E))for(let L=y.length-1;L>=0;L--){const P=y[L].feature;if(P.layer&&g[P.layer.id]<T)break;x.push(P),y.pop()}else for(const L of t){const P=L[E];if(P)for(const z of P)x.push(z.feature)}}return x}queryRasterValue(t,l,d){const g=this.getOwnSource(t);return g?g.type!=="raster-array"?(this.fire(new o.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):g.queryRasterArrayValue(l,d):(this.fire(new o.y(new Error(`Source with id "${t}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(t,l,d){let g;l&&!Array.isArray(l)&&l.filter&&(this._validate(q,"queryRenderedFeatures.filter",l.filter,null,l),g=o.b6(l.filter));const y={},x=P=>{if(md.has(P.type))return;const z=this.getOwnLayerSourceCache(P),O=y[z.id]=y[z.id]||{sourceCache:z,layers:{},has3DLayers:!1};P.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[P.fqid]=O.layers[P.fqid]||{styleLayer:P,targets:[]},O.layers[P.fqid].targets.push({filter:g})};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new o.y(new Error("parameters.layers must be an Array."))),[];for(const P of l.layers){const z=this._layers[P];if(!z)return this.fire(new o.y(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];x(z)}}else for(const P in this._layers)x(this._layers[P]);const T=this._queryRenderedFeatures(t,y,d),E=this._flattenAndSortRenderedFeatures(T),L=[];for(const P of E)o.dw(P.layer.id)===this.scope&&L.push(P);return L}queryRenderedFeatureset(t,l,d){let g;l&&!Array.isArray(l)&&l.filter&&(this._validate(q,"queryRenderedFeatures.filter",l.filter,null,l),g=o.b6(l.filter));const y="mock",x=[];if(l&&l.target)x.push(Object.assign({},l,{targetId:y,filter:g}));else{const P=this.getFeaturesetDescriptors();for(const z of P)x.push({targetId:y,filter:g,target:z});for(const{style:z}of this.fragments){const O=z.getFeaturesetDescriptors();for(const B of O)x.push({targetId:y,filter:g,target:B})}}const T=this.queryRenderedTargets(t,x,d),E=[],L=new Set;for(const P of T)for(const z of P.variants[y])Ru(z,P,L)||E.push(new o.dx(P,z));return E}queryRenderedTargets(t,l,d){const g={},y=(T,E,L,P)=>{const z=g[E.id]=g[E.id]||{sourceCache:E,layers:{},has3DLayers:!1};if(z.layers[T.fqid]=z.layers[T.fqid]||{styleLayer:T,targets:[]},T.is3D(!!this.terrain)&&(z.has3DLayers=!0),!P)return L.uniqueFeatureID=!1,void z.layers[T.fqid].targets.push(L);z.layers[T.fqid].targets.push(Object.assign({},L,{namespace:P.namespace,properties:P.properties,uniqueFeatureID:P.uniqueFeatureID}))};for(const T of l)if("featuresetId"in T.target){const{featuresetId:E,importId:L}=T.target,P=this.getFragmentStyle(L);if(!P||!P._featuresetSelectors)continue;const z=P._featuresetSelectors[E];if(!z){this.fire(new o.y(new Error(`The featureset '${E}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of z){const B=P.getOwnLayer(O.layerId);B&&!md.has(B.type)&&y(B,P.getOwnLayerSourceCache(B),T,O)}}else if("layerId"in T.target){const{layerId:E}=T.target,L=this.getLayer(E);if(!L||md.has(L.type))continue;y(L,this.getLayerSourceCache(L),T)}const x=this._queryRenderedFeatures(t,g,d);return this._flattenAndSortRenderedFeatures(x)}_queryRenderedFeatures(t,l,d){const g=[],y=!!this.map._showQueryGeometry,x=Mr.createFromScreenPoints(t,d);for(const T in l){const E=Du(x,l[T],this._availableImages,d,y,this.getActualScope());Object.keys(E).length&&g.push(E)}if(this.placement)for(const T in l){if(!l[T].sourceCache._onlySymbols)continue;const E=$_(x.screenGeometry,l[T],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(E).length&&g.push(E)}return g}querySourceFeatures(t,l){const d=l&&l.filter;d&&this._validate(q,"querySourceFeatures.filter",d,null,l);let g=[];const y=this.getOwnSourceCaches(t);for(const x of y)g=g.concat(G_(x,l));return g}addSourceType(t,l,d){return zs.getSourceType(t)?d(new Error(`A source type called "${t}" already exists.`)):(zs.setSourceType(t,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:l.workerSourceURL},d):d(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,l,d={}){this._checkLoaded();const g=this.light.getLight();let y=!1;for(const T in t)if(!o.by(t[T],g[T])){y=!0;break}if(!y)return;const x=this._getTransitionParameters();this.light.setLight(t,l,d),this.light.updateTransitions(x)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t,l=1){if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),l===0&&delete this.terrain,t===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let d=t;const g=!("source"in t)||t.source==null;if(l===1){if(this.disableElevatedTerrain)return;if("source"in d&&typeof d.source=="object"){const T="terrain-dem-src";this.addSource(T,d.source),d=o.dp(d),d=Object.assign(d,{source:T})}const y=Object.assign({},d),x={};if(this.terrain&&g){y.source=this.terrain.get().source;const T=this.terrain?this.getFragmentStyle(this.terrain.scope):null;T&&(x.style=T.serialize())}if(this._validate(Li,"terrain",y,x))return}if(!this.terrain||this.terrain.scope!==this.scope&&!g||this.terrain&&l!==this.terrain.drapeRenderMode){if(!d)return;this._createTerrain(d,l),this.fire(new o.z("data",{dataType:"style"}))}else{const y=this.terrain,x=y.get();for(const T of Object.keys(o.a6.terrain))!d.hasOwnProperty(T)&&o.a6.terrain[T].default&&(d[T]=o.a6.terrain[T].default);for(const T in t)if(!o.by(t[T],x[T])){y.set(t,this.options),this.stylesheet.terrain=t;const E=this._getTransitionParameters({duration:0});y.updateTransitions(E),this.fire(new o.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(t){const l=this.fog=new Kt(t,this.map.transform,this.scope,this.options);this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createSnow(t){const l=this.snow=new zr(t,this.map.transform,this.scope,this.options);this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_createRain(t){const l=this.rain=new vr(t,this.map.transform,this.scope,this.options);this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog;if(!o.by(l.get(),t)){l.set(t,this.options),this.stylesheet.fog=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const l=this.snow;if(!o.by(l.get(),t)){l.set(t,this.options),this.stylesheet.snow=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const l=this.rain;if(!o.by(l.get(),t)){l.set(t,this.options),this.stylesheet.rain=l.get();const d=this._getTransitionParameters({duration:0});l.updateTransitions(d)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const g in this._layers)this._layers[g].lut=this._styleColorTheme.lut;for(const g in this._sourceCaches)this._sourceCaches[g].clearTiles()},l=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!l)return this._styleColorTheme.lut=null,void t();const d=this._evaluateColorThemeData(l);this._loadColorTheme(d).then(()=>{this.fire(new o.z("colorthemeset")),t()}).catch(g=>{o.w(`Couldn't set color theme: ${g}`)})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(t,l){const d=this.getFragmentStyle(t);d&&(d._styleColorTheme.colorThemeOverride=l,d._reloadColorTheme())}_getTransitionParameters(t){return{now:o.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const t=[],l=[];for(const d of this._mergedOrder)this.isLayerDraped(this._mergedLayers[d])?t.push(d):l.push(d);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...l)}_createTerrain(t,l){const d=this.terrain=new st(t,l,this.scope,this.options,this.map.getWorldview());l===1&&(this.stylesheet.terrain=t),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const g=this._getTransitionParameters({duration:0});d.updateTransitions(g)}_force3DLayerUpdate(){for(const t in this._layers){const l=this._layers[t];l.type==="fill-extrusion"&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const l=this._layers[t];l.type==="symbol"&&this._updateLayer(l)}}_validate(t,l,d,g,y={}){if(y&&y.validate===!1)return!1;const x=Object.assign({},this.serialize());return Da(this,t.call(Bn,Object.assign({key:l,style:x,value:d,styleSpec:o.a6},g)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._mergedLayers)this._mergedLayers[t].setEventedParent(null);for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles(),this._mergedSourceCaches[t].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.indoorManager.destroy(),this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(t){const l=this.getSourceCaches(t);for(const d of l)d.clearTiles()}clearSources(){for(const t in this._mergedSourceCaches)this._mergedSourceCaches[t].clearTiles()}clearLayers(){for(const t in this._mergedLayers){const l=this._mergedLayers[t];l._clear&&l._clear()}}reloadSource(t){const l=this.getSourceCaches(t);for(const d of l)d.resume(),d.reload()}reloadSources(){for(const t of this.getSources())t.reload&&t.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(t=>{t.modelManager.reloadModels(t.scope)})}updateSources(t){let l;this.directionalLight&&(l=ey(this.directionalLight));const d=new Set,g=new Set;for(const y in this._mergedLayers){const x=this._mergedLayers[y];x.type==="building"&&d.add(x.source),x.hasElevation()&&!g.has(x.source)&&g.add(x.source)}for(const y in this._mergedSourceCaches){const x=this._mergedSourceCaches[y],T=g.has(x._source.id);d.has(x._source.id)&&(x._source.reparseOverscaled=!1),x.update(t,void 0,void 0,l,T)}}_generateCollisionBoxes(){for(const t in this._sourceCaches){const l=this._sourceCaches[t];l.resume(),l.reload()}}_handleLayerOrderChange(){this._requestFullLabelPlacement(),this.fire(new o.z("neworder"))}_requestFullLabelPlacement(){this.pauseablePlacement||(this.pauseablePlacement=new kp),this.pauseablePlacement.requestFullPlacement()}_setLabelPlacementStale(){this.placement&&this.placement.setStale()}_updatePlacement(t,l,d,g,y){this.pauseablePlacement||(this.pauseablePlacement=new kp);let x=!1,T=!1;const E={},L={};for(const V of this._mergedOrder){const W=this._mergedLayers[V];if(W.type!=="symbol")continue;const Y=o.B(W.source,W.scope);let se=E[Y];if(!se){const te=this.getLayerSourceCache(W);if(!te)continue;const we=te.getRenderableIds(!0).map(_e=>te.getTileByID(_e));L[Y]=we.slice(),se=E[Y]=we.sort((_e,be)=>be.tileID.overscaledZ-_e.tileID.overscaledZ||(_e.tileID.isLessThan(be.tileID)?-1:1))}const ne=this.crossTileSymbolIndex.addLayer(W,se,t.center.lng,t.projection);x=x||ne}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder);const P=!!(this.placement&&!t.equals(this.placement.transform)),z=!!(this.placement&&(this.placement.lastReplacementSourceUpdateTime!==0&&!y||this.placement.lastReplacementSourceUpdateTime!==y.updateTime)),O=P||z||x,B=(O||this.pauseablePlacement.isStale())&&d===0,G=this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.o.now(),t.zoom)&&d!==0;if((this.pauseablePlacement.isFullPlacementRequested()||!this.pauseablePlacement.placement||B||G)&&(this.pauseablePlacement=this.pauseablePlacement.startNewPlacement(t,this._mergedOrder,l,d,g,this.placement,this.fog&&t.projection.supportsFog?this.fog.state:null,this._buildingIndex)),this.pauseablePlacement.isDone()?O&&d!==0&&this.pauseablePlacement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,E,L,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.o.now()),T=!0),x&&this.pauseablePlacement.setStale()),T||x){this._buildingIndex.onNewFrame(t.zoom);for(let V=0;V<this._mergedOrder.length;V++){const W=this._mergedLayers[this._mergedOrder[V]];if(W.type!=="symbol"||W.visibility==="none")continue;const Y=this.isLayerClipped(W);this.placement.updateLayerOpacities(W,E[o.B(W.source,W.scope)],V,Y?y:null)}}return!this.pauseablePlacement.isDone()||this.placement.isStale()||this.placement.hasTransitions(o.o.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}addImport(t,l){this._checkLoaded();const d=this.stylesheet.imports=this.stylesheet.imports||[];if(d.findIndex(({id:y})=>y===t.id)!==-1)return void this.fire(new o.y(new Error(`Import with id '${t.id}' already exists in the map's style.`)));if(!l)return d.push(t),this._loadImports([t],!0);const g=d.findIndex(({id:y})=>y===l);return g===-1&&this.fire(new o.y(new Error(`Import with id "${l}" does not exist on this map.`))),this.stylesheet.imports=d.slice(0,g).concat(t).concat(d.slice(g)),this._loadImports([t],!0,l)}updateImport(t,l){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(t);return g===-1?this:typeof l=="string"?(this.setImportUrl(t,l),this):(l.url&&l.url!==d[g].url&&this.setImportUrl(t,l.url),o.by(l.config,d[g].config)||this.setImportConfig(t,l.config,l.data.schema),o.by(l.data,d[g].data)||this.setImportData(t,l.data),this)}moveImport(t,l){this._checkLoaded();let d=this.stylesheet.imports||[];const g=this.getImportIndex(t);if(g===-1)return this;const y=this.getImportIndex(l);if(y===-1)return this;const x=d[g],T=this.fragments[g];return d=d.filter(({id:E})=>E!==t),this.fragments=this.fragments.filter(({id:E})=>E!==t),this.stylesheet.imports=d.slice(0,y).concat(x).concat(d.slice(y)),this.fragments=this.fragments.slice(0,y).concat(T).concat(this.fragments.slice(y)),this.mergeLayers(),this}setImportUrl(t,l){this._checkLoaded();const d=this.stylesheet.imports||[],g=this.getImportIndex(t);if(g===-1)return this;d[g].url=l;const y=this.fragments[g];return y.style=this._createFragmentStyle(d[g]),y.style.on("style.import.load",()=>this.mergeAll()),y.style.loadURL(l),this}setImportData(t,l){this._checkLoaded();const d=this.getImportIndex(t),g=this.stylesheet.imports||[];return d===-1?this:l?(this.fragments[d].style.setState(l),this._reloadImports(),this):(delete g[d].data,this.setImportUrl(t,g[d].url))}setImportConfig(t,l,d){this._checkLoaded();const g=this.getImportIndex(t),y=this.stylesheet.imports||[];if(g===-1)return this;l?y[g].config=l:delete y[g].config;const x=this.fragments[g];d&&x.style.stylesheet&&(x.style.stylesheet.schema=d);const T=x.style.stylesheet&&x.style.stylesheet.schema;return x.config=l,x.style.updateConfig(l,T),this.updateConfigDependencies(),this}removeImport(t){this._checkLoaded();const l=this.stylesheet.imports||[],d=this.getImportIndex(t);d!==-1&&(l.splice(d,1),this.fragments[d].style._remove(),this.fragments.splice(d,1),this._reloadImports())}getImportIndex(t){const l=(this.stylesheet.imports||[]).findIndex(d=>d.id===t);return l===-1&&this.fire(new o.y(new Error(`Import '${t}' does not exist in the map's style and cannot be updated.`))),l}getLayer(t){return this._mergedLayers[t]}getSources(){const t=[];for(const l in this._mergedOtherSourceCaches){const d=this._mergedOtherSourceCaches[l];d&&t.push(d.getSource())}return t}getSource(t,l){const d=this.getSourceCache(t,l);return d&&d.getSource()}getLayerSource(t){const l=this.getLayerSourceCache(t);return l&&l.getSource()}getSourceCache(t,l){const d=o.B(t,l);return this._mergedOtherSourceCaches[d]}getLayerSourceCache(t){const l=o.B(t.source,t.scope);return t.type==="symbol"?this._mergedSymbolSourceCaches[l]:this._mergedOtherSourceCaches[l]}getSourceCaches(t){if(t==null)return Object.values(this._mergedSourceCaches);const l=[];return this._mergedOtherSourceCaches[t]&&l.push(this._mergedOtherSourceCaches[t]),this._mergedSymbolSourceCaches[t]&&l.push(this._mergedSymbolSourceCaches[t]),l}updateSourceCaches(){const t=this._changes.getUpdatedSourceCaches();for(const l in t){const d=t[l];d==="reload"?this.reloadSource(l):d==="clear"&&this.clearSource(l)}}updateLayers(t){const l=this._changes.getUpdatedPaintProperties();for(const d of l){const g=this.getLayer(d);g&&g.updateTransitions(t)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(t){this.stylesheet.glyphs=t,this.glyphManager.setURL(t)}getImages(t,l,d){this.imageManager.getImages(l.images,l.scope,d),this._updateTilesForChangedImages();const g=x=>{if(x){const T=l.images.map(E=>o.I.toString(E));x.setDependencies(l.tileID.key,l.type,T)}},y=o.B(l.source,l.scope);g(this._mergedOtherSourceCaches[y]),g(this._mergedSymbolSourceCaches[y]),l.images.some(x=>x.iconsetId)&&this.fire(new o.z("data",{dataType:"style"}))}rasterizeImages(t,l,d){this.imageManager.rasterizeImages(l,d)}getGlyphs(t,l,d){this.glyphManager.getGlyphs(l.stacks,d)}getResource(t,l,d){return o.dz(l,d)}getOwnSourceCache(t){return this._otherSourceCaches[t]}getOwnLayerSourceCache(t){return t.type==="symbol"?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}getOwnSourceCaches(t){const l=[];return this._otherSourceCaches[t]&&l.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&l.push(this._symbolSourceCaches[t]),l}_isSourceCacheLoaded(t){const l=this.getOwnSourceCaches(t);return l.length===0?(this.fire(new o.y(new Error(`There is no source with ID '${t}'`))),!1):l.every(d=>d.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(t,l){if(!this._clipLayerPresent&&t.type!=="fill-extrusion"&&t.type!=="building")return!1;const d=t.type==="fill-extrusion"&&(t.sourceLayer==="building"||t.sourceLayer==="procedural_buildings"),g=t.type==="building";if(t.is3D(!!this.terrain)){if(d||g||l&&l.type==="batched-model"||t.type==="model")return!0}else if(t.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(t=>{t.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}zs.getSourceType=function(h){return Ca[h]},zs.setSourceType=function(h,t){Ca[h]=t},zs.registerForPluginStateChange=o.dA;var Op=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,zp=`
#ifdef DUAL_SOURCE_BLENDING
layout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;
#else
layout(location=0) out vec4 glFragColor;
#endif
#ifdef USE_MRT1
layout(location=1) out vec4 out_Target1;
#endif
highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Ec=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}
#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib
#define DECLARE_MATERIAL_TABLE_INFO
#endif`,Ic="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Bp=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;
#ifdef CLIP_ZERO_TO_ONE
coord.z=-1.0+2.0*coord.z; 
#endif
highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif`,gd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Ys=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,qu=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,gt=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Fp=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif`,jp=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const Zu=/#include\s+"([^"]+)"/g,aa=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Np=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Bl=new Set(["ifdef","ifndef","elif","if","defined"]),Fl=new Set;cl(Op,Fl),cl(Ec,Fl),cl(zp,Fl);const ll={"_prelude_fog.vertex.glsl":gd,"_prelude_terrain.vertex.glsl":Bp,"_prelude_shadow.vertex.glsl":Fp,"_prelude_material_table.vertex.glsl":`#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer
#define MATERIAL_TABLE_DEBUG 0
uniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;
#if MATERIAL_TABLE_DEBUG
vec4 colorDebug;
#endif
};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { 
if (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; 
}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { 
iRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;
#if MATERIAL_TABLE_DEBUG
const vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;
#endif
uint offset=0u;
#if MATERIAL_TABLE_DEBUG
bool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}
#endif
offset++;
#if MATERIAL_TABLE_DEBUG
uint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}
#endif
offset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);
#if MATERIAL_TABLE_DEBUG
if(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}
#endif
uint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);
#if MATERIAL_TABLE_DEBUG
if(keepFinding)
{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}
#endif
offset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;
#if MATERIAL_TABLE_DEBUG
if(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}
#endif
info.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)
{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}
#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)
#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)
#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));
#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;
#endif`,"_prelude_fog.fragment.glsl":Ys,"_prelude_shadow.fragment.glsl":jp,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif`,"_prelude_raster_array.glsl":qu,"_prelude_raster_particle.glsl":gt},_d={};Ai("",Bp),Ai(Ys,gd),Ai(jp,Fp),Ai(qu,""),Ai(gt,"");const sy=Ai(zp,Ec),yd=Op,p1=[`
#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)
#extension GL_EXT_blend_func_extended : require
#endif`,"precision mediump float;",yd,sy.fragmentSource].join(`
`),oy=["precision highp float;",yd,sy.vertexSource].join(`
`);var Up={background:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
in highp float v_flood_radius;in float v_has_flood_light;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
#else
shadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);
#ifdef FLOOD_LIGHT
float flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);
#endif
color.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#ifdef FLOOD_LIGHT
out highp float v_flood_radius;out float v_has_flood_light;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
#ifdef FLOOD_LIGHT
v_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);
#endif
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}`),buildingBloom:Ai(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
#ifdef RENDER_CUTOFF
opacity*=v_cutoff_opacity;
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),buildingDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Ai(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Ai(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Ai(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Ai(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_material_table.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {DECLARE_MATERIAL_TABLE_INFO
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Ai(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Ai(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
#ifdef USE_MRT1
out_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Ai(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform highp vec2 u_trim_gradient_mix_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
in float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float dist=length(v_normal)*v_width2.s;
#ifdef VARIABLE_LINE_WIDTH
blur=mix(blur,0.0,stub_side);
#endif
float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef VARIABLE_LINE_WIDTH
alpha=mix(alpha,1.0,stub_side);
#endif
alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);highp float gradient_trim_color_mix_factor=0.0;
#ifdef RENDER_LINE_GRADIENT
gradient_trim_color_mix_factor=smoothstep(u_trim_gradient_mix_range.x,u_trim_gradient_mix_range.y,line_progress);
#endif
highp vec4 trim_color=mix(u_trim_color,out_color,gradient_trim_color_mix_factor);out_color=mix(u_trim_gradient_mix_range.x < 1.0 ? color : out_color,trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
#ifndef VARIABLE_LINE_WIDTH
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef VARIABLE_LINE_WIDTH
out float stub_side;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float side_z_offset
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float side_z_offset
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;offset=-1.0*offset*u_width_scale;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
bool left=normal.y==1.0;float left_width=a_z_offset_width.y;float right_width=a_z_offset_width.z;halfwidth=(u_width_scale*(left ? left_width : right_width))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;offset=border_width > 0.0 ? (left_width+right_width)*u_width_scale*0.5 : offset;halfwidth=border_width > 0.0 ? border_width*u_width_scale*0.5 : halfwidth;bool zero_right_width=border_width==0.0 && right_width==0.0;stub_side=zero_right_width ?-normal.y : 0.0;v_normal=!left && zero_right_width ? vec2(0.0) : v_normal;ANTIALIASING=!left && zero_right_width ? 0.0 : ANTIALIASING;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize lowp float emissive_strength
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef DUAL_SOURCE_BLENDING
glFragColorSrc1=vec4(vec3(0.0),emissive_strength);
#else
#ifdef USE_MRT1
out_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize lowp float emissive_strength
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
#ifdef USE_MRT1
out_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Ai(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Ai(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#define USING_APPEARANCE 1.0
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance==USING_APPEARANCE) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
#ifdef Z_TEST_OCCLUSION
out_fade_opacity*=occlusion_opacity;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Ai(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ic),skyboxGradient:Ai(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,Ic),skyboxCapture:Ai(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
uniform sampler2D u_image1;uniform float u_emissive_texture_available;
#endif
uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
float emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Ai(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Ai(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;
#ifdef DITHERED_DISCARD
uniform float u_dithered_discard_threshold;
#endif
uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef FLIP_Y
coord.y=1.0-coord.y;
#endif
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef DITHERED_DISCARD
if (abs(u_dithered_discard_threshold) < 1.0) {float ditherValue=fract(52.9829189*fract(0.06711056*gl_FragCoord.x+0.00583715*gl_FragCoord.y));float compareValue=mix(1.0-ditherValue,ditherValue,step(0.0,u_dithered_discard_threshold));if (abs(u_dithered_discard_threshold) < compareValue) {discard;}}
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#ifdef CLIP_ZERO_TO_ONE
v_depth=-1.0+2.0*v_depth; 
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Ai(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Ai(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function cl(h,t){const l=h.split(`
`);for(let d of l){if(d=d.trimStart(),d[0]!=="#"||!d.includes("if")||d.startsWith("#endif"))continue;const g=d.match(Np);if(g)for(const y of g)Bl.has(y)||t.add(y)}}function Ai(h,t){const l=new Set,d=[],g=[];h=h.replace(Zu,(x,T)=>(g.push(T),"")),t=t.replace(Zu,(x,T)=>(d.push(T),""));let y=new Set(Fl);cl(h,y),cl(t,y);for(const x of[...d,...g])_d[x]||(_d[x]=new Set,cl(ll[x],_d[x])),y=new Set([...y,..._d[x]]);return{fragmentSource:h=h.replace(aa,(x,T,E,L,P)=>(l.add(P),T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
in ${E} ${L} ${P};
#else
uniform ${E} ${L} u_${P};
#endif
`:T==="initialize"?`
#ifdef HAS_UNIFORM_u_${P}
    ${E} ${L} ${P} = u_${P};
#endif
`:T==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${P}
    in ${E} ${L} ${P};
#endif
`:T==="initialize-attribute"?"":void 0)),vertexSource:t=t.replace(aa,(x,T,E,L,P)=>{const z=`MATERIAL_ATTRIBUTE_OFFSET_${P}`,O=L==="float"?"vec2":L,B=`GET_ATTRIBUTE_${O}(a_${P}, materialInfo, ${z})`,G=P.match(/color/)?"color":O;return T==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${P}
in ${E} ${L} a_${P};
#endif
`:l.has(P)?T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
    #if !defined(${z})
        in ${E} ${O} a_${P};
    #endif
out ${E} ${L} ${P};
#else
uniform ${E} ${L} u_${P};
#endif
`:T==="initialize"?G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    ${P} = a_${P};
#else
    ${E} ${L} ${P} = u_${P};
#endif
`:`
#if !defined(HAS_UNIFORM_u_${P})
    #ifdef ${z}
        ${P} = unpack_mix_${G}(${B}, u_${P}_t);
    #else
        ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
    #endif
#else
    ${E} ${L} ${P} = u_${P};
#endif
`:T==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${P}
    in ${E} ${L} a_${P};
    out ${E} ${L} ${P};
#endif
`:T==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${P}
    ${P} = a_${P};
#endif
`:void 0:T==="define"?`
#ifndef HAS_UNIFORM_u_${P}
uniform lowp float u_${P}_t;
    #if !defined(${z})
        in ${E} ${O} a_${P};
    #endif
#else
uniform ${E} ${L} u_${P};
#endif
`:T==="define-instanced"?G==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${P}0;
in vec4 a_${P}1;
in vec4 a_${P}2;
in vec4 a_${P}3;
#else
uniform ${E} ${L} u_${P};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${E} ${O} a_${P};
#else
uniform ${E} ${L} u_${P};
#endif
`:T==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${P}
    ${E} ${L} ${P} = a_${P};
#endif
`:G==="vec4"?`
#ifndef HAS_UNIFORM_u_${P}
    #ifdef ${z}
        ${E} ${L} ${P} = ${B};
    #else
        ${E} ${L} ${P} = a_${P};
    #endif
#else
    ${E} ${L} ${P} = u_${P};
#endif
`:`
#ifndef HAS_UNIFORM_u_${P}
    #ifdef ${z}
        ${E} ${L} ${P} = unpack_mix_${G}(${B}, u_${P}_t);
    #else
        ${E} ${L} ${P} = unpack_mix_${G}(a_${P}, u_${P}_t);
    #endif
#else
    ${E} ${L} ${P} = u_${P};
#endif
`}),usedDefines:y,vertexIncludes:d,fragmentIncludes:g}}class m1{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(t,l,d,g,y,x,T,E){this.context=t;let L=this.boundPaintVertexBuffers.length!==g.length;for(let z=0;!L&&z<g.length;z++)this.boundPaintVertexBuffers[z]!==g[z]&&(L=!0);let P=this.boundDynamicVertexBuffers.length!==T.length;for(let z=0;!P&&z<T.length;z++)this.boundDynamicVertexBuffers[z]!==T[z]&&(P=!0);if(!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==d||L||P||this.boundIndexBuffer!==y||this.boundVertexOffset!==x)this.freshBind(l,d,g,y,x,T,E);else{t.bindVertexArrayOES.set(this.vao);for(const z of T)z&&(z.bind(),E&&z.instanceCount&&z.setVertexAttribDivisor(t.gl,l,E));y&&y.dynamicDraw&&y.bind()}}freshBind(t,l,d,g,y,x,T){const E=this.context,L=E.gl;this.vao&&this.destroy(),this.vao=E.gl.createVertexArray(),E.bindVertexArrayOES.set(this.vao),this.boundProgram=t,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=d,this.boundIndexBuffer=g,this.boundVertexOffset=y,this.boundDynamicVertexBuffers=x,l.enableAttributes(L,t),l.bind(),l.setVertexAttribPointers(L,t,y);for(const P of d)P.enableAttributes(L,t),P.bind(),P.setVertexAttribPointers(L,t,y);for(const P of x)P&&(P.enableAttributes(L,t),P.bind(),P.setVertexAttribPointers(L,t,y),T&&P.instanceCount&&P.setVertexAttribDivisor(L,t,T));g&&g.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function g1(h,t){const l=Math.pow(2,t.canonical.z),d=t.canonical.y;return[new o.ae(0,d/l).toLngLat().lat,new o.ae(0,(d+1)/l).toLngLat().lat]}function _1(h,t,l,d,g,y,x){const T=h.context,E=T.gl,L=l.hillshadeFBO;if(!L)return;h.prepareDrawTile();const P=h.isTileAffectedByFog(t),z=[];h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&z.push("USE_MRT1");const O=h.getOrCreateProgram("hillshade",{overrideFog:P,defines:z});T.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,L.colorAttachment0.get());const B=((Y,se,ne,te)=>{const we=ne.paint.get("hillshade-shadow-color"),_e=ne.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",be=ne.paint.get("hillshade-highlight-color"),de=ne.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",le=ne.paint.get("hillshade-accent-color"),Te=ne.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Me=ne.paint.get("hillshade-emissive-strength");let Oe=o.an(ne.paint.get("hillshade-illumination-direction"));if(ne.paint.get("hillshade-illumination-anchor")==="viewport")Oe-=Y.transform.angle;else if(Y.style&&Y.style.enable3dLights()&&Y.style.directionalLight){const je=Y.style.directionalLight.properties.get("direction"),Ye=o.d4(je.x,je.y,je.z);Oe=o.an(Ye[1])}const Ve=!Y.options.moving;return{u_matrix:te||Y.transform.calculateProjMatrix(se.tileID.toUnwrapped(),Ve),u_image:0,u_latrange:g1(0,se.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),Oe],u_shadow:we.toPremultipliedRenderColor(_e?null:ne.lut),u_highlight:be.toPremultipliedRenderColor(de?null:ne.lut),u_emissive_strength:Me,u_accent:le.toPremultipliedRenderColor(Te?null:ne.lut)}})(h,l,d,h.terrain?t.projMatrix:null);h.uploadCommonUniforms(T,O,t.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:V,tileBoundsSegments:W}=h.getTileBoundsBuffers(l);O.draw(h,E.TRIANGLES,g,y,x,Zt.disabled,B,d.id,G,V,W)}function Vp(h,t,l){if(!t.needsDEMTextureUpload)return;const d=h.context,g=d.gl;d.pixelStoreUnpackPremultiplyAlpha.set(!1),t.demTexture=t.demTexture||h.getTileTexture(l.stride);const y=l.getPixels();t.demTexture?t.demTexture.update(y,{premultiply:!1}):t.demTexture=new o.T(d,y,g.R32F,{premultiply:!1}),t.needsDEMTextureUpload=!1}function y1(h,t,l){const d=h.context,g=d.gl;if(!t.dem)return;const y=t.dem;if(d.activeTexture.set(g.TEXTURE1),Vp(h,t,y),!t.demTexture)return;t.demTexture.bind(g.NEAREST,g.CLAMP_TO_EDGE);const x=y.dim;d.activeTexture.set(g.TEXTURE0);let T=t.hillshadeFBO;if(!T){const O=new o.T(d,{width:x,height:x,data:null},g.RGBA8);O.bind(g.LINEAR,g.CLAMP_TO_EDGE),T=t.hillshadeFBO=d.createFramebuffer(x,x,1,"renderbuffer"),T.colorAttachment0.set(O.texture)}d.bindFramebuffer.set(T.framebuffer),d.viewport.set([0,0,x,x]);const{tileBoundsBuffer:E,tileBoundsIndexBuffer:L,tileBoundsSegments:P}=h.getMercatorTileBoundsBuffers(),z=[];h.linearFloatFilteringSupported()&&z.push("TERRAIN_DEM_FLOAT_FORMAT"),h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&z.push("USE_MRT1"),h.getOrCreateProgram("hillshadePrepare",{defines:z}).draw(h,g.TRIANGLES,Dt.disabled,Yt.disabled,ri.unblended,Zt.disabled,((O,B)=>{const G=B.stride,V=o.bC();return o.ce(V,0,o.al,-o.al,0,0,1),o.br(V,V,[0,-o.al,0]),{u_matrix:V,u_image:1,u_dimension:[G,G],u_zoom:O.overscaledZ}})(t.tileID,y),l.id,E,L,P),t.needsHillshadePrepare=!1}class mr{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class v1 extends mr{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class ay extends mr{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class $p extends mr{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class vd extends mr{getDefault(){return[!0,!0,!0,!0]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class Gp extends mr{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class jl extends mr{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Ac extends mr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const l=this.current;(t.func!==l.func||t.ref!==l.ref||t.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class Xu extends mr{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class Cc extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=t,this.dirty=!1}}class ly extends mr{getDefault(){return[0,1]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Hp extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=t,this.dirty=!1}}class cy extends mr{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class kc extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.BLEND):l.disable(l.BLEND),this.current=t,this.dirty=!1}}class xd extends mr{getDefault(){const t=this.gl;return[t.ONE,t.ZERO,t.ONE,t.ZERO]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.blendFuncSeparate(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class bd extends mr{getDefault(){return o.ao.transparent.toNonPremultipliedRenderColor(null)}set(t){const l=this.current;(t.r!==l.r||t.g!==l.g||t.b!==l.b||t.a!==l.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class Wp extends mr{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(t,t),this.current=t,this.dirty=!1)}}class wd extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;t?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=t,this.dirty=!1}}class Ku extends mr{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class uy extends mr{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}let hy=class extends mr{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class dy extends mr{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class Lc extends mr{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const l=this.current;(t[0]!==l[0]||t[1]!==l[1]||t[2]!==l[2]||t[3]!==l[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class fy extends mr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class x1 extends mr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class b1 extends mr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class w1 extends mr{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class qp extends mr{getDefault(){return null}set(t){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class Zp extends mr{getDefault(){return null}set(t){this.gl&&(t!==this.current||this.dirty)&&(this.gl.bindVertexArray(t),this.current=t,this.dirty=!1)}}class Xp extends mr{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class Kp extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class py extends mr{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class Sd extends mr{constructor(t,l){super(t),this.context=t,this.parent=l}getDefault(){return null}}class Td extends Sd{constructor(t,l,d=0){super(t,l),this.attachmentPoint=t.gl.COLOR_ATTACHMENT0+d}setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachmentPoint,l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class Pc extends Sd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class Yu extends Sd{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,this.attachment(),l.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class my extends Pc{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Js=(h,t,l,d)=>({u_matrix:h,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:l,u_emissive_texture_available:d}),Ed=(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(d),u_merc_matrix:l,u_zoom_transition:g,u_merc_center:y,u_image0:0,u_image1:1,u_frustum_tl:x,u_frustum_tr:T,u_frustum_br:E,u_frustum_bl:L,u_globe_pos:P,u_globe_radius:z,u_viewport:O,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:B,u_far_z_cutoff:G,u_emissive_texture_available:V});function Ju(h,t){return h!=null&&t!=null&&!(!h.hasData()||!t.hasData())&&h.demTexture!=null&&t.demTexture!=null&&h.tileID.key!==t.tileID.key}const Oa=new class{constructor(){this.operations={}}newMorphing(h,t,l,d,g){if(h in this.operations){const y=this.operations[h];y.to.tileID.key!==l.tileID.key&&(y.queued=l)}else this.operations[h]={startTime:d,phase:0,duration:g,from:t,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const t=this.operations[h];return{from:t.from,to:t.to,phase:t.phase}}update(h){for(const t in this.operations){const l=this.operations[t];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[t];break}}}_nextOp(h,t){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=t,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},Id={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Ad(h,t,l){if(t===0)return 0;const d=t<1&&l===514?.25/t:1;return 6*Math.pow(1.5,22-h)*Math.max(t,1)*d}function Yp(h,t){const l=1<<h.z;return!t&&(h.x===0||h.x===l-1)||h.y===0||h.y===l-1}function Mc(h,t){if(!h.style||!h.style.enable3dLights())return;const l=h.context,d=l.gl;l.activeTexture.set(d.TEXTURE1),t?t.bind(d.LINEAR,d.CLAMP_TO_EDGE):h.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE)}const Qu=h=>({u_matrix:h});function eh(h,t,l,d,g){if(g>0){const y=o.o.now(),x=(y-h.timeAdded)/g,T=t?(y-t.timeAdded)/g:-1,E=l.getSource(),L=d.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),P=!t||Math.abs(t.tileID.overscaledZ-L)>Math.abs(h.tileID.overscaledZ-L),z=P&&h.refreshedUponExpiration?1:o.aA(P?x:1-T,0,1);return t?{opacity:1,mix:1-z,isFading:x<1}:{opacity:z,mix:0,isFading:x<1}}return{opacity:1,mix:0,isFading:!1}}class Cd extends gs{constructor(t){const l=Ml("mock-dem",{type:"raster-dem",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("mock-dem",l,!1),l.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,l){t.state="loaded",l(null)}}class Jp extends gs{constructor(t){const l=Ml("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},t.style.dispatcher,t.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(t,l,d){if(t.freezeTileCoverage)return;this.transform=t;const g=t.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((y,x)=>{if(y[x.key]="",!this._tiles[x.key]){const T=new tl(x,this._source.tileSize*x.overscaleFactor(),t.tileZoom,void 0,void 0,this._source.worldview);T.state="loaded",this._tiles[x.key]=T}return y},{});for(const y in this._tiles)y in g||(this.freeFBO(y),this._tiles[y].unloadVectorData(),delete this._tiles[y])}freeFBO(t){const l=this.proxyCachedFBO[t];if(l!==void 0){const d=Object.values(l);this.renderCachePool.push(...d),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qp extends o.aQ{constructor(t,l,d){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=l,this.projMatrix=d}}class em extends o.bV{constructor(t,l){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[d,g,y]=function(){const E=new o.bd,L=new o.b0,P=131;E.reserve(17161),L.reserve(33800);const z=o.al/128,O=o.al+z/2,B=O+z;for(let V=-z;V<B;V+=z)for(let W=-z;W<B;W+=z){const Y=W<0||W>O||V<0||V>O?24575:0,se=o.aA(Math.round(W),0,o.al),ne=o.aA(Math.round(V),0,o.al);E.emplaceBack(se+Y,ne)}const G=(V,W)=>{const Y=W*P+V;L.emplaceBack(Y+1,Y,Y+P),L.emplaceBack(Y+P,Y+P+1,Y+1)};for(let V=1;V<129;V++)for(let W=1;W<129;W++)G(W,V);return[0,129].forEach(V=>{for(let W=0;W<130;W++)G(W,V),G(V,W)}),[E,L,32768]}(),x=t.context;this.gridBuffer=x.createVertexBuffer(d,o.bf.members),this.gridIndexBuffer=x.createIndexBuffer(g),this.gridSegments=o.bg.simpleSegment(0,0,d.length,g.length),this.gridNoSkirtSegments=o.bg.simpleSegment(0,0,d.length,y),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Jp(l.map),this.orthoMatrix=o.bC(),o.ce(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.al,0,o.al,0,1);const T=x.gl;this._overlapStencilMode=new Yt({func:T.GEQUAL,mask:255},0,255,T.KEEP,T.KEEP,T.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Cd(l.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),this._style=t,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,l,d){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const g=t.terrain.properties,y=t.terrain.drapeRenderMode===0,x=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.o.now();const T=t.terrain&&t.terrain.scope,E=g.get("source"),L=y?this._mockSourceCache:t.getSourceCache(E,T);if(!L)return void o.w(`Couldn't find terrain source "${E}".`);if(this.sourceCache=L,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=x?this.calculateExaggeration(l):g.get("exaggeration"),!l.projection.requiresDraping&&x&&this._exaggeration===0)return void this._disable();this.enabled=!0;const P=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const z=this.getScaledDemTileSize();this.sourceCache.update(l,z,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,P(),this._initializing=!0),P(),l.updateElevation(!0,d),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0,this._previousZoom=l.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const l=this._previousCameraAltitude,d=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=d;const g=l!=null?d-l:Number.MAX_VALUE;if(Math.abs(g)<2)return this._exaggeration;const y=t.zoom,x=this._style.terrain;if(!this._previousUpdateTimestamp)return x.getExaggeration(y);let T=y-this._previousZoom;const E=this._previousUpdateTimestamp;let L=y;this._evaluationZoom!=null&&(L=this._evaluationZoom,Math.abs(y-L)>.5&&(T=.5*(y-L+T)),T*g<0&&(L+=T)),this._evaluationZoom=L;const P=x.getExaggeration(L),z=P===x.getExaggeration(Math.max(0,L-.1));if(z&&Math.abs(P-this._exaggeration)<.01)return P;let O=Math.min(.1,.00375*(this._updateTimestamp-E));return(z||P<.1||Math.abs(T)<1e-4)&&(O=Math.min(.2,4*O)),o.ak(this._exaggeration,P,O)}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(t){t.dataType==="source"&&t.coord?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):t.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._mergedSourceCaches)this._style._mergedSourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,d=this.painter.transform;this._initializing&&(this._initializing=d._centerAltitude===0&&this.getAtPointOrZero(o.ae.fromLngLat(d.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const g=this.proxyCoords=l.getIds().map(E=>{const L=l.getTileByID(E).tileID;return L.projMatrix=d.calculateProjMatrix(L.toUnwrapped()),L});(function(E,L){const P=L.transform.pointCoordinate(L.transform.getCameraPoint()),z=new o.P(P.x,P.y);E.sort((O,B)=>{if(B.overscaledZ-O.overscaledZ)return B.overscaledZ-O.overscaledZ;const G=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),V=new o.P(B.canonical.x+(1<<B.canonical.z)*B.wrap,B.canonical.y),W=z.mult(1<<O.canonical.z);return W.x-=.5,W.y-=.5,W.distSqr(G)-W.distSqr(V)})})(g,this.painter);const y=this.proxyToSource||{};this.proxyToSource={},g.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const x=this._style._mergedSourceCaches;for(const E in x){const L=x[E];if(!L.used||(L!==this.sourceCache&&this.resetTileLookupCache(L.id),this._setupProxiedCoordsForOrtho(L,t[E],y),L.usedForTerrain))continue;const P=t[E];L.getSource().reparseOverscaled&&this._assignTerrainTiles(P)}this.proxiedCoords[l.id]=g.map(E=>new Qp(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(g),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(y),this.renderingToTexture=!1;const T={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const L=this.terrainTileForTile[E.key];if(!L)continue;const P=L.tileID.key;P in T||(this._visibleDemTiles.push(L),T[P]=P)}}_assignTerrainTiles(t){this._initializing||t.forEach(l=>{if(this.terrainTileForTile[l.key])return;const d=this._findTileCoveringTileID(l,this.sourceCache);d&&(this.terrainTileForTile[l.key]=d)})}_prepareDEMTextures(){const t=this.painter.context,l=t.gl;for(const d in this.terrainTileForTile){const g=this.terrainTileForTile[d],y=g.dem;!y||g.demTexture&&!g.needsDEMTextureUpload||(t.activeTexture.set(l.TEXTURE1),Vp(this.painter,g,y))}}_prepareDemTileUniforms(t,l,d,g){if(!l||l.demTexture==null)return!1;const y=t.tileID.canonical,x=Math.pow(2,l.tileID.canonical.z-y.z),T=g||"";return d[`u_dem_tl${T}`]=[y.x*x%1,y.y*x%1],d[`u_dem_scale${T}`]=x,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let t=0;const l=this._visibleDemTiles.reduce((d,g)=>{if(!g.dem)return d;const y=g.dem.tree.minimums[0];return y>0&&t++,d+y},0);return t?l/t:0}_updateEmptyDEMTexture(){const t=this.painter.context,l=t.gl;t.activeTexture.set(l.TEXTURE2);const d=this._getLoadedAreaMinimum(),g=new o.dL({width:1,height:1},new Float32Array([d]));this._emptyDEMTextureDirty=!1;let y=this._emptyDEMTexture;return y?y.update(g,{premultiply:!1}):y=this._emptyDEMTexture=new o.T(t,g,l.R32F,{premultiply:!1}),y}setupElevationDraw(t,l,d){const g=this.painter.context,y=g.gl,x={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};x.u_exaggeration=this.exaggeration();let T=null,E=null,L=1;if(d&&d.morphing&&this._useVertexMorphing){const B=d.morphing.srcDemTile,G=d.morphing.dstDemTile;L=d.morphing.phase,B&&G&&(this._prepareDemTileUniforms(t,B,x,"_prev")&&(E=B),this._prepareDemTileUniforms(t,G,x)&&(T=G))}const P=B=>B&&B.demTexture&&this.painter.linearFloatFilteringSupported()?y.LINEAR:y.NEAREST;let z=null;var O;if(this.enabled?E&&T?(z=T.demTexture,g.activeTexture.set(y.TEXTURE4),E.demTexture.bind(P(E),y.CLAMP_TO_EDGE),x.u_dem_lerp=L):(T=this.terrainTileForTile[t.tileID.key],z=this._prepareDemTileUniforms(t,T,x)?T.demTexture:this.emptyDEMTexture):z=this.emptyDEMTexture,g.activeTexture.set(y.TEXTURE2),z&&(x.u_dem_size=(O=z).size[0]===1?1:O.size[0]-2,z.bind(P(T),y.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(d&&d.useDepthForOcclusion,l,x),d&&d.useMeterToDem&&T){const B=(1<<T.tileID.canonical.z)*o.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;x.u_meter_to_dem=B}if(d&&d.labelPlaneMatrixInv&&(x.u_label_plane_matrix_inv=d.labelPlaneMatrixInv),l.setTerrainUniformValues(g,x),this.painter.transform.projection.name==="globe"){const B=this.globeUniformValues(this.painter.transform,t.tileID.canonical,d&&d.useDenormalizedUpVectorScale);l.setGlobeUniformValues(g,B)}}globeUniformValues(t,l,d){const g=t.projection;return{u_tile_tl_up:g.upVector(l,0,0),u_tile_tr_up:g.upVector(l,o.al,0),u_tile_br_up:g.upVector(l,o.al,o.al),u_tile_bl_up:g.upVector(l,0,o.al),u_tile_up_scale:d?o.dM(1):g.upVectorScale(l,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const l=this.painter,d=this.painter.context;t.length!==0&&(d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(g,y,x,T,E){if(g.transform.projection.name==="globe")(function(L,P,z,O,B){const G=L.context,V=G.gl;let W,Y;const se=L.transform,ne=o.dE(L,G,se),te=(Ve,je)=>{if(Y===je)return;const Ye=[Id[je],"PROJECTION_GLOBE_VIEW"];ne&&Ye.push("CUSTOM_ANTIALIASING");const nt=L.isTileAffectedByFog(Ve);W=L.getOrCreateProgram("globeRaster",{defines:Ye,overrideFog:nt}),Y=je},we=L.colorModeForRenderPass(),_e=new Dt(V.LEQUAL,Dt.ReadWrite,L.depthRangeFor3D);Oa.update(B);const be=o.dF(se),de=[o.aF(se.center.lng),o.aJ(se.center.lat)],le=L.globeSharedBuffers,Te=[se.width*o.o.devicePixelRatio,se.height*o.o.devicePixelRatio],Me=Float32Array.from(se.globeMatrix),Oe={useDenormalizedUpVectorScale:!0};{const Ve=L.transform,je=Ad(Ve.zoom,P.exaggeration(),P.sourceCache._source.tileSize);Y=-1;const Ye=V.TRIANGLES;for(const nt of O){const Fe=z.getTile(nt),Ie=Yt.disabled,Xe=P.prevTerrainTileForTile[nt.key],$e=P.terrainTileForTile[nt.key];Ju(Xe,$e)&&Oa.newMorphing(nt.key,Xe,$e,B,250),Mc(L,Fe.emissiveTexture),G.activeTexture.set(V.TEXTURE0),Fe.texture&&Fe.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ot=Oa.getMorphValuesForProxy(nt.key),ht=ot?1:0;ot&&Object.assign(Oe,{morphing:{srcDemTile:ot.from,dstDemTile:ot.to,phase:o.dD(ot.phase)}});const yt=o.dG(nt.canonical),dt=o.dH(yt.getCenter().lat),pt=o.dI(nt.canonical,yt,dt,Ve.worldSize/Ve._pixelsPerMercatorPixel),Mt=o.bk(o.dJ(nt.canonical)),Lt=L.emissiveMode==="mrt-fallback"?1:0,bt=Ed(Ve.expandedFarZProjMatrix,Me,be,Mt,o.aj(Ve.zoom),de,Ve.frustumCorners.TL,Ve.frustumCorners.TR,Ve.frustumCorners.BR,Ve.frustumCorners.BL,Ve.globeCenterInViewSpace,Ve.globeRadius,Te,je,Ve._farZ,Lt,pt);if(te(nt,ht),W&&(P.setupElevationDraw(Fe,W,Oe),L.uploadCommonUniforms(G,W,nt.toUnwrapped()),le)){const[kt,jt,Xt]=le.getGridBuffers(dt,je!==0);W.draw(L,Ye,_e,Ie,we,Zt.backCCW,bt,"globe_raster",kt,jt,Xt)}}}if(le&&(L.renderDefaultNorthPole||L.renderDefaultSouthPole)){const Ve=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ne&&Ve.push("CUSTOM_ANTIALIASING"),W=L.getOrCreateProgram("globeRaster",{defines:Ve});for(const je of O){const{x:Ye,y:nt,z:Fe}=je.canonical,Ie=nt===0,Xe=nt===(1<<Fe)-1,[$e,ot,ht,yt]=le.getPoleBuffers(Fe,!1);if(yt&&(Ie||Xe)){const dt=z.getTile(je);Mc(L,dt.emissiveTexture),G.activeTexture.set(V.TEXTURE0),dt.texture&&dt.texture.bind(V.LINEAR,V.CLAMP_TO_EDGE);let pt=o.dK(Fe,Ye,se);const Mt=o.bk(o.dJ(je.canonical)),Lt=L.emissiveMode==="mrt-fallback"?1:0,bt=(kt,jt)=>kt.draw(L,V.TRIANGLES,_e,Yt.disabled,we,Zt.disabled,Ed(se.expandedFarZProjMatrix,pt,pt,Mt,0,de,se.frustumCorners.TL,se.frustumCorners.TR,se.frustumCorners.BR,se.frustumCorners.BL,se.globeCenterInViewSpace,se.globeRadius,Te,0,se._farZ,Lt),"globe_pole_raster",jt,ht,yt);P.setupElevationDraw(dt,W,Oe),L.uploadCommonUniforms(G,W,je.toUnwrapped()),Ie&&L.renderDefaultNorthPole&&bt(W,$e),Xe&&L.renderDefaultSouthPole&&(pt=o.cS(o.bC(),pt,[1,-1,1]),bt(W,ot))}}}})(g,y,x,T,E);else{const L=g.context,P=L.gl;let z,O;const B=g.shadowRenderer,G=xo(g,g.longestCutoffRange),V=we=>{if(O===we)return;const _e=[];_e.push(Id[we]),G.shouldRenderCutoff&&_e.push("RENDER_CUTOFF"),B&&(_e.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&_e.push("NORMAL_OFFSET")),z=g.getOrCreateProgram("terrainRaster",{defines:_e}),O=we},W=g.colorModeForRenderPass(),Y=new Dt(P.LEQUAL,Dt.ReadWrite,g.depthRangeFor3D);Oa.update(E);const se=g.transform,ne=Ad(se.zoom,y.exaggeration(),y.sourceCache._source.tileSize);let te=[0,0,0];if(B){const we=g.style.directionalLight,_e=g.style.ambientLight;we&&_e&&(te=bo(g.style,we,_e))}{O=-1;const we=P.TRIANGLES,[_e,be]=[y.gridIndexBuffer,y.gridSegments];for(const de of T){const le=x.getTile(de),Te=Yt.disabled,Me=y.prevTerrainTileForTile[de.key],Oe=y.terrainTileForTile[de.key];Ju(Me,Oe)&&Oa.newMorphing(de.key,Me,Oe,E,250),Mc(g,le.emissiveTexture),L.activeTexture.set(P.TEXTURE0),le.texture&&le.texture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const Ve=Oa.getMorphValuesForProxy(de.key),je=Ve?1:0;let Ye;Ve&&(Ye={morphing:{srcDemTile:Ve.from,dstDemTile:Ve.to,phase:o.dD(Ve.phase)}});const nt=g.emissiveMode==="mrt-fallback"?1:0,Fe=Js(de.projMatrix,Yp(de.canonical,se.renderWorldCopies)?ne/10:ne,te,nt);if(V(je),!z)continue;y.setupElevationDraw(le,z,Ye);const Ie=de.toUnwrapped();B&&B.setupShadows(Ie,z),g.uploadCommonUniforms(L,z,Ie,null,G),z.draw(g,we,Y,Te,W,Zt.backCCW,Fe,"terrain_raster",y.gridBuffer,_e,be)}}}}(l,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(this._drapedRenderBatches.length===0)return t+1;this.renderingToTexture=!0;const l=this.painter,d=this.painter.context,g=this.proxySourceCache,y=this.proxiedCoords[g.id],x=this._drapedRenderBatches.shift(),T=l.style.order,E=[];this._updateFBOs(l.emissiveMode==="mrt-fallback");let L=0;for(const P of y){const z=g.getTileByID(P.proxyTileKey),O=g.proxyCachedFBO[P.key]?g.proxyCachedFBO[P.key][t]:void 0,B=O!==void 0?g.renderCache[O]:this.pool[L++],G=O!==void 0;if(z.texture=B.tex,z.emissiveTexture=B.emissiveTex,G&&!B.dirty){E.push(z.tileID);continue}d.bindFramebuffer.set(B.fb.framebuffer);const V=d.gl;let W;V.drawBuffers(l.emissiveMode==="mrt-fallback"?[V.COLOR_ATTACHMENT0,V.COLOR_ATTACHMENT1]:[V.COLOR_ATTACHMENT0]),this.renderedToTile=!1,B.dirty&&(d.clear({color:o.ao.transparent,stencil:0}),B.dirty=!1);for(let Y=x.start;Y<=x.end;++Y){const se=l.style._mergedLayers[T[Y]];if(se.isHidden(l.transform.zoom))continue;const ne=l.style.getLayerSourceCache(se),te=ne?this.proxyToSource[P.key][ne.id]:[P];if(!te)continue;const we=te;d.viewport.set([0,0,B.fb.width,B.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(B,te,se,ne),W=ne?ne.id:null),l.renderLayer(l,ne,se,we)}if(V.drawBuffers([V.COLOR_ATTACHMENT0]),this._drapedRenderBatches.length===0)for(const Y of this._pendingGroundEffectLayers){const se=l.style._mergedLayers[T[Y]];if(se.isHidden(l.transform.zoom))continue;const ne=l.style.getLayerSourceCache(se),te=ne?this.proxyToSource[P.key][ne.id]:[P];if(!te)continue;const we=te;d.viewport.set([0,0,B.fb.width,B.fb.height]),W!==(ne?ne.id:null)&&(this._setupStencil(B,te,se,ne),W=ne?ne.id:null),l.renderLayer(l,ne,se,we)}this.renderedToTile?(B.dirty=!0,E.push(z.tileID)):G||--L,L===5&&(L=0,this.renderToBackBuffer(E))}return this.renderToBackBuffer(E),this.renderingToTexture=!1,d.bindFramebuffer.set(null),d.viewport.set([0,0,l.width,l.height]),x.end+1}postRender(){}isLayerOrderingCorrect(t){const l=t.order.length;let d=-1,g=l;for(let y=0;y<l;++y)this._style.isLayerDraped(t._mergedLayers[t.order[y]])?d=Math.max(d,y):g=Math.min(g,y);return g>d}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{t=Math.min(t,l.dem.tree.minimums[0])}),t===0?t:(t-30)*this._exaggeration}raycast(t,l,d){if(!this._visibleDemTiles)return null;const g=this._visibleDemTiles.filter(y=>y.dem).map(y=>{const x=y.tileID,T=1<<x.overscaledZ,{x:E,y:L}=x.canonical,P=E/T,z=(E+1)/T,O=L/T,B=(L+1)/T;return{minx:P,miny:O,maxx:z,maxy:B,t:y.dem.tree.raycastRoot(P,O,z,B,t,l,d),tile:y}});g.sort((y,x)=>(y.t!==null?y.t:Number.MAX_VALUE)-(x.t!==null?x.t:Number.MAX_VALUE));for(const y of g){if(y.t==null)return null;const x=y.tile.dem.tree.raycast(y.minx,y.miny,y.maxx,y.maxy,t,l,d);if(x!=null)return x}return null}_createFBO(){const t=this.painter.context,l=t.gl,d=this.drapeBufferSize;t.activeTexture.set(l.TEXTURE0);const g=new o.T(t,{width:d[0],height:d[1],data:null},l.RGBA8);g.bind(l.LINEAR,l.CLAMP_TO_EDGE);const y=t.createFramebuffer(d[0],d[1],1,null);let x;return y.colorAttachment0.set(g.texture),this._emissiveTexture&&(x=new o.T(t,{width:d[0],height:d[1],data:null},l.R8),x.bind(l.LINEAR,l.CLAMP_TO_EDGE),y.createColorAttachment(t,1),y.colorAttachment1.set(x.texture)),y.depthAttachment=new my(t,y.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,d[0],d[1]),this._stencilRef=0,y.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):y.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&l.texParameterf(l.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:y,tex:g,emissiveTex:x,dirty:!1}}_updateFBOs(t){if(this._emissiveTexture!==t){for(const l of this.pool)this._updateFBO(l,t);for(const l of this.proxySourceCache.renderCache)this._updateFBO(l,t);this._emissiveTexture=t}}_updateFBO(t,l){const d=t.fb,g=this.painter.context,y=g.gl,x=this.drapeBufferSize;if(l){const T=new o.T(g,{width:x[0],height:x[1],data:null},y.R8);T.bind(y.LINEAR,y.CLAMP_TO_EDGE),t.emissiveTex=T,d.createColorAttachment(g,1),d.colorAttachment1.set(T.texture)}else t.emissiveTex=void 0,d.removeColorAttachment(g,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const t in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const l=this._style._mergedLayers[t],d=l.isHidden(this.painter.transform.zoom);return l.type==="hillshade"||l.type==="custom"?!d&&l.shouldRedrape():!d&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const d of this._style.getSources())if(d instanceof yo){t=!0;break}if(!t)return;const l={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(!y||l[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="line")continue;const x=g.widthExpression(),T=g.emissiveStrengthExpression();if(x instanceof o.ad||T instanceof o.ad){l[y.id]=!0;for(const E of this.proxyCoords){const L=this.proxyToSource[E.key][y.id];if(L)for(const P of L)this._clearRenderCacheForTile(y.id,P)}}}}_clearRasterLayersFromRenderCache(){let t=!1;for(const d in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[d]._source instanceof Bo){t=!0;break}if(!t)return;const l={};for(let d=0;d<this._style.order.length;++d){const g=this._style._mergedLayers[this._style.order[d]],y=this._style.getLayerSourceCache(g);if(!y||l[y.id]||g.isHidden(this.painter.transform.zoom)||g.type!=="raster")continue;const x=g.paint.get("raster-fade-duration");for(const T of this.proxyCoords){const E=this.proxyToSource[T.key][y.id];if(E)for(const L of E){const P=eh(y.getTile(L),y.findLoadedParent(L,0),y,this.painter.transform,x);(P.opacity!==1||P.mix!==0)&&this._clearRenderCacheForTile(y.id,L)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,l=t.length;if(l===0)return;const d=[];this._pendingGroundEffectLayers=[];let g,y=0,x=this._style._mergedLayers[t[y]];for(;!this._style.isLayerDraped(x)&&x.isHidden(this.painter.transform.zoom)&&++y<l;)x=this._style._mergedLayers[t[y]];for(;y<l;++y){const T=this._style._mergedLayers[t[y]];T.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(T)?g===void 0&&(g=y):(T.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(y),g!==void 0&&(d.push({start:g,end:y-1}),g=void 0)))}if(g!==void 0&&d.push({start:g,end:y-1}),d.length!==0){const T=d[d.length-1];this._pendingGroundEffectLayers.every(E=>E>T.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=d}_setupRenderCache(t){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const x=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let T=0;T<x.length;++T){const E=Object.values(x[T]);l.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const d=this.proxyCoords,g=this._tilesDirty;for(let x=d.length-1;x>=0;x--){const T=d[x];if(l.getTileByID(T.key),l.proxyCachedFBO[T.key]!==void 0){const E=t[T.key],L=this.proxyToSource[T.key];let P=0;for(const z in L){const O=L[z],B=E[z];if(!B||B.length!==O.length||O.some((G,V)=>G!==B[V]||g[z]&&g[z].hasOwnProperty(G.key))){P=-1;break}++P}for(const z in l.proxyCachedFBO[T.key])l.renderCache[l.proxyCachedFBO[T.key][z]].dirty=P<0||P!==Object.values(E).length}}const y=[...this._drapedRenderBatches];y.sort((x,T)=>T.end-T.start-(x.end-x.start));for(const x of y)for(const T of d){if(l.proxyCachedFBO[T.key])continue;let E=l.renderCachePool.pop();E===void 0&&l.renderCache.length<50&&(E=l.renderCache.length,l.renderCache.push(this._createFBO())),E!==void 0&&(l.proxyCachedFBO[T.key]={},l.proxyCachedFBO[T.key][x.start]=E,l.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(t,l,d,g){if(!g||!this._sourceTilesOverlap[g.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const y=this.painter.context,x=y.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let T;if(d.isTileClipped())T=l.length,this._overlapStencilMode.test={func:x.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);T=1,this._overlapStencilMode.test={func:x.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+T>255&&(y.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=T,this._overlapStencilMode.ref=this._stencilRef,d.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(t){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[t.key]),this._overlapStencilMode):Yt.disabled}_renderTileClippingMasks(t,l){const d=this.painter,g=this.painter.context,y=g.gl;d._tileClippingMaskIDs={},g.setColorMode(ri.disabled),g.setDepthMode(Dt.disabled);const x=d.getOrCreateProgram("clippingMask");for(const T of t){const E=d._tileClippingMaskIDs[T.key]=--l;x.draw(d,y.TRIANGLES,Dt.disabled,new Yt({func:y.ALWAYS,mask:0},E,255,y.KEEP,y.KEEP,y.REPLACE),ri.disabled,Zt.disabled,Qu(T.projMatrix),"$clipping",d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}}pointCoordinate(t){const l=this.painter.transform;if(t.x<0||t.x>l.width||t.y<0||t.y>l.height)return null;const d=[t.x,t.y,1,1];o.aC(d,d,l.pixelMatrixInverse),o.cK(d,d,1/d[3]),d[0]/=l.worldSize,d[1]/=l.worldSize;const g=l._camera.position,y=o.cf(1,l.center.lat),x=[g[0],g[1],g[2]/y,0],T=o.da([],d.slice(0,3),x);o.aw(T,T);const E=this.raycast(x,T,this._exaggeration);return E!==null&&E?(o.bH(x,x,T,E),x[3]=x[2],x[2]*=y,x):null}_setupProxiedCoordsForOrtho(t,l,d){if(t.getSource()instanceof o.aU)return this._setupProxiedCoordsForImageSource(t,l,d);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords;for(let E=0;E<y.length;E++){const L=y[E],P=this._findTileCoveringTileID(L,t);if(P){const z=this._createProxiedId(L,P,d[L.key]&&d[L.key][t.id]);g.push(z),this.proxyToSource[L.key][t.id]=[z]}}let x=!1;const T=new Set;for(let E=0;E<l.length;E++){const L=t.getTile(l[E]);if(!L||!L.hasData())continue;const P=this._findTileCoveringTileID(L.tileID,this.proxySourceCache);if(P&&P.tileID.canonical.z!==L.tileID.canonical.z){const z=this.proxyToSource[P.tileID.key][t.id],O=this._createProxiedId(P.tileID,L,d[P.tileID.key]&&d[P.tileID.key][t.id]);z?z.splice(z.length-1,0,O):this.proxyToSource[P.tileID.key][t.id]=[O];const B=this.proxyToSource[P.tileID.key][t.id];T.has(B)||T.add(B),g.push(O),x=!0}}if(this._sourceTilesOverlap[t.id]=x,x&&this._debugParams.sortTilesHiZFirst)for(const E of T)E.sort((L,P)=>P.overscaledZ-L.overscaledZ)}_setupProxiedCoordsForImageSource(t,l,d){if(!t.getSource().loaded())return;const g=this.proxiedCoords[t.id]=[],y=this.proxyCoords,x=t.getSource(),T=x.tileID;if(!T)return;const E=new o.P(T.x,T.y)._div(1<<T.z),L=x.coordinates.map(o.ae.fromLngLat).reduce((z,O)=>(z.min.x=Math.min(z.min.x,O.x-E.x),z.min.y=Math.min(z.min.y,O.y-E.y),z.max.x=Math.max(z.max.x,O.x-E.x),z.max.y=Math.max(z.max.y,O.y-E.y),z),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),P=(z,O)=>{const B=z.wrap+z.canonical.x/(1<<z.canonical.z),G=z.canonical.y/(1<<z.canonical.z),V=o.al/(1<<z.canonical.z),W=O.wrap+O.canonical.x/(1<<O.canonical.z),Y=O.canonical.y/(1<<O.canonical.z);return B+V<W+L.min.x||B>W+L.max.x||G+V<Y+L.min.y||G>Y+L.max.y};for(let z=0;z<y.length;z++){const O=y[z];for(let B=0;B<l.length;B++){const G=t.getTile(l[B]);if(!G||!G.hasData()||P(O,G.tileID))continue;const V=this._createProxiedId(O,G,d[O.key]&&d[O.key][t.id]),W=this.proxyToSource[O.key][t.id];W?W.push(V):this.proxyToSource[O.key][t.id]=[V],g.push(V)}}}_createProxiedId(t,l,d){let g=this.orthoMatrix;if(d){const y=d.find(x=>x.key===l.tileID.key);if(y)return y}if(l.tileID.key!==t.key){const y=t.canonical.z-l.tileID.canonical.z;let x,T,E;g=o.bC();const L=l.tileID.wrap-t.wrap<<t.overscaledZ;y>0?(x=o.al>>y,T=x*((l.tileID.canonical.x<<y)-t.canonical.x+L),E=x*((l.tileID.canonical.y<<y)-t.canonical.y)):(x=o.al<<-y,T=o.al*(l.tileID.canonical.x-(t.canonical.x+L<<-y)),E=o.al*(l.tileID.canonical.y-(t.canonical.y<<-y))),o.ce(g,0,x,0,x,0,1),o.br(g,g,[T,E,0])}return new Qp(l.tileID,t.key,g)}_findTileCoveringTileID(t,l){let d=l.getTile(t);if(d&&d.hasData())return d;const g=this._findCoveringTileCache[l.id],y=g[t.key];if(d=y?l.getTileByID(y):null,d&&d.hasData()||y===null)return d;let x=d?d.tileID:t,T=x.overscaledZ;const E=l.getSource().minzoom,L=[];if(!y){const z=l.getSource().maxzoom;if(t.canonical.z>=z){const O=t.canonical.z-z;l.getSource().reparseOverscaled?(T=Math.max(t.canonical.z+2,l.transform.tileZoom),x=new o.aQ(T,t.wrap,z,t.canonical.x>>O,t.canonical.y>>O)):O!==0&&(T=z,x=new o.aQ(T,t.wrap,z,t.canonical.x>>O,t.canonical.y>>O))}x.key!==t.key&&(L.push(x.key),d=l.getTile(x))}const P=z=>{L.forEach(O=>{g[O]=z}),L.length=0};for(T-=1;T>=E&&(!d||!d.hasData());T--){d&&P(d.tileID.key);const z=x.calculateScaledKey(T);if(d=l.getTileByID(z),d&&d.hasData())break;const O=g[z];if(O===null)break;O===void 0?L.push(z):d=l.getTileByID(O)}return P(d?d.tileID.key:null),d&&d.hasData()?d:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,l){let d=this._tilesDirty[t];d||(d=this._tilesDirty[t]={}),d[l.key]=!0}}function Rc(h,t,l){const d=function(T,E,L){const P=o.bJ(E,T),z=o.bJ(L,[.2126,.7152,.0722]),O=(G,V,W)=>(1-W)*G+W*V,B=O(1-.3*Math.min(z,1),1,Math.min(P+1,1));return O(.92,1,Math.asin(o.aA(E[2],-1,1))/Math.PI+.5)*B}(h,[0,0,1],t),g=[0,0,0];o.c5(g,l.slice(0,3),d);const y=[0,0,0];o.c5(y,t.slice(0,3),h[2]);const x=[0,0,0];return o.d8(x,g,y),o.db(x)}const S1=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],T1=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class gy{static cacheKey(t,l,d,g){const y=[l];g&&y.push(g.cacheKey);for(const x of d)t.usedDefines.has(x)&&y.push(x);return y.join("/")}constructor(t,l,d,g,y,x){const T=t.gl;this.program=T.createProgram(),this.configuration=g,this.name=l,this.fixedDefines=[...x];const E=`#version 300 es
${(g?g.defines():[]).concat(x.map(V=>`#define ${V}`)).join(`
`)}`,L=[E,p1];for(const V of d.fragmentIncludes)L.push(ll[V]);L.push(d.fragmentSource);const P=L.join(`
`),z=[E,oy];for(const V of d.vertexIncludes)z.push(ll[V]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&d.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&z.push("uniform int u_instanceID;"),z.push(d.vertexSource);let O=z.join(`
`);this.forceManualRenderingForInstanceIDShaders&&(O=O.replaceAll("gl_InstanceID","u_instanceID"));const B=T.createShader(T.FRAGMENT_SHADER);if(T.isContextLost())return void(this.failedToCreate=!0);T.shaderSource(B,P),T.compileShader(B),T.attachShader(this.program,B);const G=T.createShader(T.VERTEX_SHADER);T.isContextLost()?this.failedToCreate=!0:(T.shaderSource(G,O),T.compileShader(G),T.attachShader(this.program,G),this.attributes={},T.linkProgram(this.program),T.deleteShader(G),T.deleteShader(B),this.fixedUniforms=y(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=g?g.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(V=>({u_instanceID:new o.ch(V)}))(t)),(x.includes("TERRAIN")||l.includes("symbol")||l.includes("circle"))&&(this.terrainUniforms=(V=>({u_dem:new o.ch(V),u_dem_prev:new o.ch(V),u_dem_tl:new o.ck(V),u_dem_scale:new o.cj(V),u_dem_tl_prev:new o.ck(V),u_dem_scale_prev:new o.cj(V),u_dem_size:new o.cj(V),u_dem_lerp:new o.cj(V),u_exaggeration:new o.cj(V),u_depth:new o.ch(V),u_depth_size_inv:new o.ck(V),u_depth_range_unpack:new o.ck(V),u_occluder_half_size:new o.cj(V),u_occlusion_depth_offset:new o.cj(V),u_meter_to_dem:new o.cj(V),u_label_plane_matrix_inv:new o.cl(V)}))(t)),x.includes("GLOBE")&&(this.globeUniforms=(V=>({u_tile_tl_up:new o.ci(V),u_tile_tr_up:new o.ci(V),u_tile_br_up:new o.ci(V),u_tile_bl_up:new o.ci(V),u_tile_up_scale:new o.cj(V)}))(t)),x.includes("FOG")&&(this.fogUniforms=(V=>({u_fog_matrix:new o.cl(V),u_fog_range:new o.ck(V),u_fog_color:new o.d3(V),u_fog_horizon_blend:new o.cj(V),u_fog_vertical_limit:new o.ck(V),u_fog_temporal_offset:new o.cj(V),u_frustum_tl:new o.ci(V),u_frustum_tr:new o.ci(V),u_frustum_br:new o.ci(V),u_frustum_bl:new o.ci(V),u_globe_pos:new o.ci(V),u_globe_radius:new o.cj(V),u_globe_transition:new o.cj(V),u_is_globe:new o.ch(V),u_viewport:new o.ck(V)}))(t)),x.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(V=>({u_cutoff_params:new o.d3(V)}))(t)),x.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(V=>({u_lighting_ambient_color:new o.ci(V),u_lighting_directional_dir:new o.ci(V),u_lighting_directional_color:new o.ci(V),u_ground_radiance:new o.ci(V)}))(t)),x.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(V=>({u_light_matrix_0:new o.cl(V),u_light_matrix_1:new o.cl(V),u_fade_range:new o.ck(V),u_shadow_normal_offset:new o.ci(V),u_shadow_intensity:new o.cj(V),u_shadow_texel_size:new o.cj(V),u_shadow_map_resolution:new o.cj(V),u_shadow_direction:new o.ci(V),u_shadow_bias:new o.ci(V),u_shadowmap_0:new o.ch(V),u_shadowmap_1:new o.ch(V)}))(t)))}getAttributeLocation(t,l){let d=this.attributes[l];return d===void 0&&(d=this.attributes[l]=t.getAttribLocation(this.program,l)),d}setTerrainUniformValues(t,l){if(!this.terrainUniforms)return;const d=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in l)d[g]&&d[g].set(this.program,g,l[g])}}setGlobeUniformValues(t,l){if(!this.globeUniforms)return;const d=this.globeUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in l)d[g]&&d[g].set(this.program,g,l[g])}}setFogUniformValues(t,l){if(!this.fogUniforms)return;const d=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in l)d[g].set(this.program,g,l[g])}}setCutoffUniformValues(t,l){if(!this.cutoffUniforms)return;const d=this.cutoffUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in l)d[g].set(this.program,g,l[g])}}setLightsUniformValues(t,l){if(!this.lightsUniforms)return;const d=this.lightsUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const g in l)d[g].set(this.program,g,l[g])}}setShadowUniformValues(t,l){if(this.failedToCreate||!this.shadowUniforms)return;const d=this.shadowUniforms;t.program.set(this.program);for(const g in l)d[g].set(this.program,g,l[g])}_drawDebugWireframe(t,l,d,g,y,x,T,E,L,P){const z=t.options.wireframe;if(z.terrain===!1&&z.layers2D===!1&&z.layers3D===!1)return;const O=t.context;if(!(!(!z.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!z.layers2D||t._terrain&&t._terrain.renderingToTexture||!S1.includes(this.name))||!(!z.layers3D||!T1.includes(this.name))))return;const B=O.gl,G=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,y,O);if(!G)return;const V=[...this.fixedDefines,"DEBUG_WIREFRAME"],W=t.getOrCreateProgram(this.name,{config:this.configuration,defines:V});O.program.set(W.program);const Y=(te,we,_e)=>{if(we[te]&&_e[te])for(const be in we[te])_e[te][be]&&_e[te][be].set(_e.program,be,we[te][be].current)};L&&L.setUniforms(W.program,O,W.binderUniforms,T,{zoom:E}),Y("fixedUniforms",this,W),Y("terrainUniforms",this,W),Y("globeUniforms",this,W),Y("fogUniforms",this,W),Y("lightsUniforms",this,W),Y("shadowUniforms",this,W),G.bind(),O.setColorMode(new ri([B.ONE,B.ONE_MINUS_SRC_ALPHA,B.ZERO,B.ONE],o.ao.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Dt(l.func===B.LESS?B.LEQUAL:l.func,Dt.ReadOnly,l.range)),O.setStencilMode(Yt.disabled);const se=3*x.primitiveLength*2,ne=3*x.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const te=P||1;for(let we=0;we<te;++we)W.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",we),B.drawElements(B.LINES,se,B.UNSIGNED_SHORT,ne)}else P&&P>1?B.drawElementsInstanced(B.LINES,se,B.UNSIGNED_SHORT,ne,P):B.drawElements(B.LINES,se,B.UNSIGNED_SHORT,ne);y.bind(),O.program.set(this.program),O.setDepthMode(l),O.setStencilMode(d),O.setColorMode(g)}checkUniforms(t,l,d){if(this.fixedDefines.includes(l)){for(const g of Object.keys(d))if(!d[g].initialized)throw new Error(`Program '${this.name}', from draw '${t}': uniform ${g} not set but required by ${l} being defined`)}}draw(t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W){const Y=t.context,se=Y.gl;if(this.failedToCreate)return;Y.program.set(this.program),Y.setDepthMode(d),Y.setStencilMode(g),Y.setColorMode(y),Y.setCullFace(x);for(const[de,le]of this.fixedUniformsEntries)le.set(this.program,de,T[de]);G&&G.setUniforms(this.program,Y,this.binderUniforms,O,{zoom:B});const ne={[se.POINTS]:1,[se.LINES]:2,[se.TRIANGLES]:3,[se.LINE_STRIP]:1}[l];this.checkUniforms(E,"RENDER_SHADOWS",this.shadowUniforms);const te=V||[],we=G?G.getPaintVertexBuffers():[],_e=l===se.TRIANGLES&&P,be=W&&W>0?1:void 0;for(const de of z.get()){const le=de.vaos||(de.vaos={});if((le[E]||(le[E]=new m1)).bind(Y,this,L,we,P,de.vertexOffset,te,be),this.forceManualRenderingForInstanceIDShaders){const Te=W||1;for(let Me=0;Me<Te;++Me)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",Me),P?se.drawElements(l,de.primitiveLength*ne,se.UNSIGNED_SHORT,de.primitiveOffset*ne*2):se.drawArrays(l,de.vertexOffset,de.vertexLength)}else W&&W>1?se.drawElementsInstanced(l,de.primitiveLength*ne,se.UNSIGNED_SHORT,de.primitiveOffset*ne*2,W):P?se.drawElements(l,de.primitiveLength*ne,se.UNSIGNED_SHORT,de.primitiveOffset*ne*2):se.drawArrays(l,de.vertexOffset,de.vertexLength);_e&&this._drawDebugWireframe(t,d,g,y,P,de,O,B,G,W)}}}function _y(h,t,l=0){const d=Math.pow(2,t.tileID.overscaledZ),g=t.tileSize*Math.pow(2,h.transform.tileZoom)/d,y=g*(t.tileID.canonical.x+t.tileID.wrap*d),x=g*t.tileID.canonical.y;return{u_image:0,u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.ay(t,1,h.transform.tileZoom),u_pixel_coord_upper:[y>>16,x>>16],u_pixel_coord_lower:[65535&y,65535&x],u_pattern_transition:l}}const kd={terrain:0,flat:1},E1=o.bC(),Ld=(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y)=>{const se=t.style.light,ne=se.properties.get("position"),te=[ne.x,ne.y,ne.z],we=o.dO();se.properties.get("anchor")==="viewport"&&(o.dP(we,-t.transform.angle),o.dQ(te,te,we));const _e=se.properties.get("color").toPremultipliedRenderColor(null),be=t.transform,de={u_matrix:h,u_lightpos:te,u_lightintensity:se.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_vertical_gradient:+l,u_opacity:d,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:E1,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:kd[L],u_base_type:kd[P],u_ao:g,u_edge_radius:y,u_width_scale:x,u_flood_light_color:G,u_vertical_scale:V,u_flood_light_intensity:W,u_ground_shadow_factor:Y};return be.projection.name==="globe"&&(de.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],de.u_zoom_transition=z,de.u_inv_rot_matrix=B,de.u_merc_center=O,de.u_up_dir=be.projection.upVector(new o.cD(0,0,0),O[0]*o.al,O[1]*o.al),de.u_height_lift=E),de},tm=(h,t,l,d,g,y)=>({u_matrix:h,u_edge_radius:t,u_width_scale:l,u_vertical_scale:d,u_height_type:kd[g],u_base_type:kd[y]}),yy=(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y)=>{const se=Ld(h,t,l,d,g,y,x,T,L,P,z,O,B,G,V,W,1,[0,0,0]),ne={u_height_factor:-Math.pow(2,T.overscaledZ)/E.tileSize/8};return Object.assign(se,_y(t,E,Y),ne)},Nl=(h,t,l)=>({u_matrix:h,u_emissive_strength:t,u_ground_shadow_factor:l}),im=(h,t,l,d,g,y=0)=>Object.assign(Nl(h,t,g),_y(l,d,y)),vy=(h,t,l,d)=>({u_matrix:h,u_world:l,u_emissive_strength:t,u_ground_shadow_factor:d}),xy=(h,t,l,d,g,y,x=0)=>Object.assign(im(h,t,l,d,y,x),{u_world:g}),rm=(h,t)=>({u_matrix:h,u_depth_bias:t}),ul=(h,t)=>({u_matrix:h,u_ground_shadow_factor:t}),Ul=(h,t,l,d,g)=>({u_matrix:h,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:l,u_height_scale:d,u_reset_depth:g}),Pd=(h,t,l,d,g,y,x,T,E)=>({u_matrix:h,u_normal_matrix:t,u_opacity:l,u_faux_facade_ao_intensity:d,u_camera_pos:g,u_tile_to_meter:y,u_facade_emissive_chance:x,u_flood_light_color:T,u_flood_light_intensity:E}),by=h=>({u_matrix:h}),hl=h=>({u_matrix:h}),nm=(h,t,l,d,g,y,x,T)=>{const E=o.al/y.tileSize;return{u_matrix:h,u_inv_rot_matrix:t,u_camera_to_center_distance:l.getCameraToCenterDistance(T),u_extrude_scale:[l.pixelsToGLUnits[0]/E,l.pixelsToGLUnits[1]/E],u_zoom_transition:d,u_tile_id:x,u_merc_center:g}},Md=(h,t,l,d)=>({u_matrix:h,u_inv_matrix:t,u_camera_to_center_distance:l.getCameraToCenterDistance(d),u_viewport_size:[l.width,l.height]}),sm=(h,t,l=1)=>({u_matrix:h,u_color:t,u_overlay:0,u_overlay_scale:l}),wy=o.bC(),om=(h,t,l,d,g,y,x)=>{const T=h.transform,E=T.projection.name==="globe",L=E?o.dR(T.zoom,t.canonical)*T._pixelsPerMercatorPixel:o.ay(l,1,y),P={u_matrix:t.projMatrix,u_extrude_scale:L,u_intensity:x,u_inv_rot_matrix:wy,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){P.u_inv_rot_matrix=d,P.u_merc_center=g,P.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],P.u_zoom_transition=o.aj(T.zoom);const z=g[0]*o.al,O=g[1]*o.al;P.u_up_dir=T.projection.upVector(new o.cD(0,0,0),z,O)}return P};function Rd(h,[t,l,d,g],[y,x]){if(y===x)return[0,0,0,0];const T=255*(h-1)/(h*(x-y));return[t*T,l*T,d*T,g*T]}function Sy(h,t,[l,d]){return l===d?0:.5/h+(t-l)*(h-1)/(h*(d-l))}const am=(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se,ne,te)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:L,u_fade_t:P.mix,u_opacity:P.opacity*z.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:z.paint.get("raster-brightness-min"),u_brightness_high:z.paint.get("raster-brightness-max"),u_saturation_factor:o.dT(z.paint.get("raster-saturation")),u_contrast_factor:o.dS(z.paint.get("raster-contrast")),u_spin_weights:th(z.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:B,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:E,u_colorization_mix:Rd(o.dU,V,Y),u_colorization_offset:Sy(o.dU,W,Y),u_color_ramp:G,u_texture_offset:[ne/(se+2*ne),se/(se+2*ne)],u_texture_res:[se+2*ne,se+2*ne],u_emissive_strength:te});function th(h){h*=Math.PI/180;const t=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*t-l+1)/3,(Math.sqrt(3)*t-l+1)/3]}const Dc=.05,I1=(h,t,l,d,g,y,x,T,E,L,P,z)=>({u_matrix:h,u_normalize_matrix:t,u_globe_matrix:l,u_merc_matrix:d,u_grid_matrix:g,u_tl_parent:y,u_scale_parent:L,u_fade_t:P.mix,u_opacity:P.opacity,u_image0:0,u_image1:1,u_raster_elevation:z,u_zoom_transition:x,u_merc_center:T,u_cutoff_params:E}),Ty=(h,t,l,d,g,y,x,T,E,L)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_tile_offset:l,u_velocity:d,u_color_ramp:y,u_velocity_res:g,u_max_speed:x,u_uv_offset:T,u_data_scale:[255*E[0],255*E[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Dc,Dc]}),A1=(h,t,l,d,g,y,x,T,E,L)=>({u_particle_texture:h,u_particle_texture_side_len:t,u_velocity:l,u_velocity_res:d,u_max_speed:g,u_speed_factor:y,u_reset_rate:x,u_rand_seed:Math.random(),u_uv_offset:T,u_data_scale:[255*E[0],255*E[1]],u_data_offset:L,u_particle_pos_scale:1.1,u_particle_pos_offset:[Dc,Dc]}),Dd=o.bC(),ih=(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se,ne,te,we,_e,be)=>{const de=g.transform,le={u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:t?t.uSizeT:0,u_size:t?t.uSize:0,u_camera_to_center_distance:de.getCameraToCenterDistance(se),u_rotate_symbol:+l,u_aspect_ratio:de.width/de.height,u_fade_change:g.options.fadeDuration?g.symbolFadeChange:1,u_matrix:y,u_label_plane_matrix:x,u_coord_matrix:T,u_is_text:+L,u_elevation_from_sea:E?1:0,u_pitch_with_map:+d,u_texsize:P,u_texsize_icon:z,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Dd,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Dd,u_up_vector:[0,-1,0],u_color_adj_mat:we,u_icon_transition:_e||0,u_gamma_scale:d?g.transform.getCameraToCenterDistance(se)*Math.cos(g.terrain?0:g.transform._pitch):1,u_device_pixel_ratio:o.o.devicePixelRatio,u_is_halo:1,u_scale_factor:be||1,u_ground_shadow_factor:ne,u_inv_matrix:o.bl(o.bC(),x),u_normal_scale:te,u_lutTexture:10};return se.name==="globe"&&(le.u_tile_id=[B.canonical.x,B.canonical.y,1<<B.canonical.z],le.u_zoom_transition=G,le.u_inv_rot_matrix=W,le.u_merc_center=V,le.u_camera_forward=de._camera.forward(),le.u_ecef_origin=o.dV(de.globeMatrix,B.toUnwrapped()),le.u_tile_matrix=Float32Array.from(de.globeMatrix),le.u_up_vector=Y),le},dl=(h,t,l,d)=>({u_matrix:h,u_emissive_strength:t,u_opacity:l,u_color:d}),rh=(h,t,l,d,g,y,x,T,E)=>Object.assign(function(L,P,z,O,B,G){const{width:V,height:W}=O.imageManager.getPixelSize(P),Y=Math.pow(2,G.tileID.overscaledZ),se=G.tileSize*Math.pow(2,O.transform.tileZoom)/Y,ne=se*(G.tileID.canonical.x+G.tileID.wrap*Y),te=se*G.tileID.canonical.y;return{u_image:0,u_pattern_tl:z.tl,u_pattern_br:z.br,u_texsize:[V,W],u_pattern_size:z.displaySize,u_pattern_units_to_pixels:B?[O.transform.width,-1*O.transform.height]:[1/o.ay(G,1,O.transform.tileZoom),1/o.ay(G,1,O.transform.tileZoom)],u_pixel_coord_upper:[ne>>16,te>>16],u_pixel_coord_lower:[65535&ne,65535&te]}}(0,y,x,d,T,E),{u_matrix:h,u_emissive_strength:t,u_opacity:l}),Vl=new Float32Array(o.bA([])),Od=(h,t,l,d,g,y,x,T,E,L,P,z,O,B=[0,0,0],G,V,W)=>{const Y=g.style.light,se=Y.properties.get("position"),ne=[-se.x,-se.y,se.z],te=o.dO();Y.properties.get("anchor")==="viewport"&&(o.dP(te,-g.transform.angle),o.dQ(ne,ne,te));const we=P.alphaMode==="MASK",_e=Y.properties.get("color").toNonPremultipliedRenderColor(null),be=O.paint.get("model-ambient-occlusion-intensity"),de=O.paint.get("model-color").constantOr(o.ao.white).toNonPremultipliedRenderColor(null);return de.a=O.paint.get("model-color-mix-intensity").constantOr(0),W&&(de.r=W[0],de.g=W[1],de.b=W[2],de.a=W[3]),V&&(de.r=V.color.r,de.g=V.color.g,de.b=V.color.b,de.a=V.colorMix,z=V.emissionStrength,y*=V.opacity),{u_matrix:h,u_lighting_matrix:t,u_normal_matrix:l,u_node_matrix:d||Vl,u_lightpos:ne,u_lightintensity:Y.properties.get("intensity"),u_lightcolor:[_e.r,_e.g,_e.b],u_camera_pos:B,u_opacity:y,u_baseTextureIsAlpha:0,u_alphaMask:+we,u_alphaCutoff:P.alphaCutoff,u_baseColorFactor:x.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:T.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:E,u_roughnessFactor:L,u_baseColorTexture:5,u_metallicRoughnessTexture:6,u_normalTexture:7,u_occlusionTexture:8,u_emissionTexture:9,u_lutTexture:10,u_color_mix:de.toArray01(),u_aoIntensity:be,u_emissive_strength:z,u_occlusionTextureTransform:G||[0,0,0,0]}},nh=(h,t=Vl,l=Vl)=>({u_matrix:h,u_instance:t,u_node_matrix:l}),zd={fillExtrusion:h=>({u_matrix:new o.cl(h),u_lightpos:new o.ci(h),u_lightintensity:new o.cj(h),u_lightcolor:new o.ci(h),u_vertical_gradient:new o.cj(h),u_opacity:new o.cj(h),u_edge_radius:new o.cj(h),u_width_scale:new o.cj(h),u_ao:new o.ck(h),u_height_type:new o.ch(h),u_base_type:new o.ch(h),u_tile_id:new o.ci(h),u_zoom_transition:new o.cj(h),u_inv_rot_matrix:new o.cl(h),u_merc_center:new o.ck(h),u_up_dir:new o.ci(h),u_height_lift:new o.cj(h),u_flood_light_color:new o.ci(h),u_vertical_scale:new o.cj(h),u_flood_light_intensity:new o.cj(h),u_ground_shadow_factor:new o.ci(h)}),fillExtrusionDepth:h=>({u_matrix:new o.cl(h),u_edge_radius:new o.cj(h),u_width_scale:new o.cj(h),u_vertical_scale:new o.cj(h),u_height_type:new o.ch(h),u_base_type:new o.ch(h)}),fillExtrusionPattern:h=>({u_matrix:new o.cl(h),u_lightpos:new o.ci(h),u_lightintensity:new o.cj(h),u_lightcolor:new o.ci(h),u_vertical_gradient:new o.cj(h),u_height_factor:new o.cj(h),u_edge_radius:new o.cj(h),u_width_scale:new o.cj(h),u_ao:new o.ck(h),u_height_type:new o.ch(h),u_base_type:new o.ch(h),u_tile_id:new o.ci(h),u_zoom_transition:new o.cj(h),u_inv_rot_matrix:new o.cl(h),u_merc_center:new o.ck(h),u_up_dir:new o.ci(h),u_height_lift:new o.cj(h),u_image:new o.ch(h),u_texsize:new o.ck(h),u_pixel_coord_upper:new o.ck(h),u_pixel_coord_lower:new o.ck(h),u_tile_units_to_pixels:new o.cj(h),u_opacity:new o.cj(h),u_pattern_transition:new o.cj(h)}),fillExtrusionGroundEffect:h=>({u_matrix:new o.cl(h),u_opacity:new o.cj(h),u_ao_pass:new o.cj(h),u_meter_to_tile:new o.cj(h),u_ao:new o.ck(h),u_flood_light_intensity:new o.cj(h),u_flood_light_color:new o.ci(h),u_attenuation:new o.cj(h),u_edge_radius:new o.cj(h),u_fb:new o.ch(h),u_fb_size:new o.cj(h),u_dynamic_offset:new o.cj(h)}),fill:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_ground_shadow_factor:new o.ci(h)}),fillPattern:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_image:new o.ch(h),u_texsize:new o.ck(h),u_pixel_coord_upper:new o.ck(h),u_pixel_coord_lower:new o.ck(h),u_tile_units_to_pixels:new o.cj(h),u_ground_shadow_factor:new o.ci(h),u_pattern_transition:new o.cj(h)}),fillOutline:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_world:new o.ck(h),u_ground_shadow_factor:new o.ci(h)}),fillOutlinePattern:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_world:new o.ck(h),u_image:new o.ch(h),u_texsize:new o.ck(h),u_pixel_coord_upper:new o.ck(h),u_pixel_coord_lower:new o.ck(h),u_tile_units_to_pixels:new o.cj(h),u_ground_shadow_factor:new o.ci(h),u_pattern_transition:new o.cj(h)}),building:h=>({u_matrix:new o.cl(h),u_normal_matrix:new o.cl(h),u_opacity:new o.cj(h),u_faux_facade_ao_intensity:new o.cj(h),u_camera_pos:new o.ci(h),u_tile_to_meter:new o.cj(h),u_facade_emissive_chance:new o.cj(h),u_flood_light_color:new o.ci(h),u_flood_light_intensity:new o.cj(h)}),buildingBloom:h=>({u_matrix:new o.cl(h)}),buildingDepth:h=>({u_matrix:new o.cl(h)}),elevatedStructuresDepth:h=>({u_matrix:new o.cl(h),u_depth_bias:new o.cj(h)}),elevatedStructures:h=>({u_matrix:new o.cl(h),u_ground_shadow_factor:new o.ci(h)}),elevatedStructuresDepthReconstruct:h=>({u_matrix:new o.cl(h),u_camera_pos:new o.ci(h),u_depth_bias:new o.cj(h),u_height_scale:new o.cj(h),u_reset_depth:new o.cj(h)}),circle:o.dY,collisionBox:h=>({u_matrix:new o.cl(h),u_inv_rot_matrix:new o.cl(h),u_camera_to_center_distance:new o.cj(h),u_extrude_scale:new o.ck(h),u_zoom_transition:new o.cj(h),u_merc_center:new o.ck(h),u_tile_id:new o.ci(h)}),collisionCircle:h=>({u_matrix:new o.cl(h),u_inv_matrix:new o.cl(h),u_camera_to_center_distance:new o.cj(h),u_viewport_size:new o.ck(h)}),debug:h=>({u_color:new o.dB(h),u_matrix:new o.cl(h),u_overlay:new o.ch(h),u_overlay_scale:new o.cj(h)}),clippingMask:h=>({u_matrix:new o.cl(h)}),heatmap:h=>({u_extrude_scale:new o.cj(h),u_intensity:new o.cj(h),u_matrix:new o.cl(h),u_inv_rot_matrix:new o.cl(h),u_merc_center:new o.ck(h),u_tile_id:new o.ci(h),u_zoom_transition:new o.cj(h),u_up_dir:new o.ci(h)}),heatmapTexture:h=>({u_image:new o.ch(h),u_color_ramp:new o.ch(h),u_opacity:new o.cj(h)}),hillshade:h=>({u_matrix:new o.cl(h),u_image:new o.ch(h),u_latrange:new o.ck(h),u_light:new o.ck(h),u_shadow:new o.dB(h),u_highlight:new o.dB(h),u_emissive_strength:new o.cj(h),u_accent:new o.dB(h)}),hillshadePrepare:h=>({u_matrix:new o.cl(h),u_image:new o.ch(h),u_dimension:new o.ck(h),u_zoom:new o.cj(h)}),line:o.dX,linePattern:o.dW,raster:h=>({u_matrix:new o.cl(h),u_normalize_matrix:new o.cl(h),u_globe_matrix:new o.cl(h),u_merc_matrix:new o.cl(h),u_grid_matrix:new o.dC(h),u_tl_parent:new o.ck(h),u_scale_parent:new o.cj(h),u_fade_t:new o.cj(h),u_opacity:new o.cj(h),u_image0:new o.ch(h),u_image1:new o.ch(h),u_brightness_low:new o.cj(h),u_brightness_high:new o.cj(h),u_saturation_factor:new o.cj(h),u_contrast_factor:new o.cj(h),u_spin_weights:new o.ci(h),u_perspective_transform:new o.ck(h),u_raster_elevation:new o.cj(h),u_zoom_transition:new o.cj(h),u_merc_center:new o.ck(h),u_cutoff_params:new o.d3(h),u_colorization_mix:new o.d3(h),u_colorization_offset:new o.cj(h),u_color_ramp:new o.ch(h),u_texture_offset:new o.ck(h),u_texture_res:new o.ck(h),u_emissive_strength:new o.cj(h)}),rasterParticle:h=>({u_matrix:new o.cl(h),u_normalize_matrix:new o.cl(h),u_globe_matrix:new o.cl(h),u_merc_matrix:new o.cl(h),u_grid_matrix:new o.dC(h),u_tl_parent:new o.ck(h),u_scale_parent:new o.cj(h),u_fade_t:new o.cj(h),u_opacity:new o.cj(h),u_image0:new o.ch(h),u_image1:new o.ch(h),u_raster_elevation:new o.cj(h),u_zoom_transition:new o.cj(h),u_merc_center:new o.ck(h),u_cutoff_params:new o.d3(h)}),rasterParticleTexture:h=>({u_texture:new o.ch(h),u_opacity:new o.cj(h)}),rasterParticleDraw:h=>({u_particle_texture:new o.ch(h),u_particle_texture_side_len:new o.cj(h),u_tile_offset:new o.ck(h),u_velocity:new o.ch(h),u_color_ramp:new o.ch(h),u_velocity_res:new o.ck(h),u_max_speed:new o.cj(h),u_uv_offset:new o.ck(h),u_data_scale:new o.ck(h),u_data_offset:new o.cj(h),u_particle_pos_scale:new o.cj(h),u_particle_pos_offset:new o.ck(h)}),rasterParticleUpdate:h=>({u_particle_texture:new o.ch(h),u_particle_texture_side_len:new o.cj(h),u_velocity:new o.ch(h),u_velocity_res:new o.ck(h),u_max_speed:new o.cj(h),u_speed_factor:new o.cj(h),u_reset_rate:new o.cj(h),u_rand_seed:new o.cj(h),u_uv_offset:new o.ck(h),u_data_scale:new o.ck(h),u_data_offset:new o.cj(h),u_particle_pos_scale:new o.cj(h),u_particle_pos_offset:new o.ck(h)}),symbol:h=>({u_is_size_zoom_constant:new o.ch(h),u_is_size_feature_constant:new o.ch(h),u_size_t:new o.cj(h),u_size:new o.cj(h),u_camera_to_center_distance:new o.cj(h),u_rotate_symbol:new o.ch(h),u_aspect_ratio:new o.cj(h),u_fade_change:new o.cj(h),u_matrix:new o.cl(h),u_label_plane_matrix:new o.cl(h),u_coord_matrix:new o.cl(h),u_is_text:new o.ch(h),u_elevation_from_sea:new o.ch(h),u_pitch_with_map:new o.ch(h),u_texsize:new o.ck(h),u_texsize_icon:new o.ck(h),u_texture:new o.ch(h),u_texture_icon:new o.ch(h),u_gamma_scale:new o.cj(h),u_device_pixel_ratio:new o.cj(h),u_tile_id:new o.ci(h),u_zoom_transition:new o.cj(h),u_inv_rot_matrix:new o.cl(h),u_merc_center:new o.ck(h),u_camera_forward:new o.ci(h),u_tile_matrix:new o.cl(h),u_up_vector:new o.ci(h),u_ecef_origin:new o.ci(h),u_is_halo:new o.ch(h),u_icon_transition:new o.cj(h),u_color_adj_mat:new o.cl(h),u_scale_factor:new o.cj(h),u_ground_shadow_factor:new o.ci(h),u_inv_matrix:new o.cl(h),u_normal_scale:new o.cj(h),u_lutTexture:new o.ch(h)}),background:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_opacity:new o.cj(h),u_color:new o.dB(h)}),backgroundPattern:h=>({u_matrix:new o.cl(h),u_emissive_strength:new o.cj(h),u_opacity:new o.cj(h),u_image:new o.ch(h),u_pattern_tl:new o.ck(h),u_pattern_br:new o.ck(h),u_texsize:new o.ck(h),u_pattern_size:new o.ck(h),u_pixel_coord_upper:new o.ck(h),u_pixel_coord_lower:new o.ck(h),u_pattern_units_to_pixels:new o.ck(h)}),terrainRaster:h=>({u_matrix:new o.cl(h),u_image0:new o.ch(h),u_image1:new o.ch(h),u_skirt_height:new o.cj(h),u_ground_shadow_factor:new o.ci(h),u_emissive_texture_available:new o.cj(h)}),skybox:h=>({u_matrix:new o.cl(h),u_sun_direction:new o.ci(h),u_cubemap:new o.ch(h),u_opacity:new o.cj(h),u_temporal_offset:new o.cj(h)}),skyboxGradient:h=>({u_matrix:new o.cl(h),u_color_ramp:new o.ch(h),u_center_direction:new o.ci(h),u_radius:new o.cj(h),u_opacity:new o.cj(h),u_temporal_offset:new o.cj(h)}),skyboxCapture:h=>({u_matrix_3f:new o.dC(h),u_sun_direction:new o.ci(h),u_sun_intensity:new o.cj(h),u_color_tint_r:new o.d3(h),u_color_tint_m:new o.d3(h),u_luminance:new o.cj(h)}),globeRaster:h=>({u_proj_matrix:new o.cl(h),u_globe_matrix:new o.cl(h),u_normalize_matrix:new o.cl(h),u_merc_matrix:new o.cl(h),u_zoom_transition:new o.cj(h),u_merc_center:new o.ck(h),u_image0:new o.ch(h),u_image1:new o.ch(h),u_grid_matrix:new o.dC(h),u_skirt_height:new o.cj(h),u_far_z_cutoff:new o.cj(h),u_frustum_tl:new o.ci(h),u_frustum_tr:new o.ci(h),u_frustum_br:new o.ci(h),u_frustum_bl:new o.ci(h),u_globe_pos:new o.ci(h),u_globe_radius:new o.cj(h),u_viewport:new o.ck(h),u_emissive_texture_available:new o.cj(h)}),globeAtmosphere:h=>({u_frustum_tl:new o.ci(h),u_frustum_tr:new o.ci(h),u_frustum_br:new o.ci(h),u_frustum_bl:new o.ci(h),u_horizon:new o.cj(h),u_transition:new o.cj(h),u_fadeout_range:new o.cj(h),u_atmosphere_fog_color:new o.d3(h),u_high_color:new o.d3(h),u_space_color:new o.d3(h),u_temporal_offset:new o.cj(h),u_horizon_angle:new o.cj(h)}),model:h=>({u_matrix:new o.cl(h),u_lighting_matrix:new o.cl(h),u_normal_matrix:new o.cl(h),u_node_matrix:new o.cl(h),u_lightpos:new o.ci(h),u_lightintensity:new o.cj(h),u_lightcolor:new o.ci(h),u_camera_pos:new o.ci(h),u_opacity:new o.cj(h),u_baseColorFactor:new o.d3(h),u_emissiveFactor:new o.d3(h),u_metallicFactor:new o.cj(h),u_roughnessFactor:new o.cj(h),u_baseTextureIsAlpha:new o.ch(h),u_alphaMask:new o.ch(h),u_alphaCutoff:new o.cj(h),u_baseColorTexture:new o.ch(h),u_metallicRoughnessTexture:new o.ch(h),u_normalTexture:new o.ch(h),u_occlusionTexture:new o.ch(h),u_emissionTexture:new o.ch(h),u_lutTexture:new o.ch(h),u_color_mix:new o.d3(h),u_aoIntensity:new o.cj(h),u_emissive_strength:new o.cj(h),u_occlusionTextureTransform:new o.d3(h)}),modelDepth:h=>({u_matrix:new o.cl(h),u_instance:new o.cl(h),u_node_matrix:new o.cl(h)}),groundShadow:h=>({u_matrix:new o.cl(h),u_ground_shadow_factor:new o.ci(h)}),stars:h=>({u_matrix:new o.cl(h),u_up:new o.ci(h),u_right:new o.ci(h),u_intensity_multiplier:new o.cj(h)}),snowParticle:h=>({u_modelview:new o.cl(h),u_projection:new o.cl(h),u_time:new o.cj(h),u_cam_pos:new o.ci(h),u_velocityConeAperture:new o.cj(h),u_velocity:new o.cj(h),u_horizontalOscillationRadius:new o.cj(h),u_horizontalOscillationRate:new o.cj(h),u_boxSize:new o.cj(h),u_billboardSize:new o.cj(h),u_simpleShapeParameters:new o.ck(h),u_screenSize:new o.ck(h),u_thinningCenterPos:new o.ck(h),u_thinningShape:new o.ci(h),u_thinningAffectedRatio:new o.cj(h),u_thinningParticleOffset:new o.cj(h),u_particleColor:new o.d3(h),u_direction:new o.ci(h)}),rainParticle:h=>({u_modelview:new o.cl(h),u_projection:new o.cl(h),u_time:new o.cj(h),u_cam_pos:new o.ci(h),u_texScreen:new o.ch(h),u_velocityConeAperture:new o.cj(h),u_velocity:new o.cj(h),u_boxSize:new o.cj(h),u_rainDropletSize:new o.ck(h),u_distortionStrength:new o.cj(h),u_rainDirection:new o.ci(h),u_color:new o.d3(h),u_screenSize:new o.ck(h),u_thinningCenterPos:new o.ck(h),u_thinningShape:new o.ci(h),u_thinningAffectedRatio:new o.cj(h),u_thinningParticleOffset:new o.cj(h),u_shapeDirectionalPower:new o.cj(h),u_shapeNormalPower:new o.cj(h),u_mode:new o.cj(h)}),vignette:h=>({u_vignetteShape:new o.ci(h),u_vignetteColor:new o.d3(h)}),occlusion:h=>({u_matrix:new o.cl(h),u_anchorPos:new o.ci(h),u_screenSizePx:new o.ck(h),u_occluderSizePx:new o.ck(h),u_color:new o.d3(h)})};class la{constructor(t,l,d,g){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++,this.context=t;const y=t.gl;this.buffer=y.createBuffer(),this.dynamicDraw=!!d,this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),y.bufferData(y.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?y.DYNAMIC_DRAW:y.STATIC_DRAW),this.dynamicDraw||g||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){this.id=la.uniqueIdxCounter,la.uniqueIdxCounter++;const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}la.uniqueIdxCounter=0;const Ey={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class C1{constructor(t,l,d,g,y,x){this.length=l.length,this.attributes=d,this.itemSize=l.bytesPerElement,this.dynamicDraw=g,this.instanceCount=x,this.context=t;const T=t.gl;this.buffer=T.createBuffer(),t.bindVertexBuffer.set(this.buffer),T.bufferData(T.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?T.DYNAMIC_DRAW:T.STATIC_DRAW),this.dynamicDraw||y||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,l){for(let d=0;d<this.attributes.length;d++){const g=l.getAttributeLocation(t,this.attributes[d].name);g!==-1&&t.enableVertexAttribArray(g)}}setVertexAttribPointers(t,l,d){for(let g=0;g<this.attributes.length;g++){const y=this.attributes[g],x=l.getAttributeLocation(t,y.name);x!==-1&&t.vertexAttribPointer(x,y.components,t[Ey[y.type]],!1,this.itemSize,y.offset+this.itemSize*(d||0))}}setVertexAttribDivisor(t,l,d){for(let g=0;g<this.attributes.length;g++){const y=l.getAttributeLocation(t,this.attributes[g].name);y!==-1&&this.instanceCount&&this.instanceCount>0&&t.vertexAttribDivisor(y,d)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $l{constructor(t,l,d,g,y){this.context=t,this.width=l,this.height=d;const x=this.framebuffer=t.gl.createFramebuffer();g>0&&(this.colorAttachment0=new Td(t,x,0)),g>1&&(this.colorAttachment1=new Td(t,x,1)),y&&(this.depthAttachmentType=y,this.depthAttachment=y==="renderbuffer"?new Pc(t,x):new Yu(t,x))}createColorAttachment(t,l){l===0?this.colorAttachment0=new Td(t,this.framebuffer,0):l===1&&(this.colorAttachment1=new Td(t,this.framebuffer,1))}removeColorAttachment(t,l){const d=this.context.gl;let g;l===0?(g=this.colorAttachment0.get(),this.colorAttachment0=void 0):l===1&&(g=this.colorAttachment1.get(),this.colorAttachment1=void 0),g&&d.deleteTexture(g)}destroy(){const t=this.context.gl;if(this.colorAttachment0){const l=this.colorAttachment0.get();l&&t.deleteTexture(l)}if(this.colorAttachment1){const l=this.colorAttachment1.get();l&&t.deleteTexture(l)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const l=this.depthAttachment.get();l&&t.deleteRenderbuffer(l)}else{const l=this.depthAttachment.get();l&&t.deleteTexture(l)}t.deleteFramebuffer(this.framebuffer)}}class Bd{constructor(t,l){this.gl=t,this.clearColor=new v1(this),this.clearDepth=new ay(this),this.clearStencil=new $p(this),this.colorMask=new vd(this),this.depthMask=new Gp(this),this.stencilMask=new jl(this),this.stencilFunc=new Ac(this),this.stencilOp=new Xu(this),this.stencilTest=new Cc(this),this.depthRange=new ly(this),this.depthTest=new Hp(this),this.depthFunc=new cy(this),this.blend=new kc(this),this.blendFunc=new xd(this),this.blendColor=new bd(this),this.blendEquation=new Wp(this),this.cullFace=new wd(this),this.cullFaceSide=new Ku(this),this.frontFace=new uy(this),this.program=new hy(this),this.activeTexture=new dy(this),this.viewport=new Lc(this),this.bindFramebuffer=new fy(this),this.bindRenderbuffer=new x1(this),this.bindTexture=new b1(this),this.bindVertexBuffer=new w1(this),this.bindElementBuffer=new qp(this),this.bindVertexArrayOES=new Zp(this),this.pixelStoreUnpack=new Xp(this),this.pixelStoreUnpackPremultiplyAlpha=new Kp(this),this.pixelStoreUnpackFlipY=new py(this),this.options=l?Object.assign({},l):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=t.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=t.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=t.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=l&&!!l.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=t.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=t.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,l,d){return new la(this,t,l,d)}createVertexBuffer(t,l,d,g,y){return new C1(this,t,l,d,g,y)}createRenderbuffer(t,l,d){const g=this.gl,y=g.createRenderbuffer();return this.bindRenderbuffer.set(y),g.renderbufferStorage(g.RENDERBUFFER,t,l,d),this.bindRenderbuffer.set(null),y}createFramebuffer(t,l,d,g){return new $l(this,t,l,d,g)}clear({color:t,depth:l,stencil:d,colorMask:g}){const y=this.gl;let x=0;t&&(x|=y.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(g||[!0,!0,!0,!0])),l!==void 0&&(x|=y.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),d!==void 0&&(x|=y.STENCIL_BUFFER_BIT,this.clearStencil.set(d),this.stencilMask.set(255)),y.clear(x)}setCullFace(t){t.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(t){o.by(t.blendFunction,ri.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Ct;function lm(h,t,l,d,g,y,x){const T=h.context,E=T.gl,L=h.transform,P=[o.aF(L.center.lng),o.aJ(L.center.lat)],z=l.layout.get("symbol-placement"),O=l.layout.get("text-variable-anchor"),B=l.layout.get("icon-rotation-alignment")==="map",G=l.layout.get("text-rotation-alignment")==="map",V=z!=="point",W=[];let Y=0,se=0;for(let de=0;de<d.length;de++){const le=d[de],Te=t.getTile(le),Me=Te.getBucket(l);if(!Me)continue;const Oe=Me.getProjection().createInversionMatrix(L,le.canonical),Ve=[],je=l1(le,Me,L),Ye=!x&&B&&V,nt=x&&G&&V,Fe=O&&Me.hasTextData(),Ie=Me.hasIconTextFit()&&Fe&&Me.hasIconData(),Xe=Ye||nt||x&&Fe||Ie,$e=Me.projection.name==="globe",ot=$e?o.aj(L.zoom):0;$e&&(Ve.push("PROJECTION_GLOBE_VIEW"),Xe&&Ve.push("PROJECTED_POS_ON_VIEWPORT"));const ht=h.getOrCreateProgram("collisionBox",{defines:Ve});let yt=je;g[0]===0&&g[1]===0||(yt=h.translatePosMatrix(je,Te,g,y));const dt=x?Me.textCollisionBox:Me.iconCollisionBox,pt=Me.collisionCircleArray;if(pt.length>0){const Lt=o.bC(),bt=yt;o.cP(Lt,Me.placementInvProjMatrix,L.glCoordMatrix),o.cP(Lt,Lt,Me.placementViewportMatrix),W.push({circleArray:pt,circleOffset:se,transform:bt,invTransform:Lt,projection:Me.getProjection()}),Y+=pt.length/4,se=Y}if(!dt)continue;h.terrain&&h.terrain.setupElevationDraw(Te,ht);const Mt=$e?[le.canonical.x,le.canonical.y,1<<le.canonical.z]:[0,0,0];ht.draw(h,E.LINES,Dt.disabled,Yt.disabled,h.colorModeForRenderPass(),Zt.disabled,nm(yt,Oe,L,ot,P,Te,Mt,Me.getProjection()),l.id,dt.layoutVertexBuffer,dt.indexBuffer,dt.segments,null,L.zoom,null,[dt.collisionVertexBuffer,dt.collisionVertexBufferExt])}if(!x||!W.length)return;const ne=h.getOrCreateProgram("collisionCircle"),te=new o.dZ;te.resize(4*Y),te._trim();let we=0;for(const de of W)for(let le=0;le<de.circleArray.length/4;le++){const Te=4*le,Me=de.circleArray[Te+0],Oe=de.circleArray[Te+1],Ve=de.circleArray[Te+2],je=de.circleArray[Te+3];te.emplace(we++,Me,Oe,Ve,je,0),te.emplace(we++,Me,Oe,Ve,je,1),te.emplace(we++,Me,Oe,Ve,je,2),te.emplace(we++,Me,Oe,Ve,je,3)}(!Ct||Ct.length<2*Y)&&(Ct=function(de){const le=2*de,Te=new o.b0;Te.resize(le),Te._trim();for(let Me=0;Me<le;Me++){const Oe=6*Me;Te.uint16[Oe+0]=4*Me+0,Te.uint16[Oe+1]=4*Me+1,Te.uint16[Oe+2]=4*Me+2,Te.uint16[Oe+3]=4*Me+2,Te.uint16[Oe+4]=4*Me+3,Te.uint16[Oe+5]=4*Me+0}return Te}(Y));const _e=T.createIndexBuffer(Ct,!0),be=T.createVertexBuffer(te,o.d_.members,!0);for(const de of W){const le=Md(de.transform,de.invTransform,L,de.projection);ne.draw(h,E.TRIANGLES,Dt.disabled,Yt.disabled,h.colorModeForRenderPass(),Zt.disabled,le,l.id,be,_e,o.bg.simpleSegment(0,2*de.circleOffset,de.circleArray.length,de.circleArray.length/2),null,L.zoom)}be.destroy(),_e.destroy()}const Fo=o.bC();function za(h){const t=h._camera.getWorldToCamera(h.worldSize,1),l=o.aB([],t,h.globeMatrix);o.bl(l,l);const d=[0,0,0],g=[0,1,0,0];return o.aC(g,g,l),d[0]=g[0],d[1]=g[1],d[2]=g[2],o.aw(d,d),d}function Iy({width:h,height:t,anchor:l,textOffset:d,textScale:g},y){const{horizontalAlign:x,verticalAlign:T}=o.c1(l),E=-(x-.5)*h,L=-(T-.5)*t,P=o.c2(l,d);return new o.P((E/g+P[0])*y,(L/g+P[1])*y)}function Ay(h,t,l,d,g,y,x,T,E,L){const P=h.text.placedSymbolArray,z=h.text.dynamicLayoutVertexArray,O=h.icon.dynamicLayoutVertexArray,B={},G=h.getProjection(),V=xc(x,G,g),W=g.elevation,Y=G.upVectorScale(x.canonical,g.center.lat,g.worldSize).metersToTile;z.clear();for(let se=0;se<P.length;se++){const ne=P.get(se),{tileAnchorX:te,tileAnchorY:we,numGlyphs:_e}=ne,be=ne.hidden||!ne.crossTileID||h.allowVerticalPlacement&&!ne.placedOrientation?null:d[ne.crossTileID];if(be){let de=0,le=0,Te=0;const Me=h.elevationType==="road";if(W||Me){const $e=Me?h.getElevationFeatureForText(se):null,ot=o.bV.getAtTileOffset(x,new o.P(te,we),W,$e),[ht,yt,dt]=G.upVector(x.canonical,te,we);de=ot*ht*Y,le=ot*yt*Y,Te=ot*dt*Y}let[Oe,Ve,je,Ye]=vo(ne.projectedAnchorX+de,ne.projectedAnchorY+le,ne.projectedAnchorZ+Te,l?V:y);const nt=od(g.getCameraToCenterDistance(G),Ye);let Fe=o.bM(h.textSizeData,E,ne)*nt/o.bY;l&&(Fe*=h.tilePixelRatio/T);const Ie=Iy(be,Fe);l?({x:Oe,y:Ve,z:je}=G.projectTilePoint(te+Ie.x,we+Ie.y,x.canonical),[Oe,Ve,je]=vo(Oe+de,Ve+le,je+Te,y)):(t&&Ie._rotate(-g.angle),Oe+=Ie.x,Ve+=Ie.y,je=0);const Xe=h.allowVerticalPlacement&&ne.placedOrientation===o.bL.vertical?Math.PI/2:0;for(let $e=0;$e<_e;$e++)o.bO(z,Oe,Ve,je,Xe);L&&ne.associatedIconIndex>=0&&(B[ne.associatedIconIndex]={x:Oe,y:Ve,z:je,angle:Xe})}else rs(_e,z)}if(L){O.clear();const se=h.icon.placedSymbolArray;for(let ne=0;ne<se.length;ne++){const te=se.get(ne),{numGlyphs:we}=te,_e=B[ne];if(te.hidden||!_e)rs(we,O);else{const{x:be,y:de,z:le,angle:Te}=_e;for(let Me=0;Me<we;Me++)o.bO(O,be,de,le,Te)}}h.icon.dynamicLayoutVertexBuffer.updateData(O)}h.text.dynamicLayoutVertexBuffer.updateData(z)}function Fd(h,t,l,d,g,y,x={}){const T=l.paint.get("icon-translate"),E=l.paint.get("text-translate"),L=l.paint.get("icon-translate-anchor"),P=l.paint.get("text-translate-anchor"),z=l.layout.get("icon-rotation-alignment"),O=l.layout.get("text-rotation-alignment"),B=l.layout.get("icon-pitch-alignment"),G=l.layout.get("text-pitch-alignment"),V=l.layout.get("icon-keep-upright"),W=l.layout.get("text-keep-upright"),Y=l.paint.get("icon-color-saturation"),se=l.paint.get("icon-color-contrast"),ne=l.paint.get("icon-color-brightness-min"),te=l.paint.get("icon-color-brightness-max"),we=l.layout.get("symbol-elevation-reference")==="sea",_e=l.layout.get("icon-image-use-theme")==="none",be=h.context,de=be.gl,le=h.transform,Te=z==="map",Me=O==="map",Oe=B==="map",Ve=G==="map",je=l.layout.get("symbol-sort-key").constantOr(1)!==void 0;let Ye=!1;const nt=h.depthModeForSublayer(0,Dt.ReadOnly),Fe=new Dt(h.context.gl.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D),Ie=[o.aF(le.center.lng),o.aJ(le.center.lat)],Xe=l.layout.get("text-variable-anchor"),$e=le.projection.name==="globe",ot=[],ht=[0,-1,0];for(const yt of d){const dt=t.getTile(yt),pt=dt.getBucket(l);if(!pt||pt.projection.name==="mercator"&&$e||pt.fullyClipped)continue;const Mt=pt.projection.name==="globe",Lt=Mt?o.aj(le.zoom):0,bt=xc(yt,pt.getProjection(),le),kt=le.calculatePixelsToTileUnitsMatrix(dt),jt=Xe&&pt.hasTextData(),Xt=pt.hasIconTextFit()&&jt&&pt.hasIconData(),ci=pt.getProjection().createInversionMatrix(le,yt.canonical),Ti=(1<<dt.tileID.canonical.z)*o.al/h.transform.worldSize,ii=Ni=>{let xi=[0,0,0];if(Ni){const li=h.style.directionalLight,nr=h.style.ambientLight;li&&nr&&(xi=bo(h.style,li,nr))}return xi},Mi=Ni=>{le.depthOcclusionForSymbolsAndCircles&&(l.hasOcclusionOpacityProperties||h.terrain)&&(Ni.push("DEPTH_D24"),Ni.push("DEPTH_OCCLUSION"))},ni=Ni=>{l.lut&&!_e&&(l.lut.texture||(l.lut.texture=new o.d$(h.context,l.lut.image,[l.lut.image.height,l.lut.image.height,l.lut.image.height],be.gl.RGBA8)),be.activeTexture.set(be.gl.TEXTURE0+10),l.lut.texture&&l.lut.texture.bind(be.gl.LINEAR,be.gl.CLAMP_TO_EDGE),Ni.push("APPLY_LUT_ON_GPU"))},Zi=()=>{const Ni=Te&&l.layout.get("symbol-placement")!=="point",xi=[];Mi(xi),ni(xi);const li=Ni||Xt,nr=pt.elevationType==="road",kr=h.shadowRenderer,cr=nr&&Oe&&!!kr&&kr.enabled,dr=ii(cr),ls=nr&&Oe&&!h.terrain?Fe:nt,Ss=l.paint.get("icon-image-cross-fade");h.terrainRenderModeElevated()&&Oe&&xi.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(xi.push("PROJECTION_GLOBE_VIEW"),li&&xi.push("PROJECTED_POS_ON_VIEWPORT")),Ss>0&&pt.hasAnySecondaryIcon&&xi.push("ICON_TRANSITION"),!pt.icon.zOffsetVertexBuffer||nr&&h.terrain||xi.push("Z_OFFSET"),Y===0&&se===0&&ne===0&&te===1||xi.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&xi.push("RENDER_SDF"),cr&&xi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),nr&&Oe&&!h.terrain&&pt.icon.orientationVertexBuffer&&xi.push("ELEVATED_ROADS");const fn=pt.icon.programConfigurations.get(l.id),Ui=h.getOrCreateProgram("symbol",{config:fn,defines:xi}),Bs=dt.imageAtlasTexture?dt.imageAtlasTexture.size:[0,0],Dn=pt.iconSizeData,cs=o.bK(Dn,le.zoom),So=Oe||!le.isOrthographic,us=Dl(bt,dt.tileID.canonical,Oe,Te,le,pt.getProjection(),kt),Tr=_s(bt,dt.tileID.canonical,Oe,Te,le,pt.getProjection(),kt),Ur=h.translatePosMatrix(Tr,dt,T,L,!0),ur=h.translatePosMatrix(bt,dt,T,L),Hr=li?Fo:us,Fn=Te&&!Oe&&!Ni;let Br=ht;!$e&&!le.mercatorFromTransition||Te||(Br=za(le));const Fs=Mt?Br:ht,xh=l.getColorAdjustmentMatrix(Y,se,ne,te),da=ih(Dn.kind,cs,Fn,Oe,h,ur,Hr,Ur,we,!1,Bs,[0,0],0,yt,Lt,Ie,ci,Fs,pt.getProjection(),dr,Ti,xh,Ss,null),Wc=dt.imageAtlasTexture?dt.imageAtlasTexture:null,qc=l.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,js=pt.sdfIcons||h.options.rotating||h.options.zooming||qc||So?de.LINEAR:de.NEAREST,fa=pt.sdfIcons&&l.paint.get("icon-halo-width").constantOr(1)!==0,pa=h.terrain&&Oe&&Ni?o.bl(o.bC(),us):Fo;if(Ni&&pt.icon){const io=o.bV.getAtTileOffsetFunc(yt,le.center.lat,le.worldSize,pt.getProjection()),ja=Ma(bt,dt.tileID.canonical,Oe,Te,le,pt.getProjection(),kt),Zl=l.layout.get("icon-size-scale-range"),Jd=o.aA(h.scaleFactor,Zl[0],Zl[1]);Hi(pt,bt,h,!1,ja,Tr,Oe,V,io,yt,Jd)}return{program:Ui,buffers:pt.icon,uniformValues:da,atlasTexture:Wc,atlasTextureIcon:null,atlasInterpolation:js,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:fa,depthMode:ls,tile:dt,renderWithShadows:cr,labelPlaneMatrixInv:pa}},Wi=()=>{const Ni=Me&&l.layout.get("symbol-placement")!=="point",xi=[],li=Ni||Xe||Xt,nr=pt.elevationType==="road",kr=h.shadowRenderer,cr=nr&&Ve&&!!kr&&kr.enabled,dr=ii(cr),ls=nr&&Ve&&!h.terrain?Fe:nt;h.terrainRenderModeElevated()&&Ve&&xi.push("PITCH_WITH_MAP_TERRAIN"),Mt&&(xi.push("PROJECTION_GLOBE_VIEW"),li&&xi.push("PROJECTED_POS_ON_VIEWPORT")),!pt.text.zOffsetVertexBuffer||nr&&h.terrain||xi.push("Z_OFFSET"),pt.iconsInText&&xi.push("RENDER_TEXT_AND_SYMBOL"),xi.push("RENDER_SDF"),cr&&xi.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),nr&&Ve&&!h.terrain&&pt.text.orientationVertexBuffer&&xi.push("ELEVATED_ROADS"),Mi(xi);const Ss=pt.text.programConfigurations.get(l.id),fn=h.getOrCreateProgram("symbol",{config:Ss,defines:xi});let Ui,Bs=[0,0],Dn=null;const cs=pt.textSizeData;pt.iconsInText&&(Bs=dt.imageAtlasTexture?dt.imageAtlasTexture.size:[0,0],Dn=dt.imageAtlasTexture?dt.imageAtlasTexture:null,Ui=Ve||!le.isOrthographic||h.options.rotating||h.options.zooming||cs.kind==="composite"||cs.kind==="camera"?de.LINEAR:de.NEAREST);const So=dt.glyphAtlasTexture?dt.glyphAtlasTexture.size:[0,0],us=l.layout.get("text-size-scale-range"),Tr=o.aA(h.scaleFactor,us[0],us[1]),Ur=o.bK(cs,le.zoom,Tr),ur=Dl(bt,dt.tileID.canonical,Ve,Me,le,pt.getProjection(),kt),Hr=_s(bt,dt.tileID.canonical,Ve,Me,le,pt.getProjection(),kt),Fn=h.translatePosMatrix(Hr,dt,E,P,!0),Br=h.translatePosMatrix(bt,dt,E,P),Fs=li?Fo:ur,xh=Me&&!Ve&&!Ni;let da=ht;!$e&&!le.mercatorFromTransition||Me||(da=za(le));const Wc=ih(cs.kind,Ur,xh,Ve,h,Br,Fs,Fn,we,!0,So,Bs,0,yt,Lt,Ie,ci,Mt?da:ht,pt.getProjection(),dr,Ti,null,null,Tr),qc=dt.glyphAtlasTexture?dt.glyphAtlasTexture:null,js=de.LINEAR,fa=l.paint.get("text-halo-width").constantOr(1)!==0,pa=h.terrain&&Ve&&Ni?o.bl(o.bC(),ur):Fo;if(Ni&&pt.text){const io=o.bV.getAtTileOffsetFunc(yt,le.center.lat,le.worldSize,pt.getProjection()),ja=Ma(bt,dt.tileID.canonical,Ve,Me,le,pt.getProjection(),kt);Hi(pt,bt,h,!0,ja,Hr,Ve,W,io,yt,Tr)}return{program:fn,buffers:pt.text,uniformValues:Wc,atlasTexture:qc,atlasTextureIcon:Dn,atlasInterpolation:js,atlasInterpolationIcon:Ui,isSDF:!0,hasHalo:fa,depthMode:ls,tile:dt,renderWithShadows:cr,labelPlaneMatrixInv:pa}},Ki=pt.icon.segments.get().length,Ii=pt.text.segments.get().length,ai=Ki&&!x.onlyText?Zi():null,ji=Ii&&!x.onlyIcons?Wi():null,br=l.paint.get("icon-opacity").constantOr(1),wr=l.paint.get("text-opacity").constantOr(1);if(je&&pt.canOverlap){Ye=!0;const Ni=br&&!x.onlyText?pt.icon.segments.get():[],xi=wr&&!x.onlyIcons?pt.text.segments.get():[];for(const li of Ni)ot.push({segments:new o.bg([li]),sortKey:li.sortKey,state:ai});for(const li of xi)ot.push({segments:new o.bg([li]),sortKey:li.sortKey,state:ji})}else x.onlyText||ot.push({segments:br?pt.icon.segments:new o.bg([]),sortKey:0,state:ai}),x.onlyIcons||ot.push({segments:wr?pt.text.segments:new o.bg([]),sortKey:0,state:ji})}Ye&&ot.sort((yt,dt)=>yt.sortKey-dt.sortKey);for(const yt of ot){const dt=yt.state;if(dt)if(h.terrain?h.terrain.setupElevationDraw(dt.tile,dt.program,{useDepthForOcclusion:le.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:dt.labelPlaneMatrixInv}):h.setupDepthForOcclusion(le.depthOcclusionForSymbolsAndCircles,dt.program),be.activeTexture.set(de.TEXTURE0),dt.atlasTexture&&dt.atlasTexture.bind(dt.atlasInterpolation,de.CLAMP_TO_EDGE,!0),dt.atlasTextureIcon&&(be.activeTexture.set(de.TEXTURE1),dt.atlasTextureIcon&&dt.atlasTextureIcon.bind(dt.atlasInterpolationIcon,de.CLAMP_TO_EDGE,!0)),dt.renderWithShadows&&h.shadowRenderer.setupShadows(dt.tile.tileID.toUnwrapped(),dt.program,"vector-tile"),h.uploadCommonLightUniforms(h.context,dt.program),dt.hasHalo){const pt=dt.uniformValues;pt.u_is_halo=1,jd(dt.buffers,yt.segments,l,h,dt.program,dt.depthMode,g,y,pt,2),pt.u_is_halo=0}else{if(dt.isSDF){const pt=dt.uniformValues;dt.hasHalo&&(pt.u_is_halo=1,jd(dt.buffers,yt.segments,l,h,dt.program,dt.depthMode,g,y,pt,1)),pt.u_is_halo=0}jd(dt.buffers,yt.segments,l,h,dt.program,dt.depthMode,g,y,dt.uniformValues,1)}}}function jd(h,t,l,d,g,y,x,T,E,L){const P=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.iconTransitioningVertexBuffer,h.globeExtVertexBuffer,h.zOffsetVertexBuffer,h.orientationVertexBuffer];g.draw(d,d.context.gl.TRIANGLES,y,x,T,Zt.disabled,E,l.id,h.layoutVertexBuffer,h.indexBuffer,t,l.paint,d.transform.zoom,h.programConfigurations.get(l.id),P,L)}function cm(h,t){const l=1<<h.canonical.z,d=(t.x*l-h.canonical.x-h.wrap*l)*o.al,g=(t.y*l-h.canonical.y)*o.al,y=o.e8(t.z,t.y);return o.d5(d,g,y)}function um(h,t,l,d,g){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const y=h.context.gl,x=new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D),T=new Dt(h.context.gl.GREATER,Dt.ReadWrite,h.depthRangeFor3D),E=function(B){let G=.01;return B.isOrthographic&&(G=o.ak(1e-4,G,o.d0(B.pitch>=oa?1:B.pitch/oa))),2*G}(h.transform),L=h.transform.getFreeCameraOptions().position,P="elevatedStructuresDepthReconstruct",z=h.getOrCreateProgram(P,{defines:["DEPTH_RECONSTRUCTION"]}),O=h.getOrCreateProgram(P);for(const B of d){const G=t.getTile(B),V=G.getBucket(l);if(!V)continue;const W=V.elevatedStructures;if(!W)continue;const Y=V.elevationBufferData.heightRange,se=cm(B.toUnwrapped(),L),ne=h.translatePosMatrix(B.projMatrix,G,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));let te,we,_e,be;if(g==="initialize"){if(!Y||Y.min>=1||W.depthSegments.segments[0].primitiveLength===0)continue;te=Ul(ne,se,E,1,0),we=x,_e=W.depthSegments,be=z}else if(g==="reset"){if(!Y||Y.min>=0||W.maskSegments.segments[0].primitiveLength===0)continue;te=Ul(ne,se,0,0,1),we=T,_e=W.maskSegments,be=z}else if(g==="geometry"){if(W.depthSegments.segments[0].primitiveLength===0)continue;te=Ul(ne,se,E,1,0),we=x,_e=W.depthSegments,be=O}be.draw(h,y.TRIANGLES,we,Yt.disabled,ri.disabled,Zt.disabled,te,l.id,W.vertexBuffer,W.indexBuffer,_e,l.paint,h.transform.zoom)}}function Oc(h,t,l,d){const{painter:g,sourceCache:y,layer:x,coords:T,colorMode:E,elevationType:L,terrainEnabled:P,pass:z}=h,O=g.context.gl,B=x.paint.get("fill-pattern"),G=x.paint.get("fill-pattern-cross-fade"),V=B.constantOr(null);let W=L;L!=="road"||t&&!P||(W="none");const Y=W==="road",se=h.painter.shadowRenderer,ne=Y&&!!se&&se.enabled,te=new Dt(g.context.gl.LEQUAL,Dt.ReadOnly,g.depthRangeFor3D);let we=[0,0,0];if(ne){const le=g.style.directionalLight,Te=g.style.ambientLight;le&&Te&&(we=bo(g.style,le,Te))}const _e=B&&B.constantOr(1),be=g.terrain&&g.terrain.renderingToTexture,de=(le,Te)=>{let Me,Oe,Ve,je,Ye;Te?(Me=_e&&!x.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ve=O.LINES):(Me=_e?"fillPattern":"fill",Ve=O.TRIANGLES);for(const nt of T){const Fe=y.getTile(nt);if(_e&&!Fe.patternsLoaded())continue;const Ie=Fe.getBucket(x);if(!Ie)continue;const Xe=t?Ie.elevationBufferData:Ie.bufferData;if(Xe.isEmpty())continue;g.prepareDrawTile();const $e=Xe.programConfigurations.get(x.id),ot=g.isTileAffectedByFog(nt),ht=[],yt=[];Y&&(ht.push("ELEVATED_ROADS"),yt.push(Xe.elevatedLayoutVertexBuffer)),ne&&ht.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),be&&l&&ht.push("USE_MRT1"),_e&&(g.context.activeTexture.set(O.TEXTURE0),Fe.imageAtlasTexture&&Fe.imageAtlasTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),$e.updatePaintBuffers());let dt=!1;if(V&&Fe.imageAtlas){const kt=Fe.imageAtlas,jt=o.e3.from(V),Xt=jt.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),ci=jt.getSecondary(),Ti=kt.patternPositions.get(Xt),ii=ci?kt.patternPositions.get(ci.scaleSelf(o.o.devicePixelRatio).toString()):null;dt=!!Ti&&!!ii,Ti&&$e.setConstantPatternPositions(Ti,ii)}G>0&&(dt||$e.getPatternTransitionVertexBuffer("fill-pattern"))&&ht.push("FILL_PATTERN_TRANSITION");const pt=g.getOrCreateProgram(Me,{config:$e,overrideFog:ot,defines:ht}),Mt=g.translatePosMatrix(nt.projMatrix,Fe,x.paint.get("fill-translate"),x.paint.get("fill-translate-anchor"));ne&&se.setupShadows(Fe.tileID.toUnwrapped(),pt,"vector-tile");const Lt=x.paint.get("fill-emissive-strength");if(Te){je=Xe.lineIndexBuffer,Ye=Xe.lineSegments;const kt=g.terrain&&g.terrain.renderingToTexture?g.terrain.drapeBufferSize:[O.drawingBufferWidth,O.drawingBufferHeight];Oe=Me==="fillOutlinePattern"&&_e?xy(Mt,Lt,g,Fe,kt,we,G):vy(Mt,Lt,kt,we)}else je=Xe.indexBuffer,Ye=Xe.triangleSegments,Oe=_e?im(Mt,Lt,g,Fe,we,G):Nl(Mt,Lt,we);g.uploadCommonUniforms(g.context,pt,nt.toUnwrapped());let bt=le;(L==="road"&&!P||L==="offset")&&(bt=te),pt.draw(g,Ve,bt,d||g.stencilModeForClipping(nt),E,Zt.disabled,Oe,x.id,Xe.layoutVertexBuffer,je,Ye,x.paint,g.transform.zoom,$e,yt)}};g.renderPass===z&&de(g.depthModeForSublayer(1,g.renderPass==="opaque"?Dt.ReadWrite:Dt.ReadOnly),!1),W==="none"&&g.renderPass==="translucent"&&x.paint.get("fill-antialias")&&de(g.depthModeForSublayer(x.getPaintProperty("fill-outline-color")?2:0,Dt.ReadOnly),!0)}function zc(h,t,l,d,g,y,x,T){l.resetLayerRenderingStats(h);const E=h.context,L=E.gl,P=h.transform,z=l.paint.get("fill-extrusion-pattern"),O=l.paint.get("fill-extrusion-pattern-cross-fade"),B=z.constantOr(null),G=z.constantOr(1),V=l.paint.get("fill-extrusion-opacity"),W=h.style.enable3dLights(),Y=l.paint.get(W&&!G?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),se=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),Y],ne=l.layout.get("fill-extrusion-edge-radius"),te=ne>0&&!l.paint.get("fill-extrusion-rounded-roof"),we=te?0:ne,_e=P.projection.name==="globe"?o.eb():0,be=P.projection.name==="globe",de=be?o.aj(P.zoom):0,le=[o.aF(P.center.lng),o.aJ(P.center.lat)],Te=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Me=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Te?null:l.lut).toArray01().slice(0,3),Oe=l.paint.get("fill-extrusion-flood-light-intensity"),Ve=l.paint.get("fill-extrusion-vertical-scale"),je=l.paint.get("fill-extrusion-line-width").constantOr(1)!==0,Ye=l.paint.get("fill-extrusion-height-alignment"),nt=l.paint.get("fill-extrusion-base-alignment"),Fe=xo(h,l.paint.get("fill-extrusion-cutoff-fade-range")),Ie=[];let Xe;be&&Ie.push("PROJECTION_GLOBE_VIEW"),se[0]>0&&Ie.push("FAUX_AO"),te&&Ie.push("ZERO_ROOF_RADIUS"),T&&Ie.push("HAS_CENTROID"),Oe>0&&Ie.push("FLOOD_LIGHT"),Fe.shouldRenderCutoff&&Ie.push("RENDER_CUTOFF"),je&&Ie.push("RENDER_WALL_MODE");const $e=h.renderPass==="shadow",ot=h.shadowRenderer,ht=$e&&!!ot,yt=$e?Zt.disabled:Zt.backCCW;h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0);let dt=[0,0,0];if(ot){const Lt=h.style.directionalLight,bt=h.style.ambientLight;Lt&&bt&&(dt=bo(h.style,Lt,bt)),$e||(Ie.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ot.useNormalOffset&&Ie.push("NORMAL_OFFSET")),Xe=Ie.concat(["SHADOWS_SINGLE_CASCADE"])}const pt=ht?"fillExtrusionDepth":G?"fillExtrusionPattern":"fillExtrusion",Mt=l.getLayerRenderingStats();for(const Lt of d){const bt=t.getTile(Lt),kt=bt.getBucket(l);if(!kt||kt.projection.name!==P.projection.name)continue;let jt=!1;ot&&(jt=ot.getMaxCascadeForTile(Lt.toUnwrapped())===0);const Xt=h.isTileAffectedByFog(Lt),ci=kt.programConfigurations.get(l.id);let Ti=!1;if(B&&bt.imageAtlas){const Ii=bt.imageAtlas,ai=o.e3.from(B),ji=ai.getPrimary().scaleSelf(o.o.devicePixelRatio).toString(),br=ai.getSecondary(),wr=Ii.patternPositions.get(ji),Ni=br?Ii.patternPositions.get(br.scaleSelf(o.o.devicePixelRatio).toString()):null;Ti=!!wr&&!!Ni,wr&&ci.setConstantPatternPositions(wr,Ni)}O>0&&(Ti||ci.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ie.push("FILL_EXTRUSION_PATTERN_TRANSITION");const ii=h.getOrCreateProgram(pt,{config:ci,defines:jt?Xe:Ie,overrideFog:Xt});if(h.terrain&&h.terrain.setupElevationDraw(bt,ii,{useMeterToDem:!0}),!kt.centroidVertexBuffer){const Ii=ii.getAttributeLocation(L,"a_centroid_pos");Ii!==-1&&L.vertexAttrib2f(Ii,0,0)}!$e&&ot&&ot.setupShadows(bt.tileID.toUnwrapped(),ii,"vector-tile"),G&&(h.context.activeTexture.set(L.TEXTURE0),bt.imageAtlasTexture&&bt.imageAtlasTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),ci.updatePaintBuffers());const Mi=l.paint.get("fill-extrusion-vertical-gradient"),ni=1/kt.tileToMeter;let Zi;if($e&&ot){if(hm(bt.tileID,kt.maxHeight,h))continue;const Ii=ot.calculateShadowPassMatrixFromTile(bt.tileID.toUnwrapped());Zi=tm(Ii,we,ni,Ve,Ye,nt)}else{const Ii=h.translatePosMatrix(Lt.expandedProjMatrix,bt,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),ai=P.projection.createInversionMatrix(P,Lt.canonical);Zi=G?yy(Ii,h,Mi,V,se,we,ni,Lt,bt,_e,Ye,nt,de,le,ai,Me,Ve,O):Ld(Ii,h,Mi,V,se,we,ni,Lt,_e,Ye,nt,de,le,ai,Me,Ve,Oe,dt)}h.uploadCommonUniforms(E,ii,Lt.toUnwrapped(),null,Fe);let Wi=kt.segments;if(P.projection.name==="mercator"&&!$e&&(Wi=kt.getVisibleSegments(bt.tileID,h.terrain,h.transform.getFrustum(0)),!Wi.get().length))continue;if(Mt)if($e)for(const Ii of Wi.get())Mt.numRenderedVerticesInShadowPass+=Ii.primitiveLength;else for(const Ii of Wi.get())Mt.numRenderedVerticesInTransparentPass+=Ii.primitiveLength;const Ki=[];(h.terrain||T)&&Ki.push(kt.centroidVertexBuffer),be&&Ki.push(kt.layoutVertexExtBuffer),je&&Ki.push(kt.wallVertexBuffer),ii.draw(h,E.gl.TRIANGLES,g,y,x,yt,Zi,l.id,kt.layoutVertexBuffer,kt.indexBuffer,Wi,l.paint,h.transform.zoom,ci,Ki)}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1)}class sh{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function ca(h,t,l,d,g,y,x,T,E,L,P,z,O,B,G,V,W,Y,se,ne){const te=t.context,we=te.gl,_e=t.transform,be=t.transform.zoom,de=[],le=h.translate,Te=h.translateAnchor,Me=h.edgeRadius,Oe=xo(t,h.cutoffFadeRange);P==="clear"?(de.push("CLEAR_SUBPASS"),ne&&(de.push("CLEAR_FROM_TEXTURE"),te.activeTexture.set(we.TEXTURE0),ne.bind(we.LINEAR,we.CLAMP_TO_EDGE))):P==="sdf"?de.push("SDF_SUBPASS"):P==="emissive"&&(de.push("USE_MRT1"),te.activeTexture.set(we.TEXTURE0),ne.bind(we.LINEAR,we.CLAMP_TO_EDGE)),Y&&de.push("HAS_CENTROID"),Oe.shouldRenderCutoff&&de.push("RENDER_CUTOFF");const Ve=(je,Ye,nt,Fe,Ie)=>{let Xe=de;Ye.groundRadiusBuffer!=null&&(Xe=de.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const $e=Ye.programConfigurations.get(d.id),ot=t.isTileAffectedByFog(je),ht=t.getOrCreateProgram("fillExtrusionGroundEffect",{config:$e,defines:Xe,overrideFog:ot}),yt=((pt,Mt,Lt,bt,kt,jt,Xt,ci,Ti,ii,Mi)=>({u_matrix:Mt,u_opacity:Lt,u_ao_pass:bt?1:0,u_meter_to_tile:kt,u_ao:jt,u_flood_light_intensity:Xt,u_flood_light_color:ci,u_attenuation:Ti,u_edge_radius:ii,u_fb:0,u_fb_size:Mi,u_dynamic_offset:1}))(0,Fe,z,L,Ie,[O,B*Ie],G,V,W,be>=17?0:Me*Ie,ne?ne.size[0]:0),dt=[];Y&&dt.push(Ye.hiddenByLandmarkVertexBuffer),Ye.groundRadiusBuffer!=null&&dt.push(Ye.groundRadiusBuffer),t.uploadCommonUniforms(te,ht,je.toUnwrapped(),null,Oe),ht.draw(t,te.gl.TRIANGLES,y,x,T,E,yt,d.id,Ye.vertexBuffer,Ye.indexBuffer,nt,d.paint,be,$e,dt)};for(const je of g){const Ye=l.getTile(je),nt=Ye.getBucket(d);if(!nt||nt.projection.name!==_e.projection.name||!nt.groundEffect||nt.groundEffect&&!nt.groundEffect.hasData())continue;const Fe=nt.groundEffect,Ie=1/nt.tileToMeter;{const Xe=t.translatePosMatrix(je.projMatrix,Ye,le,Te),$e=Fe.getDefaultSegment();Ve(je,Fe,$e,Xe,Ie)}if(se)for(let Xe=0;Xe<4;Xe++){const $e=o.e9[Xe](je),ot=l.getTile($e);if(!ot)continue;const ht=ot.getBucket(d);if(!ht||ht.projection.name!==_e.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const yt=ht.groundEffect;let dt,pt;Xe===0?(dt=[-o.al,0,0],pt=1):Xe===1?(dt=[o.al,0,0],pt=0):Xe===2?(dt=[0,-o.al,0],pt=3):(dt=[0,o.al,0],pt=2);const Mt=yt.regionSegments[pt];if(!Mt)continue;const Lt=new Float32Array(16);o.br(Lt,je.projMatrix,dt),Ve(je,yt,Mt,t.translatePosMatrix(Lt,Ye,le,Te),Ie)}}}function Cy(h,t,l,d,g,y,x){d.centroidVertexArray.length===0&&d.createCentroidsBuffer();const T=y?y.findDEMTileFor(l):null;if(!(T&&T.dem||x))return;y&&T&&T.dem&&d.selfDEMTileTimestamp!==T.dem._timestamp&&(d.borderDoneWithNeighborZ=[-1,-1,-1,-1],d.selfDEMTileTimestamp=T.dem._timestamp);const E=(W,Y)=>{(W.flags|Y.flags)&o.ec?(W.flags|=o.ec,Y.flags|=o.ec):(W.flags&=~o.ec,Y.flags&=~o.ec)},L=W=>new o.P(Math.ceil((W+o.ed)*o.ee),0),P=W=>{const Y=t.getSource().minzoom,se=te=>{const we=t.getTileByID(te);if(we&&we.hasData())return we.getBucket(g)},ne=[0,-1,1];for(const te of ne){if(W.overscaledZ+te<Y)continue;const we=se(W.calculateScaledKey(W.overscaledZ+te));if(we)return we}},z=[0,0,0],O=(W,Y)=>(z[0]=Math.min(W.min.y,Y.min.y),z[1]=Math.max(W.max.y,Y.max.y),z[2]=o.al-Y.min.x>W.max.x?Y.min.x-o.al:W.max.x,z),B=(W,Y)=>(z[0]=Math.min(W.min.x,Y.min.x),z[1]=Math.max(W.max.x,Y.max.x),z[2]=o.al-Y.min.y>W.max.y?Y.min.y-o.al:W.max.y,z),G=[(W,Y)=>O(W,Y),(W,Y)=>O(Y,W),(W,Y)=>B(W,Y),(W,Y)=>B(Y,W)],V=(W,Y,se,ne,te,we,_e)=>{if(!y)return 0;const be=[[we?se:W,we?W:se,0],[we?se:Y,we?Y:se,0]],de=_e<0?o.al+_e:_e,le=[we?de:(W+Y)/2,we?(W+Y)/2:de,0];return se===0&&_e<0||se!==0&&_e>0?y.getForTilePoints(te,[le],!0,ne):be.push(le),y.getForTilePoints(l,be,!0,T),Math.max(be[0][2],be[1][2],le[2])/y.exaggeration()};for(let W=0;W<4;W++){const Y=d.borderFeatureIndices[W];if(Y.length===0)continue;const se=o.e9[W](l),ne=P(se);if(!(ne&&ne instanceof o.ea))continue;const te=y?y.findDEMTileFor(se):null;if(!(te&&te.dem||x)||(y&&te&&te.dem&&d.borderDEMTileTimestamp[W]!==te.dem._timestamp&&(d.borderDoneWithNeighborZ[W]=-1,d.borderDEMTileTimestamp[W]=te.dem._timestamp),d.borderDoneWithNeighborZ[W]===ne.canonical.z))continue;ne.centroidVertexArray.length===0&&ne.createCentroidsBuffer();const we=(W<2?1:5)-W,_e=ne.borderDoneWithNeighborZ[we]!==d.canonical.z,be=ne.borderFeatureIndices[we];let de=0;if(d.canonical.z!==ne.canonical.z){for(const le of Y)d.showCentroid(d.featuresOnBorder[le]);if(_e)for(const le of be)ne.showCentroid(ne.featuresOnBorder[le]);d.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[we]=d.canonical.z}for(const le of Y){const Te=d.featuresOnBorder[le],Me=d.centroidData[Te.centroidDataIndex],Oe=Te.borders[W];let Ve;for(;de<be.length;){Ve=ne.featuresOnBorder[be[de]];const je=Ve.borders[we];if(je[1]>Oe[0]+3||je[0]>Oe[0]-3)break;ne.showCentroid(Ve),de++}if(Ve&&de<be.length){const je=de;let Ye=0;for(;!(Ve.borders[we][0]>Oe[1]-3)&&(Ye++,++de!==be.length);)Ve=ne.featuresOnBorder[be[de]];Ve=ne.featuresOnBorder[be[je]];let nt=!1;if(Ye>=1){const Xe=Ve.borders[we];Math.abs(Oe[0]-Xe[0])<3&&Math.abs(Oe[1]-Xe[1])<3&&(Ye=1,nt=!0,de=je+1)}else if(Ye===0){d.showCentroid(Te);continue}const Fe=ne.centroidData[Ve.centroidDataIndex];x&&nt&&E(Me,Fe);const Ie=Te.intersectsCount()>1||Ve.intersectsCount()>1;if(Ye>1)de=je,Me.centroidXY=Fe.centroidXY=new o.P(0,0);else if(te&&te.dem&&!Ie){const Xe=G[W](Me,Fe),$e=W%2?o.al-1:0,ot=V(Xe[0],Math.min(o.al-1,Xe[1]),$e,te,se,W<2,Xe[2]);Me.centroidXY=Fe.centroidXY=L(ot)}else Ie?Me.centroidXY=Fe.centroidXY=new o.P(0,0):(Me.centroidXY=d.encodeBorderCentroid(Te),Fe.centroidXY=ne.encodeBorderCentroid(Ve));d.writeCentroidToBuffer(Me),ne.writeCentroidToBuffer(Fe)}else d.showCentroid(Te)}d.borderDoneWithNeighborZ[W]=ne.canonical.z,ne.borderDoneWithNeighborZ[we]=d.canonical.z}(d.needsCentroidUpdate||!d.centroidVertexBuffer&&d.centroidVertexArray.length!==0)&&d.uploadCentroid(h)}const ky=[1,0,0],Ly=[0,1,0],Py=[0,0,1];function hm(h,t,l){const d=l.transform,g=l.shadowRenderer;if(!g)return!0;const y=h.toUnwrapped(),x=d.tileSize*g._cascades[l.currentShadowCascade].scale;let T=t;if(d.elevation){const V=d.elevation.getMinMaxForTile(h);V&&(T+=V.max)}const E=[...g.shadowDirection];E[2]=-E[2];const L=g.computeSimplifiedTileShadowVolume(y,T,x,E);if(!L)return!1;const P=[ky,Ly,Py,E,[E[0],0,E[2]],[0,E[1],E[2]]],z=d.projection.name==="globe",O=d.scaleZoom(x),B=o.cB.fromInvProjectionMatrix(d.invProjMatrix,d.worldSize,O,!z),G=g.getCurrentCascadeFrustum();return B.intersectsPrecise(L.vertices,L.planes,P)===0||G.intersectsPrecise(L.vertices,L.planes,P)===0}function Bc(h){const{painter:t,source:l,layer:d,coords:g}=h;let y=h.defines;const x=t.context,T=t.renderPass==="shadow",E=t.renderPass==="light-beam",L=t.shadowRenderer,P=o.ef(t.transform.center.lat,t.transform.zoom),z=xo(t,d.paint.get("building-cutoff-fade-range"));z.shouldRenderCutoff&&(y=y.concat("RENDER_CUTOFF")),h.floodLightIntensity>0&&(y=y.concat("FLOOD_LIGHT"));for(const O of g){const B=l.getTile(O),G=B.getBucket(d);if(!G)continue;L&&L.getMaxCascadeForTile(O.toUnwrapped())===0&&(y=y.concat("SHADOWS_SINGLE_CASCADE"));const V=G.programConfigurations.get(d.id);let W,Y,se,ne=t.translatePosMatrix(O.expandedProjMatrix,B,[0,0],"map");if(ne=o.cS(o.bC(),ne,[1,1,h.verticalScale]),T&&L){if(hm(B.tileID,G.maxHeight*P,t))continue;let we=L.calculateShadowPassMatrixFromTile(B.tileID.toUnwrapped());we=o.cS(o.bC(),we,[1,1,h.verticalScale]),se=hl(we),W=Y=t.getOrCreateProgram("buildingDepth",{config:V,defines:y,overrideFog:!1})}else if(E)W=Y=t.getOrCreateProgram("buildingBloom",{config:V,defines:y,overrideFog:!1}),se=by(ne);else{const we=t.transform.calculatePosMatrix(O.toUnwrapped(),t.transform.worldSize);o.cS(we,we,[1,1,h.verticalScale]);const _e=o.bC();o.cS(_e,we,[1,-1,1/P]),o.bl(_e,_e),o.eg(_e,_e);const be=t.transform.getFreeCameraOptions().position,de=1<<O.canonical.z;if(se=Pd(ne,_e,h.opacity,h.facadeAOIntensity,[((be.x-O.wrap)*de-O.canonical.x)*o.al,(be.y*de-O.canonical.y)*o.al,be.z*de*o.al],G.tileToMeter,h.facadeEmissiveChance,h.floodLightColor,h.floodLightIntensity),Y=t.getOrCreateProgram("building",{config:V,defines:y,overrideFog:!1}),h.depthOnly===!0)W=Y;else{const le=y.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);W=t.getOrCreateProgram("building",{config:V,defines:le,overrideFog:!1})}L&&(L.setupShadowsFromMatrix(we,Y,!0),W!==Y&&L.setupShadowsFromMatrix(we,W,!0))}const te=(we,_e)=>{if(E){const be=we.entranceBloom;_e.draw(t,x.gl.TRIANGLES,h.depthMode,Yt.disabled,h.blendMode,Zt.disabled,se,d.id,be.layoutVertexBuffer,be.indexBuffer,be.segmentsBucket,d.paint,t.transform.zoom,V,[be.layoutAttenuationBuffer,be.layoutColorBuffer])}else{const be=we.segmentsBucket;let de=[we.layoutNormalBuffer,we.layoutCentroidBuffer,we.layoutColorBuffer,we.layoutFloodLightDataBuffer];we.layoutFacadePaintBuffer&&(de=de.concat([we.layoutFacadeDataBuffer,we.layoutFacadeVerticalRangeBuffer,we.layoutFacadePaintBuffer])),_e.draw(t,x.gl.TRIANGLES,h.depthMode,Yt.disabled,h.blendMode,T?Zt.disabled:Zt.backCW,se,d.id,we.layoutVertexBuffer,we.indexBuffer,be,d.paint,t.transform.zoom,V,de)}};t.uploadCommonUniforms(x,Y,O.toUnwrapped(),null,z),G.buildingWithoutFacade&&te(G.buildingWithoutFacade,Y),G.buildingWithFacade&&(W!==Y&&t.uploadCommonUniforms(x,W,O.toUnwrapped(),null,z),te(G.buildingWithFacade,W))}}function Nd(h,t,l,d,g,y,x,T,E,L,P,z,O){const B=h.context.gl,G=h.depthModeForSublayer(1,Dt.ReadOnly,B.LEQUAL,!0),V=.1*(1-(W=P))+3*W;var W;const Y=h._showOverdrawInspector,se=z,ne=new sh;Y||ca(ne,h,t,l,d,G,new Yt({func:B.ALWAYS,mask:255},255,255,B.KEEP,B.KEEP,B.REPLACE),new ri([B.ONE,B.ONE,B.ONE,B.ONE],o.ao.transparent,[!1,!1,!1,!0],B.MIN),Zt.disabled,g,"sdf",y,x,T,E,L,V,se,!1);{const te=Y?Yt.disabled:new Yt({func:B.EQUAL,mask:255},255,255,B.KEEP,B.DECR,B.DECR),we=Y?h.colorModeForRenderPass():new ri([B.ONE_MINUS_DST_ALPHA,B.DST_ALPHA,B.ONE,B.ONE],o.ao.transparent,[!0,!0,!0,!0]);ca(ne,h,t,l,d,G,te,we,Zt.disabled,g,"color",y,x,T,E,L,V,se,!1)}}function dm(h){return[h[0]*o.eh,h[1]*o.eh,h[2]*o.eh,0]}function Ud(h,t,l,d,g,y,x,T,E){const L=d.getSource(),P=l.globeSharedBuffers;if(!P)return;let z,O,B;if(t&&(z=d.getTile(t)),L instanceof o.aU?(O=L.texture,B=o.dK(0,0,l.transform)):z&&t&&(O=z.texture,B=o.dK(t.canonical.z,t.canonical.x,l.transform)),!O||!B)return;h||(B=o.cS(o.bC(),B,[1,-1,1]));const G=l.context,V=G.gl,W=g.paint.get("raster-resampling")==="nearest"?V.NEAREST:V.LINEAR,Y=l.colorModeForDrapableLayerRenderPass(y),se=x.defines;se.push("GLOBE_POLES");const ne=new Dt(V.LEQUAL,Dt.ReadWrite,l.depthRangeFor3D),te=Float32Array.from(l.transform.expandedFarZProjMatrix),we=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0))));l.terrain&&l.terrain.prepareDrawTile(),G.activeTexture.set(V.TEXTURE0),O.bind(W,V.CLAMP_TO_EDGE),G.activeTexture.set(V.TEXTURE1),O.bind(W,V.CLAMP_TO_EDGE),"useMipmap"in O&&G.extTextureFilterAnisotropic&&l.transform.pitch>20&&V.texParameterf(V.TEXTURE_2D,G.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,G.extTextureFilterAnisotropicMax);const[_e,be,de,le]=t?P.getPoleBuffers(t.canonical.z,!1):P.getPoleBuffers(0,!0),Te=g.paint.get("raster-elevation");let Me;h?(Me=_e,l.renderDefaultNorthPole=Te!==0):(Me=be,l.renderDefaultSouthPole=Te!==0);const Oe=dm(x.mix),Ve=((Ye,nt,Fe,Ie,Xe,$e,ot,ht,yt,dt,pt,Mt,Lt)=>am(Ye,nt,Fe,new Float32Array(16),new Float32Array(9),[0,0],Ie,[0,0],[0,0,0,0],1,{opacity:1,mix:0},$e,[0,0],ht,2,dt,pt,Mt,1,0,Lt))(te,we,B,o.aj(l.transform.zoom),0,g,0,Te,0,Oe,x.offset,x.range,y),je=l.getOrCreateProgram("raster",{defines:se});l.uploadCommonUniforms(G,je,null),je.draw(l,V.TRIANGLES,ne,E,Y,T,Ve,g.id,Me,de,le)}function My(h){if(h.isOrthographic)return[0,0,0,0];const t=h._nearZ,l=h.projection.farthestPixelDistance(h),d=l-t,g=.2*h.height,y=t+g;return[t,l,(y-g-t)/d,(y-t)/d]}function Ry(h,t,l,d){if(h)return t instanceof is&&h instanceof rd?t.getTextureDescriptor(h,l,!0):{texture:h.texture,mix:dm(d.mix),offset:d.offset,buffer:0,tileSize:1}}var fm=o.ei([{name:"a_index",type:"Int16",components:1}]);class Dy{constructor(t,l,d,g){const y={width:d[0],height:d[1],data:null},x=t.gl;this.targetColorTexture=new o.T(t,y,x.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(t,y,x.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(l,g),this.lastInvalidatedAt=0}updateParticleTexture(t,l){if(this.particleTextureDimension===l.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const d=this.context.gl,g=l.width*l.height;this.particleTexture0=new o.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,l,d.RGBA8,{premultiply:!1,useMipmap:!1});const y=new o.ej;y.reserve(g);for(let x=0;x<g;x++)y.emplaceBack(x);this.particleIndexBuffer=this.context.createVertexBuffer(y,fm.members,!0),this.particleSegment=o.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=l.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=o.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function pm(h,t,l){if(!h)return null;const d=t.getTextureDescriptor(h,l,!0);if(!d)return null;let{texture:g,mix:y,offset:x,tileSize:T,buffer:E,format:L}=d;if(!g||!L)return null;let P=!1;return L==="uint32"&&(P=!0,y[3]=0,y=Rd(o.ek,y,[0,l.paint.get("raster-particle-max-speed")]),x=Sy(o.ek,x,[0,l.paint.get("raster-particle-max-speed")])),{texture:g,textureOffset:[E/(T+2*E),T/(T+2*E)],tileSize:T,scalarData:P,scale:y,offset:x,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[L]]}}function Oy(h){const t=h._nearZ,l=h.projection.farthestPixelDistance(h),d=l-t,g=.2*h.height,y=t+g;return[t,l,(y-g-t)/d,(y-t)/d]}const mm=new o.ao(1,0,0,1),gm=new o.ao(0,1,0,1),_m=new o.ao(0,0,1,1),k1=new o.ao(1,0,1,1),L1=new o.ao(0,1,1,1);function zy(h,t,l,d,g,y){for(let x=0;x<l.length;x++)if(g){const L=new o.ao(d.r*.8,d.g*.8,d.b*.8,1);fl(h,t,l[x],d,-1,-1,y),fl(h,t,l[x],d,-1,1,y),fl(h,t,l[x],d,1,1,y),fl(h,t,l[x],d,1,-1,y),fl(h,t,l[x],L,0,0,y)}else fl(h,t,l[x],d,0,0,y)}function fl(h,t,l,d,g,y,x){const T=h.context,E=h.transform,L=T.gl,P=E.projection.name==="globe",z=P?["PROJECTION_GLOBE_VIEW"]:[];let O=o.bz(l.projMatrix);if(P&&o.aj(E.zoom)>0){const Oe=o.bj(l.canonical,E),Ve=o.el(Oe);O=o.aB(new Float32Array(16),E.globeMatrix,Ve),o.aB(O,E.projMatrix,O)}const B=o.bC();B[12]+=2*g/(o.o.devicePixelRatio*E.width),B[13]+=2*y/(o.o.devicePixelRatio*E.height),o.aB(O,B,O);const G=h.getOrCreateProgram("debug",{defines:z}),V=t.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(V,G);const W=Dt.disabled,Y=Yt.disabled,se=h.colorModeForRenderPass(),ne="$debug";T.activeTexture.set(L.TEXTURE0),h.emptyTexture.bind(L.LINEAR,L.CLAMP_TO_EDGE),P?V._makeGlobeTileDebugBuffers(h.context,E):V._makeDebugTileBoundsBuffers(h.context,E.projection);const te=V._tileDebugBuffer||h.debugBuffer,we=V._tileDebugIndexBuffer||h.debugIndexBuffer,_e=V._tileDebugSegments||h.debugSegments;if(G.draw(h,L.LINE_STRIP,W,Y,se,Zt.disabled,sm(O,d.toPremultipliedRenderColor(null)),ne,te,we,_e,null,null,null,[V._globeTileDebugBorderBuffer]),x){const Oe=V.latestRawTileData,Ve=Math.floor((Oe&&Oe.byteLength||0)/1024);let je=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(je+=` => ${l.overscaledZ}`),je+=` ${V.state}`,je+=` ${Ve}kb`,function(Ye,nt){Ye.initDebugOverlayCanvas();const Fe=Ye.debugOverlayCanvas,Ie=Ye.context.gl,Xe=Ye.debugOverlayCanvas.getContext("2d");Xe.clearRect(0,0,Fe.width,Fe.height),Xe.shadowColor="white",Xe.shadowBlur=2,Xe.lineWidth=1.5,Xe.strokeStyle="white",Xe.textBaseline="top",Xe.font="bold 36px Open Sans, sans-serif",Xe.fillText(nt,5,5),Xe.strokeText(nt,5,5),Ye.debugOverlayTexture.update(Fe),Ye.debugOverlayTexture.bind(Ie.LINEAR,Ie.CLAMP_TO_EDGE)}(h,je)}const be=t.getTile(l).tileSize,de=512/Math.min(be,512)*(l.overscaledZ/E.zoom)*.5,le=V._tileDebugTextBuffer||h.debugBuffer,Te=V._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,Me=V._tileDebugTextSegments||h.debugSegments;G.draw(h,L.TRIANGLES,W,Y,ri.alphaBlended,Zt.disabled,sm(O,o.ao.transparent.toPremultipliedRenderColor(null),de),ne,le,Te,Me,null,null,null,[V._globeTileDebugTextBuffer])}function By(h,t,l,d){Vd(h,0,t+l/2,h.transform.width,l,d)}function ym(h,t,l,d){Vd(h,t-l/2,0,l,h.transform.height,d)}function Vd(h,t,l,d,g,y){const x=h.context,T=x.gl;T.enable(T.SCISSOR_TEST),T.scissor(t*o.o.devicePixelRatio,l*o.o.devicePixelRatio,d*o.o.devicePixelRatio,g*o.o.devicePixelRatio),x.clear({color:y}),T.disable(T.SCISSOR_TEST)}const Fy=o.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:P1}=Fy;function pl(h,t,l,d){h.emplaceBack(t,l,d)}class ws{constructor(t){this.vertexArray=new o.em,this.indices=new o.b0,pl(this.vertexArray,-1,-1,1),pl(this.vertexArray,1,-1,1),pl(this.vertexArray,-1,1,1),pl(this.vertexArray,1,1,1),pl(this.vertexArray,-1,-1,-1),pl(this.vertexArray,1,-1,-1),pl(this.vertexArray,-1,1,-1),pl(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,P1),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=o.bg.simpleSegment(0,0,36,12)}}function ml(h,t,l,d,g,y){const x=h.context.gl,T=t.paint.get("sky-atmosphere-color"),E=t.paint.get("sky-atmosphere-halo-color"),L=t.paint.get("sky-atmosphere-sun-intensity"),P=((z,O,B,G,V)=>({u_matrix_3f:z,u_sun_direction:O,u_sun_intensity:B,u_color_tint_r:[G.r,G.g,G.b,G.a],u_color_tint_m:[V.r,V.g,V.b,V.a],u_luminance:5e-5}))(o.eo(o.dO(),d),g,L,T.toPremultipliedRenderColor(null),E.toPremultipliedRenderColor(null));x.framebufferTexture2D(x.FRAMEBUFFER,x.COLOR_ATTACHMENT0,x.TEXTURE_CUBE_MAP_POSITIVE_X+y,t.skyboxTexture,0),l.draw(h,x.TRIANGLES,Dt.disabled,Yt.disabled,ri.unblended,Zt.frontCW,P,"skyboxCapture",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}const ss=o.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class gl{constructor(t){const l=new o.ep;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const d=new o.b0;d.emplaceBack(0,1,2),d.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(l,ss.members),this.indexBuffer=t.createIndexBuffer(d),this.segments=o.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const jy=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class vm{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class xm{constructor(t){this.colorModeAlphaBlendedWriteRGB=new ri([1,nl,1,nl],o.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new ri([1,0,1,0],o.ao.transparent,[!1,!1,!1,!0]),this.params=new vm,this.updateNeeded=!0}update(t){const l=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new gl(l);const d=this.params.sizeRange,g=this.params.intensityRange,y=function(P){const z=o.eq(30),O=[];for(let B=0;B<P;++B){const G=2*Math.PI*z(),V=Math.acos(1-2*z())-.5*Math.PI;O.push(o.d5(Math.cos(V)*Math.cos(G),Math.cos(V)*Math.sin(G),Math.sin(V)))}return O}(this.params.starsCount),x=o.eq(300),T=new o.er,E=new o.b0;let L=0;for(let P=0;P<y.length;++P){const z=o.c5([],y[P],200),O=Math.max(0,1+.01*d*(1*x()-.5)),B=Math.max(0,1+.01*g*(1*x()-.5));T.emplaceBack(z[0],z[1],z[2],-1,-1,O,B),T.emplaceBack(z[0],z[1],z[2],1,-1,O,B),T.emplaceBack(z[0],z[1],z[2],1,1,O,B),T.emplaceBack(z[0],z[1],z[2],-1,1,O,B),E.emplaceBack(L+0,L+1,L+2),E.emplaceBack(L+0,L+2,L+3),L+=4}this.starsVx=l.createVertexBuffer(T,jy.members),this.starsIdx=l.createIndexBuffer(E),this.starsSegments=o.bg.simpleSegment(0,0,T.length,E.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,l){const d=t.context,g=d.gl,y=t.transform,x=new Dt(g.LEQUAL,Dt.ReadOnly,[0,1]),T=o.aj(y.zoom),E=t.style.getLut(l.scope),L=l.properties.get("color-use-theme")==="none",P=l.properties.get("color").toNonPremultipliedRenderColor(L?null:E),z=l.properties.get("high-color-use-theme")==="none",O=l.properties.get("high-color").toNonPremultipliedRenderColor(z?null:E),B=l.properties.get("space-color-use-theme")==="none",G=l.properties.get("space-color").toNonPremultipliedRenderColor(B?null:E),V=5e-4,W=o.es(l.properties.get("horizon-blend"),0,1,V,.25),Y=o.dE(t,d,y)&&W===V?y.worldSize/(2*Math.PI*1.025)-1:y.globeRadius,se=t.frameCounter/1e3%1,ne=o.ag(y.globeCenterInViewSpace),te=Math.sqrt(Math.pow(ne,2)-Math.pow(Y,2)),we=Math.acos(te/ne),_e=be=>{const de=y.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];be&&de.push("ALPHA_PASS");const le=t.getOrCreateProgram("globeAtmosphere",{defines:de}),Te=((Oe,Ve,je,Ye,nt,Fe,Ie,Xe,$e,ot,ht,yt)=>({u_frustum_tl:Oe,u_frustum_tr:Ve,u_frustum_br:je,u_frustum_bl:Ye,u_horizon:nt,u_transition:Fe,u_fadeout_range:Ie,u_atmosphere_fog_color:Xe.toArray01(),u_high_color:$e.toArray01(),u_space_color:ot.toArray01(),u_temporal_offset:ht,u_horizon_angle:yt}))(y.frustumCorners.TL,y.frustumCorners.TR,y.frustumCorners.BR,y.frustumCorners.BL,y.frustumCorners.horizon,T,W,P,O,G,se,we);t.uploadCommonUniforms(d,le);const Me=this.atmosphereBuffer;Me&&le.draw(t,g.TRIANGLES,x,Yt.disabled,be?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Zt.backCW,Te,be?"atmosphere_glow_alpha":"atmosphere_glow",Me.vertexBuffer,Me.indexBuffer,Me.segments)};_e(!1),_e(!0)}drawStars(t,l){const d=o.aA(l.properties.get("star-intensity"),0,1);if(d===0)return;const g=t.context,y=g.gl,x=t.transform,T=t.getOrCreateProgram("stars"),E=o.c7([]);o.c9(E,E,-x._pitch),o.c8(E,E,-x.angle),o.c9(E,E,o.an(x._center.lat)),o.et(E,E,-o.an(x._center.lng));const L=o.cc(new Float32Array(16),E),P=o.aB([],x.starsProjMatrix,L),z=o.eo([],L),O=o.eu([],z),B=[0,1,0];o.dQ(B,B,O),o.c5(B,B,this.params.sizeMultiplier);const G=[1,0,0];o.dQ(G,G,O),o.c5(G,G,this.params.sizeMultiplier);const V=(W=B,Y=G,se=d,{u_matrix:Float32Array.from(P),u_up:W,u_right:Y,u_intensity_multiplier:se});var W,Y,se;t.uploadCommonUniforms(g,T),this.starsVx&&this.starsIdx&&T.draw(t,y.TRIANGLES,Dt.disabled,Yt.disabled,this.colorModeAlphaBlendedWriteRGB,Zt.disabled,V,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class bm{constructor(){this.visibleTiles=[]}updateBorders(t,l){const d=[],g=[],y=t._getRenderableCoordinates(!1,!0);for(const E of y){const L=t.getTile(E);if(!L.hasData())continue;const P=L.getBucket(l);P&&(P.isEmpty()||(d.push(E.key),g.push({bucket:P,tileID:E.canonical})))}let x=d.length!==this.visibleTiles.length;if(!x){d.sort();for(let E=0;E<d.length;E++)if(d[E]!==this.visibleTiles[E]){x=!0;break}}if(!x)return;const T=new Set;this.visibleTiles=d,g.sort((E,L)=>E.tileID.z-L.tileID.z||E.tileID.x-L.tileID.x||E.tileID.y-L.tileID.y);for(const E of g){const L=new Array,P=new Array,z=E.bucket;for(const O of z.featuresOnBorder)T.has(O.featureId)?P.push(O.footprintIndex):(T.add(O.featureId),L.push(O.footprintIndex));z.updateFootprintHiddenFlags(L,o.ev,!1),z.updateFootprintHiddenFlags(P,o.ev,!0)}}}function wm(h,t){const l=[...h],d=t.cameraWorldSizeForFog/t.worldSize,g=o.bA([]);return o.cS(g,g,[d,d,1]),o.aB(l,g,l),o.aB(l,t.worldToFogMatrix,l),l}function jo(h,t,l,d,g){const y=l.material,x=d.context,{baseColorTexture:T,metallicRoughnessTexture:E}=y.pbrMetallicRoughness,{normalTexture:L,occlusionTexture:P,emissionTexture:z}=y;function O(G,V,W){if(G&&(h.push(V),x.activeTexture.set(x.gl.TEXTURE0+W),G.gfxTexture)){const{minFilter:Y,magFilter:se,wrapS:ne,wrapT:te}=G.sampler;G.gfxTexture.bindExtraParam(Y,se,ne,te)}}O(T,"HAS_TEXTURE_u_baseColorTexture",5),O(E,"HAS_TEXTURE_u_metallicRoughnessTexture",6),O(L,"HAS_TEXTURE_u_normalTexture",7),O(P,"HAS_TEXTURE_u_occlusionTexture",8),O(z,"HAS_TEXTURE_u_emissionTexture",9),g&&(g.texture||(g.texture=new o.d$(d.context,g.image,[g.image.height,g.image.height,g.image.height],x.gl.RGBA8)),x.activeTexture.set(x.gl.TEXTURE0+10),g.texture&&g.texture.bind(x.gl.LINEAR,x.gl.CLAMP_TO_EDGE),h.push("APPLY_LUT_ON_GPU")),l.texcoordBuffer&&(h.push("HAS_ATTRIBUTE_a_uv_2f"),t.push(l.texcoordBuffer)),l.colorBuffer&&(h.push(l.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),t.push(l.colorBuffer)),l.normalBuffer&&(h.push("HAS_ATTRIBUTE_a_normal_3f"),t.push(l.normalBuffer)),l.pbrBuffer&&(h.push("HAS_ATTRIBUTE_a_pbr"),h.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),t.push(l.pbrBuffer)),y.alphaMode!=="OPAQUE"&&y.alphaMode!=="MASK"||h.push("UNPREMULT_TEXTURE_IN_SHADER"),y.defined||h.push("DIFFUSE_SHADED");const B=d.shadowRenderer;B&&(h.push("RENDER_SHADOWS","DEPTH_TEXTURE"),B.useNormalOffset&&h.push("NORMAL_OFFSET"))}function Yi(h,t,l,d,g,y){const x=h.modelOpacity,T=t.context,E=new Dt(t.context.gl.LEQUAL,h.isLightMesh?Dt.ReadOnly:Dt.ReadWrite,t.depthRangeFor3D),L=t.transform,P=h.mesh,z=P.material,O=z.pbrMetallicRoughness,B=t.style.fog;let G;G=t.transform.projection.zAxisUnit==="pixels"?[...h.nodeModelMatrix]:o.aB([],d.zScaleMatrix,h.nodeModelMatrix),o.aB(G,d.negCameraPosMatrix,G);const V=o.bl([],G);o.eg(V,V);const W=l.paint.get("model-color-use-theme").constantOr("default")==="none",Y=l.paint.get("model-emissive-strength").constantOr(0),se=Od(new Float32Array(h.worldViewProjection),new Float32Array(G),new Float32Array(V),null,t,x,O.baseColorFactor,z.emissiveFactor,O.metallicFactor,O.roughnessFactor,z,Y,l,void 0,void 0,h.materialOverride,h.modelColor),ne={defines:[]},te=[],we=t.shadowRenderer;we&&(we.useNormalOffset=!1),jo(ne.defines,te,P,t,W?null:l.lut);let _e=null;if(B){const le=wm(h.nodeModelMatrix,t.transform);if(_e=new Float32Array(le),L.projection.name!=="globe"){const Te=P.aabb.min,Me=P.aabb.max,[Oe,Ve]=B.getOpacityForBounds(le,Te[0],Te[1],Me[0],Me[1]);ne.overrideFog=Oe>=At||Ve>=At}}const be=xo(t,l.paint.get("model-cutoff-fade-range"));be.shouldRenderCutoff&&ne.defines.push("RENDER_CUTOFF");const de=t.getOrCreateProgram("model",ne);t.uploadCommonUniforms(T,de,null,_e,be),t.renderPass!=="shadow"&&we&&we.setupShadowsFromMatrix(h.nodeModelMatrix,de),de.draw(t,T.gl.TRIANGLES,E,g,y,P.material.doubleSided?Zt.disabled:Zt.backCCW,se,l.id,P.vertexBuffer,P.indexBuffer,P.segments,l.paint,t.transform.zoom,void 0,te)}function oh(h,t){return h.style._importedAsBasemap?"basemap":t.scope}function ah(h,t,l,d,g,y,x,T,E,L){const P=h.transform,z=!!t.isGeometryBloom&&t.isGeometryBloom;if(z&&h.renderPass==="shadow")return;const O=P.projection.name==="globe"?o.eD(l,P):[...l];o.aB(O,O,t.globalMatrix);const B=o.aB([],d,O);if(t.meshes)for(const G of t.meshes){const V=T.get(G.material.name);if(V&&V.opacity<=0)continue;if(G.material.alphaMode!=="BLEND"){x.push({mesh:G,depth:0,modelIndex:g,worldViewProjection:B,nodeModelMatrix:O,isLightMesh:z,materialOverride:V,modelOpacity:E,modelColor:L});continue}const W=o.af([],G.centroid,B);!P.isOrthographic&&W[2]<=0||y.push({mesh:G,depth:W[2],modelIndex:g,worldViewProjection:B,nodeModelMatrix:O,isLightMesh:z,materialOverride:V,modelOpacity:E,modelColor:L})}if(t.children)for(const G of t.children)ah(h,G,l,d,g,y,x,T,E,L)}function Fc(h,t,l,d){const g=l.shadowRenderer;if(!g)return;const y=g.getShadowPassDepthMode(),x=g.getShadowPassColorMode(),T=g.calculateShadowPassMatrixFromMatrix(t),E=nh(T);l.getOrCreateProgram("modelDepth",{defines:l._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(l,l.context.gl.TRIANGLES,y,Yt.disabled,x,Zt.disabled,E,d.id,h.vertexBuffer,h.indexBuffer,h.segments,d.paint,l.transform.zoom,void 0,void 0)}function Ny(h,t,l,d,g,y){for(const x of g){const T=Object.assign({},d);T.part=x;const E={type:"Unknown",id:t,properties:T},L={orientation:h.paint.get("model-rotation").evaluate(E,l)};y.set(x,L)}}function Uy(h,t,l,d,g,y){for(const x of g){const T=Object.assign({},d);T.part=x;const E={type:"Unknown",id:t,properties:T},L={color:h.paint.get("model-color").evaluate(E,l),colorMix:h.paint.get("model-color-mix-intensity").evaluate(E,l),opacity:h.paint.get("model-opacity").evaluate(E,l),emissionStrength:h.paint.get("model-emissive-strength").evaluate(E,l)};y.set(x,L)}}function Sm(h,t,l,d,g){let y=!1;for(const T of d)T.modelOpacity!==1&&(Yi(T,h,t,g[T.modelIndex],Yt.disabled,ri.disabled),y=!0);for(const T of d)Yi(T,h,t,g[T.modelIndex],T.modelOpacity!==1?h.stencilModeFor3D():Yt.disabled,h.colorModeForRenderPass());y&&h.resetStencilClippingMasks();const x=ri.additive;for(const T of l)Yi(T,h,t,g[T.modelIndex],Yt.disabled,T.isLightMesh?x:h.colorModeForRenderPass())}function Gl(h,t,l){const d=t.updateZoomBasedPaintProperties(),g=function(y,x,T){let E,L,P,z=y.terrain?y.terrain.exaggeration():0;if(y.terrain&&z>0){const O=y.terrain,B=O.findDEMTileFor(T);B&&B.dem?E=o.eF.create(O,T,B):z=0}if(z===0&&(x.terrainElevationMin=0,x.terrainElevationMax=0),z===x.validForExaggeration&&(z===0||E&&E._demTile&&E._demTile.tileID===x.validForDEMTile.id&&E._dem._timestamp===x.validForDEMTile.timestamp))return!1;for(const O in x.instancesPerModel){const B=x.instancesPerModel[O];for(let G=0;G<B.instancedDataArray.length;++G){const V=(E?z*E.getElevationAt(0|B.instancedDataArray.float32[16*G],0|B.instancedDataArray.float32[16*G+1],!0,!0):0)+B.instancesEvaluatedElevation[G];B.instancedDataArray.float32[16*G+6]=V,L=L?Math.min(x.terrainElevationMin,V):V,P=P?Math.max(x.terrainElevationMax,V):V}}return x.terrainElevationMin=L||0,x.terrainElevationMax=P||0,x.validForExaggeration=z,x.validForDEMTile=E&&E._demTile?{id:E._demTile.tileID,timestamp:E._dem._timestamp}:{id:void 0,timestamp:0},!0}(h,t,l);(d||g)&&(t.uploaded=!1,t.upload(h.context))}const os={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d9([0,0,0],[o.al,o.al,0])};function ft(h,t){const l=1<<h.canonical.z,d=t.getFreeCameraOptions().position,g=t.elevation,y=h.canonical.x/l,x=(h.canonical.x+1)/l,T=h.canonical.y/l,E=(h.canonical.y+1)/l;let L=t._centerAltitude;if(g){const B=g.getMinMaxForTile(h);B&&B.max>L&&(L=B.max)}const P=o.aA(d.x,y,x)-d.x,z=o.aA(d.y,T,E)-d.y,O=o.cf(L,t.center.lat)-d.z;return t._zoomFromMercatorZ(Math.sqrt(P*P+z*z+O*O))}function vt(h,t,l,d,g,y,x){const T=h.context,E=h.renderPass==="shadow",L=h.shadowRenderer,P=E&&L?L.getShadowPassDepthMode():new Dt(T.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D),z=h.isTileAffectedByFog(y),O=h.transform.projection.name==="globe";if(l.meshes)for(const B of l.meshes){const G=O?[]:["MODEL_POSITION_ON_GPU"],V=[];let W,Y,se;const ne=!O&&d.instancedDataArray.length>20;ne&&G.push("INSTANCED_ARRAYS");const te=xo(h,t.paint.get("model-cutoff-fade-range"));if(te.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),E&&L)W=h.getOrCreateProgram("modelDepth",{defines:G}),Y=nh(x.shadowTileMatrix,x.shadowTileMatrix,Float32Array.from(l.globalMatrix)),se=L.getShadowPassColorMode();else{jo(G,V,B,h,t.paint.get("model-color-use-theme").constantOr("default")==="none"?null:t.lut),W=h.getOrCreateProgram("model",{defines:G,overrideFog:z});const _e=B.material,be=_e.pbrMetallicRoughness,de=t.paint.get("model-opacity").constantOr(1),le=t.paint.get("model-emissive-strength").constantOr(0);Y=Od(y.expandedProjMatrix,Float32Array.from(l.globalMatrix),new Float32Array(16),null,h,de,be.baseColorFactor,_e.emissiveFactor,be.metallicFactor,be.roughnessFactor,_e,le,t,g),L&&(x.shadowUniformsInitialized?W.setShadowUniformValues(T,L.getShadowUniformValues()):(L.setupShadows(y.toUnwrapped(),W,"model-tile"),x.shadowUniformsInitialized=!0)),se=te.shouldRenderCutoff||de<1||_e.alphaMode!=="OPAQUE"?ri.alphaBlended:ri.unblended}h.uploadCommonUniforms(T,W,y.toUnwrapped(),null,te);const we=B.material.doubleSided?Zt.disabled:Zt.backCCW;if(ne)V.push(d.instancedDataBuffer),W.draw(h,T.gl.TRIANGLES,P,Yt.disabled,se,we,Y,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,h.transform.zoom,void 0,V,d.instancedDataArray.length);else{const _e=E?"u_instance":"u_normal_matrix";for(let be=0;be<d.instancedDataArray.length;++be)Y[_e]=new Float32Array(d.instancedDataArray.arrayBuffer,64*be,16),W.draw(h,T.gl.TRIANGLES,P,Yt.disabled,se,we,Y,t.id,B.vertexBuffer,B.indexBuffer,B.segments,t.paint,h.transform.zoom,void 0,V)}}if(l.children)for(const B of l.children)vt(h,t,B,d,g,y,x)}const jc=[1,-1,1];function Cr(h,t,l,d){if(!l.modelManager)return!0;const g=l.modelManager;if(!l.shadowRenderer)return!0;const y=l.shadowRenderer,x=t.aabb;let T=!0,E=h.maxHeight;if(E===0){let P=0;for(const z in h.instancesPerModel){const O=g.getModel(z,d);O?P=Math.max(P,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):T=!1}E=h.maxScale*P*1.41+h.maxVerticalOffset,T&&(h.maxHeight=E)}x.max[2]=E,x.min[2]+=h.terrainElevationMin,x.max[2]+=h.terrainElevationMax,o.af(x.min,x.min,t.tileMatrix),o.af(x.max,x.max,t.tileMatrix);const L=x.intersects(y.getCurrentCascadeFrustum());return l.currentShadowCascade===0&&(h.isInsideFirstShadowMapFrustum=L===2),L===0}function ze(h,t){const l=h.uniformValues.u_cutoff_params[0],d=h.uniformValues.u_cutoff_params[1],g=h.uniformValues.u_cutoff_params[2],y=h.uniformValues.u_cutoff_params[3];return d===l||y===g?1:o.aA(((t-l)/(d-l)-g)/(y-g),0,1)}function Vy(h,t,l,d){if(t.pitch<20)return 1;const g=t.getWorldToCameraMatrix();o.aB(g,g,h);const y=o.bU(l.min[0],l.min[1],l.min[2],1);let x=o.aC(o.eG(),y,g),T=x,E=x;y[1]=l.max[1],x=o.aC(o.eG(),y,g),T=x[1]<T[1]?x:T,E=x[1]>E[1]?x:E,y[0]=l.max[0],x=o.aC(o.eG(),y,g),T=x[1]<T[1]?x:T,E=x[1]>E[1]?x:E,y[1]=l.min[1],x=o.aC(o.eG(),y,g),T=x[1]<T[1]?x:T,E=x[1]>E[1]?x:E;const L=o.aA(d[0],0,1),P=100*t.pixelsPerMeter*o.aA(d[1],0,1),z=o.aA(d[2],0,1),O=o.eH(o.eG(),T,E,L),B=Math.tan(.5*t.fovX),G=-O[2]*B;if(P===0)return O[1]<-Math.abs(G)?z:1;const V=(-Math.abs(G)-O[1])/P,W=(se,ne,te)=>(1-te)*se+te*ne,Y=o.aA(W(1,z,V),z,1);return W(1,Y,o.aA((t.pitch-20)/20,0,1))}class $d{}class Tm{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,l,d){{const z=this._storage.get(l.id);if(z)return z.lastUsedFrameIdx=t,z.buf}const g=d.gl,y=g.getBufferParameter(g.ELEMENT_ARRAY_BUFFER,g.BUFFER_SIZE),x=new ArrayBuffer(y),T=new Int16Array(x);g.getBufferSubData(g.ELEMENT_ARRAY_BUFFER,0,new Int16Array(x));const E=new o.eJ;for(let z=0;z<y/2;z+=3){const O=T[z],B=T[z+1],G=T[z+2];E.emplaceBack(O,B),E.emplaceBack(B,G),E.emplaceBack(G,O)}const L=d.bindVertexArrayOES.current,P=new $d;return P.buf=new la(d,E),P.lastUsedFrameIdx=t,this._storage.set(l.id,P),d.bindVertexArrayOES.set(L),P.buf}update(t){for(const[l,d]of this._storage)t-d.lastUsedFrameIdx>30&&(d.buf.destroy(),this._storage.delete(l))}destroy(){for(const[t,l]of this._storage)l.buf.destroy(),this._storage.delete(t)}}class Em{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const $y=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class Im{constructor(t){this.revealStart=11,this.revealRange=2}}const Nc=o.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class M1{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,l){const d=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const x=new o.eK,T=new o.b0;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(1,1),x.emplaceBack(-1,1),T.emplaceBack(0,1,2),T.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(x,Nc.members),this.vignetteIdx=t.context.createIndexBuffer(T)}const g=o.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,d);const x={u_vignetteShape:(y={vignetteShape:[l.start,l.range,Math.pow(10,l.fadePower)],vignetteColor:[l.color.r,l.color.g,l.color.b,l.color.a*l.strength]}).vignetteShape,u_vignetteColor:y.vignetteColor};d.draw(t,t.context.gl.TRIANGLES,Dt.disabled,Yt.disabled,ri.alphaBlended,Zt.disabled,x,"vignette",this.vignetteVx,this.vignetteIdx,g)}var y}}class R1{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,l){const d=t.getFreeCameraOptions().position,g=d.toAltitude(),y=d.toLngLat(),x=o.an(y.lng),T=o.an(y.lat),E=t.pixelsPerMeter/l,L=x*o.eM,P=o.eM*Math.log(Math.tan(Math.PI/4+T/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const z=-this._offsetYPrev+P,O=-this._elevationPrev+g;this._accumulatedOffsetX+=(-this._offsetXPrev+L)*E,this._accumulatedOffsetY+=z*E,this._accumulatedElevation+=O*E,this._offsetXPrev=L,this._offsetYPrev=P,this._elevationPrev=g}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function Am(h,t){return[-(h[0]-Math.floor(h[0]/t)*t),-(h[1]-Math.floor(h[1]/t)*t),-(h[2]-Math.floor(h[2]/t)*t)]}function lh(h){const t=o.eq(1323123451230),l=[];for(let d=0;d<h;++d){const g=2*t()-1,y=2*t()-1,x=2*t()-1;l.push(o.d5(g,y,x))}return l}function ua(h,t,l,d,g){const y=o.aA((g-l)/(d-l),0,1);return(1-y)*h+y*t}class Cm{constructor(t){this._movement=new R1,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new M1,this._ppmScaleFactor=t}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,l){const d=t.transform;this._movement.update(d,this._ppmScaleFactor);const g=d.starsProjMatrix,y=o.c7([]);o.c9(y,y,o.an(90)-d._pitch),o.c8(y,y,-d.angle);const x=o.cc(new Float32Array(16),y),T=o.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),E=o.eg([],T),L=o.aB([],E,x),P=Date.now()/1e3;return this._accumulatedTimeFromStart+=(P-this._prevTime)*l,this._prevTime=P,{projectionMatrix:g,modelviewMatrix:L}}}class Gy extends Cm{constructor(t){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Im("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const l=t.context;if(!this.particlesVx){const d=lh(this.particlesCount),g=new o.eN,y=new o.b0;let x=0;const T=o.eq(1323123451230);for(let E=0;E<d.length;++E){const L=d[E],P=[2*T()-1,T(),T(),T()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...P),g.emplaceBack(L[0],L[1],L[2],1,-1,...P),g.emplaceBack(L[0],L[1],L[2],1,1,...P),g.emplaceBack(L[0],L[1],L[2],-1,1,...P),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=l.createVertexBuffer(g,$y.members),this.particlesIdx=l.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const l=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},d=t.transform.zoom;if(l.revealStart>d)return;const g=ua(0,1,l.revealStart,l.revealStart+l.revealRange,d);if(!this.particlesVx||!this.particlesIdx)return;const y=structuredClone(this._params);let x=[-y.direction.x,y.direction.y,-100];o.aw(x,x);const T=structuredClone(this._vignetteParams);T.strength*=g,y.overrideStyleParameters||(y.intensity=t.style.rain.state.density,y.timeFactor=t.style.rain.state.intensity,y.color=structuredClone(t.style.rain.state.color),x=structuredClone(t.style.rain.state.direction),y.screenThinning.intensity=t.style.rain.state.centerThinning,y.dropletSizeX=t.style.rain.state.dropletSize[0],y.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],y.distortionStrength=100*t.style.rain.state.distortionStrength,T.strength=1,T.color=structuredClone(t.style.rain.state.vignetteColor));const E=this.updateOnRender(t,y.timeFactor),L=t.context,P=L.gl,z=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new o.T(L,{width:t.width,height:t.height,data:null},P.RGBA8)),y.distortionStrength>0&&(L.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),P.copyTexSubImage2D(P.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const O=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(L,O),L.activeTexture.set(P.TEXTURE0),this.screenTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE);const B=[y.color.r,y.color.g,y.color.b,y.color.a],G=(V,W)=>{const Y=Am(this._movement.getPosition(),V),se=y.dropletSizeX,ne=y.dropletSizeX*y.dropletSizeYScale,te=t.width/2,we=t.height/2,_e=ua(0,y.screenThinning.start,0,1,y.screenThinning.intensity),be=ua(.001,y.screenThinning.range,0,1,y.screenThinning.intensity),de=ua(0,y.screenThinning.particleOffset,0,1,y.screenThinning.intensity),le=(Te={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:Y,velocityConeAperture:y.velocityConeAperture,velocity:y.velocity,boxSize:V,rainDropletSize:[se,ne],distortionStrength:y.distortionStrength,rainDirection:x,color:B,screenSize:[z.width,z.height],thinningCenterPos:[te,we],thinningShape:[_e,be,Math.pow(10,y.screenThinning.fadePower)],thinningAffectedRatio:y.screenThinning.affectedRatio,thinningParticleOffset:de,shapeDirectionalPower:y.shapeDirPower,shapeNormalPower:y.shapeNormalPower,mode:W?0:1},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_texScreen:0,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_boxSize:Te.boxSize,u_rainDropletSize:Te.rainDropletSize,u_distortionStrength:Te.distortionStrength,u_rainDirection:Te.rainDirection,u_color:Te.color,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_shapeDirectionalPower:Te.shapeDirectionalPower,u_shapeNormalPower:Te.shapeNormalPower,u_mode:Te.mode});var Te;const Me=Math.round(y.intensity*this.particlesCount),Oe=o.bg.simpleSegment(0,0,4*Me,2*Me);O.draw(t,P.TRIANGLES,Dt.disabled,Yt.disabled,ri.alphaBlended,Zt.disabled,le,"rain_particles",this.particlesVx,this.particlesIdx,Oe)};y.distortionStrength>0&&G(y.boxSize,!0),G(y.boxSize,!1),this._vignette.draw(t,T)}}const Gd=o.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class ch extends Cm{constructor(t){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Im("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const l=t.context;if(!this.particlesVx){const d=lh(this.particlesCount),g=new o.eO,y=new o.b0;let x=0;const T=o.eq(1323123451230);for(let E=0;E<d.length;++E){const L=d[E],P=T(),z=T(),O=T(),B=[E/d.length,P,z,O],G=[T(),T()];g.emplaceBack(L[0],L[1],L[2],-1,-1,...B,...G),g.emplaceBack(L[0],L[1],L[2],1,-1,...B,...G),g.emplaceBack(L[0],L[1],L[2],1,1,...B,...G),g.emplaceBack(L[0],L[1],L[2],-1,1,...B,...G),y.emplaceBack(x+0,x+1,x+2),y.emplaceBack(x+0,x+2,x+3),x+=4}this.particlesVx=l.createVertexBuffer(g,Gd.members),this.particlesIdx=l.createIndexBuffer(y)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const l=structuredClone(this._params);let d=[-l.direction.x,l.direction.y,-100];o.aw(d,d);const g=structuredClone(this._vignetteParams),y=l.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},x=t.transform.zoom;if(y.revealStart>x)return;const T=ua(0,1,y.revealStart,y.revealStart+y.revealRange,x);g.strength*=T,l.overrideStyleParameters||(l.intensity=t.style.snow.state.density,l.timeFactor=t.style.snow.state.intensity,l.color=structuredClone(t.style.snow.state.color),d=structuredClone(t.style.snow.state.direction),l.screenThinning.intensity=t.style.snow.state.centerThinning,l.billboardSize=2.79*t.style.snow.state.flakeSize,g.strength=1,g.color=structuredClone(t.style.snow.state.vignetteColor));const E=this.updateOnRender(t,l.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const L=t.context,P=L.gl,z=t.transform,O=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(L,O),((B,G,V)=>{const W=Am(this._movement.getPosition(),B),Y=z.width/2,se=z.height/2,ne=ua(0,V.screenThinning.start,0,1,V.screenThinning.intensity),te=ua(.001,V.screenThinning.range,0,1,V.screenThinning.intensity),we=ua(0,V.screenThinning.particleOffset,0,1,V.screenThinning.intensity),_e=(be={modelview:E.modelviewMatrix,projection:E.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:W,velocityConeAperture:V.velocityConeAperture,velocity:V.velocity,horizontalOscillationRadius:V.horizontalOscillationRadius,horizontalOscillationRate:V.horizontalOscillationRate,boxSize:B,billboardSize:1*V.billboardSize,simpleShapeParameters:[V.shapeFadeStart,V.shapeFadePower],screenSize:[z.width,z.height],thinningCenterPos:[Y,se],thinningShape:[ne,te,Math.pow(10,V.screenThinning.fadePower)],thinningAffectedRatio:V.screenThinning.affectedRatio,thinningParticleOffset:we,color:[V.color.r,V.color.g,V.color.b,V.color.a],direction:d},{u_modelview:Float32Array.from(be.modelview),u_projection:Float32Array.from(be.projection),u_time:be.time,u_cam_pos:be.camPos,u_velocityConeAperture:be.velocityConeAperture,u_velocity:be.velocity,u_horizontalOscillationRadius:be.horizontalOscillationRadius,u_horizontalOscillationRate:be.horizontalOscillationRate,u_boxSize:be.boxSize,u_billboardSize:be.billboardSize,u_simpleShapeParameters:be.simpleShapeParameters,u_screenSize:be.screenSize,u_thinningCenterPos:be.thinningCenterPos,u_thinningShape:be.thinningShape,u_thinningAffectedRatio:be.thinningAffectedRatio,u_thinningParticleOffset:be.thinningParticleOffset,u_particleColor:be.color,u_direction:be.direction});var be;const de=Math.round(V.intensity*this.particlesCount),le=o.bg.simpleSegment(0,0,4*de,2*de);this.particlesVx&&this.particlesIdx&&O.draw(t,P.TRIANGLES,Dt.disabled,Yt.disabled,ri.alphaBlended,Zt.disabled,_e,"snow_particles",this.particlesVx,this.particlesIdx,le)})(l.boxSize,0,l),this._vignette.draw(t,g)}}const Hl={symbol:function(h,t,l,d,g){if(h.renderPass!=="translucent")return;const y=Yt.disabled,x=h.colorModeForRenderPass(),T=l.layout.get("text-variable-anchor"),E=l.layout.get("text-size-scale-range"),L=o.aA(h.scaleFactor,E[0],E[1]);T&&function(O,B,G,V,W,Y,se,ne){const te=B.transform,we=W==="map",_e=Y==="map";for(const be of O){const de=V.getTile(be),le=de.getBucket(G);if(!le||!le.text||!le.text.segments.get().length)continue;const Te=o.bK(le.textSizeData,te.zoom,ne),Me=xc(be,le.getProjection(),te),Oe=te.calculatePixelsToTileUnitsMatrix(de),Ve=Dl(Me,de.tileID.canonical,_e,we,te,le.getProjection(),Oe),je=le.hasIconTextFit()&&le.hasIconData();Te&&Ay(le,we,_e,se,te,Ve,be,Math.pow(2,te.zoom-de.tileID.overscaledZ),Te,je)}}(d,h,l,t,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),g,L);const P=l.paint.get("icon-opacity").constantOr(1)!==0,z=l.paint.get("text-opacity").constantOr(1)!==0;l.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(P||z)?Fd(h,t,l,d,y,x):(P&&Fd(h,t,l,d,y,x,{onlyIcons:!0}),z&&Fd(h,t,l,d,y,x,{onlyText:!0})),t.map.showCollisionBoxes&&(lm(h,t,l,d,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),lm(h,t,l,d,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,t,l,d){if(h.renderPass!=="translucent")return;const g=l.paint.get("circle-opacity"),y=l.paint.get("circle-stroke-width"),x=l.paint.get("circle-stroke-opacity"),T=l.layout.get("circle-sort-key").constantOr(1)!==void 0,E=l.paint.get("circle-emissive-strength");if(g.constantOr(1)===0&&(y.constantOr(1)===0||x.constantOr(1)===0))return;const L=h.context,P=L.gl,z=h.transform,O=!(!h.terrain||!h.terrain.enabled),B=l.layout.get("circle-elevation-reference"),G=h.depthModeForSublayer(0,Dt.ReadOnly),V=new Dt(h.context.gl.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D),W=B==="none"||O?G:V,Y=Yt.disabled,se=h.colorModeForDrapableLayerRenderPass(E),ne=z.projection.name==="globe",te=[o.aF(z.center.lng),o.aJ(z.center.lat)],we=[];for(let be=0;be<d.length;be++){const de=d[be],le=t.getTile(de),Te=le.getBucket(l);if(!Te||Te.projection.name!==z.projection.name)continue;const Me=Te.programConfigurations.get(l.id),Oe=Te.layoutVertexBuffer,Ve=Te.globeExtVertexBuffer,je=Te.indexBuffer,Ye=o.e0(l),nt=[Ve],Fe=h.isTileAffectedByFog(de);ne&&Ye.push("PROJECTION_GLOBE_VIEW"),Ye.push("DEPTH_D24"),h.terrain&&z.depthOcclusionForSymbolsAndCircles&&Ye.push("DEPTH_OCCLUSION"),Te.hasElevation&&!h.terrain&&(Ye.push("ELEVATED_ROADS"),nt.push(Te.elevatedLayoutVertexBuffer));const Ie=h.getOrCreateProgram("circle",{config:Me,defines:Ye,overrideFog:Fe}),Xe=z.projection.createInversionMatrix(z,de.canonical),$e={programConfiguration:Me,program:Ie,layoutVertexBuffer:Oe,dynamicBuffers:nt,indexBuffer:je,uniformValues:o.e1(h,de,le,Xe,te,l),tile:le};if(T){const ot=Te.segments.get();for(const ht of ot)we.push({segments:new o.bg([ht]),sortKey:ht.sortKey,state:$e})}else we.push({segments:Te.segments,sortKey:0,state:$e})}T&&we.sort((be,de)=>be.sortKey-de.sortKey);const _e={useDepthForOcclusion:z.depthOcclusionForSymbolsAndCircles};for(const be of we){const{programConfiguration:de,program:le,layoutVertexBuffer:Te,dynamicBuffers:Me,indexBuffer:Oe,uniformValues:Ve,tile:je}=be.state,Ye=be.segments;h.terrain&&h.terrain.setupElevationDraw(je,le,_e),h.uploadCommonUniforms(L,le,je.tileID.toUnwrapped()),le.draw(h,P.TRIANGLES,W,Y,se,Zt.disabled,Ve,l.id,Te,Oe,Ye,l.paint,z.zoom,de,Me)}},heatmap:function(h,t,l,d){if(l.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){const g=h.context,y=g.gl,x=Yt.disabled,T=new ri([y.ONE,y.ONE,y.ONE,y.ONE],o.ao.transparent,[!0,!0,!0,!0]);(function(B,G,V,W){const Y=B.gl,se=G.width*W,ne=G.height*W;B.activeTexture.set(Y.TEXTURE1),B.viewport.set([0,0,se,ne]);let te=V.heatmapFbo;if(!te||te&&(te.width!==se||te.height!==ne)){te&&te.destroy();const we=Y.createTexture();Y.bindTexture(Y.TEXTURE_2D,we),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_2D,Y.TEXTURE_MAG_FILTER,Y.LINEAR),te=V.heatmapFbo=B.createFramebuffer(se,ne,1,null),function(_e,be,de,le,Te,Me){const Oe=_e.gl;Oe.texImage2D(Oe.TEXTURE_2D,0,_e.extRenderToTextureHalfFloat?Oe.RGBA16F:Oe.RGBA,Te,Me,0,Oe.RGBA,_e.extRenderToTextureHalfFloat?Oe.HALF_FLOAT:Oe.UNSIGNED_BYTE,null),le.colorAttachment0.set(de)}(B,0,we,te,se,ne)}else Y.bindTexture(Y.TEXTURE_2D,te.colorAttachment0.get()),B.bindFramebuffer.set(te.framebuffer)})(g,h,l,h.transform.projection.name==="globe"?.5:.25),g.clear({color:o.ao.transparent});const E=h.transform,L=E.projection.name==="globe",P=L?["PROJECTION_GLOBE_VIEW"]:[],z=L?Zt.frontCCW:Zt.disabled,O=[o.aF(E.center.lng),o.aJ(E.center.lat)];for(let B=0;B<d.length;B++){const G=d[B];if(t.hasRenderableParent(G))continue;const V=t.getTile(G),W=V.getBucket(l);if(!W||W.projection.name!==E.projection.name)continue;const Y=h.isTileAffectedByFog(G),se=W.programConfigurations.get(l.id),ne=h.getOrCreateProgram("heatmap",{config:se,defines:P,overrideFog:Y}),{zoom:te}=h.transform;h.terrain&&h.terrain.setupElevationDraw(V,ne),h.uploadCommonUniforms(g,ne,G.toUnwrapped());const we=E.projection.createInversionMatrix(E,G.canonical);ne.draw(h,y.TRIANGLES,Dt.disabled,x,T,z,om(h,G,V,we,O,te,l.paint.get("heatmap-intensity")),l.id,W.layoutVertexBuffer,W.indexBuffer,W.segments,l.paint,h.transform.zoom,se,L?[W.globeExtVertexBuffer]:null)}g.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(g,y){const x=g.context,T=x.gl,E=y.heatmapFbo;if(!E)return;x.activeTexture.set(T.TEXTURE0),T.bindTexture(T.TEXTURE_2D,E.colorAttachment0.get()),x.activeTexture.set(T.TEXTURE1);let L=y.colorRampTexture;L||(L=y.colorRampTexture=new o.T(x,y.colorRamp,T.RGBA8)),L.bind(T.LINEAR,T.CLAMP_TO_EDGE),g.getOrCreateProgram("heatmapTexture").draw(g,T.TRIANGLES,Dt.disabled,Yt.disabled,g.colorModeForRenderPass(),Zt.disabled,((P,z)=>({u_image:0,u_color_ramp:1,u_opacity:z.paint.get("heatmap-opacity")}))(0,y),y.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments,y.paint,g.transform.zoom)}(h,l))},line:function(h,t,l,d){if(h.renderPass!=="translucent")return;const g=l.paint.get("line-opacity"),y=l.paint.get("line-width");if(g.constantOr(1)===0||y.constantOr(1)===0)return;const x=l.paint.get("line-emissive-strength").isConstant(),T=l.paint.get("line-emissive-strength").constantOr(0),E=l.paint.get("line-occlusion-opacity"),L=l.layout.get("line-elevation-reference"),P=l.layout.get("line-width-unit")==="meters",z=L==="sea",O=!(!h.terrain||!h.terrain.enabled),B=h.context,G=B.gl;if(l.hasElevatedBuckets&&h.transform.projection.name==="globe")return;const V=l.layout.get("line-cross-slope"),W=V!==void 0,Y=V<1,se=h.colorModeForDrapableLayerRenderPass(x?T:null),ne=h.terrain&&h.terrain.renderingToTexture,te=ne?1:o.o.devicePixelRatio,we=l.paint.get("line-dasharray"),_e=we.constantOr(1),be=l.layout.get("line-cap"),de=we.constantOr(null),le=be.constantOr(null),Te=l.paint.get("line-pattern"),Me=Te.constantOr(1),Oe=l.paint.get("line-pattern-cross-fade"),Ve=Te.constantOr(null),je=l.paint.get("line-opacity").constantOr(1);let Ye=!Me&&je!==1||h.depthOcclusion&&E>0&&E<1;const nt=l.paint.get("line-gradient"),Fe=Me?"linePattern":"line",Ie=o.e2(l);let Xe;if(ne&&h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(Ye=!1),E!==0&&h.depthOcclusion){const yt=l.paint._values["line-opacity"];yt&&yt.value&&yt.value.kind==="constant"?Xe=yt.value:o.w(`Occlusion opacity for layer ${l.id} is supported only when line-opacity isn't data-driven.`)}y.value.kind!=="constant"&&y.value.isLineProgressConstant===!1&&Ie.push("VARIABLE_LINE_WIDTH"),ne&&(h.emissiveMode!=="dual-source-blending"||x?h.emissiveMode==="mrt-fallback"&&Ie.push("USE_MRT1"):Ie.push("DUAL_SOURCE_BLENDING"));const $e=(yt,dt,pt,Mt,Lt,bt)=>{for(const kt of yt){const jt=t.getTile(kt);if(Me&&!jt.patternsLoaded())continue;const Xt=jt.getBucket(l);if(!Xt||Xt.elevationType!=="none"&&!Lt||Xt.elevationType==="none"&&Lt)continue;h.prepareDrawTile();const ci=[...dt],Ti=h.shadowRenderer,ii=Xt.elevationType==="road"&&!!Ti&&Ti.enabled;let Mi=[0,0,0];if(ii){const li=h.style.directionalLight,nr=h.style.ambientLight;li&&nr&&(Mi=bo(h.style,li,nr)),ci.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ni=Xt.programConfigurations.get(l.id);let Zi=!1;if(Ve&&jt.imageAtlas){const li=o.e3.from(Ve),nr=li.getPrimary().scaleSelf(te).toString(),kr=jt.imageAtlas.patternPositions.get(nr),cr=li.getSecondary(),dr=cr?jt.imageAtlas.patternPositions.get(cr.scaleSelf(te).toString()):null;Zi=!!kr&&!!dr,kr&&ni.setConstantPatternPositions(kr,dr)}Oe>0&&(Zi||ni.getPatternTransitionVertexBuffer("line-pattern"))&&ci.push("LINE_PATTERN_TRANSITION");const Wi=h.isTileAffectedByFog(kt),Ki=h.getOrCreateProgram(Fe,{config:ni,defines:ci,overrideFog:Wi});if(!Me&&de&&le&&jt.lineAtlas){const li=jt.lineAtlas.getDash(de,le);li&&ni.setConstantPatternPositions(li)}ii&&Ti.setupShadows(jt.tileID.toUnwrapped(),Ki,"vector-tile");let[Ii,ai]=l.paint.get("line-trim-offset");(le==="round"||le==="square")&&Ii!==ai&&(Ii===0&&(Ii-=1),ai===1&&(ai+=1));const ji=ne?kt.projMatrix:null,br=P?1/Xt.tileToMeter/o.ay(jt,1,h.transform.zoom):1,wr=P?1/Xt.tileToMeter/o.ay(jt,1,Math.floor(h.transform.zoom)):1,Ni=Me?o.e4(h,jt,l,ji,te,br,wr,[Ii,ai],Mi,Oe):o.e5(h,jt,l,ji,Xt.lineClipsArray.length,te,br,wr,[Ii,ai],Mi);if(nt){const li=Xt.gradients[l.id];let nr=li.texture;if(l.gradientVersion!==li.version){let kr=256;if(l.stepInterpolant){const cr=t.getSource().maxzoom,dr=kt.canonical.z===cr?Math.ceil(1<<h.transform.maxZoom-kt.canonical.z):1;kr=o.aA(o.e6(Xt.maxLineLength/o.al*1024*dr),256,B.maxTextureSize)}li.gradient=o.e7({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:kr,image:li.gradient||void 0,clips:Xt.lineClipsArray}),li.texture?li.texture.update(li.gradient):li.texture=new o.T(B,li.gradient,G.RGBA8),li.version=l.gradientVersion,nr=li.texture}B.activeTexture.set(G.TEXTURE1),nr.bind(l.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}_e&&(B.activeTexture.set(G.TEXTURE0),jt.lineAtlasTexture&&jt.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),ni.updatePaintBuffers()),Me&&(B.activeTexture.set(G.TEXTURE0),jt.imageAtlasTexture&&jt.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),ni.updatePaintBuffers()),Lt&&!z&&h.terrain.setupElevationDraw(jt,Ki),h.uploadCommonUniforms(B,Ki,kt.toUnwrapped());const xi=li=>{Xe!=null&&(Xe.value=je*E),Ki.draw(h,G.TRIANGLES,pt,li,se,Zt.disabled,Ni,l.id,Xt.layoutVertexBuffer,Xt.indexBuffer,Xt.segments,l.paint,h.transform.zoom,ni,[Xt.layoutVertexBuffer2,Xt.patternVertexBuffer,Xt.zOffsetVertexBuffer]),Xe!=null&&(Xe.value=je)};if(Ye&&!Lt){const li=h.stencilModeForClipping(kt).ref;li===0&&ne&&B.clear({stencil:0});const nr={func:G.EQUAL,mask:255};Ni.u_alpha_discard_threshold=.8,xi(new Yt(nr,li,255,G.KEEP,G.KEEP,G.INVERT)),Ni.u_alpha_discard_threshold=0,xi(new Yt(nr,li,255,G.KEEP,G.KEEP,G.KEEP))}else Ni.u_alpha_discard_threshold=Ye&&Lt&&bt?.8:0,xi(Lt?Mt:h.stencilModeForClipping(kt))}};let ot=h.depthModeForSublayer(0,Dt.ReadOnly);const ht=new Dt(h.depthOcclusion?G.GREATER:G.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D);if(l.hasNonElevatedBuckets){const yt=!ne&&h.terrain;E!==0&&yt?o.w(`Occlusion opacity for layer ${l.id} is supported on terrain only if the layer has line-z-offset enabled.`):yt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${l.id}.`):$e(d,Ie,ot,Yt.disabled,!1,!0)}if(l.hasElevatedBuckets){L==="hd-road-markup"?O||(ot=ht,Ie.push("ELEVATED_ROADS")):(Ie.push("ELEVATED"),ot=ht,W&&Ie.push(Y?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),z&&Ie.push("ELEVATION_REFERENCE_SEA"));const yt=Ye?h.stencilModeFor3D():Yt.disabled;h.forceTerrainMode=!0,$e(d,Ie,ot,yt,!0,!0),Ye&&$e(d,Ie,ot,yt,!0,!1),h.forceTerrainMode=!1}Ye&&(h.resetStencilClippingMasks(),ne&&B.clear({stencil:0})),E===0||h.depthOcclusion||ne||h.layersWithOcclusionOpacity.push(h.currentLayer)},fill:function(h,t,l,d){const g=l.paint.get("fill-color"),y=l.paint.get("fill-opacity");if(y.constantOr(1)===0)return;const x=l.paint.get("fill-emissive-strength"),T=h.colorModeForDrapableLayerRenderPass(x),E=l.paint.get("fill-pattern"),L=h.opaquePassEnabledForLayer()&&!E.constantOr(1)&&g.constantOr(o.ao.transparent).a===1&&y.constantOr(0)===1?"opaque":"translucent";let P="none";l.layout.get("fill-elevation-reference")!=="none"?P="road":l.paint.get("fill-z-offset").constantOr(1)!==0&&(P="offset");const z=!(!h.terrain||!h.terrain.enabled),O={painter:h,sourceCache:t,layer:l,coords:d,colorMode:T,elevationType:P,terrainEnabled:z,pass:L};if(h.renderPass==="shadow")return void(h.shadowRenderer&&P==="road"&&!z&&function(G){const{painter:V,sourceCache:W,layer:Y,coords:se}=G,ne=V.context.gl,te=G.painter.shadowRenderer;for(const we of se){const _e=W.getTile(we),be=_e.getBucket(Y);if(!be)continue;const de=be.elevatedStructures;if(!de||!de.shadowCasterSegments||de.shadowCasterSegments.segments[0].primitiveLength===0)continue;V.prepareDrawTile();const le=be.bufferData.programConfigurations.get(Y.id),Te=V.isTileAffectedByFog(we),Me=V.getOrCreateProgram("elevatedStructuresDepth",{config:le,overrideFog:Te}),Oe=te.calculateShadowPassMatrixFromTile(_e.tileID.toUnwrapped());V.uploadCommonUniforms(V.context,Me,we.toUnwrapped());const Ve=rm(Oe,0);Me.draw(V,ne.TRIANGLES,te.getShadowPassDepthMode(),Yt.disabled,te.getShadowPassColorMode(),Zt.disabled,Ve,Y.id,de.vertexBuffer,de.indexBuffer,de.shadowCasterSegments,Y.paint,V.transform.zoom,le)}}(O));const B=h.emissiveMode==="mrt-fallback";if(P!=="offset"){if(Oc(O,!1,B),P==="road"){const G=!z&&h.renderPass==="translucent";G&&um(h,t,l,d,"geometry"),Oc(O,!0,B,Yt.disabled),G&&function(V){const{painter:W,sourceCache:Y,layer:se,coords:ne,colorMode:te}=V,we=W.context.gl,_e=V.painter.shadowRenderer,be=!!_e&&_e.enabled,de=new Dt(W.context.gl.LEQUAL,Dt.ReadOnly,W.depthRangeFor3D);let le=[0,0,0];if(be){const Me=W.style.directionalLight,Oe=W.style.ambientLight;Me&&Oe&&(le=bo(W.style,Me,Oe))}const Te=Me=>{for(const Oe of ne){const Ve=Y.getTile(Oe),je=Ve.getBucket(se);if(!je)continue;const Ye=je.elevatedStructures;if(!Ye)continue;let nt,Fe;if(Me?(nt=Ye.renderableBridgeSegments,Fe=Ye.bridgeProgramConfigurations.get(se.id)):(nt=Ye.renderableTunnelSegments,Fe=Ye.tunnelProgramConfigurations.get(se.id)),!nt||nt.segments[0].primitiveLength===0)continue;Fe.updatePaintBuffers(),W.prepareDrawTile();const Ie=W.isTileAffectedByFog(Oe),Xe=[];be&&Xe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const $e=W.getOrCreateProgram("elevatedStructures",{config:Fe,overrideFog:Ie,defines:Xe}),ot=W.translatePosMatrix(Oe.projMatrix,Ve,se.paint.get("fill-translate"),se.paint.get("fill-translate-anchor"));be&&_e.setupShadows(Ve.tileID.toUnwrapped(),$e,"vector-tile");const ht=ul(ot,le);W.uploadCommonUniforms(W.context,$e,Oe.toUnwrapped()),$e.draw(W,we.TRIANGLES,de,Yt.disabled,te,Zt.backCCW,ht,se.id,Ye.vertexBuffer,Ye.indexBuffer,nt,se.paint,W.transform.zoom,Fe,[Ye.vertexBufferNormal])}};Te(!0),Te(!1)}(O)}}else Oc(O,!1,B,h.stencilModeFor3D())},"fill-extrusion":function(h,t,l,d){const g=l.paint.get("fill-extrusion-opacity"),y=h.context,x=y.gl,T=h.terrain,E=T&&T.renderingToTexture;if(g===0)return;const L=h.emissiveMode==="mrt-fallback",P=h.conflationActive&&h.style.isLayerClipped(l,t.getSource()),z=h.style.order.indexOf(l.fqid);if(P&&function(O,B,G,V,W){for(const Y of V){const se=B.getTile(Y).getBucket(G);se&&(se.updateReplacement(Y,O.replacementSource,W),se.uploadCentroid(O.context))}}(h,t,l,d,z),T||P)for(const O of d){const B=t.getTile(O).getBucket(l);B&&Cy(h.context,t,O,B,l,T,P)}if(h.renderPass==="shadow"&&h.shadowRenderer){const O=h.shadowRenderer;if(T&&g<.65&&l._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ad)return;const B=O.getShadowPassDepthMode(),G=O.getShadowPassColorMode();zc(h,t,l,d,B,Yt.disabled,G,P)}else if(h.renderPass==="translucent"){const O=!l.paint.get("fill-extrusion-pattern").constantOr(1),B=l.paint.get("fill-extrusion-color").constantOr(o.ao.white);if(!E&&B.a!==0){const G=new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D);g===1&&O?zc(h,t,l,d,G,Yt.disabled,ri.unblended,P):(zc(h,t,l,d,G,Yt.disabled,ri.disabled,P),zc(h,t,l,d,G,h.stencilModeFor3D(),h.colorModeForRenderPass(),P),h.resetStencilClippingMasks())}if(h.style.enable3dLights()&&O&&(!T&&h.transform.projection.name!=="globe"||E)){const G=l.paint.get("fill-extrusion-opacity"),V=l.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=l.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),Y=l.paint.get("fill-extrusion-flood-light-intensity"),se=l.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ne=l.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(se?null:l.lut).toArray01().slice(0,3),te=V>0&&W>0,we=Y>0,_e=(le,Te,Me)=>(1-Me)*le+Me*Te,be=new sh;be.translate=l.paint.get("fill-extrusion-translate"),be.translateAnchor=l.paint.get("fill-extrusion-translate-anchor"),be.edgeRadius=l.layout.get("fill-extrusion-edge-radius"),be.cutoffFadeRange=l.paint.get("fill-extrusion-cutoff-fade-range");const de=le=>{const Te=h.depthModeForSublayer(1,Dt.ReadOnly,x.LEQUAL,!0),Me=l.paint.get(le?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Oe=_e(.1,3,Me),Ve=h._showOverdrawInspector;if(!Ve){const je=new Yt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ye=new ri([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);ca(be,h,t,l,d,Te,je,Ye,Zt.disabled,le,"sdf",G,V,W,Y,ne,Oe,P,!1)}{const je=Ve?Yt.disabled:new Yt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Ye=Ve?h.colorModeForRenderPass():new ri([x.ONE_MINUS_DST_ALPHA,x.DST_ALPHA,x.ONE,x.ONE],o.ao.transparent,[!0,!0,!0,!0]);ca(be,h,t,l,d,Te,je,Ye,Zt.disabled,le,"color",G,V,W,Y,ne,Oe,P,!1)}};if(E){const le=()=>{const Me=T.drapeBufferSize[0],Oe=T.drapeBufferSize[1];let Ve=T.framebufferCopyTexture;return Ve&&(!Ve||Ve.size[0]===Me&&Ve.size[1]===Oe)||(Ve&&Ve.destroy(),Ve=T.framebufferCopyTexture=new o.T(y,new o.q({width:Me,height:Oe}),x.RGBA8)),Ve.bind(x.LINEAR,x.CLAMP_TO_EDGE),x.copyTexSubImage2D(x.TEXTURE_2D,0,0,0,0,0,Me,Oe),Ve},Te=(Me,Oe,Ve)=>{const je=h.depthModeForSublayer(1,Dt.ReadOnly,x.LEQUAL,!1),Ye=l.paint.get(Me?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),nt=_e(.1,3,Ye);{const Fe=new ri([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0]);ca(be,h,t,l,d,je,Yt.disabled,Fe,Zt.disabled,Me,"clear",G,V,W,Y,ne,nt,P,Oe)}{const Fe=new Yt({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),Ie=new ri([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!1,!1,!1,!0],x.MIN);ca(be,h,t,l,d,je,Fe,Ie,Zt.disabled,Me,"sdf",G,V,W,Y,ne,nt,P,Oe)}L&&!Me&&(Ve=le());{const Fe=Me?x.ZERO:x.ONE_MINUS_DST_ALPHA,Ie=new Yt({func:x.EQUAL,mask:255},255,255,x.KEEP,x.DECR,x.DECR),Xe=new ri([Fe,x.DST_ALPHA,x.ONE_MINUS_DST_ALPHA,x.ZERO],o.ao.transparent,[!0,!0,!0,!0]);ca(be,h,t,l,d,je,Ie,Xe,Zt.disabled,Me,"color",G,V,W,Y,ne,nt,P,Oe)}if(!L||Me){const Fe=new ri([x.ONE,x.ONE,x.ONE,Me?x.ZERO:x.ONE],o.ao.transparent,[!1,!1,!1,!0],Me?x.FUNC_ADD:x.MAX);ca(be,h,t,l,d,je,Yt.disabled,Fe,Zt.disabled,Me,"clear",G,V,W,Y,ne,nt,P,Oe,Ve)}else{x.drawBuffers([x.NONE,x.COLOR_ATTACHMENT1]);const Fe=new Yt({func:x.EQUAL,mask:255},254,255,x.KEEP,x.DECR,x.DECR),Ie=new ri([x.ONE,x.ONE,x.ONE,x.ONE],o.ao.transparent,[!0,!1,!1,!1],x.MAX);ca(be,h,t,l,d,je,Fe,Ie,Zt.disabled,Me,"emissive",G,V,W,Y,ne,nt,P,Oe,Ve),x.drawBuffers([x.COLOR_ATTACHMENT0])}};if(te||we){let Me;h.prepareDrawTile(),L&&!te||(Me=le()),te&&Te(!0,!1,Me),we&&Te(!1,!0,Me)}}else te&&de(!0),we&&de(!1),(te||we)&&h.resetStencilClippingMasks()}}},building:function(h,t,l,d){h.currentLayer<h.firstLightBeamLayer&&(h.firstLightBeamLayer=h.currentLayer);const g=l.paint.get("building-ambient-occlusion-ground-intensity"),y=l.paint.get("building-ambient-occlusion-ground-radius"),x=l.paint.get("building-ambient-occlusion-ground-attenuation"),T=l.paint.get("building-opacity");if(T<=0)return;let E=g>0&&y>0,L=!0;const P=l.paint.get("building-vertical-scale");if(P<=0)return;h.shadowRenderer||(L=!1);const z=h.conflationActive&&h.style.isLayerClipped(l,t.getSource()),O=h.style.order.indexOf(l.fqid);if(function(B,G,V,W,Y,se){for(const ne of se){const te=G.getTile(ne).getBucket(V);te&&(Y&&te.updateReplacement(ne,B.replacementSource,W),te.uploadUpdatedIndexBuffer(B.context))}}(h,t,l,O,z,d),function(B,G,V,W){for(const Y of W){const se=G.getTile(Y).getBucket(V);se&&se.needsEvaluation()&&se.uploadUpdatedColorBuffer(B.context)}}(h,t,l,d),l.resetLayerRenderingStats(h),h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!0),h.renderPass==="shadow"&&h.shadowRenderer){const B=h.shadowRenderer,G=[],V=B.getShadowPassDepthMode();Bc({painter:h,source:t,layer:l,coords:d,defines:G,blendMode:B.getShadowPassColorMode(),depthMode:V,opacity:T,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if(h.renderPass==="translucent"){let B=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];L&&(B=B.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),h.shadowRenderer&&h.shadowRenderer.useNormalOffset&&(B=B.concat("NORMAL_OFFSET"));const G=l.paint.get("building-facade-emissive-chance"),V=l.paint.get("building-ambient-occlusion-intensity"),W=l.paint.get("building-flood-light-intensity"),Y=l.paint.get("building-flood-light-color-use-theme").constantOr("default")==="none",se=l.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(Y?null:l.lut).toArray01().slice(0,3),ne=l.paint.get("building-flood-light-ground-attenuation"),te=W>0,we=new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D);T<1&&Bc({painter:h,source:t,layer:l,coords:d,defines:B,blendMode:ri.disabled,depthMode:we,opacity:T,verticalScale:P,facadeEmissiveChance:G,facadeAOIntensity:V,floodLightIntensity:W,floodLightColor:se,depthOnly:!0});const _e=h.colorModeForRenderPass();Bc({painter:h,source:t,layer:l,coords:d,defines:B,blendMode:_e,depthMode:we,opacity:T,verticalScale:P,facadeEmissiveChance:G,facadeAOIntensity:V,floodLightIntensity:W,floodLightColor:se}),E&&Nd(h,t,l,d,!0,T,g,y,W,se,x,z),te&&Nd(h,t,l,d,!1,T,g,y,W,se,ne,z)}else if(h.renderPass==="light-beam"){const B=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],G=new Dt(h.context.gl.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D);Bc({painter:h,source:t,layer:l,coords:d,defines:B,blendMode:ri.alphaBlended,depthMode:G,opacity:T,verticalScale:P,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}h.shadowRenderer&&(h.shadowRenderer.useNormalOffset=!1),h.resetStencilClippingMasks()},hillshade:function(h,t,l,d){if(h.renderPass!=="offscreen"&&h.renderPass!=="translucent"||h.style.disableElevatedTerrain)return;const g=h.context,y=h.terrain&&h.terrain.renderingToTexture,[x,T]=h.renderPass!=="translucent"||y?[{},d]:h.stencilConfigForOverlap(d);for(const E of T){const L=t.getTile(E);if(L.needsHillshadePrepare&&h.renderPass==="offscreen")y1(h,L,l);else if(h.renderPass==="translucent"){const P=h.depthModeForSublayer(0,Dt.ReadOnly),z=l.paint.get("hillshade-emissive-strength"),O=h.colorModeForDrapableLayerRenderPass(z),B=y&&h.terrain?h.terrain.stencilModeForRTTOverlap(E):x[E.overscaledZ];_1(h,E,L,l,P,B,O)}}g.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,t,l,d,g,y){if(h.renderPass!=="translucent"||l.paint.get("raster-opacity")===0)return;const x=h.transform.projection.name==="globe",T=l.paint.get("raster-elevation")!==0,E=T&&x;if(h.renderElevatedRasterBackface&&!E)return;const L=h.context,P=L.gl,z=t.getSource(),O=function(_e,be,de,le,Te){const Me=be.paint.get("raster-color"),Oe=_e.type==="raster-array",Ve=[],je=be.paint.get("raster-resampling"),Ye=be.paint.get("raster-color-mix");let nt=be.paint.get("raster-color-range");const Fe=[Ye[0],Ye[1],Ye[2],0],Ie=Ye[3];let Xe=je==="nearest"?le.NEAREST:le.LINEAR;if(Oe&&(Ve.push("RASTER_ARRAY"),Me||Ve.push("RASTER_COLOR"),je==="linear"&&Ve.push("RASTER_ARRAY_LINEAR"),Xe=le.NEAREST,!nt&&_e.rasterLayers)){const $e=_e.rasterLayers.find(({id:ot})=>ot===be.sourceLayer);$e&&$e.fields&&$e.fields.range&&(nt=$e.fields.range)}if(nt=nt||[0,1],Me){Ve.push("RASTER_COLOR"),de.activeTexture.set(le.TEXTURE2),be.updateColorRamp(nt);let $e=be.colorRampTexture;$e||($e=be.colorRampTexture=new o.T(de,be.colorRamp,le.RGBA8)),$e.bind(Xe,le.CLAMP_TO_EDGE)}return Te&&Ve.push("USE_MRT1"),{mix:Fe,range:nt,offset:Ie,defines:Ve,resampling:Xe}}(z,l,L,P,h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback");if(z instanceof o.aU&&!d.length&&!x)return;const B=l.paint.get("raster-emissive-strength"),G=h.colorModeForDrapableLayerRenderPass(B),V=h.terrain&&h.terrain.renderingToTexture,W=!h.options.moving,Y=l.paint.get("raster-resampling")==="nearest"?P.NEAREST:P.LINEAR;if(z instanceof o.aU&&!d.length&&(z.onNorthPole||z.onSouthPole)){const _e=T?h.stencilModeFor3D():Yt.disabled;return void Ud(!!z.onNorthPole,null,h,t,l,B,O,Zt.disabled,_e)}if(!d.length)return;const[se,ne]=z instanceof o.aU||V?[{},d]:h.stencilConfigForOverlap(d),te=ne[ne.length-1].overscaledZ;E&&O.defines.push("PROJECTION_GLOBE_VIEW"),T&&O.defines.push("RENDER_CUTOFF");const we=(_e,be,de)=>{for(const le of _e){const Te=le.toUnwrapped(),Me=t.getTile(le);if(V&&(!Me||!Me.hasData()))continue;L.activeTexture.set(P.TEXTURE0);const Oe=Ry(Me,z,l,O);if(!Oe||!Oe.texture)continue;const{texture:Ve,mix:je,offset:Ye,tileSize:nt,buffer:Fe}=Oe;let Ie,Xe;V?(Ie=Dt.disabled,Xe=le.projMatrix):T?(Ie=new Dt(P.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D),Xe=x?Float32Array.from(h.transform.expandedFarZProjMatrix):h.transform.calculateProjMatrix(Te,W)):(Ie=h.depthModeForSublayer(le.overscaledZ-te,l.paint.get("raster-opacity")===1?Dt.ReadWrite:Dt.ReadOnly,P.LESS),Xe=h.transform.calculateProjMatrix(Te,W));const $e=h.terrain&&V?h.terrain.stencilModeForRTTOverlap(le):se[le.overscaledZ],ot=y?0:l.paint.get("raster-fade-duration");Me.registerFadeDuration(ot);const ht=t.findLoadedParent(le,0),yt=eh(Me,ht,t,h.transform,ot);let dt,pt;!yt.isFading&&Me.refreshedUponExpiration&&(Me.refreshedUponExpiration=!1),h.terrain&&h.terrain.prepareDrawTile(),L.activeTexture.set(P.TEXTURE0),Ve.bind(Y,P.CLAMP_TO_EDGE),L.activeTexture.set(P.TEXTURE1),ht?(ht.texture&&ht.texture.bind(Y,P.CLAMP_TO_EDGE),dt=Math.pow(2,ht.tileID.overscaledZ-Me.tileID.overscaledZ),pt=[Me.tileID.canonical.x*dt%1,Me.tileID.canonical.y*dt%1]):Ve.bind(Y,P.CLAMP_TO_EDGE),"useMipmap"in Ve&&L.extTextureFilterAnisotropic&&h.transform.pitch>20&&P.texParameterf(P.TEXTURE_2D,L.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,L.extTextureFilterAnisotropicMax);const Mt=h.transform;let Lt;const bt=T?My(Mt):[0,0,0,0];let kt,jt,Xt,ci,Ti,ii=0;if(E&&z instanceof o.aU&&z.coordinates.length>3)kt=Float32Array.from(o.bk(o.dJ(new o.cD(0,0,0)))),jt=Float32Array.from(Mt.globeMatrix),Xt=Float32Array.from(o.dF(Mt)),ci=[o.aF(Mt.center.lng),o.aJ(Mt.center.lat)],Lt=z.elevatedGlobePerspectiveTransform,Ti=z.elevatedGlobeGridMatrix||new Float32Array(9);else if(E){const Wi=o.dG(le.canonical);ii=o.dH(Wi.getCenter().lat),kt=Float32Array.from(o.bk(o.dJ(le.canonical))),jt=Float32Array.from(Mt.globeMatrix),Xt=Float32Array.from(o.dF(Mt)),ci=[o.aF(Mt.center.lng),o.aJ(Mt.center.lat)],Lt=[0,0],Ti=Float32Array.from(o.dI(le.canonical,Wi,ii,Mt.worldSize/Mt._pixelsPerMercatorPixel))}else Lt=z instanceof o.aU?z.perspectiveTransform:[0,0],kt=new Float32Array(16),jt=new Float32Array(9),Xt=new Float32Array(16),ci=[0,0],Ti=new Float32Array(9);const Mi=am(Xe,kt,jt,Xt,Ti,pt||[0,0],o.aj(h.transform.zoom),ci,bt,dt||1,yt,l,Lt,T?l.paint.get("raster-elevation"):0,2,je,Ye,O.range,nt,Fe,B),ni=h.isTileAffectedByFog(le),Zi=h.getOrCreateProgram("raster",{defines:O.defines,overrideFog:ni});if(h.uploadCommonUniforms(L,Zi,Te),z instanceof o.aU){const Wi=z.elevatedGlobeVertexBuffer,Ki=z.elevatedGlobeIndexBuffer;if(V||!x)z.boundsBuffer&&z.boundsSegments&&Zi.draw(h,P.TRIANGLES,Ie,Yt.disabled,G,Zt.disabled,Mi,l.id,z.boundsBuffer,h.quadTriangleIndexBuffer,z.boundsSegments);else if(Wi&&Ki){const Ii=Mt.zoom<=o.c_?z.elevatedGlobeSegments:z.getSegmentsForLongitude(Mt.center.lng);Ii&&Zi.draw(h,P.TRIANGLES,Ie,Yt.disabled,G,be,Mi,l.id,Wi,Ki,Ii)}}else if(E){Ie=new Dt(P.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D);const Wi=h.globeSharedBuffers;if(Wi){const[Ki,Ii,ai]=Wi.getGridBuffers(ii,!1);Zi.draw(h,P.TRIANGLES,Ie,de||$e,h.colorModeForRenderPass(),be,Mi,l.id,Ki,Ii,ai)}}else{const{tileBoundsBuffer:Wi,tileBoundsIndexBuffer:Ki,tileBoundsSegments:Ii}=h.getTileBoundsBuffers(Me);Zi.draw(h,P.TRIANGLES,Ie,$e,G,Zt.disabled,Mi,l.id,Wi,Ki,Ii)}}if(!(z instanceof o.aU)&&E)for(const le of _e){const Te=le.canonical.y===(1<<le.canonical.z)-1;le.canonical.y===0&&Ud(!0,le,h,t,l,B,O,be,de||Yt.disabled),Te&&Ud(!1,le,h,t,l,B,O,be===Zt.frontCW?Zt.backCW:Zt.frontCW,de||Yt.disabled)}};E?we(ne,h.renderElevatedRasterBackface?Zt.backCW:Zt.frontCW,h.stencilModeFor3D()):we(ne,Zt.disabled,void 0),h.resetStencilClippingMasks()},"raster-particle":function(h,t,l,d,g,y){h.renderPass==="offscreen"&&function(x,T,E,L){if(!L.length)return;const P=x.context,z=P.gl,O=T.getSource();if(!(O instanceof is))return;const B=Math.ceil(Math.sqrt(E.paint.get("raster-particle-count")));let G=E.particlePositionRGBAImage;if(!G||G.width!==B){const ne=function(te){const we=te*te,_e=new Uint8Array(4*we),be=function(le){return le|=0,le=Math.imul(2747636419^le,2654435769),le=Math.imul(le^le>>>16,2654435769),((le=Math.imul(le^le>>>16,2654435769))>>>0)/4294967296},de=.9090909090909091;for(let le=0;le<we;le++){const Te=de*(be(2*le+0)+Dc),Me=de*(be(2*le+1)+Dc),Oe=255*Te%1,Ve=255*Me%1,je=Oe,Ye=Me-Ve/255,nt=Ve;_e[4*le+0]=255*(Te-Oe/255),_e[4*le+1]=255*je,_e[4*le+2]=255*Ye,_e[4*le+3]=255*nt}return _e}(B);G=E.particlePositionRGBAImage=new o.q({width:B,height:B},ne)}let V=E.particleFramebuffer;V?V.width!==B&&(V.destroy(),V=E.particleFramebuffer=P.createFramebuffer(B,B,1,null)):V=E.particleFramebuffer=P.createFramebuffer(B,B,1,null);const W=[];for(const ne of L){const te=T.getTile(ne);if(!(te instanceof rd))continue;const we=pm(te,O,E);if(!we)continue;const _e=[te.tileSize,te.tileSize];let be=E.tileFramebuffer;be||(be=E.tileFramebuffer=P.createFramebuffer(_e[0],_e[1],1,null));let de=te.rasterParticleState;de||(de=te.rasterParticleState=new Dy(P,ne,_e,G));const le=de.update(E.lastInvalidatedAt);de.particleTextureDimension!==B&&de.updateParticleTexture(ne,G);const Te=de.targetColorTexture;de.targetColorTexture=de.backgroundColorTexture,de.backgroundColorTexture=Te;const Me=de.particleTexture0;de.particleTexture0=de.particleTexture1,de.particleTexture1=Me,W.push([ne,we,de,le])}if(W.length===0)return;const Y=o.o.now(),se=E.previousDrawTimestamp?.001*(Y-E.previousDrawTimestamp):.0167;if(E.previousDrawTimestamp=Y,E.hasColorMap()){P.activeTexture.set(z.TEXTURE0+2);let ne=E.colorRampTexture;ne||(ne=E.colorRampTexture=new o.T(P,E.colorRamp,z.RGBA8)),ne.bind(z.LINEAR,z.CLAMP_TO_EDGE)}P.bindFramebuffer.set(E.tileFramebuffer.framebuffer),function(ne,te,we){const _e=ne.context,be=_e.gl,de=te.tileFramebuffer;_e.activeTexture.set(be.TEXTURE0);const le={u_texture:0,u_opacity:1.05*(Me=te.paint.get("raster-particle-fade-opacity-factor"))/(Me+.05)},Te=ne.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Me;for(const Oe of we){const[,,Ve,je]=Oe;de.colorAttachment0.set(Ve.targetColorTexture.texture),_e.viewport.set([0,0,de.width,de.height]),_e.clear({color:o.ao.transparent}),je&&(Ve.backgroundColorTexture.bind(be.NEAREST,be.CLAMP_TO_EDGE),Te.draw(ne,be.TRIANGLES,Dt.disabled,Yt.disabled,ri.alphaBlended,Zt.disabled,le,te.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments))}}(x,E,W),function(ne,te,we,_e){const be=ne.context,de=be.gl,le=we.tileFramebuffer,Te=ne.transform.projection.name==="globe",Me=we.paint.get("raster-particle-max-speed");for(const Oe of _e){const[Ve,je,Ye]=Oe;be.activeTexture.set(de.TEXTURE0+0),je.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE),le.colorAttachment0.set(Ye.targetColorTexture.texture);const nt=ne.getOrCreateProgram("rasterParticleDraw",{defines:je.defines,overrideFog:!1});be.activeTexture.set(de.TEXTURE0+1);const Fe=je.scalarData?[]:[0,1,2,3].map($e=>o.e9[$e](Ve));Fe.push(Ve);const Ie=Ve.canonical.x,Xe=Ve.canonical.y;for(const $e of Fe){const ot=te.getTile(Te?$e.wrapped():$e);if(!ot)continue;const ht=ot.rasterParticleState;if(!ht)continue;const yt=$e.canonical.x+(1<<$e.canonical.z)*($e.wrap-Ve.wrap),dt=$e.canonical.y;ht.particleTexture0.bind(de.NEAREST,de.CLAMP_TO_EDGE);const pt=Ty(1,ht.particleTexture0.size[0],[yt-Ie,dt-Xe],0,je.texture.size,2,Me,je.textureOffset,je.scale,je.offset);nt.draw(ne,de.POINTS,Dt.disabled,Yt.disabled,ri.alphaBlended,Zt.disabled,pt,we.id,ht.particleIndexBuffer,void 0,ht.particleSegment)}}}(x,T,E,W),P.bindFramebuffer.set(E.particleFramebuffer.framebuffer),function(ne,te,we,_e){const be=ne.context,de=be.gl,le=te.paint.get("raster-particle-max-speed"),Te=_e*te.paint.get("raster-particle-speed-factor")*.15,Me=function(Ve){return Math.pow(Ve,6)}(.01+1*te.paint.get("raster-particle-reset-rate-factor")),Oe=te.particleFramebuffer;be.viewport.set([0,0,Oe.width,Oe.height]);for(const Ve of we){const[,je,Ye]=Ve;be.activeTexture.set(de.TEXTURE0+0),je.texture.bind(de.LINEAR,de.CLAMP_TO_EDGE),be.activeTexture.set(de.TEXTURE0+1);const nt=Ye.particleTexture0;nt.bind(de.NEAREST,de.CLAMP_TO_EDGE);const Fe=A1(1,nt.size[0],0,je.texture.size,le,Te,Me,je.textureOffset,je.scale,je.offset);Oe.colorAttachment0.set(Ye.particleTexture1.texture),be.clear({color:o.ao.transparent}),ne.getOrCreateProgram("rasterParticleUpdate",{defines:je.defines}).draw(ne,de.TRIANGLES,Dt.disabled,Yt.disabled,ri.unblended,Zt.disabled,Fe,te.id,ne.viewportBuffer,ne.quadTriangleIndexBuffer,ne.viewportSegments)}}(x,E,W,se)}(h,t,l,d),h.renderPass==="translucent"&&(function(x,T,E,L){const P=x.context,z=P.gl,O=T.getSource().tileSize,B=5*(1-o.ah(o.cL,o.cL+1,x.transform.zoom))*O+E.paint.get("raster-particle-elevation"),G=!x.options.moving,V=x.transform.projection.name==="globe";if(!L.length)return;const[W,Y]=x.stencilConfigForOverlap(L),se=[];V&&se.push("PROJECTION_GLOBE_VIEW");const ne=x.stencilModeFor3D();for(const te of Y){const we=te.toUnwrapped(),_e=T.getTile(te);if(!_e.rasterParticleState)continue;const be=_e.rasterParticleState,de=100;_e.registerFadeDuration(de);const le=T.findLoadedParent(te,0),Te=eh(_e,le,T,x.transform,de);let Me,Oe;x.terrain&&x.terrain.prepareDrawTile(),P.activeTexture.set(z.TEXTURE0),be.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),P.activeTexture.set(z.TEXTURE1),le&&le.rasterParticleState?(le.rasterParticleState.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Me=Math.pow(2,le.tileID.overscaledZ-_e.tileID.overscaledZ),Oe=[_e.tileID.canonical.x*Me%1,_e.tileID.canonical.y*Me%1]):be.targetColorTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE);const Ve=V?Float32Array.from(x.transform.expandedFarZProjMatrix):x.transform.calculateProjMatrix(we,G),je=x.transform,Ye=Oy(je),nt=o.dG(te.canonical),Fe=o.dH(nt.getCenter().lat);let Ie,Xe,$e,ot,ht;V?(Ie=Float32Array.from(o.bk(o.dJ(te.canonical))),Xe=Float32Array.from(je.globeMatrix),$e=Float32Array.from(o.dF(je)),ot=[o.aF(je.center.lng),o.aJ(je.center.lat)],ht=Float32Array.from(o.dI(te.canonical,nt,Fe,je.worldSize/je._pixelsPerMercatorPixel))):(Ie=new Float32Array(16),Xe=new Float32Array(9),$e=new Float32Array(16),ot=[0,0],ht=new Float32Array(9));const yt=I1(Ve,Ie,Xe,$e,ht,Oe||[0,0],o.aj(x.transform.zoom),ot,Ye,Me||1,Te,B),dt=x.isTileAffectedByFog(te),pt=x.getOrCreateProgram("rasterParticle",{defines:se,overrideFog:dt});if(x.uploadCommonUniforms(P,pt,we),V){const Mt=new Dt(z.LEQUAL,Dt.ReadOnly,x.depthRangeFor3D),Lt=0,bt=x.globeSharedBuffers;if(bt){const[kt,jt,Xt]=bt.getGridBuffers(Fe,Lt!==0);pt.draw(x,z.TRIANGLES,Mt,ne,ri.alphaBlended,x.renderElevatedRasterBackface?Zt.frontCCW:Zt.backCCW,yt,E.id,kt,jt,Xt)}}else{const Mt=x.depthModeForSublayer(0,Dt.ReadOnly),Lt=W[te.overscaledZ],{tileBoundsBuffer:bt,tileBoundsIndexBuffer:kt,tileBoundsSegments:jt}=x.getTileBoundsBuffers(_e);pt.draw(x,z.TRIANGLES,Mt,Lt,ri.alphaBlended,Zt.disabled,yt,E.id,bt,kt,jt)}}x.resetStencilClippingMasks()}(h,t,l,d),h.style.map.triggerRepaint())},background:function(h,t,l,d){const g=l.paint.get("background-color"),y=l.paint.get("background-color-use-theme").constantOr("default")==="none",x=l.paint.get("background-opacity"),T=l.paint.get("background-emissive-strength"),E=l.paint.get("background-pitch-alignment")==="viewport";if(x===0)return;const L=h.context,P=L.gl,z=h.transform,O=z.tileSize,B=l.paint.get("background-pattern");let G;if(B!==void 0&&(B===null||(G=h.imageManager.getPattern(o.I.from(B.toString()),l.scope,h.style.getLut(l.scope)),!G)))return;const V=!B&&g.a===1&&x===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==V)return;const W=Yt.disabled,Y=h.depthModeForSublayer(0,V==="opaque"?Dt.ReadWrite:Dt.ReadOnly),se=h.colorModeForDrapableLayerRenderPass(T),ne=B?"backgroundPattern":"background";let te,we=d;we||(te=h.getBackgroundTiles(),we=Object.values(te).map(be=>be.tileID)),B&&(L.activeTexture.set(P.TEXTURE0),h.imageManager.bind(h.context,l.scope));const _e=[];if(h.terrain&&h.terrain.renderingToTexture&&h.emissiveMode==="mrt-fallback"&&_e.push("USE_MRT1"),E){const be=h.getOrCreateProgram(ne,{overrideFog:!1,overrideRtt:!0,defines:_e}),de=new Float32Array(o.bA([])),le=new o.aQ(0,0,0,0,0),Te=B?rh(de,T,x,h,0,l.scope,G,E,{tileID:le,tileSize:O}):dl(de,T,x,g.toPremultipliedRenderColor(y?null:l.lut));return void be.draw(h,P.TRIANGLES,Y,W,se,Zt.disabled,Te,l.id,h.viewportBuffer,h.quadTriangleIndexBuffer,h.viewportSegments)}for(const be of we){const de=h.isTileAffectedByFog(be),le=h.getOrCreateProgram(ne,{overrideFog:de,defines:_e}),Te=be.toUnwrapped(),Me=d?be.projMatrix:h.transform.calculateProjMatrix(Te);h.prepareDrawTile();const Oe=t?t.getTile(be):te?te[be.key]:new tl(be,O,z.zoom,h),Ve=B?rh(Me,T,x,h,0,l.scope,G,E,{tileID:be,tileSize:O}):dl(Me,T,x,g.toPremultipliedRenderColor(y?null:l.lut));h.uploadCommonUniforms(L,le,Te);const{tileBoundsBuffer:je,tileBoundsIndexBuffer:Ye,tileBoundsSegments:nt}=h.getTileBoundsBuffers(Oe);le.draw(h,P.TRIANGLES,Y,W,se,Zt.disabled,Ve,l.id,je,Ye,nt)}},sky:function(h,t,l){const d=h._atmosphere?o.aj(h.transform.zoom):1,g=l.paint.get("sky-opacity")*d;if(g===0)return;const y=h.context,x=l.paint.get("sky-type"),T=new Dt(y.gl.LEQUAL,Dt.ReadOnly,[0,1]),E=h.frameCounter/1e3%1;x==="atmosphere"?h.renderPass==="offscreen"?l.needsSkyboxCapture(h)&&(function(L,P){const z=L.context,O=z.gl;let B=P.skyboxFbo;if(!B){B=P.skyboxFbo=z.createFramebuffer(32,32,1,null),P.skyboxGeometry=new ws(z),P.skyboxTexture=z.gl.createTexture(),O.bindTexture(O.TEXTURE_CUBE_MAP,P.skyboxTexture),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_S,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_WRAP_T,O.CLAMP_TO_EDGE),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MIN_FILTER,O.LINEAR),O.texParameteri(O.TEXTURE_CUBE_MAP,O.TEXTURE_MAG_FILTER,O.LINEAR);for(let Y=0;Y<6;++Y)O.texImage2D(O.TEXTURE_CUBE_MAP_POSITIVE_X+Y,0,O.RGBA,32,32,0,O.RGBA,O.UNSIGNED_BYTE,null)}z.bindFramebuffer.set(B.framebuffer),z.viewport.set([0,0,32,32]);const G=P.getCenter(L,!0),V=L.getOrCreateProgram("skyboxCapture"),W=new Float64Array(16);o.bA(W),o.en(W,W,.5*-Math.PI),ml(L,P,V,W,G,0),o.bA(W),o.en(W,W,.5*Math.PI),ml(L,P,V,W,G,1),o.bA(W),o.cU(W,W,.5*-Math.PI),ml(L,P,V,W,G,2),o.bA(W),o.cU(W,W,.5*Math.PI),ml(L,P,V,W,G,3),o.bA(W),ml(L,P,V,W,G,4),o.bA(W),o.en(W,W,Math.PI),ml(L,P,V,W,G,5),z.viewport.set([0,0,L.width,L.height])}(h,l),l.markSkyboxValid(h)):h.renderPass==="sky"&&function(L,P,z,O,B){const G=L.context,V=G.gl,W=L.transform,Y=L.getOrCreateProgram("skybox");G.activeTexture.set(V.TEXTURE0),V.bindTexture(V.TEXTURE_CUBE_MAP,P.skyboxTexture);const se=((ne,te,we,_e,be)=>({u_matrix:ne,u_sun_direction:te,u_cubemap:0,u_opacity:_e,u_temporal_offset:be}))(W.skyboxMatrix,P.getCenter(L,!1),0,O,B);L.uploadCommonUniforms(G,Y),Y.draw(L,V.TRIANGLES,z,Yt.disabled,L.colorModeForRenderPass(),Zt.backCW,se,"skybox",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,l,T,g,E):x==="gradient"&&h.renderPass==="sky"&&function(L,P,z,O,B){const G=L.context,V=G.gl,W=L.transform,Y=L.getOrCreateProgram("skyboxGradient");P.skyboxGeometry||(P.skyboxGeometry=new ws(G)),G.activeTexture.set(V.TEXTURE0);let se=P.colorRampTexture;se||(se=P.colorRampTexture=new o.T(G,P.colorRamp,V.RGBA8)),se.bind(V.LINEAR,V.CLAMP_TO_EDGE);const ne=((te,we,_e,be,de)=>({u_matrix:te,u_color_ramp:0,u_center_direction:we,u_radius:o.an(_e),u_opacity:be,u_temporal_offset:de}))(W.skyboxMatrix,P.getCenter(L,!1),P.paint.get("sky-gradient-radius"),O,B);L.uploadCommonUniforms(G,Y),Y.draw(L,V.TRIANGLES,z,Yt.disabled,L.colorModeForRenderPass(),Zt.backCW,ne,"skyboxGradient",P.skyboxGeometry.vertexBuffer,P.skyboxGeometry.indexBuffer,P.skyboxGeometry.segment)}(h,l,T,g,E)},custom:function(h,t,l,d){const g=h.context,y=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||h.renderPass==="offscreen")&&l.isDraped(t)){if(h.renderPass==="offscreen"){const x=y.prerender;if(x){if(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;x.call(y,g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),o.aj(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else x.call(y,g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState()}}else if(h.renderPass==="translucent"){if(h.terrain&&h.terrain.renderingToTexture){const T=y.renderToTile;if(T){const E=d[0].canonical,L={x:E.x+d[0].wrap*(y.wrapTileId?0:1<<E.z),y:E.y,z:E.z};g.setDepthMode(Dt.disabled),g.setStencilMode(Yt.disabled),g.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),T.call(y,g.gl,L),g.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(Yt.disabled);const x=y.renderingMode==="3d"?new Dt(h.context.gl.LEQUAL,Dt.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,Dt.ReadOnly);if(g.setDepthMode(x),h.transform.projection.name==="globe"){const T=h.transform.pointMerc;y.render(g.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),o.aj(h.transform.zoom),[T.x,T.y],h.transform.pixelsPerMeterRatio)}else y.render(g.gl,h.transform.customLayerMatrix());g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(h,t,l,d){if(h.renderPass==="opaque")return;const g=l.paint.get("model-opacity").constantOr(1),y=l.paint.get("model-elevation-reference"),x=y==="ground",T=y==="ground";if(g===0)return;const E=l.paint.get("model-cast-shadows");if(h.renderPass==="shadow"&&(!E||h.terrain&&g<.65&&l._transitionablePaint._values["model-opacity"].value.expression instanceof o.ad))return;const L=h.shadowRenderer,P=l.paint.get("model-receive-shadows");L&&(L.useNormalOffset=!0,P||(L.enabled=!1));const z=()=>{L&&(L.useNormalOffset=!0,P||(L.enabled=!0))},O=t.getSource();if(h.renderPass==="light-beam"&&O.type!=="batched-model")return;if(O.type==="vector"||O.type==="geojson")return function(te,we,_e,be,de){const le=te.transform,Te=le.projection.name==="globe",Me=le.getFreeCameraOptions().position;if(!te.modelManager)return;const Oe=te.modelManager;_e.modelManager=Oe;const Ve=te.shadowRenderer;if(!_e._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const je=_e._unevaluatedLayout._values["model-id"],Ye=Object.assign({},_e.layout.get("model-id").parameters),nt=te.style.order.indexOf(_e.fqid),Fe=_e.paint.get("model-opacity").constantOr(1);for(const Ie of be){const Xe=we.getTile(Ie).getBucket(_e);if(!Xe||Xe.projection.name!==le.projection.name)continue;const $e=Xe.getModelUris();if($e&&!Xe.modelsRequested&&(Oe.addModelsFromBucket($e,de),Xe.modelsRequested=!0),Te)Ye.zoom=Ie.overscaledZ;else{const bt=ft(Ie,le);Ye.zoom=bt}const ot=je.possiblyEvaluate(Ye);if(Gl(te,Xe,Ie),os.shadowUniformsInitialized=!1,os.useSingleShadowCascade=!!Ve&&Ve.getMaxCascadeForTile(Ie.toUnwrapped())===0,te.renderPass==="shadow"&&Ve){if(te.currentShadowCascade===1&&Xe.isInsideFirstShadowMapFrustum)continue;const bt=le.calculatePosMatrix(Ie.toUnwrapped(),le.worldSize);if(os.tileMatrix.set(bt),os.shadowTileMatrix=Float32Array.from(Ve.calculateShadowPassMatrixFromMatrix(bt)),os.aabb.min=[0,0,0],os.aabb.max[0]=os.aabb.max[1]=o.al,os.aabb.max[2]=0,Cr(Xe,os,te,_e.scope))continue}const ht=1<<Ie.canonical.z,yt=[((Me.x-Ie.wrap)*ht-Ie.canonical.x)*o.al,(Me.y*ht-Ie.canonical.y)*o.al,Me.z*ht*o.al];te.conflationActive&&Object.keys(Xe.instancesPerModel).length>0&&te.style.isLayerClipped(_e,we.getSource())&&Xe.updateReplacement(Ie,te.replacementSource,nt,_e.scope)&&(Xe.uploaded=!1,Xe.upload(te.context));let dt=0;const pt=new Array,Mt=new Array,Lt=new Array;for(let bt in Xe.instancesPerModel){const kt=Xe.instancesPerModel[bt];kt.features.length>0&&!Te&&(bt=ot.evaluate(kt.features[0].feature,{}));const jt=Oe.getModel(bt,de);if(jt||Oe.hasURLBeenRequested(bt)||Xe.modelUris.includes(bt)||(Xe.modelUris.push(bt),Xe.modelsRequested=!1),jt&&jt.uploaded)if(Te){const Xt=o.c5([],[Me.x,Me.y,Me.z],te.transform.worldSize);o.ew(Xt,Xt);for(let ci=0;ci<kt.instancedDataArray.length;++ci){const Ti=[0,0,0],ii=[1,1,1],Mi=o.ex(),ni=kt.tileCoordinatesForInstance(ci),Zi=kt.transformForInstance(ci);o.ey(ii,Zi),o.ez(Mi,Zi),o.eA(Ti,Mi);const Wi=kt.translationForInstance(ci),Ki=new o.aT(0,0);o.eB(Xe.canonical,Ki,ni.x,ni.y);const Ii=o.bC();o.eC(Ii,jt,te.transform,Ki,Ti,ii,Wi,!0,!1,!1);const ai=kt.colorForInstance(ci),ji=o.bA([]),br=o.ef(Ki.lat,te.transform.zoom),wr=o.bq([],[1,1,1/br]);o.br(ji,ji,Xt),Lt.push({zScaleMatrix:wr,negCameraPosMatrix:ji});for(const Ni of jt.nodes)ah(te,Ni,Ii,te.transform.expandedFarZProjMatrix,dt,pt,Mt,jt.materialOverrides,Fe,ai);++dt}}else for(const Xt of jt.nodes)vt(te,_e,Xt,kt,yt,Ie,os)}if(Te)if(te.renderPass==="shadow"){for(const bt of Mt)Fc(bt.mesh,bt.nodeModelMatrix,te,_e);for(const bt of pt)Fc(bt.mesh,bt.nodeModelMatrix,te,_e)}else Sm(te,_e,pt,Mt,Lt)}}(h,t,l,d,oh(h,l)),void z();if(!O.loaded())return;if(O.type==="batched-model")return function(te,we,_e,be){_e.resetLayerRenderingStats(te);const de=te.context,le=te.transform,Te=te.style.fog,Me=te.shadowRenderer;if(le.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${le.projection.name} projection is not yet implemented`);const Oe=te.transform.getFreeCameraOptions().position,Ve=o.c5([],[Oe.x,Oe.y,Oe.z],te.transform.worldSize),je=o.ew([],Ve),Ye=o.bA([]),nt=o.ef(le.center.lat,le.zoom),Fe=o.bq([],[1,1,1/nt]);o.br(Ye,Ye,je);const Ie=_e.paint.get("model-opacity").constantOr(1),Xe=new Dt(de.gl.LEQUAL,Dt.ReadWrite,te.depthRangeFor3D),$e=new Dt(de.gl.LEQUAL,Dt.ReadOnly,te.depthRangeFor3D),ot=new o.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ht=te.renderPass==="shadow",yt=ht&&Me?Me.getCurrentCascadeFrustum():le.getFrustum(le.scaleZoom(le.worldSize)),dt=_e.paint.get("model-front-cutoff"),pt=dt[2]<1,Mt=xo(te,_e.paint.get("model-cutoff-fade-range")),Lt=_e.getLayerRenderingStats();(function(bt,kt,jt,Xt){const ci=bt.terrain?bt.terrain.exaggeration():0,Ti=bt.transform.zoom;for(const ii of Xt){const Mi=kt.getTile(ii).getBucket(jt);Mi&&(Mi.setFilter(jt.filter),bt.conflationActive&&Mi.updateReplacement(ii,bt.replacementSource),Mi.evaluateTransform(bt,jt),bt.terrain&&ci>0&&Mi.elevationUpdate(bt.terrain,ci,ii,jt.source),Mi.needsReEvaluation(bt,Ti,jt)&&Mi.evaluate(jt))}})(te,we,_e,be),function(){let bt,kt,jt;pt?(bt=be.length-1,kt=-1,jt=-1):(bt=0,kt=be.length,jt=1);const Xt=new Float64Array(16),ci=o.cA(),Ti=new o.P(0,0);for(let ii=bt;ii!==kt;ii+=jt){const Mi=be[ii],ni=we.getTile(Mi).getBucket(_e);if(!ni||!ni.uploaded)continue;let Zi=!1;Me&&(Zi=Me.getMaxCascadeForTile(Mi.toUnwrapped())===0);const Wi=le.calculatePosMatrix(Mi.toUnwrapped(),le.worldSize),Ki=ni.modelTraits;!ht&&pt&&(o.bl(Xt,Wi),o.af(ci,Ve,Xt),Ti.x=ci[0],Ti.y=ci[1]);const Ii=[];ni.setFilter(_e.filter);for(const ai of ni.getNodesInfo()){if(ai.hiddenByReplacement||!ai.node.meshes)continue;const ji=ai.node;let br=0;te.terrain&&ji.elevation&&(br=ji.elevation*te.terrain.exaggeration());const wr=(()=>{const Ui=ai.aabb;return ot.min=[...Ui.min],ot.max=[...Ui.max],ot.min[2]+=br,ot.max[2]+=br,o.af(ot.min,ot.min,Wi),o.af(ot.max,ot.max,Wi),ot})(),Ni=ai.evaluatedScale;if(Ni[0]<=1&&Ni[1]<=1&&Ni[2]<=1&&wr.intersects(yt)===0)continue;if(!ht&&pt){const Ui=.16666666666666666;ai.cameraCollisionOpacity=Ve[0]>wr.min[0]&&Ve[0]<wr.max[0]&&Ve[1]>wr.min[1]&&Ve[1]<wr.max[1]&&Ve[2]*nt<wr.max[2]&&ji.footprint&&o.c0(Ti,ji.footprint)?Math.max(ai.cameraCollisionOpacity-Ui,0):Math.min(1,ai.cameraCollisionOpacity+Ui)}const xi=[...Wi],li=1/o.d7(Mi.canonical),nr=ji.anchor?ji.anchor[0]:0,kr=ji.anchor?ji.anchor[1]:0;o.br(xi,xi,[nr*(Ni[0]-1)+ai.evaluatedTranslation[0]*li,kr*(Ni[1]-1)+ai.evaluatedTranslation[1]*li,br+ai.evaluatedTranslation[2]]),o.cq(Ni,o.eE)||o.cS(xi,xi,Ni);const cr=o.aB([],xi,ji.globalMatrix),dr=o.aB([],le.expandedFarZProjMatrix,cr),ls=o.aB([],le.expandedFarZProjMatrix,xi),Ss=o.aC([],[nr,kr,br,1],dr)[2];ji.hidden=!1;let fn=Ie;ht||(pt&&(fn*=ai.cameraCollisionOpacity,fn*=Vy(xi,le,ai.aabb,dt)),fn*=ze(Mt,Ss)),fn!==0?Ii.push({nodeInfo:ai,depth:Ss,opacity:fn,wvpForNode:dr,wvpForTile:ls,nodeModelMatrix:cr,tileModelMatrix:xi}):ji.hidden=!0}ht||Ii.sort((ai,ji)=>!pt||ai.opacity===1&&ji.opacity===1?ai.depth<ji.depth?-1:1:ai.opacity===1?-1:ji.opacity===1?1:ai.depth>ji.depth?-1:1);for(const ai of Ii){const ji=ai.nodeInfo,br=ji.node;let wr=o.aB([],Fe,ai.tileModelMatrix);o.aB(wr,Ye,wr);const Ni=o.bl([],wr);o.eg(Ni,Ni),o.cS(Ni,Ni,jc),wr=o.aB(wr,wr,br.globalMatrix);const xi=te.renderPass==="light-beam",li=_e.paint.get("model-color-use-theme").constantOr("default")==="none",nr=Ki&o.eI.HasMapboxMeshFeatures,kr=nr?0:ji.evaluatedRMEA[0][2];for(let cr=0;cr<br.meshes.length;++cr){const dr=br.meshes[cr],ls=cr===br.lightMeshIndex;let Ss=ai.wvpForNode;if(ls){if(!xi&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}Ss=ai.wvpForTile}else if(xi)continue;const fn={defines:[]},Ui=[];if(!ht&&Me&&(Me.useNormalOffset=!!dr.normalBuffer),jo(fn.defines,Ui,dr,te,li?null:_e.lut),nr||fn.defines.push("DIFFUSE_SHADED"),Zi&&fn.defines.push("SHADOWS_SINGLE_CASCADE"),Lt&&(ht?Lt.numRenderedVerticesInShadowPass+=dr.vertexArray.length:Lt.numRenderedVerticesInTransparentPass+=dr.vertexArray.length),ht){Fc(dr,ai.nodeModelMatrix,te,_e);continue}let Bs=null;if(Te){const Ur=wm(ai.nodeModelMatrix,te.transform);if(Bs=new Float32Array(Ur),le.projection.name!=="globe"){const ur=dr.aabb.min,Hr=dr.aabb.max,[Fn,Br]=Te.getOpacityForBounds(Ur,ur[0],ur[1],Hr[0],Hr[1]);fn.overrideFog=Fn>=At||Br>=At}}const Dn=dr.material;let cs;Dn.occlusionTexture&&Dn.occlusionTexture.offsetScale&&(cs=Dn.occlusionTexture.offsetScale,fn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const So=te.getOrCreateProgram("model",fn);!ht&&Me&&Me.setupShadowsFromMatrix(ai.tileModelMatrix,So,Me.useNormalOffset),te.uploadCommonUniforms(de,So,null,Bs);const us=Dn.pbrMetallicRoughness;us.metallicFactor=.9,us.roughnessFactor=.5;const Tr=Od(new Float32Array(Ss),new Float32Array(wr),new Float32Array(Ni),new Float32Array(br.globalMatrix),te,ai.opacity,us.baseColorFactor,Dn.emissiveFactor,us.metallicFactor,us.roughnessFactor,Dn,kr,_e,[0,0,0],cs);!ls&&(ji.hasTranslucentParts||ai.opacity<1)&&So.draw(te,de.gl.TRIANGLES,Xe,Yt.disabled,ri.disabled,Zt.backCCW,Tr,_e.id,dr.vertexBuffer,dr.indexBuffer,dr.segments,_e.paint,te.transform.zoom,void 0,Ui),So.draw(te,de.gl.TRIANGLES,ls?$e:Xe,Yt.disabled,ls||ai.opacity<1||ji.hasTranslucentParts?ri.alphaBlended:ri.unblended,Zt.backCCW,Tr,_e.id,dr.vertexBuffer,dr.indexBuffer,dr.segments,_e.paint,te.transform.zoom,void 0,Ui)}}}}()}(h,t,l,d),void z();if(O.type!=="model")return;const B=O.getModels(),G=[],V=h.transform.getFreeCameraOptions().position,W=o.c5([],[V.x,V.y,V.z],h.transform.worldSize);o.ew(W,W);const Y=[],se=[];let ne=0;for(const te of B){const we=t.getFeatureState("",te.id),_e={type:"Unknown",id:te.id,properties:te.featureProperties},be=l.paint.get("model-rotation").evaluate(_e,we),de=l.paint.get("model-scale").evaluate(_e,we),le=l.paint.get("model-translation").evaluate(_e,we),Te=l.paint.get("model-opacity").evaluate(_e,we);Ny(l,te.id,we,te.featureProperties,te.nodeOverrideNames,te.nodeOverrides),Uy(l,te.id,we,te.featureProperties,te.materialOverrideNames,te.materialOverrides),te.nodeOverrides.size>0&&te.computeBoundsAndApplyParent(),te.computeModelMatrix(h,be,de,le,T,x,!1);const Me=o.bA([]),Oe=o.ef(te.position.lat,h.transform.zoom),Ve=o.bq([],[1,1,1/Oe]);o.br(Me,Me,W),G.push({zScaleMatrix:Ve,negCameraPosMatrix:Me});for(const je of te.nodes)ah(h,je,te.matrix,h.transform.expandedFarZProjMatrix,ne,Y,se,te.materialOverrides,Te);ne++}if(Y.sort((te,we)=>we.depth-te.depth),h.renderPass!=="shadow")Sm(h,l,Y,se,G),z();else{for(const te of se)Fc(te.mesh,te.nodeModelMatrix,h,l);for(const te of Y)Fc(te.mesh,te.nodeModelMatrix,h,l);z()}}},km={line:function(h,t,l){if(h.hasElevatedBuckets=!1,h.hasNonElevatedBuckets=!1,h._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||h._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(t){const d=t.getVisibleCoordinates();for(const g of d){const y=t.getTile(g).getBucket(h);if(y&&(y.elevationType!=="none"?h.hasElevatedBuckets=!0:h.hasNonElevatedBuckets=!0,h.hasElevatedBuckets&&h.hasNonElevatedBuckets))break}}}else h.hasNonElevatedBuckets=!0},model:function(h,t,l){const d=t.getSource();if(!d.loaded())return;if(d.type==="vector"||d.type==="geojson")return void(l.modelManager&&l.modelManager.upload(l,oh(l,h)));if(d.type==="batched-model"||d.type!=="model")return;const g=d.getModels();for(const y of g)y.upload(l.context)},raster:function(h,t,l){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-array-band")||d.getInitialBand(g);if(y==null)return;const x=t.getIds().map(T=>t.getTileByID(T));for(const T of x)T.updateNeeded(h.id,y)&&d.prepareTile(T,g,h.id,y)},"raster-particle":function(h,t,l){const d=t.getSource();if(!(d instanceof is&&d.loaded()))return;const g=h.sourceLayer||d.rasterLayerIds&&d.rasterLayerIds[0];if(!g)return;const y=h.paint.get("raster-particle-array-band")||d.getInitialBand(g);if(y==null)return;const x=t.getIds().map(T=>t.getTileByID(T));for(const T of x)T.updateNeeded(h.id,y)&&d.prepareTile(T,g,h.id,y)}},Lm={fill:um},Hy={fill:function(h,t,l,d){if(!l.layout||l.layout.get("fill-elevation-reference")==="none"||l.paint.get("fill-opacity").constantOr(1)===0)return;const g=h.context.gl,y=new Dt(g.LEQUAL,Dt.ReadOnly,h.depthRangeFor3D),x=new Yt({func:g.ALWAYS,mask:255},255,255,g.KEEP,g.KEEP,g.REPLACE),T=h.transform.getFreeCameraOptions().position,E=h.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const L of d){const P=t.getTile(L),z=P.getBucket(l);if(!z)continue;const O=z.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;const B=cm(L.toUnwrapped(),T),G=h.translatePosMatrix(L.projMatrix,P,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor")),V=Ul(G,B,0,1,0);E.draw(h,g.TRIANGLES,y,x,ri.disabled,Zt.disabled,V,l.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,l.paint,h.transform.zoom)}}};class Wy{constructor(t,l,d,g,y){this.context=new Bd(t,l),this.transform=d,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=o.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const x=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const E of x)this._debugParams.enabledLayers[E]=!0;for(const E of x);this.occlusionParams=new Em,this.setup(),this.numSublayers=gs.maxUnderzooming+gs.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Hu(this),this._wireframeDebugCache=new Tm,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const T=new o.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,T,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=g,this.worldview=y,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(t,l){const d=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(d||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new em(this,t));const g=this._terrain;this.transform.elevation=d?g:null,g.update(t,this.transform,l),this.transform.elevation&&!g.enabled&&(this.transform.elevation=null)}_updateFog(t){const l=t.fog;if(!l||this.transform.projection.name==="globe"||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[d,g]=l.getFovAdjustedRange(this.transform._fov);if(d>g)return void(this.transform.fogCullDistSq=null);const y=d+.78*(g-d);this.transform.fogCullDistSq=y*y}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(t){t&&!this._terrain&&(this._terrain=new em(this,this.style)),this._forceTerrainMode=t}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,l){if(this.width=t*o.o.devicePixelRatio,this.height=l*o.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const d of this.style.order)this.style._mergedLayers[d].resize()}setup(){const t=this.context,l=new o.bd;l.emplaceBack(0,0),l.emplaceBack(o.al,0),l.emplaceBack(0,o.al),l.emplaceBack(o.al,o.al),this.tileExtentBuffer=t.createVertexBuffer(l,o.bf.members),this.tileExtentSegments=o.bg.simpleSegment(0,0,4,2);const d=new o.bd;d.emplaceBack(0,0),d.emplaceBack(o.al,0),d.emplaceBack(0,o.al),d.emplaceBack(o.al,o.al),this.debugBuffer=t.createVertexBuffer(d,o.bf.members),this.debugSegments=o.bg.simpleSegment(0,0,4,5);const g=new o.bd;g.emplaceBack(-1,-1),g.emplaceBack(1,-1),g.emplaceBack(-1,1),g.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(g,o.bf.members),this.viewportSegments=o.bg.simpleSegment(0,0,4,2);const y=new o.b1;y.emplaceBack(0,0,0,0),y.emplaceBack(o.al,0,o.al,0),y.emplaceBack(0,o.al,0,o.al),y.emplaceBack(o.al,o.al,o.al,o.al),this.mercatorBoundsBuffer=t.createVertexBuffer(y,o.bi.members),this.mercatorBoundsSegments=o.bg.simpleSegment(0,0,4,2);const x=new o.b0;x.emplaceBack(0,1,2),x.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(x);const T=new o.be;for(const L of[0,1,3,2,0])T.emplaceBack(L);this.debugIndexBuffer=t.createIndexBuffer(T),this.emptyTexture=new o.T(t,new o.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=o.bC();const E=this.context.gl;this.stencilClearMode=new Yt({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const t=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,t.TRIANGLES,Dt.disabled,this.stencilClearMode,ri.disabled,Zt.disabled,Qu(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(t,l,d){if(!l||this.currentStencilSource===l.id||!t.isTileClipped()||!d||d.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let T=!1;for(const E of d)if(this._tileClippingMaskIDs[E.key]===void 0){T=!0;break}if(!T)return}this.currentStencilSource=l.id;const g=this.context,y=g.gl;this.nextStencilID+d.length>256&&this.clearStencil(),g.setColorMode(ri.disabled),g.setDepthMode(Dt.disabled);const x=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const T of d){const E=l.getTile(T),L=this._tileClippingMaskIDs[T.key]=this.nextStencilID++,{tileBoundsBuffer:P,tileBoundsIndexBuffer:z,tileBoundsSegments:O}=this.getTileBoundsBuffers(E);x.draw(this,y.TRIANGLES,Dt.disabled,new Yt({func:y.ALWAYS,mask:0},L,255,y.KEEP,y.KEEP,y.REPLACE),ri.disabled,Zt.disabled,Qu(T.projMatrix),"$clipping",P,z,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const t=this.nextStencilID++,l=this.context.gl;return new Yt({func:l.NOTEQUAL,mask:255},t,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(t){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(t);const l=this.context.gl;return new Yt({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(t){const l=this.context.gl,d=t.sort((x,T)=>T.overscaledZ-x.overscaledZ),g=d[d.length-1].overscaledZ,y=d[0].overscaledZ-g+1;if(y>1){this.currentStencilSource=void 0,this.nextStencilID+y>256&&this.clearStencil();const x={};for(let T=0;T<y;T++)x[T+g]=new Yt({func:l.GEQUAL,mask:255},T+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=y,[x,d]}return[{[g]:Yt.disabled},d]}colorModeForRenderPass(){const t=this.context.gl;return this._showOverdrawInspector?new ri([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new o.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?ri.unblended:ri.alphaBlended}colorModeForDrapableLayerRenderPass(t){const l=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?t!=null&&this.emissiveMode!=="mrt-fallback"||this.emissiveMode==="constant"?new ri([l.ONE,l.ONE_MINUS_SRC_ALPHA,l.CONSTANT_ALPHA,l.ONE_MINUS_SRC_ALPHA],new o.ao(0,0,0,t??0),[!0,!0,!0,!0]):this.emissiveMode==="dual-source-blending"?new ri([l.ONE,l.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,l.ONE_MINUS_SRC_ALPHA],o.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(t,l,d,g=!1){if(this.depthOcclusion)return new Dt(this.context.gl.GREATER,Dt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!g)return Dt.disabled;const y=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Dt(d||this.context.gl.LEQUAL,l,[y,y])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,l=Math.ceil(this.width),d=Math.ceil(this.height),g=this.context.bindFramebuffer.get(),y=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===l&&this.depthFBO.height===d||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),l!==0&&d!==0&&(this.depthFBO=new $l(this.context,l,d,0,"texture"),this.depthTexture=new o.T(this.context,{width:l,height:d,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(g),t.bindTexture(t.TEXTURE_2D,y),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,l,d,0,0,l,d,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((t,l)=>t+l/this._fpsHistory.length,0))}render(t,l){const d=o.o.now();this._dt=d-this._timeStamp,this._timeStamp=d,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=l;const g=this.style._mergedLayers,y=!(!this.terrain||!this.terrain.enabled),x=()=>this.style._getOrder(y).filter(Fe=>{const Ie=g[Fe];return!(Ie.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ie.type]});let T=x(),E=!1,L=!1,P=null,z=0,O=!1;for(const Fe of T){const Ie=g[Fe];Ie.visibility!=="none"&&(Ie.type==="circle"?E=!0:Ie.type==="building"?(P=Ie,++z):Ie.type==="symbol"&&(Ie.hasOcclusionOpacityProperties?L=!0:E=!0))}this.updateEmissiveMode();let B=T.map(Fe=>g[Fe]);const G=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(o.o.now()),this.imageManager.beginFrame();for(const Fe in G){const Ie=G[Fe];Ie.used&&(Ie.prepare(this.context),Ie.getSource().usedInConflation&&++z)}let V=!1;for(const Fe of B)Fe.isHidden(this.transform.zoom)||(Fe.type==="clip"&&(V=!0),this.prepareLayer(Fe));const W={},Y={},se={},ne={},te={};for(const Fe in G){const Ie=G[Fe];W[Fe]=Ie.getVisibleCoordinates(),Y[Fe]=W[Fe].slice().reverse(),se[Fe]=Ie.getVisibleCoordinates(!0).reverse(),ne[Fe]=Ie.getShadowCasterCoordinates(),te[Fe]=Ie.sortCoordinatesByDistance(W[Fe])}const we=Fe=>{const Ie=this.style.getLayerSourceCache(Fe);return Ie&&Ie.used?Ie.getSource():null};if(z||V||this._clippingActiveLastFrame){const Fe=[],Ie=[];let Xe=0;for(const $e of B)this.isSourceForClippingOrConflation($e,we($e))&&(Fe.push($e),Ie.push(Xe)),Xe++;if(Fe&&(V||Fe.length>1)||this._clippingActiveLastFrame){V=!1;const $e=[];for(let ot=0;ot<Fe.length;ot++){const ht=Fe[ot],yt=Ie[ot],dt=this.style.getLayerSourceCache(ht);if(!dt||!dt.used||!dt.getSource().usedInConflation&&ht.type!=="clip"&&ht.type!=="building")continue;let pt=o.eQ,Mt=o.b_.None;const Lt=[];let bt=!0;if(ht.type==="building")pt=o.eS;else if(ht.type==="clip")if(pt=yt,ht.isHidden(this.transform.zoom))bt=!1;else{if(!ht.layout){bt=!1;continue}for(const kt of ht.layout.get("clip-layer-types"))Mt|=kt==="model"?o.b_.Model:kt==="symbol"?o.b_.Symbol:o.b_.FillExtrusion;for(const kt of ht.layout.get("clip-layer-scope"))Lt.push(kt);V=!0}bt&&$e.push({layer:ht.fqid,cache:dt,order:pt,clipMask:Mt,clipScope:Lt})}this.replacementSource.setSources($e),O=!0}}this._clippingActiveLastFrame=V,O||this.replacementSource.clear(),this.conflationActive=O,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let Fe=0;Fe<B.length;Fe++){const Ie=B[Fe];if(Ie.visibility==="none")continue;const Xe=Ie.cutoffRange();if(this.longestCutoffRange=Math.max(Xe,this.longestCutoffRange),Xe>0){const $e=we(Ie);$e&&(this.minCutoffZoom=Math.max($e.minzoom,this.minCutoffZoom)),Ie.minzoom&&(this.minCutoffZoom=Math.max(Ie.minzoom,this.minCutoffZoom))}Ie.is3D(y)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=Fe),this._lastOcclusionLayer=Fe)}const _e=this.style&&this.style.fog;_e?(this._fogVisible=_e.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=_e.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(se),this.opaquePassCutoff=0,T=x(),B=T.map(Fe=>g[Fe]));const be=this._shadowRenderer;if(be){be.updateShadowParameters(this.transform,this.style.directionalLight);for(const Fe in G)for(const Ie of W[Fe]){let Xe={min:0,max:0};this.terrain&&(Xe=this.terrain.getMinMaxForTile(Ie)||Xe),be.addShadowReceiver(Ie.toUnwrapped(),Xe.min,Xe.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new xm(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const de=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),le=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(de&&!this._snow&&(this._snow=new ch(this)),!de&&this._snow&&(this._snow.destroy(),delete this._snow),le&&!this._rain&&(this._rain=new Gy(this)),!le&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),P){this.buildingTileBorderManager||(this.buildingTileBorderManager=new bm);const Fe=this.style.getLayerSourceCache(P);this.buildingTileBorderManager.updateBorders(Fe,P)}if(!Qo.has(this.context.gl))return;this.renderPass="offscreen";for(const Fe of B){const Ie=t.getLayerSourceCache(Fe);if(!Fe.hasOffscreenPass()||Fe.isHidden(this.transform.zoom))continue;const Xe=Ie?Y[Ie.id]:void 0;(Fe.type==="custom"||Fe.type==="raster"||Fe.type==="raster-particle"||Fe.isSky()||Xe&&Xe.length)&&this.renderLayer(this,Ie,Fe,Xe)}this.depthRangeFor3D=[0,1-(B.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ne)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Te=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Me=(()=>{if(l.showOverdrawInspector)return o.ao.black;const Fe=this.style.fog;if(Fe&&this.transform.projection.supportsFog){const Ie=this.style.getLut(Fe.scope);if(!Te){const Xe=Fe.properties.get("color-use-theme")==="none",$e=Fe.properties.get("color").toNonPremultipliedRenderColor(Xe?null:Ie).toArray01();return new o.ao(...$e)}if(Te){const Xe=Fe.properties.get("space-color-use-theme")==="none",$e=Fe.properties.get("space-color").toNonPremultipliedRenderColor(Xe?null:Ie).toArray01();return new o.ao(...$e)}}return o.ao.transparent})();if(this.context.clear({color:Me,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=T.length-1;this.currentLayer>=0;this.currentLayer--){const Fe=B[this.currentLayer],Ie=t.getLayerSourceCache(Fe);if(Fe.isSky())continue;const Xe=Ie?(Fe.is3D(y)?te:Y)[Ie.id]:void 0;this._renderTileClippingMasks(Fe,Ie,Xe),this.renderLayer(this,Ie,Fe,Xe)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Te&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<T.length;this.currentLayer++){const Fe=B[this.currentLayer],Ie=t.getLayerSourceCache(Fe);Fe.isSky()&&this.renderLayer(this,Ie,Fe,Ie?Y[Ie.id]:void 0)}function Oe(Fe,Ie){let Xe;return Ie&&(Xe=(Fe.type==="symbol"?se:Fe.is3D(y)?te:Y)[Ie.id]),Xe}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<T.length;){const Fe=B[this.currentLayer];if(Fe.type==="raster"||Fe.type==="raster-particle"){const Ie=t.getLayerSourceCache(Fe);this.renderLayer(this,Ie,Fe,Oe(Fe,Ie))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;const Ve=be?be.getGroundShadowLayerIndex():-1;let je=!1,Ye=-1;for(let Fe=0;Fe<T.length;++Fe){const Ie=B[Fe];Ie.isHidden(this.transform.zoom)||Ie.is3D(y)&&(Ye=Fe)}L&&Ye===-1&&(E=!0);let nt=!1;for(;this.currentLayer<T.length;){const Fe=B[this.currentLayer],Ie=t.getLayerSourceCache(Fe);if(Fe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(Fe)){if(Fe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!nt&&Fe.is3D(y)&&!y){const Xe=this.currentLayer,$e=ot=>{for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const ht=B[this.currentLayer];if(Lm[ht.type]){const yt=this.style.getLayerSourceCache(ht);Lm[ht.type](this,yt,ht,Oe(ht,yt),ot)}}};$e("initialize"),$e("reset"),this.currentLayer=Xe,nt=!0}if(E&&!je&&this.terrain&&!this.transform.isOrthographic&&(je=!0,this.blitDepth()),L&&Ye!==-1&&this.currentLayer===Ye+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(Fe,Ie,Ie?W[Ie.id]:void 0),this.renderLayer(this,Ie,Fe,Oe(Fe,Ie)),!this.terrain&&be&&this.currentLayer===Ve){{this.clearStencil(),this.resetStencilClippingMasks();const Xe=this.currentLayer;for(this.currentLayer=0;this.currentLayer<B.length;this.currentLayer++){const $e=B[this.currentLayer];if(Hy[$e.type]){const ot=this.style.getLayerSourceCache($e);Hy[$e.type](this,ot,$e,Oe($e,ot))}}this.currentLayer=Xe}if(be.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Xe=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Xe;this.currentLayer++){const $e=B[this.currentLayer];if(!$e.hasLightBeamPass())continue;const ot=t.getLayerSourceCache($e);this.renderLayer(this,ot,$e,ot?Y[ot.id]:void 0)}this.currentLayer=Xe,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Xe=this.currentLayer;this.depthOcclusion=!0;for(const $e of this.layersWithOcclusionOpacity){this.currentLayer=$e;const ot=B[this.currentLayer],ht=t.getLayerSourceCache(ot),yt=ht?Y[ht.id]:void 0;this.terrain||this._renderTileClippingMasks(ot,ht,ht?W[ht.id]:void 0),this.renderLayer(this,ht,ot,yt)}this.depthOcclusion=!1,this.currentLayer=Xe,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let Fe=null;B.forEach(Ie=>{const Xe=t.getLayerSourceCache(Ie);Xe&&!Ie.isHidden(this.transform.zoom)&&Xe.getVisibleCoordinates().length&&(!Fe||Fe.getSource().maxzoom<Xe.getSource().maxzoom)&&(Fe=Xe)}),Fe&&this.options.showTileBoundaries&&zy(this,Fe,Fe.getVisibleCoordinates(),o.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&zy(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(Fe){const Ie=Fe.transform.padding;By(Fe,Fe.transform.height-(Ie.top||0),3,mm),By(Fe,Ie.bottom||0,3,gm),ym(Fe,Ie.left||0,3,_m),ym(Fe,Fe.transform.width-(Ie.right||0),3,k1);const Xe=Fe.transform.centerPoint;(function($e,ot,ht,yt){Vd($e,ot-1,ht-10,2,20,yt),Vd($e,ot-10,ht-1,20,2,yt)})(Fe,Xe.x,Fe.transform.height-Xe.y,L1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),O||(this.conflationActive=!1)}prepareLayer(t){this.gpuTimingStart(t);const{unsupportedLayers:l}=this.transform.projection,d=!l||!l.includes(t.type);if(km[t.type]&&(d||this.terrain&&t.type==="custom")){const g=this.style.getLayerSourceCache(t);km[t.type](t,g,this)}this.gpuTimingEnd()}renderLayer(t,l,d,g){d.isHidden(this.transform.zoom)||(d.type==="background"||d.type==="sky"||d.type==="custom"||d.type==="model"||d.type==="raster"||d.type==="raster-particle"||g&&g.length)&&(this.id=d.id,this.gpuTimingStart(d),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(d.type)&&(!t.terrain||d.type!=="custom")||d.type==="clip"||Hl[d.type](t,l,d,g,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery,d=this.context.gl;let g=this.gpuTimers[t.id];g||(g=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:d.createQuery()}),g.calls++,d.beginQuery(l.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const t=this.context.extTimerQuery,l=this.context.gl,d=l.createQuery();this.deferredRenderGpuTimeQueries.push(d),l.beginQuery(t.TIME_ELAPSED_EXT,d)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}collectDeferredRenderGpuQueries(){const t=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],t}queryGpuTimers(t){const l={};for(const d in t){const g=t[d],y=this.context.extTimerQuery,x=y.getQueryParameter(g.query,this.context.gl.QUERY_RESULT)/1e6;y.deleteQueryEXT(g.query),l[d]=x}return l}queryGpuTimeDeferredRender(t){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.gl;let d=0;for(const g of t)d+=l.getQueryParameter(g,l.QUERY_RESULT)/1e6,l.deleteQuery(g);return d}translatePosMatrix(t,l,d,g,y){if(!d[0]&&!d[1])return t;const x=y?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(x){const L=Math.sin(x),P=Math.cos(x);d=[d[0]*P-d[1]*L,d[0]*L+d[1]*P]}const T=[y?d[0]:o.ay(l,d[0],this.transform.zoom),y?d[1]:o.ay(l,d[1],this.transform.zoom),0],E=new Float32Array(16);return o.br(E,t,T),E}saveTileTexture(t){if(t.context!==this.context)return;const l=t.size[0],d=this._tileTextures[l];d?d.push(t):this._tileTextures[l]=[t]}getTileTexture(t){const l=this._tileTextures[t];return l&&l.length>0?l.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(t,l,d){const g=d===void 0?this.terrain&&this.terrain.renderingToTexture:d,y=[];return this.style&&this.style.enable3dLights()&&(t==="globeRaster"||t==="terrainRaster"?(y.push("LIGHTING_3D_MODE"),y.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):g||y.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||y.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(y.push("TERRAIN"),this.linearFloatFilteringSupported()&&y.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&y.push("GLOBE"),!this._fogVisible||g||l!==void 0&&!l||y.push("FOG"),g&&y.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&y.push("OVERDRAW_INSPECTOR"),y}getOrCreateProgram(t,l){this.cache=this.cache||{};const d=l&&l.defines||[],g=l&&l.config,y=this.currentGlobalDefines(t,l&&l.overrideFog,l&&l.overrideRtt).concat(d),x=gy.cacheKey(Up[t],t,y,g);return this.cache[x]||(this.cache[x]=new gy(this.context,t,Up[t],g,zd[t],y)),this.cache[x]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,l){if(this.style.enable3dLights()){const d=this.style.directionalLight,g=this.style.ambientLight;if(d&&g){const y=((x,T,E)=>{const L=x.properties.get("direction"),P=x.properties.get("color-use-theme")==="none",z=x.properties.get("color").toNonPremultipliedRenderColor(P?null:E.getLut(x.scope)).toArray01(),O=x.properties.get("intensity"),B=T.properties.get("color-use-theme")==="none",G=T.properties.get("color").toNonPremultipliedRenderColor(B?null:E.getLut(T.scope)).toArray01(),V=T.properties.get("intensity"),W=[L.x,L.y,L.z],Y=o.dN(G,V),se=o.dN(z,O);return{u_lighting_ambient_color:Y,u_lighting_directional_dir:W,u_lighting_directional_color:se,u_ground_radiance:Rc(W,se,Y)}})(d,g,this.style);l.setLightsUniformValues(t,y)}}}uploadCommonUniforms(t,l,d,g,y){if(this.uploadCommonLightUniforms(t,l),this.terrain&&this.terrain.renderingToTexture)return;const x=this.style.fog;if(x){const T=x.getOpacity(this.transform.pitch),E=((L,P,z,O,B,G,V,W,Y,se,ne,te)=>{const we=L.transform,_e=P.properties.get("color-use-theme")==="none",be=P.properties.get("color").toNonPremultipliedRenderColor(_e?null:L.style.getLut(P.scope)).toArray01();be[3]=O;const de=L.frameCounter/1e3%1,[le,Te]=P.properties.get("vertical-range");return{u_fog_matrix:z?we.calculateFogTileMatrix(z):te||L.identityMat,u_fog_range:P.getFovAdjustedRange(we._fov),u_fog_color:be,u_fog_horizon_blend:P.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(le,Te),Te],u_fog_temporal_offset:de,u_frustum_tl:B,u_frustum_tr:G,u_frustum_br:V,u_frustum_bl:W,u_globe_pos:Y,u_globe_radius:se,u_viewport:ne,u_globe_transition:o.aj(we.zoom),u_is_globe:+(we.projection.name==="globe")}})(this,x,d,T,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.o.devicePixelRatio,this.transform.height*o.o.devicePixelRatio],g);l.setFogUniformValues(t,E)}y&&l.setCutoffUniformValues(t,y.uniformValues)}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){const t=this.canvasCopy();t&&(this.frameCopies.push(t),this.tileLoaded=!1)}canvasCopy(){const t=this.context.gl,l=t.createTexture();return t.bindTexture(t.TEXTURE_2D,l),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&t.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const t=this._backgroundTiles,l=this._backgroundTiles={},d=this.transform.coveringTiles({tileSize:512});for(const g of d)l[g.key]=t[g.key]||new tl(g,512,this.transform.tileZoom,this,void 0,this.worldview);return l}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(t,l){return!(!t.is3D(!(!this.terrain||!this.terrain.enabled))||t.type!=="clip"&&t.type!=="building"&&(t.minzoom&&t.minzoom>this.transform.zoom||(this.style._clipLayerPresent||t.sourceLayer!=="building"&&t.sourceLayer!=="procedural_buildings")&&(!l||l.type!=="batched-model")))}isTileAffectedByFog(t){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let l=this._cachedTileFogOpacities[t.key];return l||(this._cachedTileFogOpacities[t.key]=l=this.style.fog.getOpacityForTile(t)),l[0]>=At||l[1]>=At}setupDepthForOcclusion(t,l,d){const g=this.context,y=g.gl,x=!!d;var T;d||(d={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),g.activeTexture.set(y.TEXTURE3),t&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),d.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],d.u_depth_range_unpack=[2/((T=this.depthRangeFor3D)[1]-T[0]),-1-2*T[0]/(T[1]-T[0])],d.u_occluder_half_size=.5*this.occlusionParams.occluderSize,d.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE),g.activeTexture.set(y.TEXTURE0),x||l.setTerrainUniformValues(g,d)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const t=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=t?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function qy(h,t){let l=!1,d=null;const g=()=>{d=null,l&&(h(),d=setTimeout(g,t),l=!1)};return()=>(l=!0,d||g(),d)}class as{constructor(t){this._hashName=t&&encodeURIComponent(t),o.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=qy(this._updateHashUnthrottled.bind(this),300)}addTo(t){return this._map=t,window.addEventListener("hashchange",this._onHashChange,!1),t.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const t=this._map;if(!t)return"";const l=Zy(t);if(this._hashName){const d=this._hashName;let g=!1;const y=location.hash.slice(1).split("&").map(x=>{const T=x.split("=")[0];return T===d?(g=!0,`${T}=${l}`):x}).filter(x=>x);return g||y.push(`${d}=${l}`),`#${y.join("&")}`}return`#${l}`}_getCurrentHash(){const t=location.hash.replace("#","");if(this._hashName){let l;return t.split("&").map(d=>d.split("=")).forEach(d=>{d[0]===this._hashName&&(l=d)}),(l&&l[1]||"").split("/")}return t.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(d=>isNaN(Number(d)))){const d=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(l[3]||0):t.getBearing();return t.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:d,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Zy(h,t){const l=h.getCenter(),d=Math.round(100*h.getZoom())/100,g=Math.ceil((d*Math.LN2+Math.log(512/360/.5))/Math.LN10),y=Math.pow(10,g),x=Math.round(l.lng*y)/y,T=Math.round(l.lat*y)/y,E=h.getBearing(),L=h.getPitch();let P=t?`/${x}/${T}/${d}`:`${d}/${T}/${x}`;return(E||L)&&(P+="/"+Math.round(10*E)/10),L&&(P+=`/${Math.round(L)}`),P}const _l={linearity:.3,easing:o.eT(0,0,.3,1)},D1=Object.assign({deceleration:2500,maxSpeed:1400},_l),hr=Object.assign({deceleration:20,maxSpeed:1400},_l),wi=Object.assign({deceleration:1e3,maxSpeed:360},_l),Xy=Object.assign({deceleration:1e3,maxSpeed:90},_l);class yl{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,l=o.o.now();for(;t.length>0&&l-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:y}of this._inertiaBuffer)l.zoom+=y.zoomDelta||0,l.bearing+=y.bearingDelta||0,l.pitch+=y.pitchDelta||0,y.panDelta&&l.pan._add(y.panDelta),y.around&&(l.around=y.around),y.pinchAround&&(l.pinchAround=y.pinchAround);const d=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,g={};if(l.pan.mag()){const y=Fa(l.pan.mag(),d,Object.assign({},D1,t||{}));g.offset=l.pan.mult(y.amount/l.pan.mag()),g.center=this._map.transform.center,Ba(g,y)}if(l.zoom){const y=Fa(l.zoom,d,hr);g.zoom=this._map.transform.zoom+y.amount,Ba(g,y)}if(l.bearing){const y=Fa(l.bearing,d,wi);g.bearing=this._map.transform.bearing+o.aA(y.amount,-179,179),Ba(g,y)}if(l.pitch){const y=Fa(l.pitch,d,Xy);g.pitch=this._map.transform.pitch+y.amount,Ba(g,y)}if(g.zoom||g.bearing){const y=l.pinchAround===void 0?l.around:l.pinchAround;g.around=y?this._map.unproject(y):this._map.getCenter()}return this.clear(),g.noMoveStart=!0,g}}function Ba(h,t){(!h.duration||h.duration<t.duration)&&(h.duration=t.duration,h.easing=t.easing)}function Fa(h,t,l){const{maxSpeed:d,linearity:g,deceleration:y}=l,x=o.aA(h*g/(t/1e3),-d,d),T=Math.abs(x)/(y*g);return{easing:l.easing,duration:1e3*T,amount:x*(T/2)}}class Tn extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,d,g={}){const y=ct(l.getCanvasContainer(),d),x=l.unproject(y);super(t,Object.assign({point:y,lngLat:x,originalEvent:d},g)),this._defaultPrevented=!1,this.target=l}}class Uc extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l,d){const g=t==="touchend"?d.changedTouches:d.touches,y=lt(l.getCanvasContainer(),g),x=y.map(E=>l.unproject(E)),T=y.reduce((E,L,P,z)=>E.add(L.div(z.length)),new o.P(0,0));super(t,{points:y,point:T,lngLats:x,lngLat:l.unproject(T),originalEvent:d}),this._defaultPrevented=!1}}class Pm extends o.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,l){super("wheel",{originalEvent:l}),this._defaultPrevented=!1}}class Mm{constructor(t,l){this._map=t,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Pm(this._map,t))}mousedown(t,l){return this._mousedownPos=l,this._firePreventable(new Tn(t.type,this._map,t))}mouseup(t){this._map.fire(new Tn(t.type,this._map,t))}preclick(t){const l=new MouseEvent("preclick",t);this._map.fire(new Tn(l.type,this._map,l))}click(t,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Tn(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Tn(t.type,this._map,t))}mouseover(t){this._map.fire(new Tn(t.type,this._map,t))}mouseout(t){this._map.fire(new Tn(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Uc(t.type,this._map,t))}touchmove(t){this._map.fire(new Uc(t.type,this._map,t))}touchend(t){this._map.fire(new Uc(t.type,this._map,t))}touchcancel(t){this._map.fire(new Uc(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Rm{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Tn(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Tn("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Tn(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class wo{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,l){this.isEnabled()&&t.shiftKey&&t.button===0&&(ke(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(t,l){if(!this._active)return;const d=l,g=this._startPos,y=this._lastPos;if(!g||!y||y.equals(d)||!this._box&&d.dist(g)<this._clickTolerance)return;this._lastPos=d,this._box||(this._box=xe("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const x=Math.min(g.x,d.x),T=Math.max(g.x,d.x),E=Math.min(g.y,d.y),L=Math.max(g.y,d.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${x}px,${E}px)`,this._box.style.width=T-x+"px",this._box.style.height=L-E+"px")})}mouseupWindow(t,l){if(!this._active)return;const d=this._startPos,g=l;if(d&&t.button===0){if(this.reset(),We(),d.x!==g.x||d.y!==g.y)return this._map.fire(new o.z("boxzoomend",{originalEvent:t})),{cameraAnimation:y=>y.fitScreenCoordinates(d,g,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(t){this._active&&t.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Be(),delete this._startPos,delete this._lastPos}_fireEvent(t,l){return this._map.fire(new o.z(t,{originalEvent:l}))}}function ha(h,t){const l={};for(let d=0;d<h.length;d++)l[h[d].identifier]=t[d];return l}class Vc{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,l,d){(this.centroid||d.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=t.timeStamp),d.length===this.numTouches&&(this.centroid=function(g){const y=new o.P(0,0);for(const x of g)y._add(x);return y.div(g.length)}(l),this.touches=ha(d,l)))}touchmove(t,l,d){if(this.aborted||!this.centroid)return;const g=ha(d,l);for(const y in this.touches){const x=g[y];(!x||x.dist(this.touches[y])>30)&&(this.aborted=!0)}}touchend(t,l,d){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),d.length===0){const g=!this.aborted&&this.centroid;if(this.reset(),g)return g}}}class $c{constructor(t){this.singleTap=new Vc(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,l,d){this.singleTap.touchstart(t,l,d)}touchmove(t,l,d){this.singleTap.touchmove(t,l,d)}touchend(t,l,d){const g=this.singleTap.touchend(t,l,d);if(g){const y=t.timeStamp-this.lastTime<500,x=!this.lastTap||this.lastTap.dist(g)<30;if(y&&x||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}}}class Dm{constructor(){this._zoomIn=new $c({numTouches:1,numTaps:2}),this._zoomOut=new $c({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,l,d){this._zoomIn.touchstart(t,l,d),this._zoomOut.touchstart(t,l,d)}touchmove(t,l,d){this._zoomIn.touchmove(t,l,d),this._zoomOut.touchmove(t,l,d)}touchend(t,l,d){const g=this._zoomIn.touchend(t,l,d),y=this._zoomOut.touchend(t,l,d);return g?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()+1,around:x.unproject(g)},{originalEvent:t})}):y?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:x=>x.easeTo({duration:300,zoom:x.getZoom()-1,around:x.unproject(y)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Om=0,vl=2,zm={[Om]:1,[vl]:2},Qs={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class uh{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,l){return!1}_move(t,l){return{}}mousedown(t,l){if(this._lastPoint)return;const d=Pt(t);this._correctButton(t,d)&&(this._lastPoint=l,this._eventButton=d)}mousemoveWindow(t,l){const d=this._lastPoint;if(d){if(t.preventDefault(),this._eventButton!=null&&function(g,y){const x=zm[y];return g.buttons===void 0||(g.buttons&x)!==x}(t,this._eventButton))this.reset();else if(this._moved||!(l.dist(d)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(d,l)}}mouseupWindow(t){this._lastPoint&&Pt(t)===this._eventButton&&(this._moved&&We(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Hd extends uh{mousedown(t,l){super.mousedown(t,l),this._lastPoint&&(this._active=!0)}_correctButton(t,l){return l===0&&!t.ctrlKey}_move(t,l){return{around:l,panDelta:l.sub(t)}}}class Wd extends uh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Qs[t.pitchRotateKey]:void 0}_correctButton(t,l){return this._pitchRotateKey?l===0&&t[this._pitchRotateKey]:l===0&&t.ctrlKey||l===2}_move(t,l){const d=.8*(l.x-t.x);if(d)return this._active=!0,{bearingDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class qd extends uh{constructor(t){super(t),this._pitchRotateKey=t.pitchRotateKey?Qs[t.pitchRotateKey]:void 0}_correctButton(t,l){return this._pitchRotateKey?l===0&&t[this._pitchRotateKey]:l===0&&t.ctrlKey||l===2}_move(t,l){const d=-.5*(l.y-t.y);if(d)return this._active=!0,{pitchDelta:d}}contextmenu(t){this._pitchRotateKey||t.preventDefault()}}class en{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),o.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(t,l,d){return this._calculateTransform(t,l,d)}touchmove(t,l,d){if(this._active&&!(d.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(d.length===1&&!o.eU())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,l,d)}}touchend(t,l,d){this._calculateTransform(t,l,d),this._active&&d.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,l,d){d.length>0&&(this._active=!0);const g=ha(d,l),y=new o.P(0,0),x=new o.P(0,0);let T=0;for(const L in g){const P=g[L],z=this._touches[L];z&&(y._add(P),x._add(P.sub(z)),T++,g[L]=P)}if(this._touches=g,T<this._minTouches||!x.mag())return;const E=x.div(T);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:y.div(T),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class hh{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,l,d){return{}}touchstart(t,l,d){this._firstTwoTouches||d.length<2||(this._firstTwoTouches=[d[0].identifier,d[1].identifier],this._start([l[0],l[1]]))}touchmove(t,l,d){const g=this._firstTwoTouches;if(!g)return;t.preventDefault();const[y,x]=g,T=Gc(d,l,y),E=Gc(d,l,x);if(!T||!E)return;const L=this._aroundCenter?null:T.add(E).div(2);return this._move([T,E],L,t)}touchend(t,l,d){if(!this._firstTwoTouches)return;const[g,y]=this._firstTwoTouches,x=Gc(d,l,g),T=Gc(d,l,y);x&&T||(this._active&&We(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&t.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Gc(h,t,l){for(let d=0;d<h.length;d++)if(h[d].identifier===l)return t[d]}function Zd(h,t){return Math.log2(h/t)}class Wl extends hh{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,l){const d=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(Zd(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Zd(this._distance,d),pinchAround:l}}}function Xd(h,t){return 180*h.angleWith(t)/Math.PI}class Bm extends hh{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,l){const d=this._vector;if(this._vector=t[0].sub(t[1]),d&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Xd(this._vector,d),pinchAround:l}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const l=25/(Math.PI*this._minDiameter)*360,d=this._startVector;if(!d)return!1;const g=Xd(t,d);return Math.abs(g)<l}}function dh(h){return Math.abs(h.y)>Math.abs(h.x)}class ql extends hh{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,dh(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,l,d){const g=this._lastPoints;if(!g)return;const y=t[0].sub(g[0]),x=t[1].sub(g[1]);return this._map._cooperativeGestures&&!o.eU()&&d.touches.length<3||(this._valid=this.gestureBeginsVertically(y,x,d.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(y.y+x.y)/2*-.5})}gestureBeginsVertically(t,l,d){if(this._valid!==void 0)return this._valid;const g=t.mag()>=2,y=l.mag()>=2;if(!g&&!y)return;if(!g||!y)return this._firstMove==null&&(this._firstMove=d),d-this._firstMove<100&&void 0;const x=t.y>0==l.y>0;return dh(t)&&dh(l)&&x}}const Fm={panStep:100,bearingStep:15,pitchStep:10};class fh{constructor(){const t=Fm;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let l=0,d=0,g=0,y=0,x=0;switch(t.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:t.shiftKey?d=-1:(t.preventDefault(),y=-1);break;case 39:t.shiftKey?d=1:(t.preventDefault(),y=1);break;case 38:t.shiftKey?g=1:(t.preventDefault(),x=-1);break;case 40:t.shiftKey?g=-1:(t.preventDefault(),x=1);break;default:return}return this._rotationDisabled&&(d=0,g=0),{cameraAnimation:T=>{const E=T.getZoom();T.easeTo({duration:300,easeId:"keyboardHandler",easing:jm,zoom:l?Math.round(E)+l*(t.shiftKey?2:1):E,bearing:T.getBearing()+d*this._bearingStep,pitch:T.getPitch()+g*this._pitchStep,offset:[-y*this._panStep,-x*this._panStep],center:T.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function jm(h){return h*(2-h)}const ph=4.000244140625,Nm=1/450;class Kd{constructor(t,l){this._map=t,this._el=t.getCanvasContainer(),this._handler=l,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Nm,o.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&t.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||o.eU()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const d=o.o.now(),g=d-(this._lastWheelEventTime||0);this._lastWheelEventTime=d,l!==0&&l%ph===0?this._type="wheel":l!==0&&Math.abs(l)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=l,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(g*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),t.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=t,this._delta-=l,this._active||this._start(t)),t.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=ct(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const t=this._map.transform;this._type==="wheel"&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(this._delta!==0){const L=this._type==="wheel"&&Math.abs(this._delta)>ph?this._wheelZoomRate:this._defaultZoomRate;let P=2/(1+Math.exp(-Math.abs(this._delta*L)));this._delta<0&&P!==0&&(P=1/P);const z=l(),O=Math.pow(2,z),B=typeof this._targetZoom=="number"?t.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(B*P))),this._type==="wheel"&&(this._startZoom=z,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const d=typeof this._targetZoom=="number"?this._targetZoom:l(),g=this._startZoom,y=this._easing;let x,T=!1;if(this._type==="wheel"&&g&&y){const L=Math.min((o.o.now()-this._lastWheelEventTime)/200,1),P=y(L);x=o.ak(g,d,P),L<1?this._frameId||(this._frameId=!0):T=!0}else x=d,T=!0;this._active=!0,T&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let E=x-l();return E*this._lastDelta<0&&(E=0),{noInertia:!0,needsRenderFrame:!T,zoomDelta:E,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let l=o.eV;if(this._prevEase){const d=this._prevEase,g=(o.o.now()-d.start)/d.duration,y=d.easing(g+.01)-d.easing(g),x=.27/Math.sqrt(y*y+1e-4)*.01,T=Math.sqrt(.0729-x*x);l=o.eT(x,T,.25,1)}return this._prevEase={start:o.o.now(),duration:t,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=xe("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class Ky{constructor(t,l){this._clickZoom=t,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Yy{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,l){return t.preventDefault(),{cameraAnimation:d=>{d.easeTo({duration:300,zoom:d.getZoom()+(t.shiftKey?-1:1),around:d.unproject(l)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Jy{constructor(){this._tap=new $c({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,l,d){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?d.length>0&&(this._swipePoint=l[0],this._swipeTouch=d[0].identifier):this._tap.touchstart(t,l,d))}touchmove(t,l,d){if(this._tapTime){if(this._swipePoint){if(d[0].identifier!==this._swipeTouch)return;const g=l[0],y=g.y-this._swipePoint.y;return this._swipePoint=g,t.preventDefault(),this._active=!0,{zoomDelta:y/128}}}else this._tap.touchmove(t,l,d)}touchend(t,l,d){this._tapTime?this._swipePoint&&d.length===0&&this.reset():this._tap.touchend(t,l,d)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Qy{constructor(t,l,d){this._el=t,this._mousePan=l,this._touchPan=d}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class ev{constructor(t,l,d){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=l,this._mousePitch=d}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class tv{constructor(t,l,d,g){this._el=t,this._touchZoom=l,this._touchRotate=d,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const mh=h=>h.zoom||h.drag||h.pitch||h.rotate;class iv extends o.z{}class rv{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,l){const d=o.av([],l,t);this.radius=o.ag(d[2]<0?o.eX([],d,this.constants):[d[0],d[1],0])}projectRay(t){o.eX(t,t,this.constants),o.aw(t,t),o.eY(t,t,this.constants);const l=o.c5([],t,this.radius);if(l[2]>0){const d=o.c5([],[0,0,1],o.bJ(l,[0,0,1])),g=o.c5([],o.aw([],[l[0],l[1],0]),this.radius),y=o.d8([],l,o.c5([],o.av([],o.d8([],g,d),l),2));l[0]=y[0],l[1]=y[1]}return l}}function gh(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class nv{constructor(t,l){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new yl(t),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new rv,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),o.aY(["handleEvent","handleWindowEvent"],this);const d=this._el;this._listeners=[[d,"touchstart",{passive:!0}],[d,"touchmove",{passive:!1}],[d,"touchend",void 0],[d,"touchcancel",void 0],[d,"mousedown",void 0],[d,"mousemove",void 0],[d,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[d,"mouseover",void 0],[d,"mouseout",void 0],[d,"dblclick",void 0],[d,"click",void 0],[d,"keydown",{capture:!1}],[d,"keyup",void 0],[d,"wheel",{passive:!1}],[d,"contextmenu",void 0],[window,"blur",void 0]];for(const[g,y,x]of this._listeners){const T=g===document?this.handleWindowEvent:this.handleEvent;g.addEventListener(y,T,x)}}destroy(){for(const[t,l,d]of this._listeners){const g=t===document?this.handleWindowEvent:this.handleEvent;t.removeEventListener(l,g,d)}}_addDefaultHandlers(t){const l=this._map,d=l.getCanvasContainer();this._add("mapEvent",new Mm(l,t));const g=l.boxZoom=new wo(l,t);this._add("boxZoom",g);const y=new Dm,x=new Yy;l.doubleClickZoom=new Ky(x,y),this._add("tapZoom",y),this._add("clickZoom",x);const T=new Jy;this._add("tapDragZoom",T);const E=l.touchPitch=new ql(l);this._add("touchPitch",E);const L=new Wd(t),P=new qd(t);l.dragRotate=new ev(t,L,P),this._add("mouseRotate",L,["mousePitch"]),this._add("mousePitch",P,["mouseRotate"]);const z=new Hd(t),O=new en(l,t);l.dragPan=new Qy(d,z,O),this._add("mousePan",z),this._add("touchPan",O,["touchZoom","touchRotate"]);const B=new Bm,G=new Wl;l.touchZoomRotate=new tv(d,G,B,T),this._add("touchRotate",B,["touchPan","touchZoom"]),this._add("touchZoom",G,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Rm(l));const V=l.scrollZoom=new Kd(l,this);this._add("scrollZoom",V,["mousePan"]);const W=l.keyboard=new fh;this._add("keyboard",W);for(const Y of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[Y]&&l[Y].enable(t[Y])}_add(t,l,d){this._handlers.push({handlerName:t,handler:l,allowed:d}),this._handlersById[t]=l}stop(t){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!mh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(t,l,d){for(const g in t)if(g!==d&&(!l||l.indexOf(g)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const l=[];for(const d of t)this._el.contains(d.target)&&l.push(d);return l}handleEvent(t,l){this._updatingCamera=!0;const d=t.type==="renderFrame",g=d?void 0:t,y={needsRenderFrame:!1},x={},T={},E=t.touches?this._getMapTouches(t.touches):void 0,L=E?lt(this._el,E):d?void 0:ct(this._el,t);for(const{handlerName:O,handler:B,allowed:G}of this._handlers){if(!B.isEnabled())continue;let V;this._blockedByActive(T,G,O)?B.reset():B[l||t.type]&&(V=B[l||t.type](t,L,E),this.mergeHandlerResult(y,x,V,O,g),V&&V.needsRenderFrame&&this._triggerRenderFrame()),(V||B.isActive())&&(T[O]=B)}const P={};for(const O in this._previousActiveHandlers)T[O]||(P[O]=g);this._previousActiveHandlers=T,(Object.keys(P).length||gh(y))&&(this._changes.push([y,x,P]),this._triggerRenderFrame()),(Object.keys(T).length||gh(y))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=y;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(t,l,d,g,y){if(!d)return;Object.assign(t,d);const x={handlerName:g,originalEvent:d.originalEvent||y};d.zoomDelta!==void 0&&(l.zoom=x),d.panDelta!==void 0&&(l.drag=x),d.pitchDelta!==void 0&&(l.pitch=x),d.bearingDelta!==void 0&&(l.rotate=x)}_applyChanges(){const t={},l={},d={};for(const[g,y,x]of this._changes)g.panDelta&&(t.panDelta=(t.panDelta||new o.P(0,0))._add(g.panDelta)),g.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+g.zoomDelta),g.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+g.bearingDelta),g.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+g.pitchDelta),g.around!==void 0&&(t.around=g.around),g.aroundCoord!==void 0&&(t.aroundCoord=g.aroundCoord),g.pinchAround!==void 0&&(t.pinchAround=g.pinchAround),g.noInertia&&(t.noInertia=g.noInertia),Object.assign(l,y),Object.assign(d,x);this._updateMapTransform(t,l,d),this._changes=[]}_updateMapTransform(t,l,d){const g=this._map,y=g.transform,x=se=>[se.x,se.y,se.z];if((()=>{const se=this._eventsInProgress.drag;return se&&!this._handlersById[se.handlerName].isActive()})()&&!gh(t)){const se=y.zoom;y.cameraElevationReference="sea",this._originalZoom!=null&&y._orthographicProjectionAtLowPitch&&y.projection.name!=="globe"&&y.pitch===0?(y.cameraElevationReference="ground",y.zoom=this._originalZoom):(y.recenterOnTerrain(),y.cameraElevationReference="ground"),se!==y.zoom&&this._map._update(!0)}if(y._isCameraConstrained&&g._stop(!0),!gh(t))return void this._fireEvents(l,d,!0);let{panDelta:T,zoomDelta:E,bearingDelta:L,pitchDelta:P,around:z,aroundCoord:O,pinchAround:B}=t;y._isCameraConstrained&&(E>0&&(E=0),y._isCameraConstrained=!1),B!==void 0&&(z=B),(E||(se=>l[se]&&!this._eventsInProgress[se])("drag"))&&z&&(this._dragOrigin=x(y.pointCoordinate3D(z)),this._originalZoom=y.zoom,this._trackingEllipsoid.setup(y._camera.position,this._dragOrigin)),y.cameraElevationReference="sea",g._stop(!0),z=z||g.transform.centerPoint,L&&(y.bearing+=L),P&&(y.pitch+=P),y._updateCameraState();const G=[0,0,0];if(T)if(y.projection.name==="mercator"){const se=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z).dir),ne=this._trackingEllipsoid.projectRay(y.screenPointToMercatorRay(z.sub(T)).dir);G[0]=ne[0]-se[0],G[1]=ne[1]-se[1]}else{const se=y.pointCoordinate(z);if(y.projection.name==="globe"){T=T.rotate(-y.angle);const ne=y._pixelsPerMercatorPixel/y.worldSize;G[0]=-T.x*o.eW(o.a$(se.y))*ne,G[1]=-T.y*o.eW(y.center.lat)*ne}else{const ne=y.pointCoordinate(z.sub(T));se&&ne&&(G[0]=ne.x-se.x,G[1]=ne.y-se.y)}}const V=y.zoom,W=[0,0,0];if(E){const se=x(O||y.pointCoordinate3D(z)),ne={dir:o.aw([],o.av([],se,y._camera.position))};if(ne.dir[2]<0){const te=y.zoomDeltaToMovement(se,E);o.c5(W,ne.dir,te)}}const Y=o.d8(G,G,W);y._translateCameraConstrained(Y),E&&Math.abs(y.zoom-V)>1e-4&&y.recenterOnTerrain(),y.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(l,d,!0)}_fireEvents(t,l,d){const g=mh(this._eventsInProgress),y=mh(t),x={};for(const P in t){const{originalEvent:z}=t[P];this._eventsInProgress[P]||(x[`${P}start`]=z),this._eventsInProgress[P]=t[P]}!g&&y&&this._fireEvent("movestart",y.originalEvent);for(const P in x)this._fireEvent(P,x[P]);y&&this._fireEvent("move",y.originalEvent);for(const P in t){const{originalEvent:z}=t[P];this._fireEvent(P,z)}const T={};let E;for(const P in this._eventsInProgress){const{handlerName:z,originalEvent:O}=this._eventsInProgress[P];this._handlersById[z].isActive()||(delete this._eventsInProgress[P],E=l[z]||O,T[`${P}end`]=E)}for(const P in T)this._fireEvent(P,T[P]);const L=mh(this._eventsInProgress);if(d&&(g||y)&&!L){this._updatingCamera=!0;const P=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;P?(z(P.bearing||this._map.getBearing())&&(P.bearing=0),this._map.easeTo(P,{originalEvent:E})):(this._map.fire(new o.z("moveend",{originalEvent:E})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,l){this._map.fire(new o.z(t,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new iv("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Um="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class sv extends o.E{constructor(t,l){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=l.respectPrefersReducedMotion!==!1,o.aY(["_renderFrameCallback"],this)}getCenter(){return new o.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(t,l){return this.jumpTo({center:t},l)}panBy(t,l,d){return t=o.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},l),d)}panTo(t,l,d){return this.easeTo(Object.assign({center:t},l),d)}getZoom(){return this.transform.zoom}setZoom(t,l){return this.jumpTo({zoom:t},l),this}zoomTo(t,l,d){return this.easeTo(Object.assign({zoom:t},l),d)}zoomIn(t,l){return this.zoomTo(this.getZoom()+1,t,l),this}zoomOut(t,l){return this.zoomTo(this.getZoom()-1,t,l),this}getBearing(){return this.transform.bearing}setBearing(t,l){return this.jumpTo({bearing:t},l),this}getPadding(){return this.transform.padding}setPadding(t,l){return this.jumpTo({padding:t},l),this}rotateTo(t,l,d){return this.easeTo(Object.assign({bearing:t},l),d)}resetNorth(t,l){return this.rotateTo(0,Object.assign({duration:1e3},t),l),this}resetNorthPitch(t,l){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},t),l),this}snapToNorth(t,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,l):this}getPitch(){return this.transform.pitch}setPitch(t,l){return this.jumpTo({pitch:t},l),this}cameraForBounds(t,l){t=o.aI.convert(t);const d=l&&l.bearing||0,g=l&&l.pitch||0,y=t.getNorthWest(),x=t.getSouthEast();return this._cameraForBounds(this.transform,y,x,d,g,l)}_extendPadding(t){const l={top:0,right:0,bottom:0,left:0};return t==null?Object.assign({},l,this.transform.padding):typeof t=="number"?{top:t,bottom:t,right:t,left:t}:Object.assign({},l,t)}_extendCameraOptions(t){return(t=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},t)).padding=this._extendPadding(t.padding),t}_minimumAABBFrustumDistance(t,l){const d=l.max[0]-l.min[0],g=l.max[1]-l.min[1];return d/g>t.aspect?d/(2*Math.tan(.5*t.fovX)*t.aspect):g/(2*Math.tan(.5*t.fovY)*t.aspect)}_cameraForBoundsOnGlobe(t,l,d,g,y,x){const T=t.clone(),E=this._extendCameraOptions(x);T.bearing=g,T.pitch=y;const L=o.aT.convert(l),P=o.aT.convert(d),z=.5*(L.lat+P.lat),O=.5*(L.lng+P.lng),B=o.eZ(z,O),G=o.aw([],B),V=o.aw([],o.bI([],G,[0,1,0])),W=o.bI([],V,G),Y=[V[0],V[1],V[2],0,W[0],W[1],W[2],0,G[0],G[1],G[2],0,0,0,0,1],se=[B,o.eZ(L.lat,L.lng),o.eZ(P.lat,L.lng),o.eZ(P.lat,P.lng),o.eZ(L.lat,P.lng),o.eZ(z,L.lng),o.eZ(z,P.lng),o.eZ(L.lat,O),o.eZ(P.lat,O)];let ne=o.d9.fromPoints(se.map($e=>[o.bJ(V,$e),o.bJ(W,$e),o.bJ(G,$e)]));const te=o.af([],ne.center,Y);o.e_(te)===0&&o.e$(te,0,0,1),o.aw(te,te),o.c5(te,te,o.aD),T.center=o.f0(te);const we=T.getWorldToCameraMatrix(),_e=o.bl(new Float64Array(16),we);ne=o.d9.applyTransform(ne,o.aB([],we,Y));const be=this._extendAABB(ne,T,E,g);if(!be)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ne=be,o.af(te,te,we);const de=.5*(ne.max[2]-ne.min[2]),le=this._minimumAABBFrustumDistance(T,ne),Te=o.c5([],[0,0,1],de),Me=o.d8(Te,te,Te),Oe=le+(T.pitch===0?0:o.bG(te,Me)),Ve=T.globeCenterInViewSpace,je=o.av([],te,[Ve[0],Ve[1],Ve[2]]);o.aw(je,je),o.c5(je,je,Oe);const Ye=o.d8([],te,je);o.af(Ye,Ye,_e);const nt=o.eM/o.aD,Fe=o.ag(Ye),Ie=o.cf(Math.max(Fe*nt-o.eM,Number.EPSILON),0),Xe=Math.min(T.zoomFromMercatorZAdjusted(Ie),E.maxZoom);return Xe>.5*(o.c_+o.cL)?(T.setProjection({name:"mercator"}),T.zoom=Xe,this._cameraForBounds(T,l,d,g,y,x)):{center:T.center,zoom:Xe,bearing:g,pitch:y}}_extendAABB(t,l,d,g){const y=.5*((d.padding.left||0)+(d.padding.right||0)),x=.5*((d.padding.top||0)+(d.padding.bottom||0)),T=x,E=y,L=y,P=x,z=l.width-(E+L),O=l.height-(T+P),B=o.av([],t.max,t.min),G=Math.min(z/B[0],O/B[1]),V=Math.min(l.scaleZoom(l.scale*G),d.maxZoom);if(isNaN(V))return null;const W=l.scale/l.zoomScale(V),Y=new o.d9([t.min[0]-E*W,t.min[1]-P*W,t.min[2]],[t.max[0]+L*W,t.max[1]+T*W,t.max[2]]),se=(typeof d.offset.x=="number"&&typeof d.offset.y=="number"?new o.P(d.offset.x,d.offset.y):o.P.convert(d.offset)).rotate(-o.an(g));return Y.center[0]-=se.x*W,Y.center[1]+=se.y*W,Y}queryTerrainElevation(t,l){const d=this.transform.elevation;return d?(l=Object.assign({},{exaggerated:!0},l),d.getAtPoint(o.ae.fromLngLat(t),null,l.exaggerated)):null}_cameraForBounds(t,l,d,g,y,x){if(t.projection.name==="globe")return this._cameraForBoundsOnGlobe(t,l,d,g,y,x);const T=t.clone(),E=this._extendCameraOptions(x);T.bearing=g,T.pitch=y;const L=o.aT.convert(l),P=o.aT.convert(d),z=new o.aT(L.lng,P.lat),O=new o.aT(P.lng,L.lat),B=T.project(L),G=T.project(P),V=this.queryTerrainElevation(L),W=this.queryTerrainElevation(P),Y=this.queryTerrainElevation(z),se=this.queryTerrainElevation(O),ne=[[B.x,B.y,Math.min(V||0,W||0,Y||0,se||0)],[G.x,G.y,Math.max(V||0,W||0,Y||0,se||0)]];let te=o.d9.fromPoints(ne);const we=T.getWorldToCameraMatrix(),_e=o.bl(new Float64Array(16),we);te=o.d9.applyTransform(te,we);const be=this._extendAABB(te,T,E,g);if(!be)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");te=be;const de=.5*o.av([],te.max,te.min)[2],le=this._minimumAABBFrustumDistance(T,te),Te=[0,0,1,0];o.aC(Te,Te,we),o.f1(Te,Te);const Me=o.c5([],Te,le+de),Oe=o.d8([],te.center,Me);o.af(te.center,te.center,_e),o.af(Oe,Oe,_e);const Ve=T.unproject(new o.P(te.center[0],te.center[1])),je=o.f2(T.projection,Ve),Ye=Math.pow(2,je),nt=Math.min(T._zoomFromMercatorZ(Oe[2]*T.pixelsPerMeter*Ye/T.worldSize),E.maxZoom);return T.mercatorFromTransition&&nt<.5*(o.c_+o.cL)?(T.setProjection({name:"globe"}),T.zoom=nt,this._cameraForBounds(T,l,d,g,y,x)):{center:Ve,zoom:nt,bearing:g,pitch:y}}fitBounds(t,l,d){const g=this.cameraForBounds(t,l);return this._fitInternal(g,l,d)}fitScreenCoordinates(t,l,d,g,y){const x=o.P.convert(t),T=o.P.convert(l),E=new o.P(Math.min(x.x,T.x),Math.min(x.y,T.y)),L=new o.P(Math.max(x.x,T.x),Math.max(x.y,T.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(x,T))return this;const P=this.transform.pointLocation3D(E),z=this.transform.pointLocation3D(L),O=this.transform.pointLocation3D(new o.P(E.x,L.y)),B=this.transform.pointLocation3D(new o.P(L.x,E.y)),G=[Math.min(P.lng,z.lng,O.lng,B.lng),Math.min(P.lat,z.lat,O.lat,B.lat)],V=[Math.max(P.lng,z.lng,O.lng,B.lng),Math.max(P.lat,z.lat,O.lat,B.lat)],W=g&&g.pitch?g.pitch:this.getPitch(),Y=this._cameraForBounds(this.transform,G,V,d,W,g);return this._fitInternal(Y,g,y)}_fitInternal(t,l,d){return t?(l=Object.assign(t,l)).linear?this.easeTo(l,d):this.flyTo(l,d):this}jumpTo(t,l){this.stop();const d=t.preloadOnly?this.transform.clone():this.transform;let g=!1,y=!1,x=!1;"zoom"in t&&d.zoom!==+t.zoom&&(g=!0,d.zoom=+t.zoom),t.center!==void 0&&(d.center=o.aT.convert(t.center)),"bearing"in t&&d.bearing!==+t.bearing&&(y=!0,d.bearing=+t.bearing),"pitch"in t&&d.pitch!==+t.pitch&&(x=!0,d.pitch=+t.pitch);const T=typeof t.padding=="number"?this._extendPadding(t.padding):t.padding;if(t.padding!=null&&!d.isPaddingEqual(T))if(t.retainPadding===!1){const E=d.clone();E.padding=T,d.setLocationAtPoint(d.center,E.centerPoint)}else d.padding=T;return t.preloadOnly?(this._preloadTiles(d),this):(this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),g&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),y&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),x&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(Um),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,l){const d=this.transform;if(!d.projection.supportsFreeCamera)return o.w(Um),this;this.stop();const g=d.zoom,y=d.pitch,x=d.bearing;d.setFreeCameraOptions(t);const T=g!==d.zoom,E=y!==d.pitch,L=x!==d.bearing;return this.fire(new o.z("movestart",l)).fire(new o.z("move",l)),T&&this.fire(new o.z("zoomstart",l)).fire(new o.z("zoom",l)).fire(new o.z("zoomend",l)),L&&this.fire(new o.z("rotatestart",l)).fire(new o.z("rotate",l)).fire(new o.z("rotateend",l)),E&&this.fire(new o.z("pitchstart",l)).fire(new o.z("pitch",l)).fire(new o.z("pitchend",l)),this.fire(new o.z("moveend",l)),this}easeTo(t,l){this._stop(!1,t.easeId),((t=Object.assign({offset:[0,0],duration:500,easing:o.eV},t)).animate===!1||this._prefersReducedMotion(t))&&(t.duration=0);const d=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),T=this.getPadding(),E="zoom"in t?+t.zoom:g,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:x,z=this._extendPadding(t.padding),O=o.P.convert(t.offset);let B,G,V;if(d.projection.name==="globe"){const Te=o.ae.fromLngLat(d.center),Me=O.rotate(-d.angle);Te.x+=Me.x/d.worldSize,Te.y+=Me.y/d.worldSize;const Oe=Te.toLngLat(),Ve=o.aT.convert(t.center||Oe);this._normalizeCenter(Ve),B=d.centerPoint.add(Me),G=new o.P(Te.x,Te.y).mult(d.worldSize),V=new o.P(o.aF(Ve.lng),o.aJ(Ve.lat)).mult(d.worldSize).sub(G)}else{B=d.centerPoint.add(O);const Te=d.pointLocation(B),Me=o.aT.convert(t.center||Te);this._normalizeCenter(Me),G=d.project(Te),V=d.project(Me).sub(G)}const W=d.zoomScale(E-g);let Y,se;t.around&&(Y=o.aT.convert(t.around),se=d.locationPoint(Y));const ne=this._zooming||E!==g,te=this._rotating||y!==L,we=this._pitching||P!==x,_e=!d.isPaddingEqual(z),be=t.retainPadding===!1?d.clone():d,de=Te=>Me=>{if(ne&&(Te.zoom=o.ak(g,E,Me)),te&&(Te.bearing=o.ak(y,L,Me)),we&&(Te.pitch=o.ak(x,P,Me)),_e&&(be.interpolatePadding(T,z,Me),B=be.centerPoint.add(O)),Y)Te.setLocationAtPoint(Y,se);else{const Oe=Te.zoomScale(Te.zoom-g),Ve=E>g?Math.min(2,W):Math.max(.5,W),je=Math.pow(Ve,1-Me),Ye=Te.unproject(G.add(V.mult(Me*je)).mult(Oe));Te.setLocationAtPoint(Te.renderWorldCopies?Ye.wrap():Ye,B)}return t.preloadOnly||this._fireMoveEvents(l),Te};if(t.preloadOnly){const Te=this._emulate(de,t.duration,d);return this._preloadTiles(Te),this}const le={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ne,this._rotating=te,this._pitching=we,this._padding=_e,this._easeId=t.easeId,this._prepareEase(l,t.noMoveStart,le),this._ease(de(d),Te=>{d.cameraElevationReference==="sea"&&d.recenterOnTerrain(),this._afterEase(l,Te)},t),this}_prepareEase(t,l,d={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),l||d.moving||this.fire(new o.z("movestart",t)),this._zooming&&!d.zooming&&this.fire(new o.z("zoomstart",t)),this._rotating&&!d.rotating&&this.fire(new o.z("rotatestart",t)),this._pitching&&!d.pitching&&this.fire(new o.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new o.z("move",t)),this._zooming&&this.fire(new o.z("zoom",t)),this._rotating&&this.fire(new o.z("rotate",t)),this._pitching&&this.fire(new o.z("pitch",t))}_afterEase(t,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const d=this._zooming,g=this._rotating,y=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,d&&this.fire(new o.z("zoomend",t)),g&&this.fire(new o.z("rotateend",t)),y&&this.fire(new o.z("pitchend",t)),this.fire(new o.z("moveend",t))}flyTo(t,l){if(this._prefersReducedMotion(t)){const $e=o.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo($e,l)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:o.eV},t);const d=this.transform,g=this.getZoom(),y=this.getBearing(),x=this.getPitch(),T=this.getPadding(),E="zoom"in t?o.aA(+t.zoom,d.minZoom,d.maxZoom):g,L="bearing"in t?this._normalizeBearing(t.bearing,y):y,P="pitch"in t?+t.pitch:x,z=this._extendPadding(t.padding),O=d.zoomScale(E-g),B=o.P.convert(t.offset);let G=d.centerPoint.add(B);const V=d.pointLocation(G),W=o.aT.convert(t.center||V);this._normalizeCenter(W);const Y=d.project(V),se=d.project(W).sub(Y);let ne=t.curve;const te=Math.max(d.width,d.height),we=te/O,_e=se.mag();if("minZoom"in t){const $e=o.aA(Math.min(t.minZoom,g,E),d.minZoom,d.maxZoom),ot=te/d.zoomScale($e-g);ne=Math.sqrt(ot/_e*2)}const be=ne*ne;function de($e){const ot=(we*we-te*te+($e?-1:1)*be*be*_e*_e)/(2*($e?we:te)*be*_e);return Math.log(Math.sqrt(ot*ot+1)-ot)}function le($e){return(Math.exp($e)-Math.exp(-$e))/2}function Te($e){return(Math.exp($e)+Math.exp(-$e))/2}const Me=de(0);let Oe=function($e){return Te(Me)/Te(Me+ne*$e)},Ve=function($e){return te*((Te(Me)*(le(ot=Me+ne*$e)/Te(ot))-le(Me))/be)/_e;var ot},je=(de(1)-Me)/ne;if(Math.abs(_e)<1e-6||!isFinite(je)){if(Math.abs(te-we)<1e-6)return this.easeTo(t,l);const $e=we<te?-1:1;je=Math.abs(Math.log(we/te))/ne,Ve=function(){return 0},Oe=function(ot){return Math.exp($e*ne*ot)}}t.duration="duration"in t?+t.duration:1e3*je/("screenSpeed"in t?+t.screenSpeed/ne:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const Ye=y!==L,nt=P!==x,Fe=!d.isPaddingEqual(z),Ie=t.retainPadding===!1?d.clone():d,Xe=$e=>ot=>{const ht=ot*je,yt=1/Oe(ht);$e.zoom=ot===1?E:g+$e.scaleZoom(yt),Ye&&($e.bearing=o.ak(y,L,ot)),nt&&($e.pitch=o.ak(x,P,ot)),Fe&&(Ie.interpolatePadding(T,z,ot),G=Ie.centerPoint.add(B));const dt=ot===1?W:$e.unproject(Y.add(se.mult(Ve(ht))).mult(yt));return $e.setLocationAtPoint($e.renderWorldCopies?dt.wrap():dt,G),$e._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(l),$e};if(t.preloadOnly){const $e=this._emulate(Xe,t.duration,d);return this._preloadTiles($e),this}return this._zooming=!0,this._rotating=Ye,this._pitching=nt,this._padding=Fe,this._prepareEase(l,!1),this._ease(Xe(d),()=>this._afterEase(l),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(t){}_cancelRenderFrame(t){}_stop(t,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const d=this._onEaseEnd;this._onEaseEnd=void 0,d.call(this,l)}if(!t){const d=this.handlers;d&&d.stop(!1)}return this}_ease(t,l,d){d.animate===!1||d.duration===0?(t(1),l()):(this._easeStart=o.o.now(),this._easeOptions=d,this._onEaseFrame=t,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((o.o.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,l){t=o.bT(t,-180,180);const d=Math.abs(t-l);return Math.abs(t-360-l)<d&&(t-=360),Math.abs(t+360-l)<d&&(t+=360),t}_normalizeCenter(t){const l=this.transform;if(l.maxBounds||l.projection.name!=="globe"&&!l.renderWorldCopies)return;const d=t.lng-l.center.lng;t.lng+=d>180?-360:d<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&o.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(t,l,d){const g=Math.ceil(15*l/1e3),y=[],x=t(d.clone());for(let T=0;T<=g;T++){const E=x(T/g);y.push(E.clone())}return y}_preloadTiles(t,l){}}class ov{constructor(t={}){this.options=t,o.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const l=this.options&&this.options.compact,d=t._getUIString("AttributionControl.ToggleAttribution");this._map=t,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=xe("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",d);const g=xe("span","mapboxgl-ctrl-icon",this._compactButton);return g.setAttribute("aria-hidden","true"),g.setAttribute("title",d),this._innerContainer=xe("div","mapboxgl-ctrl-attrib-inner",this._container),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),l===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(t){const d=l.reduce((g,y,x)=>(y.value&&(g+=`${y.key}=${y.value}${x<l.length-1?"&":""}`),g),"?");t.href=`${o.e.FEEDBACK_URL}/${d}#${Zy(this._map,!0)}`,t.rel="noopener nofollow"}}_updateData(t){!t||(t.dataType!=="source"||t.sourceDataType!=="metadata"&&t.sourceDataType!=="visibility")&&t.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const g=this._map.style.stylesheet;this.styleOwner=g.owner,this.styleId=g.id}const l=this._map.style._mergedSourceCaches;for(const g in l){const y=l[g];if(y.used){const x=y.getSource();x.attribution&&t.indexOf(x.attribution)<0&&t.push(x.attribution)}}t.sort((g,y)=>g.length-y.length),t=t.filter((g,y)=>{for(let x=y+1;x<t.length;x++)if(t[x].indexOf(g)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const d=t.map(g=>function(y){const x=new DOMParser().parseFromString(y,"text/html");return Array.from(x.body.querySelectorAll("*")).reverse().forEach(T=>{const E=T.textContent||"";if(T.tagName!=="A")return void T.replaceWith(...T.childNodes);const L=T.getAttribute("href");if(!L||!/^(https?:|mailto:)/i.test(L))return void T.replaceWith(x.createTextNode(E));const P=x.createElement("a");P.href=L,P.textContent=E,P.rel="noopener nofollow";const z=T.getAttribute("class");z&&(P.className=z),T.replaceWith(P)}),x.body.innerHTML}(g)).join(" | ");d!==this._attribHTML&&(this._attribHTML=d,t.length?(this._innerContainer.innerHTML=d,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class av{constructor(){o.aY(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=xe("div","mapboxgl-ctrl");const l=xe("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&t.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(Object.entries(t).length===0)return!0;for(const l in t){const d=t[l].getSource();if(d.hasOwnProperty("mapbox_logo")&&!d.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const l=t[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class lv{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const l=++this._id;return this._queue.push({callback:t,id:l,cancelled:!1}),l}remove(t){const l=this._currentlyRunning,d=l?this._queue.concat(l):this._queue;for(const g of d)if(g.id===t)return void(g.cancelled=!0)}run(t=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const d of l)if(!d.cancelled&&(d.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class xr{constructor(t){this.jumpTo(t)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const l=o.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,l,d){this._start=this.getValue(l),this._end=t,this._startTime=l,this._endTime=l+d}}const cv={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class uv extends o.z{constructor(t,l,d,g){const{point:y,lngLat:x,originalEvent:T,target:E}=t;super(t.type,{point:y,lngLat:x,originalEvent:T,target:E}),this.preventDefault=()=>{t.preventDefault()},this.id=l,this.interaction=d,this.feature=g}}class O1{constructor(t){this.map=t,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,l){if(this.typeById.has(t))throw new Error(`Interaction id "${t}" already exists.`);const d=l.filter;let g=l.type;d&&this.filters.set(t,o.b6(d)),g==="mouseover"&&(g="mouseenter"),g==="mouseout"&&(g="mouseleave");const y=this.interactionsByType.get(g)||new Map;g==="mouseenter"||g==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,l)):y.size===0&&this.map.on(g,this.handleType),y.size===0&&this.interactionsByType.set(g,y),y.set(t,l),this.typeById.set(t,g)}get(t){const l=this.typeById.get(t);if(!l)return;const d=this.interactionsByType.get(l);return d?d.get(t):void 0}remove(t){const l=this.typeById.get(t);if(!l)return;this.typeById.delete(t),this.filters.delete(t);const d=this.interactionsByType.get(l);d&&(d.delete(t),l==="mouseenter"||l==="mouseleave"?(this.delegatedInteractions.delete(t),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):d.size===0&&this.map.off(l,this.handleType))}queryTargets(t,l){const d=[];for(const[g,y]of l)y.target&&d.push({targetId:g,target:y.target,filter:this.filters.get(g)});return this.map.style.queryRenderedTargets(t,d,this.map.transform)}handleMove(t){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const l=this.queryTargets(t.point,Array.from(this.delegatedInteractions).reverse());l.length&&(t.type="mouseenter",this.handleType(t,l));const d=new Map;for(const[g,{feature:y}]of this.prevHoveredFeatures)this.hoveredFeatures.has(g)||d.set(y.id,y);d.size&&(t.type="mouseleave",this.handleType(t,Array.from(d.values())))}handleOut(t){const l=Array.from(this.hoveredFeatures.values()).map(({feature:d})=>d);l.length&&(t.type="mouseleave",this.handleType(t,l)),this.hoveredFeatures.clear()}handleType(t,l){const d=t.type==="mouseenter";if(d&&!this.interactionsByType.has(t.type))return void o.w("mouseenter interaction required for mouseleave to work.");const g=Array.from(this.interactionsByType.get(t.type)).reverse(),y=!!l;l=l||this.queryTargets(t.point,g);let x=!1;const T=new Set;for(const E of l){for(const[L,P]of g){if(!P.target)continue;const z=E.variants?E.variants[L]:null;if(z){for(const O of z){if(Ru(O,E,T,L))continue;const B=new o.dx(E,O),G=Zs(O,E,L);y&&B.id!==void 0&&(B.state=this.map.getFeatureState(B));const V=d?this.prevHoveredFeatures.get(G):null,W=new uv(t,L,P,B),Y=V?V.stop:P.handler(W);if(d&&this.hoveredFeatures.set(G,{feature:E,stop:Y}),Y!==!1){x=!0;break}}if(x)break}}if(x)break}if(!x)for(const[E,L]of g){const{handler:P,target:z}=L;if(!z&&P(new uv(t,E,L,null))!==!1)break}}}function z1(h,t){if(Array.isArray(h)&&Array.isArray(t)){const l=new Set(h),d=new Set(t);return l.size===d.size&&h.every(g=>d.has(g))}return o.by(h,t)}const _h={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},hv={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vm{constructor(t,l,d=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Wd({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,d&&(this.mousePitch=new qd({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),o.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(t,l){this.mouseRotate.mousedown(t,l),this.mousePitch&&this.mousePitch.mousedown(t,l),ke()}move(t,l){const d=this.map,g=this.mouseRotate.mousemoveWindow(t,l),y=g&&g.bearingDelta;if(y&&d.setBearing(d.getBearing()+y),this.mousePitch){const x=this.mousePitch.mousemoveWindow(t,l),T=x&&x.pitchDelta;T&&d.setPitch(d.getPitch()+T)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Be(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(t){this.down(Object.assign({},t,{ctrlKey:!0,preventDefault:()=>t.preventDefault()}),ct(this.element,t)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,ct(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){t.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=lt(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){t.targetTouches.length!==1?this.reset():(this._lastPos=lt(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){t.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function yh(h,t,l){if(h=new o.aT(h.lng,h.lat),t){const d=new o.aT(h.lng-360,h.lat),g=new o.aT(h.lng+360,h.lat),y=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),x=l.locationPoint3D(h).distSqr(t),T=t.x<0||t.y<0||t.x>l.width||t.y>l.height;l.locationPoint3D(d).distSqr(t)<x&&(T||Math.abs(d.lng-l.center.lng)<y)?h=d:l.locationPoint3D(g).distSqr(t)<x&&(T||Math.abs(g.lng-l.center.lng)<y)&&(h=g)}for(;Math.abs(h.lng-l.center.lng)>180;){const d=l.locationPoint3D(h);if(d.x>=0&&d.y>=0&&d.x<=l.width&&d.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const No={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},eo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Gr extends o.E{constructor(t,l){super(),(t instanceof HTMLElement||l)&&(t=Object.assign({element:t},l)),o.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:d="center",color:g="#3FB1CE",scale:y=1,draggable:x=!1,clickTolerance:T=0,rotation:E=eo.rotation,rotationAlignment:L=eo.rotationAlignment,pitchAlignment:P=eo.pitchAlignment,occludedOpacity:z=eo.occludedOpacity,altitude:O=eo.altitude}=t||{};this._anchor=d,this._color=g,this._scale=y,this._draggable=x,this._clickTolerance=T,this._rotation=E,this._rotationAlignment=L,this._pitchAlignment=P,this._occludedOpacity=z,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=o.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",V=>{V.preventDefault()}),this._element.addEventListener("mousedown",V=>{V.preventDefault()});const B=this._element.classList;for(const V in No)B.remove(`mapboxgl-marker-anchor-${V}`);B.add(`mapboxgl-marker-anchor-${this._anchor}`);const G=t&&t.className?t.className.trim().split(/\s+/):[];B.add(...G),this._popup=null}_createDefaultMarker(){const t=xe("div"),l=Ee("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},t);if(this._altitude===0){const d=Ee("radialGradient",{id:"shadowGradient"},Ee("defs",{},l));Ee("stop",{offset:"10%","stop-opacity":.4},d),Ee("stop",{offset:"100%","stop-opacity":.05},d),Ee("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},l)}return Ee("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},l),Ee("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},l),Ee("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},l),t}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=o.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(t){return t===this._altitude||(this._defaultMarker&&(this._altitude===0&&t!==0||this._altitude!==0&&t===0)&&(this._element=this._createDefaultMarker()),this._altitude=t||eo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const g=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(38.1-13.5+g)],"bottom-right":[-g,-1*(38.1-13.5+g)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=t,t._marker=this,t._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const l=t.code,d=t.charCode||t.keyCode;l!=="Space"&&l!=="Enter"&&d!==32&&d!==13||this.togglePopup()}_onMapClick(t){const l=t.originalEvent.target,d=this._element;this._popup&&(l===d||d.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const t=this._map,l=this._pos;if(!t||!l)return!1;const d=t.unproject(l,this._altitude),g=t.getFreeCameraOptions();if(!g.position)return!1;const y=g.position.toLngLat();return y.distanceTo(d)<.9*y.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const l=this._pos;if(!l||l.x<0||l.x>t.transform.width||l.y<0||l.y>t.transform.height)return void this._clearFadeTimer();const d=t.unproject(l,this._altitude);let g;t._showingGlobe()&&o.f5(t.transform,this._lngLat)?g=0:(g=1-t._queryFogOpacity(d),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(g*=this._occludedOpacity)),this._element.style.opacity=`${g}`,this._element.style.pointerEvents=g>0?"auto":"none",this._popup&&this._popup._setOpacity(g),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${t.x}px,${t.y}px)
            ${No[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${l.x}px,${l.y}px)
        `}_calculateXYTransform(){const t=this._pos,l=this._map,d=this.getPitchAlignment();if(!l||!t||d!=="map")return"";if(!l._showingGlobe()){const E=l.getPitch();return E?`rotateX(${E}deg)`:""}const g=o.cX(o.f6(l.transform,this._lngLat)),y=t.sub(o.f7(l.transform)),x=Math.abs(y.x)+Math.abs(y.y);if(x===0)return"";const T=g/x;return`rotateX(${-y.y*T}deg) rotateY(${y.x*T}deg)`}_calculateZTransform(){const t=this._pos,l=this._map;if(!l||!t)return"";let d=0;const g=this.getRotationAlignment();if(g==="map")if(l._showingGlobe()){const y=l.project(new o.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),x=l.project(new o.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(y);d=o.cX(Math.atan2(x.y,x.x))-90}else d=-l.getBearing();else if(g==="horizon"){const y=o.ah(4,6,l.getZoom()),x=o.f7(l.transform);x.y+=y*l.transform.height;const T=t.sub(x),E=o.cX(Math.atan2(T.y,T.x));d=(E>90?E-270:E+90)*(1-y)}return d+=this._rotation,d?`rotateZ(${d}deg)`:""}_update(t){cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=yh(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat,this._altitude),t===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=o.P.convert(t),this._update(),this}addClassName(t){return this._element.classList.add(t),this}removeClassName(t){return this._element.classList.remove(t),this}toggleClassName(t){return this._element.classList.toggle(t)}_onMove(t){const l=this._map;if(!l)return;const d=this._pointerdownPos,g=this._positionDelta;if(d&&g){if(!this._isDragging){const y=this._clickTolerance||l._clickTolerance;if(t.point.dist(d)<y)return;this._isDragging=!0}this._pos=t.point.sub(g),this._lngLat=l.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.z("dragstart"))),this.fire(new o.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.z("dragend")),this._state="inactive"}_addDragHandler(t){const l=this._map,d=this._pos;l&&d&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(d),this._pointerdownPos=t.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const l=this._map;return l&&(t?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||eo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||eo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t||eo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(t){return this._occludedOpacity=t||eo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const to={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1,showButton:!0,followUserLocation:!0},vh={maxWidth:100,unit:"metric"},Yd={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},dv={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},B1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Hc(h=new o.P(0,0),t="bottom"){if(typeof h=="number"){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(t){case"top":return new o.P(0,h);case"top-left":return new o.P(l,l);case"top-right":return new o.P(-l,l);case"bottom":return new o.P(0,-h);case"bottom-left":return new o.P(l,-l);case"bottom-right":return new o.P(-l,-l);case"left":return new o.P(h,0);case"right":return new o.P(-h,0)}return new o.P(0,0)}return h instanceof o.P||Array.isArray(h)?o.P.convert(h):o.P.convert(h[t]||[0,0])}return{version:D,supported:ce.supported,setRTLTextPlugin:o.fb,getRTLTextPluginStatus:o.fa,Map:class extends sv{constructor(h){J.mark(j.create);const t=h;if((h=Object.assign({},_h,h)).minZoom!=null&&h.maxZoom!=null&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(h.minPitch!=null&&h.maxPitch!=null&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(h.minPitch!=null&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(h.maxPitch!=null&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&o.f3(window)&&(h.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new dd(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies,null,null),h),this._repaint=!!h.repaint,this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new lv,this._domRenderTaskQueue=new lv,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.b2(),this._locale=Object.assign({},cv,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._tessellationStep=h.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=h.precompilePrograms,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new xr(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=h.scaleFactor,this._requestManager=new bi(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,this._contextCreateOptions=h.contextCreateOptions?Object.assign({},h.contextCreateOptions):{},typeof h.container=="string"){const l=document.getElementById(h.container);if(!l)throw new Error(`Container '${h.container.toString()}' not found.`);this._container=l}else{if(!(h.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),this._spriteFormat=h.spriteFormat,o.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new nv(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,(h.style||!h.testMode)&&this.setStyle(h.style||o.e.DEFAULT_STYLE,{config:h.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),h.hash&&(this._hash=new as(typeof h.hash=="string"&&h.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){t.center==null&&t.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch});const l=h.bounds;l&&(this.resize(),this.fitBounds(l,Object.assign({},h.fitBoundsOptions,{duration:0})))}this.resize(),h.attributionControl&&this.addControl(new ov({customAttribution:h.customAttribution})),this._logoControl=new av,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent()}),this.on("data",l=>{this._update(l.dataType==="style"),this.fire(new o.z(`${l.dataType}data`,l))}),this.on("dataloading",l=>{this.fire(new o.z(`${l.dataType}dataloading`,l))}),this._interactions=new O1(this)}_getMapId(){return this._mapId}addControl(h,t){if(t===void 0&&(t=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new o.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const d=this._controlPositions[t];return t.indexOf("bottom")!==-1?d.insertBefore(l,d.firstChild):d.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new o.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const t=this._controls.indexOf(h);return t>-1&&this._controls.splice(t,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const t=!this._moving;return t&&this.fire(new o.z("movestart",h)).fire(new o.z("move",h)),this.fire(new o.z("resize",h)),t&&this.fire(new o.z("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(o.aI.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new o.z("zoomstart")).fire(new o.z("zoom")).fire(new o.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new o.z("pitchstart")).fire(new o.z("pitch")).fire(new o.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(h){return this._scaleFactor=h,this.painter.scaleFactor=h,this.style&&this.style._setLabelPlacementStale(),this.style._updateFilteredLayers(t=>t.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return h==="auto"?navigator.language:Array.isArray(h)?h.length===0?void 0:h.map(t=>t==="auto"?navigator.language:t):h}setLanguage(h){const t=this._parseLanguage(h);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(h){return this._lazyInitEmptyStyle(),h?typeof h=="string"&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const h=this.transform,t=h.projection.name;let l;t==="globe"&&h.zoom>=o.cL?(h.setMercatorFromTransition(),l=!0):t==="mercator"&&h.zoom<o.cL&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(h,t){return this._updateProjection(h||t||{name:"mercator"})}_updateProjection(h){let t;const l=this.transform.mercatorFromTransition;t=h.name==="globe"&&this.transform.zoom>=o.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate();const d=this.transform.getProjection().name==="mercator"&&l!==this.transform.mercatorFromTransition;return(t||d)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(h,t){return this.transform.locationPoint3D(o.aT.convert(h),t)}unproject(h,t){return this.transform.pointLocation3D(o.P.convert(h),t)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,t,l){const d=g=>{let y=[];if(Array.isArray(t)){const x=t.filter(T=>this.getLayer(T));y=x.length?this.queryRenderedFeatures(g,{layers:x}):[]}else y=this.queryRenderedFeatures(g,{target:t});return y};if(h==="mouseenter"||h==="mouseover"){let g=!1;return{listener:l,targets:t,delegates:{mousemove:x=>{const T=d(x.point);T.length?g||(g=!0,l.call(this,new Tn(h,this,x.originalEvent,{features:T}))):g=!1},mouseout:()=>{g=!1}}}}if(h==="mouseleave"||h==="mouseout"){let g=!1;return{listener:l,targets:t,delegates:{mousemove:T=>{d(T.point).length?g=!0:g&&(g=!1,l.call(this,new Tn(h,this,T.originalEvent)))},mouseout:T=>{g&&(g=!1,l.call(this,new Tn(h,this,T.originalEvent)))}}}}{const g=y=>{const x=d(y.point);x.length&&(y.features=x,l.call(this,y),delete y.features)};return{listener:l,targets:t,delegates:{[h]:g}}}}on(h,t,l){if(typeof t=="function"||l===void 0)return super.on(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(d);for(const g in d.delegates)this.on(g,d.delegates[g]);return this}once(h,t,l){if(typeof t=="function"||l===void 0)return super.once(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._createDelegatedListener(h,t,l);for(const g in d.delegates)this.once(g,d.delegates[g]);return this}off(h,t,l){if(typeof t=="function"||l===void 0)return super.off(h,t);if(typeof t=="string"&&(t=[t]),!this._areTargetsValid(t))return this;const d=this._delegatedListeners?this._delegatedListeners[h]:void 0;return d&&(g=>{for(let y=0;y<g.length;y++){const x=g[y];if(x.listener===l&&z1(x.targets,t)){for(const T in x.delegates)this.off(T,x.delegates[T]);return g.splice(y,1),this}}})(d),this}queryRenderedFeatures(h,t){if(!this.style)return[];if(h===void 0||h instanceof o.P||Array.isArray(h)||t!==void 0||(t=h,h=void 0),h=h||[[0,0],[this.transform.width,this.transform.height]],!t){const y=this.style.queryRenderedFeatures(h,void 0,this.transform),x=this.style.queryRenderedFeatureset(h,void 0,this.transform);return y.concat(x)}let l=!0;if(t.target&&(l=this._isTargetValid(t.target),l&&!t.layers))return this.style.queryRenderedFeatureset(h,t,this.transform);let d=!0;if(t.layers&&Array.isArray(t.layers)){for(const y of t.layers)if(!this._isValidId(y)){d=!1;break}if(d&&!t.target)return this.style.queryRenderedFeatures(h,t,this.transform)}let g=[];return d&&(g=g.concat(this.style.queryRenderedFeatures(h,t,this.transform))),l&&(g=g.concat(this.style.queryRenderedFeatureset(h,t,this.transform))),g}querySourceFeatures(h,t){return!h||typeof h=="string"&&!this._isValidId(h)?[]:this.style.querySourceFeatures(h,t)}queryRasterValue(h,t,l){return this._isValidId(h)?this.style.queryRasterValue(h,t,l):Promise.resolve(null)}isPointOnSurface(h){const{name:t}=this.transform.projection;return t!=="globe"&&t!=="mercator"&&o.w(`${t} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(h))}addInteraction(h,t){return this._interactions.add(h,t),this}removeInteraction(h){return this._interactions.remove(h),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(h){return this._cooperativeGestures=h,this}setStyle(h,t){return t=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},t),this.style&&h&&t.diff!==!1&&t.localFontFamily===this._localFontFamily&&t.localIdeographFontFamily===this._localIdeographFontFamily&&!t.config?(this.style._diffStyle(h,(l,d)=>{if(l){const g=typeof l=="string"?l:l instanceof Error?l.message:l.error;o.w(`Unable to perform style diff: ${g}. Rebuilding the style from scratch.`),this._updateStyle(h,t)}else d&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=t.localIdeographFontFamily,this._localFontFamily=t.localFontFamily,this._updateStyle(h,t))}_getUIString(h){const t=this._locale[h];if(t==null)throw new Error(`Missing UI string '${h}'`);return t}_updateStyle(h,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h){const l=Object.assign({},t);t&&t.config&&(l.initialConfig=t.config,delete l.config),this.style=new zs(this,l).load(h),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new zs(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(h){return h==null?(this.fire(new o.y(new Error("IDs can't be empty."))),!1):!o.dr(h)||(this.fire(new o.y(new Error(`IDs can't contain special symbols: "${h}".`))),!1)}_isTargetValid(h){return"featuresetId"in h?this._isValidId("importId"in h?h.importId:h.featuresetId):"layerId"in h&&this._isValidId(h.layerId)}_areTargetsValid(h){if(Array.isArray(h)){for(const t of h)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(h)}addSource(h,t){return this._isValidId(h)?(this._lazyInitEmptyStyle(),this.style.addSource(h,t),this._update(!0)):this}isSourceLoaded(h){return!!this._isValidId(h)&&!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(h,t,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,t,l)}removeSource(h){return this._isValidId(h)?(this.style.removeSource(h),this._updateTerrain(),this._update(!0)):this}getSource(h){return this._isValidId(h)?this.style.getOwnSource(h):null}addImage(h,t,{pixelRatio:l=1,sdf:d=!1,stretchX:g,stretchY:y,content:x}={}){this._lazyInitEmptyStyle();const T=o.I.from(h);if(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap){const{width:E,height:L,data:P}=o.o.getImageData(t);this.style.addImage(T,{data:new o.q({width:E,height:L},P),pixelRatio:l,stretchX:g,stretchY:y,content:x,sdf:d,version:0,usvg:!1})}else if(t.width===void 0||t.height===void 0)this.fire(new o.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:E,height:L}=t,P=t;this.style.addImage(T,{data:new o.q({width:E,height:L},new Uint8Array(P.data)),pixelRatio:l,stretchX:g,stretchY:y,content:x,sdf:d,usvg:!1,version:0,userImage:P}),P.onAdd&&P.onAdd(this,h)}}updateImage(h,t){this._lazyInitEmptyStyle();const l=o.I.from(h),d=this.style.getImage(l);if(!d)return void this.fire(new o.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap?o.o.getImageData(t):t,{width:y,height:x,data:T}=g;if(y===void 0||x===void 0)return void this.fire(new o.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(y!==(d.usvg?d.icon.usvg_tree.width:d.data.width)||x!==(d.usvg?d.icon.usvg_tree.height:d.data.height))return void this.fire(new o.y(new Error(`The width and height of the updated image (${y}, ${x})
                must be that same as the previous version of the image
                (${d.data.width}, ${d.data.height})`)));const E=!(t instanceof HTMLImageElement||ImageBitmap&&t instanceof ImageBitmap);let L=!1;d.usvg?(d.data=new o.q({width:y,height:x},new Uint8Array(T)),d.usvg=!1,d.icon=void 0,L=!0):d.data.replace(T,E),this.style.updateImage(l,d,L)}hasImage(h){return h?!!this.style&&!!this.style.getImage(o.I.from(h)):(this.fire(new o.y(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(o.I.from(h))}loadImage(h,t){o.n(this._requestManager.transformRequest(h,o.R.Image),(l,d)=>{t(l,d instanceof HTMLImageElement?o.o.getImageData(d):d)})}listImages(){return this.style.listImages().map(h=>h.name)}addModel(h,t){this._lazyInitEmptyStyle(),this.style.addModel(h,t)}hasModel(h){return h?this.style.hasModel(h):(this.fire(new o.y(new Error("Missing required model id"))),!1)}removeModel(h){this.style.removeModel(h)}listModels(){return this.style.listModels()}addLayer(h,t){return this._isValidId(h.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(h,t),this._update(!0)):this}getSlot(h){const t=this.getLayer(h);return t&&t.slot||null}setSlot(h,t){return this.style.setSlot(h,t),this.style.mergeLayers(),this._update(!0)}addImport(h,t){return this.style.addImport(h,t).catch(l=>this.fire(new o.y(new Error("Failed to add import",l)))),this}updateImport(h,t){return typeof t!="string"&&t.id!==h?(this.removeImport(h),this.addImport(t)):(this.style.updateImport(h,t),this._update(!0))}removeImport(h){return this.style.removeImport(h),this}moveImport(h,t){return this.style.moveImport(h,t),this._update(!0)}moveLayer(h,t){return this._isValidId(h)?(this.style.moveLayer(h,t),this._update(!0)):this}removeLayer(h){return this._isValidId(h)?(this.style.removeLayer(h),this._update(!0)):this}getLayer(h){if(!this._isValidId(h))return null;const t=this.style.getOwnLayer(h);return t?t.type==="custom"?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(h,t,l){return this._isValidId(h)?(this.style.setLayerZoomRange(h,t,l),this._update(!0)):this}setFilter(h,t,l={}){return this._isValidId(h)?(this.style.setFilter(h,t,l),this._update(!0)):this}getFilter(h){return this._isValidId(h)?this.style.getFilter(h):null}setPaintProperty(h,t,l,d={}){return this._isValidId(h)?(this.style.setPaintProperty(h,t,l,d),this._update(!0)):this}getPaintProperty(h,t){return this._isValidId(h)?this.style.getPaintProperty(h,t):null}setLayoutProperty(h,t,l,d={}){return this._isValidId(h)?(this.style.setLayoutProperty(h,t,l,d),this._update(!0)):this}getLayoutProperty(h,t){return this._isValidId(h)?this.style.getLayoutProperty(h,t):null}setLayerProperty(h,t,l,d={}){return this._isValidId(h)?(t==="appearances"&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(h,t,l,d),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(h){return this.style.setGlyphsUrl(h),this._update(!0)}getSchema(h){return this.style.getSchema(h)}setSchema(h,t){return this.style.setSchema(h,t),this._update(!0)}getConfig(h){return this.style.getConfig(h)}setConfig(h,t){return this.style.setConfig(h,t),this._update(!0)}getConfigProperty(h,t){return this.style.getConfigProperty(h,t)}setConfigProperty(h,t,l){return this.style.setConfigProperty(h,t,l),this._update(!0)}getFeaturesetDescriptors(h){return this.style.getFeaturesetDescriptors(h)}setLights(h){if(this._lazyInitEmptyStyle(),h&&h.length===1&&h[0].type==="flat"){const t=h[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(h),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const h=this.style.getLights()||[];return h.length===0&&h.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),h}setLight(h,t={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:h}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(h){return this._lazyInitEmptyStyle(),this.style.setSnow(h),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(h){return this._lazyInitEmptyStyle(),this.style.setRain(h),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(h){return this._lazyInitEmptyStyle(),this.style.setColorTheme(h),this._update(!0)}setImportColorTheme(h,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(h,t),this._update(!0)}setCamera(h){return this.style.setCamera(h),this._triggerCameraUpdate(h)}_triggerCameraUpdate(h){return this._update(this.transform.setOrthographicProjectionAtLowPitch(h["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.aT.convert(h),this.transform):0}setFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.setFeatureState(h,t),this._update())}removeFeatureState(h,t){return h.source&&!this._isValidId(h.source)?this:(this.style.removeFeatureState(h,t),this._update())}getFeatureState(h){return h.source&&!this._isValidId(h.source)?null:this.style.getFeatureState(h)}_selectIndoorFloor(h){this.style.indoorManager.selectFloor(h)}_setIndoorActiveFloorsVisibility(h){this.style.indoorManager.setActiveFloorsVisibility(h)}getIndoorTileOptions(h,t){return this.style.isIndoorEnabled()?this.style.indoorManager.getIndoorTileOptions(h,t):null}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let l,d,g,y=this._container;for(;y&&(!d||!g);){const x=window.getComputedStyle(y).transform;x&&x!=="none"&&(l=x.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&l[0]!=="0"&&l[0]!=="1"&&(d=l[0]),l[3]&&l[3]!=="0"&&l[3]!=="1"&&(g=l[3])),y=y.parentElement}this._containerWidth=d?Math.abs(h/d):h,this._containerHeight=g?Math.abs(t/g):t}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=xe("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=xe("div","mapboxgl-canvas-container",h);this._canvas=xe("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=xe("div","mapboxgl-control-container",h),d=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(g=>{d[g]=xe("div",`mapboxgl-ctrl-${g}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,t){const l=o.o.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(t),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${t}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const t=this._markers.indexOf(h);t!==-1&&this._markers.splice(t,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const t=this._popups.indexOf(h);t!==-1&&this._popups.splice(t,1)}_setupPainter(){const h=Object.assign({},ce.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),t=this._canvas.getContext("webgl2",h);t?(es(t,!0),this.painter=new Wy(t,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",l=>{if(l.dataType==="source"){const d=this.transform.elevation?this.transform.elevation._source():null;d&&l.sourceCacheId===d.id&&this.style&&this.style._setLabelPlacementStale(),this.painter.setTileLoadedFlag(!0)}}),o.k.testSupport(t)):this.fire(new o.y(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.z("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.z("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let t;this.fire(new o.z("renderstart")),++this._frameId;const l=this.painter.context.extTimerQuery,d=o.o.now(),g=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(t=g.createQuery(),g.beginQuery(l.TIME_ELAPSED_EXT,t)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const y=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const E=this.transform.zoom,L=this.transform.pitch,P=o.o.now(),z=new o.ac(E,{now:P,fadeDuration:y,pitch:L,transition:this.style.transition,worldview:this._worldview});this.style.update(z)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let x=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),x=this._updateAverageElevation(d),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):x=this._updateAverageElevation(d),this.style&&(this._placementDirty=this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,y,this._crossSourceCollisions,this.painter.replacementSource)),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:y,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,J.mark(j.load),this.fire(new o.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),t){const E=o.o.now()-d;g.endQuery(l.TIME_ELAPSED_EXT),setTimeout(()=>{const L=g.getQueryParameter(t,g.QUERY_RESULT)/1e6;g.deleteQuery(t),this.fire(new o.z("gpu-timing-frame",{cpuTime:E,gpuTime:L}))},50)}if(this.listens("gpu-timing-layer")){const E=this.painter.collectGpuTimers();setTimeout(()=>{const L=this.painter.queryGpuTimers(E);this.fire(new o.z("gpu-timing-layer",{layerTimes:L}))},50)}if(this.listens("gpu-timing-deferred-render")){const E=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const L=this.painter.queryGpuTimeDeferredRender(E);this.fire(new o.z("gpu-timing-deferred-render",{gpuTime:L}))},50)}const T=this._sourcesDirty||this._styleDirty||this._placementDirty||x;if(T||this._repaint)this.triggerRepaint();else{const E=this.idle();if(E&&(x=this._updateAverageElevation(d,!0)),x)this.triggerRepaint();else if(this._triggerFrame(!1),E&&(this.fire(new o.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const L=this._calculateSpeedIndex();this.fire(new o.z("speedindexcompleted",{speedIndex:L})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||T||(this._fullyLoaded=!0,J.mark(j.fullLoad),this._performanceMetricsCollection&&or(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const t of this._markers)h&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!h||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(h,t=!1){const l=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&l(0);const d=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(d||(t||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const g=this.transform.averageElevation;let y=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(y)?y=0:this._averageElevationLastSampledAt=h;const x=Math.abs(g-y);if(x>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(y),l(y);this._averageElevation.easeTo(y,h,300)}else if(x>1e-4)return this._averageElevation.jumpTo(y),l(y)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){ar(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===Ut||h.status===401)){const t=this.painter.context.gl;es(t,!1),this._logoControl instanceof av&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),wt(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&pr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&Si(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){Di(this._requestManager._customAccessToken)}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const l=this.painter.context.gl,d=l.createFramebuffer();function g(y){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,y,0);const x=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,x),x}return l.bindFramebuffer(l.FRAMEBUFFER,d),this._canvasPixelComparison(g(h),t.canvasCopies.map(g),t.timeStamps)}_canvasPixelComparison(h,t,l){let d=l[1]-l[0];const g=h.length/4;for(let y=0;y<t.length;y++){const x=t[y];let T=0;for(let E=0;E<x.length;E+=4)x[E]===h[E]&&x[E+1]===h[E+1]&&x[E+2]===h[E+2]&&x[E+3]===h[E+3]&&(T+=1);d+=(l[y+2]-l[y+1])*(1-T/g)}return d}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),Qo.delete(this.painter.context.gl),Ls.remove(),di.remove(),this._removed=!0,this.fire(new o.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=o.o.frame(t=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(t)}))}_preloadTiles(h){const t=this.style?this.style.getSourceCaches():[];return o.bw(t,(l,d)=>l._preloadTiles(h,d),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(h){this._showParseStatus!==h&&(this._showParseStatus=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(h){this._showLayers2DWireframe!==h&&(this._showLayers2DWireframe=h,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(h){this._showLayers3DWireframe!==h&&(this._showLayers3DWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,this.style&&h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,t){o.f4(h,t)}get version(){return D}},NavigationControl:class{constructor(h={}){this.options=Object.assign({},hv,h),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(o.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),xe("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:t}):l.resetNorth({},{originalEvent:t}))}),this._compassIcon=xe("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const t=h.getZoom(),l=t===h.getMaxZoom(),d=t===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=d,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",d.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const t=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vm(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,t){const l=xe("button",h,this._container);return l.type="button",l.addEventListener("click",t),l}_setButtonTitle(h,t){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${t}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends o.E{constructor(h={}){super();const t=navigator.geolocation;this.options=Object.assign({geolocation:t},to,h),o.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=qy(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._clearRequestTimeout(),this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const t=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};this._supportsGeolocation!==void 0?h(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(l=>t(l.state!=="denied")).catch(()=>t()):t()}_isOutOfMapMaxBounds(h){const t=this._map.getMaxBounds(),l=h.coords;return!!t&&(l.longitude<t.getWest()||l.longitude>t.getEast()||l.latitude<t.getSouth()||l.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._clearRequestTimeout(),this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new o.z("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this.options.followUserLocation?(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active")):(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"));break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(h),this.options.followUserLocation&&(!this.options.trackUserLocation||this._watchState==="ACTIVE_LOCK")&&this._updateCamera(h),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("geolocate",Object.assign({coords:h.coords,timestamp:h.timestamp},h.toJSON?{toJSON:h.toJSON.bind(h)}:{}))),this._finish()}}_updateCamera(h){const t=new o.aT(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,d=this._map.getBearing(),g=Object.assign({bearing:d},this.options.fitBoundsOptions);this._map.fitBounds(t.toBounds(l),g,{geolocateSource:!0})}_updateMarker(h){if(h){const t=new o.aT(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(t).addTo(this._map),this._userLocationDotMarker.setLngLat(t).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,t=o.cf(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*t);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this._clearRequestTimeout(),this.options.trackUserLocation)if(h.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(h.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.z("error",{code:h.code,message:h.message,PERMISSION_DENIED:h.PERMISSION_DENIED,POSITION_UNAVAILABLE:h.POSITION_UNAVAILABLE,TIMEOUT:h.TIMEOUT})),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_startRequestTimeout(){this._clearRequestTimeout();const h=this.options.positionOptions.timeout;h&&(this._requestTimeoutId=window.setTimeout(()=>{this._onError({code:3,message:"Geolocation request timed out"})},h))}_clearRequestTimeout(){this._requestTimeoutId!==void 0&&(clearTimeout(this._requestTimeoutId),this._requestTimeoutId=void 0)}_setupUI(h){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=xe("button","mapboxgl-ctrl-geolocate",this._container),xe("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",h===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=xe("div","mapboxgl-user-location"),this._dotElement.appendChild(xe("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(xe("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gr({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=xe("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gr({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.showButton||(this._container.style.display="none"),this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||this._watchState!=="ACTIVE_LOCK"||t.originalEvent&&t.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.z("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:h.absolute===!0&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this._startRequestTimeout(),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._startRequestTimeout(),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}setFollowUserLocation(h){return this.options.followUserLocation=h??to.followUserLocation,this.options.trackUserLocation&&this._watchState!=="OFF"&&(this.options.followUserLocation?this._watchState!=="BACKGROUND"&&this._watchState!=="BACKGROUND_ERROR"||(this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.z("trackuserlocationstart"))):this._watchState!=="ACTIVE_LOCK"&&this._watchState!=="ACTIVE_ERROR"||(this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this.fire(new o.z("trackuserlocationend")))),this}_addDeviceOrientationListener(){const h=()=>{const t="ondeviceorientationabsolute"in window?"deviceorientationabsolute":"deviceorientation";window.addEventListener(t,this._onDeviceOrientation)};typeof DeviceOrientationEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(t=>{t==="granted"&&h()}).catch(console.error):h()}_clearWatch(){this._clearRequestTimeout(),this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ov,ScaleControl:class{constructor(h={}){this.options=Object.assign({},vh,h),o.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,t=this._map,l=t._containerHeight/2,d=t._containerWidth/2-h/2,g=t.unproject([d,l]),y=t.unproject([d+h,l]),x=g.distanceTo(y);if(this.options.unit==="imperial"){const T=3.2808*x;T>5280?this._setScale(h,T/5280,"mile"):this._setScale(h,T,"foot")}else this.options.unit==="nautical"?this._setScale(h,x/1852,"nautical-mile"):x>=1e3?this._setScale(h,x/1e3,"kilometer"):this._setScale(h,x,"meter")}_setScale(h,t,l){this._map._requestDomTask(()=>{const d=function(y){const x=Math.pow(10,`${Math.floor(y)}`.length-1);let T=y/x;return T=T>=10?10:T>=5?5:T>=3?3:T>=2?2:T>=1?1:function(E){const L=Math.pow(10,Math.ceil(-Math.log(E)/Math.LN10));return Math.round(E*L)/L}(T),x*T}(t),g=d/t;this._container.innerHTML=l!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(d):`${d}&nbsp;${Yd[l]}`,this._container.style.width=h*g+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=xe("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h={}){this._fullscreen=!1,h&&h.container&&(h.container instanceof HTMLElement?this._container=h.container:o.w("Full screen control 'container' must be a DOM element.")),o.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=xe("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=xe("button","mapboxgl-ctrl-fullscreen",this._controlContainer);xe("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Rp,Popup:class extends o.E{constructor(h){super(),this.options=Object.assign(Object.create(dv),h),this._altitude=this.options.altitude,o.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new o.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new o.z("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=o.aT.convert(h),this._pos=null,this._trackPointer=!1,this._update();const t=this._map;return t&&(t.on("move",this._update),t.off("mousemove",this._onMouseEvent),t._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(h){return this._altitude=h,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(document.createTextNode(h))}setHTML(h){const t=document.createDocumentFragment(),l=document.createElement("body");let d;for(l.innerHTML=h;d=l.firstChild,d;)t.appendChild(d);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=xe("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(h),this.options.closeButton){const l=this._closeButton=xe("button","mapboxgl-popup-close-button",t);l.type="button",l.setAttribute("aria-label","Close popup"),l.innerHTML='<span aria-hidden="true">&#215;</span>',l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let t;return this._classList.delete(h)?t=!1:(this._classList.add(h),t=!0),this._updateClassList(),t}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const t=this._map,l=this._container,d=this._pos;if(!t||!l||!d)return"bottom";const g=l.offsetWidth,y=l.offsetHeight,x=d.x<g/2,T=d.x>t.transform.width-g/2;if(d.y+h<y)return x?"top-left":T?"top-right":"top";if(d.y>t.transform.height-y){if(x)return"bottom-left";if(T)return"bottom-right"}return x?"left":T?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),h.className=t.join(" ")}_update(h){const t=this._map,l=this._content;if(!t||!this._lngLat&&!this._trackPointer||!l)return;let d=this._container;if(d||(d=this._container=xe("div","mapboxgl-popup",t.getContainer()),this._tip=xe("div","mapboxgl-popup-tip",d),d.appendChild(l)),this.options.maxWidth&&d.style.maxWidth!==this.options.maxWidth&&(d.style.maxWidth=this.options.maxWidth),t.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=yh(this._lngLat,this._pos,t.transform)),!this._trackPointer||h){const g=this._pos=this._trackPointer&&h instanceof o.P?h:t.project(this._lngLat,this._altitude),y=Hc(this.options.offset),x=this._anchor=this._getAnchor(y.y),T=Hc(this.options.offset,x),E=g.add(T).round();t._requestDomTask(()=>{this._container&&x&&(this._container.style.transform=`${No[x]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&t._showingGlobe()){const g=o.f5(t.transform,this._lngLat)?0:1;this._setOpacity(g)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(B1);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:Gr,Style:zs,LngLat:o.aT,LngLatBounds:o.aI,Point:o.P,MercatorCoordinate:o.ae,FreeCameraOptions:Q_,Evented:o.E,config:o.e,prewarm:o.f9,clearPrewarmedResources:o.f8,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(h){o.e.ACCESS_TOKEN=h},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(h){o.e.API_URL=h},get workerCount(){return o.fi.workerCount},set workerCount(h){o.fi.workerCount=h},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){o.e.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){o.fh(h)},get workerUrl(){return o.fg.workerUrl},set workerUrl(h){o.fg.workerUrl=h},get workerClass(){return o.fg.workerClass},set workerClass(h){o.fg.workerClass=h},get workerParams(){return o.fg.workerParams},set workerParams(h){o.fg.workerParams=h},get dracoUrl(){return o.ff()},set dracoUrl(h){o.fe(h)},get meshoptUrl(){return o.fd()},set meshoptUrl(h){o.fc(h)},setNow:o.o.setNow,restoreNow:o.o.restoreNow}});var A=v;return A})})(rO);var e$=rO.exports;const Kg=_T(e$);Kg.accessToken="pk.eyJ1Ijoib21hcmFtaW4xIiwiYSI6ImNtNmQ3NXBxOTA4OWoya3B2dHRwYWVrdjQifQ.p7dGFEBoNOLWMfKMSJEFEw";const nS={signed_up:"#10b981",not_home:"#6b7280",not_interested:"#ef4444",doesnt_qualify:"#f59e0b",callback:"#3b82f6",wrong_address:"#8b5cf6"},sS={signed_up:" Signed Up",not_home:" Not Home",not_interested:" Not Interested",doesnt_qualify:" Doesn't Qualify",callback:" Callback",wrong_address:" Wrong Address"};function t$(){const n=id(),{currentRep:r}=Pu(),[c,p]=Z.useState("dashboard"),[v,w]=Z.useState([]),[A,o]=Z.useState(!0),[D,j]=Z.useState("all"),[J,ie]=Z.useState("all"),[re,he]=Z.useState([]),ce=Z.useRef(null),xe=Z.useRef(null),Ee=Z.useRef([]);Z.useEffect(()=>{r!=null&&r.isAdmin||n("/")},[r,n]),Z.useEffect(()=>{ve();const Le=Ws.channel("admin-knocks").on("postgres_changes",{event:"*",schema:"public",table:"knocks"},()=>ve()).subscribe();return()=>{Le.unsubscribe()}},[]),Z.useEffect(()=>{if(!(c!=="map"||!ce.current||xe.current))return xe.current=new Kg.Map({container:ce.current,style:"mapbox://styles/mapbox/dark-v11",center:[-77.5,37.5],zoom:8}),()=>{var Le;(Le=xe.current)==null||Le.remove(),xe.current=null}},[c]),Z.useEffect(()=>{if(!xe.current||c!=="map")return;Ee.current.forEach(We=>We.remove()),Ee.current=[];const Le=v.filter(We=>!(D!=="all"&&We.result!==D||J!=="all"&&We.canvasser_id!==J));if(Le.forEach(We=>{const ct=nS[We.result]||"#666",lt=document.createElement("div");lt.innerHTML=`
        <div style="
          width: 14px;
          height: 14px;
          background: ${ct};
          border: 2px solid white;
          border-radius: 50%;
          box-shadow: 0 2px 6px rgba(0,0,0,0.4);
        "></div>
      `;const Pt=new Kg.Marker({element:lt}).setLngLat([We.lng,We.lat]).setPopup(new Kg.Popup({offset:15}).setHTML(`
          <div style="padding: 6px; font-family: system-ui; font-size: 12px;">
            <strong>${We.canvasser_name||"Unknown"}</strong><br>
            <span style="color: ${ct}">${sS[We.result]||We.result}</span><br>
            ${We.address?`<small>${We.address}</small><br>`:""}
            <small style="color: #888">${new Date(We.created_at).toLocaleString()}</small>
          </div>
        `)).addTo(xe.current);Ee.current.push(Pt)}),Le.length>0){const We=new Kg.LngLatBounds;Le.forEach(ct=>We.extend([ct.lng,ct.lat])),xe.current.fitBounds(We,{padding:50,maxZoom:14})}},[v,D,J,c]);const ve=async()=>{o(!0);const Le=new Date;Le.setDate(Le.getDate()-7);const{data:We,error:ct}=await Ws.from("knocks").select("*").gte("created_at",Le.toISOString()).order("created_at",{ascending:!1});!ct&&We&&(w(We),K(We)),o(!1)},K=Le=>{const We=new Date;We.setHours(0,0,0,0);const ct=new Date(Date.now()-2*60*60*1e3),lt=new Map;Le.forEach(zt=>{const _i=zt.canvasser_id,Ut=new Date(zt.created_at);lt.has(_i)||lt.set(_i,{id:_i,name:zt.canvasser_name||"Unknown",totalKnocks:0,deals:0,conversionRate:0,lastActivity:null,todayKnocks:0,status:"idle"});const bi=lt.get(_i);bi.totalKnocks++,zt.result==="signed_up"&&bi.deals++,Ut>=We&&bi.todayKnocks++,(!bi.lastActivity||Ut>bi.lastActivity)&&(bi.lastActivity=Ut)}),lt.forEach(zt=>{zt.conversionRate=zt.totalKnocks>0?Math.round(zt.deals/zt.totalKnocks*100):0,!zt.lastActivity||zt.lastActivity<ct?zt.status="idle":zt.todayKnocks>=20&&zt.conversionRate>=10?zt.status="crushing":zt.todayKnocks>=10||zt.conversionRate>=5?zt.status="good":zt.todayKnocks<5&&zt.lastActivity>ct?zt.status="needs_help":zt.status="good"});const Pt=Array.from(lt.values()).sort((zt,_i)=>_i.todayKnocks-zt.todayKnocks);he(Pt)},fe=Le=>{const We=Math.floor((Date.now()-Le.getTime())/6e4);if(We<1)return"Just now";if(We<60)return`${We}m ago`;const ct=Math.floor(We/60);return ct<24?`${ct}h ago`:`${Math.floor(ct/24)}d ago`},ke=Array.from(new Set(v.map(Le=>Le.canvasser_id))).map(Le=>{const We=v.find(ct=>ct.canvasser_id===Le);return{id:Le,name:(We==null?void 0:We.canvasser_name)||"Unknown"}}),Be=v.filter(Le=>!(D!=="all"&&Le.result!==D||J!=="all"&&Le.canvasser_id!==J));return r!=null&&r.isAdmin?N.jsxs("div",{style:{height:"calc(100vh - 5rem)",display:"flex",flexDirection:"column",background:"var(--bg-primary)"},children:[N.jsxs("div",{style:{padding:"0.75rem 1rem",background:"var(--bg-secondary)",borderBottom:"1px solid var(--bg-card)",display:"flex",alignItems:"center",justifyContent:"space-between"},children:[N.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"0.5rem"},children:[N.jsx(uN,{size:20,color:"var(--accent)"}),N.jsx("span",{style:{fontWeight:600},children:"Admin"})]}),N.jsxs("div",{style:{display:"flex",gap:"0.25rem"},children:[N.jsxs("button",{onClick:()=>p("dashboard"),style:{padding:"0.4rem 0.6rem",background:c==="dashboard"?"var(--accent)":"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"white",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem"},children:[N.jsx(N4,{size:12})," Team"]}),N.jsxs("button",{onClick:()=>p("map"),style:{padding:"0.4rem 0.6rem",background:c==="map"?"var(--accent)":"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"white",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem"},children:[N.jsx(hc,{size:12})," Map"]}),N.jsxs("button",{onClick:()=>p("log"),style:{padding:"0.4rem 0.6rem",background:c==="log"?"var(--accent)":"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"white",display:"flex",alignItems:"center",gap:"0.25rem",fontSize:"0.75rem"},children:[N.jsx(Y4,{size:12})," Log"]})]})]}),N.jsxs("div",{style:{padding:"0.5rem 1rem",background:"var(--bg-secondary)",borderBottom:"1px solid var(--bg-card)",display:"flex",gap:"0.5rem",alignItems:"center",flexWrap:"wrap"},children:[N.jsx(q4,{size:14,color:"var(--text-secondary)"}),N.jsxs("select",{value:J,onChange:Le=>ie(Le.target.value),style:{padding:"0.4rem 0.75rem",background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"0.8rem"},children:[N.jsx("option",{value:"all",children:"All Reps"}),ke.map(Le=>N.jsx("option",{value:Le.id,children:Le.name},Le.id))]}),N.jsxs("select",{value:D,onChange:Le=>j(Le.target.value),style:{padding:"0.4rem 0.75rem",background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-primary)",fontSize:"0.8rem"},children:[N.jsx("option",{value:"all",children:"All Results"}),Object.entries(sS).map(([Le,We])=>N.jsx("option",{value:Le,children:We},Le))]}),N.jsx("button",{onClick:ve,disabled:A,style:{padding:"0.4rem",background:"var(--bg-card)",border:"none",borderRadius:"0.5rem",color:"var(--text-secondary)",display:"flex",alignItems:"center"},children:N.jsx(nN,{size:14,style:{animation:A?"spin 1s linear infinite":"none"}})}),N.jsxs("span",{style:{fontSize:"0.75rem",color:"var(--text-secondary)",marginLeft:"auto"},children:[Be.length," knocks (7 days)"]})]}),c==="dashboard"?N.jsxs("div",{style:{flex:1,overflow:"auto",padding:"0.75rem"},children:[N.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"0.5rem",marginBottom:"1rem"},children:[N.jsxs("div",{style:{background:"#10b981",borderRadius:"0.5rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:re.filter(Le=>Le.status==="crushing").length}),N.jsx("div",{style:{fontSize:"0.65rem",opacity:.9},children:" Crushing"})]}),N.jsxs("div",{style:{background:"#3b82f6",borderRadius:"0.5rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:re.filter(Le=>Le.status==="good").length}),N.jsx("div",{style:{fontSize:"0.65rem",opacity:.9},children:" Good"})]}),N.jsxs("div",{style:{background:"#f59e0b",borderRadius:"0.5rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:re.filter(Le=>Le.status==="needs_help").length}),N.jsx("div",{style:{fontSize:"0.65rem",opacity:.9},children:" Needs Help"})]}),N.jsxs("div",{style:{background:"#6b7280",borderRadius:"0.5rem",padding:"0.75rem",textAlign:"center"},children:[N.jsx("div",{style:{fontSize:"1.5rem",fontWeight:700},children:re.filter(Le=>Le.status==="idle").length}),N.jsx("div",{style:{fontSize:"0.65rem",opacity:.9},children:" Idle"})]})]}),["crushing","good","needs_help","idle"].map(Le=>{const We=re.filter(lt=>lt.status===Le);if(We.length===0)return null;const ct={crushing:{label:" Crushing It",color:"#10b981",bg:"rgba(16,185,129,0.1)"},good:{label:" Doing Good",color:"#3b82f6",bg:"rgba(59,130,246,0.1)"},needs_help:{label:" Needs Help",color:"#f59e0b",bg:"rgba(245,158,11,0.1)"},idle:{label:" Not Moving",color:"#6b7280",bg:"rgba(107,114,128,0.1)"}}[Le];return N.jsxs("div",{style:{marginBottom:"1rem"},children:[N.jsx("div",{style:{fontSize:"0.8rem",fontWeight:600,color:ct.color,marginBottom:"0.5rem",display:"flex",alignItems:"center",gap:"0.5rem"},children:ct.label}),N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:We.map(lt=>N.jsxs("div",{style:{background:ct.bg,borderLeft:`3px solid ${ct.color}`,borderRadius:"0.5rem",padding:"0.75rem",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[N.jsxs("div",{children:[N.jsx("div",{style:{fontWeight:600,fontSize:"0.9rem"},children:lt.name}),N.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:["Last: ",lt.lastActivity?fe(lt.lastActivity):"Never"]})]}),N.jsxs("div",{style:{textAlign:"right"},children:[N.jsxs("div",{style:{fontSize:"0.9rem",fontWeight:600},children:[lt.todayKnocks," ",N.jsx("span",{style:{fontSize:"0.7rem",color:"var(--text-secondary)"},children:"today"})]}),N.jsxs("div",{style:{fontSize:"0.7rem",color:ct.color},children:[lt.deals," deals (",lt.conversionRate,"%)"]})]})]},lt.id))})]},Le)})]}):c==="map"?N.jsx("div",{ref:ce,style:{flex:1}}):N.jsx("div",{style:{flex:1,overflow:"auto",padding:"0.5rem"},children:A?N.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-secondary)"},children:"Loading..."}):Be.length===0?N.jsx("div",{style:{textAlign:"center",padding:"2rem",color:"var(--text-secondary)"},children:"No knocks found"}):N.jsx("div",{style:{display:"flex",flexDirection:"column",gap:"0.5rem"},children:Be.map(Le=>N.jsxs("div",{style:{background:"var(--bg-card)",borderRadius:"0.5rem",padding:"0.75rem",borderLeft:`3px solid ${nS[Le.result]||"#666"}`},children:[N.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"0.25rem"},children:[N.jsx("span",{style:{fontWeight:600,fontSize:"0.9rem"},children:Le.canvasser_name||"Unknown"}),N.jsx("span",{style:{color:nS[Le.result],fontSize:"0.8rem",fontWeight:500},children:sS[Le.result]||Le.result})]}),Le.address&&N.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",display:"flex",alignItems:"center",gap:"0.25rem"},children:[N.jsx(hc,{size:12})," ",Le.address]}),Le.notes&&N.jsxs("div",{style:{fontSize:"0.8rem",color:"var(--text-secondary)",fontStyle:"italic",marginTop:"0.25rem"},children:['"',Le.notes,'"']}),N.jsxs("div",{style:{fontSize:"0.7rem",color:"var(--text-secondary)",marginTop:"0.25rem",display:"flex",alignItems:"center",gap:"0.25rem"},children:[N.jsx(t1,{size:10})," ",new Date(Le.created_at).toLocaleString()]})]},Le.id))})}),N.jsx("style",{children:`
        @keyframes spin {
          from { transform: rotate(0deg); }
          to { transform: rotate(360deg); }
        }
      `})]}):null}function Go({children:n}){const{currentRep:r}=Pu();return r?N.jsx(N.Fragment,{children:n}):N.jsx(b4,{to:"/login",replace:!0})}function i$(){const n=td(),[r,c]=Z.useState(!navigator.onLine),{currentRep:p}=Pu();Z.useEffect(()=>{const w=()=>c(!1),A=()=>c(!0);return window.addEventListener("online",w),window.addEventListener("offline",A),()=>{window.removeEventListener("online",w),window.removeEventListener("offline",A)}},[]);const v=p&&!n.pathname.startsWith("/door/")&&n.pathname!=="/login";return N.jsxs("div",{className:"app",children:[r&&N.jsx("div",{className:"offline-banner",children:" You're offline  data will sync when connected"}),N.jsx("main",{className:"main",children:N.jsxs(S4,{children:[N.jsx(lo,{path:"/login",element:N.jsx(Y7,{})}),N.jsx(lo,{path:"/",element:N.jsx(Go,{children:N.jsx(_N,{})})}),N.jsx(lo,{path:"/map",element:N.jsx(Go,{children:N.jsx(z7,{})})}),N.jsx(lo,{path:"/door/:id",element:N.jsx(Go,{children:N.jsx(G7,{})})}),N.jsx(lo,{path:"/leaderboard",element:N.jsx(Go,{children:N.jsx(U7,{})})}),N.jsx(lo,{path:"/earnings",element:N.jsx(Go,{children:N.jsx(V7,{})})}),N.jsx(lo,{path:"/reference",element:N.jsx(Go,{children:N.jsx($7,{})})}),N.jsx(lo,{path:"/achievements",element:N.jsx(Go,{children:N.jsx(q7,{})})}),N.jsx(lo,{path:"/analytics",element:N.jsx(Go,{children:N.jsx(Z7,{})})}),N.jsx(lo,{path:"/zones",element:N.jsx(Go,{children:N.jsx(X7,{})})}),N.jsx(lo,{path:"/log",element:N.jsx(Go,{children:N.jsx(K7,{})})}),N.jsx(lo,{path:"/feed",element:N.jsx(Go,{children:N.jsx(Q7,{})})}),N.jsx(lo,{path:"/admin",element:N.jsx(Go,{children:N.jsx(t$,{})})}),N.jsx(lo,{path:"/profile",element:N.jsx(Go,{children:N.jsx(J7,{})})})]})}),v&&N.jsxs("nav",{className:"nav",children:[N.jsxs(If,{to:"/",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[N.jsx(gD,{}),N.jsx("span",{children:"Today"})]}),N.jsxs(If,{to:"/map",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[N.jsx(tN,{}),N.jsx("span",{children:"Map"})]}),N.jsxs(If,{to:"/leaderboard",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[N.jsx(wx,{}),N.jsx("span",{children:"Rank"})]}),N.jsxs(If,{to:"/feed",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[N.jsx(rT,{}),N.jsx("span",{children:"Feed"})]}),(p==null?void 0:p.isAdmin)&&N.jsxs(If,{to:"/admin",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[N.jsx(g2,{}),N.jsx("span",{children:"Admin"})]}),N.jsxs(If,{to:"/profile",className:({isActive:w})=>`nav-item ${w?"active":""}`,children:[p!=null&&p.profile_pic?N.jsx("div",{style:{width:"24px",height:"24px",borderRadius:"50%",background:`url(${p.profile_pic}) center/cover`}}):N.jsx(xD,{}),N.jsx("span",{children:"Me"})]})]})]})}oS.createRoot(document.getElementById("root")).render(N.jsx(wT.StrictMode,{children:N.jsx(P4,{children:N.jsx(i$,{})})}));"serviceWorker"in navigator&&window.addEventListener("load",()=>{navigator.serviceWorker.register("/sw.js").catch(()=>{})});
